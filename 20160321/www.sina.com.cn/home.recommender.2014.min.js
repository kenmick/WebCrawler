/*!
* sina.com.cn/license
* svn:../ui/product/recommender/trunk
* 20141119152208
* [30,96,49] published at 2014-11-19 16:32:40
*/
/*!
* sina.com.cn/license
* svn:../ui/product/recommender/trunk
* 20140814111122
* [30,96,49] published at 2014-11-19 16:32:40
*/
(function(a){function d(){}for(var b=["error","info","log","warn","clear"],c;c=b.pop();){a[c]=a[c]||d}}(window.console=window.console||{}));console=window.console;(function(g,b){var l=[];var j=0;var d=null;var k=b||"___CrossDomainStorage___";var e=k+".onReady";var c={domain:"sina.com.cn",url:"http://news.sina.com.cn/iframe/87/store.html"};var f={domain:"fail to set domain!"};var i=function(){if(d){return}try{document.domain=c.domain}catch(r){throw new Error(f.domain);return}var p=document.getElementById(k);if(p){p.parentNode.removeChild(p)}var m=document.createElement("div");var q=document.body;var o='<iframe src="'+c.url+"?handle="+e+"&domain="+c.domain+'" frameborder="0"></iframe>';var n="-"+100000+"em";m.style.position="absolute";m.style.left=n;m.style.top=n;m.className="hidden";m.id=k;m.innerHTML=o;q.insertBefore(m,q.childNodes[0])};var h=function(){if(!j){i()}return j};var a={};a.ready=function(m){if(!h()){l.push(m);return}m(d)};a.onReady=function(m){if(j){return}j=1;d=m;if(l){while(l.length){l.shift()(m)}}l=null};a.config=function(n){if(!n){return}for(var m in n){if(n.hasOwnProperty(m)){c[m]=n[m]||c[m]}}return this};g[k]=a})(window);(function(exports){var Util={byId:function(id){return document.getElementById(id)},byAttr:function(node,attname,attvalue){var nodes=[];attvalue=attvalue||"";var getAttr=function(node){return node.getAttribute(attname)};for(var i=0,l=node.childNodes.length;i<l;i++){if(node.childNodes[i].nodeType==1){var fit=false;if(attvalue){fit=(getAttr(node.childNodes[i])==attvalue)}else{fit=(getAttr(node.childNodes[i])!="")}if(fit){nodes.push(node.childNodes[i])}if(node.childNodes[i].childNodes.length>0){nodes=nodes.concat(arguments.callee.call(null,node.childNodes[i],attname,attvalue))}}}return nodes},bindEvent:function(o,s,fn){if(o.attachEvent){o.attachEvent("on"+s,fn)}else{o.addEventListener(s,fn,false)}return o},builder:function(wrap,type){var list,nodes;nodes=this.byAttr(wrap,type);list={};for(var i=0,len=nodes.length;i<len;i++){var j=nodes[i].getAttribute(type);if(!j){continue}list[j]||(list[j]=[]);list[j].push(nodes[i])}return{box:wrap,list:list}},strLeft2:(function(){var byteLen=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return(str.length+(!aMatch?0:aMatch.length))};return function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(byteLen(str)>len){str=str.slice(0,str.length-1)}return str}})(),isArray:function(o){return Object.prototype.toString.call(o)==="[object Array]"},getGuid:function(){return Math.abs((new Date()).getTime())+"_"+Math.round(Math.random()*100000000)},extend:function(target,source,deep){target=target||{};var sType=typeof source,i=1,options;if(sType==="undefined"||sType==="boolean"){deep=sType==="boolean"?source:false;source=target;target=this}if(typeof source!=="object"&&Object.prototype.toString.call(source)!=="[object Function]"){source={}}while(i<=2){options=i===1?target:source;if(options!==null){for(var name in options){var src=target[name],copy=options[name];if(target===copy){continue}if(deep&&copy&&typeof copy==="object"&&!copy.nodeType){target[name]=this.extend(src||(copy.length!==null?[]:{}),copy,deep)}else{if(copy!==undefined){target[name]=copy}}}}i++}return target},cookie:(function(){var co={};co.getCookie=function(name){name=name.replace(/([\.\[\]\$])/g,"\\$1");var rep=new RegExp(name+"=([^;]*)?;","i");var co=document.cookie+";";var res=co.match(rep);if(res){return unescape(res[1])||""}else{return""}};co.setCookie=function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+"="+escape(value));if(expire){var dd=new Date();var expires=dd.getTime()+expire*3600000;dd.setTime(expires);cstr.push("expires="+dd.toGMTString())}if(path){cstr.push("path="+path)}if(domain){cstr.push("domain="+domain)}if(secure){cstr.push(secure)}document.cookie=cstr.join(";")};co.deleteCookie=function(name){document.cookie=name+"=;expires=Fri, 31 Dec 1999 23:59:59 GMT;"};return co})(),jsonp:function(url,params,cb,fix){var head=document.getElementsByTagName("head")[0];var idStr=url+"&"+params;var ojs=Util.byId(idStr);ojs&&head.removeChild(ojs);var fun="";var js=document.createElement("script");fix=fix||false;if(fix){if(typeof cb=="string"){fun=cb}}else{url=url+((url.indexOf("?")==-1)?"?":"&")+"_t="+Math.random();if(typeof cb=="function"){fun="fun_"+Util.getGuid();eval(fun+"=function(res){cb(res)}")}}url=url+"&callback="+fun;url=url+"&"+params;js.src=url;js.id=idStr;js.type="text/javascript";js.language="javascript";head.appendChild(js)},jsLoad:function(url,cb){var head=document.getElementsByTagName("head")[0];var js=document.createElement("script"),isLoaded=false;js.onload=js.onreadystatechange=function(){if(!isLoaded&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){isLoaded=true;js.onload=js.onreadystatechange=null;typeof cb=="function"&&cb()}};js.src=url;try{head.appendChild(js)}catch(e){}},uaTrack:function(key,val){if(typeof _S_uaTrack=="function"){try{_S_uaTrack(key,val)}catch(e){}}},timeoutHandle:(function(){var events=[];var handle={success:function(id){var eve=events[id];if(!eve){return}eve.isSuccess=true;clearTimeout(eve.timer)},timeout:function(id,fn){var eve=events[id];if(!eve){return}eve.timer=setTimeout(function(){if(eve.isSuccess){return}if(typeof fn=="function"){fn.call(this)}},eve.time)}};return function(id,fn,time){if(events[id]){throw new Error(id+"\u5DF2\u7ECF\u88AB\u5360\u7528");return}events[id]={};events[id].time=time||5000;events[id].isSuccess=false;if(typeof fn=="function"){fn.call(this,handle)}}})(),queryToJson:function(query,isDecode){var qList=query.split("&");var json={};for(var i=0,len=qList.length;i<len;i++){if(qList[i]){hash=qList[i].split("=");key=hash[0];val=hash[1];if(hash.length<2){val=""}if(!json[key]){json[key]=val}}}return json}};Util.app={filter:function(data,fn){var self=this;var addItSelf=(function(){var url=encodeURIComponent(location.href);var oUrl=decodeURIComponent((url.split("?")[0]).split("#")[0]);return function(arr){arr.push(oUrl);return arr}})()}};var Clz=function(parent){var klass=function(){this.init.apply(this,arguments)};if(parent){var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass}klass.prototype.init=function(){};klass.fn=klass.prototype;klass.fn.parent=klass;klass._super=klass.__proto__;klass.extend=function(obj){var extended=obj.extended;for(var i in obj){klass[i]=obj[i]}if(extended){extended(klass)}};klass.include=function(obj){var included=obj.included;for(var i in obj){klass.fn[i]=obj[i]}if(included){included(klass)}};return klass};Util.Clz=Clz;var Loader=new Clz;Loader.include({init:function(opt){var self=this;self.setStat();self.setOpt(opt);self.getData()},setOpt:function(opt){var self=this;self.opt=self.opt||{api:"http://interest.mix.sina.com.cn/api/cate/get",type:"",dpc:"",loadComplete:function(){},time:3000,error:function(msg){}};var selfOpt=self.opt;if(opt||""){selfOpt=Util.extend(selfOpt,opt,true)}},setStat:function(){var self=this;self._data=null},getGuid:function(){var isVaild=function(guid){guid=parseInt(guid||"0");if(guid<=0){return false}return true};var genGuid=function(){return Util.getGuid()};var cookie=Util.cookie;var guid=cookie.getCookie("SGUID");if(!isVaild(guid)){guid=genGuid();cookie.setCookie("SGUID",guid,43800,"/","sina.com.cn")}return guid},getData:function(){var self=this;var opt=self.opt;var loadedFnName="cb_"+Util.getGuid();var TIMEOUT_NAME="loadrecommenderdata"+Util.getGuid();var guid=self.getGuid();var api=self.opt.api;var dpcParam=opt.dpc?"dpc=1":"";if(api.indexOf("?")!=-1){api=api+"&"}else{api=api+"?"}var url=api+"rnd="+Util.getGuid();Util.timeoutHandle(TIMEOUT_NAME,function(handle){exports[loadedFnName]=function(msg){handle.success(TIMEOUT_NAME);self._data=msg;if(msg.data&&msg.data.length>0){self._loadComplete(msg);opt.loadComplete(msg)}else{opt.error({type:"invaild-data",msg:"invail data"})}};handle.timeout(TIMEOUT_NAME,function(){opt.error({type:"timeout",msg:TIMEOUT_NAME+" "+opt.time+" timeout"})});Util.jsonp(url,dpcParam,loadedFnName,true)},opt.time)},_loadComplete:function(m){}});var PageLoader=new Clz(Loader);PageLoader.include({init:function(opt){var self=this;self.setOpt(opt);self.getData()},setOpt:function(opt){var self=this;self.opt=self.opt||{api:"http://interest.mix.sina.com.cn/api/cate/get",type:"",listNum:10,pageNum:10,handleData:function(){},loadComplete:function(){},pageComplete:function(){},time:3000,error:function(msg){}};var selfOpt=self.opt;if(opt||""){selfOpt=Util.extend(selfOpt,opt,true)}},_loadComplete:function(msg){var dataHandled=this.opt.handleData(msg);if(typeof dataHandled!=="undefined"&&dataHandled){msg=dataHandled}this.page(msg)},page:function(msg){var arraySlice=function(data,listNum,pageNum){var len=data.length,index=0,to,i,pages=[];pageNum=pageNum||Infinity;listNum=listNum||len;for(i=0;i<pageNum;i++){to=index+listNum;if(to>len){break}pages.push(data.slice(index,to));index+=listNum}return pages};var self=this;var data=[];if(msg){if(msg.data){data=msg.data}if(msg.top){data=data.concat(msg.top)}}var pages=arraySlice(data,parseInt(self.opt.listNum,10),parseInt(self.opt.pageNum,10));self.opt.pageComplete(pages)}});var Recommender={};Recommender.register=function(namespace,method){var i=0,un=Recommender,ns=namespace.split("."),len=ns.length,upp=len-1,key;while(i<len){key=ns[i];if(i==upp){if(un[key]!==undefined){throw ns+":: has registered"}un[key]=method}if(un[key]===undefined){un[key]={}}un=un[key];i++}};Recommender.register("util",Util);Recommender.register("Clz",Clz);Recommender.register("Loader",Loader);Recommender.register("PageLoader",PageLoader);var EXPORTS_NAME="SinaRecommender";var UGLIFY_NAME="___"+EXPORTS_NAME+"___";exports[UGLIFY_NAME]=Recommender;if(exports[EXPORTS_NAME]){throw'\u4E2A\u6027\u5316\u63A8\u8350\u5168\u5C40\u53D8\u91CF\u540D"'+EXPORTS_NAME+'"\u5DF2\u7ECF\u88AB\u5360\u7528\u53EF\u4F7F\u7528'+UGLIFY_NAME}else{exports[EXPORTS_NAME]=Recommender}})(window);SHM.register("home.guess.init",function(g){var e=g.dom.byId;var d=false;var c=null;var b=null;var f=false;var h={};var a=function(i,k){if(typeof _S_uaTrack=="function"){try{_S_uaTrack(i,k)}catch(j){}}};h.init=function(){var o=(typeof(window.ontouchstart)!=="undefined");var s=(function(){var w="page-data";var x={};var v=false;var z=null;var y=function(A){if(x[A]){return}A=parseInt(A,10);var B=(function(){var G=[];var E=z[A];for(var D=0,C=E.length;D<C;D++){var F=E[D];G.push(encodeURIComponent(F.url))}return G.join(",")})();a("recmd_news_view",B);x[A]=1};return function(B,A){z=A;if(v){return}g.evt.addEvent(B,"click",function(E){E=E||window.event;var D=E.target||E.srcElement;var C=D.getAttribute(w);if(C){y(C)}})}})();var t=function(){var v=e("SI_Guess_Wrap");if(!v){return}var D=v.getAttribute("page-length")||Infinity;var w=v.getAttribute("list-length")||Infinity;var F=v.getAttribute("item-length")||Infinity;var x=document.getElementById(v.getAttribute("change-btn"))||null;var z=function(J){var I=J.match(/[^\x00-\x80]/g);return(J.length+(!I?0:I.length))};var G=function(K,I){var J=K.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");K=K.slice(0,J.slice(0,I).replace(/\*\*/g," ").replace(/\*/g,"").length);if(z(K)>I){K=K.slice(0,K.length-1)}return K};var H=function(J,I){if(F==Infinity){return J}switch(I){case"slide":J=G(J,(F-1)*2);break;case"video":J=G(J,(F-1)*2);break;default:J=G(J,F*2);break}return J};var C=function(){var J=v.getElementsByTagName("ul");var I=J.length;if(I<2){return}var K=e("SI_Guess_Control");K&&(K.style.display="");if(K||b){K.innerHTML='<a class="mod-guess-prev" href="javascript:;" title="\u4E0A\u4E00\u5E27" id="SI_Guess_Prev" hidefocus="true">\u4E0A\u4E00\u5E27</a> <span class="mod-guess-dots" id="SI_Guess_Dots"> </span> <a class="mod-guess-next" href="javascript:;" title="\u4E0B\u4E00\u5E27" id="SI_Guess_Next" hidefocus="true">\u4E0B\u4E00\u5E27</a>'}wrapLoadedHTML=document.getElementById("SI_Guess_Wrap").innerHTML;var L=new ScrollPic();L.scrollContId="SI_Guess_Wrap";L.dotListId="SI_Guess_Dots";L.dotOnClassName="current";L.listType="";L.listEvent="onmouseover";L.frameWidth=360;L.pageWidth=360;L.upright=false;L.speed=20;L.space=25;L.autoPlay=true;L.autoPlayTime=20;L.circularly=true;L.arrLeftId="SI_Guess_Prev";L.arrRightId="SI_Guess_Next";L.initialize();e("SI_Guess_Prev").onmousedown=function(){a("index_new_guess","change")};e("SI_Guess_Next").onmousedown=function(){a("index_new_guess","change")};b=L};var B=function(N){var J=N,R,V,U,O="";var S={"3":"videoNewsLeft","2":"slideNewsLeft"};var T=function(W){var X=S[W];return typeof X=="undefined"?"":X};var P=' target="_blank" suda-uatrack="key=index_new_guess&value='+A+"_click";var I=J.length<D?J.length:D;for(var M=0;M<I;M++){R=J[M];var Q=R.length;var L=A=="c"?' page-data="'+M+'" ':"";if(Q<w){break}O+='<ul class="list-a list-a-201406121603">';for(var K=0;K<Q;K++){V=R[K];U=V.title.replace(/<\/?[^>]*>/g,"");O+="<li><a "+L+' class="'+T(V.type)+'" '+P+'" href="'+V.url+'" title="'+U+'">'+H(U,V.type)+"</a></li>"}O+="</ul>"}v.innerHTML=O;C();d=true;SHMUATrack("guess",A+"_pageview");s(v,N)};var y=window.___SinaRecommender___;var E=y.util;var A="c";c=new y.PageLoader({api:"http://cre.mix.sina.com.cn/api/v3/get?cateid=sina_all&fields=url,title,type&cre=sinapc&mod=g&statics=1&merge=3&length="+w*D,listNum:w,pageNum:D,time:5000,pageComplete:B,error:function(J){Loader=c;if(J.type=="timeout"||J.type=="invaild-data"){if(J.type=="timeout"){SHMUATrack("guess",A+"_timeout")}var K=function(){var N=new Date(),O=N.getFullYear(),P=N.getMonth()+1,M=N.getDate();if(P<10){P="0"+P}if(M<10){M="0"+M}return O+""+P+M};var I="http://top.news.sina.com.cn/ws/GetTopDataList.php?top_type=day&top_cat=www_all&top_time="+K()+"&top_show_num="+(Loader.opt.listNum*Loader.opt.pageNum)+"&top_order=ASC&format=json&__app_key=ls";var L="cb_"+E.getGuid();window[L]=function(M){A="c_hotlist";M=M.result;Loader._data=M;Loader._loadComplete(M);Loader.opt.loadComplete(M)};E.jsonp(I,"dpc=1",L,true)}}})};t();var p=g.E("SI_Guess_Login_Btn");if(!p){return}var u=window.SINA_OUTLOGIN_LAYER;var m=g.evt.custEvent.add;var i=g.evt.custEvent.remove;var j=sinaSSOController.get51UCCookie();if(j&&p){p.style.display="none"}m(g,"loginSuccess",function(){if(p){p.style.display="none";j=sinaSSOController.get51UCCookie()}});m(g,"logoutSuccess",function(){if(p){p.style.display="";j=sinaSSOController.get51UCCookie()}});g.evt.addEvent(document.getElementById("SI_WEIBORecommend_span"),"mouseover",function(){p.style.display="none";f=true});g.evt.addEvent(document.getElementById("SI_Guess_span"),"mouseover",function(){if(!!!b){return}if(f){b.leftMouseDown();b.leftEnd();f=false}if(!!!j){p.style.display="block"}});var l="wbcallback_"+g.util.getUniqueKey();jsLoader({name:"WeiboRecommend",url:"http://weibo.com/a/aj/recommend/general?channel=sina&callback="+l+"&_="+(new Date()).getTime()});var n=document.getElementById("SI_WEIBORecommend_Wrap");var q=n.getAttribute("page-length")||16;var k=n.getAttribute("list-length")||8;var r=n.getAttribute("item-length")||11;window[l]=function(z){var v=z.data.weibo.items;var y='<ul class="list-a">';var w=0;for(var x=0;x<v.length;x++){if(v[x].title.length<=r&&w<=q){y+="<li><a target=_blank href="+v[x].link+" title="+v[x].title+" >"+v[x].title+"</a></li>";w++}if(w==k){y+='</ul><ul class="list-a">'}}y+="</ul>";n.innerHTML=y};g.evt.addEvent(p,"click",function(){SHMUATrack("guess","weibo_hotshow_signin");u.set("plugin",{position:"top,right",parentNode:null,relatedNode:p}).set("drag",{enable:true,dragarea:"page"}).set("styles",{marginLeft:0,marginTop:"40px"}).show();m(g,"loginSuccess",function(){if(c){c.getData()}else{t()}})})};h.isLoaded=function(){return d};h.init();return h});SHM.register("home.guess.isLoaded",function(a){return function(){return a.home.guess.init.isLoaded()}});