KISSY.add("kg/search-suggest/6.0.17/mods/local-query",["base","json","kg/search-suggest/6.0.17/mods/storage"],function(t,e,a,s){function n(t){n.superclass.constructor.call(this,t||{}),this.initialize()}var i=e("base"),r=e("json"),o=e("kg/search-suggest/6.0.17/mods/storage"),u="localQuery";KISSY.extend(n,i,{initialize:function(){var t=this,e=t.get("name"),a=t.get("tab"),s=t.get("user");"item"===a&&(a="baobei"),t.storageKey=u+e+a+s,t._getStorage()},checkFlash:function(t){this.storage.read(t)},_setKey:function(t){var e=this,a=t.name||e.get("name"),s=t.tab||e.get("tab"),n=t.user||e.get("user");"item"===s&&(s="baobei"),e.storageKey=u+a+s+n,e.set("tab",s),e.set("name",a),e.set("user",n),this.datalist=null},_save:function(t,e){if(!t.match(/<>'"/)&&!e.match(/<>'"/)){var a=this._getDatalist(),s=encodeURIComponent(t),n={key:s,value:encodeURIComponent(e),time:KISSY.now()};this._deleteItemByValue(a,s),a.unshift(n)}},_deleteItemByValue:function(t,e){for(var a,s=null,n=0;n<t.length;n++)a=t[n].key,a==e&&(s=t.splice(n,1),n--)},_query:function(t){var e,a,s=this._getDatalist(),n=[];return t?(t=encodeURIComponent(t),KISSY.each(s,function(s){e=s.key,a=s.value,(0===e.indexOf(t)||0===a.indexOf(t))&&n.push(s)}),this._distinctByValue(n)):this._distinctByValue(s)},_distinctByValue:function(t){for(var e,a=[],s=0,n=t.length;n>s;s++)e=t[s],e.value.match(/%3C|%3E|[<>'"]/g)||this._hasItemOfValue(a,e.value)||a.push(e);return a},_hasItemOfValue:function(t,e){for(var a=!1,s=t.length-1;s>=0;s--)t[s].value===e&&(a=!0);return a},_cleanBefore:function(t){for(var e,a=this._getDatalist(),s=0,n=a.length-1;n>=0;n--)if(e=a[n],e.time>t){s=n+1;break}a.length=s},_getDatalist:function(){return this.datalist||(this.datalist=this.storage.read()||[]),this.datalist},_getStorage:function(){var t=this.get("storageType");switch(t){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var t=this;return{save:function(){return(new o).save(t.storageKey,r.stringify(t.datalist))},read:function(e){var a=(new o).read(t.storageKey,e);if(a){var s=r.parse(a);return s}return void 0}}},destructor:function(){this.datalist=null,u=null},save:function(t,e){if(""!==e){var a,s=this.storage.read();s&&(a=s.length);var n=this._save(t,e),i=this.storage.save();return a>300&&(this.datalist=this.datalist.slice(0,a-10),KISSY.log("add_before\n"+i+"\n"+a),i=this.storage.save(),KISSY.log("add_after\n"+i+"\n"+a)),n}},query:function(t){return this._query(t)},deleteItem:function(t){var e=this._getDatalist(),a=e.length;this._deleteItemByValue(e,encodeURIComponent(t));var s=this.storage.save();a>300&&(this.datalist=this.datalist.slice(0,a-10),s=this.storage.save(),KISSY.log("delete\n"+s+"\n"+a))},clearByDay:function(t){var e=KISSY.now()-24*t*3600*1e3;this._cleanBefore(e),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(t){return t}},user:{value:"",setter:function(t){return KISSY.fromUnicode(t)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(t){return t},getter:function(t){return t}}}}),s.exports=n});KISSY.add("kg/search-suggest/6.0.17/mods/menu",["node"],function(e,t,n,r){var o=t("node"),u=o.all,l=function(e){var t=this;t.opts=KISSY.mix(l.defs,e),t.$wrap=u(t.opts.wrap),t.$menu=u(t.opts.menu),t.locs=[],t.rNow=null,t.tOut=null,t.init()};l.defs={wrap:"",menu:"",rows:"",dealy:300,handler:null,tolerance:0},l.prototype.getOffset=function(){var e=this,t=e.opts,n=e.$menu,r=n.offset();e.menuOffset=r,e.upperRight={x:r.left+n.outerWidth(),y:r.top-t.tolerance},e.lowerRight={x:r.left+n.outerWidth(),y:r.top+n.outerHeight()+t.tolerance}},l.prototype.bindEvent=function(){var e,t,n,r=this,o=r.opts,l=r.locs,a=r.rNow,i=r.tOut,s=null,f=function(i){function f(e,t){return(t.y-e.y)/(t.x-e.x)}var c=!!u(i).one(o.cls);r.getOffset(),e=r.menuOffset,t=r.upperRight,n=r.lowerRight;var p=l[l.length-1],g=l[0];if(!a||!p)return 0;if(g.x<e.left||g.x>n.x||g.y<e.top||g.y>n.y)return 0;if(s&&p.x==s.x&&p.y==s.y)return 0;var d=f(p,t),h=f(p,n),y=f(g,t),m=f(g,n);return c&&y>d&&h>m?(s=p,o.dealy):(s=null,0)},c=function(e){a!=e&&(o.handler.enterHandler(e),a=e)},p=function(e,t){t?r.isDelay=!0:r.isDelay=!1;var n=f(t);n?i=setTimeout(function(){p(r.currentTarget,r.currentTarget)},n):(r.isDelay=!1,c(e))},g=function(e){l.push({x:e.pageX,y:e.pageY}),l.length>3&&l.shift()},d=function(){a=null,o.handler.leaveHandler()},h=function(){r.isDelay=!1,a=null,i&&clearTimeout(i)},y=function(e){if(r.currentTarget=e.currentTarget,!r.isDelay){i&&clearTimeout(i);var t=e.relatedTarget,n=u(t).parent(o.rows);p(e.currentTarget,n)}};r.$wrap.on("mousemove",g).on("mouseleave",d),r.$menu.on("mouseleave",h).delegate("mouseenter",o.rows,y)},l.prototype.init=function(){this.getOffset(),this.bindEvent()},r.exports=l});KISSY.add("kg/search-suggest/6.0.17/tpl/cloud",[],function(a,t,l,s){s.exports={navi:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-navi-list" '+a.autoAttr+'> <div class="inner-wrap"> <a class="cloud-img-wrap" href="//'+a.data.url+"?source=suggest&suggest=navi_"+a.index+'_1" target="_self"> <img src="//img.alicdn.com/tps/i1/'+a.data.logo+'_70x70.jpg" /> </a> <p>'+a.data.title+'</p> <a class="cloud-btn-wrap" href="//'+a.data.url+"?source=suggest&suggest=navi_"+a.index+'_1" target="_self"> <span class="cloud-link">'+a.data.button+"</span><i>></i> </a> </div></div>";return t},qrcode:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-qrcode" '+a.autoAttr+' > <div class="inner-wrap"> <a href="'+a.data.url+'"><img src="'+a.data.image+'"/></a> </div></div>';return t},spu:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-spu-list" '+a.autoAttr+' > <div class="inner-wrap"> <ul> ',l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li> <a class="cloud-img-wrap cloud-link" href="//'+s.url+"&source=suggest&suggest=spu_"+a.index+"_"+(~~i+1)+'" target="_self"> <img src="//img.alicdn.com/tps/i1/'+s.pic+'_50x50.jpg" /> </a> <a class="cloud-title" title="'+s.title+'" href="//'+s.url+"&source=suggest&suggest=spu_"+a.index+"_"+(~~i+1)+'" target="_self"> <span>'+s.title+'</span> </a> <p class="cloud-price '+(0===~~s.price?"cloud-hidden":"")+'">åèä»·:<b class="">ï¿¥'+s.price+'</b><b class="noprice">ææ </b></p> </li> ';return t+=' </ul> <p class="cloud-total '+a.ishidden+'"> <span class="total">å±'+a.count+'æ¬¾äº§å</span> <a class="more" target="_self" href="//'+a.link+"&source=suggest&suggest=spu_"+a.index+'_more">æ¥çå¨é¨>></a> </p> </div></div>'},tag:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="true" class="J_cloud-handle cloud-list" '+a.autoAttr+' > <div class="inner-wrap"><h3>'+a.tagTitle+"</h3> <ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li><a target="_self" href="'+a.action+"?q="+a.tagTitle+" "+s+"&wq="+a.query+"&source=suggest&suggest=magic_"+a.index+"_"+(~~i+1)+"&tag="+s+a.param+'" class="cloud-link"><span>'+s+"</span></a></li> ";return t+=" </ul> </div></div>"},tag_group:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="true" class="J_cloud-handle cloud-list type-taggroup" '+a.autoAttr+' > <div class="inner-wrap"><h3>'+a.tagTitle+"</h3> <ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;){s=l[i+=1],t+=' <li  class="tag-group"> <ul> ';var r=s;if(r)for(var d,u=-1,n=r.length-1;n>u;)d=r[u+=1],t+=' <li> <a target="_self" href="'+a.action+"?q="+encodeURIComponent(a.tagTitle+" "+d.title)+"&wq="+a.query+"&source=suggest&suggest=magic_"+a.index+"_"+(~~u+1)+"&tag="+d.title+a.param+'" class="cloud-link '+d.type+'"><span>'+d.title+"</span></a> </li> ";t+=" </ul> </li> "}return t+=" </ul> </div></div>"},topbrand:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-topbrand-list" '+a.autoAttr+' > <div class="inner-wrap"> <h3>â'+a.tagTitle.substr(0,11)+"âç­é¨åç</h3><ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li> <a class="cloud-title cloud-link" href="//'+s.url+"&source=suggest&suggest=brandlist_"+a.index+"_"+(~~i+1)+'" target="_self"> <span><i class="cloud-top'+i+'">'+(~~i+1)+"</i>"+s.title+"</span> </a> </li> ";return t+=" </ul> </div></div>"}}});KISSY.add("kg/search-suggest/6.0.17/mods/bts",["base","kg/search-suggest/6.0.17/mods/utils"],function(t,e,s,u){function n(t){n.superclass.constructor.call(this,t||{})}var r=e("base"),c=e("kg/search-suggest/6.0.17/mods/utils");KISSY.extend(n,r,{getBucket:function(){var t=this,e=t.getCookieT(),s=t.getTestBucket()||t.retBucket(e,20,-4,4)-0;return s},getTestBucket:function(){var t=location.search,e=t.match(/alg_bts=(\d+)/);return e&&e[1]?e[1]-0:void 0},getCookieT:function(){var t=new c,e=t.getCookie("t");return e},retBucket:function(t,e,s,u){return!t&&"0"||this.countBucket(t,e,s,u)},countBucket:function(t,e,s,u){var n=t.substr(s,u),r=parseInt(n,16),c=r%e+1;return c+""}},{ATTRS:{pluginId:{value:"bts"}}}),u.exports=n});/*!build time : 2015-04-30 4:19:57 PM*/
KISSY.add("kg/uploader/3.0.3/type/base",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a)}{var e="";b.all}return a.mix(d,{event:{START:"start",STOP:"stop",SUCCESS:"success",ERROR:"error"}}),a.extend(d,c,{upload:function(){},stop:function(){},_processResponse:function(b){var c=this,d=c.get("filter"),f={};if(a.isString(b))try{f=a.JSON.parse(b),d!=e&&(f=d.call(c,b)),f=c._fromUnicode(f)}catch(g){var h=b+"\uff0c\u8fd4\u56de\u7ed3\u679c\u96c6responseText\u683c\u5f0f\u4e0d\u5408\u6cd5\uff01";a.log(h),c.fire("error",{status:-1,result:{msg:h}})}else a.isObject(b)&&(f=b,d!=e&&(f=d.call(c,b)),f=c._fromUnicode(f));return a.log("\u670d\u52a1\u5668\u7aef\u8f93\u51fa\uff1a"+a.JSON.stringify(f)),f},_fromUnicode:function(b){function c(b){a.each(b,function(d,e){a.isObject(b[e])?c(b[e]):b[e]=a.isString(d)&&a.fromUnicode(d)||d})}return a.isObject(b)?(c(b),b):b}},{ATTRS:{action:{value:e},data:{value:{}},filter:{value:e}}}),d},{requires:["node","base"]}),KISSY.add("kg/uploader/3.0.3/type/iframe",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a)}var e="",f=b.all,g="[uploader-iframeType]:",h="ks-uploader-iframe-";return a.mix(d,{tpl:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}" style="visibility: hidden;">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'},event:a.mix(c.event,{CREATE:"create",REMOVE:"remove"})}),a.extend(d,c,{upload:function(b){var c,e=this,h=f(b);return h.length?(e.fire(d.event.START,{input:h}),e.set("fileInput",h),e._create(),(c=e.get("form"))?void c.getDOMNode().submit():(a.log(g+"form\u8282\u70b9\u4e0d\u5b58\u5728\uff01"),!1)):!1},stop:function(){var a=this,b=a.get("iframe");return b.attr("src",'javascript:"<html></html>";'),a._remove(),a.fire(d.event.STOP),a.fire(d.event.ERROR,{status:"abort",msg:"\u4e0a\u4f20\u5931\u8d25\uff0c\u539f\u56e0\uff1aabort"}),a},dataToHidden:function(b){if(!a.isObject(b)||a.isEmptyObject(b))return"";var c=this,d=e,f=c.get("tpl"),g=f.HIDDEN_INPUT;if(!a.isString(g))return"";for(var h in b)d+=a.substitute(g,{name:h,value:b[h]});return d},_createIframe:function(){var b,c,d=this,e=h+a.guid(),i=d.get("tpl"),j=i.IFRAME,k=d.get("iframe");return a.isEmptyObject(k)?a.isString(j)?a.isString(e)?(b=a.substitute(i.IFRAME,{id:e}),c=f(b),d.get("domain")||c.on("load",d._iframeLoadHandler,d),f("body").append(c),d.set("id",e),d.set("iframe",c),f("body").data("UPLOAD_TYPE",d),c):(a.log(g+"id\u5fc5\u987b\u5b58\u5728\u4e14\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff01"),!1):(a.log(g+"iframe\u7684\u6a21\u677f\u4e0d\u5408\u6cd5\uff01"),!1):k},handleResult:function(a){var b=this;a=b._processResponse(a),b.fire(d.event.SUCCESS,{result:a}),b._remove()},_iframeLoadHandler:function(b){var c=this,f=b.target,g=d.event.ERROR;try{var h=f.contentDocument||window.frames[f.id].document;if(!h||!h.body)return c.fire(g,{msg:"\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u6709\u95ee\u9898\uff01"}),!1;var i=h.body.innerHTML;if(i==e)return!1;c.handleResult(i)}catch(j){a.log(j)}},_createForm:function(){var b,c,d,e=this,h=e.get("id"),i=e.get("tpl"),j=i.FORM,k=e.get("data"),l=e.get("action"),m=e.get("fileInput");return a.isString(j)?a.isString(l)?(b=e.dataToHidden(k),b+=e.dataToHidden({type:"iframe"}),d=a.substitute(j,{action:l,target:h,hiddenInputs:b}),c=f(d).append(m),f("body").append(c),e.set("form",c),c):(a.log(g+"action\u53c2\u6570\u4e0d\u5408\u6cd5\uff01"),!1):(a.log(g+"form\u6a21\u677f\u4e0d\u5408\u6cd5\uff01"),!1)},_create:function(){var a=this,b=a._createIframe(),c=a._createForm();a.fire(d.event.CREATE,{iframe:b,form:c})},_remove:function(){var a=this,b=a.get("form");return b?(b.remove(),a.reset("form"),void a.fire(d.event.REMOVE,{form:b})):!1}},{ATTRS:{tpl:{value:d.tpl},id:{value:h+a.guid()},domain:{value:e},iframe:{value:{}},form:{value:e},fileInput:{value:e}}}),d},{requires:["node","./base"]}),KISSY.add("kg/uploader/3.0.3/type/ajax",function(a,b,c,d){function e(a){var b=this;e.superclass.constructor.call(b,a),b._setWithCredentials()}var f="",g=b.all,h="[uploader-AjaxType]:";return a.mix(e,{event:a.merge(c.event,{PROGRESS:"progress"})}),a.extend(e,c,{upload:function(b){var c=this;if(!b)return a.log(h+"upload()\uff0cfileData\u53c2\u6570\u6709\u8bef\uff01"),c;var d=c.get("blobSize");return d>0?c._chunkedUpload(b):c._fullUpload(b),c},stop:function(){var b=this,c=b.get("ajax");return a.isObject(c)?(c.abort(),b.fire(e.event.STOP),b):(a.log(h+"stop()\uff0cio\u503c\u9519\u8bef\uff01"),b)},_getFormData:function(b){return g.isArray(b)?b:a.isObject(b)?(b=[],g.each(b,function(a,c){b.push({name:a,value:c})}),b):b},_setWithCredentials:function(){var b=this,c=(b.get("CORS"),b.get("ajaxConfig"));return a.mix(c,{xhrFields:{withCredentials:!0}}),c},_setFormData:function(){var b=this;try{b.set("formData",new FormData),b._processData()}catch(c){a.log(h+"something error when reset FormData.")}},_resetFormData:function(){var a=this;a.set("formData",new FormData)},_processData:function(){var b=this,c=b.get("data"),d=b.get("formData");a.each(c,function(a,b){d.append(b,a)}),b.set("formData",d)},_addFileData:function(b){if(!a.isObject(b))return a.log(h+"_addFileData()\uff0cfile\u53c2\u6570\u6709\u8bef\uff01"),!1;var c=this,d=c.get("formData"),e=c.get("fileDataName"),f=b.name;return d.append(e,b,f),c.set("formData",d),d},_chunkedUpload:function(b){function c(){var h=l.call(b,j,j+k,b.type),m=h.size;f._setContentDisposition(b.name),f._setContentRange(j,m,i),f._setFormData(),f._addFileData(h),a.mix(g,{data:f.get("formData")});var n=d(g);n.then(function(a){var b=a[0];j=f._getUploadedBytes(n)||j+m,f.fire(e.event.PROGRESS,{loaded:j,total:i}),i>j?c():f.fire(e.event.SUCCESS,{result:b})},function(a){f._errorHandler(a,b)})}if(!a.isObject(b))return!1;var f=this,g=f.get("ajaxConfig"),h=f.get("action");a.mix(g,{url:h});var i=b.size,j=0,k=f.get("blobSize")||i,l=b.slice||b.webkitSlice||b.mozSlice;c()},_fullUpload:function(b){var c=this,f=c.get("ajaxConfig");c._setFormData(),c._addFileData(b),a.mix(f,{data:c.get("formData"),url:c.get("action")});var g=d(f);return g.then(function(a){var b=a[0];b=c._processResponse(b),c.fire(e.event.SUCCESS,{result:b})},function(a){c._errorHandler(a,b)}),c.set("ajax",g),g},_errorHandler:function(a,b){var c=this,d={},f=a[1];"timeout"==f&&(d.msg="\u8bf7\u6c42\u8d85\u65f6\uff01",d.status="timeout"),c.fire(e.event.ERROR,{status:f,result:d,file:b})},_getUploadedBytes:function(a){var b=a.getResponseHeader("Range"),c=b&&b.split("-"),d=c&&c.length>1&&parseInt(c[1],10);return d&&d+1},_setContentRange:function(a,b,c){var d="bytes "+a+"-"+(a+b-1)+"/"+c,e=this,f=e.get("ajaxConfig"),g=f.headers;return g["Content-Range"]=d,d},_setContentDisposition:function(a){return this._setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURI(a)+'"')},_setRequestHeader:function(a,b){var c=this,d=c.get("ajaxConfig");return d.headers[a]=b,c.set("ajaxConfig",d),b}},{ATTRS:{formData:{value:f},ajaxConfig:{value:{type:"post",processData:!1,cache:!1,dataType:"json",contentType:!1,timeout:600,headers:{}}},ajax:{value:f},fileDataName:{value:f},form:{value:{}},fileInput:{value:f},blobSize:{value:0},CORS:{value:!1},isUsePostMessage:{value:!1},timeout:{value:600,setter:function(a){var b=this,c=b.get("ajaxConfig");return c.timeout=a,a}}}}),e},{requires:["node","./base","ajax"]}),KISSY.add("kg/uploader/3.0.3/type/flash",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a),b.isHasCrossdomain(),b._init()}var e="",f="[uploader-FlashType]:";return a.mix(d,{event:a.merge(c.event,{SWF_READY:"swfReady",PROGRESS:"progress"})}),a.extend(d,c,{_init:function(){var b=this,c=b.get("swfUploader");return c?(c.on("contentReady",function(){b.fire(d.event.SWF_READY)},b),c.on("uploadStart",b._uploadStartHandler,b),c.on("uploadProgress",b._uploadProgressHandler,b),c.on("uploadCompleteData",b._uploadCompleteDataHandler,b),void c.on("uploadError",b._uploadErrorHandler,b)):(a.log(f+"swfUploader\u5bf9\u8c61\u4e3a\u7a7a\uff01"),!1)},upload:function(b){var c=this,d=c.get("swfUploader"),e=c.get("action"),f="POST",g=c.get("data"),h=c.get("fileDataName");return h||(h="Filedata"),c.set("uploadingId",b),a.mix(g,{type:"flash"}),d.upload(b,e,f,g,h),c},stop:function(){var a=this,b=a.get("swfUploader"),c=a.get("uploadingId");return c!=e&&(b.cancel(c),a.fire(d.event.STOP,{id:c})),a},_uploadStartHandler:function(a){var b=this;b.fire(d.event.START,{file:a.file})},_uploadProgressHandler:function(b){var c=this;a.mix(b,{loaded:b.bytesLoaded,total:b.bytesTotal}),a.log(f+"\u5df2\u7ecf\u4e0a\u4f20\u5b57\u8282\u6570\u4e3a\uff1a"+b.bytesLoaded),c.fire(d.event.PROGRESS,{loaded:b.loaded,total:b.total})},_uploadCompleteDataHandler:function(a){var b=this,c=b._processResponse(a.data);b.set("uploadingId",e),b.fire(d.event.SUCCESS,{result:c})},_uploadErrorHandler:function(a){var b=this;b.set("uploadingId",e),b.fire(d.event.ERROR,{msg:a.msg})},isHasCrossdomain:function(){var b=location.hostname;a.io({url:"//"+b+"/crossdomain.xml",dataType:"xml",error:function(){a.log("\u7f3a\u5c11crossdomain.xml\u6587\u4ef6\u6216\u8be5\u6587\u4ef6\u4e0d\u5408\u6cd5\uff01")}})}},{ATTRS:{action:{value:e,getter:function(b){var c=/^http/;if(!c.test(b)&&!/\/\//.test(b)){var d,e=location.href,f=e.split("/");d=a.filter(f,function(a,b){return b<f.length-1}),b=d.join("/")+"/"+b}return b}},swfUploader:{value:e},uploadingId:{value:e}}}),d},{requires:["node","./base"]}),KISSY.add("kg/uploader/3.0.3/button/base",function(a,b,c){function d(b,c){var e=this;c=a.merge({target:g(b)},c),d.superclass.constructor.call(e,c)}var e="",f="[Uploader-Button] ",g=b.all;return a.mix(d,{event:{beforeShow:"beforeShow",afterShow:"afterShow",beforeHide:"beforeHide",afterHide:"afterHide",beforeRender:"beforeRender",afterRender:"afterRender",CHANGE:"change"},getFileName:function(a){return a.replace(/.*(\/|\\)/,"")}}),a.extend(d,c,{render:function(){var b=this,c=b.get("srcFileInput");if(!c||!c.length)return a.log("[Button]file\u5143\u7d20\u4e0d\u5b58\u5728\uff01"),b;var d=c.clone();d.addClass("file-input"),c.remove(),b.set("srcFileInput",d),b._createInput()},show:function(){var a=this,b=a.get("target");return b.show(),a.fire(d.event.afterShow),d},hide:function(){var a=this,b=a.get("target");return b.hide(),a.fire(d.event.afterHide),d},reset:function(){var a=this,b=a.get("inputContainer");return g(b).remove(),a.set("inputContainer",e),a.set("fileInput",e),a._createInput(),a},_createInput:function(){var b=this,c=b.get("target"),d=(b.get("name"),b.get("tpl"));if(!a.isString(d))return!1;var e=b.get("srcFileInput");if(!e.length)return!1;var f=e.clone();b.set("fileInput",f);var h=g(d);return h.append(f),h.appendTo(c),6==a.UA.ie&&f.css("fontSize","400px"),g(f).on("change",b._changeHandler,b),b.set("inputContainer",h),b._setDisabled(b.get("disabled")),b._setMultiple(b.get("multiple")),h},_changeHandler:function(b){var c=this,h=c.get("fileInput"),i=g(h).val(),j=b.target.files,k=[];return i==e?(a.log(f+"No file selected."),!1):(j?a.each(j,function(b){a.isObject(b)&&k.push({name:b.name,type:b.type,size:b.size,data:b})}):k.push({name:d.getFileName(i)}),c.fire(d.event.CHANGE,{files:k,input:h.getDOMNode()}),void c.reset())},_setDisabled:function(b){var c=this,d=c.get("cls"),e=d.disabled,f=c.get("target"),h=c.get("fileInput");return f.length&&a.isBoolean(b)?(b?(f.addClass(e),g(h).hide()):(f.removeClass(e),g(h).show()),b):!1},_setMultiple:function(a){var b=this,c=b.get("fileInput");return c.length?(a&&c.attr("multiple","multiple")||c.removeAttr("multiple"),a):!1}},{ATTRS:{target:{value:null},fileInput:{value:e},srcFileInput:{value:e},inputContainer:{value:e},tpl:{value:'<div class="file-input-wrapper" style="overflow: hidden;"></div>'},name:{value:"fileInput",setter:function(a){return this.get("fileInput")&&g(this.get("fileInput")).attr("name",a),a}},disabled:{value:!1,setter:function(a){return this._setDisabled(a),a}},multiple:{value:!0,setter:function(a){return this._setMultiple(a),a}},cls:{value:{disabled:"uploader-button-disabled"}}}}),d},{requires:["node","base"]}),KISSY.add("kg/uploader/3.0.3/plugins/ajbridge/ajbridge",function(a,b,c){function d(c,f,j){c=c.replace(e,""),f=b._normalize(f||{});var k=this,l=e+c,m=function(b){return b.status<1?void k.fire("failed",{data:b}):(a.mix(k,b),void(b.dynamic&&f.src||k.activate()))};f.id=f.id||a.guid(g),d.instances[f.id]=k,f.src&&(f.params.allowscriptaccess="always",f.params.flashvars=a.merge(f.params.flashvars,{jsEntry:i,swfID:f.id})),j?k.__args=[l,f,m]:a.later(b.add,h,!1,b,[l,f,m])}var e="#",f="1.0.15",g="ks-ajb-",h=100,i="KISSY.AJBridge.eventHandler";return a.mix(d,{version:f,instances:{},eventHandler:function(a,b){var c=d.instances[a];c&&c.__eventHandler(a,b)},augment:function(b,c){a.isString(c)&&(c=[c]),a.isArray(c)&&a.each(c,function(c){b.prototype[c]=function(){try{return this.callSWF(c,a.makeArray(arguments))}catch(b){this.fire("error",{message:b})}}})}}),a.augment(d,c.Target,{init:function(){this.__args&&(b.add.apply(b,this.__args),this.__args=null,delete this.__args)},__eventHandler:function(b,c){var d=this,e=c.type;switch(c.id=b,e){case"log":a.log(c.message);break;default:d.fire(e,c)}},callSWF:function(a,b){var c=this;b=b||[];try{if(c.swf[a])return c.swf[a].apply(c.swf,b)}catch(d){var e="";return 0!==b.length&&(e="'"+b.join("','")+"'"),new Function("self","return self.swf."+a+"("+e+");")(c)}}}),d.augment(d,["activate","getReady","getCoreVersion"]),window.AJBridge=a.AJBridge=d,d},{requires:["kg/flash/2.0.0/index","event"]}),KISSY.add("kg/uploader/3.0.3/plugins/ajbridge/uploader",function(a,b,c){function d(b,c){c=c||{};var e={};a.each(["ds","dsp","btn","hand"],function(a){a in c&&(e[a]=c[a])}),c.params=c.params||{},c.params.flashvars=a.merge(c.params.flashvars,e),d.superclass.constructor.call(this,b,c)}return a.extend(d,c),c.augment(d,["setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]),d.version="1.0.1",c.Uploader=d,c.Uploader},{requires:["kg/flash/2.0.0/index","./ajbridge"]}),KISSY.add("kg/uploader/3.0.3/button/swfButton",function(a,b,c,d){function e(b,c){var d=this;c=a.merge({target:g(b)},c),e.superclass.constructor.call(d,c)}var f="",g=b.all,h="swf-uploader-wrapper-";return a.mix(e,{event:{RENDER:"render",CHANGE:"change",MOUSE_OVER:"mouseOver",MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",MOUSE_OUT:"mouseOut",CLICK:"click"}}),a.extend(e,c,{render:function(){var a,b=this,c=b.get("target"),d=b.get("multiple"),f=b.get("fileFilters");c.css("position","relative"),b.set("swfWrapper",b._createSwfWrapper()),b._setFlashSizeConfig(),a=b._initSwfUploader(),a.on("contentReady",function(){a.isContent||(a.isContent=!0,a.browse(d,f),b._bindBtnEvent(),a.on("fileSelect",b._changeHandler,b),b._setDisabled(b.get("disabled")),b.fire(e.event.RENDER))},b);var g=b.get("srcFileInput");return g&&g.length&&g.remove(),b},_createSwfWrapper:function(){var b=this,c=b.get("target"),d=b.get("tpl"),e=b.get("swfWrapperId")!=f&&b.get("swfWrapperId")||h+a.guid(),i=a.substitute(d,{id:e});return b.set("swfWrapperId",e),g(i).appendTo(c)},_initSwfUploader:function(){var b,c=this,e=c.get("flash"),f=c.get("swfWrapperId");a.mix(e,{id:"swfUploader"+a.guid()});try{b=new d(f,e),c.set("swfUploader",b)}catch(g){}return b},_bindBtnEvent:function(){var b=this,c=e.event,d=b.get("swfUploader");return d?(a.each(c,function(a){d.on(a,function(){b.fire(a)},b)}),b):!1},_setFlashSizeConfig:function(){var b=this,c=b.get("flash"),d=(b.get("target"),b.get("size"));a.isEmptyObject(d)||a.mix(c.attrs,d),b.set("flash",c)},_changeHandler:function(a){var b=this;if(b.get("swfUploader").id==a.id){var c=a.fileList;b.fire(e.event.CHANGE,{files:c})}},_setDisabled:function(b){var c=this,d=c.get("swfUploader"),e=c.get("cls"),f=e.disabled,g=c.get("target"),h=c.get("swfWrapper");return d&&a.isBoolean(b)?(b?(g.addClass(f),h.css("top","-3000px")):(g.removeClass(f),h.css("top",0)),b):!1},show:function(){var a=this,b=a.get("target");b.show()},hide:function(){var a=this,b=a.get("target");b.hide()}},{ATTRS:{target:{value:f},swfWrapper:{value:f},swfWrapperId:{value:f},tpl:{value:'<div id="{id}" class="uploader-button-swf" style="position: absolute;top:0;left:0;z-index:2000;"></div>'},multiple:{value:!0,setter:function(a){var b=this,c=b.get("swfUploader");return c&&c.multifile(a),a}},fileFilters:{value:[],setter:function(b){var c=this,d=c.get("swfUploader");return a.isObject(b)&&(b=[b]),d&&a.isArray(b)&&a.later(function(){d.filter(b)},800),b}},disabled:{value:!1,setter:function(a){var b=this,c=b.get("swfUploader");return c&&b._setDisabled(a),a}},cls:{value:{disabled:"uploader-button-disabled"}},size:{value:{}},flash:{value:{src:"//g.tbcdn.cn/kg/uploader/2.0.0/plugins/ajbridge/uploader.swf",id:"swfUploader",params:{bgcolor:"#fff",wmode:"transparent"},attrs:{width:400,height:400},hand:!0,btn:!0}},swfUploader:{value:f},srcFileInput:{value:f}}}),e},{requires:["node","base","../plugins/ajbridge/uploader"]}),KISSY.add("kg/uploader/3.0.3/queue",function(a,b,c){function d(a){var b=-1;do a/=1024,b++;while(a>99);return Math.max(a,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]}function e(a){var b=this;e.superclass.constructor.call(b,a)}var f="",g=(b.all,"[uploader-queue]:");return a.mix(e,{event:{ADD:"add",ADD_FILES:"addFiles",REMOVE:"remove",CLEAR:"clear",FILE_STATUS:"statusChange",UPDATE_FILE:"updateFile"},status:{WAITING:"waiting",START:"start",PROGRESS:"progress",SUCCESS:"success",CANCEL:"cancel",ERROR:"error",RESTORE:"restore"},FILE_ID_PREFIX:"file-"}),a.extend(e,c,{add:function(b,c){var d=this,e={};if(b.length>0){e=[];var f=d.get("uploader"),g=d.get("files").length,h=f.get("max")>0;a.each(b,function(a,b){if(h){var c=f.get("max");c>=g+b+1&&e.push(d._addFile(a))}else e.push(d._addFile(a))})}else e=d._addFile(b);return c&&c.call(d),e},_addFile:function(b,c){if(!a.isObject(b))return a.log(g+"_addFile()\u53c2\u6570file\u4e0d\u5408\u6cd5\uff01"),!1;var d=this,f=d._setAddFileData(b),h=d.getFileIndex(f.id),i=d.get("fnAdd");return a.isFunction(i)&&(f=i(h,f)),d.fire(e.event.ADD,{index:h,file:f,uploader:d.get("uploader")}),c&&c.call(d,h,f),f},remove:function(b,c){var d,f=this,h=f.get("files");return a.isString(b)&&(b=f.getFileIndex(b)),d=h[b],a.isObject(d)?(h=a.filter(h,function(a,c){return c!==b}),f.set("files",h),f.fire(e.event.REMOVE,{index:b,file:d}),c&&c.call(f,b,d),d):(a.log(g+"remove()\u4e0d\u5b58\u5728index\u4e3a"+b+"\u7684\u6587\u4ef6\u6570\u636e"),!1)},clear:function(){function a(){return b=c.get("files"),b.length?void c.remove(0,function(){a()}):(c.fire(e.event.CLEAR),!1)}var b,c=this;a()},fileStatus:function(b,c,d){if(!a.isNumber(b))return!1;{var f,g=this,h=g.getFile(b);g.get("theme")}return h?(f=h.status,c?f==c?g:(g.updateFile(b,{status:c}),g.fire(e.event.FILE_STATUS,{index:b,status:c,args:d,file:h}),g):f):!1},getFile:function(b){var c,d=this,e=d.get("files");return a.isNumber(b)?c=e[b]:a.each(e,function(a){return a.id==b?(c=a,!0):void 0}),c},getFileIndex:function(b){var c=this,d=c.get("files"),e=-1;return a.each(d,function(a,c){return a.id==b?(e=c,!0):void 0}),e},updateFile:function(b,c){if(!a.isNumber(b))return!1;if(!a.isObject(c))return a.log(g+"updateFile()\u7684data\u53c2\u6570\u6709\u8bef\uff01"),!1;var d=this,f=d.get("files"),h=d.getFile(b);return h?(a.mix(h,c),f[b]=h,d.set("files",f),d.fire(e.event.UPDATE_FILE,{index:b,file:h}),h):!1},getIndexs:function(b){var c,d=this,e=d.get("files"),f=[];return e.length?(a.each(e,function(d,e){a.isObject(d)&&(c=d.status,c==b&&f.push(e))}),f):f},getFiles:function(b){var c=this,d=c.get("files"),e=[];return d.length?(a.each(d,function(a){a&&a.status==b&&e.push(a)}),e):[]},_setAddFileData:function(b){var c=this,f=c.get("files");return a.isObject(b)?(b.id||(b.id=a.guid(e.FILE_ID_PREFIX)),b.size&&(b.textSize=d(b.size)),b.status||(b.status="waiting"),f.push(b),b):(a.log(g+"_updateFileData()\u53c2\u6570file\u4e0d\u5408\u6cd5\uff01"),!1)}},{ATTRS:{fnAdd:{value:f},files:{value:[]},uploader:{value:f}}}),e},{requires:["node","base"]}),KISSY.add("kg/uploader/3.0.3/index",function(a,b,c,d,e,f,g,h,i,j,k){var l="[uploader]:",m="",n=b.all,o="text/uploader-files",p=c.extend({constructor:function(a,b){var c=this;p.superclass.constructor.call(c,b),c.set("target",a),c._init()},_init:function(){var b=this,c=b.get("target");if(!c.length)return a.log("\u76ee\u6807\u5143\u7d20\u4e0d\u5b58\u5728\uff01"),!1;var d=b.get("type"),e=b.getUploadType(d);return b._replaceBtn(),b._renderButton(),b._renderQueue(),b._renderUploaderCore(e),b},_replaceBtn:function(){var b=this,c=b.get("target");if(!c.length)return!1;var d=c[0].defaultValue||b.get("text"),e=a.substitute(b.get("btnTpl"),{text:d}),f=n(e).insertAfter(c);return!b.get("name")&&c.attr("name")&&b.set("name",c.attr("name")),b.set("_oldInput",c.clone()),b.set("fileInput",c),b.set("target",f),f},upload:function(b){if(!a.isNumber(b))return!1;var c,d=this,e=d.get("uploadType"),f=d.get("type"),g=d.get("queue"),h=g.get("files")[b];return a.isObject(h)?d.get("curUploadIndex")!=m?(alert("\u7b2c"+d.get("curUploadIndex")+"\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\uff0c\u8bf7\u4e0a\u4f20\u5b8c\u540e\u518d\u64cd\u4f5c\uff01"),!1):(c=h.input,"flash"==f&&(c=h.input.id),"ajax"==f&&(c=h.data),"error"===h.status?!1:d.get("isAllowUpload")?(d.set("curUploadIndex",b),d.fire(p.event.START,{index:b,file:h}),g.fileStatus(b,p.status.START),void e.upload(c)):!1):(a.log(l+"\u961f\u5217\u4e2d\u7d22\u5f15\u503c\u4e3a"+b+"\u7684\u6587\u4ef6"),!1)},cancel:function(b){var c=this,d=c.get("uploadType"),e=c.get("queue"),f=p.status,g=e.fileStatus(b);return a.isNumber(b)&&g!=f.SUCCESS?(d.stop(),e.fileStatus(b,f.CANCEL)):(d.stop(),c._continueUpload()),c},stop:function(){var a=this;return a.set("uploadFilesStatus",m),a.cancel(),a},uploadFiles:function(b){var c=this;return a.isString(b)||(b=p.status.WAITING),c.set("uploadFilesStatus",b),c._uploaderStatusFile(b),c},_uploaderStatusFile:function(a){var b=this,c=b.get("queue"),d=c.getIndexs(a);return d.length?(b.upload(d[0]),b):(b.set("uploadFilesStatus",m),b.fire(p.event.UPLOAD_FILES),!1)},isSupportAjax:function(){var a=!1;try{FormData&&(a=!0)}catch(b){a=!1}return a},isSupportFlash:function(){var b=a.UA.fpv();return a.isArray(b)&&b.length>0},_renderUploaderCore:function(b){{var c=this;c.get("type")}if(!b)return!1;var d={action:c.get("action"),data:c.get("data"),dataType:"json"},e=c.get("button");c.get("type")==p.type.FLASH&&a.mix(d,{swfUploader:e.get("swfUploader")}),d.fileDataName=c.get("name"),d.CORS=c.get("CORS"),d.filter=c.get("filter");var f=new b(d),g=b.event;return f.on(g.SUCCESS,c._uploadCompleteHandler,c),f.on(g.ERROR,c._uploadCompleteHandler,c),g.PROGRESS&&f.on(g.PROGRESS,c._uploadProgressHandler,c),f.on(g.STOP,c._uploadStopHanlder,c),c.set("uploadType",f),f},getUploadType:function(b){var c,d=this,e=p.type;return b==e.AUTO&&(b=[e.AJAX,e.IFRAME]),a.isArray(b)&&b.length>0?a.each(b,function(a){return c=d._getType(a),c?!1:void 0}):c=d._getType(b),c},_getType:function(b){var c,d=this,e=p.type,i=d.isSupportAjax(),j=d.isSupportFlash();switch(b){case e.IFRAME:c=f;break;case e.AJAX:c=i&&g||!1;break;case e.FLASH:c=j&&h||!1;break;default:return a.log(l+"type\u53c2\u6570\u4e0d\u5408\u6cd5"),!1}return c&&a.log(l+"\u4f7f\u7528"+b+"\u4e0a\u4f20\u65b9\u5f0f"),d.set("type",b),c},_renderButton:function(){var b,c,d=this,f=d.get("type"),g=d.get("target"),h=d.get("multiple"),k=d.get("disabled"),l=d.get("name"),m={name:l,multiple:h,disabled:k,srcFileInput:d.get("fileInput")};return f==p.type.FLASH?(c=j,a.mix(m,{size:d.get("swfSize")})):c=i,b=new c(g,m),b.on("change",d._select,d),b.render(),d.set("button",b),f==p.type.IFRAME&&e.ie<10&&d.set("multiple",!1),b},_renderQueue:function(){var a=this,b=new k;return b.set("uploader",a),b.on("add",function(b){a.fire(p.event.ADD,b)}),b.on("remove",function(b){a.fire(p.event.REMOVE,b)}),a.set("queue",b),b},_select:function(b){var c=this,d=c.get("queue"),e=c.get("curUploadIndex"),f=b.files;return a.each(f,function(a){a.size||(a.size=0),a.name||(a.name=a.fileName||m),a.input=b.input||a}),f=c._processExceedMultiple(f),c.fire(p.event.SELECT,{files:f}),c.get("isAllowUpload")?void d.add(f,function(){e==m&&c.get("autoUpload")&&c.uploadFiles()}):!1},_processExceedMultiple:function(b){var c=this,d=c.get("multipleLen");return 0>d||!a.isArray(b)||!b.length?b:a.filter(b,function(a,b){return d>b})},_uploadCompleteHandler:function(b){var c,d=this,e=b.result,f=p.event,g=d.get("queue"),h=d.get("curUploadIndex");if(!a.isObject(e))return!1;if(g.updateFile(h,{result:e}),c=Number(e.status),1===c)g.fileStatus(h,p.status.SUCCESS),d._success(e.data),d.fire(f.SUCCESS,{index:h,file:g.getFile(h),result:e});else{var i=e.msg||e.message||m;e.msg=i,g.fileStatus(h,p.status.ERROR,{msg:i,result:e}),d.fire(f.ERROR,{msg:i,status:c,result:e,index:h,file:g.getFile(h)})}d.set("curUploadIndex",m),d.fire(f.COMPLETE,{index:h,file:g.getFile(h),result:e}),d._continueUpload()},_uploadStopHanlder:function(){var a=this,b=a.get("queue"),c=a.get("curUploadIndex");b.fileStatus(c,p.status.CANCEL),a.set("curUploadIndex",m),a.fire(p.event.CANCEL,{index:c})},_continueUpload:function(){var a=this,b=a.get("uploadFilesStatus");b!=m&&a._uploaderStatusFile(b)},_uploadProgressHandler:function(b){var c=this,d=c.get("queue"),e=c.get("curUploadIndex"),f=d.getFile(e);a.mix(b,{file:f}),d.fileStatus(e,p.status.PROGRESS,b),c.fire(p.event.PROGRESS,b)},_success:function(b){if(!a.isObject(b))return!1;var c=this,d=b.url,e=c.get("curUploadIndex"),f=c.get("queue");return a.isString(d)?void f.updateFile(e,{sUrl:d}):!1},theme:function(b){var c=this,d=c.get("theme");return b?d?(a.log("\u4e0d\u652f\u6301\u91cd\u65b0\u6e32\u67d3\u4e3b\u9898\uff01"),c):(b.set("uploader",c),b.set("queue",c.get("queue")),b.render&&b.render(),c.fire("themeRender",{theme:d,uploader:c}),c.set("theme",b),c):!1},restore:function(b){var c,e=this;if(e.set("hasRestore",!0),b){var f=n(b);if(!f.length)return a.log("restore()\uff1a\u4e0d\u5b58\u5728target\uff01"),!1;c=f.text()}else{var g=e.get("theme");if(!g)return!1;var h=g.get("queueTarget");if(!h||!h.length)return!1;var i=h.all("script");i.each(function(a){a.attr("type")==o&&(c=a.html())})}if(c=d.parse(c),!c.length)return!1;var j,k=e.get("queue");a.each(c,function(a){a.status=1,j={type:"restore",name:a.name||"",url:a.url||"",result:a};var b=k.add(j),c=b.id,d=k.getFileIndex(c);k.fileStatus(d,"success",{index:d,id:c,file:b}),e.fire("success",{file:b,result:b.result})})}},{ATTRS:{target:{value:m,getter:function(a){return n(a)}},text:{value:"\u4e0a\u4f20\u6587\u4ef6"},fileInput:{value:m},theme:{value:m},btnTpl:{value:'<a href="javascript:void(0)" class="g-u ks-uploader-button"><span class="btn-text">{text}</span></a>'},button:{value:{}},queue:{value:{}},type:{value:"auto"},multiple:{value:!1,setter:function(b){var c=this,d=c.get("button");return!a.isEmptyObject(d)&&a.isBoolean(b)&&d.set("multiple",b),b}},multipleLen:{value:-1},disabled:{value:!1,setter:function(b){var c=this,d=c.get("button");return!a.isEmptyObject(d)&&a.isBoolean(b)&&d.set("disabled",b),b}},action:{value:m,setter:function(b){var c=this,d=c.get("uploadType");return d&&!a.isEmptyObject(d)&&d.set("action",b),b}},data:{value:{},setter:function(b){if(a.isObject(b)){var c=this,d=c.get("uploadType");d&&!a.isEmptyObject(d)&&d.set("data",b)}return b}},isAllowUpload:{value:!0},autoUpload:{value:!0},filter:{value:m,setter:function(b){var c=this,d=c.get("uploadType");return d&&!a.isEmptyObject(d)&&d.set("filter",b),b}},curUploadIndex:{value:m},uploadType:{value:m},swfSize:{value:{}},hasRestore:{value:!1},button:{value:{}},queue:{value:{}},curUploadIndex:{value:m},curFile:{value:m,getter:function(){var b=this,c=m,d=b.get("curUploadIndex");if(a.isNumber(d)){var e=b.get("queue");c=e.getFile(d)}return c}},uploadType:{value:{}},fileInput:{value:m},uploadFilesStatus:{value:m},swfSize:{value:{}},CORS:{value:!1},timeout:{value:600,setter:function(b){var c=this,d=c.get("uploadType");return d&&!a.isEmptyObject(d)&&d.set("timeout",b),b}}}},"Uploader");return a.mix(p,{type:{AUTO:"auto",IFRAME:"iframe",AJAX:"ajax",FLASH:"flash"},event:{SELECT:"select",ADD:"add",START:"start",PROGRESS:"progress",COMPLETE:"complete",SUCCESS:"success",UPLOAD_FILES:"uploadFiles",CANCEL:"cancel",ERROR:"error",REMOVE:"remove",RESTORE:"restore"},status:{WAITING:"waiting",START:"start",PROGRESS:"progress",SUCCESS:"success",CANCEL:"cancel",ERROR:"error"}}),p},{requires:["node","rich-base","json","ua","./type/iframe","./type/ajax","./type/flash","./button/base","./button/swfButton","./queue"]});/*!build time : 2015-04-30 4:19:57 PM*/
KISSY.add("kg/uploader/3.0.3/plugins/auth/auth",function(a,b,c){function d(a){var b=-1;do a/=1024,b++;while(a>99);return Math.max(a,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]}function e(a){var b=this;e.superclass.constructor.call(b,a)}var f="",g=b.all,h="error";return a.extend(e,c,{pluginInitializer:function(a){if(!a)return!1;var b=this;b.set("uploader",a),b._useThemeConfig();var c=a.get("queue");b._setSwfButtonExt(),c.on("add",function(a){var c=a.file;if("restore"==c.type)return!0;var d=b.testAllowExt(c);d&&(d=b.testMaxSize(c)),d&&b.testRepeat(c),d&&b.testWidthHeight(c)}),c.on("remove",function(a){var c=a.file,d=c.status;"success"==d&&b.testMax()&&b.testRequired()}),a.on("success",function(){b.testMax()}),a.on("error",function(c){-1===c.status&&"max"==c.rule&&b._maxStopUpload(),a.set("isAllowUpload",!0)})},_useThemeConfig:function(){var b=this,c=b.get("msg");if(!a.isEmptyObject(c))return!1;var d=b.get("uploader"),e=d.get("theme");if(!e)return!1;var c=e.get("authMsg");c&&b.set("msg",c);var f=b.get("allowExts");return f||b.set("allowExts",e.get("allowExts")),b},setAllowExts:function(b){if(!a.isString(b))return!1;var c=[],d=[];return b=b.split(","),a.each(b,function(a){c.push("*."+a),d.push(a.toUpperCase())}),c=c.join(";"),d=d.join(","),{desc:d,ext:c}},testAll:function(){var a=this;return a.testRequire()&&a.testMax()},isUploaderType:function(a){var b=this,c=b.get("uploader"),d=c.get("type");return a==d},testRequired:function(){var a=this,b=a.get("uploader"),c=b.get("queue"),d=c.getFiles("success");return d.length>0},testAllowExt:function(b){function c(b,c){var d,e=!1,f=c.toLowerCase();return a.each(b,function(a){return d=new RegExp("^.+."+a+"$"),d.test(f)?e=!0:void 0}),e}function d(a){var b=a.split(".");return b[b.length-1]}if(!a.isObject(b))return!1;var e=this,f=b.name,g=e.get("allowExts");if(!g)return!0;var h=g.split(","),i=c(h,f);if(!i){var j=d(f),k=e.msg("allowExts");k=a.substitute(k,{ext:j}),e._fireUploaderError("allowExts",[g,k],b)}return i},testMax:function(){var b=this,c=b.get("max");if(c==f)return!0;var d=b.get("uploader"),e=d.get("queue"),g=e.getFiles("success"),h=g.length,i=c>h;if(i)d.set("disabled",!1),d.set("isAllowUpload",!0);else{d.set("disabled",!0),d.set("isAllowUpload",!1);var j=b.msg("max");j=a.substitute(j,{max:c}),b._fireUploaderError("max",[c,j])}return i},testMaxSize:function(b){var c=this,e=b.size,g=c.get("maxSize");if(g==f||!e)return!0;c.get("uploader");g=1024*g;var h=g>=e;if(!h){var i=c.msg("maxSize");i=a.substitute(i,{maxSize:d(g),size:b.textSize}),c._fireUploaderError("maxSize",[g,i],b)}return h},testRepeat:function(b){if(!a.isObject(b))return!1;var c=this,d=b.name,e=c.get("allowRepeat");if(e===f)return!1;var g=c.get("uploader"),h=g.get("queue"),i=h.getFiles("success"),j=!1;return a.each(i,function(a){return a.name==d?(a.size?a.size==b.size&&c._fireUploaderError("allowRepeat",[e,c.msg("allowRepeat")],b):c._fireUploaderError("allowRepeat",[e,c.msg("allowRepeat")],b),j=!0):void 0}),j},testWidthHeight:function(b){function c(a,c){var f=e.call(d,a,c);if(f){h.set("isAllowUpload",!0);var g=h.get("queue").getFileIndex(b.id);h.upload(g)}else{var i=d.msg("widthHeight");d._fireUploaderError("widthHeight",[e,i],b)}}var d=this,e=d.get("widthHeight");if(e===f)return!0;var h=d.get("uploader");h.set("isAllowUpload",!1);var i=b.data;if(a.isEmptyObject(i)){var j=h.get("target").all("input").getDOMNode();j.select(),j.blur();var k=document.selection.createRange().text,l=g('<img style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image);width:300px;visibility:hidden;"  />').appendTo("body").getDOMNode();l.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=k;var m=l.offsetWidth,n=l.offsetHeight;c(m,n),g(l).remove()}else{var o=new FileReader;o.onload=function(a){var b=a.target.result,d=new Image;d.onload=function(){var a=d.width,b=d.height;c(a,b)},d.src=b},o.readAsDataURL(i)}},_setSwfButtonExt:function(){var a=this,b=a.get("uploader"),c=a.get("allowExts"),d=b.get("button"),e=a.isUploaderType("flash");return e&&c!==f?(c=a.setAllowExts(c),d&&d.set("fileFilters",c[0]),a):!1},_getExts:function(b){if(!a.isString(b))return!1;var c=b.split(";"),d=[],e=/^\*\./;return a.each(c,function(a){a=a.replace(e,""),d.push(a.toUpperCase())}),a.each(d,function(a){c.push(a)}),c},_fireUploaderError:function(b,c,d){var e=this,f=e.get("uploader"),g=f.get("queue"),i={status:-1,rule:b},j=-1;d&&(j=g.getFileIndex(d.id),a.mix(i,{file:d,index:j})),c&&a.mix(i,{msg:c[1],value:c[0],result:{}}),g.fileStatus(j,"error",i),e.fire(h,i),f.fire("error",i)},_maxStopUpload:function(){var b=this,c=b.get("uploader"),d=c.get("queue"),e=b.get("max"),g=c.get("curUploadIndex");if(g==f||e>g)return!1;var h=d.get("files"),i=d.getFiles("success");i.length>e&&c.stop(),a.each(h,function(a,b){b>g&&d.remove(a.id)}),c.set("curUploadIndex",f)},msg:function(b,c){var d=this;if(!a.isString(b))return d;var e=d.get("msg");return a.isString(c)?(e[b]=c,c):e[b]},_processRuleConfig:function(b,c){var d=this;return a.isString(b)?(a.isArray(c)&&d.msg(b,c[1]),d):d}},{ATTRS:{pluginId:{value:"auth"},uploader:{value:f},required:{value:f},max:{value:f},allowExts:{value:f},maxSize:{value:f},allowRepeat:{value:f},widthHeight:{value:f},msg:{value:{}}}}),e},{requires:["node","base"]});/*!build time : 2015-04-30 4:19:57 PM*/
KISSY.add("kg/uploader/3.0.3/plugins/filedrop/filedrop",function(a,b,c){var d="",e=b.all,f=a.UA,g=function(a){var b=this;g.superclass.constructor.call(b,a),b.set("mode",h())},h=function(){return f.webkit>=7||f.firefox>=3.6?"supportDrop":f.ie?"notSupportDropIe":f.webkit<7||f.firefox<3.6?"notSupportDrop":void 0};return a.mix(g,{event:{AFTER_DROP:"afterdrop"}}),a.extend(g,c,{pluginInitializer:function(b){var c,d=this,e=d.get("mode");if(!b)return!1;if(d.set("uploader",b),"flash"==b.get("type"))return a.log("flash\u4e0a\u4f20\u65b9\u5f0f\u4e0d\u652f\u6301\u62d6\u62fd\uff01"),d.set("isSupport",!1),!1;if("supportDrop"!=e)return a.log("\u8be5\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u62d6\u62fd\u4e0a\u4f20\uff01"),d.set("isSupport",!1),!1;var f=b.get("target");d.set("target",f),c=d._createDropArea(),c.on("click",d._clickHandler,d),b.on("afterDisabledChange",function(a){d[a.newVal&&"hide"||"show"]()}),d.fire("render",{buttonTarget:d.get("buttonWrap")})},show:function(){var a=this,b=a.get("dropContainer");b.show()},hide:function(){var a=this,b=a.get("dropContainer");b.hide()},_createDropArea:function(){var b=this,c=e(b.get("target")),d=b.get("mode"),f=a.substitute(b.get("tpl")[d],{name:b.get("name")}),g=e(f),h=g.all(".J_ButtonWrap");return g.appendTo(c),g.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),g.on("drop",function(a){a.stopPropagation(),a.preventDefault(),b._dropHandler(a)}),b.set("dropContainer",g),b.set("buttonWrap",h),b._setStyle(),g},_setStyle:function(){var a=this,b=a.get("dropContainer");return b.length?(b.parent().css("position","relative"),void b.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"1000"})):!1},_clickHandler:function(){var a=this,b=a.get("uploader"),c=b.get("button"),d=c.get("fileInput");d.fire("click")},_dropHandler:function(b){var c=this,e=g.event,f=b.originalEvent.dataTransfer.files,h=[],i=c.get("uploader");return f.length&&i!=d?(a.each(f,function(b){a.isObject(b)&&h.push({name:b.name,type:b.type,size:b.size,data:b})}),c.fire(e.AFTER_DROP,{files:h}),void i._select({files:h})):!1}},{ATTRS:{pluginId:{value:"filedrop"},target:{value:d,getter:function(a){return e(a)}},uploader:{value:d},dropContainer:{value:d},isSupport:{value:!0},tpl:{value:{supportDrop:'<div class="drop-wrapper"></div>',notSupportDropIe:'<div class="drop-wrapper"><p>\u60a8\u7684\u6d4f\u89c8\u5668\u53ea\u652f\u6301\u4f20\u7edf\u7684\u56fe\u7247\u4e0a\u4f20\uff0c</p><p class="suggest J_ButtonWrap">\u63a8\u8350\u4f7f\u7528chrome\u6d4f\u89c8\u5668\u6216firefox\u6d4f\u89c8\u5668</p></div>',notSupportDrop:'<div class="drop-wrapper"><p>\u60a8\u7684\u6d4f\u89c8\u5668\u53ea\u652f\u6301\u4f20\u7edf\u7684\u56fe\u7247\u4e0a\u4f20\uff0c</p><p class="suggest J_ButtonWrap">\u63a8\u8350\u5347\u7ea7\u60a8\u7684\u6d4f\u89c8\u5668</p></div>'}},name:{value:""}}}),g},{requires:["node","base"]});KISSY.add("kg/search-suggest/6.0.17/mods/stat",["base","cookie","event","kg/search-suggest/6.0.17/mods/local-query"],function(e,t,a,n){function s(e){s.superclass.constructor.call(this,e||{})}var i=t("base"),r=(t("cookie"),t("event")),c=t("kg/search-suggest/6.0.17/mods/local-query");KISSY.extend(s,i,{pluginInitializer:function(e){var t=this,a=t.get("stat");t.set("caller",e),e.on("beforeSubmit",function(e){var a=e.isInitSearch;t.setStat(a)}),a&&(t.sendTongji(),t.bindSearchTrace())},bindSearchTrace:function(){var e=this;r.delegate("body","click","a",e.initSearchTrace,e)},initSearchTrace:function(e){var t=this,a=e.currentTarget,n=a.getAttribute("trace"),s=a.getAttribute("href");if(n)switch(n){case"relatedSearch":t.saveQuery();break;case"auction":var i=t.stat;i&&-1===s.indexOf("initiative_new")&&a.setAttribute("href",s+"&initiative_new=1")}},sendTongji:function(){var e,t=this,a=t.getStatInst();a.checkFlash({onSuccess:function(){e=a.query("stat")[0],e&&e.value&&(t.stat=e.value,t.send("f_stats_show="+e.value,!0))}})},setStat:function(e,t){var a=this,n=a.get("caller"),s=n.query,i=a.saveQuery(s,e);i&&a.send("lf_aclog=null-null-null-null-0&stats_click="+i,t)},getStatInst:function(){var e=this,t=e.get("caller"),a=t.get("sugConfig"),n=a.tab||"",s=new c({name:"stat",tab:n});return s},saveQuery:function(e,t){var a,n,s=this.getStatInst();return t&&e?(a=encodeURIComponent(e),n="initiative_new:1;q:"+a,s.save("stat",n)):s.deleteItem("stat"),n},send:function(e,t){var a,n,s=this.get("logTypes");t?(s=this.get("tongjiKey"),a=s.logkey,n=s.chksum):(s=this.get("pvKey"),a=s.logkey,n=s.chksum),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[a,"",e,n]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"},tongjiKey:{value:{logkey:"/tongji",chksum:"H51884970"}},pvKey:{value:{logkey:"/search",chksum:"H51884969"}}}}),n.exports=s});/*!build time : 2015-04-30 4:19:57 PM*/
KISSY.add("kg/uploader/3.0.3/theme",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a)}var e="",f=b.all,g={BUTTON:"-button",QUEUE:"-queue"},h="text/uploader-theme";return a.extend(d,c,{render:function(){var a=this,b=a.get("uploader");b.set("theme",a),a._addThemeCssName(),a._tplFormHtml(),a._bind()},_selectHandler:function(){},_addHandler:function(){},_removeHandler:function(){},_waitingHandler:function(){},_startHandler:function(){},_progressHandler:function(){},_successHandler:function(){},_errorHandler:function(){},_restore:function(){var b=this,c=b.get("uploader"),d=c.getPlugin("urlsInput");if(!d)return!1;var e=d.get("autoRestore");if(!e)return!1;var f=c.get("queue"),g=f.get("files");return g.length?(a.each(g,function(a,d){a.status="success",c.fire("add",{file:a,index:d}),b._renderHandler("_successHandler",{file:a,result:a.result}),b._hideStatusDiv(a)}),b):!1},_addThemeCssName:function(){var b=this,c=b.get("name"),d=b.get("queueTarget"),f=b.get("uploader"),h=f.get("target");return d.length?c==e?!1:(d.length&&d.addClass("ks-uploader-queue "+c+g.QUEUE),h.addClass(c+g.BUTTON),b):(a.log("\u4e0d\u5b58\u5728\u5bb9\u5668\u76ee\u6807\uff01"),!1)},_bind:function(){var b=this,c=b.get("uploader"),d=["add","remove","select","start","progress","success","error","complete"];c.on(d[0],function(a){var d=b._appendFileDom(a.file),e=c.get("queue");e.updateFile(a.index,{target:d})}),c.on(d[1],function(a){b._removeFileDom(a.file)}),a.each(d,function(a){c.on(a,function(a){var c="_"+a.type+"Handler";b._renderHandler(c,a)})})},_renderHandler:function(a,b){var c=this,d=c[a];c._setStatusVisibility(b.file),d&&d.call(c,b)},_setStatusVisibility:function(b){var c=this;if(!a.isObject(b)||a.isEmptyObject(b))return c;c._hideStatusDiv(b);var d=b.status,e=b.target;if(!e.length)return!1;var f=e.all("."+d+"-status");f.length&&f.show();var g=["waiting","start","uploading","progress","error","success"];return a.each(g,function(a){e.removeClass(a)}),e.addClass(d),c},_hideStatusDiv:function(b){if(!a.isObject(b))return!1;var c=b.target;c&&c.length&&c.all(".status").hide()},_appendFileDom:function(b){var c,d=this,e=d.get("fileTpl"),g=f(d.get("queueTarget"));return g.length?(c=a.substitute(e,b),f(c).hide().appendTo(g).fadeIn(.4).data("data-file",b)):!1},_removeFileDom:function(b){if(!a.isObject(b))return!1;var c=b.target;return c&&c.length?void c.fadeOut(.4,function(){c.remove()}):!1},_tplFormHtml:function(){var a=this,b=a.get("fileTpl"),c=f(a.get("queueTarget")),d=!1;if(!c.length)return!1;var e=c.all("script");return e.each(function(c){c.attr("type")==h&&(d=!0,b=c.html(),a.set("fileTpl",b))}),b}},{ATTRS:{name:{value:e},use:{value:e},fileTpl:{value:e},authMsg:{value:{}},queueTarget:{value:e,getter:function(a){return f(a)}},queue:{value:e},uploader:{value:e}}}),d},{requires:["node","base"]});