function q(t){"use strict";throw t}function y(t,e,n){4!==e.length&&q(new sjcl.exception.invalid("invalid aes block size"));var i=t.a[n],r=e[0]^i[0],o=e[n?3:1]^i[1],s=e[2]^i[2];e=e[n?1:3]^i[3];var c,a,l,h,p=i.length/4-2,u=4,m=[0,0,0,0];c=t.j[n],t=c[0];var d=c[1],f=c[2],g=c[3],y=c[4];for(h=0;p>h;h++)c=t[r>>>24]^d[o>>16&255]^f[s>>8&255]^g[255&e]^i[u],a=t[o>>>24]^d[s>>16&255]^f[e>>8&255]^g[255&r]^i[u+1],l=t[s>>>24]^d[e>>16&255]^f[r>>8&255]^g[255&o]^i[u+2],e=t[e>>>24]^d[r>>16&255]^f[o>>8&255]^g[255&s]^i[u+3],u+=4,r=c,o=a,s=l;for(h=0;4>h;h++)m[n?3&-h:h]=y[r>>>24]<<24^y[o>>16&255]<<16^y[s>>8&255]<<8^y[255&e]^i[u++],c=r,r=o,o=s,s=e,e=c;return m}function z(t,e){var n,i,r,o=e.slice(0),s=t.q,c=t.a,a=s[0],l=s[1],h=s[2],p=s[3],u=s[4],m=s[5],d=s[6],f=s[7];for(n=0;64>n;n++)16>n?i=o[n]:(i=o[n+1&15],r=o[n+14&15],i=o[15&n]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+o[15&n]+o[n+9&15]|0),i=i+f+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(d^u&(m^d))+c[n],f=d,d=m,m=u,u=p+i|0,p=h,h=l,l=a,a=i+(l&h^p&(l^h))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+a|0,s[1]=s[1]+l|0,s[2]=s[2]+h|0,s[3]=s[3]+p|0,s[4]=s[4]+u|0,s[5]=s[5]+m|0,s[6]=s[6]+d|0,s[7]=s[7]+f|0}function C(t,e){var n,i=sjcl.random.z[t],r=[];for(n in i)i.hasOwnProperty(n)&&r.push(i[n]);for(n=0;n<r.length;n++)r[n](e)}function A(t){t.a=B(t).concat(B(t)),t.A=new sjcl.cipher.aes(t.a)}function B(t){for(var e=0;4>e&&(t.e[e]=t.e[e]+1|0,!t.e[e]);e++);return t.A.encrypt(t.e)}var t=void 0,u=!1,sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),sjcl.cipher.aes=function(t){this.j[0][0][0]||this.D();var e,n,i,r,o=this.j[0][4],s=this.j[1];e=t.length;var c=1;for(4!==e&&6!==e&&8!==e&&q(new sjcl.exception.invalid("invalid aes key size")),this.a=[i=t.slice(0),r=[]],t=e;4*e+28>t;t++)n=i[t-1],(0===t%e||8===e&&4===t%e)&&(n=o[n>>>24]<<24^o[n>>16&255]<<16^o[n>>8&255]<<8^o[255&n],0===t%e&&(n=n<<8^n>>>24^c<<24,c=c<<1^283*(c>>7))),i[t]=i[t-e]^n;for(e=0;t;e++,t--)n=i[3&e?t:t-4],r[e]=4>=t||4>e?n:s[0][o[n>>>24]]^s[1][o[n>>16&255]]^s[2][o[n>>8&255]]^s[3][o[255&n]]},sjcl.cipher.aes.prototype={encrypt:function(t){return y(this,t,0)},decrypt:function(t){return y(this,t,1)},j:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var t,e,n,i,r,o,s,c=this.j[0],a=this.j[1],l=c[4],h=a[4],p=[],u=[];for(t=0;256>t;t++)u[(p[t]=t<<1^283*(t>>7))^t]=t;for(e=n=0;!l[e];e^=i||1,n=u[n]||1)for(o=n^n<<1^n<<2^n<<3^n<<4,o=o>>8^255&o^99,l[e]=o,h[o]=e,r=p[t=p[i=p[e]]],s=16843009*r^65537*t^257*i^16843008*e,r=257*p[o]^16843008*o,t=0;4>t;t++)c[t][e]=r=r<<24^r>>>8,a[t][o]=s=s<<24^s>>>8;for(t=0;5>t;t++)c[t]=c[t].slice(0),a[t]=a[t].slice(0)}},sjcl.bitArray={bitSlice:function(e,n,i){return e=sjcl.bitArray.O(e.slice(n/32),32-(31&n)).slice(1),i===t?e:sjcl.bitArray.clamp(e,i-n)},extract:function(t,e,n){var i=Math.floor(-e-n&31);return(-32&(e+n-1^e)?t[e/32|0]<<32-i^t[e/32+1|0]>>>i:t[e/32|0]>>>i)&(1<<n)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var n=t[t.length-1],i=sjcl.bitArray.getPartial(n);return 32===i?t.concat(e):sjcl.bitArray.O(e,i,0|n,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+sjcl.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var n=t.length;return e&=31,n>0&&e&&(t[n-1]=sjcl.bitArray.partial(e,t[n-1]&2147483648>>e-1,1)),t},partial:function(t,e,n){return 32===t?e:(n?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(sjcl.bitArray.bitLength(t)!==sjcl.bitArray.bitLength(e))return u;var n,i=0;for(n=0;n<t.length;n++)i|=t[n]^e[n];return 0===i},O:function(e,n,i,r){var o;for(o=0,r===t&&(r=[]);n>=32;n-=32)r.push(i),i=0;if(0===n)return r.concat(e);for(o=0;o<e.length;o++)r.push(i|e[o]>>>n),i=e[o]<<32-n;return o=e.length?e[e.length-1]:0,e=sjcl.bitArray.getPartial(o),r.push(sjcl.bitArray.partial(n+e&31,n+e>32?i:r.pop(),1)),r},k:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},sjcl.codec.utf8String={fromBits:function(t){var e,n,i="",r=sjcl.bitArray.bitLength(t);for(e=0;r/8>e;e++)0===(3&e)&&(n=t[e/4]),i+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(i))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,n=[],i=0;for(e=0;e<t.length;e++)i=i<<8|t.charCodeAt(e),3===(3&e)&&(n.push(i),i=0);return 3&e&&n.push(sjcl.bitArray.partial(8*(3&e),i)),n}},sjcl.codec.hex={fromBits:function(t){var e,n="";for(e=0;e<t.length;e++)n+=((0|t[e])+0xf00000000000).toString(16).substr(4);return n.substr(0,sjcl.bitArray.bitLength(t)/4)},toBits:function(t){var e,n,i=[];for(t=t.replace(/\s|0x/g,""),n=t.length,t+="00000000",e=0;e<t.length;e+=8)i.push(0^parseInt(t.substr(e,8),16));return sjcl.bitArray.clamp(i,4*n)}},sjcl.codec.base64={I:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,n){var i="",r=0,o=sjcl.codec.base64.I,s=0,c=sjcl.bitArray.bitLength(t);for(n&&(o=o.substr(0,62)+"-_"),n=0;6*i.length<c;)i+=o.charAt((s^t[n]>>>r)>>>26),6>r?(s=t[n]<<6-r,r+=26,n++):(s<<=6,r-=6);for(;3&i.length&&!e;)i+="=";return i},toBits:function(t,e){t=t.replace(/\s|=/g,"");var n,i,r=[],o=0,s=sjcl.codec.base64.I,c=0;for(e&&(s=s.substr(0,62)+"-_"),n=0;n<t.length;n++)i=s.indexOf(t.charAt(n)),0>i&&q(new sjcl.exception.invalid("this isn't base64!")),o>26?(o-=26,r.push(c^i>>>o),c=i<<32-o):(o+=6,c^=i<<32-o);return 56&o&&r.push(sjcl.bitArray.partial(56&o,c,1)),r}},sjcl.codec.base64url={fromBits:function(t){return sjcl.codec.base64.fromBits(t,1,1)},toBits:function(t){return sjcl.codec.base64.toBits(t,1)}},sjcl.hash.sha256=function(t){this.a[0]||this.D(),t?(this.q=t.q.slice(0),this.m=t.m.slice(0),this.g=t.g):this.reset()},sjcl.hash.sha256.hash=function(t){return(new sjcl.hash.sha256).update(t).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this.q=this.M.slice(0),this.m=[],this.g=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,n=this.m=sjcl.bitArray.concat(this.m,t);for(e=this.g,t=this.g=e+sjcl.bitArray.bitLength(t),e=512+e&-512;t>=e;e+=512)z(this,n.splice(0,16));return this},finalize:function(){var t,e=this.m,n=this.q,e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]);for(t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.g/4294967296)),e.push(0|this.g);e.length;)z(this,e.splice(0,16));return this.reset(),n},M:[],a:[],D:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,n=0,i=2;t:for(;64>n;i++){for(e=2;i>=e*e;e++)if(0===i%e)continue t;8>n&&(this.M[n]=t(Math.pow(i,.5))),this.a[n]=t(Math.pow(i,1/3)),n++}}},sjcl.mode.ccm={name:"ccm",encrypt:function(t,e,n,i,r){var o,s=e.slice(0),c=sjcl.bitArray,a=c.bitLength(n)/8,l=c.bitLength(s)/8;for(r=r||64,i=i||[],7>a&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),o=2;4>o&&l>>>8*o;o++);return 15-a>o&&(o=15-a),n=c.clamp(n,8*(15-o)),e=sjcl.mode.ccm.K(t,e,n,i,r,o),s=sjcl.mode.ccm.n(t,s,n,e,r,o),c.concat(s.data,s.tag)},decrypt:function(t,e,n,i,r){r=r||64,i=i||[];var o=sjcl.bitArray,s=o.bitLength(n)/8,c=o.bitLength(e),a=o.clamp(e,c-r),l=o.bitSlice(e,c-r),c=(c-r)/8;for(7>s&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),e=2;4>e&&c>>>8*e;e++);return 15-s>e&&(e=15-s),n=o.clamp(n,8*(15-e)),a=sjcl.mode.ccm.n(t,a,n,l,r,e),t=sjcl.mode.ccm.K(t,a.data,n,i,r,e),o.equal(a.tag,t)||q(new sjcl.exception.corrupt("ccm: tag doesn't match")),a.data},K:function(t,e,n,i,r,o){var s=[],c=sjcl.bitArray,a=c.k;if(r/=8,(r%2||4>r||r>16)&&q(new sjcl.exception.invalid("ccm: invalid tag length")),(4294967295<i.length||4294967295<e.length)&&q(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data")),o=[c.partial(8,(i.length?64:0)|r-2<<2|o-1)],o=c.concat(o,n),o[3]|=c.bitLength(e)/8,o=t.encrypt(o),i.length)for(n=c.bitLength(i)/8,65279>=n?s=[c.partial(16,n)]:4294967295>=n&&(s=c.concat([c.partial(16,65534)],[n])),s=c.concat(s,i),i=0;i<s.length;i+=4)o=t.encrypt(a(o,s.slice(i,i+4).concat([0,0,0])));for(i=0;i<e.length;i+=4)o=t.encrypt(a(o,e.slice(i,i+4).concat([0,0,0])));return c.clamp(o,8*r)},n:function(t,e,n,i,r,o){var s,c=sjcl.bitArray;s=c.k;var a=e.length,l=c.bitLength(e);if(n=c.concat([c.partial(8,o-1)],n).concat([0,0,0]).slice(0,4),i=c.bitSlice(s(i,t.encrypt(n)),0,r),!a)return{tag:i,data:[]};for(s=0;a>s;s+=4)n[3]++,r=t.encrypt(n),e[s]^=r[0],e[s+1]^=r[1],e[s+2]^=r[2],e[s+3]^=r[3];return{tag:i,data:c.clamp(e,l)}}},sjcl.mode.ocb2={name:"ocb2",encrypt:function(t,e,n,i,r,o){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits"));var s,c=sjcl.mode.ocb2.G,a=sjcl.bitArray,l=a.k,h=[0,0,0,0];n=c(t.encrypt(n));var p,u=[];for(i=i||[],r=r||64,s=0;s+4<e.length;s+=4)p=e.slice(s,s+4),h=l(h,p),u=u.concat(l(n,t.encrypt(l(n,p)))),n=c(n);return p=e.slice(s),e=a.bitLength(p),s=t.encrypt(l(n,[0,0,0,e])),p=a.clamp(l(p.concat([0,0,0]),s),e),h=l(h,l(p.concat([0,0,0]),s)),h=t.encrypt(l(h,l(n,c(n)))),i.length&&(h=l(h,o?i:sjcl.mode.ocb2.pmac(t,i))),u.concat(a.concat(p,a.clamp(h,r)))},decrypt:function(t,e,n,i,r,o){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits")),r=r||64;var s,c,a=sjcl.mode.ocb2.G,l=sjcl.bitArray,h=l.k,p=[0,0,0,0],u=a(t.encrypt(n)),m=sjcl.bitArray.bitLength(e)-r,d=[];for(i=i||[],n=0;m/32>n+4;n+=4)s=h(u,t.decrypt(h(u,e.slice(n,n+4)))),p=h(p,s),d=d.concat(s),u=a(u);return c=m-32*n,s=t.encrypt(h(u,[0,0,0,c])),s=h(s,l.clamp(e.slice(n),c).concat([0,0,0])),p=h(p,s),p=t.encrypt(h(p,h(u,a(u)))),i.length&&(p=h(p,o?i:sjcl.mode.ocb2.pmac(t,i))),l.equal(l.clamp(p,r),l.bitSlice(e,m))||q(new sjcl.exception.corrupt("ocb: tag doesn't match")),d.concat(l.clamp(s,c))},pmac:function(t,e){var n,i=sjcl.mode.ocb2.G,r=sjcl.bitArray,o=r.k,s=[0,0,0,0],c=t.encrypt([0,0,0,0]),c=o(c,i(i(c)));for(n=0;n+4<e.length;n+=4)c=i(c),s=o(s,t.encrypt(o(c,e.slice(n,n+4))));return n=e.slice(n),128>r.bitLength(n)&&(c=o(c,i(c)),n=r.concat(n,[-2147483648,0,0,0])),s=o(s,n),t.encrypt(o(i(o(c,i(c))),s))},G:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},sjcl.mode.gcm={name:"gcm",encrypt:function(t,e,n,i,r){var o=e.slice(0);return e=sjcl.bitArray,i=i||[],t=sjcl.mode.gcm.n(!0,t,o,i,n,r||128),e.concat(t.data,t.tag)},decrypt:function(t,e,n,i,r){var o=e.slice(0),s=sjcl.bitArray,c=s.bitLength(o);return r=r||128,i=i||[],c>=r?(e=s.bitSlice(o,c-r),o=s.bitSlice(o,0,c-r)):(e=o,o=[]),t=sjcl.mode.gcm.n(u,t,o,i,n,r),s.equal(t.tag,e)||q(new sjcl.exception.corrupt("gcm: tag doesn't match")),t.data},U:function(t,e){var n,i,r,o,s,c=sjcl.bitArray.k;for(r=[0,0,0,0],o=e.slice(0),n=0;128>n;n++){for((i=0!==(t[Math.floor(n/32)]&1<<31-n%32))&&(r=c(r,o)),s=0!==(1&o[3]),i=3;i>0;i--)o[i]=o[i]>>>1|(1&o[i-1])<<31;o[0]>>>=1,s&&(o[0]^=-520093696)}return r},f:function(t,e,n){var i,r=n.length;for(e=e.slice(0),i=0;r>i;i+=4)e[0]^=4294967295&n[i],e[1]^=4294967295&n[i+1],e[2]^=4294967295&n[i+2],e[3]^=4294967295&n[i+3],e=sjcl.mode.gcm.U(e,t);return e},n:function(t,e,n,i,r,o){var s,c,a,l,h,p,u,m,d=sjcl.bitArray;for(p=n.length,u=d.bitLength(n),m=d.bitLength(i),c=d.bitLength(r),s=e.encrypt([0,0,0,0]),96===c?(r=r.slice(0),r=d.concat(r,[1])):(r=sjcl.mode.gcm.f(s,[0,0,0,0],r),r=sjcl.mode.gcm.f(s,r,[0,0,Math.floor(c/4294967296),4294967295&c])),c=sjcl.mode.gcm.f(s,[0,0,0,0],i),h=r.slice(0),i=c.slice(0),t||(i=sjcl.mode.gcm.f(s,c,n)),l=0;p>l;l+=4)h[3]++,a=e.encrypt(h),n[l]^=a[0],n[l+1]^=a[1],n[l+2]^=a[2],n[l+3]^=a[3];return n=d.clamp(n,u),t&&(i=sjcl.mode.gcm.f(s,c,n)),t=[Math.floor(m/4294967296),4294967295&m,Math.floor(u/4294967296),4294967295&u],i=sjcl.mode.gcm.f(s,i,t),a=e.encrypt(r),i[0]^=a[0],i[1]^=a[1],i[2]^=a[2],i[3]^=a[3],{tag:d.bitSlice(i,0,o),data:n}}},sjcl.misc.hmac=function(t,e){this.L=e=e||sjcl.hash.sha256;var n,i=[[],[]],r=e.prototype.blockSize/32;for(this.o=[new e,new e],t.length>r&&(t=e.hash(t)),n=0;r>n;n++)i[0][n]=909522486^t[n],i[1][n]=1549556828^t[n];this.o[0].update(i[0]),this.o[1].update(i[1])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(t){return t=new this.L(this.o[0]).update(t).finalize(),new this.L(this.o[1]).update(t).finalize()},sjcl.misc.pbkdf2=function(t,e,n,i,r){n=n||1e3,(0>i||0>n)&&q(sjcl.exception.invalid("invalid params to pbkdf2")),"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),r=r||sjcl.misc.hmac,t=new r(t);var o,s,c,a,l=[],h=sjcl.bitArray;for(a=1;32*l.length<(i||1);a++){for(r=o=t.encrypt(h.concat(e,[a])),s=1;n>s;s++)for(o=t.encrypt(o),c=0;c<o.length;c++)r[c]^=o[c];l=l.concat(r)}return i&&(l=h.clamp(l,i)),l},sjcl.prng=function(e){this.b=[new sjcl.hash.sha256],this.h=[0],this.F=0,this.t={},this.C=0,this.J={},this.N=this.c=this.i=this.T=0,this.a=[0,0,0,0,0,0,0,0],this.e=[0,0,0,0],this.A=t,this.B=e,this.p=u,this.z={progress:{},seeded:{}},this.l=this.S=0,this.u=1,this.w=2,this.Q=65536,this.H=[0,48,64,96,128,192,256,384,512,768,1024],this.R=3e4,this.P=80},sjcl.prng.prototype={randomWords:function(t,e){var n,i=[];n=this.isReady(e);var r;if(n===this.l&&q(new sjcl.exception.notReady("generator isn't seeded")),n&this.w){n=!(n&this.u),r=[];var o,s=0;for(this.N=r[0]=(new Date).valueOf()+this.R,o=0;16>o;o++)r.push(4294967296*Math.random()|0);for(o=0;o<this.b.length&&(r=r.concat(this.b[o].finalize()),s+=this.h[o],this.h[o]=0,!(!n&&this.F&1<<o));o++);for(this.F>=1<<this.b.length&&(this.b.push(new sjcl.hash.sha256),this.h.push(0)),this.c-=s,s>this.i&&(this.i=s),this.F++,this.a=sjcl.hash.sha256.hash(this.a.concat(r)),this.A=new sjcl.cipher.aes(this.a),n=0;4>n&&(this.e[n]=this.e[n]+1|0,!this.e[n]);n++);}for(n=0;t>n;n+=4)0===(n+1)%this.Q&&A(this),r=B(this),i.push(r[0],r[1],r[2],r[3]);return A(this),i.slice(0,t)},setDefaultParanoia:function(t){this.B=t},addEntropy:function(e,n,i){i=i||"user";var r,o,s=(new Date).valueOf(),c=this.t[i],a=this.isReady(),l=0;switch(r=this.J[i],r===t&&(r=this.J[i]=this.T++),c===t&&(c=this.t[i]=0),this.t[i]=(this.t[i]+1)%this.b.length,typeof e){case"number":n===t&&(n=1),this.b[c].update([r,this.C++,1,n,s,1,0|e]);break;case"object":if(i=Object.prototype.toString.call(e),"[object Uint32Array]"===i){for(o=[],i=0;i<e.length;i++)o.push(e[i]);e=o}else for("[object Array]"!==i&&(l=1),i=0;i<e.length&&!l;i++)"number"!=typeof e[i]&&(l=1);if(!l){if(n===t)for(i=n=0;i<e.length;i++)for(o=e[i];o>0;)n++,o>>>=1;this.b[c].update([r,this.C++,2,n,s,e.length].concat(e))}break;case"string":n===t&&(n=e.length),this.b[c].update([r,this.C++,3,n,s,e.length]),this.b[c].update(e);break;default:l=1}l&&q(new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.h[c]+=n,this.c+=n,a===this.l&&(this.isReady()!==this.l&&C("seeded",Math.max(this.i,this.c)),C("progress",this.getProgress()))},isReady:function(e){return e=this.H[e!==t?e:this.B],this.i&&this.i>=e?this.h[0]>this.P&&(new Date).valueOf()>this.N?this.w|this.u:this.u:this.c>=e?this.w|this.l:this.l},getProgress:function(t){return t=this.H[t?t:this.B],this.i>=t?1:this.c>t?1:this.c/t},startCollectors:function(){this.p||(window.addEventListener?(window.addEventListener("load",this.r,u),window.addEventListener("mousemove",this.s,u)):document.attachEvent?(document.attachEvent("onload",this.r),document.attachEvent("onmousemove",this.s)):q(new sjcl.exception.bug("can't attach event")),this.p=!0)},stopCollectors:function(){this.p&&(window.removeEventListener?(window.removeEventListener("load",this.r,u),window.removeEventListener("mousemove",this.s,u)):window.detachEvent&&(window.detachEvent("onload",this.r),window.detachEvent("onmousemove",this.s)),this.p=u)},addEventListener:function(t,e){this.z[t][this.S++]=e},removeEventListener:function(t,e){var n,i,r=this.z[t],o=[];for(i in r)r.hasOwnProperty(i)&&r[i]===e&&o.push(i);for(n=0;n<o.length;n++)i=o[n],delete r[i]},s:function(t){sjcl.random.addEntropy([t.x||t.clientX||t.offsetX||0,t.y||t.clientY||t.offsetY||0],2,"mouse")},r:function(){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")}},sjcl.random=new sjcl.prng(6);try{var D=new Uint32Array(32);crypto.getRandomValues(D),sjcl.random.addEntropy(D,1024,"crypto['getRandomValues']")}catch(E){}sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,e,n,i){n=n||{},i=i||{};var r,o=sjcl.json,s=o.d({iv:sjcl.random.randomWords(4,0)},o.defaults);return o.d(s,n),n=s.adata,"string"==typeof s.salt&&(s.salt=sjcl.codec.base64.toBits(s.salt)),"string"==typeof s.iv&&(s.iv=sjcl.codec.base64.toBits(s.iv)),(!sjcl.mode[s.mode]||!sjcl.cipher[s.cipher]||"string"==typeof t&&100>=s.iter||64!==s.ts&&96!==s.ts&&128!==s.ts||128!==s.ks&&192!==s.ks&&256!==s.ks||2>s.iv.length||4<s.iv.length)&&q(new sjcl.exception.invalid("json encrypt: invalid parameters")),"string"==typeof t&&(r=sjcl.misc.cachedPbkdf2(t,s),t=r.key.slice(0,s.ks/32),s.salt=r.salt),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),"string"==typeof n&&(n=sjcl.codec.utf8String.toBits(n)),r=new sjcl.cipher[s.cipher](t),o.d(i,s),i.key=t,s.ct=sjcl.mode[s.mode].encrypt(r,e,s.iv,n,s.ts),o.encode(s)},decrypt:function(t,e,n,i){n=n||{},i=i||{};var r=sjcl.json;e=r.d(r.d(r.d({},r.defaults),r.decode(e)),n,!0);var o;return n=e.adata,"string"==typeof e.salt&&(e.salt=sjcl.codec.base64.toBits(e.salt)),"string"==typeof e.iv&&(e.iv=sjcl.codec.base64.toBits(e.iv)),(!sjcl.mode[e.mode]||!sjcl.cipher[e.cipher]||"string"==typeof t&&100>=e.iter||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||!e.iv||2>e.iv.length||4<e.iv.length)&&q(new sjcl.exception.invalid("json decrypt: invalid parameters")),"string"==typeof t&&(o=sjcl.misc.cachedPbkdf2(t,e),t=o.key.slice(0,e.ks/32),e.salt=o.salt),"string"==typeof n&&(n=sjcl.codec.utf8String.toBits(n)),o=new sjcl.cipher[e.cipher](t),n=sjcl.mode[e.mode].decrypt(o,e.ct,e.iv,n,e.ts),r.d(i,e),i.key=t,sjcl.codec.utf8String.fromBits(n)},encode:function(t){var e,n="{",i="";for(e in t)if(t.hasOwnProperty(e))switch(e.match(/^[a-z0-9]+$/i)||q(new sjcl.exception.invalid("json encode: invalid property name")),n+=i+'"'+e+'":',i=",",typeof t[e]){case"number":case"boolean":n+=t[e];break;case"string":n+='"'+escape(t[e])+'"';break;case"object":n+='"'+sjcl.codec.base64.fromBits(t[e],0)+'"';break;default:q(new sjcl.exception.bug("json encode: unsupported type"))}return n+"}"},decode:function(t){t=t.replace(/\s/g,""),t.match(/^\{.*\}$/)||q(new sjcl.exception.invalid("json decode: this isn't json!")),t=t.replace(/^\{|\}$/g,"").split(/,/);var e,n,i={};for(e=0;e<t.length;e++)(n=t[e].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||q(new sjcl.exception.invalid("json decode: this isn't json!")),i[n[2]]=n[3]?parseInt(n[3],10):n[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(n[4]):unescape(n[4]);return i},d:function(e,n,i){if(e===t&&(e={}),n===t)return e;for(var r in n)n.hasOwnProperty(r)&&(i&&e[r]!==t&&e[r]!==n[r]&&q(new sjcl.exception.invalid("required parameter overridden")),e[r]=n[r]);return e},X:function(t,e){var n,i={};for(n in t)t.hasOwnProperty(n)&&t[n]!==e[n]&&(i[n]=t[n]);return i},W:function(e,n){var i,r={};for(i=0;i<n.length;i++)e[n[i]]!==t&&(r[n[i]]=e[n[i]]);return r}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc.V={},sjcl.misc.cachedPbkdf2=function(e,n){var i,r=sjcl.misc.V;return n=n||{},i=n.iter||1e3,r=r[e]=r[e]||{},i=r[i]=r[i]||{firstSalt:n.salt&&n.salt.length?n.salt.slice(0):sjcl.random.randomWords(2,0)},r=n.salt===t?i.firstSalt:n.salt,i[r]=i[r]||sjcl.misc.pbkdf2(e,r,n.iter),{key:i[r].slice(0),salt:r.slice(0)}},Promotron={},"undefined"==typeof promotronOpts&&(promotronOpts={}),"undefined"==typeof promotronOpts.minlimit&&(promotronOpts.minlimit=4),"undefined"==typeof promotronOpts.maxlimit&&(promotronOpts.maxlimit=6),require(["foundation/main"],function(){require(["jquery/nyt","underscore/nyt","foundation/views/page-manager"],function(t,e,n){var i=t(".span-ab-layout.layout > .ab-column").height(),r=(t(".c-column.column").height(),1*i);n.on("nyt:ads-rendered",function(t){setTimeout(function(){Promotron.resizeCcol(t)},2e3)});var o=!0;if("undefined"==typeof window.localStorage)o=!1;else try{window.localStorage.setItem("ls:beacon","a"),window.localStorage.removeItem("ls:beacon"),o=!0}catch(s){o=!1}Promotron.fetchReadingHistory=function(){return t.ajax("https://www.nytimes.com/svc/recommendations/v3/userhist.jsonp?access_key=776ACB1E-6C7F-4702-9E18-CF329376F5A3",{dataType:"jsonp"}).done(function(){})},Promotron.fetchRankings=function(e){return t.ajax("http://int.nyt.com/data/promotron/rankings/"+e+".js",{dataType:"jsonp",jsonpCallback:"promotronData"}).done(function(){})},Promotron.recordServe=function(n,i){t.ajax("http://int-promos.nytimes.com/"+n+"/serves",{method:"POST",data:JSON.stringify({urls:i}),contentType:"application/json"}).done(function(){});var r;r=localStorage.promotronServes?JSON.parse(localStorage.promotronServes):{},e(i).each(function(t){r[t]?r[t]+=1:r[t]=1}),o&&(localStorage.promotronServes=JSON.stringify(r))},Promotron.getServeExclusions=function(){var t,n=[];return t=o&&localStorage.promotronServes?JSON.parse(localStorage.promotronServes):{},e(t).each(function(t,e){t>=5&&n.push(e)}),n},Promotron.buildPromos=function(t,n,i){var r,o;if(o=e.pluck(n.articles,"url"),i.exclusions&&(o=o.concat(i.exclusions)),o=o.concat(Promotron.getServeExclusions()),o=e(o).map(function(t){return t.split("?")[0]}),r=t.pinned,r.length<i.limit){var s=e(t.best_of).difference(o);r=r.concat(e.shuffle(s))}if(r.length<i.limit){var c=e(t.featured).difference(o);r=r.concat(e.shuffle(c))}if(r.length<i.limit){var a=e.flatten([t.best_of,t.featured]);i.exclusions&&(a=e.difference(a,i.exclusions)),r=r.concat(e.shuffle(a))}return r=e.uniq(r),r=r.slice(0,i.limit),e(r).map(function(e){return t.items[e]})},Promotron.renderPromos=function(n,i,o){t("#watching-beta-opt-in").empty(),t("#watching-beta-opt-in-container").css("overflow","hidden"),i='<article class="story theme-feature promo" data-rank="0" data-collection-renderstyle="HpHedSumMediumMediaFeature"><figure class="media photo medium-thumb"><div class="image"><a href="<%= promos.url %>"><% if ((typeof promos.promo_image!="undefined") && (typeof promos.promo_image_override ==="undefined")) { %><img alt="" src="<%= promos.promo_image.thumb.url %>"><% } %><% if ((typeof promos.promo_image!="undefined") && (typeof promos.promo_image_override !="undefined")) { %><img alt="" src="<%= promos.promo_image_override.crops.thumb.url %>"><% } %><% if ((typeof promos.promo_image=="undefined") && (typeof promos.promo_image_override =="undefined")) { %><img alt="" src=""><% } %></a></div></figure> <h2 class="story-heading"><a href="<%= promos.url %>"> <%= promos.headline %> </a> <span class="product-label theme-nyt-now hidden"></span></h2><p class="summary"><%= promos.summary %></p></article>',t(document).ready(function(){for(var s=0;s<n.length;s++){var c=e.template(i,{promos:n[s]});if(t("#watching-beta-opt-in").append(c),s>o&&t("#watching-beta-opt-in article").eq(s).css("display","none"),t("#watching-beta-opt-in-container").height()>r){t("#watching-beta-opt-in-container article:last").remove();break}}})},t("#watching-beta-opt-in-container").on("click","a",function(e){t.ajax({type:"POST",url:"http://int-promos.nytimes.com/hp-watching/click",data:{url:t(e.currentTarget).attr("href").split("?")[0]},success:function(){},xhrFields:{withCredentials:!0},crossDomain:!0})}),t.when(Promotron.fetchRankings("hp-watching"),Promotron.fetchReadingHistory()).then(function(n,i){var r,s;o&&localStorage.promotronPromos&&(s=JSON.parse(localStorage.promotronPromos)),("undefined"==typeof s||"undefined"==typeof s.promos)&&(s={promos:[],timestamp:0});var c,a=Date.now()-s.timestamp>36e4,l=window.location.search.match("WT.z_jog");c=a&&l&&Date.now()-s.timestamp>72e5?!0:!1,c||0==s.promos.length||a&&!l?(Promotron.isRefreshed=!0,r=Promotron.buildPromos(n[0],i[0],{limit:promotronOpts.maxlimit,exclusions:e.map(t(".top-news a,.pocket-region a,.inside-nyt a"),function(e){return t(e).attr("href")})}),o&&(localStorage.promotronPromos=JSON.stringify({promos:r,timestamp:Date.now()}))):r=s.promos;var h={};Promotron.renderPromos(r,h,promotronOpts.minlimit,promotronOpts.maxlimit),t("#watching-beta-opt-in-container .portal-header h4").css("display","block")}),Promotron.resizeCcol=function(){t(document).ready(function(){t("#watching-beta-opt-in article").ready(function(){var e=[];t(t("#watching-beta-opt-in article").get().reverse()).each(function(){var n=t(".span-ab-layout.layout > .ab-column").height(),i=t(".c-column.column").height(),r=1*n;i>r?t(this).hide():(t(this).css("display","block"),e.push(t(this).find("a").attr("href")))}),Promotron.isRefreshed&&Promotron.recordServe("hp-watching",e)})})}})});