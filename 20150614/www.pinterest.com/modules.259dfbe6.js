goog.provide("P.modules.AboutLinks"),goog.require("P.Module"),P.modules.AboutLinks=P.Module.extend({}),goog.provide("P.modules.ActiveConversations"),goog.require("P.Module"),P.modules.ActiveConversations=P.Module.extend({getConversationHeads:function(){return this.$(".ConversationHead")}}),goog.provide("P.modules.AddPinRepWithPlace"),goog.require("P.Module"),P.modules.AddPinRepWithPlace=P.Module.extend({}),goog.provide("P.modules.AddPinURL"),goog.require("P.Form"),goog.require("P.Module"),P.modules.AddPinURL=P.Module.extend({events:{"click .pinmarkletLink":"logPinmarkletLinkClick"},onContentReady:function(){var a=this.$(".standardForm"),b={prevalidate:!0,message:P._("Where do you want to Pin from?")},c={url:[P.Validator.Required(b),P.Validator.URL()]};this.form=new P.Form(a,c,b),this.form.getField("url").placeholder(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},logPinmarkletLinkClick:function(){this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,this.options.pinmarklet_link_element_type,P.ContextLogging.ComponentType.MODAL_ADD_PIN,{})},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.form.getValue("url");this.navigate("/pin/find/?"+$.param({url:b}))}}}),goog.provide("P.modules.AddressForm"),goog.require("P.Module"),P.modules.AddressForm=P.Module.extend({}),goog.provide("P.modules.AdhocFeedIndexPage"),goog.require("P.Module"),P.modules.AdhocFeedIndexPage=P.Module.extend({}),goog.provide("P.modules.AdhocFeedPage"),goog.require("P.Module"),P.modules.AdhocFeedPage=P.Module.extend({}),goog.provide("P.modules.AnimationPlaces"),goog.require("P.Module"),P.modules.AnimationPlaces=P.Module.extend({events:{"mouseenter .balloonLayer":"activateBalloon","mouseleave .balloonLayer":"deactivateBalloon"},onContentReady:function(){this.$balloon=this.$(".balloon")},activateBalloon:function(){var a=this.$(".balloonAudio").get(0);a.play(),this.$balloon.hide()},deactivateBalloon:function(){this.$balloon.show()}}),require("common/lib/external/qrcode.js"),goog.provide("P.modules.AppDownloadQRCode"),goog.require("P.Module"),P.modules.AppDownloadQRCode=P.Module.extend({onContentReady:function(){var a=this.$(".qrCode"),b=new QRCode(a[0],{colorDark:"#bd081c",correctLevel:QRCode.CorrectLevel.H,height:a.height(),width:a.width()});b.makeCode("https://"+window.location.host+"/get-app/?s=m&i="+P.CONTEXT.unauth_id)}}),goog.provide("P.modules.AppInstallModal"),goog.require("P.Module"),P.modules.AppInstallModal=P.Module.extend({events:{"click .leftArrowPadding":"shiftPanelLeft","click .rightArrowPadding":"shiftPanelRight","click .leftHalf":"shiftPanelLeft","click .rightHalf":"shiftPanelRight","click .leftFooter":"shiftPanelLeft","click .rightFooter":"shiftPanelRight","click .playStoreScreenshot":"openCompletionPanel","click .appStoreScreenshot":"openCompletionPanel","click .dismissModal":"dismissModal","click .continueToPhonePicker":"continueToPhonePicker"},onContentReady:function(){this.options.placedExperienceId&&P.ExperienceManager.instance().completePlacedExperienceId(this.options.placedExperienceId),this.MIDDLE_PANEL="middle",this.LEFT_PANEL="left",this.RIGHT_PANEL="right",this.currentPanel=this.MIDDLE_PANEL,this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.openCompletionPanel),this.childListen(P.CONST.EVENT_GPLUS_BUTTON_CLICKED,this.openCompletionPanel),P.trackRegisterAction("app_install_modal_opened")},shiftPanelLeft:function(){var a;this.currentPanel===this.MIDDLE_PANEL?(this.currentPanel=this.LEFT_PANEL,a="150%",this.$(".leftArrow").fadeOut()):this.currentPanel===this.RIGHT_PANEL&&(this.currentPanel=this.MIDDLE_PANEL,a="50%",this.$(".rightArrow").fadeIn()),a&&(this.$(".container").animate({left:a},{queue:!1}),P.trackRegisterAction("app_install_modal_ios_selected"))},shiftPanelRight:function(){var a;this.currentPanel===this.LEFT_PANEL?(this.currentPanel=this.MIDDLE_PANEL,a="50%",this.$(".leftArrow").fadeIn()):this.currentPanel===this.MIDDLE_PANEL&&(this.currentPanel=this.RIGHT_PANEL,a="-50%",this.$(".rightArrow").fadeOut()),a&&(this.$(".container").animate({left:a},{queue:!1}),P.trackRegisterAction("app_install_modal_android_selected"))},openCompletionPanel:function(a){"continueToPhonePicker"!==a.target.id&&setTimeout(function(){P.trackRegisterAction("app_install_modal_store_opened"),this.$(".completedPanel").fadeIn()}.bind(this),1e3)},dismissModal:function(){P.trackRegisterAction("app_install_modal_experience_completed"),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.destroy()},continueToPhonePicker:function(){P.trackRegisterAction("continued_to_phone_picker"),this.$(".appUpsell").fadeOut(),this.$(".phonePicker").fadeIn()}}),goog.provide("P.modules.AppInterstitial"),goog.require("P.Module"),goog.require("P.nativeApp"),P.modules.AppInterstitial=P.Module.extend({events:{"click .stayInBrowserLink":"onClickStayInBrowser","click .appInfo":"onClickOpenInApp","click .openInApp":"onClickOpenInApp"},onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var a=P.ContextEvent.fromEventType(P.ContextLogging.EventType.INTERSTITIAL_LOADED);P.ContextLogger.getInstance().addEvent(a),P.trackRegisterAction("interstitial_loaded")},onButtonClick:function(a){"openInApp"===a.target.id?this.onClickOpenInApp():"stayInBrowser"===a.target.id&&this.onClickStayInBrowser()},onClickOpenInApp:function(){P.nativeApp.setOpenInAppPreference(),this.triggerEvent(P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP,null,!0);var a=P.ContextEvent.fromEventType(P.ContextLogging.EventType.INTERSTITIAL_OPEN_IN_APP);P.ContextLogger.getInstance().addEvent(a),P.trackRegisterAction("interstitial_open_in_app")},onClickStayInBrowser:function(){var a=P.ContextEvent.fromEventType(P.ContextLogging.EventType.INTERSTITIAL_OPEN_IN_BROWSER);P.nativeApp.setStayInBrowserPreference(!0,!1),P.ContextLogger.getInstance().addEvent(a),P.trackRegisterAction("interstitial_open_in_browser");var b=this.parent;b&&b.destroy()}}),goog.provide("P.modules.AppealForm"),goog.require("P.Form"),goog.require("P.Module"),P.modules.AppealForm=P.Module.extend({onContentReady:function(){var a={email:[P.Validator.Email({}),P.Validator.Required()],type:[P.Validator.Required()]},b={prevalidate:!0};this.$form=this.$("form"),this.form=new P.Form(this.$form,a,b),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){a.errors[0]||this.submitAppeal()},submitAppeal:function(){var a=this.getChildById("submitButton");a.showLoading();var b=this.form.getData(),c=P.resourceFactory.create("AppealResource",b);c.options=b,c.callCreate({showError:!0}).then(function(){a.hideLoading();var b={name:"ConfirmDialog",options:{template:"appeal"}};P.loadModule(b).then(function(a){this.showInModal(a)}.bind(this))}.bind(this)).fin(function(){a.hideLoading()})}}),goog.provide("P.modules.AuthHomePage"),goog.require("P.Module"),P.modules.AuthHomePage=P.Module.extend({onContentReady:function(){return this.options.is_modal_nux?(P.ExperienceManager.instance().launchPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,{}),void delete this.options.is_modal_nux):(_.defer(this.addTutorials.bind(this)),this.grid=this.getChildById("feedGrid"),this.grid.hasItems()||P.logFrontEndEvent("auth_home_page_empty_grid",1),this.options.show_inviter_modal&&this.showFriendInviterModal(),this.extraData&&this.extraData.emailUpdated&&this.showUpdateEmailSuccess(),this._setUpFastFollow(),void this.setRecentPinId())},showFriendInviterModal:function(){var a=P.experiments.instance.inExperimentGroups("pinvitational_philippines",["enabled","employees"]),b={name:a?"PinvitationalInviterWrapper":"MultiInviter"};P.loadModule(b).then(function(b){this.showInModal(b,{can_dismiss:!a,only_modal:!0})}.bind(this))},showUpdateEmailSuccess:function(){if(Cookie.get(P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED)){if(Cookie.unset(P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED),!this.extraData||!this.extraData.email)return;var a=P.string.format(P._("You updated your address! Now you just need to confirm it. Look for the message we sent to {{ new_email }}."),{new_email:this.extraData.email}),b={name:"ConfirmDialog",options:{button_text:P._("Ok"),body_message:a,title:P._("Email updated"),template:"generic"}};return void P.loadModule(b).then(function(a){this.showInModal(a)}.bind(this))}},_setUpFastFollow:function(){var a={};a[P.CONST.PUBSUB_TOPIC_HOMEFEED_REFRESH]=this.onBoardInteraction.bind(this),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},addTutorials:function(){var a=P.Experiences.Placement.WEB_HOME_TAKEOVER;P.ExperienceManager.instance().launchPlacedExperience(a,{},this)},onBoardInteraction:function(a,b,c){var d=P.NOOP;c&&c.callback&&(d=c.callback),this.render().then(d)},onAddedToDom:function(){this._setUpFastFollow(),this.setRecentPinId()},onRemovedFromDom:function(){P.Updater.instance().setRecentPinId(null)},setRecentPinId:function(){P.Updater.instance().setRecentPinId(this.getRecentPinId())},getRecentPinId:function(){if(!this.grid)return null;var a=this.grid.getFirstGridItem("Pin");return a?a.getPinId():void 0}}),goog.provide("P.modules.AutoFollow"),goog.require("P.Module"),P.modules.AutoFollow=P.Module.extend({events:{},onContentReady:function(){var a={username:this.options.username,username_and_slug:this.options.username_and_slug},b="UserAutoFollowResource",c="/"+this.options.username+"/",d="user_auto_follow";this.options.username_and_slug&&(b="BoardAutoFollowResource",c="/"+this.options.username_and_slug+"/",d="board_auto_follow");var e=P.resourceFactory.create(b,a);e.callCreate().then(function(){P.trackGAEvent(d,P.CONST.GA_ACTION_SUCCESS)},function(){P.trackGAEvent(d,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.navigate(c+"?auto_follow=1")}.bind(this))}}),goog.provide("P.modules.BackgroundImage"),goog.require("P.Module"),P.modules.BackgroundImage=P.Module.extend({CssClassName:{IS_ACTIVE:"active",LOADED:"loaded"},setNewImage:function(a,b){this.options.image_preload_bg=a,this.options.image_url=b,this.$el.css("background-color",this.options.image_preload_bg),this.background.removeClass(this.CssClassName.LOADED),this.holderImage.attr("src",this.options.image_url)},onContentReady:function(){this.holderImage=this.$(".holderImage"),this.background=this.$(".background"),this.holderImage.load(this.onImageLoaded.bind(this)),this.setNewImage(this.options.image_preload_bg,this.options.image_url)},onImageLoaded:function(){this.background.css("background-image","url('"+this.options.image_url+"')"),setTimeout(function(){this.background.addClass(this.CssClassName.LOADED)}.bind(this),100)},setActive:function(a){this.$el.toggleClass(this.CssClassName.IS_ACTIVE,a)}}),goog.provide("P.modules.BlueAppBanner"),goog.require("P.Module"),P.modules.BlueAppBanner=P.Module.extend({events:{click:"openInApp"},openInApp:function(){this.triggerEvent(P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP,null,!0)}}),goog.provide("P.modules.BoardButtons"),goog.require("P.Module"),P.modules.BoardButtons=P.Module.extend({}),goog.provide("P.modules.BoardCollaboratorInvitesBase"),goog.require("P.Module"),P.modules.BoardCollaboratorInvitesBase=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this.onChildInviteUser),this.childListen(P.CONST.EVENT_INVITE_EMAIL,this.onChildInviteEmail)},onInviteAdded:function(){},onChildInviteUser:function(a){var b,c=this.getChildById("boardInviteForm");c.showLoading();var d=a.data.userId,e=a.data.type,f=this.getBoardId();"user"===e?(b=P.resourceFactory.create("BoardInviteResource",{board_id:f,invited_user_id:d}),b.callCreate().then(function(){this.onInviteAdded(a.data.pending,{invitee:d,type:"pinner"}),c.clearTypeahead()}.bind(this)).fin(function(){c.hideLoading()})):e===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER?(b=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:f}),b.callGet({showError:!1}).then(function(a){var e=a.resource_response.data;c.hideLoading(),P.FacebookDialog.open({type:"send",path:e.url,to:d,callback:function(a){a&&a.success&&(b=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:this.getBoardId(),invite_code:e.invite_code}),b.callUpdate())}.bind(this)})}.bind(this),function(a){c.hideLoading(),P.showError(a.message)})):this._inviteEmail(d,a.data.pending)},_inviteEmail:function(a,b){var c=this.getChildById("boardInviteForm"),d={board_id:this.getBoardId(),emails:[a]},e=P.resourceFactory.create("BoardEmailInviteResource",d);e.callCreate().then(function(){this.onInviteAdded(b,{invitee:a,type:"email"}),c.clearTypeahead();var d=P.string.format(P.string.common.successInviteSentToEmail,{email:a}),e=$("<div class='alert'>"+d+"</div>").hide();this.insertAfterModule(e,c),e.fadeIn(function(){e.delay(5e3).fadeOut(function(){e.remove()})})}.bind(this)).fin(function(){c.hideLoading()})},getBoardId:function(){return this.resource.options.board_id},onChildInviteEmail:function(a){var b=this.getChildById("boardInviteForm");b.showLoading();var c=a.data.email,d=a.data.pending;this._inviteEmail(c,d)}}),goog.provide("P.modules.BoardCollaborators"),goog.require("P.Module"),goog.require("P.modules.BoardCollaboratorInvitesBase"),P.modules.BoardCollaborators=P.modules.BoardCollaboratorInvitesBase.extend({onContentReady:function(){this.boardInviteForm=this.getChildById("boardInviteForm");var a=this.getBoardId();if(a){var b={};b[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,this.pubsubSubscribe(a,b)}},onBoardUpdated:function(){this.render()}}),goog.provide("P.modules.BoardCoverEditPage"),goog.require("P.Module"),P.modules.BoardCoverEditPage=P.Module.extend({events:{"click .save":"save","click .cancel":"cancel"},save:function(){P.trackGAEvent("board_edit_cover",P.CONST.GA_ACTION_CLICK_SUBMIT);var a=this.getChildByModuleName("BoardCoverEdit"),b=a.getBoardCoverData(),c=this.getChildById("saveCover");c.showLoading();var d=_.extend(b,{board_id:this.extraData.boardId,url:this.$(".in").attr("src")}),e=P.resourceFactory.create("BoardResource",d),f=Math.round(b.nativeWidth*b.scale),g=Math.round(b.width),h=Math.round(b.nativeHeight*b.scale),i=Math.round(b.height);if(h!==i&&f!==g){var j=_.extend({},b,{userAgent:window.navigator.userAgent});this.log.error("Invalid cover data (crop box bound error)",j)}e.callUpdate().then(function(){P.trackGAEvent("board_edit_cover",P.CONST.GA_ACTION_SUCCESS),this.destroy(),P.pubsub.publish(this.extraData.boardId,P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED,d)}.bind(this)).fin(function(){c.hideLoading()})},cancel:function(){P.trackGAEvent("board_edit_cover",P.CONST.GA_ACTION_CLICK_CANCEL),this.destroy()}}),goog.provide("P.modules.BoardFollowers"),goog.require("P.Module"),P.modules.BoardFollowers=P.Module.extend({}),goog.provide("P.modules.BoardHeader"),goog.require("P.Module");var BOARD_INFO_BAR_MODULE_NAME="BoardInfoBar";P.modules.BoardHeader=P.Module.extend({CssClassName:{HEADER_COLLAPSED:P.CONST.CLASS_HEADER_COLLAPSED},onCreated:function(){this.childListen(P.CONST.EVENT_INFO_BAR_COLLAPSED,this.onInfoBarCollapsed),this.childListen(P.CONST.EVENT_INFO_BAR_EXPANDED,this.onInfoBarExpanded)},showEditModal:function(){var a=this.getChildByModuleName(BOARD_INFO_BAR_MODULE_NAME);return a.showEditModal()},onInfoBarCollapsed:function(){this.updateOptionsAndDom({headerCollapsed:!0})},onInfoBarExpanded:function(){this.updateOptionsAndDom({headerCollapsed:!1})},updateDom:function(){this.$el.toggleClass(this.CssClassName.HEADER_COLLAPSED,this.options.headerCollapsed)}}),goog.provide("P.modules.BoardIcons"),goog.require("P.Module"),P.modules.BoardIcons=P.Module.extend({CssClassName:{LIGHT:"light"},setLightColor:function(a){this.$el.toggleClass(this.CssClassName.LIGHT,a)}}),goog.provide("P.modules.BoardInvite"),goog.require("P.Module");var showSuccessMs=5e3;P.modules.BoardInvite=P.Module.extend({onContentReady:function(){this.declineButton=this.getChildById("declineButton"),this.removeButton=this.getChildById("removeButton"),this.acceptButton=this.getChildById("acceptButton"),this.approveButton=this.getChildById("approveButton"),this.declineButton&&this.listen(this.declineButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickDecline),this.removeButton&&this.listen(this.removeButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickRemove),this.acceptButton&&this.listen(this.acceptButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickAccept),this.approveButton&&this.listen(this.approveButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickApprove)},getConfirmBoardInvite:function(){return"boardEdit"===this.options.view_type},deleteBoardInvite:function(a){var b,c=this._getCurrentUserIsInvitedUser();b=c?"collaborator_decline_invite":"collaborator_delete_invite",P.trackGAEvent(b,P.CONST.GA_ACTION_CLICK),this.removeButton&&this.removeButton.showLoading();var d=!1;if(a){var e=a.data.formData;d=e&&e.ban}var f=this._getRemoveResource(d);f.callDelete({showError:!1}).then(function(){P.trackGAEvent(b,P.CONST.GA_ACTION_SUCCESS);var a=this.data.board.id;this.fadeOut(function(){this.destroy(),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED),d&&this.extraData.has_delete_permission&&P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR)}.bind(this)),c&&(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF))}.bind(this),function(){P.trackGAEvent(b,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.removeButton.hideLoading()}.bind(this))},onClickDecline:function(){},onClickRemove:function(){var a=this.options.view_type;"boardCreate"===a?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"pinner",identifier:this.options.identifier},!0),this.destroy()):"email"===a?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"email",identifier:this.options.identifier},!0),this.destroy()):"facebook"===a?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"facebook",identifier:this.options.identifier},!0),this.destroy()):this.getConfirmBoardInvite()?this.confirmDeleteBoardInvite():this.deleteBoardInvite()},confirmDeleteBoardInvite:function(){var a=this._getCurrentUserIsInvitedUser(),b=this._getInvitedUserFullName(),c={name:"RemoveUserFromBoardDialog",options:{template:"delete_board_invite",current_user_is_invited_user:a,invited_user_first_name:this.extraData.invitedUserFirstName,invited_user_full_name:b}};P.loadModule(c).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.deleteBoardInvite)}.bind(this))},onClickAccept:function(){var a="collaborator_invite_accept";P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),this.acceptButton&&this.acceptButton.showLoading();var b=P.resourceFactory.clone(this.resource);b.callUpdate().then(function(){P.trackGAEvent(a,P.CONST.GA_ACTION_SUCCESS);var b=this.$(".pending"),c=this.$(".success");if(this.data.board){var d=this.data.board.id;P.pubsub.publish(d,P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED)}b.fadeOut(function(){c.fadeIn(function(){c.delay(showSuccessMs).fadeOut(function(){this.destroy()}.bind(this))}.bind(this))}.bind(this))}.bind(this),function(){P.trackGAEvent(a,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.acceptButton.hideLoading()}.bind(this))},onClickApprove:function(){var a="collaborator_approve_invite",b=P.resourceFactory.create("BoardInviteResource",this.resource.copyOptions(!0));this.approveButton&&this.approveButton.showLoading(),b.callUpdate().then(function(){P.trackGAEvent(a,P.CONST.GA_ACTION_SUCCESS),this.fadeOut(function(){this.destroy()}.bind(this));var b=this.data.board.id;P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE,{userId:this._getInviteUserId()})}.bind(this),function(){P.trackGAEvent(a,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.approveButton.hideLoading()}.bind(this))},_getRemoveResource:function(a){var b=this.extraData.accepted,c=b?"BoardCollaboratorResource":"BoardInviteResource",d=this.resource.copyOptions(!0);b&&this.getConfirmBoardInvite()&&(d.ban=a);var e=P.resourceFactory.create(c,d);return e},_getInviteUserId:function(){return this.extraData.invitedUserId},_getCurrentUserIsInvitedUser:function(){return this.extraData.currentUserIsInvitedUser},_getInvitedUserFullName:function(){return this.extraData.invitedUserFullName}}),goog.provide("P.modules.BoardInviteForm"),goog.require("P.Module"),goog.require("P.Validator"),P.modules.BoardInviteForm=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onChildEnterPressed),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onClickInviteButton),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_CONTACT_SELECTED,this.onRecentContactSelected)},onChildItemSelected:function(a){P.trackGAEvent("collaborator_invite_user",P.CONST.GA_ACTION_SELECT_SUBMIT);var b=a.data.item,c=b.attributes;this._inviteUser(c),a.stopPropagation()},onRecentContactSelected:function(a){var b=a.data.type;"emailcontact"===b?(P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_SELECT_SUBMIT),this._inviteEmail(a.data.email_address)):"user"===b&&(P.trackGAEvent("collaborator_invite_user",P.CONST.GA_ACTION_SELECT_SUBMIT),this._inviteUser({type:a.data.type,id:a.data.id,username:a.data.username})),a.stopPropagation()},onChildEnterPressed:function(a){P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_ENTER_SUBMIT),this.submit(),a.stopPropagation()},onClickInviteButton:function(a){P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_CLICK_SUBMIT),this.submit(),a.stopPropagation()},onChildContentChanged:function(a){a.stopPropagation()},submit:function(){var a=this.getChildById("typeaheadField"),b=a.getValue(),c=a.getField();if(this.options.email_supported){var d=new P.Validator(c,[P.Validator.Length({min:1}),P.Validator.Email()]);d.validate(function(a){a.errors.length>0?this.log.debug(a.errors):this._inviteEmail(b)}.bind(this))}return!1},setTypeaheadFieldValue:function(a){var b=this.getChildById("typeaheadField");b.setValue(a)},clearTypeahead:function(){var a=this.getChildById("typeaheadField");a.clear()},_inviteEmail:function(a){this.triggerEvent(P.CONST.EVENT_INVITE_EMAIL,{email:a,pending:this.options.pending},!0)},_inviteUser:function(a){var b=a.type,c=a.email?a.email:a.id;this.triggerEvent(P.CONST.EVENT_INVITE_USER,{userId:c,type:b,pending:this.options.pending,attributes:a},!0)}}),goog.provide("P.modules.BoardInvites"),goog.require("P.Module"),goog.require("P.modules.BoardInvite"),P.modules.BoardInvites=P.Module.extend({onContentReady:function(){if(!this.options.pending){var a=this.resource.options.board_id,b={};b[P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE]=this.onApprovedCollaboratorInvite,this.pubsubSubscribe(a,b)}this.childListen(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,this.onInviteeRemoved),this.boardCreateInvitees=[]},onApprovedCollaboratorInvite:function(a,b,c){this.addInvitee({type:"pinner",userId:c.userId})},onInviteeRemoved:function(a){var b=a.data.type,c=a.data.identifier;this.boardCreateInvitees=_.filter(this.boardCreateInvitees,function(a){return b!==a.type||c!==a.identifier})},getSelectedInvitees:function(a){var b=_.filter(this.boardCreateInvitees,function(b){return a===b.type});return _.pluck(b,"identifier")},hasSelectedInvitee:function(a){var b=!1;return _.each(this.boardCreateInvitees,function(c){c.type===a.type&&c.identifier===a.identifier&&(b=!0)}),b},_createPinnerBoardEditInvite:function(a){var b=a.identifier,c={resource:{name:"BoardInviteResource",options:{board_id:this.resource.options.board_id,invited_user_id:b,field_set_key:"boardEdit"}},options:{link:this.options.link_to_users_profiles}};return new P.modules.BoardInvite(c)},_createEmailBoardEditInvite:function(a){var b=a.identifier;return new P.modules.BoardInvite({options:{view_type:"email",identifier:b}})},_createPinnerBoardCreateInvite:function(a){var b=a.identifier,c={resource:{name:"UserResource",options:{user_id:b,field_set_key:"board_invite"}},options:{view_type:"boardCreate",link:this.options.link_to_users_profiles,identifier:b}};return new P.modules.BoardInvite(c)},_createEmailBoardCreateInvite:function(a){var b=a.identifier;return new P.modules.BoardInvite({options:{view_type:"email",identifier:b}})},_createFacebookBoardCreateInvite:function(a){var b=a.attributes,c=a.identifier,d=b.name,e=b.send_pin_image;return new P.modules.BoardInvite({options:{view_type:"facebook",identifier:c,name:d,image:e}})},addInvitee:function(a){var b,c=this.options.view_type,d=this.getChildById("boardInvitesPagedGrid"),e=a.type;if(this.hasSelectedInvitee(a)){var f={name:"ConfirmDialog",options:{message:P._("That user has already been invited to add Pins on this board!")}};P.loadModule(f).then(function(a){this.showInModal(a)}.bind(this))}else"boardCreate"===c?(b="email"===e?this._createEmailBoardCreateInvite(a):"facebook"===e?this._createFacebookBoardCreateInvite(a):this._createPinnerBoardCreateInvite(a),this.boardCreateInvitees.push({type:e,identifier:a.identifier})):"pinner"===e?b=this._createPinnerBoardEditInvite(a):"email"===e&&(b=this._createEmailBoardEditInvite(a));b&&b.render().then(function(){d.prependChildItem(b)})}}),goog.provide("P.modules.BoardLabel"),goog.require("P.Module"),P.modules.BoardLabel=P.Module.extend({onCreated:function(){this._DOMTextReplacerInstance=null},setSelectedStyle:function(a){this.getChildById("boardIcons").setLightColor(a)},highlightMatchedText:function(a){this.unHighlightMatchedText();var b=new RegExp(a,"i");this._DOMTextReplacerInstance=window.findAndReplaceDOMText(this.$(".nameAndIcons")[0],{find:b,replace:function(a){var b=$('<em class="highlightMatchText"></em>');return b.html(a.text),b[0]}})},unHighlightMatchedText:function(){this._DOMTextReplacerInstance&&this._DOMTextReplacerInstance.revert()}}),goog.provide("P.modules.BoardRecommendationsModule"),goog.require("P.Module"),P.modules.BoardRecommendationsModule=P.Module.extend({onContentReady:function(){this.destroyIfEmpty()},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedBoardsFeed");return!a||!a.hasItems()}}),goog.provide("P.modules.BulkBoardPicker"),goog.require("P.Form"),goog.require("P.Module"),P.modules.BulkBoardPicker=P.Module.extend({onContentReady:function(){this.form=new P.Form(this.$("form"),{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},getBoardPicker:function(){return this.getChildById("boardPicker")},getBoardId:function(){return this.getBoardPicker().getSelectedBoardId()},onSubmitValidated:function(){var a=this.getBoardId(),b=P.resourceFactory.create("BulkEditResource",{board_id:a,pin_ids:this.options.pin_ids});this.options.action_type===P.CONST.BulkAction.MOVE?b.callUpdate({showError:!0}).then(function(){for(var b=this.options.pin_ids,c=0;c<b.length;c++)P.pubsub.publish(b[c],P.CONST.PUBSUB_TOPIC_PIN_DELETED);P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED),this.showSuccessModal(a),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}.bind(this)):this.options.action_type===P.CONST.BulkAction.COPY&&b.callCreate({showError:!0}).then(function(){P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED),this.showSuccessModal(a),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}.bind(this))},showSuccessModal:function(a){var b=P.resourceFactory.create("BoardResource",{board_id:a,field_set_key:"grid_item",user_name:P.currentUser.get("username")});b.callGet().then(function(a){var b=a.resource_response.data,c={id:"pinSuccess",name:"PinCreateSuccess",options:{action:this.options.action_type,board_name:b.name,board_category:b.category,board_id:b.id,board_url:b.url,is_collaborative:b.is_collaborative,is_extension_installed:!0,privacy:b.privacy,is_bulk_action:!0}};this.showLoading(),P.loadModule(c).then(function(a){this.modal&&this.modal.setSubmodule(a)}.bind(this));var d=this.getBoardPicker(),e=P.resourceFactory.clone(d.resource);P.resourceCache.instance.callGet(e)}.bind(this))}}),goog.provide("P.modules.BusinessAccountCreate"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.Settings"),goog.require("P.modules.BackgroundImage"),P.modules.BusinessAccountCreate=P.Module.extend({CssClassName:{CANCEL_CONVERT:"cancelConvert"},onContentReady:function(){if(P.trackRegisterAction("create_business_account_loaded"),P.currentUser.isAuthenticated())if(P.currentUser.attributes.is_partner)this.navigate(P.Settings.PARTNER_GET_STARTED);else if("create"===this.options.view_type){var a={name:"ConfirmDialog",options:{template:"confirm_create_a_business"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_DIALOG_BUTTON_CLICKED,this.onConfirmClick)}.bind(this))}this.setupInspiredWall();var b={account_type:[P.Validator.Required()],business_name:[P.Validator.Required()],website_url:[P.Validator.URL()]};"create"===this.options.view_type&&(b.password=[P.Validator.Password(),P.Validator.Required()],b.email=[P.Validator.Email({}),P.Validator.Required()]);var c={};this.$form=this.$("form"),this.form=new P.Form(this.$form,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.getChildById("submitButton"),c=this.form.getData();if(b.showLoading(),"create"===this.options.view_type)P.trackRegisterAction("create_business_submit_clicked"),P.UserRegistration.register("partner",c).then(function(a){P.trackRegisterAction("create_business_signup_success"),this.log.debug("Signup success:",a),this.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0)&&(window.location="/")}.bind(this)).fin(function(){b.hideLoading()});else{var d=P.resourceFactory.create("PartnerResource",c);d.callUpdate().fin(function(){b.hideLoading()}).then(function(){this.navigate(P.Settings.PARTNER_GET_STARTED)}.bind(this))}}},setupInspiredWall:function(){this.setInspiredStory()},setInspiredStory:function(){var a=this.data.story,b=this.getChildById("bgImage_"+a.story_id);b.setActive(!0),this.loadedBackgrounds||(this.loadedBackgrounds=!0,b.setNewImage(a.bg_color,a.bg_image))},onConfirmClick:function(a){var b=$(a.data),c="";b.hasClass(this.CssClassName.CANCEL_CONVERT)?c="/":b.hasClass("continueConvert")&&(c="/logout/?next="+P.Settings.PARTNER_GET_STARTED),this.navigate(c)}}),goog.provide("P.modules.BusinessGetStartedCards"),goog.require("P.Module"),goog.require("P.fb"),goog.require("P.twttr"),goog.require("P.adTracking"),P.modules.BusinessGetStartedCards=P.Module.extend({events:{"click .dismiss":"onDismissClick"},onContentReady:function(){var a="6013056087942",b=968689080,c="NeuUCJjtygkQuIv0zQM",d="l550e";P.fb.injectTrackingPixel(a),P.AdTracking.pingGoogleConversion(b,c),P.twttr.injectTrackingPixel(d)},onDismissClick:function(a){var b=$(a.target),c=b.parents(".getStartedCard"),d=c.data("card-name"),e=P.resourceFactory.create("PartnerCardResource",{card_name:d});e.callDelete(),c.remove()}}),goog.provide("P.modules.Button"),goog.require("P.Module");var ButtonStates={ATTR_DISABLED:"disabled",SELECTOR_BUTTON_TEXT:".buttonText",SELECTOR_BUTTON_BADGE:".buttonBadge"};P.modules.Button=P.Module.extend({events:{click:"onClick"},CssClassName:{ACTIVE:"active",BADGED:"badged",DISABLED:"disabled",HIGHLIGHTED:"highlighted",SELECTED:"selected"},onClick:function(a){return a&&this.isDisabled()?(a.preventDefault(),!1):void this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)},disable:function(){this.$el.attr(ButtonStates.ATTR_DISABLED,!0).addClass(this.CssClassName.DISABLED)},enable:function(){this.$el.removeAttr(ButtonStates.ATTR_DISABLED).removeClass(this.CssClassName.DISABLED)},setEnabled:function(a){a?this.enable():this.disable()},setHighlight:function(a){this.updateOptionsAndDom({is_highlighted:a})},isDisabled:function(){return this.$el.is(":disabled")},isCancelButton:function(){return this.options.cancelButton},isSegmentedControlButton:function(){return this.options.segmented_control_button
},getText:function(){var a=this.$(ButtonStates.SELECTOR_BUTTON_TEXT).text();return a.trim()},setText:function(a){var b=a.trim();this.$(ButtonStates.SELECTOR_BUTTON_TEXT).text(b)},setAccessibilityText:function(a){var b=a.trim();this.$(".accessibilityText").text(b)},getLoadingSpinnerOptions:function(){return _.extend(P.Module.prototype.getLoadingSpinnerOptions.call(this),{size:P.Spinner.Size.SMALL})},setBadge:function(a){var b=String(a).trim();this.$(ButtonStates.SELECTOR_BUTTON_BADGE).text(b),this.$el.addClass(this.CssClassName.BADGED)},getBadgeCount:function(){var a=this.$(ButtonStates.SELECTOR_BUTTON_BADGE).text().trim();return a&&void 0!==a||(a=0),parseInt(a,10)},clearBadge:function(){this.$(ButtonStates.SELECTOR_BUTTON_BADGE).text(""),this.$el.removeClass(this.CssClassName.BADGED)},setBadgeCount:function(a){a<=0?this.clearBadge():this.setBadge(a)},setActive:function(a){this.updateOptionsAndDom({is_active:a})},setSelected:function(a){this.updateOptionsAndDom({is_selected:a})},updateDom:function(){this.$el.toggleClass(this.CssClassName.ACTIVE,!!this.options.is_active),this.$el.toggleClass(this.CssClassName.SELECTED,!!this.options.is_selected),this.$el.toggleClass(this.CssClassName.HIGHLIGHTED,!!this.options.is_highlighted)},isActive:function(){return!!this.options.is_active},_shouldShowSpinner:function(){var a=this.options.show_spinner;return void 0!==a?a:this.options.borderless&&this.options.show_text===!1?!1:!0},showLoading:function(){this.disable(),this._shouldShowSpinner()&&P.Module.prototype.showLoading.call(this)},hideLoading:function(){this.enable(),this._shouldShowSpinner()&&P.Module.prototype.hideLoading.call(this)},getLoggingObjectIdStr:function(){return this.parent?this.parent.getLoggingObjectIdStr():null},_getLabelModule:function(){return this.getChildById("label")}}),require("common/lib/external/qrcode.js"),goog.provide("P.modules.CategoriesMenu"),goog.require("P.Module");var MAX_COLUMNS=5,MIN_COLUMNS=3;P.modules.CategoriesMenu=P.Module.extend({events:{"mouseenter .appPromo":"onMouseEnterAppPromo","mouseleave .appPromo":"onMouseLeaveAppPromo","click .appPromo":"onAppPromoClick"},CssClassName:{ACTIVE:"active",SELECTED:"selected"},getItemByCategory:function(a){return this.$("a[data-category="+a+"]")},mixins:[P.Mixins.PreventScroll],onCategoryUpdated:function(a,b,c){if(this.$("a").removeClass(this.CssClassName.SELECTED),c){var d=this.getItemByCategory(c);d.length?(d.addClass(this.CssClassName.SELECTED),this.waitingMessage=null):this.waitingMessage=c}},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY]=this.onCategoryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.waitingMessage&&this.getItemByCategory(this.waitingMessage).addClass(this.CssClassName.SELECTED),P.experiments.instance.inExperimentGroups("web_jumpstart_categories_3",["enabled_dropdown","enabled_dropdown_feed","employees"])&&(this.qrCodeUrl="https://"+window.location.host+"/get-app/?s=b&i="+P.CONTEXT.unauth_id,this._drawQRCode("#a7a7a7"))},onCreated:function(){P.experiments.instance.inExperimentGroups("web_jumpstart_categories_3",["enabled_dropdown","enabled_dropdown_feed","employees"])&&this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.render)},getHeight:function(){var a=this.$(".categoriesWrapper").children(),b=0;_.each(a,function(a){var c=$(a).outerHeight();c>b&&(b=c)});var c=this.getChildByModuleName("AboutLinks");return c&&(b+=c.getHeight()),b},onMouseEnterAppPromo:function(){this.$(".appPromo").addClass(this.CssClassName.ACTIVE),this._drawQRCode("#bd081c")},onMouseLeaveAppPromo:function(){this.$(".appPromo").removeClass(this.CssClassName.ACTIVE),this._drawQRCode("#a7a7a7")},_drawQRCode:function(a){this.$(".qrCode canvas").remove(),this.$(".qrCode img").remove();var b=this.$(".qrCode"),c=new QRCode(b[0],{colorDark:a,correctLevel:QRCode.CorrectLevel.H,height:b.height(),width:b.width()});c.clear(),c.makeCode(this.qrCodeUrl)},onAppPromoClick:function(){var a={name:"AppDownloadQRCode"};P.loadModule(a).then(function(a){this.showInModal(a)}.bind(this))},render:function(){if(P.experiments.instance.inExperimentGroups("web_jumpstart_categories_3",["enabled_dropdown","enabled_dropdown_feed","employees"])){var a=Math.max(Math.min(P.bodyColumns.getBodyColumnsNeeded(),MAX_COLUMNS),MIN_COLUMNS);this.updateOptions({num_cols:a})}return P.Module.prototype.render.call(this)},animateInDropdown:function(){this.$el.hide(),this.$el.slideDown(400)},animateOutDropdown:function(a){this.$el.slideUp(400,function(){a()})}}),goog.provide("P.modules.CategoriesPage"),goog.require("P.Module"),P.modules.CategoriesPage=P.Module.extend({}),goog.provide("P.modules.CategoriesSelect"),goog.require("P.Module"),P.modules.CategoriesSelect=P.Module.extend({getValue:function(){return this.$("option:selected").val().trim()}}),goog.provide("P.modules.Category"),goog.require("P.Module"),P.modules.Category=P.Module.extend({}),goog.provide("P.modules.Checkbox"),goog.require("P.Module");var PROP_CHECKED="checked";P.modules.Checkbox=P.Module.extend({CssClassName:{IS_DISABLED:"disabled",IS_ON:"on"},onContentReady:function(){this.$input=this.$el,"fancyToggle"===this.options.view_type||"fancyCheckbox"===this.options.view_type||"flatToggle"===this.options.view_type?(this.$input=this.$("input"),this.$el.on("click",this.onFancyToggleCheckboxClick.bind(this))):this.$el.on("change",this.toggle.bind(this)),this.options.disabled===!0&&this.setDisabled(!0)},onFancyToggleCheckboxClick:function(a){var b=$(a.currentTarget).parent()[0].tagName,c="label"===b.toLowerCase(),d=!c||c&&$(a.target).is(":checkbox");d&&this.toggle()},toggle:function(){this.setChecked(!this.options.checked,!0)},setChecked:function(a,b){void 0===b&&(b=!0),a===this.options.checked||this.options.disabled||(this.options.checked=a,this.$el.toggleClass(this.CssClassName.IS_ON,a),this.$input.prop(PROP_CHECKED,a),b&&this.triggerEvent(P.CONST.EVENT_CHANGE,{checked:a},!0))},setDisabled:function(a,b){void 0===b&&(b=!0),void 0!==this.$input&&(this.options.disabled=a,this.$el.toggleClass(this.CssClassName.IS_DISABLED,a),this.$input.prop(this.CssClassName.IS_DISABLED,a),b&&this.triggerEvent(P.CONST.EVENT_CHANGE,{disabled:a},!0))},isChecked:function(){return!!this.options.checked},getCheckboxName:function(){return this.options.name}}),goog.provide("P.modules.CheckboxGroup"),goog.require("P.Module"),P.modules.CheckboxGroup=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onInputChange),this.checkboxModules=this.getChildrenByModuleName("Checkbox");var a={};_.each(this.options.items,function(b){var c=b.name;a[c]={name:c,label:b.label}}),this._checkboxes=a},onInputChange:function(a){a.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0)},getValue:function(){var a=[],b=this._checkboxes,c=0;return _.each(this.checkboxModules,function(d){var e=d.getCheckboxName();d.isChecked()&&(a[c++]={name:e,label:b[e].label})}),a}}),goog.provide("P.modules.ClippedPinVisualObject"),goog.require("P.Module"),P.modules.ClippedPinVisualObject=P.Module.extend({}),goog.provide("P.modules.CloseupAboutPinCard"),goog.require("P.Module"),P.modules.CloseupAboutPinCard=P.Module.extend({}),goog.provide("P.modules.CloseupContent"),goog.require("P.Module");var TUTORIAL_SCROLL_OFFSET=200;P.modules.CloseupContent=P.Module.extend({getPin:function(){return this.getChildById("pin")},showEditModal:function(){var a=this.getPin();return a.showEditModal()},changeCloseupContent:function(a){var b="/pin/"+a+"/";this.navigate(b)},emptyCloseupImage:function(a,b){var c=this.getChildById("pin");c&&c.emptyPaddedPin(a,b)},addTutorials:function(){this.getPin()&&this._shouldShowVisualSearchTutorial().then(function(a){a?this._showVisualSearchTutorial():P.ExperienceManager.instance().launchPlacedExperience(P.Experiences.Placement.WEB_PIN_CLOSEUP,{pin_id:this.data.id})}.bind(this))},_shouldShowVisualSearchTutorial:function(){var a=this.getPin().getFirstVisualObject()&&P.Viewport.numColumns>3;if(!a)return Promise.resolve(!1);var b={has_visual_objects:!0},c=P.ExperienceManager.instance();return c.getPlacedExperienceWithContext(P.Experiences.Placement.WEB_PIN_CLOSEUP,b).then(function(a){return a.experience_id===P.Experiences.Experience.WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED})},_showVisualSearchTutorial:function(){var a=P.Experiences.Experience.WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED,b=P.ExperienceManager.Tutorials[a];b&&this.triggerEvent(P.CONST.EVENT_SCROLL_TO_ELEMENT,{$el:this.getPin().getFirstVisualObject(),callback:function(){P.TutorialManager.instance().startTutorial(b)},scrollOffset:TUTORIAL_SCROLL_OFFSET},!0)}}),goog.provide("P.modules.CloseupRelatedBoards"),goog.require("P.Module"),P.modules.CloseupRelatedBoards=P.Module.extend({onContentReady:function(){this.destroyIfEmpty();var a=this.getChildById("relatedBoardsFeed");a&&(a.resource.options.page_size=4)},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedBoardsFeed");return!a||!a.hasItems()}}),goog.provide("P.modules.CloseupRelatedPins"),goog.require("P.Module");var ANNOTATION_BUTTON_CLASS="annotationButton";P.modules.CloseupRelatedPins=P.Module.extend({getOwnedScrollables:function(){return"relatedPinsGrid"===this.options.view_type?this.$(".pinGridWrapper"):$()},onContentReady:function(){"relatedPinsGrid"!==this.options.view_type&&this.destroyIfEmpty(),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onTypeClick)},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedPinsFeed");return!a||!a.hasItems()},getGrid:function(){return this.getChildById("relatedPinsFeed")},hideGrid:function(){this.getGrid().hide()},showGrid:function(){this.getGrid().show()},onTypeClick:function(a){var b=a.target;if(b.options.class_name===ANNOTATION_BUTTON_CLASS&&!b.isActive()){_.each(this.getChildrenByModuleName("Button"),function(a){a.setActive(a===b)}),b.showLoading();var c=b.hideLoading.bind(b);b.options.annotation?this.showAnnotatedPins(b.options.annotation,c):this.showRelatedPins(c)}},showRelatedPins:function(a){this.updateRelatedPinsGrid(P.resourceFactory.create("RelatedPinFeedResource",{pin:this.options.pin_id}),a)},showAnnotatedPins:function(a,b){this.updateRelatedPinsGrid(P.resourceFactory.create("InterestsFeedResource",{interest:a}),b)},updateRelatedPinsGrid:function(a,b){var c=this.getGrid();this.$el.css("height",this.$el.height()),c.emptyItems(),c.setItemsResource(a);var d=function(){(b||P.NOOP)(),this.$el.css("height","auto")}.bind(this);c.renderItems(d,d)}}),goog.provide("P.modules.CloseupRichPinContent"),goog.require("P.Module"),P.modules.CloseupRichPinContent=P.Module.extend({getLoggingObjectIdStr:function(){return this.resource.id},onCreated:function(){this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady)},onMapReady:function(){var a=this.getChildById("map");a&&a.addMarkerToCloseupMap()}}),goog.provide("P.modules.ConfirmDialog"),goog.require("P.Form"),goog.require("P.Module"),P.modules.ConfirmDialog=P.Module.extend({events:{"click .cancelButton":"onCloseClick","click .confirm":"onConfirmClick","change #confirmCheckbox":"onConfirmCheckboxChange"},returnData:null,onContentReady:function(){var a=this.$("form");a&&(this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(a,this.formConfig),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated));var b=this.options.auto_close_delay_ms;b&&this.closeOnDelay(b)},onConfirmCheckboxChange:function(){this.$("#confirmCheckbox").is(":checked")?this.$(".confirm").removeAttr("disabled"):this.$(".confirm").attr("disabled","disabled")},onSubmitValidated:function(a){a.errors[0]||(this.formData={},_.each(this.returnData,function(a){this.formData[a]=this.form.getValue(a)}.bind(this)),this.confirm())},onCloseClick:function(a){return this.triggerEvent(P.CONST.EVENT_DIALOG_BUTTON_CLICKED,a.currentTarget,!0),this.close(),!1},close:function(){this.triggerEvent(P.CONST.EVENT_CLOSE,this),this.destroy()},closeOnDelay:function(a){this.closeTimer&&clearTimeout(this.closeTimer),this.closeTimer=P.setTimeout(function(){this.closeTimer=null,this.destroy()}.bind(this),a)},open:function(){this.triggerEvent(P.CONST.EVENT_OPEN,this)},onConfirmClick:function(a){return this.triggerEvent(P.CONST.EVENT_DIALOG_BUTTON_CLICKED,a.currentTarget,!0),this.confirm(),!1},confirm:function(){this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_CONFIRM,this,!0),this.destroy()},setPrimaryButtonText:function(a){this.$(".primary .buttonText").text(a)},onDestroyed:function(){this.closeTimer&&clearTimeout(this.closeTimer)}}),goog.provide("P.modules.Consumer"),goog.require("P.Module"),P.modules.Consumer=P.Module.extend({events:{"click .consumerSecretText":"consumerSecretTextClicked"},consumerSecretTextClicked:function(){this.showConfirmation(this.extraData["secret-key"])},showConfirmation:function(a){var b={name:"ConfirmDialog",options:{template:"api_secret",apiSecret:a}};P.loadModule(b).then(function(a){this.showInModal(a)}.bind(this))}}),goog.provide("P.modules.ConsumerManagePage"),goog.require("P.Module"),P.modules.ConsumerManagePage=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_CONSUMER_LIST_UPDATED]=this.onListUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},showNewDialog:function(){P.loadModule({name:"ConsumerNewDialog"}).then(function(a){this.showInModal(a,{})}.bind(this))},onListUpdated:function(){this.render()}}),goog.provide("P.modules.ConsumerNewDialog"),goog.require("P.Form"),goog.require("P.Module"),P.modules.ConsumerNewDialog=P.Module.extend({onContentReady:function(){var a={name:[P.Validator.Required()],description:[P.Validator.Required()]};this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){a.errors[0]||this.createConsumer()},getFormData:function(){var a=this.$("form").serializeArray(),b={};return _.each(a,function(a){b[a.name]=a.value}),b},getSaveResource:function(a){return P.resourceFactory.create("ConsumerResource",a)},createConsumer:function(){var a=this.getFormData(),b=this.getChildById("submitButton");b.showLoading(),this.getSaveResource(a).callCreate().then(function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_CONSUMER_LIST_UPDATED),this.destroy()}.bind(this)).fin(function(){b.hideLoading()})}}),goog.provide("P.modules.ContactsList"),goog.require("P.Module"),P.modules.ContactsList=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_IMAGE_BLOCK_CLICKED,this.onListItemClick);var a={};a[P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED]=this.onSocialNetworkUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onListItemClick:function(a){var b=$(a.target),c=a.data.network;if(c){var d={success:function(){b.parents("li").remove()}};P.SocialNetworkSettingsManager.instance().handleConnect(c,!0,d)}else this.triggerEvent(P.CONST.EVENT_CONTACT_SELECTED,a.data,!0)},onSocialNetworkUpdated:function(){this.renderExistingData()}}),goog.provide("P.modules.ConversationEventMessage"),goog.require("P.Module"),P.modules.ConversationEventMessage=P.Module.extend({}),goog.provide("P.modules.ConversationListItem"),goog.require("P.Module"),P.modules.ConversationListItem=P.Module.extend({events:{click:"onListItemClick"},CssClassName:{ACTIVE:"active",ANIMATING_OUT:"animatingOut",ANIMATED_OUT:"animatedOut",UNREAD:"unread"},onListItemClick:function(a){var b=this.getChildById("hideConversation");if(b){var c=$(a.target);if(c.closest(b.getContent()).length){var d={conversation_id:this.data.id};this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,!0,!0);var e=P.resourceFactory.create("ConversationResource",d);e.callDelete({showError:!1});var f=this.$el;return f.addClass(this.CssClassName.ANIMATING_OUT),void f.one("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(){f.addClass(this.CssClassName.ANIMATED_OUT),window.setTimeout(function(){this.destroy(),this.remove(),this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,!1,!0),P.getConversationsManager().removeConversationById(this.data.id),P.getConversationsManager().logContextEvent(P.ContextLogging.EventType.CONVERSATION_HIDE,this.data.id,null,f)}.bind(this),200)}.bind(this))}}var g=this.data;if(this.triggerEvent(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,g,!0),this.options.open_conversation_on_click){this.data.unread&&this.triggerEvent(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,null,!0),this.$el.removeClass(this.CssClassName.UNREAD);var h=this.getChildById("conversationHead").getContent();P.getConversationsManager().addConversation(g,!0,h),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}},setActive:function(a){this.$el.toggleClass(this.CssClassName.ACTIVE,a)},isActive:function(){return this.$el.hasClass(this.CssClassName.ACTIVE)},getUsers:function(){return this.data.users},getUserIds:function(){return _.pluck(this.getUsers(),"id")},getOtherUsers:function(){var a=this.getUsers();return _.reject(a,function(a){return a.id===P.currentUser.get("id")})},getEmails:function(){return this.data.emails},getFirstUser:function(){var a=this.getOtherUsers();return a.length>0?a[0]:{id:this.getEmails()[0]}}}),goog.provide("P.modules.ConversationMessage"),goog.require("P.Module"),P.modules.ConversationMessage=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_PIN_DELETED,this.onAttachedObjectDeleted),this.childListen(P.CONST.EVENT_BOARD_DELETED,this.onAttachedObjectDeleted)},onAttachedObjectDeleted:function(){this.$(".msgObjectSent").remove(),this.destroy()}}),goog.provide("P.modules.ConversationMessages"),goog.require("P.Module"),goog.require("P.modules.ConversationMessage"),goog.require("P.ModuleRenderType");var ADDITIONAL_MESSAGES_TO_FETCH=5;P.modules.ConversationMessages=P.Module.extend({CssClassName:{EMPTY:"empty",HAS_OBJECT:"hasObject"},onCreated:function(){this._clientMessages=[]},onContentReady:function(){this.triggerEvent(P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL,null,!0),this._lastMessage=this.data[this.data.length-1],this.resource.set("peek",!1)},appendTextMessage:function(a,b){var c=this._createMessageWrapper(),d={is_own_message:!0,text:a,pending:!0},e=new P.modules.ConversationMessage({options:d});e.render().then(function(){this._appendMessage(c,e),b&&b()}.bind(this))},_appendMessage:function(a,b){b.getContent().appendTo(a),a.appendTo(this.$el),this.removeEmptyState(),this._clientMessages.push(b)},removeEmptyState:function(){this.$(".emptyState").remove(),this.$el.removeClass(this.CssClassName.EMPTY)},_deleteClientMessage:function(a){if(!a.destroyed){var b=a.getParentElement();a.destroy(),b.remove()}},_deleteAllClientMessages:function(){this._clientMessages.forEach(function(a){this._deleteClientMessage(a)}.bind(this)),this._clientMessages=[]},deleteLastClientMessage:function(){this._deleteClientMessage(this._clientMessages[this._clientMessages.length-1]),this._clientMessages.pop()},_createMessageWrapper:function(){return $('<li class="messageWrapper"></li>')},getBottomPosition:function(a){var b=this.children[this.children.length-a],c=b.getContent(),d=c.parent(),e=d.position().top;return e},fetchPrevMessages:function(a,b,c){if(this.acquireRenderLock()){var d=function(){this.releaseRenderLock(),this.setPreventEmpty(!0),c&&c()}.bind(this);this.resetLastMessageTime(),this.renderAdditional(P.ModuleRenderType.PREPEND).then(a,b).fin(d)}},fetchNewMessages:function(a,b,c){if(this.acquireRenderLock()){var d=this.resource,e=P.resourceFactory.clone(this.resource);e.resetBookmark(),this._lastMessage?(e.set("last_message_id",this._lastMessage.id),e.set("page_size",a+ADDITIONAL_MESSAGES_TO_FETCH)):e.set("page_size",a),e.set("peek",b||!1),this.setResource(e),this.setPreventEmpty(!0),this.setLastMessageTime(),this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.data.length&&(this._lastMessage=this.data[this.data.length-1]),this._deleteAllClientMessages(),c&&c()}.bind(this)).fin(function(){this.releaseRenderLock(),this.setResource(d)}.bind(this))}},setPreventEmpty:function(a){this.options.prevent_empty=a},setLastMessageTime:function(){this._lastMessage&&(this.options.last_message_time=this._lastMessage.created_at)},resetLastMessageTime:function(){this.options.last_message_time=0},renderMessages:function(a){this.acquireRenderLock()&&(this.setPreventEmpty(!0),this.resetLastMessageTime(),this.render().then(function(){this._deleteAllClientMessages(),a&&a()}.bind(this)).fin(function(){this.releaseRenderLock()}.bind(this)))},markMessagesAsRead:function(a){var b=P.resourceFactory.clone(this.resource);b.resetBookmark(),b.set("page_size",a),b.set("peek",!1),b.callGet()},acquireRenderLock:function(){return this._rendering?!1:(this._rendering=!0,!0)},releaseRenderLock:function(){this._rendering=!1},appendObjectMessage:function(a,b){var c=$('<li class="messageWrapper"></li>'),d={is_own_message:!0,pending:!0},e=new P.modules.ConversationMessage({options:d});e.render().then(function(){this._appendMessage(c,e),e.getContent().append(a).addClass(this.CssClassName.HAS_OBJECT).appendTo(c),b&&b()}.bind(this))},updateTimestamps:function(){var a=this.getChildrenByModuleName("ConversationMessage");a.forEach(function(a){var b=a.getParentElement().next(".timeSeparator");b.length&&b.text(P.getHumanizedTimesince(a.data.created_at))})}}),goog.provide("P.modules.ConversationPopup"),goog.require("P.Module"),goog.require("P.modules.ConversationMessages");var MIN_REQUEST_MORE_SCROLL_THRESHOLD=220,MAX_SCROLL_DISTANCE_TO_SCROLL_TO_BOTTOM_AFTER_MESSAGE=35;P.modules.ConversationPopup=P.Module.extend({mixins:[P.Mixins.PreventScroll],events:{"click .convosHeader":"onHeaderClick"},CssClassName:{VISIBLE:"visible"},onCreated:function(){this._unseenMessageCount=0},onHeaderClick:function(){P.getConversationsManager().closeConversationById(this.options.id)},onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onInputEnterPressed),this.childListen(P.CONST.EVENT_TEXT_INPUT_RESIZED,this.onInputSizeChanged),this.childListen(P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL,this.onConversationMessagesReady),this.startPreventingScroll(),this.listen(this,P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN,this.onShownInDropdown),this.onMessagesScroll=this.onMessagesScroll.bind(this),this.onMessagesScroll=_.throttle(this.onMessagesScroll,200),this.scrollToLatest(),this._scrollListener=this.listen(this.getConversationMessagesList(),"scroll",this.onMessagesScroll)},onConversationMessagesReady:function(){this.options.peek&&this.data.unread&&(this._shouldMarkAsReadOnOpen=!0),this.showEmailSentIfNecessary(),this.scrollToLatest()},showEmailSentIfNecessary:function(){var a=this.data.emails||[],b=1===a.length&&a[0]===P.currentUser.get("email"),c=this.$(".ConversationMessage").length;if(a.length>0&&!b&&c>0&&c<=3){var d=this.$(".emailSentText");d.show()}},getConversationMessagesList:function(){return this.$(".conversationMessagesList")},getConversationMessagesModule:function(){return this.getChildByModuleName("ConversationMessages")},onInputSizeChanged:function(a){if("textField"===a.target.id){var b=this.getChildById("textField").getHeight(),c=this.$(".messagesContainer");c.css("bottom",b+"px"),this.isScrolledToBottom()&&this.scrollToLatest()}},startPreventingScroll:function(){var a=this.getConversationMessagesModule();a&&this.startPreventScroll(this.getConversationMessagesList(),this.$(".messagesContent"))},_getSpinner:function(){return this.$(".spinner")},setUnseenMessageCount:function(a){this._unseenMessageCount=this._unseenMessageCount+a},onMessagesScroll:function(){if(this._unseenMessageCount){var a=this.getConversationMessagesModule(),b=a.getBottomPosition(this._unseenMessageCount);b<=this.getConversationMessagesList().height()&&(this._unseenMessageCount=Math.max(this._unseenMessageCount-1,0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,1),this.triggerEvent(P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE,null,!0))}if(this.getConversationMessagesList().scrollTop()<=MIN_REQUEST_MORE_SCROLL_THRESHOLD){this._getSpinner().addClass(this.CssClassName.VISIBLE);var c=this.getConversationMessagesModule(),d=c.getHeight();c.fetchPrevMessages(function(){var a=c.getHeight();a!==d&&(this.startPreventingScroll(),this.getConversationMessagesList().scrollTop(a-d))}.bind(this),null,function(){this._getSpinner().removeClass(this.CssClassName.VISIBLE)}.bind(this))}},onShownInDropdown:function(){var a=this.$(".ConversationMessages");a.off("click",$.proxy(this._focusInput,this)),a.on("click",$.proxy(this._focusInput,this)),this.scrollToLatest();var b=this.getConversationMessagesModule();b&&(b.updateTimestamps(),this._shouldMarkAsReadOnOpen&&(b.markMessagesAsRead(this.data.unread),this._shouldMarkAsReadOnOpen=!1))},getDropTarget:function(){return this.$(".dropTarget")},scrollToLatest:function(){this.getConversationMessagesModule()&&(this.getConversationMessagesList().scrollTop(this.getConversationMessagesModule().getHeight()),this.startPreventingScroll())},setDropTargetText:function(a){var b=this.getDropTarget(),c=b.find("p");c.text(a)},focus:function(){return this._focusInput()},_focusInput:function(){var a=this.getChildById("textField");a&&a.focus()},onInputEnterPressed:function(a){a.stopPropagation();var b=$.trim(a.target.getValue());b.length&&(this.sendMessage(b,null),this.clearInput())},clearInput:function(){var a=this.getChildById("textField");a.setValue("")},showDropTarget:function(){this.getDropTarget().addClass(this.CssClassName.VISIBLE)},hideDropTarget:function(){this.getDropTarget().removeClass(this.CssClassName.VISIBLE)},sendMessage:function(a,b){if(a||!_.isEmpty(b)){var c=this.options.id,d={};if(a&&(d.text=a),b){var e=b.data;d.object_type=e.type,d.object_id=e.id}if(P.currentUser&&!P.currentUser.isWriteBanned()){var f=this.getConversationMessagesModule(),g=this.isScrolledToBottom()?this.scrollToLatest.bind(this):P.NOOP;b?f.appendObjectMessage(b.getContent().clone(),g):f.appendTextMessage(a,g)}P.getConversationsManager().sendMessageToConversation(c,d).then(function(){this.fetchNewMessages(1),this.focus(),P.getConversationsManager().logContextEvent(P.ContextLogging.EventType.CONVERSATION_MESSAGE_SEND,c,b?b.data.id:null,this.$el)}.bind(this),function(){this.getConversationMessagesModule().deleteLastClientMessage()}.bind(this))}},isScrolledToBottom:function(){var a=this.getConversationMessagesList(),b=this.getConversationMessagesModule(),c=a.scrollTop(),d=a.height(),e=b.getHeight(),f=c+d+MAX_SCROLL_DISTANCE_TO_SCROLL_TO_BOTTOM_AFTER_MESSAGE;return f>=e},fetchNewMessages:function(a,b){var c=this.getConversationMessagesModule();if(c){var d=this.isScrolledToBottom();b&&(this._shouldMarkAsReadOnOpen=!0),c.fetchNewMessages(a,b,function(){this.showEmailSentIfNecessary(),d?this.scrollToLatest():this.ensureScrollbarFlash()}.bind(this))}},ensureScrollbarFlash:function(){var a=this.getConversationMessagesList();a.flashScrollbar()},renderMessages:function(){var a=this.getConversationMessagesModule();a&&a.renderMessages(function(){this.showEmailSentIfNecessary(),this.scrollToLatest()}.bind(this))},onButtonClick:function(a){var b=a.target;("closeChatButton"===b.id||"joinToReplyButton"===b.id)&&(P.getConversationsManager().closeConversationById(this.options.id),a.stopPropagation())}}),goog.provide("P.modules.ConversationsList"),goog.require("P.Module"),P.modules.ConversationsList=P.Module.extend({onCreated:function(){this._preventRenderOnChange=!1,this.childListen(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,this.onPreventConversationsRenderingOnChange),this.childListen(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,this.onUnreadListItemClick)},onPreventConversationsRenderingOnChange:function(a){this._preventRenderOnChange=a.data},onUnreadListItemClick:function(a){var b=a.target.data.id,c=this.model.getData(),d=_.find(c,function(a){return a.id===b});if(d){var e=_.indexOf(c,d);d.unread=0,c[e]=d;var f=c.slice(0);this.model.set(f),this.renderExistingData()}},onContentReady:function(){var a=!this.options.no_rerender;a&&!this.modelListener&&(this.modelUpdateHandler=_.debounce(this.onCollectionAddRemoveChange.bind(this),100),this.initialModel=this.model,this.modelListener=this.initialModel.on("add change remove",this.modelUpdateHandler)),this.data.length||this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY,null,!0)},onRemovedFromDom:function(){this.modelListener&&this.modelUpdateHandler&&this.model.off("add change remove",this.modelUpdateHandler)},onCollectionAddRemoveChange:function(){this.options.no_rerender||this._preventRenderOnChange||this._fetchingMore||(this.model!==this.initialModel&&(this.model=this.initialModel,this.resource.resetBookmark()),this.renderExistingData())},setListItemWithUserId:function(a,b){var c=this.getChildById("list");if(c){var d=c.children;_.each(d,function(c,e){_.each(c.data.users,function(c){c.id===a&&d[e].setActive(b)}),_.each(c.data.emails,function(c){c===a&&d[e].setActive(b)})})}},fetchMore:function(){this._fetchingMore||this.resource.atEnd()||(this.resource.get("bookmarks")||this.resource.setBookmarks(P.getConversationsManager().getConversationsBookmarks()),this._fetchingMore=!0,this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){P.setTimeout(function(){this._fetchingMore=!1}.bind(this),200)}.bind(this)))}}),goog.provide("P.modules.ConversationsListDropdown"),goog.require("P.Module");var CONVERSATION_LIST_ID="conversationList";P.modules.ConversationsListDropdown=P.Module.extend({onCreated:function(){this.onConversationsScroll=this.onConversationsScroll.bind(this),this.onConversationsScroll=_.throttle(this.onConversationsScroll,200)},onContentReady:function(){this._scrollListener=this.listen(this.$(".convosContent"),"scroll",this.onConversationsScroll)},onConversationsScroll:function(a){var b=$(a.target).scrollTop(),c=this._getList(),d=c.getHeight();d-b<=this.$(".convosContent").height()+10&&c.fetchMore()},_getList:function(){return this.getChildById(CONVERSATION_LIST_ID)}}),goog.provide("P.modules.CsrfErrorPage"),goog.require("P.Module"),P.modules.CsrfErrorPage=P.Module.extend({}),goog.provide("P.modules.DeactivateAccount"),goog.require("P.Form"),goog.require("P.Module"),P.modules.DeactivateAccount=P.Module.extend({events:{"change input":"onChange"},onContentReady:function(){var a={reason:[P.Validator.Required()]};this.form=new P.Form(this.$("form"),a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.submitButton=this.getChildById("submitButton"),this.submitButton.disable()},onButtonClick:function(a){var b=a.target;"deleteButton"===b.id&&this.deleteAccountConfirm()},onSubmitValidated:function(a){a.errors[0]||this.deactivateAccount()},onChange:function(a){this.submitButton.enable();var b=$(a.target);this._reason=b.attr("value"),this.hideShowDetails()},hideAll:function(){this.$(".hiddenText").hide(),this.$(".hiddenTextArea").hide()},hideShowDetails:function(){switch(this.hideAll(),this._reason){case"emails":this.$("#emailSettings").show();break;case"other":this.$("#otherText").show();break;case"hacked":this.$("#resetPassword").show();break;case"pins":this.$("#explore").show(),this.$("#exploreBox").show();break;case"break":this.$("#access").show();break;case"secondAccount":this.$("#infoMultipleAccounts").show();break;case"business":this.$("#businessLink").show();break;case"dislike":this.$("#dislikeText").show(),this.$("#dislikeBox").show();break;case"understand":this.$("#understandText").show(),this.$("#understandBox").show();break;case"privacy":this.$("#privacyText").show(),this.$("#privacyBox").show()}},deactivateAccount:function(){this.submitButton.showLoading();var a={user_id:P.currentUser.id,reason:this.$('input:radio[name="reason"]:checked').val()};"other"===a.reason?a.explanation=this.$('textarea[name="otherText"]').val():"privacy"===a.reason?a.explanation=this.$('textarea[name="privacyTextBox"]').val():"dislike"===a.reason?a.explanation=this.$('textarea[name="dislikeTextBox"]').val():"explore"===a.reason?a.explanation=this.$('textarea[name="exploreTextBox"]').val():"understand"===a.reason&&(a.explanation=this.$('textarea[name="understandTextBox"]').val());
var b=P.currentUser.get("email"),c={name:"ConfirmDialog",options:{template:"deactivate_account_success",view_type:"mediumWide",email:b}},d=P.resourceFactory.create("DeactivateAccountResource",a);d.callCreate().fin(function(){P.loadModule(c).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(a,P.CONST.EVENT_DESTROYED,this.successCancel)}.bind(this))}.bind(this)).fail(function(a){P.showError(a.message)}).always(function(){this.submitButton.hideLoading()}.bind(this))},successCancel:function(){this.navigate("/"),this.destroy()},deleteAccountConfirm:function(){var a={name:"ConfirmDialog",options:{email:P.currentUser.get("email"),is_partner:P.currentUser.get("is_partner"),template:"delete_account_confirm",view_type:"mediumWide"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(a,P.CONST.EVENT_CONFIRM,this.deleteAccount)}.bind(this))},deleteAccount:function(){var a={name:"ConfirmDialog",options:{template:"delete_account_success",view_type:"mediumWide"}},b={user_id:P.currentUser.id},c=P.resourceFactory.create("DeleteAccountResource",b);c.callUpdate().fin(function(){P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(a,P.CONST.EVENT_DESTROYED,this.successCancel)}.bind(this))}.bind(this)).fail(function(a){P.showError(a.message)})}}),goog.provide("P.modules.Domain"),goog.require("P.Module"),P.modules.Domain=P.Module.extend({getLoggingObjectIdStr:function(){return this.data.id}}),goog.provide("P.modules.DomainFeedPage"),goog.require("P.Module"),P.modules.DomainFeedPage=P.Module.extend({onContentReady:function(){this.checkGridContent()},checkGridContent:function(){var a=this.getChildById("feedGrid");a.hasItems()||this.$(".noData").show()}}),goog.provide("P.modules.DomainVerify"),goog.require("P.Form"),goog.require("P.Module"),P.modules.DomainVerify=P.Module.extend({events:{"click .helpText a":"onClickType","click .downloadLink":"onClickDownload"},onCreated:function(){this.METATAG="metatag",this.FILENAME="filename",this.verificationType=this.METATAG},onContentReady:function(){this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),[]),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.downloadButton=this.getChildById("downloadButton"),this.downloadButton&&this.listen(this.downloadButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickDownload)},onClickType:function(){this.swapVerificationType()},onClickDownload:function(){P.downloadFile("/website/verify/download/")},onSubmitValidated:function(a){a.errors[0]||this.verifyDomain()},swapVerificationType:function(){this.$(".filename, .metaTag").toggle(),this.verificationType=this.verificationType===this.METATAG?this.FILENAME:this.METATAG},showError:function(a){this.$(".errorReason").text(a),this.$(".errorSection").show()},hideError:function(){this.$(".errorSection").hide()},waitForVerification:function(a){return new Promise(function(b,c){var d=P._("Looks like we had trouble connecting to your website."),e=P.currentUser.attributes.domain_url,f=P.resourceFactory.create("DomainResource",{field_set_key:"owner",domain:e});a=a||3;var g=0,h=function(){return g>=a?(P.showError(d),void c(void 0)):(g+=1,void f.callGet().then(function(a){var e=a.resource_response;if(!e.error)if(e.data.official_user){if(e.data.official_user.id!==P.currentUser.attributes.id)return P.showError(d),void c(void 0);this.isInModal()?(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_USER_UPDATED),P.pubsub.publish(P.currentUser.attributes.id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),this.destroy()):this.navigate("/"),b(void 0)}else P.setTimeout(h,200)}.bind(this),function(){c(void 0)}))}.bind(this);P.setTimeout(h,200)}.bind(this))},verifyDomain:function(){var a=this.getChildById("submitButton");a.showLoading(),this.hideError();var b={type:this.verificationType},c=P.resourceFactory.create("DomainVerifyResource",b);c.callUpdate().then(function(){return this.waitForVerification()}.bind(this)).fin(function(){a.hideLoading()})}}),goog.provide("P.modules.DomainVerifyByLink"),goog.require("P.Module"),goog.require("P.Settings"),P.modules.DomainVerifyByLink=P.Module.extend({onContentReady:function(){var a,b="",c="",d="";null!==this.options.domain?(b=P.string.format(P._("Congratulations! Check out your analytics page to see how  popular your Pins are on Pinterest.")),c=P._("Go To Analytics"),d=P._("Website verified")):(b=P.string.format(P._("Oops! We weren't able to verify your website. Write to us at the help center for more information.")),c=P._("Go to the help center"),d=P._("Trouble verifying your website")),a={name:"ConfirmDialog",options:{body_message:b,button_text:c,template:"generic",title:d}},P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.onConfirmClick)}.bind(this))},onConfirmClick:function(){var a="";a=null===this.options.domain?"/_/_/help/":P.Settings.ANALYTICS_SITE_URL,this.navigate(a)}}),goog.provide("P.modules.Dropdown2"),goog.require("P.Module"),P.modules.Dropdown2=P.Module.extend({CssClassName:{VISIBLE:"visible"},onCreated:function(){this._renderedContent=!1},initHovering:function(){},slideIn:function(){return this.show()},render:function(){return Promise.resolve()},show:function(){return this.$el.insertBefore(this.options.anchor),this.$el.addClass(this.CssClassName.VISIBLE),this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0),this._removeBodyListener(),this._bodyListener=this.listen($(document),"mousedown",this._onMouseDown),this._renderedContent?Promise.resolve():(this._renderedContent=!0,P.loadModule(this.options.module).then(function(a){this.appendChild(a),a.render().then(function(){P.deferDomManipulation(function(){a.focus()})})}.bind(this)))},hide:function(){this._removeBodyListener(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),this.$el.removeClass(this.CssClassName.VISIBLE)},_removeBodyListener:function(){this._bodyListener&&(this.removeListener(this._bodyListener),this._bodyListener=null)},_onMouseDown:function(a){a.preventDefault(),a.stopPropagation();var b=this.options.mouse_close_mode;switch(b){case"never":break;case"always":this.hide();break;default:var c=$(a.target).closest(this.$el).length>0||$(a.target).closest(this.options.anchor).length>0;c||this.hide()}},getContentModule:function(){return this.children[0]},isVisible:function(){return this.$el.hasClass(this.CssClassName.VISIBLE)},hideDropdown:function(){},showDropdown:function(){}}),goog.provide("P.modules.Echo"),goog.require("P.Module"),P.modules.Echo=P.Module.extend({}),goog.provide("P.modules.Editorial"),goog.require("P.Module"),P.modules.Editorial=P.Module.extend({}),goog.provide("P.modules.EmailContact"),goog.require("P.Module"),P.modules.EmailContact=P.Module.extend({events:{"click .check":"_onClickCheck",click:"_onClick"},CssClassName:{DISABLED:"disabled"},_onClickCheck:function(a){a.stopPropagation()},_onClick:function(){this.getChildById("check").setChecked(!this.isChecked(),!0)},setChecked:function(a){this.getChildById("check").setChecked(a,!1)},isChecked:function(){return this.getChildById("check").isChecked()},setDisabled:function(a){this.getChildById("check").setDisabled(a,!1),$(this.el).toggleClass(this.CssClassName.DISABLED,a)},getEmail:function(){return this.options.email_contact.id}}),goog.provide("P.modules.EmailVerificationError"),goog.require("P.Module"),P.modules.EmailVerificationError=P.Module.extend({}),goog.provide("P.modules.Embed"),goog.require("P.Module"),P.modules.Embed=P.Module.extend({onContentReady:function(){$("head").append($("<script></script>").attr({async:!0,src:"//assets.pinterest.com/js/pinit.js"}));var a=this.$(".sampleCode textarea");a.focus(),a.select()}}),goog.provide("P.modules.EmbedBoard"),goog.require("P.modules.Embed"),P.modules.EmbedBoard=P.modules.Embed.extend({}),goog.provide("P.modules.EmbedPinner"),goog.require("P.modules.Embed"),P.modules.EmbedPinner=P.modules.Embed.extend({}),goog.provide("P.modules.EmptyConversations"),goog.require("P.Module"),P.modules.EmptyConversations=P.Module.extend({onContentReady:function(){var a=this.getChildrenByModuleName("ConversationHead");_.each(a,function(a){this.listen(a,P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,this.onConversationHeadClick)}.bind(this)),(!this.data||this.data.length<3)&&this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS,null,!0)},onConversationHeadClick:function(a){var b=a.target;b.showLoading();var c=b.getUserIds(),d=P.resourceFactory.create("ConversationsResource",{user_ids:c});d.callCreate().then(function(a){var c=a.resource_response.data;P.getConversationsManager().addConversation(c),b.hideLoading(),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.render()}.bind(this))}}),goog.provide("P.modules.EmptyHomeFeedFallback"),goog.require("P.Module"),P.modules.EmptyHomeFeedFallback=P.Module.extend({}),goog.provide("P.modules.EmptyStateCard"),goog.require("P.Module");var SELECTORS={FOOTER:"footer",HEADER:"header",CENTER_CONTENT:".centerContent",ACTION_BUTTON:".actionButton"};P.modules.EmptyStateCard=P.Module.extend({_hideItem:function(a){this.$el.find(a).hide()},_showItem:function(a){this.$el.find(a).show()},_setVisibility:function(a,b){return b?this._showItem(a):this._hideItem(a)},setHeaderIsVisible:function(a){var b=SELECTORS.HEADER;this._setVisibility(b,a)},setCenterContentIsVisible:function(a){var b=SELECTORS.CENTER_CONTENT;this._setVisibility(b,a)},setFooterIsVisible:function(a){var b=SELECTORS.FOOTER;this._setVisibility(b,a)},setActionButtonIsVisible:function(a){var b=SELECTORS.ACTION_BUTTON;this._setVisibility(b,a)}}),goog.provide("P.modules.EmptyStateCardProfileBoards"),goog.require("P.modules.EmptyStateCard"),P.modules.EmptyStateCardProfileBoards=P.modules.EmptyStateCard.extend({}),goog.provide("P.modules.EmptyStateCardProfileFollowers"),goog.require("P.modules.EmptyStateCard"),P.modules.EmptyStateCardProfileFollowers=P.modules.EmptyStateCard.extend({}),goog.provide("P.modules.EmptyStateCardProfileFollowing"),goog.require("P.modules.EmptyStateCard"),P.modules.EmptyStateCardProfileFollowing=P.modules.EmptyStateCard.extend({}),goog.provide("P.modules.EvalFeedPage"),goog.require("P.Module"),P.modules.EvalFeedPage=P.Module.extend({}),goog.provide("P.modules.FacebookContact"),goog.require("P.Module"),P.modules.FacebookContact=P.Module.extend({events:{click:"_onClick"},_onClick:function(){this.getChildById("invite").showLoading(),P.Invite.userInviteFacebook(this.options.facebook_contact.id,this._onInvite.bind(this))},_onInvite:function(a){this.getChildById("invite").hideLoading(),a&&this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)}}),goog.provide("P.modules.FacebookShareButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.FacebookShareButton=P.modules.Button.extend({onClick:function(){if(P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this);else{var a=this.options.ga_category||"share_facebook";P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK);var b=this.options.dialog_options||{};b.callback=function(){var a=P.ContextEvent.fromEventType(P.ContextLogging.EventType.PIN_SHARE_FACEBOOK);this.options&&this.options.object_id&&a.setObjectIdStr(this.options.object_id),P.ContextLogger.getInstance().addEvent(a)}.bind(this),"sharer_php"===this.options.fb_sharer&&(b.type="sharer_php"),this.options&&this.options.dialog_options&&this.options.dialog_options.object_type&&P.trackRegisterAction("facebook_share_dialog_open_"+this.options.dialog_options.object_type),P.FacebookDialog.open(b),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)}return!1}}),goog.provide("P.modules.FastFollowHeader"),goog.require("P.Module");var FAST_FOLLOW_PROGRESS_ID="followPageProgress";P.modules.FastFollowHeader=P.Module.extend({stepProgress:function(a){var b=this.getChildById(FAST_FOLLOW_PROGRESS_ID);b&&b.moveStep(a)}}),goog.provide("P.modules.FastFollowSidebar"),goog.require("P.Module"),P.modules.FastFollowSidebar=P.Module.extend({events:{"click .followPageSidebarCategory":"onCategoryClick"},CssClassName:{EXPAND:"expand",SELECTED:"selected"},onCreated:function(){var a={};a[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.toggleShowMoreCategories)},onCategoryClick:function(a){var b=$(a.currentTarget);if(b.length){var c=b.attr("data-category");c.length&&(this.highlightCategory(c),this.triggerEvent(P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED,c,!0))}},onSearchQueryUpdated:function(a,b,c){var d=c||"";this.unhighlightCategory(),this.triggerEvent(P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED,d,!0)},unhighlightCategory:function(){this.$("."+this.CssClassName.SELECTED).removeClass(this.CssClassName.SELECTED)},highlightCategory:function(a){this.unhighlightCategory(),this.$("[data-category="+a+"]").addClass(this.CssClassName.SELECTED)},toggleShowMoreCategories:function(){return this.$el.toggleClass(this.CssClassName.EXPAND),!1}}),goog.provide("P.modules.FeedPage"),goog.require("P.Module"),P.modules.FeedPage=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY,this.options.feed)},_resetCategory:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY,null)},onRemoved:function(){this._resetCategory()},onEmpty:function(){this._resetCategory()}}),goog.provide("P.modules.Field"),goog.require("P.Module"),P.modules.Field=P.Module.extend({events:{"focus input":"onInputFocus","blur input":"onInputBlur","keyup input":"onInputKeyup"},onContentReady:function(){this.$input=this.$("input"),this._value=this.options.value||"",this._field=this.getChildById("input"),this.options.currency_symbol&&this.format_as_currency()},onInputFocus:function(a){if(this.options.currency_symbol){var b=$(a.currentTarget);b.length&&b.val((this._value||"").toString())}},onInputBlur:function(){this.options.currency_symbol&&this.format_as_currency()},format_as_currency:function(){if(this.$input.length){var a=this.$input.val(),b=parseFloat(a),c=P.number.quantize(b,2);this._value=c,this.$input.val(c?c.toFixed(2):a)}},disable:function(){this.$input.attr({disabled:""})},enable:function(){this.$input.removeAttr("disabled")},isDisabled:function(){return this.$input.is(":disabled")},onInputKeyup:function(){},setValue:function(a){this._field.setValue(a),this.options.currency_symbol&&(this._value=a)},getValue:function(){return this.options.currency_symbol?this._value.toString()||"0":this._field.getValue()},setPlaceholder:function(a){this.$input.attr("placeholder",a)}}),goog.provide("P.modules.FillHomeFeed"),goog.require("P.Module"),P.modules.FillHomeFeed=P.Module.extend({}),goog.provide("P.modules.FindFriendsContent"),goog.require("P.Module"),P.modules.FindFriendsContent=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),P.ExperienceManager.instance().refreshPlacedExperiences()},onButtonClick:function(a){var b=a.target,c=null;switch(b.id){case"facebookConnectButton":c=P.SocialConnect.FACEBOOK;break;case"twitterConnectButton":c=P.SocialConnect.TWITTER;break;default:return}this.startNetworkConnect(c)},getGrid:function(){return this.getChildById("friendGrid")},startNetworkConnect:function(a){var b;switch(a){case P.SocialConnect.FACEBOOK:b=this.getChildById("facebookConnectButton");break;case P.SocialConnect.TWITTER:b=this.getChildById("twitterConnectButton");break;default:return}b.showLoading();var c=P.SocialNetworkSettingsManager.instance(),d={success:function(){var d=_.isUndefined(this.options.exclude_following)?!0:this.options.exclude_following,e={username:this.options.username,exclude_following:d},f={success:function(c){b.hideLoading(),this.resource=c,this.render().then(function(){this.triggerEvent(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,{network:a},!0)}.bind(this))}.bind(this),error:function(){b.hideLoading(),this.hideLoading(),this.render()}.bind(this),resourceOptions:e};c.pollForFriends(a,f)}.bind(this),error:function(){b.hideLoading(),this.hideLoading()}.bind(this)};c.handleConnect(a,!0,d)}}),goog.provide("P.modules.FindFriendsNotConnected"),goog.require("P.Module"),P.modules.FindFriendsNotConnected=P.Module.extend({}),goog.provide("P.modules.FindFriendsRep"),goog.require("P.Module"),P.modules.FindFriendsRep=P.Module.extend({events:{click:"onClick"},onClick:function(a){P.currentUser.isLimitedLogin()&&(a.stopPropagation(),a.preventDefault(),P.limitedLogin.showLogin(this))}}),goog.provide("P.modules.FindFriendsWhosHere"),goog.require("P.Module"),P.modules.FindFriendsWhosHere=P.Module.extend({}),goog.provide("P.modules.FlagComment"),goog.require("P.Form"),goog.require("P.Module"),P.modules.FlagComment=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={reason:[P.Validator.Required()]},c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_REPORT_REASON_SELECTED,this._onReportReasonSelected);var d=this.getChildById("submitButton");d.disable()},onSubmitValidated:function(a){a.errors[0]||this.flagComment()},_onReportReasonSelected:function(){var a=this.getChildById("submitButton");a.enable()},flagComment:function(){var a=this.getChildById("submitButton");a.showLoading();var b={pin_id:this.options.pin_id,comment_id:this.options.comment_id,reason:this.$("form :checked").attr("value")};"other"===b.reason&&(b.explanation=this.$("textarea").val()),P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_CLICK_SUBMIT,"reason",b.reason);var c=P.resourceFactory.create("CommentFlagResource",b);c.callCreate().then(function(){P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_SUCCESS),this.destroy()}.bind(this),function(){P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_ERROR)}).fin(function(){a.hideLoading()})}}),goog.provide("P.modules.FlagContent"),goog.require("P.Module"),P.modules.FlagContent=P.Module.extend({events:{"change input":"onChange"},CssClassName:{ACTIVE:"active"},onCreated:function(){this.listen(this,"change",this.checkIfOtherIsSelected)},onChange:function(a){var b=this.options,c=$(a.target),d=c.siblings("label");if(this._reason=c.attr("id"),this._reasonNoun=d.text(),this.checkIfOtherIsSelected(),this.triggerEvent("change",this,!0),"blockInput"===b.class_name&&this.updateLabel(c),b.reason=this._reason,b.reason_noun=this._reasonNoun,this.options.show_confirmation_on_change){var e={name:"FlagContentConfirm",options:b};P.loadModule(e).then(function(a){var c;"user"===b.object_flagged?c="user_flag":"pin"===b.object_flagged?c="pin_flag":"comment"===b.object_flagged&&(c="comment_flag"),c&&P.trackGAEvent(c,P.CONST.GA_ACTION_OPEN_MODAL,"reason",this._reason),this.hideLoading(),this.showInModal(a)}.bind(this))}},updateLabel:function(a){var b=$(a),c=b.siblings("label");this.$("."+this.CssClassName.ACTIVE).removeClass(this.CssClassName.ACTIVE),c.addClass(this.CssClassName.ACTIVE)},checkIfOtherIsSelected:function(){"harasses-category"===this._reason&&this.$(".reportCategoryItems").show(),"harasses-category"!==this._reason&&"harasses-mechildren"!==this._reason&&"harasses-someoneelse"!==this._reason&&"hateful-togroup"!==this._reason&&this.$(".reportCategoryItems").hide(),this.triggerEvent(P.CONST.EVENT_REPORT_REASON_SELECTED,this.$el,this._reason)}}),goog.provide("P.modules.FlagContentConfirm"),goog.require("P.Form"),goog.require("P.Module");var GA_CATEGORY="user_flag";P.modules.FlagContentConfirm=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={};this.options.show_explanation&&(b={explanation:[P.Validator.Required(),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_TITLE})]});var c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.target;b&&("cancelButton"===b.id?P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_CLICK_CANCEL):"reportButton"===b.id&&P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_CLICK_SUBMIT))},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.options.object_flagged;"user"===b?this.reportUser():"conversation"===b&&this.reportConversation()}},onReportUserSuccess:function(){var a={name:"ConfirmDialog",options:{template:"flag_user_success"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.onFlagConfirm)}.bind(this))},onFlagConfirm:function(){this.destroy()},removeConversation:function(a){var b={conversation_id:a},c=P.resourceFactory.create("ConversationResource",b);c.callDelete().then(function(){P.getConversationsManager().scaleConversationDownAndRemove(a)})},reportConversation:function(){var a=this.options;a.conversation_id=a.conversation.id;var b=P.resourceFactory.create("ConversationReportResource",a);b.callCreate().then(function(){this.onReportUserSuccess(),this.removeConversation(a.conversation_id),P.getModalManager().removeAllModals(),this.destroy()}.bind(this),function(){P.getModalManager().removeAllModals(),this.destroy()}.bind(this))},reportUser:function(){var a=this.options.user_id,b={reported_user:a,reason:this.options.reason};this.options.show_explanation&&(b.explanation=this.$("textarea").val());var c=P.resourceFactory.create("UserReportResource",b);c.callCreate().then(function(){P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_SUCCESS),this.onReportUserSuccess()}.bind(this),function(){P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_ERROR)}).fin(function(){P.getModalManager().removeAllModals(),this.destroy()}.bind(this))}}),goog.provide("P.modules.FlagConversation"),goog.require("P.Module"),P.modules.FlagConversation=P.Module.extend({}),goog.provide("P.modules.FlagPin"),goog.require("P.Form"),goog.require("P.Module");var FLAG_PIN_GA_CATEGORY="pin_flag";P.modules.FlagPin=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={reason:[P.Validator.Required()]},c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_REPORT_REASON_SELECTED,this._onReportReasonSelected);var d=this.getChildById("submitButton");d.disable()},onSubmitValidated:function(a){a.errors[0]||this.flagPin()},_onReportReasonSelected:function(){var a=this.getChildById("submitButton");a.enable()},flagPin:function(){var a=this.getChildById("submitButton");a.showLoading();var b="Unlabeled",c=null,d=null,e=P.app.backgroundModule,f=0,g="BoardPage";e&&(b=e.className,"SearchPage"===b?(c=e.options.scope,d=e.options.query):b===g?(c=e.options.tab,f=e.getNumPinsFlagged()):"FeedPage"===b?c=e.options.feed:"DomainFeedPage"===b&&(c=e.options.feed_item_type,d=e.options.domain));var h={pin_id:this.options.pin_id,reason:this.$("form :checked").attr("value"),source:b,sourceDetail1:c,sourceDetail2:d,detailedReasons:[]};"other"===h.reason&&(h.explanation=this.$("textarea").val());var i=3,j="flag_pin";f>=i&&(j="power_reporter_thanks");var k={name:"ConfirmDialog",options:{template:j}};P.trackGAEvent(FLAG_PIN_GA_CATEGORY,P.CONST.GA_ACTION_CLICK_SUBMIT,"reason",h.reason);var l=P.resourceFactory.create("PinFlagResource",h);l.callCreate().then(function(){P.trackGAEvent(FLAG_PIN_GA_CATEGORY,P.CONST.GA_ACTION_SUCCESS),P.loadModule(k).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.destroy)}.bind(this)),b===g&&P.pubsub.publish(this.options.board_id,P.CONST.PUBSUB_TOPIC_PIN_FLAGGED,{})}.bind(this),function(){P.trackGAEvent(FLAG_PIN_GA_CATEGORY,P.CONST.GA_ACTION_ERROR)}).fin(function(){a.hideLoading()})}}),goog.provide("P.modules.FlagUser"),goog.require("P.Module"),P.modules.FlagUser=P.Module.extend({}),goog.provide("P.modules.FlashlightResults"),goog.require("P.Module"),P.modules.FlashlightResults=P.Module.extend({}),goog.provide("P.modules.FlatSignupForm"),goog.require("P.Module"),P.modules.FlatSignupForm=P.Module.extend({}),goog.provide("P.modules.FollowingSwitcher"),goog.require("P.Module"),P.modules.FollowingSwitcher=P.Module.extend({onContentReady:function(){this.listen(this.getChildById("navFollowedInterests"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick),this.listen(this.getChildById("navFollowedPinners"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick),this.listen(this.getChildById("navFollowedBoards"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick)},onButtonTabClick:function(a){var b=a.target.id,c=this.getChildById("navFollowedInterests"),d=this.getChildById("navFollowedPinners"),e=this.getChildById("navFollowedBoards");c.setSelected("navFollowedInterests"===b),d.setSelected("navFollowedPinners"===b),e.setSelected("navFollowedBoards"===b),this.triggerEvent(P.CONST.EVENT_REFRESH_FOLLOWING_GRID,{following_tab:b},!0)}}),goog.provide("P.modules.FooterButtons"),goog.require("P.Module"),P.modules.FooterButtons=P.Module.extend({CssClassName:{GUIDE_IS_RECOMMENDED:"guideIsRecommended",GUIDE_WAS_RECOMMENDED:"guideWasRecommended",HAS_GUIDES:"hasGuides",TRIGGER_ACTIVE:"triggerActive",VISIBLE:"visible"},onContentReady:function(){this.options.hidden||window.setTimeout(function(){0!==this.$("addButtonWrapper").children().length?this.setVisible(!0):this.appendAddPinButton()}.bind(this),2e3);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE]=this.onTutorialTriggerActive,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a);var b={};b[P.CONST.PUBSUB_TOPIC_DEEP_LINK]=this.onNavigate,b[P.CONST.PUBSUB_TOPIC_IGNORE_EXTENSION_NAG]=this.resetAddPinButton,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,b),this.childListen(P.CONST.EVENT_TRIGGER_FLYOUT_CLICKED,this.onTriggerFlyoutClicked),this.childListen(P.CONST.EVENT_TUTORIAL_TRIGGER_CLICKED,this.onTriggerClicked),this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,_.throttle(this.onScroll,100))},resetAddPinButton:function(){var a=this.getChildByModuleName("ShowModalButton");a&&(a.destroy(),this.appendAddPinButton())},appendAddPinButton:function(){var a,b=P.browserExtension.instance.isExtensionInstalled(),c=Cookie.get(P.CONST.COOKIE_SUPPRESS_EXTENSION_NAG);a=b||c?{name:"DropdownButton",id:"addPinDropdownButton",options:{borderless:!0,has_icon:!0,class_name:"addPinFooter footerIcon",text:_("Add Pin"),show_text:!1,log_element_type:P.ContextLogging.ElementType.PIN_UPLOAD_BUTTON,dropdown_options:{fixed:!0,prefetch:!0,position_point:"LEFT_BOTTOM"},submodule:{name:"AddPin",options:{dropdown_style:!0}}}}:{name:"ShowModalButton",id:"addPinDropdownButton",options:{borderless:!0,has_icon:!0,class_name:"addPinFooter footerIcon",text:_("Add Pin"),show_text:!1,log_element_type:P.ContextLogging.ElementType.PIN_UPLOAD_BUTTON,submodule:{name:"BrowserButtonUpsell",options:{extension_installed:!1,suppress:!0}}}},a&&P.loadModule(a).then(function(a){a.render().then(function(){this.insertChild(a,this.$(".addButtonWrapper")),this.setVisible(!0)}.bind(this))}.bind(this))},onTriggerClicked:function(){this.tutorialInfo&&(this.$el.hasClass(this.CssClassName.GUIDE_IS_RECOMMENDED)&&this.$el.removeClass(this.CssClassName.GUIDE_IS_RECOMMENDED).addClass(this.CssClassName.GUIDE_WAS_RECOMMENDED),this.$el.find(".userEducationTutorialButton").addClass(this.CssClassName.TRIGGER_ACTIVE))},onTriggerFlyoutClicked:function(){this.onTriggerClicked(),this.tutorialInfo.showFlyout=!1,this.tutorialInfo.display_data.trigger="automatic",P.ExperienceTutorialManager.instance().startTutorial(this.tutorialInfo)},onTutorialTriggerActive:function(a,b,c){if(this.tutorialInfo=c,!this.tutorialInfo)return void this.$el.removeClass(this.CssClassName.HAS_GUIDES);if(this.$el.addClass(this.CssClassName.HAS_GUIDES),c.showFlyout){var d={name:"UserEducationTriggerCard",options:{guide:c}};this.flyout&&(this.flyout.destroy(),this.flyout=null),P.loadModule(d).then(function(a){this.flyout=a,a.render().then(function(){this.appendChild(a),this.setVisible(!0),this.$el.removeClass(this.CssClassName.GUIDE_WAS_RECOMMENDED).addClass(this.CssClassName.GUIDE_IS_RECOMMENDED),window.setTimeout(function(){this.dismissOnScroll=!0}.bind(this),3e3)}.bind(this))}.bind(this))}else this.setVisible(!0)},onNavigate:function(){this.$el.removeClass(this.CssClassName.GUIDE_IS_RECOMMENDED).removeClass(this.CssClassName.GUIDE_WAS_RECOMMENDED),this.dismissOnScroll=!1,this.$el.find(".moreFooter").removeClass(this.CssClassName.TRIGGER_ACTIVE),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,null)},onScroll:function(){this.dismissOnScroll&&(this.onTriggerClicked(),this.dismissOnScroll=!1)},setVisible:function(a){a&&!this.visible?(this.visible=!0,this.$el.addClass(this.CssClassName.VISIBLE)):!a&&this.visible&&(this.visible=!1,this.$el.removeClass(this.CssClassName.VISIBLE))}}),goog.provide("P.modules.FormItemGroup"),goog.require("P.Module"),P.modules.FormItemGroup=P.Module.extend({}),goog.provide("P.modules.FriendCenter"),goog.require("P.Module"),P.modules.FriendCenter=P.Module.extend({}),goog.provide("P.modules.GenericPinInfo"),goog.require("P.Module"),P.modules.GenericPinInfo=P.Module.extend({HIDE_DELAY:100,events:{"click .hidePin":"hidePin"},CssClassName:{HIDDEN:"hidden"},hidePin:function(){var a=this.options.pin_id;this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN)}.bind(this),this.HIDE_DELAY)}}),goog.provide("P.modules.GplusConnectButton"),goog.require("P.Module"),goog.require("P.modules.Button");var GPLUS_LOGIN_FAIL=function(){return P._("Oops! Log in with your Pinterest email and password first, then follow <a href='{{ help_link }}'>these instructions</a> to link your account to Google+.")},GPLUS_ACCOUNT_NOT_LINKED=180,GPLUS_REDIRECT_URI="postmessage",SIGNUP_ACTION="signup";P.modules.GplusConnectButton=P.modules.Button.extend({events:{click:"onClick"},onContentReady:function(){this.readyForConnect=!1,P.gapi.get(function(a){a.signin.render(this.$el.get(0),{scope:this.extraData.gplusScope,clientid:this.extraData.gplusClientId,apppackagename:this.extraData.gplusAppPackageName,redirecturi:GPLUS_REDIRECT_URI,accesstype:"offline",cookiepolicy:"single_host_origin",callback:function(a){this.readyForConnect&&this.onSignInCallback(a),this.readyForConnect=!0}.bind(this)})}.bind(this))},onClick:function(){P.trackRegisterAction("register_gplus_click"),this.triggerEvent(P.CONST.EVENT_GPLUS_BUTTON_CLICKED,this,!0)},onSignInCallback:function(a){var b={gplus_id_token:a.id_token},c=a.status;P.trackRegisterAction("register_gplus_attempt"),c.signed_in&&P.currentUser.login(b).then(function(){this.showLoading(),this.onLoginSuccess(a)}.bind(this),function(b){this.onLoginError(b,a)}.bind(this))},onLoginSuccess:function(){P.trackRegisterAction("register_gplus_success"),window.location.reload()},onLoginError:function(a,b){if(a.api_error_code===GPLUS_ACCOUNT_NOT_LINKED){var c=P.string.format(GPLUS_LOGIN_FAIL(),{help_link:this.extraData.gplusErrorLink});P.showHtmlError(c)}else this.options.action===SIGNUP_ACTION&&(P.SessionStorage.setItem(P.CONST.SESSION_GPLUS_CODE,b.code),P.SessionStorage.setItem(P.CONST.SESSION_GPLUS_REDIRECT_URI,GPLUS_REDIRECT_URI),P.resourceFactory.create("UserRegisterResource",{gplus_code:b.code,gplus_redirect_uri:GPLUS_REDIRECT_URI}).callCreate({showError:!1}).then(this.onLoginSuccess))}}),goog.provide("P.modules.GridFooter"),goog.require("P.Module"),P.modules.GridFooter=P.Module.extend({events:{"click .gridError .Button":"onTryAgainClick"},CssClassName:{SHOW_GRID_LOADING:"showGridLoading"},onTryAgainClick:function(a){this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,a,!0)},show:function(){this.$el.css("display","block")},_getErrorDiv:function(){return this.$el.find(".gridError")},showError:function(){var a=this._getErrorDiv();a.css("display","block")},hideError:function(){var a=this._getErrorDiv();a.css("display","none")},showGridLoading:function(){this.$el.addClass(this.CssClassName.SHOW_GRID_LOADING)
},hideGridLoading:function(){this.$el.removeClass(this.CssClassName.SHOW_GRID_LOADING)}}),goog.provide("P.modules.GridItems"),goog.require("P.Module"),goog.require("P.logging");var sortManagerLog=P.logging.getLogger("SortManager"),DEFAULT_MINIMUM_NUM_COLUMNS=P.CONST.MIN_COLUMNS,ITEM_HIDE_BUFFER=3e3,DRAGGABLE_ZINDEX=1e3,SORTABLE_ZINDEX=1e3,SORTABLE_ITEM_CLASS="gridSortable",MODULE_NAME_PIN="Pin",INITIAL_IMPRESSION_LOGGING_INTERVAL_MS=1e4,Direction={UP:0,DOWN:1},pxToInt=function(a){var b=parseInt(a.replace("px",""),10);return isNaN(b)?0:b},ItemInfo=function(a){this.childModule=a,this.top=null,this.height=null,this.bottom=null,this.$itemWrapper=a.getParentElement().closest(".item"),this.columnIndex=null,this.inDom=!0,this.impressionReported=!1,this.impressionStart=null};ItemInfo.prototype={log:P.logging.getLogger("ItemInfo"),_logHeightError:_.throttle(function(){},1e3),_logHeightRecovery:_.throttle(function(){this.log.warn("recovered from unexpected height value")},1e3),_calculateHeight:function(){this.height=this.$itemWrapper.height(),this.height<=0&&(this.$itemWrapper.appendTo(this.$itemWrapper.parent()),this.height=this.$itemWrapper.height(),this.height<=0?this._logHeightError():this._logHeightRecovery())},ensureHeightCalculated:function(){null===this.height&&this._calculateHeight()},recalculateHeight:function(){this.inDom?this._calculateHeight():this.log.debug("Cannot calculate height because this item is not inDom")},setPosition:function(a,b){this.top=a,this.bottom=b},hasPosition:function(){return null!==this.top}};var ILayoutManager=function(){};ILayoutManager.prototype={resizeGrid:function(){},onChildContentChanged:function(){},onChildDimsChanged:function(){},onChildRendered:function(){},onChildAdded:function(){},positionGridChildren:function(){},empty:function(){},recalculateItemMeasurements:function(){},positionGrid:function(){},hideAndShowItems:function(){},onChildRemoved:function(){},getFilledHeight:function(){},logImpressions:function(){},flushImpressions:function(){},logInitialImpressions:function(){}};var VariableHeightLayoutManager=function(a,b){this.gridItems=a,this.options=b,this.shortestColumnIndex=0,this.columnLengths=[],this.childCidToItemInfo={},_.each(this.gridItems.children,function(a){this.childCidToItemInfo[a.cid]=new ItemInfo(a)}.bind(this)),this._flushItemsToShow=this._flushItemsToShow.bind(this),this._flushItemsToHide=this._flushItemsToHide.bind(this),this.lastKnownItemInfosInViewport=[],this._itemsToHide={},this._itemsToShow={},this._ITEMS_TO_HIDE_THRESHOLD=50,this.viewableHeightMultiplier=b.viewableHeightMultiplier||2};VariableHeightLayoutManager.prototype={getFilledHeight:function(){return this.columnLengths[this.shortestColumnIndex]},onChildRendered:function(a){this._reflowOnChildChanged(a)},onChildAdded:function(a){this.childCidToItemInfo[a.cid]=new ItemInfo(a)},onChildRemoved:function(a,b){if(!this.gridItems.isEmptying){b.remove();var c=this.childCidToItemInfo[a.cid],d=c.columnIndex;delete this.childCidToItemInfo[a.cid],this._reflowColumnContent(d)}},empty:function(){this.childCidToItemInfo={}},recalculateItemMeasurements:function(){for(var a in this.childCidToItemInfo)this.childCidToItemInfo[a].recalculateHeight()},onChildContentChanged:function(a){this._reflowOnChildChanged(a)},onChildDimsChanged:function(a){this._reflowOnChildChanged(a,!1)},_reflowOnChildChanged:function(a,b){var c=this.childCidToItemInfo[a.cid];c.recalculateHeight(),this._reflowColumnContent(c.columnIndex,b)},_reflowColumnContent:function(a,b){void 0===b&&(b=this.gridItems.extraData.reflow_all),b?this.positionGrid():this._repositionItemsInColumn(a)},_calculateNumColumns:function(){var a=this.options.minimum_num_columns||DEFAULT_MINIMUM_NUM_COLUMNS;if(!this.itemWidth)return a;this.gridItems.extraData.centered||this.gridItems.$el.css("width","auto");var b=this.gridItems.getWidth(!1),c=Math.floor((b+1)/this.itemWidth);return Math.max(a,c)},_positionItemInColumn:function(a,b){if(this.gridItems.isReady()){var c=this.childCidToItemInfo[a.cid],d=c.$itemWrapper;b=Math.max(0,b),b=Math.min(this.columnLengths.length-1,b);var e=this.columnLengths[b];d.css({top:e+"px",left:b*this.itemWidth+"px",visibility:"visible"}),c.columnIndex=b;var f=c.height+this.topBuffer+this.bottomBuffer,g=e+f;c.setPosition(e,g),this.columnLengths[b]=g,this._setShortestColumnIndex()}},_positionItem:function(a){var b;if(this.gridItems.isReady()){if(0===this.columnLengths.length){if(!this.itemWidth){var c=this.childCidToItemInfo[a.cid],d=c.childModule.$el,e=c.$itemWrapper,f=["padding-left","padding-right","border-left-width","border-right-width","margin-left","margin-right"],g=d.css(f),h=e.css(f),i=d.width();for(b=0;b<f.length;b++){var j=f[b];i+=pxToInt(g[j]),i+=pxToInt(h[j])}this.itemWidth=i;var k=e.css("margin-top"),l=e.css("padding-top"),m=e.css("margin-bottom"),n=e.css("padding-bottom");this.topBuffer=pxToInt(k)+pxToInt(l),this.bottomBuffer=pxToInt(m)+pxToInt(n)}var o=this._calculateNumColumns();this.gridItems.extraData.centered||this.gridItems.$el.css("width",o*this.itemWidth),this.columnLengths=new Array(o);var p=this.options.initial_column_lengths;if(p)for(b=0;b<p.length;b++)this.columnLengths[b]=p[b];this._setShortestColumnIndex()}var q=this.shortestColumnIndex;this._positionItemInColumn(a,q)}},_setShortestColumnIndex:function(){this.shortestColumnIndex=0;for(var a=0;a<this.columnLengths.length;a++)this.columnLengths[a]=this.columnLengths[a]||0,this.columnLengths[a]<this.columnLengths[this.shortestColumnIndex]&&(this.shortestColumnIndex=a)},_repositionItemsInColumn:function(a){if(this.gridItems.isReady()){this.columnLengths[a]=0;var b=_.filter(this.childCidToItemInfo,function(b){return b.columnIndex===a}),c=_.sortBy(b,function(a){return a.top});_.each(c,function(b){this._positionItemInColumn(b.childModule,a)}.bind(this)),this.resizeContainer()}},resizeGrid:function(){var a=this.columnLengths.length,b=this._calculateNumColumns();a!==b&&(this.positionGridChildren(),this.gridItems.rearrangeItems(!0),this.gridItems.scheduleImpressionLogging())},resizeContainer:function(){var a=Math.max.apply(Math,this.columnLengths);this.gridItems.$el.css("height",a+"px"),this.gridItems.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},positionGrid:function(){this.gridItems.contentReady&&(this.positionGridChildren(),this.gridItems.rearrangeItems(),this.gridItems.scheduleImpressionLogging())},positionGridChildren:function(a){this.gridItems.contentReady&&(a||(this.columnLengths=[]),_.each(this.gridItems.children,function(a){var b=this.childCidToItemInfo[a.cid];b.ensureHeightCalculated()}.bind(this)),_.each(this.gridItems.children,function(b){var c=this.childCidToItemInfo[b.cid];a&&c.hasPosition()||this._positionItem(c.childModule)}.bind(this)),this.resizeContainer())},hideAndShowItems:function(a,b,c,d,e){var f;for(f in this.childCidToItemInfo){var g=this.childCidToItemInfo[f],h=g.$itemWrapper[0];g.bottom<d?a&&g.inDom&&(b||c!==Direction.DOWN||(this._itemsToHide[f]=h,delete this._itemsToShow[f],g.inDom=!1)):g.top>e?a&&g.inDom&&(b||c!==Direction.UP||(this._itemsToHide[f]=h,delete this._itemsToShow[f],g.inDom=!1)):g.inDom||(this._itemsToShow[f]=h,delete this._itemsToHide[f],g.inDom=!0)}Object.keys(this._itemsToShow).length&&P.deferDomManipulation(this._flushItemsToShow),Object.keys(this._itemsToHide).length>this._ITEMS_TO_HIDE_THRESHOLD&&P.deferDomManipulation(this._flushItemsToHide)},_flushItemsToShow:function(){var a;this.gridItems.log.debug("_flushItemsToShow: showing ",Object.keys(this._itemsToShow).length);var b=document.createDocumentFragment();for(a in this._itemsToShow)b.appendChild(this._itemsToShow[a]);this.gridItems.$el[0].appendChild(b),this._itemsToShow={}},_flushItemsToHide:function(){var a;this.gridItems.log.debug("_flushItemsToHide: hiding ",Object.keys(this._itemsToHide).length);for(a in this._itemsToHide){var b=this._itemsToHide[a];b.parentNode&&b.parentNode.removeChild(b)}this._itemsToHide={}},logImpressions:function(a,b){var c=this._getItemsInViewport(a,b),d=_.difference(this.lastKnownItemInfosInViewport,c);this.lastKnownItemInfosInViewport=c,this._reportImpressions(d)},logInitialImpressions:function(a,b){var c=this._getItemsInViewport(a,b),d=_.intersection(this.knownItemInfosInLastInterval,c);this.knownItemInfosInLastInterval=c,this._reportImpressions(d)},_getItemsInViewport:function(a,b){var c=[];return _.each(this.childCidToItemInfo,function(d){var e=d.top+this.topBuffer,f=d.bottom-this.bottomBuffer,g=!(e>=b||f<=a);g&&(c.push(d),null==d.impressionStart&&(d.impressionStart=Date.now()))}.bind(this)),c},flushImpressions:function(){this._reportImpressions(this.lastKnownItemInfosInViewport)},_reportImpressions:function(a){function b(a){if(void 0!==a&&null!==a){var b=new Image;b.src=a.url,b.onload=function(){b=null}}}if(!this.options.disable_impression_logging){for(var c=_.filter(a,function(a){return!a.impressionReported}),d=[],e=0;e<c.length;e++){var f=c[e],g=f.childModule.data?f.childModule.data.view_tags:[];if(f.childModule.className===MODULE_NAME_PIN){var h=f.childModule.getLoggingObjectIdStr();if(h){var i=f.childModule.getGridIndex();d.push({time:1e6*f.impressionStart,pinIdStr:h,endTime:1e6*Date.now(),yPosition:f.top,columnIndex:f.columnIndex,slotIndex:i}),f.impressionReported=!0}g?g.forEach(b):f.log.debug("view_tags field is missing")}}if(d.length){var j=this.options.impression_event_type||P.ContextLogging.EventType.PIN_IMPRESSION_ONE_PIXEL,k=P.ContextEvent.fromEventType(j);k.setPinImpressions(d),this.options.impression_metadata&&k.updateAuxData(this.options.impression_metadata),P.ContextLogger.getInstance().addEvent(k)}}}};var FixedHeightLayoutManager=function(a,b){this.gridItems=a,this.options=b,this.viewableHeightMultiplier=2};FixedHeightLayoutManager.prototype={resizeGrid:function(){},onChildContentChanged:function(){},onChildDimsChanged:function(){},onChildRendered:function(){},onChildAdded:function(){},positionGridChildren:function(){},empty:function(){},recalculateItemMeasurements:function(){},positionGrid:function(){this.gridItems.isReady()&&this.gridItems._requestMoreItemsIfNeeded()},hideAndShowItems:function(){},onChildRemoved:function(a,b){b.remove(),this.gridItems.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},getFilledHeight:function(){var a=this.gridItems.getWidth(!1),b=this.gridItems.children.length;if(0===b)return 0;var c=this.gridItems.children[0],d=c.$el.outerWidth(!0),e=c.$el.outerHeight(!0),f=Math.floor(a/d),g=Math.ceil(b/f),h=b%f!==0,i=g*e;return h&&(i-=e),i},logImpressions:P.NOOP,flushImpressions:P.NOOP,logInitialImpressions:P.NOOP};var RowLayoutManager=function(a,b){this.gridItems=a,this.options=b,this.childCidToItemInfo={},_.each(this.gridItems.children,function(a){this.childCidToItemInfo[a.cid]=new ItemInfo(a)}.bind(this))};RowLayoutManager.prototype={resizeGrid:function(){},onChildContentChanged:function(){},onChildDimsChanged:function(){},onChildRendered:function(){},onChildAdded:function(a){this.childCidToItemInfo[a.cid]=new ItemInfo(a),this.resizeContainer()},onChildRemoved:function(){this.resizeContainer()},positionGridChildren:function(){this.gridItems.isReady()&&this.resizeContainer()},empty:function(){},recalculateItemMeasurements:function(){},positionGrid:function(){this.gridItems.isReady()&&(this.resizeContainer(),this.resetGridChildrenPosition(),this.gridItems._requestMoreItemsIfNeeded())},resizeContainer:function(){var a=0;_.each(this.gridItems.children,function(b){var c=this.childCidToItemInfo[b.cid],d=c.childModule;d.data&&!d.$el.is(":hidden")&&(a+=d.getWidth()+P.CONST.PIN_MARGIN)}.bind(this)),this.gridItems.$el.css("width",a+"px")},hideAndShowItems:function(){},getFilledHeight:function(){},getFilledWidth:function(){return this.gridItems.getWidth(!1)},resetGridChildrenPosition:function(){_.each(this.gridItems.children,function(a){var b=this.childCidToItemInfo[a.cid];this._resetItemPosition(b.childModule)}.bind(this))},_resetItemPosition:function(a){var b=this.childCidToItemInfo[a.cid],c=b.$itemWrapper;c.css({left:"",top:""})},logImpressions:P.NOOP,flushImpressions:P.NOOP,logInitialImpressions:P.NOOP};var DragManager=function(a,b){var c=this;this.gridItems=a,b||(b={}),this.draggableOptions=_.extend({appendTo:$(".App"),cursor:"move",distance:3,handle:".draggable",helper:"clone",opacity:.35,scroll:!1,revert:!1,zIndex:DRAGGABLE_ZINDEX,drag:function(a,b){var c=parseInt($(this).data("startingScrollTop"),10);b.position.top-=c;var d=a.clientX-b.position.left,e=window.pageYOffset+a.clientY-b.position.top,f=b.helper.height(),g=b.helper.width(),h=d/g*100,i=e/f*100,j=""+h+"% "+i+"%";b.helper.css("transformOrigin",j)},start:function(a){var b=c.gridItems.getChildByElement($(a.target).find(".Module"));b&&P.getConversationsManager().setDraggedObject(b),$(this).data("startingScrollTop",window.pageYOffset-P.CONST.PIN_MARGIN)},stop:function(a,b){var c=parseInt($(this).data("startingScrollTop"),10);P.getConversationsManager().setDraggedObject(null),b.position.top-=c}},b),this.gridItems.$(".item").draggable(this.draggableOptions)};DragManager.prototype={enable:function(){void 0!==$.fn.draggable&&this.gridItems.$(".item").draggable("enable")},disable:function(){void 0!==$.fn.draggable&&this.gridItems.$(".item").draggable("disable")},disableForModule:function(a){void 0!==$.fn.draggable&&a.getParentElement().draggable("disable")},onChildAdded:function(a){a.getParentElement().draggable(this.draggableOptions)}};var DropManager=function(a,b){this.gridItems=a,b||(b={}),this.droppableOptions=_.extend({tolerance:"pointer"},b),this.gridItems.$(".item").droppable(this.droppableOptions)};DropManager.prototype={enable:function(){void 0!==$.fn.droppable&&this.gridItems.$(".item").droppable("enable")},disable:function(){void 0!==$.fn.droppable&&this.gridItems.$(".item").droppable("disable")},disableForModule:function(a){void 0!==$.fn.droppable&&a.getParentElement().droppable("disable")},onChildAdded:function(a){var b=a.getParentElement();b.droppable(this.droppableOptions)}};var SortManager=function(a,b,c,d){this.gridItems=a,b||(b={}),b=_.extend({containment:"parent",cursor:"move",helper:"clone",items:"."+SORTABLE_ITEM_CLASS,tolerance:"pointer",zIndex:SORTABLE_ZINDEX},b),this.gridItems.$el.sortable(b),this.childModuleName=c,this.idFn=d,this._setSortableMetadata(),this._hasNewElements=!0};SortManager.prototype={_setSortableMetadata:function(){_.each(this.gridItems.getChildrenByModuleName(this.childModuleName),function(a){this._addSortableItemClass(a)}.bind(this))},_addSortableItemClass:function(a){var b=a.getParentElement();b.addClass(SORTABLE_ITEM_CLASS)},onChildAdded:function(a){this._addSortableItemClass(a),this._hasNewElements=!0},getSortOrder:function(){var a=this.idFn,b=[];return this._hasNewElements&&(_.each(this.gridItems.getChildrenByModuleName(this.childModuleName),function(b){b.$el.attr("data-sort-id")||b.$el.attr("data-sort-id",a(b))}),this._hasNewElements=!1),_.each(this.gridItems.$el.find("."+this.childModuleName),function(a){var c=$(a).attr("data-sort-id");c?b.push(c):sortManagerLog.error("child module's data-sort-id is null or undefined",{boardHtml:a.parentNode.innerHTML})}),b}};var GridItems=P.Module.extend({events:{"click .trackActiveItem .item":"onTrackItemClick","click .itemClickMask":"onItemMaskClick"},CssClassName:{ACTIVE_ITEM:"activeItem",HAS_SCROLL:"hasScroll",ITEM:"item",LOADING_ITEMS:"loadingItems"},mixins:[P.Mixins.PreventScroll],onChildNavigate:function(a){var b=a.currentTarget;this.updateActiveItem(b.getParentElement())},onItemMaskClick:function(a){var b=$(a.currentTarget),c=b.next(),d=this.getChildByElement(c[0]);return d?void this.triggerEvent(P.CONST.EVENT_GRID_ITEM_SELECTED,{module:d},!0):void this.log.error("cannot find selected child module.")},onTrackItemClick:function(a){var b=a.currentTarget;this.updateActiveItem($(b))},updateActiveItem:function(a){var b=this.$(".activeItem");b.removeClass(this.CssClassName.ACTIVE_ITEM),a.addClass(this.CssClassName.ACTIVE_ITEM)},setActiveItemById:function(a){for(var b=this.children||[],c=0;c<b.length;c++){var d=b[c];d.data&&d.data.id===a&&this.updateActiveItem(d.$el.parent())}},onCreated:function(){this._scrollListener=null,this._scrollStopListener=null,this.alreadyInitialized=!1,this.scrollTop=0,this.lastScrollTop=null,this.viewableHeight=null,this.lastTopBorder=null,this.lastBottomBorder=null,this.layoutManager=null,this.initialImpressionLoggingInterval=null,this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_DIMS_CHANGED,this.onChildDimsChanged);var a={};a[P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED]=function(){this.layoutManager&&this.layoutManager.flushImpressions()}.bind(this),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a)},initializeSortManager:function(a,b,c){this.sortManager=new SortManager(this,a,b,c)},initializeDragManager:function(a){this.dragManager=new DragManager(this,a)},enableDragging:function(){this.dragManager&&this.dragManager.enable()},disableDragging:function(){this.dragManager&&this.dragManager.disable()},disableDraggingForChildModule:function(a){this.dragManager&&this.dragManager.disableForModule(a)},initializeDropManager:function(a){this.dropManager=new DropManager(this,a)},enableDropping:function(){this.dropManger&&this.dropManager.enable()},disableDropping:function(){this.dropManger&&this.dropManager.disable()},disableDroppingForChildModule:function(a){this.dropManager&&this.dropManager.disableForModule(a)},getSortOrder:function(a,b){return this.sortManager?this.sortManager.getSortOrder(a,b):void 0},getChildModuleAtIndex:function(a,b){var c=this.children[a];return c&&c.className===b?c:null},getChildren:function(){return this.children},onOptionsChanged:function(){this._setScrollableElement(),this.alreadyInitialized=!1},onResourceChanged:function(){this.alreadyInitialized=!1},prependChildItem:function(a){var b=0;this.children.length>0&&this.children[0].options.anchored&&(b=1);var c;this.children.length>b&&(c=this.children[b].$el.parent()),this.insertChildBefore(a,this.$el,b,c),this.layoutManager.positionGrid()},prependNewItems:function(a,b){var c=0,d=P.resourceFactory.clone(this.resource);d.resetBookmark(),d.set("prepend",!1),d.set("page_size",a);var e=new GridItems({resource:d});this.children.length>0&&this.children[0].options.anchored&&(c=1),e.options=this.options,e.render().then(function(){_.each(e.children.reverse(),function(a){a.remove(),this.insertChild(a,this.$el,c)}.bind(this)),this.layoutManager.positionGrid(),b&&b()}.bind(this))},requestMoreItems:function(){this.isReady()&&this._requestMoreItems()},requestMoreItemsIfNeeded:function(){this.isReady()&&this._requestMoreItemsIfNeeded()},hasMoreItems:function(){return this.resource&&!this.resource.atEnd()},_triggerIfItemsEnd:function(){this.hasMoreItems()||this.triggerEvent(P.CONST.EVENT_ITEMS_END,null,!0)},setPageSize:function(a){this.resource&&this.resource.set("page_size",a)},setHasScroll:function(a){this.$el.toggleClass(this.CssClassName.HAS_SCROLL,a)},onAddedToDom:function(){this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize),this.navigateListener=this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this._setUpGrid(),this.isReady()&&this.layoutManager.recalculateItemMeasurements(),this.onResize()},onResize:function(){this.isReady()&&this.layoutManager.resizeGrid()},hasItems:function(){return this.children.length>0},onContentReady:function(){this.$el.removeClass(this.CssClassName.LOADING_ITEMS);var a=this.options.layout;this.layoutManager="fixed_height"===a?new FixedHeightLayoutManager(this,this.options):"row_layout"===a?new RowLayoutManager(this,this.options):new VariableHeightLayoutManager(this,this.options),this._setUpGrid(),this._triggerIfItemsEnd(),this.initialImpressionLoggingInterval=P.setInterval(this.scheduleInitialImpressions.bind(this),INITIAL_IMPRESSION_LOGGING_INTERVAL_MS)},onRemovedFromDom:function(){this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_SITE),P.clearInterval(this.initialImpressionLoggingInterval),this.initialImpressionLoggingInterval=null,this._scrollListener&&(this.removeListener(this._scrollListener),this._scrollListener=null),this._scrollStopListener&&(this.removeListener(this._scrollStopListener),this._scrollStopListener=null),this.stopPreventScroll(),this.layoutManager&&this.layoutManager.flushImpressions(),this.navigateListener&&this.removeListener(this.navigateListener),this.resizeListener&&this.removeListener(this.resizeListener)},onChildContentChanged:function(a){a.stopPropagation();var b=a.currentTarget;this.isReady()&&(this.layoutManager.onChildContentChanged(b),this.rearrangeItems(!0),this.scheduleImpressionLogging())},onChildDimsChanged:function(a){a.stopPropagation();var b=a.currentTarget;this.isReady()&&this.layoutManager.onChildDimsChanged(b)},onChildRendered:function(a){this.isReady()&&this.layoutManager.onChildRendered(a)},onChildAdded:function(a){a&&a.data&&(a.data.grid_index=this.children.length-1);var b=a.getParentElement();if(!b.hasClass(this.CssClassName.ITEM)){var c=$("<div></div>").addClass(this.CssClassName.ITEM);c.insertBefore(a.$el),c.append(a.$el),b=c}this.layoutManager&&this.layoutManager.onChildAdded(a),this.dragManager&&this.dragManager.onChildAdded(a),this.dropManager&&this.dropManager.onChildAdded(a),this.sortManager&&this.sortManager.onChildAdded(a)},onChildRemoved:function(a,b){this.layoutManager&&this.layoutManager.onChildRemoved(a,b)},empty:function(){this.isEmptying=!0,P.Module.prototype.empty.call(this),this.alreadyInitialized=!1,this.contentReady=!1,this.layoutManager&&this.layoutManager.empty(),this.isEmptying=!1},handleError:function(a){this.pendingMoreRequest?this.$(".errorMessage").remove():P.Module.prototype.handleError.call(this,a)},_setUpGrid:function(){this._setScrollableElement(),this.isReady()&&!this.alreadyInitialized&&(this.layoutManager.positionGrid(),this.alreadyInitialized=!0,this._computeScrollableHeightAndOffset())},_setScrollableElement:function(){var a=_.throttle(this._onScroll,16),b=_.debounce(this._onScrollStop,2e3);this._scrollListener&&(this.removeListener(this._scrollListener),this._scrollListener=null),this._scrollStopListener&&(this.removeListener(this._scrollStopListener),this._scrollStopListener=null),this.scrollableElement=this.getScrollableElement(),this.options.scrollable&&(this._scrollListener=this.listen(this.scrollableElement,"scroll",a),this._scrollStopListener=this.listen(this.scrollableElement,"scroll",b)),this._preventDefaultIfNeeded()},isReady:function(){return this.inDom&&this.contentReady},rearrangeItems:function(a){this._requestMoreItemsIfNeeded(),this._hideAndShowItems(a)},positionGrid:function(){this.layoutManager.positionGrid()},_onScroll:function(){this.lastScrollTop=this.scrollTop,this.scrollTop=this.getScrollableElement().scrollTop(),this.lastScrollTop!==this.scrollTop&&(this.rearrangeItems(!0),this.scheduleImpressionLogging(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_SCROLL_CHANGE))},_onScrollStop:function(){this.layoutManager._flushItemsToHide&&P.deferDomManipulation(this.layoutManager._flushItemsToHide)},scheduleImpressionLogging:function(){this._impressionLoggingScheduled||(this._impressionLoggingScheduled=!0,P.deferDomManipulation(function(){this._impressionLoggingScheduled=!1;var a=this.scrollTop-this.offsetFromScrollElement,b=a+this.viewableHeight;this.layoutManager.logImpressions(a,b)}.bind(this)))},scheduleInitialImpressions:function(){var a=this.scrollTop-this.offsetFromScrollElement,b=a+this.viewableHeight;this.layoutManager.logInitialImpressions(a,b)},_hideAndShowItems:function(a){if(this.extraData.virtualize){a=a||!1;var b=!this.lastScrollTop||this.scrollTop>=this.lastScrollTop?Direction.DOWN:Direction.UP,c=this.scrollTop-this.offsetFromScrollElement,d=c+this.viewableHeight,e=c-ITEM_HIDE_BUFFER,f=d+ITEM_HIDE_BUFFER,g=null===this.lastTopBorder||null===this.lastBottomBorder||c<this.lastTopBorder||d>this.lastBottomBorder;(g||a)&&(this.layoutManager.hideAndShowItems(a,this.pendingMoreRequest,b,e,f),this.lastTopBorder=e,this.lastBottomBorder=f)}},onRendered:function(){this._requestMoreItemsIfNeeded(),P.Module.prototype.onRendered()},_computeScrollableHeightAndOffset:function(){this.viewableHeight=this.scrollableElement.height(),this.offsetFromScrollElement=this.$el.positionAncestor(this.scrollableElement).top},_requestMoreItemsIfNeeded:function(){if(this.isReady()&&this.options.scrollable&&!this.pendingMoreRequest&&!this.hasError&&this.hasMoreItems()){if(this._computeScrollableHeightAndOffset(),this.layoutManager instanceof VariableHeightLayoutManager||this.layoutManager instanceof FixedHeightLayoutManager){var a=this.offsetFromScrollElement+this.layoutManager.getFilledHeight();if(a-(this.viewableHeight+this.scrollTop)>this.layoutManager.viewableHeightMultiplier*this.viewableHeight)return}else if(this.layoutManager instanceof RowLayoutManager){var b=this.layoutManager.getFilledWidth(),c=this.parent.scrollLeft,d=P.Viewport.width;if(c+d<b)return}this._requestMoreItems()}},_requestMoreItems:function(a){_.isUndefined(a)&&(a=2),this.pendingMoreRequest||(this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0),this.pendingMoreRequest=!0,this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.layoutManager.positionGridChildren(!0),this.pendingMoreRequest=!1,this.hasError&&(this.triggerEvent(P.CONST.EVENT_ERROR_RESOLVED,null,!0),this.hasError=!1),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0),this._requestMoreItemsIfNeeded(),this._triggerIfItemsEnd(),this.scheduleImpressionLogging()}.bind(this),function(){a>0?this._requestMoreItems(a-1):(this.hasError=!0,this.triggerEvent(P.CONST.EVENT_ERROR,null,!0),this._triggerIfItemsEnd())}.bind(this)))},_preventDefaultIfNeeded:function(){this.options.prevent_default_scroll&&this.startPreventScroll(this.scrollableElement,this.$el)},switchLayoutManager:function(a){this.$el.css({height:"",width:""}),this.layoutManager="fixedHeightLayout"===a?new FixedHeightLayoutManager(this,this.options):"rowLayout"===a?new RowLayoutManager(this,this.options):new VariableHeightLayoutManager(this,this.options),this.positionGrid()},reorderChildModule:function(a,b){var c=this.children.indexOf(a);this.children.splice(c,1);var d=this.children.indexOf(b);this.children.splice(d,0,a),this.layoutManager.positionGridChildren()}});P.modules.GridItems=GridItems,goog.provide("P.modules.GroupBoardEmailSettings"),goog.require("P.Form"),goog.require("P.Module"),P.modules.GroupBoardEmailSettings=P.Module.extend({onCreated:function(){this.childListen("change",this.onChildChange)},onSubmitValidated:function(){return this.save(),!1},save:function(){var a={},b=[];this.$form.find("input[name=collab_board_email]:checked").each(function(){b.push(this.value)}),a.email_collaborative_board_ids=b;var c=this.getChildById("submitButton"),d=P.resourceFactory.create("UserSettingsResource",a);c.showLoading(),d.callUpdate().then(function(){this.destroy()}.bind(this)).fin(function(){c.hideLoading()})},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var a={};this.$form=this.$("form"),this.form=new P.Form(this.$form,a),this.listen(this.form,"submitValidated",this.onSubmitValidated)},onChildChange:function(a){var b=a.target;if("toggleAll"===b.id){var c;c=b.isChecked()?function(a){a.setChecked(!0)}:function(a){a.setChecked(!1)};var d=this.getChildrenByModuleName("Checkbox");_.each(d,c)}}}),goog.provide("P.modules.HeaderBase"),goog.require("P.Module"),P.modules.HeaderBase=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW]=this.onMainModuleChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,a)},onMainModuleChange:function(a,b,c){var d=c,e=["LoginPage","UserRegisterPage"],f=this.options.main_module.name;this.options.main_module.name=d.className,this.options.main_module.options=_.clone(d.options),(f===d.className||-1===e.indexOf(d.className)&&-1===e.indexOf(f))&&(P.currentUser.isAuthenticated()||"HomePage"!==f&&"HomePage"!==d.className)||(f=d.className,this.render());var g=["InterestFeedPage","BoardPage","Closeup"];if(!P.currentUser.isAuthenticated()&&(-1!==g.indexOf(f)||-1!==g.indexOf(d.className))){var h=this.getChildByModuleName("KLPBar");h&&h.render()}var i=this.getChildByModuleName("JumpStartCategoriesBar");i&&i.render()}}),goog.provide("P.modules.HeroBasicWrapper"),goog.require("P.Module"),P.modules.HeroBasicWrapper=P.Module.extend({}),goog.provide("P.modules.HeroHelperBase"),goog.require("P.Module");var BUTTON_ID_CLOSE="close",HIDE_DELAY_MILLISECONDS=1e3;P.modules.HeroHelperBase=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick),this.resource?(this.placementId=this.resource.options.placement_id,this.experienceId=this.resource.options.experience_id):(this.placementId=this.options.placement_id,this.experienceId=this.options.experience_id);var a=this.data;a&&(a.experience_id&&(this.experienceId=a.experience_id),a.id&&(this.placedExperienceId=a.id)),this.setExperienceViewed()},hide:function(){this.fadeOut(function(){this.destroy()}.bind(this))},dismiss:function(a){P.trackGAEvent("hero_helper_"+this.options.type,P.CONST.GA_ACTION_CLICK_CLOSE),this.dismissPlacedExperience(),a||this.hide()},complete:function(a){P.trackGAEvent("hero_helper_"+this.options.type,P.CONST.GA_ACTION_CLICK_CONFIRM),this.completePlacedExperience(),a||(this.options.delay_hide?P.setTimeout(function(){this.hide()}.bind(this),HIDE_DELAY_MILLISECONDS):this.hide())},setExperienceViewed:function(){P.trackGAEvent("hero_helper_"+this.options.type,"viewed");var a=P.ExperienceManager.instance();this.placedExperienceId?a.viewPlacedExperienceId(this.placedExperienceId):a.viewPlacedExperience(this.placementId,this.experienceId)},completePlacedExperience:function(){var a=P.ExperienceManager.instance();return this.placedExperienceId?a.completePlacedExperienceId(this.placedExperienceId):a.completePlacedExperience(this.placementId,this.experienceId)},dismissPlacedExperience:function(){var a=P.ExperienceManager.instance();return this.placedExperienceId?a.dismissPlacedExperienceId(this.placedExperienceId):a.dismissPlacedExperience(this.placementId,this.experienceId)},onButtonClick:function(){},_onButtonClick:function(a){this.onButtonClick(a);var b=a.target;b.id===BUTTON_ID_CLOSE&&this.dismiss()}}),goog.provide("P.modules.HeroInstallApp"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_INSTALL_APP="install_app";P.modules.HeroInstallApp=P.modules.HeroHelperBase.extend({onContentReady:function(){this.formListener&&this.removeListener(this.formListener);var a;a={phoneNumber:[P.Validator.Required(),P.Validator.PhoneNumber()]},this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.installAppButton=this.getChildById(BUTTON_ID_INSTALL_APP),P.modules.HeroHelperBase.prototype.onContentReady.call(this)},onSubmitValidated:function(a){a.errors[0]||this.installAppSms()},onSuccess:function(){this.complete(),this.installAppButton.hideLoading(),this.installAppButton.setText(this.options.sent_text),this.installAppButton.disable()},onFailure:function(){this.installAppButton.hideLoading()},installAppSms:function(){var a=this.form.getValue("phoneNumber"),b=this.form.getValue("country"),c=P.resourceFactory.create("SmsAppInstall",{number:a,country:b});this.installAppButton.showLoading(),c.callCreate({showError:!1}).then(function(){this.onSuccess()}.bind(this),function(){this.onFailure()}.bind(this))}}),goog.provide("P.modules.HeroPinItButton"),goog.require("P.Module"),goog.require("P.browserExtension"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_PINIT_BUTTON="pinitButton";P.modules.HeroPinItButton=P.modules.HeroHelperBase.extend({onContentReady:function(){P.browserExtension.instance.isExtensionInstalled()&&this.dismiss(),P.modules.HeroHelperBase.prototype.onContentReady.call(this)},onButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_PINIT_BUTTON&&P.browserExtension.instance.handleExtensionInstall(function(){this.complete()
}.bind(this),P.NOOP)}}),goog.provide("P.modules.HeroPinItWeb"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_PINIT_BUTTON_WEB="pinitButton";P.modules.HeroPinItWeb=P.modules.HeroHelperBase.extend({onButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_PINIT_BUTTON_WEB&&(P.changeWindowLocation(this.extraData.url,this.extraData.newWindow),this.complete(!0))}}),goog.provide("P.modules.HeroPlacePinsExamples"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroPlacePinsExamples=P.modules.HeroHelperBase.extend({}),goog.provide("P.modules.HeroVerifyWebsite"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroVerifyWebsite=P.modules.HeroHelperBase.extend({}),goog.provide("P.modules.HomePage"),goog.require("P.Module"),P.modules.HomePage=P.Module.extend({}),goog.provide("P.modules.IframeEmbed"),goog.require("P.Module"),P.modules.IframeEmbed=P.Module.extend({}),goog.provide("P.modules.Image"),goog.require("P.Module"),P.modules.Image=P.Module.extend({onContentReady:function(){if(this.options.lazy_load){var a=this.$el.find("img");a.attr("src",this.options.src)}}}),goog.provide("P.modules.ImageBlock"),goog.require("P.Module"),P.modules.ImageBlock=P.Module.extend({events:{click:"onClick"},onClick:function(){this.triggerEvent(P.CONST.EVENT_IMAGE_BLOCK_CLICKED,this.data,!0)}}),goog.provide("P.modules.ImageCrop"),goog.require("P.Module"),P.modules.ImageCrop=P.Module.extend({events:{"mousedown .drag":"onStartDrag","touchstart .drag":"onStartDrag"},CssClassName:{IMAGE_AREA:"in"},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){_.defaults(this.options,{size:{width:222,height:150},padding:60}),this.$holder=this.$(".holder"),this.$bg=this.$(".bg"),this.$help=this.$(".help"),this.$frame=this.$(".frame"),this.$mask=this.$(".mask"),this.$spinner=this.$(".spinner"),this.$holder.show().css("height",this.options.size.height+2*this.options.padding),this.options.help_text&&this.$help.html(this.options.help_text),this._positionIfReady()},_positionIfReady:function(){if(!this._positioned&&this.inDom&&this.contentReady){this._positioned=!0;var a=this._frameBounds={left:this.$holder.width()/2-this.options.size.width/2,width:this.options.size.width,top:this.options.padding,height:this.options.size.height};a.ratio=a.height/a.width,this.$frame.css(a);var b=this.$mask.children();b.eq(0).css({top:0,left:0,right:0,height:a.top}),b.eq(1).css({top:a.top,left:a.left+a.width,right:0,height:a.height}),b.eq(2).css({top:a.top+a.height,left:0,right:0,bottom:0}),b.eq(3).css({top:a.top,left:0,width:a.left,height:a.height}),this.options.image_url&&this.setImage(this.options.image_url)}},initImage:function(){if(!this.$img.height()||!this.$img.width())return void _.delay(this.initImage.bind(this),200);var a=this._imageBounds={nativeWidth:this.$img.width(),nativeHeight:this.$img.height()};a.ratio=a.nativeHeight/a.nativeWidth,this.$img.addClass(this.CssClassName.IMAGE_AREA),this._fitImage(),this._centerImage(),this._hideSpinner()},onStartDrag:function(a){var b="touchstart"===a.type;this._mousePosition=b?{x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY}:{x:a.pageX,y:a.pageY},this._startPosition={x:parseInt(this.$bg.css("left"),10),y:parseInt(this.$bg.css("top"),10)},$("body").on({"mousemove.ImageCrop touchmove.ImageCrop":this.onDragging.bind(this),"mouseup.ImageCrop touchend.ImageCrop":this.onStopDragging}),a.preventDefault()},onDragging:function(a){a.preventDefault();var b="touchmove"===a.type,c=b?a.originalEvent.changedTouches[0]:a,d=c.pageX-this._mousePosition.x,e=c.pageY-this._mousePosition.y,f={top:this._startPosition.y+e,left:this._startPosition.x+d};this._clampValues(f),this.$bg.css(f)},onStopDragging:function(){$("body").off("mousemove.ImageCrop mouseup.ImageCrop touchmove.ImageCrop touchend.ImageCrop")},_clampValues:function(a){a.top=Math.min(a.top,this._frameBounds.top),a.left=Math.min(a.left,this._frameBounds.left),a.top+this._imageBounds.height<this._frameBounds.top+this._frameBounds.height&&(a.top=this._frameBounds.top+this._frameBounds.height-this._imageBounds.height+1),a.left+this._imageBounds.width<this._frameBounds.left+this._frameBounds.width&&(a.left=this._frameBounds.left+this._frameBounds.width-this._imageBounds.width+1)},setImage:function(a){this._showSpinner(),this.$img=$("<img>",{src:a}),this.$bg.empty().append(this.$img),this.initImage()},_fitImage:function(){var a;a=this._imageBounds.ratio>=this._frameBounds.ratio?this._frameBounds.width/this._imageBounds.nativeWidth:this._frameBounds.height/this._imageBounds.nativeHeight,this._scaleImage(a)},_centerImage:function(){var a=this.$holder.height(),b=this.$holder.width();this.$bg.css({top:a/2-this.$bg.height()/2+1,left:b/2-this.$bg.width()/2+1})},_scaleImage:function(a){var b=this._imageBounds.width=this._imageBounds.nativeWidth*a,c=this._imageBounds.height=this._imageBounds.nativeHeight*a;this.$img.css({width:b,height:c})},_showSpinner:function(){this.$spinner.show()},_hideSpinner:function(){this.$spinner.hide()},getCropData:function(){var a={x:-1*(parseInt(this.$bg.css("left"),10)-parseInt(this._frameBounds.left,10)),y:-1*(parseInt(this.$bg.css("top"),10)-parseInt(this._frameBounds.top,10))},b=this.$img.width()/this._imageBounds.nativeWidth,c={crop_x:a.x,crop_y:a.y,nativeHeight:this._imageBounds.nativeHeight,nativeWidth:this._imageBounds.nativeWidth,height:this.options.size.height,width:this.options.size.width,scale:b};return c}}),require("common/lib/external/fineuploader-3.0.js"),require("common/lib/external/fineuploader-patch.js"),goog.provide("P.modules.ImageUploader"),goog.require("P.Module"),P.modules.ImageUploader=P.Module.extend({CssClassName:{IS_SELECTED:"selected"},onCreated:function(){this.onUploaderSubmit=this.onUploaderSubmit.bind(this),this.onUploaderComplete=this.onUploaderComplete.bind(this),this.onUploaderProgress=this.onUploaderProgress.bind(this),this.onUploaderError=this.onUploaderError.bind(this)},enable:function(){this.getButton().enable()},disable:function(){this.getButton().disable()},select:function(){this._setSelected(!0)},_setSelected:function(a){this.$el.toggleClass(this.CssClassName.IS_SELECTED,a)},deselect:function(){this._setSelected(!1)},onContentReady:function(){this.ensureUploader()},getUploadUrl:function(){return P.absolutify("/upload-image/")},getFileNameElement:function(){return this.$fileName||(this.$fileName=this.$(".uploaderProgress").find("span")),this.$fileName},getButton:function(){return this.getChildById("upload")},ensureUploader:function(){return this.uploader?this.uploader:(this.uploader=new qq.FineUploaderBasic({debug:P.DEBUG,button:this.getButton().$el.get(0),multiple:!1,request:{endpoint:this.getUploadUrl(),inputName:"img",forceMultipart:!0,customHeaders:{"X-CSRFToken":P.csrf.getCSRFToken()}},callbacks:{onUpload:this.onUploaderSubmit,onComplete:this.onUploaderComplete,onProgress:this.onUploaderProgress,onError:this.onUploaderError,showAlert:function(a){this.log.debug(a)}.bind(this)}}),this.uploader)},onUploaderSubmit:function(){this.getButton().showLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_START),this.log.debug("UploaderSubmit",arguments)},onUploaderComplete:function(a,b,c){c.success&&(this.getButton().hideLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_SUCCESS,c,!0),this.getFileNameElement().text(c.filename),this.log.debug("UploaderComplete",arguments))},onUploaderProgress:function(a,b,c,d){var e=Math.round(c/d*100);this.triggerEvent(P.CONST.EVENT_UPLOAD_PROGRESS,{loaded:c,total:d,percent:e}),this.getFileNameElement().text(e+"%"),this.log.debug("UploaderProgress",arguments)},resetFileNameElement:function(){this.getFileNameElement().text("")},onUploaderError:function(a,b,c){this.getButton().hideLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_ERROR,c),this.log.debug("UploaderError",arguments),P.showError(c),this.resetFileNameElement()}}),goog.provide("P.modules.ImagesFeedPage"),goog.require("P.Module"),P.modules.ImagesFeedPage=P.Module.extend({onContentReady:function(){this.imagesGrid=this.getChildById("imagesGrid"),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged);var a=this.getChildById("domainPinsGrid");a&&0===a.children.length?a.destroy():this.$(".domainPinsHolder").css("visibility","visible")},onChildContentChanged:function(){this.imagesGrid&&!this.imagesGrid.hasItems()&&(this.resource=null,this.render())}}),goog.provide("P.modules.ImportantImage"),goog.require("P.Module"),P.modules.ImportantImage=P.Module.extend({}),goog.provide("P.modules.InitiatePasswordReset"),goog.require("P.Form"),goog.require("P.Module"),P.modules.InitiatePasswordReset=P.Module.extend({onContentReady:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{email:[P.Validator.Required(),P.Validator.Email()]},{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.form.getValue("email");this.resetPassword(b)}},resetPassword:function(a){var b={username_or_email:a},c=P.resourceFactory.create("UserResetPasswordResource",b),d=this.getChildById("resetPasswordButton");d.showLoading(),c.callCreate({showError:!1}).then(function(){this.onSuccess(a)}.bind(this)).fin(function(){d.hideLoading()})},onSuccess:function(a){this.$form.hide();var b=P.string.format(P._("We'll send a message to <strong>{{ email }}</strong> so you can pick your new password."),{email:a});this.$(".messageText").html(b),this.$(".successMessage").show()}}),goog.provide("P.modules.InlineHoverButton"),goog.require("P.Module"),P.modules.InlineHoverButton=P.Module.extend({}),goog.provide("P.modules.InlineSignup"),goog.require("P.Module"),P.modules.InlineSignup=P.Module.extend({onContentReady:function(){this.multiStepSignupSetup(),this.loginButton=this.getChildById("loginButton"),this.facebookConnectButton=this.getChildById("facebookConnectButton"),this.facebookConnectButton&&this.listen(this.facebookConnectButton,P.CONST.FACEBOOK_LOGIN_FAILURE,this.onFacebookLoginFailure),this.childListen(P.CONST.EVENT_USER_REGISTER,this.onRegisterSuccess),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_FACEBOOK_REQUIRE_EMAIL,this.showFacebookTooltip),this.listen(this,P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},multiStepSignupSetup:function(){this.facebookTooltip=this.$(".facebookTooltip"),this.tosFooter=this.$(".outerTermsOfServiceFooter"),this.groupSeparatorDiv=this.$(".groupSeparatorDark"),this.step1Bottom=this.$(".step1Bottom"),this.childListen("toggleMultiStep",function(a){this.$el.toggleClass("secondStep"),this.titleText&&this.setHeader(a)}),this.groupSeparatorDiv.show(),this.step1Bottom.show(),this.tosFooter.show(),P.trackRegisterAction("register_multi_screen_username_pass_loaded")},setMultiStepHeader:function(a,b){this.$title=this.$(a),this.titleText=b},setHeader:function(a){this.$title.css({opacity:0}).text(a.data.step1?this.titleText.step1:this.titleText.step2).animate({opacity:1},P.CONST.TRANSITION_DELAY)},onRegisterSuccess:function(a){this.options.open_new_window_on_success?(a.stopPropagation(),P.changeWindowLocation("/",!0),window.close()):(a.stopPropagation(),P.changeWindowLocation("/"))},onChildNavigate:function(a){if(this.options.next&&a.data&&-1!==a.data.url.indexOf("/login/")){var b=P.getQueryStringParams();b.next=this.options.next,a.data.url="/login/?"+$.param(b)}},showFacebookTooltip:function(){this.facebookTooltip.fadeIn(500)},onFacebookLoginFailure:function(a){a.stopPropagation(),P.trackRegisterAction("contextual_signup_join_facebook"),this.facebookConnectButton.showLoading(),P.UserRegistration.fetchNetworkData(P.SocialConnect.FACEBOOK).then(function(a){this.log.debug("FB data:",a),this.facebookConnectButton.hideLoading()}.bind(this))}}),goog.provide("P.modules.Input"),goog.require("P.Module"),P.modules.Input=P.Module.extend({onContentReady:function(){this._value=this.options.value||"",this.options.placeholder&&this.$el.placeholder()},setValue:function(a){this.$el.val(a)},getValue:function(){return this.$el.val()},focus:function(){this.$el.focus()},clear:function(){this.setValue("")},clearPlaceholder:function(){this.options.placeholder&&(this.$el.attr("placeholder",""),this.$el.val(""))},restorePlaceholder:function(){this.options.placeholder&&this.$el.attr("placeholder",this.options.placeholder)},setCursorPosition:function(a){this.$el[0].setSelectionRange(a,a)}}),goog.provide("P.modules.Interest"),goog.require("P.Module"),P.modules.Interest=P.Module.extend({events:{"click .interestWrapper":"onInterestImageClick","click .wholeInterestMask":"onInterestImageClick"},CssClassName:{IS_CHECKED:"checked"},onContentReady:function(){this.followButton=this.getChildByModuleName("InterestFollowButton"),this.isFollowed=this.data.is_followed,this.followButton&&this.listen(this.followButton,P.CONST.EVENT_BUTTON_CLICK,this.onFollowButtonClick);var a=this.data.id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onInterestFollowOrUnfollow,b[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onInterestFollowOrUnfollow,this.pubsubSubscribe(a,b)}},onFollowButtonClick:function(){this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,this.data,!0),this.toggleVisualState()},onInterestImageClick:function(){this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,this.data,!0),this.toggleVisualState();var a=this.$(".interestWrapper");a.is("div")&&this.followButton&&this.followButton.toggleFollow()},onInterestFollowOrUnfollow:function(){if(this.followButton){var a=this.followButton.options.followed;this.setVisualState(a)}},setVisualState:function(a){this._updateFollowState(a),this.options.show_mask&&this.$(".wholeInterestMask").toggle(a),this.options.checkable&&this.$(".selectCheck").toggleClass(this.CssClassName.IS_CHECKED,a)},showOverflowMask:function(a){var b=this.$(".overflowMask");if(b&&a){var c=b.find(".text");c&&c.text(a)}b.show()},_updateFollowState:function(a){this.isFollowed=a;var b=this.isFollowed?P.CONST.EVENT_INTEREST_FOLLOW:P.CONST.EVENT_INTEREST_UNFOLLOW,c=_.extend({},this.data,{is_followed:this.isFollowed});this.triggerEvent(b,c,!0)},toggleVisualState:function(){this.setVisualState(!this.isFollowed)}}),goog.provide("P.modules.InterestFeedPage"),goog.require("P.Module"),P.modules.InterestFeedPage=P.Module.extend({CssClassName:{BACKWARDS:"backwards"},_hexToRGB:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:{r:150,g:156,b:157}},onContentReady:function(){P.currentUser.isAuthenticated()||Cookie.set(P.CONST.COOKIE_LAST_UNAUTH_INTEREST_ID,this.data.id);var a=this.$(".interestHeaderBackground");if(a.length){var b="left",c=a.attr("style").replace("background-color: ","");a.hasClass(this.CssClassName.BACKWARDS)&&(b="right");var d=this._hexToRGB(c),e=d.r,f=d.g,g=d.b,h="rgba("+e+","+f+","+g+",1) 0%,",i=h+" rgba("+e+","+f+","+g+",0) 17%,",j=i+" rgba("+e+","+f+","+g+",0) 17%,",k=j+" rgba("+e+","+f+","+g+",1) 35%,",l=k+" rgba("+e+","+f+","+g+",1) 100%",m="background: linear-gradient(to "+b+", "+l+");";this.$(".bgGradient").attr("style","background-color: "+c+";"+m),this.$(".rightImage").delay(1e3).animate({opacity:.7},{duration:500});var n={experiment_name:"more_signup_modals",page_url:P.getCurrentUrl()};if(!P.currentUser.isAuthenticated()&&P.signupModalManager.modalsEnabled){var o=P.resourceFactory.create("SEOExperimentResource",n);o.callGet({showError:!1}).then(function(a){var b=a.resource_response.data.experiment_group;"enabled"===b&&P.signupModalManager.disableModals()})}}}}),goog.provide("P.modules.InternationalSubdomains"),goog.require("P.Module"),P.modules.InternationalSubdomains=P.Module.extend({}),goog.provide("P.modules.InviteListBase"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.TypeaheadProvider");var MIN_SCROLL_THRESHOLD=2500,EMAIL_NETWORKS=["google","yahoo","microsoft","invitability"];P.modules.InviteListBase=P.Module.extend({events:{"click .inviteAllLabel":"_onClickInviteAll",'textchange input[type="text"]':"_onTextChange"},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.scrollableElement=this.$(".inviteContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this._onInviteScroll),this.inviteList=this.getChildById("inviteList"),this.emptyResultsFooter=this.$(".emptyResultsFooterContainer"),this.sendButton=this.getChildById("inviteButton"),this.options.checkable&&(this.inviteAllCheck=this.getChildById("inviteAllCheck")),this._reset()},_reset:function(){this.checkedContacts={},this.options.checkable&&(this.sendButton.setEnabled(!1),this.childListen(P.CONST.EVENT_CHANGE,this._onChange)),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onClick),this._onInviteScroll=this._onInviteScroll.bind(this),this._onInviteScroll=_.throttle(this._onInviteScroll,200);var a={name:"invite",tags:this.options.network,count:50};this.typeahead=new P.TypeaheadProvider(a),this.typeahead.prefetch(),this.listen(this.typeahead,P.CONST.EVENT_DATA,this.onTypeaheadData)},_onInviteScroll:function(){if(!this.rendering&&this._searchIsEmpty()){var a=this.$(".List");if(a.position()){var b=a.height()+a.position().top-this.scrollableElement.height();b<=MIN_SCROLL_THRESHOLD&&this._fetchMore()}return!1}},_onChange:function(a){var b=a.target;if("inviteAllCheck"===b.id)this._onToggleInviteAll(a);else{for(var c=0,d=0;d<this.inviteList.children.length;d++){var e=this.inviteList.children[d];this.checkedContacts[e.getEmail()]=e.isChecked(),c+=e.isChecked()?1:0}this._searchIsEmpty()&&this.inviteAllCheck.setChecked(c===this.inviteList.children.length,!1);var f=0;for(var g in this.checkedContacts)this.checkedContacts[g]&&f++;this.sendButton.setEnabled(f>0)}},_onClick:function(a){"inviteButton"===a.target.id&&this._onClickInvite(a)},_fetchMore:function(){return this.inviteList.options.item_options.checkedAll=this.inviteAllChecked(),this.resource.atEnd()?void this.removeListener(this._scrollListener):(this.rendering=!0,void this.getChildById("inviteList").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1}.bind(this)))},_onTextChange:function(){this._filterResults()},onTypeaheadData:function(a){if(!this._searchIsEmpty()&&this._getSearchText()===a.term){var b=[];_.each(a.items,function(a){var c=$.extend({},a);$.inArray(this.options.network,EMAIL_NETWORKS)>=0&&(c.id_type="email"),this.options.checkable&&(this.checkedContacts[c.id]|=this.inviteAllChecked(),c.checked=this.checkedContacts[c.id]),b.push(c)}.bind(this)),this.inviteList.options.items=b,this.inviteList.resource=null,this.inviteList.render(),b.length?this.emptyResultsFooter.hide():this.emptyResultsFooter.show()}},_filterResults:function(a){this._searchIsEmpty()?(this.inviteList.resource||this.inviteList.renderAbort(),this.emptyResultsFooter.hide(),this.inviteList.resource=this.resource,delete this.inviteList.options.items,this.inviteList.render().then(function(){this._searchIsEmpty()&&(this.options.checkable&&_.each(this.inviteList.children,function(a){a.setChecked(this.checkedContacts[a.getEmail()],!1)}.bind(this)),a&&a())}.bind(this))):this.typeahead.search(this._getSearchText(),function(){})},_getSearchText:function(){return this.$("input[type='text']").val().toLowerCase()},_searchIsEmpty:function(){var a=this._getSearchText();return!a||""===a},inviteAllChecked:function(){return this.options.checkable&&this.inviteAllCheck.isChecked()},_onClickInvite:function(){this.sendInvitesClicked()},_onToggleInviteAll:function(){this._getSearchText()?(this.$("input[type='text']").val(""),this._filterResults(function(){this._toggleInviteAll()}.bind(this))):this._toggleInviteAll()},_onClickInviteAll:function(){this.inviteAllCheck.setChecked(!this.inviteAllChecked()),this._onToggleInviteAll()},_toggleInviteAll:function(){var a=this.inviteAllChecked();_.each(this.inviteList.children,function(b){this.checkedContacts[b.getEmail()]=a,b.setChecked(a)}.bind(this)),this.sendButton.setEnabled(a)},getCheckedContacts:function(){return this.checkedContacts},sendInvitesClicked:P.NOOP}),goog.provide("P.modules.InviteListEmail"),goog.require("P.Module"),goog.require("P.modules.InviteListBase"),P.modules.InviteListEmail=P.modules.InviteListBase.extend({onContentReady:function(){P.modules.InviteListBase.prototype.onContentReady.apply(this,arguments),this.sendInvitationEmailModule=this.getChildById("sendInvitationEmailModule")},onTypeaheadData:function(a){P.modules.InviteListBase.prototype.onTypeaheadData.apply(this,arguments);var b=a.term,c=P.isEmailAddress(b);this.sendInvitationEmailModule.options={text_value:b,is_valid_email:c},this.sendInvitationEmailModule.render()},sendInvitesClicked:function(){var a,b=[],c="invitability"===this.options.network;if(this.inviteAllChecked()&&!c)a=P.resourceFactory.create("BulkNetworkInviteResource",{network:this.options.network});else{var d=this.getCheckedContacts();for(var e in d)d[e]&&b.push(e);var f=this.inviteAllChecked()&&c;if(a=P.resourceFactory.create("UserMultiInviteResource",{emails:b,invite_all:f}),!this.inviteAllChecked()&&c){var g=P.resourceFactory.create("InviteSentLogResource",{emails_invited:b});g.callCreate()}}this.sendButton.showLoading(),this._triggerInviteEventWithData(a,b)},_triggerInviteEventWithData:function(a){a.callCreate().then(function(){this.sendButton.hideLoading(),this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)}.bind(this))}}),goog.provide("P.modules.InviteListFacebook"),goog.require("P.Module"),goog.require("P.modules.InviteListBase"),P.modules.InviteListFacebook=P.modules.InviteListBase.extend({onContentReady:function(){P.modules.InviteListBase.prototype.onContentReady.apply(this,arguments),P.fb.ensureInit(P.NOOP)}}),goog.provide("P.modules.InviteModal"),goog.provide("P.modules.InviteModal.showInviteModal"),goog.require("P.Module"),P.modules.InviteModal=P.Module.extend({}),P.modules.InviteModal.showInviteModal=function(a,b){var c={name:"InviteModal",options:{page:b},resource:{name:"UserResource",options:{user_id:a}}};P.loadModule(c).then(function(a){P.getModalManager().createAndShowModal(a,{can_dismiss:!1})})},goog.provide("P.modules.JumpStartCategoriesBar"),goog.require("P.Module"),P.modules.JumpStartCategoriesBar=P.Module.extend({}),goog.provide("P.modules.JumpStartUnauthExistingUserActions"),goog.require("P.Module"),P.modules.JumpStartUnauthExistingUserActions=P.Module.extend({}),goog.provide("P.modules.JumpStartUnauthHomeFooter"),goog.require("P.Module"),P.modules.JumpStartUnauthHomeFooter=P.Module.extend({}),goog.provide("P.modules.JumpStartUnauthNewUserActions"),goog.require("P.Module"),P.modules.JumpStartUnauthNewUserActions=P.Module.extend({}),goog.provide("P.modules.JumpStartUnauthWall"),goog.require("P.Module"),P.modules.JumpStartUnauthWall=P.Module.extend({}),goog.provide("P.modules.JumpStartUserRegisterEmail"),goog.require("P.Module"),P.modules.JumpStartUserRegisterEmail=P.Module.extend({}),goog.provide("P.modules.JumpStartUserRegisterLegalTerms"),goog.require("P.Module"),P.modules.JumpStartUserRegisterLegalTerms=P.Module.extend({}),goog.provide("P.modules.KLPBar"),goog.require("P.Module"),P.modules.KLPBar=P.Module.extend({onContentReady:function(){this.isEmpty()?P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_KLP_BAR,P.CONST.PUBSUB_TOPIC_KLP_BAR_HIDDEN):(this.show(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_KLP_BAR,P.CONST.PUBSUB_TOPIC_KLP_BAR_SHOWN))}}),goog.provide("P.modules.Label"),goog.require("P.Module"),P.modules.Label=P.Module.extend({}),goog.provide("P.modules.LanguageDropdown"),goog.require("P.Module"),P.modules.LanguageDropdown=P.Module.extend({events:{"click .language":"onClick"},onClick:function(a){var b=$(a.currentTarget),c=P.url.appendQueryString(b.attr("data-url"),P.getQueryStringParams());return P.navigate(c),!1}}),goog.provide("P.modules.LanguageMenu"),goog.require("P.Module"),P.modules.LanguageMenu=P.Module.extend({}),goog.provide("P.modules.LikeButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.LikeButton=P.modules.Button.extend({CssClassName:_.extend(P.modules.Button.prototype.CssClassName,{UNLIKE:"unlike"}),onClick:function(){this.ensureAuthentication()&&this._toggle()},getAuthRedirectUrl:function(){return P.currentUser.isAuthenticated()?void P.changeWindowLocation(P.getRegisterUrl({action:"like"}),!1):P.signupModalManager.showInlineSignupModalOnButtonClick("LikeButton")},setState:function(a){var b=this.$el;this.options.liked=a,b.toggleClass(this.CssClassName.UNLIKE,a),a?this.options.show_text?this.$(".buttonText").html(b.data("text-unlike")):this.setAccessibilityText(b.data("text-unlike")):this.options.show_text?this.$(".buttonText").html(b.data("text-like")):this.setAccessibilityText(b.data("text-like"))},getLikeResource:function(){throw new Error("must be overridden")},onOptimisticToggle:function(){},onToggleSuccess:function(){},_toggle:function(){var a=!this.options.liked,b=this.getLikeResource(a);if(b){var c=a?b.callCreate():b.callDelete();this.options.optimistic?(this.setState(a),this.onOptimisticToggle(a),c.then(function(){this.onToggleSuccess(a)}.bind(this),function(){this.setState(!a)}.bind(this))):(this.showLoading(),c.then(function(){this.setState(a),this.onToggleSuccess(a)}.bind(this)).fin(function(){this.hideLoading()}.bind(this)))}}}),goog.provide("P.modules.List"),goog.require("P.Module"),P.modules.List=P.Module.extend({events:{"click li":"onItemClick"},onItemClick:function(a){this.triggerEvent(P.CONST.EVENT_LIST_ITEM_CLICK,a.target,!1)},onChildRemoved:function(a,b){b.remove()},hasMoreItems:function(){return this.resource&&!this.resource.atEnd()},requestMoreItems:function(){this._requestMoreItems()},_requestMoreItems:function(a){_.isUndefined(a)&&(a=2),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0),this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0)}.bind(this),function(){a>0&&this._requestMoreItems(a-1),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_ERROR,null,!0)}.bind(this))},setPageSize:function(a){this.resource&&this.resource.set("page_size",a)}}),goog.provide("P.modules.LoginBase"),goog.require("P.CONST"),goog.require("P.experiments"),goog.require("P.Form"),goog.require("P.Module"),P.modules.LoginBase=P.Module.extend({events:{},onContentReady:function(){var a=P.getQueryStringParams().message;if(a){var b;"reactivate"===a?b=P._("Your account has been reactivated! Please log in to continue."):"permanent_account_closure"===a&&(b=P._("Thanks for giving Pinterest a try. Your account will be closed soon.")),this.showError(b)}this.setupForm(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.getChildById("facebookLogin")&&this.listen(this.getChildById("facebookLogin"),P.CONST.EVENT_BUTTON_CLICK,this.facebookConnect),this.getChildById("twitterLogin")&&this.listen(this.getChildById("twitterLogin"),P.CONST.EVENT_BUTTON_CLICK,this.twitterConnect),this.getChildById("rakutenLogin")&&this.listen(this.getChildById("rakutenLogin"),P.CONST.EVENT_BUTTON_CLICK,this.rakutenConnect),this.getChildById("emailSignup")&&this.listen(this.getChildById("emailSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onEmailSignup),this.getChildById("facebookSignup")&&this.listen(this.getChildById("facebookSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onFacebookSignup),this.getChildById("twitterSignup")&&this.listen(this.getChildById("twitterSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onTwitterSignup),this.getChildById("rakutenSignup")&&this.listen(this.getChildById("rakutenSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onRakutenSignup),P.trackRegisterAction("register_landing")},setupForm:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{username_or_email:[P.Validator.Required(),P.Validator.Email()],password:[P.Validator.Required()]},{})},onSubmitValidated:function(a){if(!a["errors[0]"]){var b=this.form.getValue("username_or_email");this.login({username_or_email:b,password:this.form.getValue("password")}).then(void 0,function(a){if(this.showError(a.message),a.api_error_code===P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE){var c=P.getResetPasswordOneClickUrl({username_or_email:b});this.navigate(c)}}.bind(this))}},twitterConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.TWITTER,this.onTwitterConnectSuccess.bind(this))},facebookConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.FACEBOOK,this.onFacebookConnectSuccess.bind(this))},rakutenConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.RAKUTEN,this.onRakutenConnectSuccess.bind(this))},onEmailSignup:function(){P.trackRegisterAction("register_email")},onFacebookSignup:function(a){a.stopPropagation(),P.trackRegisterAction("register_facebook_attempt"),this.facebookConnect(a)},onTwitterSignup:function(a){a.stopPropagation(),P.trackRegisterAction("register_twitter_attempt"),this.twitterConnect(a)},onRakutenSignup:function(a){a.stopPropagation(),P.trackRegisterAction("register_rakuten_attempt"),this.rakutenConnect(a)},onFacebookConnectSuccess:function(a){this.login({facebook_id:a.id,facebook_token:a.access_token}).then(void 0,this.registerWithFacebook.bind(this))},registerWithFacebook:function(a){if(this.options.register){var b=this.getChildById("facebookSignup");b.showLoading(),P.UserRegistration.fastTrackSocialRegistration(P.SocialConnect.FACEBOOK).then(function(){var a="/";this.options.auto_follow_interest&&(a=P.url.appendQueryString(a,{auto_follow_interest:this.options.auto_follow_interest})),P.changeWindowLocation(a,!1)}.bind(this),function(a){a instanceof P.NoEmailProvidedError?(this.rerequestFacebookEmail=!0,this.triggerEvent(P.CONST.EVENT_FACEBOOK_REQUIRE_EMAIL,null,!0)):this.navigate("/join/register/facebook/")}.bind(this)).fin(function(){b.hideLoading()})}else P.showError(a.message)},onTwitterConnectSuccess:function(a){P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_ID,a.id),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_TOKEN,a.oauth_token),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_TOKEN_SECRET,a.oauth_secret),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_FIRST_NAME,a.first_name),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_LAST_NAME,a.last_name),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_USERNAME,a.screen_name),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_IMAGE_URL,a.image_url),this.options.register?this.navigate("/join/register/twitter/"):this.login({twitter_id:a.id,twitter_token:a.oauth_token,twitter_token_secret:a.oauth_secret}).then(void 0,function(a){P.showError(a.message)})},onRakutenConnectSuccess:function(a){P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_ID,a.id),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_TOKEN,a.access_token),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN,a.refresh_token),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME,a.first_name),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_GENDER,a.gender),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_EMAIL,a.email),this.login({rakuten_id:a.id,rakuten_token:a.access_token,rakuten_refresh_token:a.refresh_token}).then(void 0,function(a){if(this.options.register){var b=this.getChildById("rakutenSignup");b.showLoading(),P.UserRegistration.fastTrackSocialRegistration(P.SocialConnect.RAKUTEN).then(function(){P.changeWindowLocation("/",!1)},function(){this.navigate("/join/register/rakuten/")}.bind(this)).fin(function(){b.hideLoading()})}else P.showError(a.message)}.bind(this))},showError:function(a){this.$("#errorMessage").html(_.escape(a)),this.$(".loginError").show()},connect:function(a,b){return P.SocialConnect.instance().connect(a,{success:function(a){b(a)},error:function(a){a.alertedUpstream||P.showError(P.string.common.connectError)},rerequest_facebook_email:"facebook"===a&&this.rerequestFacebookEmail}),!1},autoFollowInterest:function(a){var b={interest_list:"favorited",interest_id:a},c="InterestFollowResource",d="interest_auto_follow",e=P.resourceFactory.create(c,b);e.callCreate({showError:!1}).then(function(){P.trackGAEvent(d,P.CONST.GA_ACTION_SUCCESS)},function(){P.trackGAEvent(d,P.CONST.GA_ACTION_ERROR)
})},login:function(a){var b=this.getChildById("loginButton");b&&b.showLoading();var c=P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW);return P.currentUser.login(a).then(function(){this.showLoading(!0),this.options.auto_follow_interest&&this.autoFollowInterest(this.options.auto_follow_interest),this.redirect(c)}.bind(this)).fin(function(){b&&b.hideLoading()})},redirect:function(a){var b="/";a&&(a.invite_follow_user?b="/"+a.invite_follow_user+"/":a.invite_follow_board&&(b="/"+a.invite_follow_board+"/"),P.SessionStorage.removeItem(P.CONST.SESSION_KEY_INVITE_FOLLOW));var c=this.options.next||this.options.prev||b;this.options.auto_follow_interest&&(c=P.url.appendQueryString("/explore/"+this.options.auto_follow_interest,{auto_follow:"true"})),P.navigateAfterLoginStatusChange(c)}}),goog.provide("P.modules.LoginPage"),goog.require("P.Module"),P.modules.LoginPage=P.Module.extend({onAddedToDom:function(){this.resizeWindow(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onContentReady:function(){this.resizeWindow()},resizeWindow:function(){this.contentReady&&this.inDom&&P.getWindowManager().contain(this.$el)}}),goog.provide("P.modules.LogoutAppUpsell"),goog.require("P.Form"),goog.require("P.Module"),P.modules.LogoutAppUpsell=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onContentReady:function(){this.setupForm(),this.$("form input").first().focus()},setupForm:function(){var a={phone_or_email:[P.Validator.PhoneNumber()]};this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.sendButton=this.getChildById("submit_button")},onSubmitValidated:function(a){a.errors&&a.errors.length||this.installAppSms()},onFailure:function(){this.sendButton.hideLoading()},onSuccess:function(){this.$(".dialogInput").hide("fast"),this.$(".dialogSuccess").show("fast")},installAppSms:function(){var a=this.form.getValue("phone_or_email"),b=P.resourceFactory.create("SmsAppInstall",{number:a});this.sendButton.showLoading(),b.callCreate({showError:!1}).then(this.onSuccess.bind(this),this.onFailure.bind(this))}}),goog.provide("P.modules.LogoutPage"),goog.require("P.Module"),P.modules.LogoutPage=P.Module.extend({events:{},onContentReady:function(){this.logout()},logout:function(){var a=P.resourceFactory.create("UserSessionResource",{disable_auth_failure_redirect:!0}),b=this.options.next||"/";b=P.url.appendQueryString(b,{logged_out:!0}),a.callDelete().then(function(){P.trackRegisterAction("logout"),P.SessionStorage.clear(),P.LocalStorage.clear(),P.currentUser.logout().then(function(){P.navigateAfterLoginStatusChange(b)})})}}),require("common/lib/external/mapbox.uncompressed-2.1.5-patched.js"),goog.provide("P.modules.Map"),goog.require("P.Module"),goog.require("P.versionedFileLoader");var MAPBOX_ACCESS_TOKEN="pk.eyJ1IjoicGludGVyZXN0IiwiYSI6ImdQSE45XzgifQ.4HhVEoWGNG2ZXxTC1x56kQ",SAFE_ZONE_MIN_PADDING_VALUE=70,FIT_TO_WORLD="world";P.MarkerOptions=function(){this.pin=null,this.highlighted=!1,this.animated=!1,this.placeholder=!1,this.latitude=!1,this.longitude=!1},P.MarkerOptionsFactory={},P.MarkerOptionsFactory.fromPlainObject=function(a){var b=new P.MarkerOptions;return"pin"in a&&(b.pin=a.pin),"highlighted"in a&&(b.highlighted=a.highlighted),"animated"in a&&(b.animated=a.animated),"placeholder"in a&&(b.placeholder=a.placeholder),"latitude"in a&&(b.latitude=a.latitude),"longitude"in a&&(b.longitude=a.longitude),"type"in a&&"place"===a.type&&(b.place=a),b};var VIEW_TYPE_BOARD_PAGE="board_page",VIEW_TYPE_CLOSEUP="closeup",NUNJUCKS_TEMPLATE_DIRECTORY="app/common/modules/do/rich-pins/place/Map/",TEMPLATE_POPUP_DEFAULT=NUNJUCKS_TEMPLATE_DIRECTORY+"markerPopup.nunjucks",MARKER_CLUSTER_TEMPLATE=NUNJUCKS_TEMPLATE_DIRECTORY+"markerCluster.nunjucks",MARKER_TEMPLATE=NUNJUCKS_TEMPLATE_DIRECTORY+"marker.nunjucks",TEMPLATE_POPUP_TOAST=NUNJUCKS_TEMPLATE_DIRECTORY+"addToMapToast.nunjucks",MAX_ZOOM_LEVEL=17,DEFAULT_POPUP_WIDTH=270,TIME_UNTIL_TOAST_REMOVES_SELF=3e3,TIME_MARKER_ANIMATION=500,TIME_TOAST_FADE_ANIMATION=300;P.modules.Map=P.Module.extend({CssClassName:{FADE_OUT_NOT_ACTIONABLE:"fadeOut notActionable",FADE_OUT_UP:"fadeOutUp",HIGHLIGHTED_MARKER_ICON:"highlightedMarkerIcon",TOP_ZINDEX:"topZIndex"},inDesktopPlaceBoard:function(){return this.options.in_desktop_place_board},setup:function(){if(this.map)this.triggerEvent(P.CONST.EVENT_MAP_READY,null,!0);else{var a=this.options.map_id,b=this.options.geocode_query;if(b){var c={query:b},d=P.resourceFactory.create("GeocodeResource",c);d.call("get",{}).then(function(b){var c=b.resource_response.data,d=c.length>0?c[0]:FIT_TO_WORLD;this._prepareMap(a,d)}.bind(this),function(){this._prepareMap(a,null)}.bind(this))}else this._prepareMap(a,null)}},_prepareMap:function(a,b){this._generateMap(a,b),this._initializeMapHandlers(),this._paddingTopLeft=L.point(0,0),this.triggerEvent(P.CONST.EVENT_MAP_READY,null,!0)},_isBoardView:function(){return this.options.view_type===VIEW_TYPE_BOARD_PAGE},_isCloseupView:function(){return this.options.view_type===VIEW_TYPE_CLOSEUP},resizeMap:function(){var a=this.$el,b=this.map.getSize().x,c=this.map.getSize().y;(a.width()>b||a.height()>c)&&this.map.invalidateSize({pan:!1})},addMarkerToCloseupMap:function(){var a=this.options.pin_geo;if(a){var b=[a.latitude,a.longitude],c=this.map,d={highlighted:!0,animated:!1,pin:this.options.pin},e=this._generateDivIcon(d),f=L.marker(b,{icon:e});f.addTo(c);var g=f.getLatLng();c.setView(g,15)}},replaceToastWithDefaultPopup:function(a){var b=a._source,c=b.options;c.template=TEMPLATE_POPUP_DEFAULT;var d=this._generatePopup(c);b.bindPopup(d,{closeButton:!1,autoPan:!1,maxWidth:DEFAULT_POPUP_WIDTH,minWidth:DEFAULT_POPUP_WIDTH})},addMarkerToMap:function(a){var b=this._generateMarker(a),c=a.placeholder?this.placeholderMarkerLayer:this.markerLayer;if(!a.placeholder)if(a.animated&&(a.template=TEMPLATE_POPUP_TOAST),_.extend(b.options,a),this.inDesktopPlaceBoard())b.on("click",function(a){var b=a.target.pin_id;this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,b,!0)}.bind(this));else{var d=this._generatePopup(a);b.bindPopup(d,{closeButton:!!a.animated,autoPan:!1,maxWidth:P.CONST.PIN_WIDTH,minWidth:P.CONST.PIN_WIDTH})}b.addTo(c),a.placeholder?b._bringToFront():this.map.fire("moveend")},toggleTranslucentMarkers:function(a){var b=this.markerLayer.getLayers();_.each(b,function(b){var c=this.markerLayer.getVisibleParent(b);c&&$(c._icon).toggleClass(this.CssClassName.FADE_OUT_NOT_ACTIONABLE,a)}.bind(this))},_generateMarker:function(a){var b=a.pin,c=a.highlighted,d=a.animated,e=a.coordinates||b.getCoordinates&&b.getCoordinates(),f=a.name,g=a.placeholder,h={highlighted:c,animated:d,placeholder:g,pin:b};f&&(h.name=f);var i,j;if(b){i=b.getPinId();var k=b.getPlaceData();k&&(j=k.id)}"place"in a&&(j=a.place.id);var l=this._generateDivIcon(h),m=L.marker(e,{icon:l,riseOnHover:!0,pin_id:i,place:j});return i&&(m.pin_id=i),m},_generatePopup:function(a){var b=a.pin,c=a.name||b.getPlaceName(),d=b.getPlaceData()||a,e=a.template||TEMPLATE_POPUP_DEFAULT,f=P.nunjucks.render(e,{name:c,place:d,url:d.url});return f},_generateDivIcon:function(a){var b=this._getDivIconOptions(a),c=L.divIcon(b);return c},clearMarkers:function(){this.markerLayer.clearLayers()},getCityBoundsFromCenter:function(a){var b=.05;return this.makeLatLngBoundsFromLatLngAndPadding(a,b)},makeLatLngBoundsFromLatLngAndPadding:function(a,b){var c=L.latLng(a.lat-b,a.lng-b),d=L.latLng(a.lat+b,a.lng+b);return L.latLngBounds(c,d)},getCenter:function(){var a=this.map&&this.map.getCenter();return a?a:null},setPaddingTopLeft:function(a){this._paddingTopLeft=a},getZoom:function(){return this.map?this.map.getZoom():null},getBounds:function(){return this.map?this.map.getBounds():null},zoomToAndHighlightMarkerForPinId:function(a){this.map.once("moveend",function(){this.highlightMarkerForPinId(a)}.bind(this)),this.fitViewToMarkerForPinId(a)},highlightMarkerForPinId:function(a){this._setHighlightMarkerForPinId(a,!0)},showOnlyPlaceholderMarkerAtIndex:function(a){var b=this.placeholderMarkerLayer.getLayers();_.each(b,function(b,c){c!==a?$(b._icon).hide():$(b._icon).show()})},showAllPlaceholderMarkers:function(){var a=this.placeholderMarkerLayer.getLayers();_.each(a,function(a){$(a._icon).show()})},unHighlightMarkerForPinId:function(a){var b=this.getMarkerForPin(a);b&&(this._setHighlightMarkerForPinId(a,!1),b.closePopup())},removeMarkerForPinId:function(a){var b=this.getMarkerForPin(a);b&&this.markerLayer.removeLayer(b)},_setHighlightMarkerForPinId:function(a,b){var c=this.getMarkerForPin(a);if(this.markerLayer){var d=this.markerLayer.getVisibleParent(c);b?this.highlightMarker(d):this.unHighlightMarker(d)}},unHighlightMarker:function(a){var b=this.markerLayer.getVisibleParent(a),c=this._getIconElement(b);c.removeClass(this.CssClassName.HIGHLIGHTED_MARKER_ICON),this._highlightedPinMarker=null},_getIconElement:function(a){var b=$(a._icon);return b.find(".markerCluster, .markerIcon").first()},highlightMarker:function(a){var b=this.markerLayer.getVisibleParent(a),c=this._getIconElement(b);c.addClass(this.CssClassName.HIGHLIGHTED_MARKER_ICON),this._highlightedPinMarker=b},_setHighlightMarker:function(a,b,c){var d=this._generateDivIcon({highlighted:b,animated:!1,placeholder:c});a.setIcon(d),a._highlighted=b,b&&a._bringToFront()},getHighlightedMarker:function(){return this._highlightedPinMarker},_initializeMapHandlers:function(){this._isBoardView()&&(this.markerLayer.on("mousedown",function(){this._triggerBodyMousedown()}.bind(this)),this.map.on("click",function(){this.triggerEvent(P.CONST.EVENT_MAP_CLICK,null,!0)}.bind(this)),this.map.on("mousedown",function(){this._triggerBodyMousedown()}.bind(this)),this.map.on("dragend",function(){this.onDragEnd()}.bind(this)),this.map.on("zoomend",function(){this.onZoomEnd()}.bind(this)),this.markerLayer.on("popupopen",function(a){var b=a.popup;this.onPopupOpen(b)}.bind(this)),this.markerLayer.on("popupclose",function(a){var b=a.popup;this.onPopupClose(b)}.bind(this)),this.markerLayer.on("clusterclick",function(){this.onClusterClick()}.bind(this)))},onClusterClick:function(a){this.closeAllMarkerPopups(),this.triggerEvent(P.CONST.EVENT_MAP_CLUSTER_CLICK,a,!0)},onPopupOpen:function(a){var b=a._wrapper,c=a._source,d=c._icon,e=this.clientRectToBounds(b.getBoundingClientRect()),f=this.clientRectToBounds(d.getBoundingClientRect()),g=this.mergeBounds(e,f);this.ensureBoundsInSafeBounds(g);var h=c.options.pin_id;this.triggerEvent(P.CONST.EVENT_MAP_POPUP_OPENED,h,!0),c._bringToFront(),$(d).addClass(this.CssClassName.TOP_ZINDEX)},onPopupClose:function(a){var b=a._source,c=b._icon,d=b.__parent,e=this.markerLayer.getVisibleParent(d);b.options.animated&&(this.replaceToastWithDefaultPopup(a),b.options.animated=!1),this.unHighlightMarker(b),e&&"unspiderfy"in e&&b===this._singleMarkerSpiderfied?(this._singleMarkerSpiderfied=null,e.unspiderfy(),P.setTimeout(function(){e._group._unspiderfyLayer(b),this.unHighlightMarker(e)}.bind(this),180)):this.unHighlightMarker(b),this.resetPinButtons(),$(c).removeClass(this.CssClassName.TOP_ZINDEX)},getSafeZonePaddingTopLeft:function(){return this._paddingTopLeft},unHighlightPlaceholderMarker:function(a){var b=this.placeholderMarkerLayer.getLayers()[a];b&&this._setHighlightMarker(b,!1,!0)},getSafeZonePaddingBottomRight:function(){var a=SAFE_ZONE_MIN_PADDING_VALUE,b=SAFE_ZONE_MIN_PADDING_VALUE;return L.point(a,b)},clientRectToBounds:function(a){var b=L.point(a.left,a.top),c=L.point(a.right,a.bottom);return L.bounds(b,c)},inflateBounds:function(a,b){var c=L.bounds(a.min.clone(),a.max.clone());return c.min.x-=b,c.min.y-=b,c.max.x+=b,c.max.y+=b,c},mergeBounds:function(a,b){var c=Math.min(a.min.x,b.min.x),d=Math.min(a.min.y,b.min.y),e=Math.max(a.max.x,b.max.x),f=Math.max(a.max.y,b.max.y);return L.bounds(L.point(c,d),L.point(e,f))},ensureBoundsInSafeBounds:function(a){var b=this.getSafeZoneBounds(),c=5,d=this.inflateBounds(b,-1*c),e=0;a.min.x<d.min.x?e=a.min.x-d.min.x:a.max.x>d.max.x&&(e=a.max.x-d.max.x);var f=0;a.min.y<d.min.y?f=a.min.y-d.min.y:a.max.y>d.max.y&&(f=a.max.y-d.max.y),(0!==e||0!==f)&&this.panBy(L.point(e,f))},getRawView:function(){return{center:this.map.getCenter(),zoom:this.map.getZoom()}},setRawView:function(a){this.map.setView(a.center,a.zoom)},panTo:function(a){this.setView(a,this.map.getZoom())},setView:function(a,b){var c=this.getSafeZonePaddingTopLeft(),d=this.getSafeZonePaddingBottomRight(),e=d.subtract(c).divideBy(2),f=this.map.project(a,b),g=this.map.unproject(f.add(e),b);this.map.setView(g,b)},panBy:function(a){this.map.panBy(a)},fitBounds:function(a){var b=this.getSafeZonePaddingTopLeft(),c=this.getSafeZonePaddingBottomRight();this.map.fitBounds(a,{paddingTopLeft:b,paddingBottomRight:c})},fitQuery:function(a){var b={query:a},c=P.resourceFactory.create("GeocodeResource",b);c.call("get",{}).then(function(a){var b=a.resource_response.data;b.length>0?this.fitLocation(b[0]):this.fitWorld()}.bind(this),this.fitWorld)},fitLocation:function(a){var b=a.bounds;if(b){var c=L.latLng(b.sw.latitude,b.sw.longitude),d=L.latLng(b.ne.latitude,b.ne.longitude);this.fitBounds(L.latLngBounds(c,d))}else{var e=a.longitude,f=a.latitude;this.map.setView([f,e],12)}},fitWorld:function(){this.map.fitWorld().panTo([40.58,-36.91])},fitViewToMarkerForPinId:function(a){var b=this.getMarkerForPin(a);b&&this.fitViewToMarker(b)},fitViewToMarker:function(a){var b=a.getLatLng(),c=this.markerLayer.getVisibleParent(a);if(a===c||this.getZoom()===MAX_ZOOM_LEVEL)this.map.panTo(b),this.map.fire("moveend");else{var d=this.getZoomToFitMarker(a);this.map.setView(b,d)}},getZoomToFitMarker:function(a){var b=this.getZoom(),c=this.markerLayer.getVisibleParent(a),d=[];for(d.push(c);b<MAX_ZOOM_LEVEL;){b++;for(var e=[],f=0;f<d.length;f++){for(var g=d[f],h=g._markers,i=0;i<h.length;i++)if(h[i]===a)return b;e=e.concat(g._childClusters)}d=e}return MAX_ZOOM_LEVEL},getMinZoomToCover:function(a,b){for(var c=L.CRS.EPSG3857,d=1;d<=MAX_ZOOM_LEVEL;d++){var e=L.latLng(90,-180),f=L.latLng(-90,180),g=c.latLngToPoint(e,d),h=c.latLngToPoint(f,d),i=h.x-g.x,j=h.y-g.y,k=i>a&&j>b;if(k)return d}return MAX_ZOOM_LEVEL},getMinZoom:function(a){var b=$(a),c=b.width(),d=b.height();return this.getMinZoomToCover(c,d)},updateMinZoom:function(){var a=this.map.getContainer(),b=this.getMinZoom(a);this.map.options.minZoom=b,this.map._updateZoomLevels()},zoomIn:function(){this.map.zoomIn()},zoomOut:function(){this.map.zoomOut()},zoomIntoBounds:function(){var a=this.markerLayer.getLayers(),b=a.length,c=0,d=0;if(_.each(a,function(a){var b=a.getLatLng();c+=b.lat,d+=b.lng}),0!==b){var e=L.latLng(c/b,d/b);this.map.setView(e,this.map.getZoom()+1,{animate:!0,duration:.4})}else this.zoomIn()},zoomOutOfBounds:function(a){var b=this.map.getSize().y-a,c=this.map.getSize().x-this.getWidth(),d=L.point(c,b),e=this.markerLayer.getLayers().length;if(0!==e){var f=this.markerLayer.getBounds();this.map.fitBounds(f,{paddingBottomRight:d,duration:.4})}else this.zoomOut()},getAttributionElement:function(){return this.$(".attribution")},_generateMap:function(a,b){var c="",d=this._isBoardView();c=d?"mapbox_board_page":"mapbox_closeup";var e=this.$("#"+c)[0],f=this.getMinZoom(document.getElementById(c)),g={detectRetina:!0};$(".ielt9").length||(g.format="png64"),L.mapbox.accessToken=MAPBOX_ACCESS_TOKEN,this.map=L.mapbox.map(e,a,{maxZoom:MAX_ZOOM_LEVEL,minZoom:f,worldCopyJump:!0,keyboard:!1,zoomControl:!1,attributionControl:!1,inertiaThreshold:75,inertiaDeceleration:5e3,tileLayer:g}),this.markerLayer=new L.MarkerClusterGroup({mapModule:this,showCoverageOnHover:!1,removeOutsideVisibleBounds:!1,maxClusterRadius:65,iconCreateFunction:function(a){a=a;var b=a.getAllChildMarkers(),c=b[0].options.pin,d=null,e=a.getChildCount();c&&(d=c.getImageUrl("236x"));var f={};return f.markerClusterPinImage=d,f.clusterChildCount=e,new L.DivIcon({html:P.nunjucks.render(MARKER_CLUSTER_TEMPLATE,f),iconSize:[52,74],iconAnchor:[24,66]})}}).addTo(this.map),this.placeholderMarkerLayer=L.featureGroup().addTo(this.map),this.map.scrollWheelZoom.disable(),d?P.CONTEXT.is_mobile_agent||(new L.Control.CustomMapZoomControl).addTo(this.map):new L.Control.Zoom({position:"bottomright"}).addTo(this.map),b&&(b===FIT_TO_WORLD?this.fitWorld():this.fitLocation(b))},onResize:function(){this.updateMinZoom()},addPermanentMarker:function(a){var b=a.pin,c=b.getId();this.addMarkerToMap(a),P.setTimeout(function(){this.inDesktopPlaceBoard()?this.triggerEvent(P.CONST.EVENT_PIN_PLACE_ADDED,c,!0):(this.openPopupForPin(c),P.setTimeout(function(){var a=this.getMarkerForPin(c),b=this.$(".leaflet-popup-content-wrapper, .leaflet-popup-tip-container");b.addClass(this.CssClassName.FADE_OUT_UP),P.setTimeout(function(){a.closePopup(),b.removeClass(this.CssClassName.FADE_OUT_UP)}.bind(this),TIME_TOAST_FADE_ANIMATION)}.bind(this),TIME_UNTIL_TOAST_REMOVES_SELF))}.bind(this),TIME_MARKER_ANIMATION)},clearPlaceholderMarkers:function(){this.placeholderMarkerLayer.clearLayers()},setPlaceholderMarkers:function(a,b){this.clearPlaceholderMarkers();for(var c=0,d=a.length;c<d;c++){var e=a[c];this.addMarkerToMap(e)}b&&this.fitViewToPlaceholderMarkers()},clearPlaceholderHighlights:function(){_.each(this.placeholderMarkerLayer.getLayers(),function(a){this._setHighlightMarker(a,!1,!0)}.bind(this))},highlightPlaceholderMarker:function(a){var b=this.placeholderMarkerLayer.getLayers()[a];if(b){this._setHighlightMarker(b,!0,!0);var c=this.getSafeZoneBounds(),d=b.getLatLng(),e=this.map.latLngToContainerPoint(d);if(!c.contains(e)){var f=this.map.getZoom();this.setView(d,f)}}},onAddedToDom:function(){var a=this.setup.bind(this);P.VersionedFileLoader.instance.loadScript("webapp/js/app/common/bundle-mapbox.js",function(){a()})},fitViewToPlaceholderMarkers:function(){this.fitViewToMarkers(!0)},fitViewToPinMarkers:function(){this.fitViewToMarkers(!1)},closeAllMarkerPopups:function(){var a=this.markerLayer.getLayers();_.each(a,function(a){a.closePopup()})},fitViewToMarkers:function(a){if(this.map){var b=a?this.placeholderMarkerLayer:this.markerLayer,c=b.getBounds();c&&!_.isEmpty(c)&&(this.fitBounds(c),a||this._ensureMarkersAreInBounds())}},_ensureMarkersAreInBounds:function(){var a=this.markerLayer.getLayers();if(a.length){var b=this.getSafeZoneBounds(),c=!1;if(_.each(a,function(a){var d=a.getLatLng(),e=this.map.latLngToContainerPoint(d);b.contains(e)&&(c=!0)}.bind(this)),!c){var d=this.markerLayer.getLayers()[0];this.panTo(d.getLatLng())}}},resetPinButtons:function(){this.triggerEvent(P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON,null,!0)},getSafeZoneBounds:function(){var a=this.getSafeZonePaddingTopLeft(),b=this.map.getSize().subtract(this.getSafeZonePaddingBottomRight());return L.bounds(a,b)},getSafeZoneLatLngBounds:function(){var a=this.getSafeZonePaddingTopLeft(),b=this.map.getSize().subtract(this.getSafeZonePaddingBottomRight()),c=this.map.containerPointToLatLng(a),d=this.map.containerPointToLatLng(b);return new L.LatLngBounds(c,d)},openPopupForMarker:function(a){var b=this.markerLayer.getVisibleParent(a);if(b&&"getChildCount"in b&&b.getChildCount()>1){var c=this.map.latLngToLayerPoint(a._latlng);c.y+=10;var d=b._generatePointsCircle(1,c);b._animationSpiderfy([a],d),this._singleMarkerSpiderfied=a}a.openPopup()},openPopupForPin:function(a){var b=this.getMarkerForPin(a);this.openPopupForMarker(b)},getMarkerForPin:function(a){if(this.markerLayer){var b=_.find(this.markerLayer.getLayers(),function(b){return b.pin_id===a});return b}},onCreated:function(){this._pinIdToMarkerIndex={},this._highlightedPinMarker=null,this.resizeListener=null,this._mapCardinalDirectionToNearestMoreMarker={}},_getDivIconOptions:function(a){var b=a.highlighted,c=a.animated,d=a.placeholder,e=[0,-55],f="markerIconWrapper";c&&(f+=" animated");var g="markerIcon";b&&(g+=" highlightedMarkerIcon");var h,i,j,k,l;d?(g+=" placeholder",h=9,i=9,j=[h,i],k=[h/2,i/2]):(g+=" pin",h=52,i=70,j=[h,i],k=[17,70],l=a.pin);var m={iconSize:[h,i],iconAnchor:[h/2,i],popupAnchor:e,pin:l},n=null;l&&!d&&(n="getImageUrl"in l?l.getImageUrl("236x"):l.images["236x"].url);var o={};return o.markerWrapperClassName=f,o.markerClassName=g,o.pinImage=[n],m.html=P.nunjucks.render(MARKER_TEMPLATE,o),m},addMarkersToMap:function(a){_.each(a,function(a){var b=a.getCoordinates&&a.getCoordinates();if(b){var c={pin:a,highlighted:!1,animated:!1};this.addMarkerToMap(c)}}.bind(this))},_triggerBodyMousedown:function(){$("body").trigger("mousedown")},onDragEnd:function(){this.triggerEvent(P.CONST.EVENT_MAP_DRAG_END,null,!0)},onZoomEnd:function(){this.triggerEvent(P.CONST.EVENT_MAP_ZOOM_END,null,!0)},disableMapControls:function(){this.map.boxZoom.disable(),this.map.dragging.disable(),this.map.touchZoom.disable(),this.map.doubleClickZoom.disable(),this.inDesktopPlaceBoard()&&this.map.scrollWheelZoom.disable(),this.map.tap&&this.map.tap.disable(),this.$(".mapbox").find(".leaflet-control-zoom").hide()},enableMapControls:function(){this.map.boxZoom.enable(),this.map.dragging.enable(),this.map.touchZoom.enable(),this.map.doubleClickZoom.enable(),this.inDesktopPlaceBoard()&&this.map.scrollWheelZoom.enable(),this.map.tap&&this.map.tap.enable(),this.$(".mapbox").find(".leaflet-control-zoom").show()}}),goog.provide("P.modules.MobileLandingPage"),goog.require("P.Module"),P.modules.MobileLandingPage=P.Module.extend({}),goog.provide("P.modules.ModalManager"),goog.require("P.Module");var _modalManager=null;P.getModalManager=function(){return _modalManager},P.modules.ModalManager=P.Module.extend({onCreated:function(){_modalManager=this,this._onKeyup=this._onKeyup.bind(this),this._animatedElement=null,this.childListen(P.CONST.EVENT_DESTROYED,this._onModalDestroyed),this.childListen(P.CONST.EVENT_DISMISS,this._onModalDismiss)},showModal:function(a,b,c){b&&b.only_modal&&this.hasModals()||(a.moduleOpener=c,this.appendChild(a),a.show(),a.focus(),1===this.children.length&&this._addListeners(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,{moduleName:"Modal",action:P.CONST.ViewActions.OPEN}))},hasModals:function(){return this.children.length>=1},removeModal:function(a){a.animateOutAndDestroy()},removeAllModals:function(a){this.children.forEach(function(b){var c=b;(a||c.getCanDismiss())&&c.destroy()})},createAndShowModal:function(a,b,c){if(b&&b.only_modal&&this.hasModals())return Promise.resolve();var d={name:"Modal",options:b};return P.loadModule(d).then(function(d){return d.render().then(function(){d.setSubmodule(a),this.showModal(d,b,c)}.bind(this))}.bind(this))},_onModalDismiss:function(a){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,{moduleName:"Modal",action:P.CONST.ViewActions.CLOSE});var b=a.target.parent;this.removeModal(b)},_onModalDestroyed:function(){this.children.length||this._removeListeners()},_addListeners:function(){$(document).on("keyup",this._onKeyup)},_removeListeners:function(){$(document).off("keyup",this._onKeyup)},getTopModal:function(){if(!this.hasModals())return null;var a=this.children[this.children.length-1];return a||null},removeTopModal:function(){if(this.hasModals()){var a=this.children.pop();a.animateOutAndDestroy()}},removeModalWithAnimation:function(a,b,c){return new Promise(function(d){var e={queue:!1};c&&(e.duration=c);var f=a.$(".modalContent"),g=f.offset(),h=$(b).offset();if(!h||!g||!f)return a.destroy(),void d(void 0);var i=[f.css({left:g.left,position:"fixed",top:g.top}).animate({left:h.left,top:h.top,height:"0px",width:"0px"},e),a.$(".inModal").animate({height:"0px",opacity:"hide",width:"0px"},e)];$.when.apply($,i).always(function(){a.destroy(),d(void 0)})})},_onKeyup:function(a){if(a.keyCode===P.keyCode.ESCAPE){var b=this.getTopModal();b&&b.getCanDismiss()&&this.removeModal(b)}},setAnimatedModule:function(a){this._animatedModule&&this._animatedModule.destroy(),this._animatedModule=a,a&&a.getContent().addClass("animatingToModal")},getAnimatedModule:function(){return this._animatedModule}}),goog.provide("P.modules.ModalTrigger"),goog.require("P.Module"),P.modules.ModalTrigger=P.Module.extend({showModalSubmodule:function(){return P.util.showModalSubmodule(this)}}),goog.provide("P.modules.MultiInviter"),goog.require("P.Module"),P.modules.MultiInviter=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this._onInviteSent)},_onInviteSent:function(){this.$(".inviteConfirm").show(),P.setTimeout(function(){this.$(".inviteConfirm").hide()}.bind(this),2e3)}}),goog.provide("P.modules.MultiInviterEmail"),goog.require("P.Form"),goog.require("P.Module"),P.modules.MultiInviterEmail=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick),this.listen(this,P.CONST.EVENT_TAB_SELECTED,this._onTabSelected)},_onTabSelected:function(){"fallback_tab_index"in this.options&&!this.getContent().find("div.inviteContent li").length&&(this.empty(),this.triggerEvent(P.CONST.EVENT_DATA_EMPTY,this.options.fallback_tab_index,!0)),this.options.network||this.$(".emailInput").focus()},onContentReady:function(){if(P.Module.prototype.onContentReady.apply(this,arguments),!this.options.network){this.emailInviteButton=this.getChildById("invite"),this.gmailConnect=this.getChildById("gmailConnect"),this.yahooConnect=this.getChildById("yahooConnect"),this.microsoftConnect=this.getChildById("microsoftConnect");var a={email:[P.Validator.Required(),P.Validator.Email()]};this.form=new P.Form(this.$("form"),a),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated)}},_onSubmitValidated:function(a){if(!a.errors[0]){this.emailInviteButton.showLoading();var b=this.form.getValue("email");this.$(".emailInput").val(""),P.Invite.userInviteEmail(b,function(){this.emailInviteButton.hideLoading(),this.triggerEvent(P.CONST.EVENT_INVITE_USER,{recipients:[b]},!0)}.bind(this))}},_onButtonClick:function(a){var b=a.target,c=null;switch(b.id){case"gmailConnect":c=P.SocialConnect.GOOGLE;break;case"yahooConnect":c=P.SocialConnect.YAHOO;break;case"microsoftConnect":c=P.SocialConnect.MICROSOFT;break;default:return}b.showLoading(!0);var d=P.SocialNetworkSettingsManager.instance(),e={success:function(){var a={username:P.currentUser.attributes.username,filter:"not_on_pinterest"},e={success:function(){this.render()}.bind(this),error:function(){b.hideLoading()},resourceOptions:a};d.pollForFriends(c,e)}.bind(this),error:function(){b.hideLoading()}};d.handleConnect(c,!0,e)}}),goog.provide("P.modules.MultiInviterFacebook"),goog.require("P.Module"),P.modules.MultiInviterFacebook=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onClick)},_onClick:function(a){var b=a.target;if("connectFacebook"===b.id){var c=this.getChildById("connectFacebook"),d=P.SocialNetworkSettingsManager.instance(),e={success:function(){var a={username:P.currentUser.attributes.username,filter:"not_on_pinterest"},b={success:function(){this.options.reloadAll===!0?window.location.reload():this.render()}.bind(this),error:function(){c.hideLoading()},resourceOptions:a};d.pollForFriends("facebook",b)}.bind(this),error:function(){c.hideLoading()}};c.showLoading(),d.handleConnect("facebook",!0,e)}}}),goog.provide("P.modules.MultipleSelectButton"),goog.require("P.Module"),P.modules.MultipleSelectButton=P.Module.extend({onContentReady:function(){this._button=this.getChildById("button"),this.childListen(P.CONST.EVENT_CHANGE,this.onCheckboxChanged)},onCheckboxChanged:function(a){var b=a.target,c=b.getValue(),d=[];_.each(c,function(a){d.push(a.label)}),this._button.setText(d.join(", ")),a.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CHANGE,c,!0)}}),goog.provide("P.modules.NagBase"),goog.require("P.Module"),P.modules.NagBase=P.Module.extend({events:{"click .nagClose":"onCloseButtonClick"},clickHandler:function(){return null},onCloseButtonClick:function(){this.destroy(),P.trackGAEvent("nag",P.CONST.GA_ACTION_CLICK_CLOSE,"type",this.extraData.type)},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_NAG_UPDATED]=this.onActionSaved,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onActionSaved:function(a,b,c){this.updateNagMessage(c)},updateNagMessage:function(a){this.$(".message").text(a)},resourceCall:function(a,b,c){var d=c.success,e=c.error;this.xhr=$.ajax({cache:!1,url:a,data:{},dataType:"json",type:"get"===b?"get":"post",success:d,error:e})}}),goog.provide("P.modules.NagEmail"),goog.require("P.Module"),goog.require("P.modules.NagBase"),P.modules.NagEmail=P.modules.NagBase.extend({events:{"click .message a":"handleLinkClick"},onCreated:function(){this.successMessage=P._("Thanks! You should receive a confirmation email soon.")},handleLinkClick:function(a){switch(a.target.id){case"cancelEmailUpdate":this.cancelEmailUpdate();break;case"editEmail":this.updateEmail();break;case"removeBounce":this.removeBounce();break;case"resendEmail":this.resendConfirmEmail();break;case"resendEmailUpdate":this.resendUpdatedEmailAddressEmail()}return!1},removeBounce:function(){var a=P.resourceFactory.create("UserSettingsResource",{email_bounced:!1});a.callUpdate().then(function(){var a=P._("Got it! Make sure your inbox isn't full so that our emails can find their way to you.");this.updateNagMessage(a)}.bind(this))},updateEmail:function(){this.showLoading();var a={name:"UserEditEmail",resource:{name:"UserSettingsResource",options:{}}};P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this))},cancelEmailUpdate:function(){var a=P.resourceFactory.create("CancelEmailUpdateResource");a.callCreate().then(function(){this.updateNagMessage(P._("Thanks! Your email address change was cancelled."))}.bind(this))},resendUpdatedEmailAddressEmail:function(){var a=P.resourceFactory.create("ResendEmailUpdateEmailResource");a.callCreate().then(function(){this.updateNagMessage(this.successMessage)}.bind(this))},resendConfirmEmail:function(){var a=P.resourceFactory.create("ResendVerificationEmailResource");a.callCreate().then(function(){this.updateNagMessage(this.successMessage)}.bind(this))}}),goog.provide("P.modules.NagNoScript"),goog.require("P.Module"),P.modules.NagNoScript=P.Module.extend({}),goog.provide("P.modules.NagPolicy"),goog.require("P.Module"),goog.require("P.modules.NagBase"),P.modules.NagPolicy=P.modules.NagBase.extend({events:{"click .policy":"clickHandler"},clickHandler:function(){var a={name:"ConfirmDialog",options:{template:"pin_policy"}};return P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,function(){this.savePolicyConfirmation()})}.bind(this)),!1},onActionSaved:function(){P.modules.NagBase.prototype.onActionSaved.apply(this,arguments),P.setTimeout(function(){this.parent.render()}.bind(this),2e3)},savePolicyConfirmation:function(){var a=P.resourceFactory.create("ConfirmGuidelinesResource",{});a.callUpdate().then(function(){this.updateNagMessage(P._("Thanks for confirming!"))}.bind(this),function(a){this.log.debug(a)}.bind(this))}}),goog.provide("P.modules.NagSearch"),goog.require("P.Module"),P.modules.NagSearch=P.Module.extend({}),goog.provide("P.modules.NagSecurity"),goog.require("P.Module"),goog.require("P.modules.NagBase"),P.modules.NagSecurity=P.modules.NagBase.extend({onContentReady:function(){this.showWriteBanned()},events:{"click .resetPassword":"clickHandler"},clickHandler:function(){var a=function(){var a=P._("Thanks! You should receive a password reset email soon.");this.updateNagMessage(a)}.bind(this),b=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username});return b.callCreate({showError:!1}).then(a),!1},showWriteBanned:function(){P.writeban.showWriteBanned(this)}}),goog.provide("P.modules.Nags"),goog.require("P.Module"),P.modules.Nags=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_NAG_STATE]=this.onNagStateChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a);
var b={};b[P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW]=this.onMainModuleChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,b)},onNagStateChange:function(a,b,c){this.$el.toggle(c)},onMainModuleChange:function(a,b,c){var d=c;this.options.main_module_name!==d.className&&(this.options.main_module_name=d.className,this.render())}}),goog.provide("P.modules.NavigateButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.NavigateButton=P.modules.Button.extend({CssClassName:P.modules.Button.prototype.CssClassName,getNavigateUrl:function(){return this.options.url},onClick:function(a){this.options.ga_category&&P.trackGAEvent(this.options.ga_category,P.CONST.GA_ACTION_CLICK),this._logContextEvent(a),a.stopPropagation(),a.preventDefault();var b=this.getNavigateUrl();P.modules.Button.prototype.onClick.call(this,a),this.navigate(b,null,this.options.force_refresh,{pinId:this.options.safe_link_pin_id,useNewTab:this.options.use_new_tab})},getLoggingObjectIdStr:function(){return this.options.log_obj_id?this.options.log_obj_id:P.modules.Button.prototype.getLoggingObjectIdStr.call(this)}}),goog.provide("P.modules.NetworkNotificationItems"),goog.require("P.Module");var todaysHtml="<div class='networkNotifDateHeader unseenHeader todayHeader'><span> {{text}} </span></div>",headerHtml="<div class='networkNotifDateHeader'><span> {{timeSince}} </span></div>",headerClass=".networkNotifDateHeader";P.modules.NetworkNotificationItems=P.Module.extend({events:{addHeaders:"addHeadersToContent"},CssClassName:{UNSEEN:"unseen"},onContentReady:function(){this.listen(this,"addHeaders",this.addHeadersToContent),this.trigger("addHeaders")},addHeadersToContent:function(){this.$(headerClass).remove();var a=!1,b="",c=P._("Today's stories"),d=P.string.format(todaysHtml,{text:c}),e=this.$(".networkNotifItem"),f=this;e.each(function(){var c=$(this),e=c.data("time"),g=new Date(1e3*parseInt(e,10)),h=new Date,i=P.locale.formatDate(h,P.locale.DateFormatType.WEEKDAY_DATE),j=P.locale.formatDate(g,P.locale.DateFormatType.WEEKDAY_DATE);i===j&&c.addClass(f.CssClassName.UNSEEN),i!==j||a?j!==b&&$(headerHtml.replace("{{timeSince}}",j)).insertBefore(c):($(d).insertBefore(c),a=!0),b=j})}}),goog.provide("P.modules.NetworkNotifications"),goog.require("P.Module");var NETWORK_MIN_THRESHOLD=300;P.modules.NetworkNotifications=P.Module.extend({events:{"click .networkNotifItem":"onNetworkNotificationClick"},CssClassName:{UNSEEN:"unseen"},mixins:[P.Mixins.PreventScroll],onCreated:function(){this.onNetworkNotificationsScroll=this.onNetworkNotificationsScroll.bind(this),this.onNetworkNotificationsScroll=_.throttle(this.onNetworkNotificationsScroll,200)},onContentReady:function(){this.scrollableElement=this.$(".networkNotifContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this.onNetworkNotificationsScroll),this.startPreventScroll(this.scrollableElement,this.$(".NetworkNotificationItems")),this.parent&&this.listen(this.parent,P.CONST.EVENT_DROPDOWN_HIDE,this.onHide)},onHide:function(){this.$(".unseen").removeClass(this.CssClassName.UNSEEN)},onNetworkNotificationsScroll:function(){if(!this.rendering){var a=this.$(".NetworkNotificationItems"),b=a.height()+a.position().top-this.scrollableElement.height();return b<=NETWORK_MIN_THRESHOLD&&this.fetchMore(),!1}},onNetworkNotificationClick:function(a){var b=$(a.target),c=$(a.currentTarget),d=c.attr("data-url");return b.is("a")?!0:void(d&&this.navigate(d))},fetchMore:function(){if(!this.rendering){if(this.resource.atEnd())return void this.removeListener(this._scrollListener);this.rendering=!0,this.getChildById("items").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1,this.addHeadersToChildContent()}.bind(this))}},addHeadersToChildContent:function(){this.$(".NetworkNotificationItems").trigger("addHeaders")}}),goog.provide("P.modules.NetworkStoryActorInfoOverride"),goog.require("P.Module"),P.modules.NetworkStoryActorInfoOverride=P.Module.extend({}),goog.provide("P.modules.NetworkStoryInfoBar"),goog.require("P.Module"),P.modules.NetworkStoryInfoBar=P.Module.extend({}),goog.provide("P.modules.NetworkStoryLandingPage"),goog.require("P.Module"),P.modules.NetworkStoryLandingPage=P.Module.extend({}),goog.provide("P.modules.NewYearsAnimation"),goog.require("P.Module"),P.modules.NewYearsAnimation=P.Module.extend({events:{"click .mask":"playVideo"},CssClassName:{ANIMATE:"animate"},onContentReady:function(){this.video=this.$("video"),this.audio=this.$("audio"),this.$el.removeClass(this.CssClassName.ANIMATE),this.button=this.$(".play"),this.mask=this.$(".mask");var a=this;this.video.on("canplaythrough",{button:this.button},function(){a.button.css({opacity:.8}),a.mask.css({"pointer-events":"auto"})}),this.video.get(0).readyState>3&&(this.button.css({opacity:.8}),a.mask.css({"pointer-events":"auto"})),setTimeout(function(){a.button.css({opacity:.8}),a.mask.css({"pointer-events":"auto"})},1e3)},onRemovedFromDom:function(){this.resetVideo()},resetVideo:function(){this.button.show();var a=this.video.get(0),b=this.audio.get(0);this.$el.removeClass(this.CssClassName.ANIMATE),b.pause(),b.currentTime=0,a.pause(),a.currentTime=0,a.load()},playVideo:function(){this.scaleToFit(),this.$el.addClass(this.CssClassName.ANIMATE),this.button.hide(),this.video.get(0).play(),this.audio.get(0).play();var a=this;this.video.on("playing",function(){a.video.css("visibility","visible")}),this.video.get(0).addEventListener("ended",function(){a.video.get(0).play()},!1)},scaleToFit:function(){var a=.8,b=this.$el.height()*a,c=this.$el.width()*a;this.$(".scaleToFit").each(function(){var a=$(this).children(":first"),d=Math.min(b/a.height(),c/a.width());$(this).css({transform:"scale("+d.toString()+")"})})}}),goog.provide("P.modules.NewYearsEmbedPage"),goog.require("P.Module"),P.modules.NewYearsEmbedPage=P.Module.extend({}),goog.provide("P.modules.NotificationItemBalanced"),goog.require("P.Module"),P.modules.NotificationItemBalanced=P.Module.extend({}),goog.provide("P.modules.NotificationItems"),goog.require("P.Module"),P.modules.NotificationItems=P.Module.extend({}),goog.provide("P.modules.NotificationSettings"),goog.require("P.Form"),goog.require("P.Module");var MODULE_ID_EMAIL_GLOBAL_TOGGLE="emailGlobalToggle";P.modules.NotificationSettings=P.Module.extend({CssClassName:{DISABLED:"emailDisabled",EMAIL_SETTINGS:"emailSettings"},onContentReady:function(){this.$form=this.$("form");var a=new P.Form(this.$form,[]);this.listen(a,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange)},updateResource:function(){var a={},b={};this.$(".pushNotifSettings input[type=checkbox]").each(function(){var a=$(this),c=a.attr("name");b[c.substr(5)]=a.is(":checked")?"anyone":"none"}),a.push_settings=JSON.stringify(b),a.filter_settings=this.$("input[name=filter_settings]:checked").val();var c=P.resourceFactory.create("NotificationSettingsResource",a);return c.callUpdate()},onSubmitValidated:function(){this.showLoading(!0);var a=this.updateResource();return this.isInModal()&&(a=a.then(function(){this.destroy()}.bind(this))),a.fin(this.hideLoading.bind(this)),!1},onChildChange:function(a){var b=a.target;b.id===MODULE_ID_EMAIL_GLOBAL_TOGGLE&&(b.isChecked()?this.setEmailsEnabled(!0):this.confirmDisableEmails())},confirmDisableEmails:function(){var a={name:"ConfirmDialog",options:{template:"disable_emails_confirm"}};P.loadModule(a).then(function(a){this.showInModal(a);var b=this.listen(a,P.CONST.EVENT_DESTROYED,function(){var a=this.getChildById(MODULE_ID_EMAIL_GLOBAL_TOGGLE);a.setChecked(!0)});this.listen(a,P.CONST.EVENT_CONFIRM,function(){this.setEmailsEnabled(!1),this.removeListener(b)})}.bind(this))},setEmailsEnabled:function(a){var b=P.resourceFactory.create("UserSettingsResource",{email_enabled:a}),c=this.$("."+this.CssClassName.EMAIL_SETTINGS);c.toggleClass(this.CssClassName.DISABLED,!a),b.callUpdate()}}),goog.provide("P.modules.Notifications"),goog.require("P.Module");var MIN_THRESHOLD=300;P.modules.Notifications=P.Module.extend({events:{"click .notificationItem":"onNotificationClick"},mixins:[P.Mixins.PreventScroll],onCreated:function(){this.onNotificationsScroll=this.onNotificationsScroll.bind(this),this.onNotificationsScroll=_.throttle(this.onNotificationsScroll,200)},onContentReady:function(){this.scrollableElement=this.$(".notifContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this.onNotificationsScroll);var a=this.$(".NotificationItems");this.startPreventScroll(this.scrollableElement,a)},onNotificationClick:function(a){var b=$(a.target),c=$(a.currentTarget),d=c.attr("data-url");return b.is("a")?!0:void(d&&this.navigate(d))},onNotificationsScroll:function(){if(!this.rendering){var a=this.getChildById("items").$el,b=a.height()+a.position().top-this.scrollableElement.height();return b<=MIN_THRESHOLD&&this.fetchMore(),!1}},fetchMore:function(){if(!this.rendering){if(this.resource.atEnd())return void this.removeListener(this._scrollListener);this.rendering=!0,this.getChildById("items").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1}.bind(this))}}}),goog.provide("P.modules.NuxImagesFeedPage"),goog.require("P.Module"),P.modules.NuxImagesFeedPage=P.Module.extend({}),goog.provide("P.modules.NuxModalInstallExtension"),goog.require("P.Module"),P.modules.NuxModalInstallExtension=P.Module.extend({events:{"click .optionalSkip":"onSkipClick"},onContentReady:function(){P.modules.NuxModalStepBase.prototype.onContentReady.call(this);var a=this.getChildById("installButton");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onInstallButtonClick),P.ContextLogger.getInstance().logCustomViewEvent(P.ContextLogging.ViewType.SAVE,P.ContextLogging.ViewParameterType.EXTENSION_UPSELL_NUX)},onInstallButtonClick:function(){P.trackRegisterAction("browser_extension_install_clicked"),P.browserExtension.instance.handleExtensionInstall(this._goToNextStep,P.NOOP)},onSkipClick:function(){this._launchSkipConfirmDialog()},_launchSkipConfirmDialog:function(){var a={name:"ConfirmDialog",options:{title:P._("Skip this step?"),body_message:P._("Without our button, you wont have an easy way to save recipes, project ideas and other things you find around the web."),dismiss_button_text:P._("Go back"),button_text:P._("Skip"),template:"generic"}};P.loadModule(a).then(function(a){this.showInModal(a,{mask_type:"dark",can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,function(){this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.CANCEL_EXTENSION_INSTALL_BUTTON,P.ContextLogging.ComponentType.BROWSER,{}),this._goToNextStep()})}.bind(this))},_goToNextStep:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},_skipInstall:function(){P.trackRegisterAction("browser_extension_skipped"),this._goToNextStep()}}),goog.provide("P.modules.NuxModalInstallExtensionFirefox"),goog.require("P.modules.NuxModalInstallExtension"),P.modules.NuxModalInstallExtensionFirefox=P.modules.NuxModalInstallExtension.extend({onContentReady:function(){P.modules.NuxModalInstallExtension.prototype.onContentReady.call(this),this.installButton=this.getChildById("installButton"),this.continueButton=this.getChildById("continueButton"),this.listen(this.continueButton,P.CONST.EVENT_BUTTON_CLICK,this._goToNextStep),this.continueButton.hide()},onInstallButtonClick:function(){P.browserExtension.instance.handleExtensionInstall(P.NOOP,P.NOOP),this.installButton.hide(),this.continueButton.show(),this.$(".optionalSkip").hide(),this.continueButton.showLoading(!0),P.setTimeout(function(){this.continueButton.hideLoading()}.bind(this),3e3)}}),goog.provide("P.modules.NuxPinCreate"),goog.require("P.Module"),P.modules.NuxPinCreate=P.Module.extend({}),goog.provide("P.modules.NuxProgressBase"),goog.require("P.Module"),goog.require("P.tutorialManager"),P.modules.NuxProgressBase=P.Module.extend({CssClassName:{HIDDEN:"hidden"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.options.auto_follow_interest&&this.autoFollowInterest(this.options.auto_follow_interest);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT]=this.triggerNextEvent,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a)},endMandatoryFlow:function(){},setStepTexts:function(){},initializeProgress:function(a){this.module=a?a.module:null,this.tutorialManager.isTutorialActive()||this.tutorialManager.startTutorial(this.getNuxTutorialName(),{renderModule:!1}),this.tutorialManager.setProgressModule(this)},onContentReady:function(){this.tutorialManager=P.TutorialManager.instance(),this.$header1=this.$(".headerTitle1"),this.$header2=this.$(".headerTitle2"),this.$skip=this.$(".skip"),this.nextButton=this.getChildById("nextButton"),this.progressData=this.extraData?this.extraData.progressData:null,this.nextStep(1),this.initializeProgress()},nextStep:function(a){this.currentStep=a,this.setStepTexts(a)},onButtonClick:function(a){var b=a.target;b&&("previousButton"===b.id?(a.stopPropagation(),this.triggerPreviousEvent()):"nextButton"===b.id&&(a.stopPropagation(),this.triggerNextEvent()))},getNextButton:function(){return this.nextButton},_handleSkipButton:function(a){this.$skip&&(a&&!_.isEmpty(a)?(this.$skip.removeClass(this.CssClassName.HIDDEN),this.$skip.bind("click",function(){this._launchSkipConfirmDialog(a)}.bind(this))):this.$skip.addClass(this.CssClassName.HIDDEN))},_updateHeaders:function(a,b){a&&this.$header1.html(a),b&&this.$header2.html(b)},_launchSkipConfirmDialog:function(a){var b={name:"ConfirmDialog",options:{button_text:a.button_text,dismiss_button_text:a.dismiss_button_text,body_message:a.body_message,title:a.title,template:"generic"}};P.loadModule(b).then(function(a){this.showInModal(a,{mask_type:"dark",can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!1)})}.bind(this))},getNuxTutorialName:function(){return this.extraData?this.extraData.tutorialName:"interestsNuxMweb"},getNuxTutorialStep:function(){return this.currentStep?this.currentStep:1},triggerPreviousEvent:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!1)},triggerNextEvent:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!1)}}),goog.provide("P.modules.NuxProgressMweb"),goog.require("P.Module"),goog.require("P.tutorialManager"),goog.require("P.modules.NuxProgressBase"),P.modules.NuxProgressMweb=P.modules.NuxProgressBase.extend({onCreated:function(){P.modules.NuxProgressBase.prototype.onCreated.call(this);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT]=this.updateFollowButton,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a)},onContentReady:function(){this.$progressWrapper=this.$(".nuxProgress"),this.$progressFooterWrapper=this.$(".progressFooterWrapper"),P.modules.NuxProgressBase.prototype.onContentReady.call(this)},endMandatoryFlow:function(){return P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_MOBILE_EVERYTHING_FEED_TAKEOVER,P.Experiences.Experience.WEB_MOBILE_NUX_INTERESTS)?P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_MOBILE_EVERYTHING_FEED_TAKEOVER,P.Experiences.Experience.WEB_MOBILE_NUX_INTERESTS):Promise.resolve()},setStepTexts:function(a){var b,c,d,e,f;if(this.progressData){var g=this.progressData[this.getNuxTutorialName()];if(g){var h=g.steps;if(h){var i=h[a];if(i){if(i.hideHeader)return this.$progressWrapper.hide(),void this.$progressFooterWrapper.hide();b=i.buttonText,c=i.header1,d=i.header2,e=i.skip_data,f=i.disableButton,this.$progressWrapper.show(),this.$progressFooterWrapper.show()}}}}this.$skip&&(this.$skip.unbind(),this._handleSkipButton(e)),b&&(f&&this.getNextButton().disable(),this.getNextButton().setText(b),this.getNextButton().show()),this._updateHeaders(c,d)},onRemoved:function(){P.app.showInterstitial()},updateFollowButton:function(a,b,c){var d=c,e=d.total,f=5-e,g="";f>0?(g=P.string.format(P._("Follow {{ numToFollow }} more"),{numToFollow:f}),this.getNextButton().setText(g),this.getNextButton().disable()):(g=P._("Follow"),this.getNextButton().setText(g),this.getNextButton().enable())}}),goog.provide("P.modules.NuxTutorial"),goog.require("P.Module"),P.modules.NuxTutorial=P.Module.extend({}),goog.provide("P.modules.OAuthDialog"),goog.require("P.Module"),P.modules.OAuthDialog=P.Module.extend({events:{},onContentReady:function(){this.resizeWindowToFit()},onChildRemoved:function(){this.children.length?this.resizeWindowToFit():window.close()},resizeWindowToFit:function(){P.getWindowManager().shrinkWrap()}}),goog.provide("P.modules.OAuthErrorPage"),goog.require("P.Module"),P.modules.OAuthErrorPage=P.Module.extend({}),goog.provide("P.modules.OAuthPageBase"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.Button");var REDIRECT_DELAY=2e3;P.modules.OAuthPageBase=P.Module.extend({getOAuthResource:function(a){var b=_.extend(this.resource.copyOptions(!0),a);return P.resourceFactory.create("OAuthAuthorizationResource",b)},makeAuthorizationDecision:function(a,b,c){var d=this.getOAuthResource({authorized:a});d.callCreate().then(function(a){this.tryRedirect(a.resource_response.data,c)}.bind(this)).fin(function(){b&&b.hideLoading()})},tryRedirect:function(a,b){if(a.redirect){var c=a.redirect_uri,d={};a.access_token?(c+="#",d={access_token:a.access_token,expires_at:a.expires_at,token_type:a.token_type}):a.code&&(c+="?",d={code:a.code}),a.state&&(d.state=a.state),c+=$.param(d),b?(this.showRedirectScreen(),P.setTimeout(function(){P.changeWindowLocation(c)},REDIRECT_DELAY)):P.changeWindowLocation(c)}},onContentReady:function(){this.setupForm(),this.$("form input").first().focus()},setupForm:function(){if(0!==this.$(".standardForm").length){var a={username_or_email:[P.Validator.Required(),P.Validator.Email()],password:[P.Validator.Required()]};this.loginForm=new P.Form(this.$("form"),a),this.loginFormListener=this.listen(this.loginForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)}},onSubmitValidated:function(a){a.errors&&a.errors.length||P.currentUser.login(this.loginForm.getData()).then(function(){this.authorizeApp()}.bind(this),function(a){if(this.$(".loginError").html(a.message).show(),a.api_error_code===P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE){var b=P.getResetPasswordOneClickUrl({username_or_email:this.loginForm.email});this.navigate(b)}}.bind(this))},authorizeApp:function(){var a=this.getChildById("authorizeButton");a.showLoading(),this.makeAuthorizationDecision(!0,a,!0)},onAuthorizeButtonClicked:function(a){this.loginForm?this.loginForm.onSubmit(a):this.authorizeApp()},showRedirectScreen:function(){this.$(".body").hide(),this.$(".loading").show()}}),goog.provide("P.modules.OffsitePage"),goog.require("P.Module"),P.modules.OffsitePage=P.Module.extend({onContentReady:function(){var a=function(){window.close()};if(P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this),this.listen(this,P.CONST.EVENT_DISMISS,a);else{var b={name:"ConfirmDialog",options:{template:"offsite_warning",sanitized_url:this.options.sanitized_url,redirect_status:this.options.redirect_status,offsite_message:this.options.offsite_message}};P.loadModule(b).then(function(b){b.render().then(function(){P.getModalManager().createAndShowModal(b),b.on(P.CONST.EVENT_CONFIRM,function(){window.location.replace(this.options.sanitized_url),b.off(P.CONST.EVENT_DESTROYED,a)}.bind(this)),b.on(P.CONST.EVENT_DESTROYED,a)}.bind(this))}.bind(this))}}}),goog.provide("P.modules.OffsiteWork"),goog.require("P.Module"),P.modules.OffsiteWork=P.Module.extend({}),goog.provide("P.modules.OrderItem"),goog.require("P.Module"),P.modules.OrderItem=P.Module.extend({}),goog.provide("P.modules.OrderView"),goog.require("P.Module"),P.modules.OrderView=P.Module.extend({}),goog.provide("P.modules.PagedCollection"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.Spinner"),P.modules.PagedCollection=P.Module.extend({CssClassName:{LOADING:"loading"},onContentReady:function(){this._moreItemsButtonClickListener&&this.removeListener(this._moreItemsButtonClickListener),this._moreItemsButtonClickListener=this.listen(this.getMoreItemsButton(),P.CONST.EVENT_BUTTON_CLICK,this._onMoreItemsButtonClick)},_onMoreItemsButtonClick:function(a){a.stopPropagation(),this.requestMore()},getMoreItemsContainer:function(){return this.$el.children(".moreItemsContainer")},getMoreItemsButton:function(){return this.getChildById("moreItems")},_hasBorderedButton:function(){var a=this.getMoreItemsButton();return a&&!a.options.borderless},showMoreItemsLoading:function(){if(this._hasBorderedButton())this.getMoreItemsButton().showLoading();else if(!this._moreItemsSpinner){var a=this.getMoreItemsContainer();a.addClass(this.CssClassName.LOADING),this._moreItemsSpinner=new P.Spinner({size:P.Spinner.Size.SMALL}),this._moreItemsSpinner.spin(a)}},hideMoreItemsLoading:function(){this._hasBorderedButton()?this.getMoreItemsButton().hideLoading():this._moreItemsSpinner&&(this.getMoreItemsContainer().removeClass(this.CssClassName.LOADING),this._moreItemsSpinner.stop(),this._moreItemsSpinner=null)},requestMore:P.NOOP}),goog.provide("P.modules.PasswordResetOneClick"),goog.require("P.Module"),P.modules.PasswordResetOneClick=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onResetPassword)},onSuccess:function(){this.$(".message").hide(),this.$(".successMessage").show()},onResetPassword:function(a){if("resetPasswordButton"===a.target.id){var b={username_or_email:this.options.username_or_email},c=P.resourceFactory.create("UserResetPasswordResource",b),d=this.getChildById("resetPasswordButton");d.showLoading(),c.callCreate({showError:!1}).then(function(){this.onSuccess()}.bind(this)).fin(function(){d.hideLoading()})}}}),goog.provide("P.modules.PickerItemCreate"),goog.require("P.Module"),P.modules.PickerItemCreate=P.Module.extend({setCreateName:function(a){this.$(".createName").text(a)}}),goog.provide("P.modules.PinBookmarklet"),goog.require("P.Module"),P.modules.PinBookmarklet=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onAddedToDom:function(){this._windowMessageListener=this.listen($(window),"message",this.onWindowMessage)},onRemovedFromDom:function(){this._windowMessageListener&&(this.removeListener(this._windowMessageListener),this._windowMessageListener=null)},_parseDataUri:function(a){var b=/^data:(.+\/.+);(.+),(.*)$/,c=a.match(b);return c?{contentType:c[1],encoding:c[2],payload:c[3]}:null},onWindowMessage:function(a){var b=a.originalEvent.data;if(b&&"pinImageData"===b.type){var c=b.dataUri;if(!c)return void P.showError(P._("Missing image data"));var d=this._parseDataUri(c);if(!d)return void P.showError(P._("Invalid image data uri"));if("base64"!==d.encoding)return void P.showError(P._("The image data URI uses an unsupported encoding"));var e=P.resourceFactory.create("ImagePreviewResource",{content_type:d.contentType,base64_payload:d.payload});e.callCreate().then(function(a){var b=a.resource_response.data.image_url;this._setImage(b)}.bind(this))}},_setImage:function(a){this.options.image_url=a;var b=this.getChildById("pinCreate");b.setImage(a)},onContentReady:function(){this.resizeWindowToFit();var a=this.options.image_url;!a&&window.opener&&window.opener.postMessage("pinterestReady","*")},onChildRemoved:function(){this.children.length?this.resizeWindowToFit():window.close()},onChildAdded:function(a){var b=this.$(".pinningBG");"pinSuccess"===a.id&&b.length&&b.remove()},onChildNavigate:function(a){var b=!0;P.changeWindowLocation(a.data.url,b),window.close()},resizeWindowToFit:function(){P.getWindowManager().shrinkWrap()}}),goog.provide("P.modules.PinComment"),goog.require("P.Module"),P.modules.PinComment=P.Module.extend({onCreated:function(){this.childListen("commentDeleteSuccess",this.onPinCommentDelete)},onPinCommentDelete:function(){this.$el.slideUp(300,function(){this.destroy()}.bind(this))}}),goog.provide("P.modules.PinCommentList"),goog.require("P.Module"),P.modules.PinCommentList=P.Module.extend({events:{},onCreated:function(){},onContentReady:function(){var a=this.options.pin_id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this.onPinCommentCreated,b[P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_NEXT_PAGE_REQUESTED]=this.fetchMore,this.pubsubSubscribe(a,b)}},fetchMore:function(){this.resource||(this.resource=P.resourceFactory.create("PinCommentListResource",{field_set_key:this.options.field_set_key,pin_id:this.options.pin_id})),this.resource.options.page_size=P.CONST.MAX_PAGE_SIZE,this.resource.getLatestBookmark()||this.resource.setBookmarks([this.options.bookmark]),this.renderAdditional(P.ModuleRenderType.PREPEND).then(function(){this.resource.atEnd()&&P.pubsub.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_LAST_PAGE_REACHED)}.bind(this))},populateComment:function(a){var b=this.getChildById("pinCommentField");b.setValue(a),b.focus()},onPinCommentCreated:function(){this.options.count++,this.render()}}),goog.provide("P.modules.PinCommentsPage"),goog.require("P.Module");var SHOW_MORE_LINK_CLASSNAME=".showMore";P.modules.PinCommentsPage=P.Module.extend({events:{"click .showMore":"onShowMore","mousedown .content":"onTextAreaMouseDown","keydown .content":"onTextAreaPossiblyResized","mouseup .content":"onTextAreaPossiblyResized"},onCreated:function(){this.commentContentHeight=null},onContentReady:function(){var a=this.options.pin_id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_LAST_PAGE_REACHED]=this.onLastPageReached,this.pubsubSubscribe(a,b)}this._visible=!0},onLastPageReached:function(){this.$(SHOW_MORE_LINK_CLASSNAME).hide()},toggle:function(){this._visible?this.hide():this.show(),this._visible=!this._visible},onShowMore:function(a){a.stopPropagation(),a.preventDefault(),P.pubsub.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_NEXT_PAGE_REQUESTED)},onTextAreaMouseDown:function(){this.commentContentHeight=this.$(".content").height()},onTextAreaPossiblyResized:function(){if(null!==this.commentContentHeight){var a=this.$(".content").height();this.commentContentHeight!==a&&(this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0),this.commentContentHeight=a)}}}),goog.provide("P.modules.PinCount"),goog.require("P.Module"),P.modules.PinCount=P.Module.extend({onContentReady:function(){if(this.options.can_update_count&&this.data.id){var a={};"UserResource"===this.resource.name&&(a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onCountUpdated),a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onCountUpdated,a[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onCountUpdated,this.pubsubSubscribe(this.data.id,a)}},onCountUpdated:function(a,b){var c=1e3;b===P.CONST.PUBSUB_TOPIC_PIN_DELETED&&(c=0),setTimeout(this.render.bind(this),c)}}),goog.provide("P.modules.PinCreateSuccess"),goog.require("P.Module");var CLOSE_DELAY_DEFAULT=2e3,CLOSE_DELAY_LONG=3e3,CLOSE_DELAY_WITH_RELATED_DATA=1e4,CLOSE_DELAY_AFTER_FOLLOW=1e3,BUTTON_ID_INSTALL_EXTENSION_BUTTON="installExtensionButton",BUTTON_ID_CANCEL_INSTALL_EXTENSION_BUTTON="cancelInstallButton",BUTTON_ID_GOT_IT_BUTTON_DOMAIN="gotItButtonDomain",BUTTON_ID_GOT_IT_BUTTON_ODD_CONTENTS="gotItButtonOddContents",BUTTON_ID_GOT_IT_BUTTON_CATEGORY_BOXED="gotItButtonCategoryBoxed",BUTTON_ID_GOT_IT_BUTTON_BOARD_BOXED="gotItButtonBoardBoxed",BUTTON_ID_DISMISS_ALL_PROMOS_BUTTON="dismissAllPromos";P.modules.PinCreateSuccess=P.Module.extend({CssClassName:{NO_BODY:"noBody"},onContentReady:function(){var a=P.getQueryStringParams().guid;a&&P.logWidgetEvent({guid:a,pin_id:this.options.pin_id});var b=CLOSE_DELAY_DEFAULT,c=!1,d=this.getChildById("successBoard");if(d&&d.hasBoard()){b=CLOSE_DELAY_WITH_RELATED_DATA,c=!0;var e={};e[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onBoardFollow,this.pubsubSubscribe(d.getBoardId(),e)}this.options.is_bulk_action&&(b=CLOSE_DELAY_LONG);var f=this.getChildById("successPromo");if(f&&!f.isValid())return void this.destroy();var g=this.getChildById(BUTTON_ID_INSTALL_EXTENSION_BUTTON);g&&this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onInstallExtensionButtonClick);var h=this.getChildById(BUTTON_ID_CANCEL_INSTALL_EXTENSION_BUTTON),i=this.getChildById(BUTTON_ID_GOT_IT_BUTTON_DOMAIN),j=this.getChildById(BUTTON_ID_GOT_IT_BUTTON_ODD_CONTENTS),k=this.getChildById(BUTTON_ID_GOT_IT_BUTTON_CATEGORY_BOXED),l=this.getChildById(BUTTON_ID_GOT_IT_BUTTON_BOARD_BOXED);(h||i||j||k||l)&&(this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onGotItButtonClick),b=CLOSE_DELAY_WITH_RELATED_DATA);var m=this.getChildById(BUTTON_ID_DISMISS_ALL_PROMOS_BUTTON);m&&this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onDismissAllPromosButtonClick),h?this._viewWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL):i?this._viewWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_DOMAIN):j?this._viewWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_ODD_CONTENTS):k?this._viewWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_CATEGORY_BOXED):l&&this._viewWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_BOARD_BOXED),c||this.$el.addClass(this.CssClassName.NO_BODY),P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)&&"bookmarklet"===this.options.method&&(b=CLOSE_DELAY_WITH_RELATED_DATA),this.options.auto_close!==!1&&this.closeOnDelay(b),P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_PIN_CLOSEUP,P.Experiences.Experience.WEB_PIN_CLOSEUP_LITE)},closeOnDelay:function(a){this.closeTimer&&clearTimeout(this.closeTimer),this.closeTimer=P.setTimeout(function(){this.closeTimer=null,this.destroy()}.bind(this),a)},onInstallExtensionButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_INSTALL_EXTENSION_BUTTON&&(P.browserExtension.instance.handleExtensionInstall(P.NOOP,P.NOOP),this._completeWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL))},onGotItButtonClick:function(a){var b,c=a.target;c.id===BUTTON_ID_CANCEL_INSTALL_EXTENSION_BUTTON?b=P.Experiences.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL:c.id===BUTTON_ID_GOT_IT_BUTTON_DOMAIN?b=P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_DOMAIN:c.id===BUTTON_ID_GOT_IT_BUTTON_ODD_CONTENTS?b=P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_ODD_CONTENTS:c.id===BUTTON_ID_GOT_IT_BUTTON_CATEGORY_BOXED?b=P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_CATEGORY_BOXED:c.id===BUTTON_ID_GOT_IT_BUTTON_BOARD_BOXED&&(b=P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_BOARD_BOXED),this._completeWebPinSuccessExperience(b)},onDismissAllPromosButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_DISMISS_ALL_PROMOS_BUTTON&&(this._completeWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL),this._completeWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_DOMAIN),this._completeWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_ODD_CONTENTS),this._completeWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_CATEGORY_BOXED),this._completeWebPinSuccessExperience(P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_ED_BOARD_BOXED))},_viewWebPinSuccessExperience:function(a){if(a){var b=P.ExperienceManager.instance().constructPlacedExperienceId(P.Experiences.Placement.WEB_PIN_SUCCESS,a);P.ExperienceManager.instance().viewPlacedExperienceId(b)}},_completeWebPinSuccessExperience:function(a){if(a){var b=P.ExperienceManager.instance().constructPlacedExperienceId(P.Experiences.Placement.WEB_PIN_SUCCESS,a);P.ExperienceManager.instance().completePlacedExperienceId(b)}},onBoardFollow:function(){this.closeOnDelay(CLOSE_DELAY_AFTER_FOLLOW)},onDestroyed:function(){"pin_create_ignition"===this.options.action&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)}}),goog.provide("P.modules.PinCreateSuccessBoard"),goog.require("P.Module"),P.modules.PinCreateSuccessBoard=P.Module.extend({onContentReady:function(){this.hasBoard||this.hide()
},hasBoard:function(){return!!this.getChildById("board")},getBoardId:function(){return this.extraData.boardId}}),goog.provide("P.modules.PinCreateSuccessBulkAction"),goog.require("P.Module"),P.modules.PinCreateSuccessBulkAction=P.Module.extend({hasBoard:function(){return!!this.getChildById("board")},getBoardId:function(){return this.extraData.boardId}}),goog.provide("P.modules.PinCreateSuccessExtensionNag"),goog.require("P.Module"),goog.require("P.Experiences"),P.modules.PinCreateSuccessExtensionNag=P.Module.extend({events:{"click .getNewPinItButton":"onGetNewPinItButtonClick"},onGetNewPinItButtonClick:function(){this._completeExperience()},onContentReady:function(){this._viewExperience()},_viewExperience:function(){P.trackGAEvent("web_pin_success_extension_upsell","viewed");var a=P.ExperienceManager.instance();a.viewPlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)},_completeExperience:function(){P.trackGAEvent("web_pin_success_extension_upsell","completed");var a=P.ExperienceManager.instance();a.completePlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)}}),goog.provide("P.modules.PinCreateSuccessToast"),goog.require("P.Module");var PIN_CREATE_SUCCESS_TOAST=3e3;P.modules.PinCreateSuccessToast=P.Module.extend({onContentReady:function(){this.closeOnDelay(PIN_CREATE_SUCCESS_TOAST)},closeOnDelay:function(a){P.setTimeout(function(){this.destroy()}.bind(this),a)}}),goog.provide("P.modules.PinDeleteCommentButton"),goog.require("P.Module"),goog.require("P.modules.InlineHoverButton"),P.modules.PinDeleteCommentButton=P.modules.InlineHoverButton.extend({events:{click:"onClick"},showConfirmation:function(){var a={name:"ConfirmDialog",options:{template:"delete_comment"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.onDeleteConfirm)}.bind(this))},onDeleteConfirm:function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_CLICK_SUBMIT);var a={pin_id:this.options.pin_id,comment_id:this.options.comment_id},b=P.resourceFactory.create("PinCommentResource",a);b.callDelete().then(function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_SUCCESS),this.triggerEvent("commentDeleteSuccess",this,!0),P.pubsub.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED)}.bind(this),function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_ERROR)})},onClick:function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()}}),goog.provide("P.modules.PinDescriptionComment"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.PinDescriptionComment=P.Module.extend({events:{"focus .content":"onFocusCommentInput","click .addComment":"addComment"},getPinCommentInputValue:function(){return this.getChildById("pinCommentField").getValue()},getAddCommentButton:function(){return this.getChildById("addCommentButton")},addComment:function(){P.trackGAEvent("comment_create",P.CONST.GA_ACTION_CLICK_SUBMIT);var a=this.getPinCommentInputValue(),b=this.options.pin_id,c=P.resourceFactory.create("PinCommentResource",{pin_id:b,text:a}),d=this.getAddCommentButton();d.showLoading(),this.getChildById("pinCommentField").setValue(""),P.resourceCache.instance.callCreate(c).then(function(){P.trackGAEvent("comment_create",P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED)}).fin(function(){d.hideLoading()})},onFocusCommentInput:function(){var a=this.$el.find(".addComment");this.options.type&&"closeup"===this.options.type?a.css("display","block"):a.show(),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)}}),goog.provide("P.modules.PinDragAndDrop"),goog.require("P.Module"),goog.require("P.Spinner"),P.modules.PinDragAndDrop=P.Module.extend({events:{dragdrop:"onOverlayDrop",drop:"onOverlayDrop",dragleave:"onOverlayLeave",click:"onOverlayLeave"},onOverlayDrop:function(a){a.preventDefault();var b=a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.files;if(!b||!b.length)return void this.removeOverlay();if(!(new XMLHttpRequest).upload)return void this.removeOverlay();var c=new FormData;c.append("img",b[0]);var d=new XMLHttpRequest;d.open("POST",P.absolutify("/upload-image/")),d.setRequestHeader("Cache-Control","no-cache"),d.setRequestHeader("X-CSRFToken",P.csrf.getCSRFToken()),d.onload=function(){200===d.status?(this._uploadingFilesSpinner.stop(),this.ensurePinCreate(JSON.parse(d.responseText).image_url)):this.removeOverlay()}.bind(this),this._uploadingFilesSpinner=new P.Spinner({size:P.Spinner.Size.MEDIUM}),this._uploadingFilesSpinner.spin(this.$el),this.$(".overlayText").hide(),d.send(c)},onOverlayLeave:function(a){a.preventDefault(),this.removeOverlay()},removeOverlay:function(){this.destroy()},ensurePinCreate:function(a){var b={image_url:a,action:"upload",method:"uploaded",render_existing_pin:!0},c={container_class:"webNewContentNewRepin",mask_type:"webNewContentNewRepin",modal_style:"webNewContentNewRepin",custom_entrance_animation:!0,custom_exit_animation:!0},d={name:"PinCreate3",options:b,id:"pinCreate",resource:{name:"FakePinResource",options:{description:"",image_url:a,link:""}}};return this.showLoading(),P.loadModule(d).then(function(a){return this.hideLoading(),this.showInModal(a,c),this.triggerEvent(P.CONST.EVENT_PIN_CREATE_OPENED,null,!0),this.removeOverlay(),Promise.resolve()}.bind(this))}}),goog.provide("P.modules.PinDupWarning"),goog.require("P.Module"),P.modules.PinDupWarning=P.Module.extend({onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var a=this.data&&this.data.pinned_to_board&&!_.isEmpty(this.data.pinned_to_board);a?this.triggerDupeDetected():this.model&&this.listenToOnce(this.model,"change:pinned_to_board",function(){this.renderExistingData().then(function(){this.triggerDupeDetected()}.bind(this))}.bind(this))},triggerDupeDetected:function(){this.triggerEvent(P.CONST.EVENT_DUPE_DETECTED,null,!0)},isDupe:function(){return this.data&&_.keys(this.data).length}}),goog.provide("P.modules.PinEdit"),goog.require("P.Module"),P.modules.PinEdit=P.Module.extend({_onButtonClick:function(a){var b=a.target;switch(b.id){case"submitButton":P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_SUBMIT);break;case"cancelButton":P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_CANCEL);break;case"deleteButton":P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()}},savePin:function(){var a=this.data.id,b=this.pinForm.getData();b.id=a;var c=P.resourceFactory.create("PinResource",b);this.showLoading(!0),c.callUpdate().then(function(c){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_SUCCESS);var d=c.resource_response.data;if(!this.refreshOnSave&&this.isInModal()){P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_UPDATED,d);var e=b.board_id,f=this.data.board.id;e!==f&&(P.pubsub.publish(e,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.pubsub.publish(f,P.CONST.PUBSUB_TOPIC_PIN_DELETED)),this.destroy()}else{var g="/pin/"+a+"/";this.navigate(g)}}.bind(this),function(){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))},onDeleteConfirm:function(){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_CLICK_SUBMIT),this.deletePin()},deletePin:function(){var a=this.data.id,b={id:a},c=P.resourceFactory.create("PinResource",b);this.showLoading(!0),c.callDelete().then(function(){if(P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(this.data.board.id,P.CONST.PUBSUB_TOPIC_PIN_DELETED),P.pubsub.publish(this.data.pinner.id,P.CONST.PUBSUB_TOPIC_PIN_DELETED),!this.refreshOnSave&&this.isInModal())P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_DELETED),this.destroy();else{var b=this.data.board.url;this.navigate(b)}}.bind(this),function(){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))},onContentReady:function(){if(P.autologin.checkForAutologin()){var a=P._("To edit your Pin, please take a second to confirm it's really you.");return P.autologin.showLoginErrorDialog(this,a),void this.destroy()}this.pinForm=this.getChildById("pinForm"),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onPlaceTypeaheadItemSelected),this.refreshOnSave=!1,this.listen(this.pinForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick)},onPlaceTypeaheadItemSelected:function(a){var b=a.data.item,c=b.get("id");this.$(".pinPlaceId").val(c)},onSubmitValidated:function(a){var b=a.data;b.errors[0]||(this.needConfirm()?this.showPrivacyChangeConfirmation():this.savePin())},needConfirm:function(){var a=this.data.board.privacy,b=this.pinForm.getBoardPicker(),c=b.getSelectedBoardPrivacy();return a===P.CONST.BoardPrivacy.SECRET&&c===P.CONST.BoardPrivacy.PUBLIC},showConfirmation:function(){var a={name:"ConfirmDialog",options:{template:"delete_pin",ga_category:P.CONST.GA_CATEGORY_PIN_DELETE}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.onDeleteConfirm)}.bind(this))},showPrivacyChangeConfirmation:function(){var a={name:"ConfirmDialog",options:{template:"change_pin_privacy"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,function(){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_CONFIRM),this.savePin()})}.bind(this))}}),goog.provide("P.modules.PinFeedbackDialog"),goog.require("P.Form"),goog.require("P.Module"),P.modules.PinFeedbackDialog=P.Module.extend({events:{"change input":"onChange","click .radioOption":"onClickOption"},CssClassName:{SELECTED:"selected"},onContentReady:function(){var a={reason:[P.Validator.Required()]};this.form=new P.Form(this.$("form"),a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.submitButton=this.getChildById("submitButton"),this.submitButton.disable()},onSubmitValidated:function(a){a.errors[0]||this.sendPinFeedback()},onClickOption:function(a){var b=$(a.currentTarget).find("input");b.prop("checked","checked"),b.change()},onChange:function(a){this.submitButton.enable();var b=$(a.target).parent();this._selected&&this._selected.removeClass(this.CssClassName.SELECTED),b.addClass(this.CssClassName.SELECTED),this._selected=b},sendPinFeedback:function(){this.submitButton.showLoading();var a=this.$('[name="reason"]:checked').val(),b={complaint_reason:P.CONST.RecommendationComplaintReason[a],pin_id:this.options.pin_id,feedback_type:this.options.feedback_type};this.options.rec_reason_id&&(b.through_id=this.options.through_id,b.rec_reason_id=this.options.rec_reason_id);var c=P.resourceFactory.create("PinFeedbackResource",b);c.callUpdate().fin(function(){this.destroy(),this.triggerEvent(P.CONST.EVENT_PIN_FEEDBACK_SUBMITTED,this,!0)}.bind(this)).fail(function(a){P.showError(a.message)}).always(function(){this.submitButton.hideLoading()}.bind(this))}}),goog.provide("P.modules.PinFlagCommentButton"),goog.require("P.Module"),goog.require("P.modules.InlineHoverButton"),P.modules.PinFlagCommentButton=P.modules.InlineHoverButton.extend({events:{click:"onClick"},showReasonModal:function(){var a={name:"FlagComment",options:{pin_id:this.options.pin_id,comment_id:this.options.comment_id}};P.loadModule(a).then(function(a){this.showInModal(a)}.bind(this))},onClick:function(){P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_OPEN_MODAL),this.showReasonModal()}}),goog.provide("P.modules.PinItLandingSignup"),goog.require("P.Module"),goog.require("P.modules.InlineSignup"),P.modules.PinItLandingSignup=P.modules.InlineSignup.extend({CssClassName:_.extend(P.modules.InlineSignup.prototype.CssClassName,{HAS_IMAGE:"hasImage"}),onContentReady:function(){this.setupSavePinitLanding(),P.getWindowManager().shrinkWrap(),P.trackRegisterAction("pin_it_landing_view")},setupSavePinitLanding:function(){var a=P.getQueryStringParams(this.options.next),b=a.media,c=this.$(".savePinImg").get(0);c&&(c.src=b,this.$(".savePinText").addClass(this.CssClassName.HAS_IMAGE))}}),goog.provide("P.modules.PinLikeButton"),goog.require("P.Module"),goog.require("P.modules.LikeButton"),P.modules.PinLikeButton=P.modules.LikeButton.extend({getLikeResource:function(){var a="PinLikeResource2";return P.resourceFactory.create(a,{pin_id:this.options.pin_id,source_interest_id:this.options.source_interest_id})},_getGACategory:function(a){return a?"pin_like":"pin_unlike"},onClick:function(){var a=!this.options.liked;P.modules.LikeButton.prototype.onClick.call(this);var b=this._getGACategory(a);P.trackGAEvent(b,P.CONST.GA_ACTION_CLICK)},onToggleSuccess:function(a){var b=this._getGACategory(a),c=a?P.CONST.PUBSUB_TOPIC_PIN_LIKED:P.CONST.PUBSUB_TOPIC_PIN_UNLIKED;P.trackGAEvent(b,P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(this.options.pin_id,c)}}),goog.provide("P.modules.PinPicksDetail"),goog.require("P.Module"),P.modules.PinPicksDetail=P.Module.extend({events:{},onContentReady:function(){P.trackRegisterAction("pin_picks_visit")}}),goog.provide("P.modules.PinPreview"),goog.require("P.Module"),P.modules.PinPreview=P.Module.extend({setImage:function(a){this.options.image_url=a,this.showLoading(!0);var b=function(){this.hideLoading()}.bind(this),c=this.$("img").get(0);c&&(c.onerror=c.onload=b,c.src=a)}}),goog.provide("P.modules.PinfluencerOptOutConfirmationPage"),goog.require("P.Module"),P.modules.PinfluencerOptOutConfirmationPage=P.Module.extend({}),goog.provide("P.modules.PintreeEst"),goog.require("P.Module"),P.modules.PintreeEst=P.Module.extend({}),goog.provide("P.modules.PinvitationalInviteHomefeedModal"),goog.require("P.Module");var FADE_IN_DELAY=600,FADE_LENGTH=500,INVITER_WAIT=4e3;P.modules.PinvitationalInviteHomefeedModal=P.Module.extend({events:{"click .remindMessage":"dismissModal"},CssClassName:{IS_LOGO_SHIFTED:"shiftedLogo"},onContentReady:function(){P.trackRegisterAction("pinv_web_modal_pin_preview"),this.options.placedExperienceId&&P.ExperienceManager.instance().viewPlacedExperienceId(this.options.placedExperienceId),this.listen(this.getChildById("unlockInviteButton"),P.CONST.EVENT_BUTTON_CLICK,this.unlockInvitesTransition)},unlockInvitesTransition:function(){P.ExperienceManager.instance().completePlacedExperienceId(this.options.placedExperienceId),this.$(".greatTaste").fadeOut(FADE_LENGTH),this.$(".inviteUnlocked").delay(FADE_IN_DELAY).fadeIn(FADE_LENGTH),this.$(".dismissButton").delay(2*FADE_LENGTH).fadeIn(FADE_LENGTH),P.trackRegisterAction("pinv_web_modal_invites_unlocked"),P.setTimeout(function(){this.$(".logo").toggleClass(this.CssClassName.IS_LOGO_SHIFTED)}.bind(this),FADE_LENGTH),P.setTimeout(function(){this.$(".mainContent").fadeOut(FADE_LENGTH),P.trackRegisterAction("pinv_web_inviter_shown_from_modal"),this.$(".inviter").delay(FADE_IN_DELAY).fadeIn(FADE_LENGTH)}.bind(this),INVITER_WAIT)},dismissModal:function(){P.trackRegisterAction("pinv_web_modal_dismiss"),P.ExperienceManager.instance().dismissPlacedExperienceId(this.options.placedExperienceId),P.getModalManager().removeModal(this.parent)}}),goog.provide("P.modules.PinvitationalInviteListEmail"),goog.require("P.Module"),goog.require("P.modules.InviteListEmail"),P.modules.PinvitationalInviteListEmail=P.modules.InviteListEmail.extend({onContentReady:function(){P.modules.InviteListEmail.prototype.onContentReady.apply(this,arguments),this.maxInvites=this.options.invite_cap,this.disabledAllContacts=!1,0===this.maxInvites&&this._toggleDisableContacts(!0)},_onChange:function(){for(var a=0,b=0;b<this.inviteList.children.length;b++){var c=this.inviteList.children[b];this.checkedContacts[c.getEmail()]=c.isChecked(),a+=c.isChecked()?1:0}var d=0;for(var e in this.checkedContacts)this.checkedContacts[e]&&d++;this._toggleDisableContacts(d>=this.maxInvites),this.sendButton.setEnabled(d>0)},_toggleDisableContacts:function(a){_.each(this.inviteList.children,function(b){this.checkedContacts[b.getEmail()]||b.setDisabled(a)}.bind(this)),this.disabledAllContacts=a},onTypeaheadData:function(){this.checkedContacts={},P.modules.InviteListEmail.prototype.onTypeaheadData.apply(this,arguments)},_filterResults:function(){this.checkedContacts={},P.modules.InviteListEmail.prototype._filterResults.apply(this,arguments)},_fetchMore:function(){this.inviteList.options.item_options.disabledAllUnchecked=this.disabledAllContacts,this.resource.atEnd()&&this.removeListener(this._scrollListener),this.rendering=!0,this.getChildById("inviteList").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1}.bind(this))},_triggerInviteEventWithData:function(a,b){a.callCreate().then(function(){this.sendButton.hideLoading(),this.triggerEvent(P.CONST.EVENT_INVITE_USER,{recipients:b},!0)}.bind(this))}}),goog.provide("P.modules.PinvitationalInviter"),goog.require("P.Module");var FADEIN_DELAY=600,FADE_TIME=500,CONFIRM_WAIT=5e3;P.modules.PinvitationalInviter=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this._showConfirmation)},_showConfirmation:function(a){var b=a.data.recipients,c=this._calculateInvitesLeft(b.length);P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_PINVITATIONAL,P.CONST.PUBSUB_TOPIC_PINVITATIONAL_INVITE,{numInvitesLeft:c});for(var d="",e=0;e<b.length;e++)d+='<div class="singleEmail">'+b[e]+"</div>";this.$(".invitedEmails").html(d),this.$(".inviter").fadeOut(FADE_TIME),this.$(".confirmation").delay(FADEIN_DELAY).fadeIn(FADE_TIME),P.trackRegisterAction("pinv_web_inviter_confirm_from_"+this.options.source),P.setTimeout(function(){this.parent.dismissModal()}.bind(this),CONFIRM_WAIT)},_calculateInvitesLeft:function(a){var b=0;if(this.extraData&&this.extraData.numInvites){var c=this.extraData.numInvites;b=c-a}return b}}),goog.provide("P.modules.PinvitationalInviterWrapper"),goog.require("P.Module"),P.modules.PinvitationalInviterWrapper=P.Module.extend({dismissModal:function(){P.getModalManager().removeModal(this.parent)}}),goog.provide("P.modules.PinvitationalRedemptionFlow"),goog.require("P.Module"),goog.require("P.modules.InlineSignup");var STEP_DELAY=500;P.modules.PinvitationalRedemptionFlow=P.modules.InlineSignup.extend({events:{"focus .email":"onFieldFocus","focus .password":"onFieldFocus","focus .name":"onFieldFocus","focus .age":"onFieldFocus","input .email":"onFieldFocus","input .password":"onFieldFocus","input .name":"onFieldFocus","input .age":"onFieldFocus"},onContentReady:function(){P.modules.InlineSignup.prototype.onContentReady.call(this),P.trackRegisterAction("pinv_redemption_landing"),P.CONTEXT.is_mobile_agent?this.listen(this.getChildById("welcomeButton"),P.CONST.EVENT_BUTTON_CLICK,this.goToSignup):this.setMultiStepHeader(".mainTitle",{step1:P._("We're so glad you're here"),step2:P._("Looking good!")});var a=this.options.redeem_email;null!==a&&""!==a&&$("#userEmail").val(a)},goToSignup:function(){this.$(".welcomeStep").fadeOut(STEP_DELAY),this.$(".signupStep").delay(STEP_DELAY).fadeIn(STEP_DELAY)},onFieldFocus:function(){this.$(".errorTooltip").hide()}}),goog.provide("P.modules.PinvitationalRequestButtons"),goog.require("P.Module"),P.modules.PinvitationalRequestButtons=P.Module.extend({}),goog.provide("P.modules.PinvitationalRequestFlow"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.InlineSignup");var WALL_FADE_DELAY=1e3;P.modules.PinvitationalRequestFlow=P.modules.InlineSignup.extend({events:{"focus .email":"onEmailFocus","input .email":"onEmailFocus"},onContentReady:function(){this.setupSteps(),this.setupFormSubmit(),this.checkForLandingErrors()},setupSteps:function(){this.requestedEmailText=this.$("#requestedEmail"),this.requestStep=this.$(".requestStep"),this.confirmStep=this.$(".confirmStep"),this.getChildById("submitEmailButton")&&this.listen(this.getChildById("submitEmailButton"),P.CONST.EVENT_BUTTON_CLICK,this.submitEmail)},setupFormSubmit:function(){var a={email:[P.Validator.Required({message:P._("<b>You missed a spot!</b> Don't forget to add your email.")}),P.Validator.Email({message:P._("<b>Hmm...</b>that doesn't look like an email address.")})]};this.form=new P.Form(this.$("form"),a),this.emailInput=this.$("input[name='email']"),this.enteredEmail=""},checkForLandingErrors:function(){if(this.extraData&&this.extraData.error_type){var a="",b="";"invalid_code"===this.extraData.error_type?(a=P._("You need an invite to sign up."),b=P._("Okay")):"redeemed_code"===this.extraData.error_type&&(a=P._("Someone already used that invite, but you can request your own."),b=P._("Got it")),this.showInviteErrorDialog(a,b)}},showInviteErrorDialog:function(a,b){var c={name:"ConfirmDialog",options:{button_text:b,body_message:a,title:P._("Oops!"),template:"generic"}};P.loadModule(c).then(function(a){this.showInModal(a)}.bind(this))},showEmailErrorTooltip:function(a){var b="";b=a?a:P._("Something went wrong on our end. Sorry about that."),this.$(".errorTooltip").html(b).fadeIn()},onEmailFocus:function(){this.$(".errorTooltip").hide()},submitEmail:function(){this.form.validateField(this.emailInput,function(a){if(0!==a.errors.length)this.showEmailErrorTooltip(a.errors[0]);else{var b=P.resourceFactory.create("PinvitationalJoinRequestResource",{email:this.emailInput[0].value});b.callCreate({showError:!1}).then(function(a){var b=a.resource_response.data;if(b&&b.invitation_already_sent!==!0)this.animateConfirmation();else{var c="/invited/",d="?invite_code="+b.invite_code;P.changeWindowLocation(c+d,!1)}}.bind(this),function(a){var b="";b=P._(409===a.http_status?"Sorry! That email's taken.":"Sorry! Something went wrong on our end."),this.showEmailErrorTooltip(b)}.bind(this))}}.bind(this))},animateConfirmation:function(){this.requestStep.fadeOut(WALL_FADE_DELAY/2),this.enteredEmail=this.emailInput[0].value,this.requestedEmailText.text(this.enteredEmail),this.confirmStep.delay(WALL_FADE_DELAY/2).fadeIn(WALL_FADE_DELAY/2)}}),goog.provide("P.modules.PinvitationalRequestModal"),goog.require("P.Module"),goog.require("P.modules.InlineSignup"),P.modules.PinvitationalRequestModal=P.modules.InlineSignup.extend({}),goog.provide("P.modules.PinvitationalWall"),goog.require("P.Module"),P.modules.PinvitationalWall=P.Module.extend({}),goog.provide("P.modules.PlacesBoardExamples"),goog.require("P.Module"),P.modules.PlacesBoardExamples=P.Module.extend({}),goog.provide("P.modules.PlainSignupModal"),goog.require("P.Module"),goog.require("P.modules.InlineSignup"),P.modules.PlainSignupModal=P.modules.InlineSignup.extend({events:{"click .closeModal":"closeModal"},CssClassName:_.extend(P.modules.InlineSignup.prototype.CssClassName,{SECOND_STEP:"secondStep"}),onContentReady:function(){P.trackRegisterAction("plain_signup_modal_view"),P.modules.InlineSignup.prototype.onContentReady.call(this)},closeModal:function(){this.triggerEvent(P.CONST.EVENT_CLOSE_SIGNUP_OVERLAY,null,!0)}}),goog.provide("P.modules.PositionModule"),goog.require("P.Module"),goog.require("P.viewport");var CLASS_CARET="positionModuleCaret",MIN_CARET_OFFSET=5,POINT=P.CONST.PositionPoint,POINT_FLAG=P.CONST.PositionPointFlag,MAP_FLAG_TO_CLASS={};MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_HORIZONTAL_LEFT]="positionLeft",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_HORIZONTAL_RIGHT]="positionRight",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_VERTICAL_TOP]="positionTop",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_VERTICAL_BOTTOM]="positionBottom",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_VERTICAL_CENTER]="positionCenter",P.modules.PositionModule=P.Module.extend({CssClassName:{ABSOLUTE_CENTER:"absoluteCenter",BIG_CARET:"bigCaret",DEFAULT_CARET:"defaultCaret",POSITION_FIXED:"positionFixed",POSITION_MODULE:"PositionModule",POSITION_MODULE_ELEMENT:"positionModuleElement",POSITION_MODULE_FIXED:"positionModuleFixed"},positionMode:P.CONST.PositionMode.ANCHORED,onCreated:function(){this._allowPositioning=!0;var a=this.positionModule.bind(this);this.childListen(P.CONST.EVENT_CONTENT_CHANGED,a),this.listen(this,P.CONST.EVENT_DIMS_CHANGED,a),this.listen(this,P.CONST.EVENT_NAVIGATE,a),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,a),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,a)},getPositionMode:function(){return P.CONST.PositionMode[this.options.position_mode]||this.positionMode},onOptionsChanged:function(){this.updateFixed()},getPositionElement:function(){return this.$el},getPositionAnchor:function(){return $(this.options.anchor)},getPositionPoint:function(){return POINT[this.options.position_point]||POINT.BOTTOM_LEFT},getPositionFixed:function(){return!!this.options.fixed},getPositionCaret:function(){return this.getCaret()},getCaret:function(){return this.$("."+CLASS_CARET)},_getPositionType:function(){return this.getPositionFixed?"fixed":"absolute"},positionModuleAtAnchor:function(a,b){P.deferDomManipulation(function(){var c=this.getPositionElement();c.addClass(this.CssClassName.POSITION_MODULE_ELEMENT),c.toggleClass(this.CssClassName.POSITION_FIXED,this.getPositionFixed()),_.each(MAP_FLAG_TO_CLASS,function(a){c.removeClass(a)}),b=P.Positioning.positionElementAtAnchor(c,a,b,this.getPositionFixed(),this.options.force_in_viewport),_.each(MAP_FLAG_TO_CLASS,function(a,d){b&d&&c.addClass(MAP_FLAG_TO_CLASS[d])})}.bind(this)),this.positionCaret(a,b)},positionCaret:function(a,b){P.deferDomManipulation(function(){var c=this.$("."+CLASS_CARET);if(c.length){var d=P.CONST.PositionPointFlag,e=this.getPositionElement();if(e.addClass(this.options.largeCaret?this.CssClassName.BIG_CARET:this.CssClassName.DEFAULT_CARET),this.options.caret_style?c.addClass(this.options.caret_style+"CaretStyle"):c.attr("class",CLASS_CARET),this.options.right_position_caret)return void c.css("right","7px");var f="left",g="outerWidth",h="width";b&d.FLAG_HORIZONTAL&&(f="top",g="outerHeight",h="height");var i=0,j=b&(d.FLAG_HORIZONTAL_CENTER|d.FLAG_VERTICAL_CENTER),k=c[h]()>a[h]()-MIN_CARET_OFFSET;k&&!j&&(i=(c[h]()-a[h]())/2+MIN_CARET_OFFSET,(b&d.FLAG_VERTICAL_RIGHT||b&d.FLAG_HORIZONTAL_BOTTOM)&&(i=-i));var l=e.offset()[f],m=l+e[g](),n=a.offset()[f],o=n+a[g](),p=l;p<n&&(p=n);var q=m;q>o&&(q=o);var r=(p+q)/2-c[g]()/2+i,s={};if(s[f]=r,c.offset(s),i){var t=parseInt(e.css(f),10);e.css(f,t-i)}}}.bind(this))},_setAllowPositioning:function(a){this._allowPositioning&&a&&this._positionModule(),this._allowPositioning=a},positionModule:function(){this._allowPositioning&&this._positionModule()},_positionModule:function(){this.cleanPositionModuleElement();var a=!1;this.getPositionMode()===P.CONST.PositionMode.MANUAL?this._positionManually():this.getPositionMode()===P.CONST.PositionMode.ANCHORED?this.positionModuleAtAnchor(this.getPositionAnchor(),this.getPositionPoint()):a=!0,this._positionAbsoluteCenter(a)},_positionAbsoluteCenter:function(a){this.$el.toggleClass(this.CssClassName.ABSOLUTE_CENTER,a)},_positionManually:function(){P.deferDomManipulation(function(){var a=this.getPositionElement();a.addClass(this.CssClassName.POSITION_MODULE_ELEMENT),a.toggleClass(this.CssClassName.POSITION_FIXED,this.getPositionFixed())}.bind(this))},cleanPositionModuleElement:function(){P.deferDomManipulation(function(){var a=this.getPositionElement();a.removeClass(this.CssClassName.POSITION_MODULE_ELEMENT),a.css({top:"",left:"",margin:""})}.bind(this))},updateFixed:function(){P.deferDomManipulation(function(){this.$el.toggleClass(this.CssClassName.POSITION_MODULE_FIXED,this.getPositionFixed())}.bind(this))},renderContainer:function(){this.empty();var a=this.$el;if(a.addClass(this.CssClassName.POSITION_MODULE),a.addClass(this.options.class_name),this.updateFixed(),this.options.view_type&&a.addClass(this.options.view_type),!this.options.hide_caret){var b=$('<span class="'+CLASS_CARET+'"></span>');a.prepend(b)}}}),goog.provide("P.modules.Progress"),goog.require("P.Module"),P.modules.Progress=P.Module.extend({events:{"click li":"onStepClick"},CssClassName:{IS_ACTIVE:"active"},moveStep:function(a){this.setStep(this.options.current_step+a)},setStep:function(a){a<0||a>this.options.steps||(this.options.current_step=a,this._localRender(),a===this.options.steps&&this.triggerEvent(P.CONST.EVENT_PROGRESS_COMPLETED,null,!0))},setMiniStepProgress:function(a,b){var c=this.getChildrenByModuleName("ProgressMinistep"),d=0;_.each(c,function(c){c.options.ministep_type===a&&(d<b?(c.setActive(),d++):c.setInactive())})},updateStepWidths:function(){var a=this.$el.width(),b=this.$el.find("li").length;if(b>1){var c=Math.floor(a/b);c&&this.$el.find("li").width(c+"px")}},_localRender:function(){var a=this.$el.children("li"),b=parseInt(this.options.current_step,10),c=this.options.highlight_current_only;$.each(a,function(a,d){$(d).toggleClass(this.CssClassName.IS_ACTIVE,c&&b===a+1||!c&&b>=a+1)}.bind(this))},onStepClick:function(a){if(this.options.allow_jump_to_any_step){var b=$(a.target).data("step-id");String(b)!==String(this.options.current_step)&&(this.setStep(b),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_GO_TO_STEP,Number(b)))}}}),goog.provide("P.modules.ProgressMinistep"),goog.require("P.Module"),P.modules.ProgressMinistep=P.Module.extend({CssClassName:{IS_ACTIVE:"active"},setActive:function(){var a=this.$el.children("li");a.hasClass(this.CssClassName.IS_ACTIVE)||a.addClass(this.CssClassName.IS_ACTIVE)},setInactive:function(){var a=this.$el.children("li");a.hasClass(this.CssClassName.IS_ACTIVE)&&a.removeClass(this.CssClassName.IS_ACTIVE)}}),goog.provide("P.modules.PromotedPinInfo"),goog.require("P.Module"),P.modules.PromotedPinInfo=P.Module.extend({HIDE_DELAY:100,events:{"click .hidePin":"hidePin"},CssClassName:{HIDDEN:"hidden"},hidePin:function(){var a=this.options.pin_id;this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN)}.bind(this),this.HIDE_DELAY)}}),goog.provide("P.modules.Pulser"),goog.require("P.Module");var PULSER_ANIMATION_STEPS=[{transition:{scale:.5,opacity:1}},{transition:{scale:.6,opacity:1},time:200,timingFunction:"cubic-bezier(0, 0.55, 0.55, 1.0)"},{transition:{scale:.4},time:200,timingFunction:"cubic-bezier(0, 0.55, 0.55, 1.0)"},{transition:{scale:.8,opacity:0},time:1400,timingFunction:"cubic-bezier(0, 0.5, 0, 1)"}];P.modules.Pulser=P.Module.extend({events:{click:"_onClick"},CssClassName:{FIXED:"fixed"},onContentReady:function(){this._positionPulser(),this.$(".pulserImage").css(PULSER_ANIMATION_STEPS[0].transition),this.options.fixed&&this.$el.addClass(this.CssClassName.FIXED),this.$el.css("visibility","visible"),this._playAnimation(),window.setInterval(this._playAnimation.bind(this),2e3),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this._positionPulser),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this._positionPulser)},_positionPulser:function(){var a=this.options.anchor;a&&P.Positioning.positionElementAtAnchor(this.$el,$(a),P.CONST.PositionPoint.CENTER_CENTER,!!this.options.fixed,!1)},_onClick:function(){this.triggerEvent(P.CONST.EVENT_PULSER_CLICKED,null,!0)},_playAnimation:function(){var a=this.$(".pulserImage");a.css(PULSER_ANIMATION_STEPS[0].transition),PULSER_ANIMATION_STEPS.slice(1).forEach(function(b){a=a.transition(b.transition,b.time,b.timingFunction).delay()})}}),goog.provide("P.modules.PushNotificationSettings"),goog.require("P.Form"),goog.require("P.Module"),P.modules.PushNotificationSettings=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var a=new P.Form(this.$form,{});this.listen(a,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(){var a={},b={};this.$(".pushNotifSettings input[type=checkbox]").each(function(){var a=$(this),c=a.attr("name");b[c.substr(5)]=a.is(":checked")?"anyone":"none"}),a.push_settings=JSON.stringify(b);var c=P.resourceFactory.create("NotificationSettingsResource",a);this.showLoading(!0),c.callUpdate().then(function(){this.isInModal()&&this.destroy()}.bind(this)).fin(function(){this.hideLoading()}.bind(this))}}),goog.provide("P.modules.QuickPicksSpinnerBlock"),goog.require("P.Module"),P.modules.QuickPicksSpinnerBlock=P.Module.extend({}),goog.provide("P.modules.RadioButton"),goog.require("P.Module"),P.modules.RadioButton=P.Module.extend({CssClassName:{FANCY_SELECTED:"fancySelected"},onContentReady:function(){this.$input=this.$("input"),this.input=this.$input[0],this.listen(this.$input,"change",this._onChange),this.listen(this.$input,"click",this._onClick)
},_onClick:function(a){this._logContextEvent(a),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,a,!0)},_onChange:function(a){this.triggerEvent(P.CONST.EVENT_CHANGE,a,!0),this.refreshLayout()},refreshLayout:function(){this.options.fancy&&this.$el.toggleClass(this.CssClassName.FANCY_SELECTED,this.input.checked)}}),goog.provide("P.modules.RadioGroup"),goog.require("P.Module"),P.modules.RadioGroup=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onChildChanged),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildClicked)},onChildClicked:function(a){a.stopPropagation(),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,a,!0)},onChildChanged:function(a){a.stopPropagation();var b=this.getChildrenByModuleName("RadioButton");_.each(b,function(a){a.refreshLayout()}),this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0)},getCurrentLabel:function(){var a=this.getCheckedRadioButton();return a?a.parents("label").find(".labelContent").text():null},getCheckedRadioButton:function(){return this.$("input:checked")},val:function(){var a=this.getCheckedRadioButton();return a?a.attr("value"):void 0}}),goog.provide("P.modules.RecipeFeedPage"),goog.require("P.Module"),P.modules.RecipeFeedPage=P.Module.extend({}),goog.provide("P.modules.RelatedBoards"),goog.require("P.Module"),P.modules.RelatedBoards=P.Module.extend({events:{"click .relatedBoard":"_onBoardClicked"},_onBoardClicked:function(a){this._clickedBoardId=$(a.currentTarget).data("boardId")},getLoggingObjectIdStr:function(){return this._clickedBoardId}}),goog.provide("P.modules.RelatedEditorials"),goog.require("P.Module"),P.modules.RelatedEditorials=P.Module.extend({onContentReady:function(){this.destroyIfEmpty()}}),goog.provide("P.modules.RelatedInterestsSection"),goog.require("P.Module"),P.modules.RelatedInterestsSection=P.Module.extend({}),goog.provide("P.modules.RelatedItemsSlideshow"),goog.require("P.Module"),P.modules.RelatedItemsSlideshow=P.Module.extend({CssClassName:{STATIC:"static"},stopAnimation:function(){this.$(".pinInfo").fadeOut(),this.$el.addClass(this.CssClassName.STATIC)},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_SIGNUP_CONTINUE_CLICKED]=this.stopAnimation,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a)}}),goog.provide("P.modules.RelatedPinInfo"),goog.require("P.Module"),P.modules.RelatedPinInfo=P.Module.extend({HIDE_DELAY:100,events:{"click .hidePin":"hidePin","click .stopShowing":"stopShowing"},CssClassName:{HIDDEN:"hidden"},hidePin:function(){var a=this.options.pin_id;this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN)}.bind(this),this.HIDE_DELAY)},stopShowing:function(a){var b=this.options.pin_id,c=$(a.target).closest(".stopShowing");this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),"board"===c.attr("data-object-type")?P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_BOARD):"pin"===c.attr("data-object-type")?P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_PIN):"interest"===c.attr("data-object-type")&&P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_INTEREST)}.bind(this),this.HIDE_DELAY)}}),goog.provide("P.modules.RelatedRecipe"),goog.require("P.Module"),P.modules.RelatedRecipe=P.Module.extend({}),goog.provide("P.modules.RemovePinDialog"),goog.require("P.Module"),P.modules.RemovePinDialog=P.Module.extend({events:{"click .openPinFeedback":"openPinFeedback"},CssClassName:{SUBMITTED:"submitted"},openPinFeedback:function(){var a={pin_id:this.options.pin_id,feedback_type:this.options.feedback_type},b=this.options.recommendation_reason,c=this.options.through_id;b&&c&&(a.through_id=c,a.recommendation_reason=b);var d={name:"PinFeedbackDialog",options:a};return P.loadModule(d).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_PIN_FEEDBACK_SUBMITTED,this.onFeedbackSubmitted)}.bind(this))},onFeedbackSubmitted:function(){this.getContent().addClass(this.CssClassName.SUBMITTED)}}),goog.provide("P.modules.RemoveUserFromBoardDialog"),goog.require("P.Module"),goog.require("P.modules.ConfirmDialog"),P.modules.RemoveUserFromBoardDialog=P.modules.ConfirmDialog.extend({events:{"click [name=ban]":"onBanClick"},onContentReady:function(){this.returnData=["ban"],P.modules.ConfirmDialog.prototype.onContentReady.call(this)},onBanClick:function(a){var b=$(a.target),c=P._(b.is(":checked")?"Block Pinner":"Remove Pinner");this.setPrimaryButtonText(c)}}),goog.provide("P.modules.RepinsLikesFeedPage"),goog.require("P.Module"),P.modules.RepinsLikesFeedPage=P.Module.extend({}),goog.provide("P.modules.ReportBug"),goog.require("P.Form"),goog.require("P.Module");var INPUT_METADATA_SELECTOR='[name="metadata"]';P.modules.ReportBug=P.Module.extend({getMetadata:function(){return this.$(INPUT_METADATA_SELECTOR).val()},onContentReady:function(){var a=this.getChildById("uploader");this.listen(a,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(a,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError),this.imageUrl=null;var b={title:[P.Validator.Required()],description:[P.Validator.Required()]};this.setMetadata(),this.form=new P.Form(this.$("form"),b),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(){this.reportBug()},setMetadata:function(){var a=window.navigator.userAgent,b=P.getCurrentUrl(),c=P.experiments.instance.getDebugInfo();this.$(INPUT_METADATA_SELECTOR).val("\n\n\n\n----------------------------------\nuserAgent: "+a+"\ncurrentURL: "+b+"\nexperiments: "+c+"\nusername: "+P.currentUser.get("username")+"\n\n")},reportBug:function(){var a=this.$("form").serializeArray(),b=this.getChildById("submitButton"),c={};_.each(a,function(a){c[a.name]=a.value}),c.description=c.description+this.getMetadata(),this.imageUrl&&(c.image_url=this.imageUrl),b.showLoading();var d=P.resourceFactory.create("ReportErrorResource",c);d.callCreate().then(function(a){var b=a.resource_response.data,c={name:"ConfirmDialog",options:{template:"report_bug",task_url:b,class_name:"reportBug"}};P.loadModule(c).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.destroy)}.bind(this))}.bind(this)).fin(function(){b.hideLoading()})},onUploadSuccess:function(a){this.imageUrl=a.data.image_url},onUploadError:function(){P.showError(P.string.common.defaultErrorMessage)}}),goog.provide("P.modules.ReportedContent"),goog.require("P.Module"),P.modules.ReportedContent=P.Module.extend({onContentReady:function(){this.$(".toggler").click(function(){$(this).next().children(":first").toggle("blind",function(){var a=$(this).parent().prev();a.text(P._(a.text()===P._("Less")?"More info ...":"Less"))})})}}),goog.provide("P.modules.ResetPasswordPage"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.router");var resetPasswordButtonId="resetPasswordSubmit";P.modules.ResetPasswordPage=P.Module.extend({onContentReady:function(){if(this.data.is_link_valid){var a={new_password:[P.Validator.Required(),P.Validator.ContainsOnlyAscii({message:P.string.common.asciiPasswordError}),P.Validator.Password()],new_password_confirm:[P.Validator.Required(),P.Validator.EqualTo({targetFieldName:"new_password",message:P._("Passwords don't match")})]};this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)}},onSubmitValidated:function(a){var b=this.getChildById(resetPasswordButtonId);a.errors[0]||(b.showLoading(!0),this.resetPassword())},resetPassword:function(){this.hideLoading(!0);var a={new_password:this.form.getValue("new_password"),new_password_confirm:this.form.getValue("new_password_confirm")},b=$.extend(_.clone(this.options),a),c=P.resourceFactory.create("ResetPasswordFromEmailResource",b);c.callUpdate().then(function(a){var b=a.resource_response.data;if(b.password_changed){var c={name:"ConfirmDialog",options:{template:"change_password_success"}},d=function(){P.changeWindowLocation("/login/",!1)};P.loadModule(c).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,d)}.bind(this))}}.bind(this)).fin(function(){var a=this.getChildById(resetPasswordButtonId);a.hideLoading()}.bind(this))}}),goog.provide("P.modules.RichPinDebugger"),goog.require("P.Form"),goog.require("P.Module"),P.modules.RichPinDebugger=P.Module.extend({events:{"click .menu .main":"onShowMain","click .menu .parsed":"onShowParsed","click .menu .html":"onShowScrapedHtml","click .menu .oembed":"onShowScrapedOembed"},CssClassName:{HIDDEN:"hidden",SELECTED:"selected"},onContentReady:function(){this.$form=this.$("form"),this.$main=this.$(".section.main"),this.$menus=this.$(".menu a"),this.$scrapedHtml=this.$(".section.html"),this.$scrapedOembed=this.$(".section.oembed"),this.$sections=this.$(".section"),this.$parsed=this.$(".section.parsed"),this.form=new P.Form(this.$form,[]),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.retrieve)},retrieve:function(){var a=this.$form.serializeArray(),b=a[0].value;this.navigate("?link="+b)},onShowMain:function(a){return this.hideAllMenus(),this.$main.removeClass(this.CssClassName.HIDDEN),$(a.target).addClass(this.CssClassName.SELECTED),!1},onShowParsed:function(a){return this.hideAllMenus(),this.$parsed.removeClass(this.CssClassName.HIDDEN),$(a.target).addClass(this.CssClassName.SELECTED),!1},onShowScrapedHtml:function(a){return this.hideAllMenus(),this.$scrapedHtml.removeClass(this.CssClassName.HIDDEN),$(a.target).addClass(this.CssClassName.SELECTED),!1},onShowScrapedOembed:function(a){return this.hideAllMenus(),this.$scrapedOembed.removeClass(this.CssClassName.HIDDEN),$(a.target).addClass(this.CssClassName.SELECTED),!1},hideAllMenus:function(){this.$sections.addClass(this.CssClassName.HIDDEN),this.$menus.removeClass(this.CssClassName.SELECTED)}}),goog.provide("P.modules.RichPinDebuggerItem"),goog.require("P.Module"),P.modules.RichPinDebuggerItem=P.Module.extend({}),goog.provide("P.modules.RichPinHeading"),goog.require("P.Module"),P.modules.RichPinHeading=P.Module.extend({}),goog.provide("P.modules.RightHeader"),goog.require("P.Module"),P.modules.RightHeader=P.Module.extend({}),goog.provide("P.modules.SXSEvaluation"),goog.require("P.Module"),P.modules.SXSEvaluation=P.Module.extend({events:{"change #subjects":"subjectChange"},onContentReady:function(){this._listener||(this._listener=this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this._pickTreatment=this.getChildById("pickTreatment"),this._pickControl=this.getChildById("pickControl"),this._pickNone=this.getChildById("pickNone"),this._lockSxSButton=this.getChildById("lockSxS"),this.setIframes(),this._isLockedSxS=!0,this.sizeIframe(),$(window).resize(function(){this.sizeIframe()}.bind(this))},onButtonClick:function(a){var b=a.target;b===this._pickTreatment?this.setScore(1):b===this._pickControl?this.setScore(-1):b===this._pickNone?this.setScore(0):b===this._lockSxSButton&&this.toggleLockSxS()},setIframes:function(){var a=this.$("#sxs_control"),b=this.$("#sxs_treatment");a.prop("src",this.$("#control_url").val()),b.prop("src",this.$("#treatment_url").val()),a.on("load",function(){this.lockSxS()}.bind(this)),b.on("load",function(){this.lockSxS()}.bind(this))},setScore:function(a){var b={};b.score=a,b.token=this.$("#token").val(),b.selected_subject_id=this.$("#selected_subject_id").val();var c=P.resourceFactory.create("SXSEvaluationResource",b);c.callUpdate().then(function(){this.render()}.bind(this))},subjectChange:function(){var a=this.$("#subjects").val(),b=this.$("#token").val();this.navigate("?token="+b+"&subject_id="+a)},lockSxS:function(){this.$("#sxs_control").contents().on("scroll",function(){var a=this.$("#sxs_control"),b=this.$("#sxs_treatment");b.contents().scrollTop(a.contents().scrollTop()),b.contents().scrollLeft(a.contents().scrollLeft())}.bind(this)),this.$("#sxs_treatment").contents().on("scroll",function(){var a=this.$("#sxs_control"),b=this.$("#sxs_treatment");a.contents().scrollTop(b.contents().scrollTop()),a.contents().scrollLeft(b.contents().scrollLeft())}.bind(this))},unlockSxS:function(){this.$("#sxs_control").contents().unbind("scroll"),this.$("#sxs_treatment").contents().unbind("scroll")},toggleLockSxS:function(){this._isLockedSxS?(this.unlockSxS(),this._lockSxSButton.setText("Lock Scrolling")):(this.lockSxS(),this._lockSxSButton.setText("Unlock Scrolling")),this._isLockedSxS=!this._isLockedSxS},sizeIframe:function(){var a=.85*$(window).height();this.$(".iframeContainer").css("height",a)}}),goog.provide("P.modules.SXSPinIds"),goog.require("P.Module"),P.modules.SXSPinIds=P.Module.extend({events:{"change #subjects":"subjectChange"},onContentReady:function(){this._listener||(this._listener=this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this._lockSxSButton=this.getChildById("lockSxS"),this.setIframes(),this._isLockedSxS=!0},onButtonClick:function(a){var b=a.target;b===this._lockSxSButton&&this.toggleLockSxS()},setIframes:function(){var a=this.$("#sxs_control"),b=this.$("#sxs_treatment");a.prop("src",this.$("#control_url").val()),b.prop("src",this.$("#treatment_url").val()),a.on("load",function(){this.lockSxS()}.bind(this)),b.on("load",function(){this.lockSxS()}.bind(this))},lockSxS:function(){this.$("#sxs_control").contents().on("scroll",function(){var a=this.$("#sxs_control"),b=this.$("#sxs_treatment");b.contents().scrollTop(a.contents().scrollTop()),b.contents().scrollLeft(a.contents().scrollLeft())}.bind(this)),this.$("#sxs_treatment").contents().on("scroll",function(){var a=this.$("#sxs_control"),b=this.$("#sxs_treatment");a.contents().scrollTop(b.contents().scrollTop()),a.contents().scrollLeft(b.contents().scrollLeft())}.bind(this)),this._lockSxSButton.setText("Unlock Scrolling")},unlockSxS:function(){this.$("#sxs_control").contents().unbind("scroll"),this.$("#sxs_treatment").contents().unbind("scroll"),this._lockSxSButton.setText("Lock Scrolling")},toggleLockSxS:function(){this._isLockedSxS?this.unlockSxS():this.lockSxS(),this._isLockedSxS=!this._isLockedSxS}}),goog.provide("P.modules.SearchGuidesBar"),goog.require("P.Module");var GUIDE_WIDTH=125,NUM_GUIDES_SLIDE_WINDOW=3,NUM_GUIDES_PER_COLUMN=2;P.modules.SearchGuidesBar=P.Module.extend({events:{"click .guidesContainer li":"onGuideClick","click .navigator.left em":"onLeftNavigatorClick","click .navigator.right em":"onRightNavigatorClick"},getOwnedScrollables:function(){return this.$(".guidesSlider")},onCreated:function(){this.$guidesSlider=this.$(".guidesSlider"),this.$guidesContainer=this.$(".guidesContainer"),this.currentGuideIndex=0,this.totalGuides=this.options.num_guides,this.state={};var a=this.totalGuides*GUIDE_WIDTH;this.$guidesContainer.css("width",a+"px"),this.$leftNav=this.$(".navigator.left"),this.$rightNav=this.$(".navigator.right"),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.onBodyColumnChange),this.scrollLeft=0,this.onSliderScroll=this.onSliderScroll.bind(this),this.$guidesSlider.on("scroll",this.onSliderScroll)},onBodyColumnChange:function(){this.updateNavigators()},onContentReady:function(){this.isReady()&&this.updateNavigators()},onAddedToDom:function(){this.isReady()&&(this.updateNavigators(),this.state.guideSelected=!1)},isReady:function(){return this.inDom&&this.contentReady},onSliderScroll:function(a){this.scrollLeft=a.target.scrollLeft,this.currentGuideIndex=Math.floor(this.scrollLeft/GUIDE_WIDTH),this.updateNavigators()},onGuideClick:function(a){var b=$(a.currentTarget),c=b.children().first(),d=c.attr("data-term"),e=c.attr("data-term-position"),f=c.attr("data-dominant-color"),g=c.attr("data-guide-index");this.state.guideSelected||(this.state.guideSelected=!0,P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED,{term:d,position:e,color:f,index:g}))},onLeftNavigatorClick:function(){this.$guidesSlider.animate({scrollLeft:this.scrollLeft-NUM_GUIDES_SLIDE_WINDOW*GUIDE_WIDTH},300)},onRightNavigatorClick:function(){this.$guidesSlider.animate({scrollLeft:this.scrollLeft+NUM_GUIDES_SLIDE_WINDOW*GUIDE_WIDTH},300)},updateNavigators:function(){0===this.scrollLeft?this.hideLeftNavigator():this.showLeftNavigator();var a=P.Viewport.numColumns*NUM_GUIDES_PER_COLUMN;this.totalGuides-this.currentGuideIndex>a?this.showRightNavigator():this.hideRightNavigator()},hideLeftNavigator:function(){this.$leftNav.hide()},showLeftNavigator:function(){this.$leftNav.show()},hideRightNavigator:function(){this.$rightNav.hide()},showRightNavigator:function(){this.$rightNav.show()}}),goog.provide("P.modules.SearchPage"),goog.require("P.Module"),P.modules.SearchPage=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},_updateSearchOptions:function(){this.searchOptions=_.pick(this.options,"query","scope","boost")},onChildNavigate:function(a){var b=a.data.url;if(!P.isOffsiteUrl(b)){var c=P.router.get().resolve(b);if(c&&"SearchPage"===c.module){var d=P.router.get().resolve(b).options;return this.setOptions(d),this.publishSearchChange(),void(a.data.handled=!0)}}},onContentReady:function(){this.publishSearchChange()},publishSearchChange:function(){this._updateSearchOptions();var a=this.searchOptions||{};P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,a.query||""),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED,a.scope||""),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED,a.boost||"")}}),goog.provide("P.modules.SearchPageContent"),goog.require("P.Module"),P.modules.SearchPageContent=P.Module.extend({events:{}}),goog.provide("P.modules.SearchScopeBar"),goog.require("P.Module"),P.modules.SearchScopeBar=P.Module.extend({}),goog.provide("P.modules.SearchScopeSelector"),goog.require("P.Module"),P.modules.SearchScopeSelector=P.Module.extend({events:{'change input[name="scope"]':"onScopeChange"},queryStringWithoutFacets:function(){var a=window.location.search;return a=a.replace(/&fc=[^&]*/,""),a=a.replace(/\?fc=[^&]*&?/,"?")},navigateToScope:function(a){var b=this.queryStringWithoutFacets();P.currentUser.isAuthenticated()||"my_pins"!==a||this.navigate("/join/"),this.navigate("/search/"+a+"/"+b)},navigateToFacet:function(a,b){var c=this.queryStringWithoutFacets();b&&(c+=(""===c?"?":"&")+"fc="+b),this.navigate("/search/"+a+"/"+c)},onScopeChange:function(a){var b=$(a.currentTarget),c=b.val();if(c!==this.options.scope){var d=b.attr("data-url")||c;this.navigateToScope(d)}}}),goog.provide("P.modules.SegmentedController"),goog.require("P.Module"),goog.require("P.trackingTimer");var TAB_IDX=0;P.modules.SegmentedController=P.Module.extend({CssClassName:{ACTIVE_SEGMENT:"activeSegment"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onContentReady:function(){var a=this.getButtons();this.activeModule=this.children[a.length]},resetActiveButton:function(){var a=this.getButtons();_.each(a,function(a){a.getContent().removeClass(this.CssClassName.ACTIVE_SEGMENT),a.enable()}.bind(this))},onButtonClick:function(a){var b=a.target;if(b.isSegmentedControlButton()){var c=this.getButtons();this.onButtonSelected(_.indexOf(c,b))}},onButtonSelected:function(a){TAB_IDX=a,this.resetActiveButton();var b=this.getButtons();b[a].getContent().addClass(this.CssClassName.ACTIVE_SEGMENT);var c=this.getModules(),d=c[a];_.isEqual(this.activeModule,d)||this.makeActiveModule(d)},getActiveModule:function(){return this.activeModule},makeActiveModuleFromIndex:function(a){var b=this.getModules()[a];this.makeActiveButtonFromIndex(a),this.makeActiveModule(b)},makeActiveButtonFromIndex:function(a){var b=this.getButtons()[a];this.resetActiveButton(),b.getContent().addClass(this.CssClassName.ACTIVE_SEGMENT)},makeActiveModule:function(a){var b=this.parent.className;P.trackingTimer.start(b,"ClickToRender",a.name),this.activeModule.remove(),this.showLoading(),P.loadModule(a).then(function(a){a.render().then(function(){var c=this.$(".content");this.hideLoading(),P.trackingTimer.end(b,"ClickToRender",Pc.reportInteractionTimings),this.activeModule=a,this.insertChild(a,c)}.bind(this))}.bind(this))},getModules:function(){return this.options.modules},getButtons:function(){return this.getChildrenByModuleName("Button")},getSelectedTab:function(){return TAB_IDX}}),goog.provide("P.modules.Select"),goog.require("P.Module"),P.modules.Select=P.Module.extend({}),goog.provide("P.modules.SelectButton"),goog.require("P.Module"),goog.require("P.modules.RadioGroup"),P.modules.SelectButton=P.Module.extend({onContentReady:function(){this.$button=this.$("button"),this.buttonModule=this.getChildById("button"),this.selectedValue=this.options.value,this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChange),this.childListen(P.CONST.EVENT_CHANGE,this.onChange)},onChange:function(a){var b=a.target,c=b.getCurrentLabel()||this.options.text;this.selectedValue=b.val()||this.options.value,this.buttonModule.setText(c),this.buttonModule.getDropdown().hide()},disable:function(){this.$button.prop("disabled",!0)},enable:function(){this.$button.removeProp("disabled")}}),goog.provide("P.modules.SelectList"),goog.require("P.Module"),goog.require("P.loader"),goog.require("P.dom"),P.modules.SelectList=P.Module.extend({events:{"click .item":"_onClickItem","mouseenter .item":"_onHoverItemStart","mouseleave .item":"_onHoverItemEnd",keydown:"_onKeydown"},CssClassName:{IS_HIDDEN:"hidden",IS_SELECTED:"selected",ITEM:"item"},onCreated:function(){this._itemVisibilityFn=null},onContentReady:function(){var a=this.getSelectedItemElement();a.length>0&&this._selectItem(a)},appendItem:function(a,b,c){return void 0===c&&(c=-1),this._appendItem(a,!!b,c)},removeItem:function(a){var b=this._getItemModule(a);a.remove(),b&&b.remove()},hasVisibleItems:function(){return this.$(".item:not(.hidden)").length>0},highlightUp:function(){this._highlightDirection(!0)},highlightDown:function(){this._highlightDirection(!1)},getSelectedItemData:function(){var a=this.getSelectedItemElement();return a.length>0?this._getItemData(a):null},scrollSelectedItemElementIntoView:function(){var a=this.getSelectedItemElement();if(0!==a.length){var b=this.$el;P.dom.scrollIntoView(a,b)}},setItemVisibilityCallback:function(a){this._itemVisibilityFn=a,this.updateItemVisibility()},_appendItem:function(a,b,c){var d=this.options.item_module||{name:"Label"},e=null;return e="module"===a.type?a:{name:d.name,options:d.options,data:a},P.loadModule(e).then(function(a){return a.renderExistingData().then(function(){var d=$('<li class="item"></li>');this.$(".sectionItems").eq(c).append(d),this.insertChild(a,d),b&&this._selectItem(d),this.updateItemVisibility(this.options.select_first_item_after_update)}.bind(this))}.bind(this))},getSelectedItemElement:function(){var a=this.$(".item.selected:not(.hidden)");return a},_getItemData:function(a){var b=this._getItemModule(a);return b?b.data:null},_getItemModule:function(a){var b=a.children()[0];return this.getChildByElement(b)},_highlightDirection:function(a){var b=this.getSelectedItemElement();if(0===b.length)a?this.selectLastVisibleItem():this.selectFirstVisibleItem();else{var c=b;do{if(c=a?c.prev():c.next(),c.is(".item:not(.hidden)")){this._selectItem(c);break}if(0===c.length){var d;a?(d=b.parents(".section").prev(),d.length||(d=this.$(".section").last())):(d=b.parents(".section").next(),d.length||(d=this.$(".section").first()));var e=d.find(".item:not(.hidden)"),f=a?e.last():e.first();this._selectItem(f)}}while(c.length>0)}},_onClickItem:function(a){a.stopPropagation();var b=$(a.currentTarget);this._selectItem(b);var c=this._getItemData(b);c&&this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,c,!0)},_onHoverItemStart:function(a){if(!this.options.suppress_hover_events){var b=$(a.currentTarget);this._selectItem(b)}},_onHoverItemEnd:function(){this.options.suppress_hover_events||this._selectItem(null)},_onKeydown:function(a){if(this.hasVisibleItems())switch(a.keyCode){case P.keyCode.UP:a.preventDefault(),a.stopPropagation(),this.highlightUp();break;case P.keyCode.DOWN:a.preventDefault(),a.stopPropagation(),this.highlightDown()}},selectFirstVisibleItem:function(){this._selectItemAtEnd(!0)},_selectItemAtEnd:function(a){var b=this.$(".item:not(.hidden)"),c=a?b.first():b.last();c.length>0&&this._selectItem(c)},selectLastVisibleItem:function(){this._selectItemAtEnd(!1)},_selectItem:function(a){var b=this.$(".item.selected");a&&(b=b.add(a)),b.each(function(b,c){var d=a?c===a[0]:!1,e=$(c);e.toggleClass(this.CssClassName.IS_SELECTED,d);var f=this._getItemModule(e);f&&f.setSelectedState&&f.setSelectedState(d)}.bind(this)),this.options.scroll_selected_item_into_view&&this.scrollSelectedItemElementIntoView()},updateItemVisibility:function(a){if(this._itemVisibilityFn){void 0===a&&(a=!0);var b=[],c=[];this.children.forEach(function(a){var d=a.$el.parent();d.hasClass(this.CssClassName.ITEM)&&(b.push(a),c.push(d))}.bind(this));for(var d=this._itemVisibilityFn(b),e=0;e<d.length;e++){var f=d[e],g=c[e];g.toggleClass(this.CssClassName.IS_HIDDEN,!f)}this.$(".section").each(function(a,b){var c=$(b),d=c.find(".item:not(.hidden)").length>0;c.find(".sectionHeading").toggleClass(this.CssClassName.IS_HIDDEN,!d)}.bind(this)),a&&this.selectFirstVisibleItem()}}}),goog.provide("P.modules.SendInvitationEmail"),goog.require("P.Module"),P.modules.SendInvitationEmail=P.Module.extend({events:{"click .sendInvitationEmail":"onMouseClick"},onMouseClick:function(){if(this.options.is_valid_email){var a=this.options.text_value;P.Invite.userInviteEmail(a,function(){this.triggerEvent(P.CONST.EVENT_INVITE_USER,{recipients:[a]},!0)}.bind(this))}}}),goog.provide("P.modules.SentPin"),goog.require("P.Module"),P.modules.SentPin=P.Module.extend({onContentReady:function(){P.trackRegisterAction("sent_pin_landing")}}),goog.provide("P.modules.SentPinSender"),goog.require("P.Module"),P.modules.SentPinSender=P.Module.extend({}),goog.provide("P.modules.ShoppingButtonBar"),goog.require("P.Module"),P.modules.ShoppingButtonBar=P.Module.extend({}),goog.provide("P.modules.ShowModalButton"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.modules.ModalTrigger"),P.modules.ShowModalButton=P.modules.Button.extend({onClick:function(a){if(P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this);else if(P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(this);else{if(P.modules.Button.prototype.onClick.call(this,a),this.options.require_auth&&!this.ensureAuthentication())return a.preventDefault(),!1;if(this.showModalSubmodule(),"a"===this.options.element_type)return!1}}}),_.extend(P.modules.ShowModalButton.prototype,{showModalSubmodule:function(){P.util.showModalSubmodule(this)},getAuthRedirectUrl:function(){var a={};return this.options.require_auth_params&&_.extend(a,this.options.require_auth_params),P.currentUser.isAuthenticated()?void P.changeWindowLocation(P.getRegisterUrl({}),!1):P.signupModalManager.showInlineSignupModalOnButtonClick("ShowModalButton")},toString:function(){return this.className+"(module="+this.options.submodule.name+")"},getLoggingObjectIdStr:function(){return this.parent?this.parent.getLoggingObjectIdStr():null}}),goog.provide("P.modules.SignedEmailDisassociatePage"),goog.require("P.Module"),P.modules.SignedEmailDisassociatePage=P.Module.extend({}),goog.provide("P.modules.SignedEmailSettingsPage"),goog.require("P.Module"),P.modules.SignedEmailSettingsPage=P.Module.extend({}),goog.provide("P.modules.SignedEmailUnsubscribePage"),goog.require("P.Module"),P.modules.SignedEmailUnsubscribePage=P.Module.extend({}),goog.provide("P.modules.SignupForm"),goog.require("P.Module"),P.modules.SignupForm=P.Module.extend({}),goog.provide("P.modules.SmartFeedPage"),goog.require("P.Module"),P.modules.SmartFeedPage=P.Module.extend({}),goog.provide("P.modules.SocialIconsCounts"),goog.require("P.Module"),P.modules.SocialIconsCounts=P.Module.extend({incrementLike:function(){this.data.liked_by_me=!0,this._alterAttribute("like_count",1)},decrementLike:function(){this.data.liked_by_me=!1,this._alterAttribute("like_count",-1)},incrementRepin:function(){this._alterAttribute("repin_count",1)},_alterAttribute:function(a,b){if(this.model){var c=this.data,d=c[a]||0,e=Math.max(d+b,0);c[a]=e,this.model.set(c),this.renderExistingData()}}}),goog.provide("P.modules.StepBase"),goog.require("P.interfaces.TutorialStep"),goog.require("P.Module"),P.modules.StepBase=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT]=function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)},this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a),this.initializeStep(),this.isContextualExperience=!1},initializeStep:P.NOOP,onEnter:function(a){a&&a()},onShow:function(a){a&&a()},onRemoved:P.NOOP,onExit:function(a){a&&a()},onButtonClick:function(){},_onButtonClick:function(a){var b=a.target;b&&(this.onButtonClick(a),a.shouldPropagate()&&("previousButton"===b.id?(a.stopPropagation(),this.onPreviousButtonClicked()):"nextButton"===b.id?(a.stopPropagation(),this.onNextButtonClicked()):"dismissButton"===b.id&&(a.stopPropagation(),this.onDismissButtonClicked())))},onDismissButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},onPreviousButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0)},onNextButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)},getExperienceId:function(){return null},getPlacementId:function(){return null},getPlacedExperienceId:function(){return this.isContextualExperience?P.ExperienceManager.instance().constructPlacedExperienceId(this.getPlacementId(),this.getExperienceId()):null},completePlacedExperience:function(){var a=P.ExperienceManager.instance();return this.getPlacedExperienceId()?a.completePlacedExperienceId(this.getPlacedExperienceId()):a.completePlacedExperience(this.getPlacementId(),this.getExperienceId())},dismissPlacedExperience:function(){var a=P.ExperienceManager.instance();return this.getPlacedExperienceId()?a.dismissPlacedExperienceId(this.getPlacedExperienceId()):a.dismissPlacedExperience(this.getPlacementId(),this.getExperienceId())},onTutorialComplete:P.NOOP,setExperienceViewed:function(){var a=P.ExperienceManager.instance();this.getPlacedExperienceId()?a.viewPlacedExperienceId(this.getPlacedExperienceId()):a.viewPlacedExperience(this.getPlacementId(),this.getExperienceId())}}),goog.provide("P.modules.StoryFeedPage"),goog.require("P.Module"),P.modules.StoryFeedPage=P.Module.extend({}),goog.provide("P.modules.StoryboardEditableText"),goog.require("P.Module"),P.modules.StoryboardEditableText=P.Module.extend({events:{input:"onInputChanged"},CssClassName:{EDITABLE:"editable"},onContentReady:function(){this.$el.addClass(this.CssClassName.EDITABLE),this.$el.attr("data-edit-type","editText");var a=this.options.alignment;a&&this.$el.addClass(a);var b=this.options.text;b&&this.$(".editableText").text(b),this.addEditor()},activate:function(){this.$el.click()},getAlignment:function(){return this.options.alignment},getOptions:function(){return _.extend({text:this.$el.text()},this.options)},addEditor:function(){var a={name:"StoryboardEditorMenu",options:{target:this,storyboardFeed:this.options.storyboardFeed,horizontal:!0}};P.loadModule(a).then(function(a){a.render().then(function(){this.appendChild(a)}.bind(this))}.bind(this))},getExportData:function(){return{type:"text",alignment:this.options.alignment||"left",text:this.$(".editableText").text()}}}),goog.provide("P.modules.StoryboardEditorMenu"),goog.require("P.Module"),P.modules.StoryboardEditorMenu=P.Module.extend({events:{"click .optionsGroup.textVisibility":"_clickTextVisibility","click .optionsGroup.textAlignment":"_clickTextAlignment","click .addTextBox":"_clickAddTextbox","click .delete":"_clickDelete"},CssClassName:{HORIZONTAL:"horizontal",VISIBLE:"visible"},onContentReady:function(){var a=this.options.target.$el,b=this._getTargetModule().options.pinOptions||{},c=a.attr("data-edit-type");
if("storyboardRow"===c){if(this.$(".switchLayoutButton").addClass(this.CssClassName.VISIBLE),this.$(".textVisibility").addClass(this.CssClassName.VISIBLE),this.$(".addTextBox").addClass(this.CssClassName.VISIBLE),this._updateTextVisibility(b.textVisibility),this._updateLayout(this.options.storyboardFeed.getCurrentPinVariationIndex(this._getTargetModule().options.pinOrganization)+1),this.options.rowNumber>=0){var d={};d[P.CONST.PUBSUB_TOPIC_STORYBOARD_LAYOUT_CLICKED]=this.onLayoutClicked,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,d)}}else"editText"===c&&(this.$(".delete").addClass(this.CssClassName.VISIBLE),this.$(".textAlignment").addClass(this.CssClassName.VISIBLE),this._updateAlignment(this._getTargetModule()));this.options.horizontal&&this.$el.addClass(this.CssClassName.HORIZONTAL)},onLayoutClicked:function(a,b,c){c&&c.rowNumber===this.options.rowNumber&&this._setCurrentLayout(c.layoutNumber)},_clickTextVisibility:function(a){var b=this.options.storyboardFeed,c=$(a.target).attr("data-next");b.setTextVisibility(this._getTargetModule(),c),this._updateTextVisibility(c)},_setCurrentLayout:function(a){var b=this.options.storyboardFeed;b.setLayoutNumber(this._getTargetModule(),a)},_clickAddTextbox:function(){var a=this.options.storyboardFeed,b={name:"StoryboardEditableText",options:{storyboardFeed:this.options.storyboardFeed}};P.loadModule(b).then(function(b){b.render().then(function(){a.insertChild(b,null,null,this._getTargetModule().$el),b.activate()}.bind(this))}.bind(this))},_clickDelete:function(){this._getTargetModule().destroy(),this.destroy()},_clickTextAlignment:function(a){var b=$(a.target).attr("data-next-alignment"),c=this._getTargetModule();c.options=c.getOptions(),c.options.alignment=b,c.render().then(function(){c.activate()}),this._updateAlignment(c)},_updateTextVisibility:function(a){a=a||"titleDescription",this.$(".textVisibility .option").removeClass(this.CssClassName.VISIBLE),this.$(".textVisibility ."+a).addClass(this.CssClassName.VISIBLE)},_updateAlignment:function(a){this.$(".textAlignment .option").removeClass(this.CssClassName.VISIBLE);var b=a.getAlignment()||"left";this.$(".textAlignment ."+b).addClass(this.CssClassName.VISIBLE)},_updateLayout:function(a){a=a||1;var b=this.$(".switchLayoutButtonWrapper");b.attr("class","switchLayoutButtonWrapper"),b.addClass("layout-"+a)},_getTargetModule:function(){return this.options.target}}),goog.provide("P.modules.StoryboardFeed"),goog.require("P.Module");var PIN_VARIATIONS=[{className:"fullWidth bigText",numPins:1,variant:"withPadding"},{className:"fullWidth twoColumnText bigText",numPins:1,variant:"fullWidthTwoColumnText"},{className:"fullWidth textOnRight bigText",numPins:1,variant:"fullWidthTextOnRight"},{className:"fullBleed oneColumnText bigText",numPins:1,variant:"fullBleed"},{className:"fullBleed twoColumnText bigText",numPins:1,variant:"fullBleedTwoColumnText"},{className:"fullBleed textOnRight bigText",numPins:1,variant:"fullBleedTextOnRight"},{className:"fullBleed fullBleedGradient oneColumnText bigText",numPins:1,variant:"fullBleedWithGradient"},{className:"fullBleed fullBleedGradient twoColumnText bigText",numPins:1,variant:"fullBleedTwoColumnTextWithGradient"},{className:"fullBleed fullBleedGradient textOnRight bigText",numPins:1,variant:"fullBleedTextOnRightWithGradient"},{className:"fullBleed leftTriangle bigText",numPins:1,variant:"fullBleedLeftTriange"},{className:"fullBleed rightTriangle bigText",numPins:1,variant:"fullBleedRightTriangle"},{className:"squareWithText textOnRightHalf bigText",numPins:1,variant:"squareWithTextOnRight"},{className:"squareWithText textOnLeftHalf bigText",numPins:1,variant:"squareWithTextOnLeft"},{className:"fullWidthCircle bigText",numPins:1,variant:"withPaddingCircle"},{className:"fullScreenCircle bigText",numPins:1,variant:"bigCircle"},{className:"circleWithText textOnLeftHalf bigText",numPins:1,variant:"circleWithTextOnLeft"},{className:"circleWithText textOnRightHalf bigText",numPins:1,variant:"circleWithTextOnRight"},{className:"semiCircleLeft textOnRightHalf bigText",numPins:1,variant:"semiCircleLeft"},{className:"semiCircleRight textOnLeftHalf bigText",numPins:1,variant:"semiCircleRight"},{className:"halfWidthPins smallText",numPins:2,variant:"withPadding"},{className:"halfWidthFullBleed smallText",numPins:2,variant:"fullBleed"},{className:"fourPinUnequal smallText",numPins:4,variant:"unequalHeight"},{className:"fourPinUnequalReverse smallText",numPins:4,variant:"unequalHeightReverse"}];P.modules.StoryboardFeed=P.Module.extend({CssClassName:{STORYBOARD_ROW:"StoryboardRow"},state:{editingTarget:null},onContentReady:function(){this.renderStoryGrid()},renderStoryGrid:function(){var a=this.options.feed_data;a&&_.keys(a).length>0?this.renderGridFromData(a):this.renderGrid()},getRandomPinOrganization:function(){var a=PIN_VARIATIONS[Math.floor(Math.random()*PIN_VARIATIONS.length)];return a},getPinOrganizationFromVariant:function(a){for(var b=0;b<PIN_VARIATIONS.length;b++){var c=PIN_VARIATIONS[b];if(c.variant===a)return c}},renderGridFromData:function(a){var b=this.data||[];b=b.filter(function(a){return"pin"===a.type});for(var c=0,d=function(a){if("pin"===a.type){if(c>=b.length)return;var d=this.getPinOrganizationFromVariant(a.variant),e=d.numPins,f={name:"StoryboardRow",options:{pins:b.slice(c,c+e),pinOrganization:d,pinOptions:a.pinOptions,storyboardFeed:this,rowNumber:Math.random()}};P.loadModule(f).then(this.renderAndAppendModule.bind(this)),c+=e}else if("text"===a.type){var g={name:"StoryboardEditableText",options:_.extend({storyboardFeed:this.options.storyboardFeed},a)};P.loadModule(g).then(this.renderAndAppendModule.bind(this))}}.bind(this);c<b.length;)a.forEach(d)},renderGrid:function(){var a=this.data||[];a=a.filter(function(a){return"pin"===a.type});var b,c=0,d=!this.state.editingTarget;this.children.forEach(function(e){if(this.state.editingTarget===e&&(d=!0),e.options.pinOrganization){if(b=e.options.pinOrganization.numPins,!d)return void(c+=b);_.extend(e.options,{pins:a.slice(c,c+b),editing:this.state.editingTarget===e}),e.render(),c+=b}}.bind(this)),this.backfillPins(a,c)},backfillPins:function(a,b){for(var c=b;c<a.length;){var d=this.getRandomPinOrganization(),e=d.numPins,f={name:"StoryboardRow",options:{pins:a.slice(c,c+e),pinOrganization:d,pinOptions:{},storyboardFeed:this,rowNumber:Math.random()}};P.loadModule(f).then(this.renderAndAppendModule.bind(this)),c+=e}},renderAndAppendModule:function(a){a.render().then(function(){this.appendChild(a)}.bind(this))},setLayoutNumber:function(a,b){this.state.editingTarget=a,a.options.pinOrganization=PIN_VARIATIONS[b-1],this.renderGrid()},goToNextIterationWithoutBounds:function(a){this.state.editingTarget=a;var b=a.options.pinOrganization;if(b){var c=this.getCurrentPinVariationIndex(b),d=(c+1)%PIN_VARIATIONS.length;a.options.pinOrganization=PIN_VARIATIONS[d]}else a.options.pinOrganization=PIN_VARIATIONS[0];this.renderGrid()},getCurrentPinVariationIndex:function(a){for(var b=0;b<PIN_VARIATIONS.length;b++)if(PIN_VARIATIONS[b].className===a.className)return b;return-1},setTextVisibility:function(a,b){this.state.editingTarget=a,a.options.pinOptions=a.options.pinOptions||{},a.options.pinOptions.textVisibility=b,this.renderGrid()},exportFeedData:function(a){var b=[];return this.$el.children().each(function(c,d){var e=this.getChildByElement(d);e&&(!a||$(d).hasClass(this.CssClassName.STORYBOARD_ROW))&&b.push(e.getExportData())}.bind(this)),b}}),goog.provide("P.modules.StoryboardHeader"),goog.require("P.Module"),P.modules.StoryboardHeader=P.Module.extend({}),goog.provide("P.modules.StoryboardLayoutList"),goog.require("P.Module"),P.modules.StoryboardLayoutList=P.Module.extend({events:{"click .item":"onLayoutItemClick","click .xIcon":"onDeleteClick","keyup .layoutTextInput":"onKeyupLayoutTextInput"},CssClassName:{BOLD:"bold"},onLayoutItemClick:function(a){var b=$(a.target).text().trim();this.$(".item").removeClass(this.CssClassName.BOLD),$(a.target).addClass(this.CssClassName.BOLD),this.triggerEvent(P.CONST.EVENT_LAYOUT_ITEM_CLICK,b,!0)},onKeyupLayoutTextInput:function(a){13===a.keyCode&&this.triggerEvent(P.CONST.EVENT_LAYOUT_INPUT_KEYUP,$(a.target).val().trim(),!0)},onDeleteClick:function(a){a.stopPropagation();var b={layout_name:$(a.target).closest(".item").text().trim()},c=P.resourceFactory.create("StoryboardLayoutResource",b);c.callDelete().then(function(){this.render()}.bind(this))}}),goog.provide("P.modules.StoryboardLayoutSelector"),goog.require("P.Module");var NUM_STORYBOARD_LAYOUTS=23;P.modules.StoryboardLayoutSelector=P.Module.extend({events:{"click .selectorItem":"onClickSelectorItem"},onCreated:function(){for(var a=[],b=0;b<NUM_STORYBOARD_LAYOUTS;b++)a.push(b+1);this.options.selector_nums=a},onClickSelectorItem:function(a){var b={layoutNumber:$(a.target).attr("data-item-num"),rowNumber:this.options.rowNumber};P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_STORYBOARD_LAYOUT_CLICKED,b)}}),goog.provide("P.modules.StoryboardList"),goog.require("P.Module"),P.modules.StoryboardList=P.Module.extend({events:{"click .deleteButton":"onClickDelete","keyup .boardInput":"onKeyupBoardInput"},onContentReady:function(){},onClickDelete:function(a){var b={board_id:$(a.target).attr("data-board-id")},c=P.resourceFactory.create("StoryboardResource",b);c.callDelete().fin(function(){this.render()}.bind(this))},onKeyupBoardInput:function(a){if(13===a.keyCode){for(var b=$(a.target).val(),c=b.split("/"),d=[];c.length>0;){var e=c.pop();if(e.length&&d.push(e),d.length>=2)break}2===d.length&&this.navigate("/internal/storyboard/"+d[1]+"/"+d[0]+"/")}}}),goog.provide("P.modules.StoryboardPage"),goog.require("P.Module");var STORYBOARD_HEIGHT=640;P.modules.StoryboardPage=P.Module.extend({events:{"click .createButton":"onClickCreate","click .cancelButton":"onClickCancel"},state:{},onContentReady:function(){this.childListen(P.CONST.EVENT_LAYOUT_ITEM_CLICK,this.fetchLayout),this.childListen(P.CONST.EVENT_LAYOUT_INPUT_KEYUP,this.saveStoryboardLayout)},scrollToSecondFrame:function(a){var b=$(a.target).closest(".editorContainer");b.animate({scrollTop:STORYBOARD_HEIGHT},500)},onClickCreate:function(){var a=this._getStoryboardFeed().exportFeedData(),b={board_id:this.data.id,data:{header_data:this._getHeaderData(),feed_data:a}},c=P.resourceFactory.create("StoryboardResource",b);c.callUpdate().fin(function(){alert("Storyboard saved")})},onClickCancel:function(){this.navigate("/internal/storyboards/")},fetchLayout:function(a){var b={layout_name:a.data},c=P.resourceFactory.create("StoryboardLayoutResource",b);c.callGet().then(function(a){var b=a.resource_response.data.feedData;this._getStoryboardFeed().options.feed_data=b,this._getStoryboardFeed().render()}.bind(this))},saveStoryboardLayout:function(a){var b=a.data,c=this._getStoryboardFeed().exportFeedData(!0),d={layout_name:b,layout_data:{layoutName:b,feedData:c}},e=P.resourceFactory.create("StoryboardLayoutResource",d);e.callUpdate().fin(function(){this.getChildById("layout_list").render()}.bind(this))},_getHeaderData:function(){return{creatorDescription:this.$(".creatorDescription").text().trim(),storyboardBlurb:this.$(".storyboardBlurb").text().trim(),boardName:this.$(".boardNameEditable").text().trim()}},_getCountry:function(){return this.$('select[name="country"]').val()},_getStoryboardFeed:function(){return this.getChildById("grid")}}),goog.provide("P.modules.StoryboardPin"),goog.require("P.Module"),P.modules.StoryboardPin=P.Module.extend({}),goog.provide("P.modules.StoryboardRow"),goog.require("P.Module"),P.modules.StoryboardRow=P.Module.extend({events:{"click .StoryboardPin":"nextIteration"},CssClassName:{EDITING:"editing"},onContentReady:function(){var a=this.options.pins,b=this.options.pinOrganization||{},c=this.options.pinOptions||{},d=this.options.editing;a.length||this.destroy(),d&&this.$el.addClass(this.CssClassName.EDITING),b.className&&this.$el.addClass(b.className),c.textVisibility&&this.$el.addClass(c.textVisibility),this.$el.attr("data-edit-type","storyboardRow");var e=[];4===b.numPins&&4===a.length?(e[0]=a[0],e[1]=a[2],e[2]=a[1],e[3]=a[3]):e=a,e&&e.length&&e.forEach(function(a){var b={name:"StoryboardPin",data:a,options:{pin:a}};P.loadModule(b).then(function(a){a.render().then(function(){this.appendChild(a)}.bind(this))}.bind(this))}.bind(this)),this.addEditor()},addEditor:function(){var a=this.options.storyboardFeed,b={name:"StoryboardEditorMenu",options:{target:this,storyboardFeed:a,rowNumber:this.options.rowNumber}};P.loadModule(b).then(function(a){a.render().then(function(){this.appendChild(a)}.bind(this))}.bind(this))},nextIteration:function(){this.options.storyboardFeed.goToNextIterationWithoutBounds(this)},getExportData:function(){var a=this.options.pinOrganization,b=this.options.pins.map(function(a){return a.id});return{type:"pin",textVisibility:this.options.textVisibility,numPins:a.numPins,variant:a.variant,pins:b,pinOptions:this.options.pinOptions}}}),goog.provide("P.modules.Tabs"),goog.require("P.Module"),P.modules.Tabs=P.Module.extend({events:{"click .tab":"onTabSelected"},CssClassName:{ACTIVE:"active",DISABLED:"disabled"},onCreated:function(){this.childListen(P.CONST.EVENT_DATA_EMPTY,this._onNoData)},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.modulePromises={};var a=this.getChildById("selectedTabModule"),b=this.options.selected_tab_index||0;a&&(this.modulePromises[b]=Promise.resolve(a),this.setSelectedTabIndex(b)),this.options.prefetch&&this.prefetchTabsContent()},getTabCount:function(){return this.options.tabs.length},prefetchTabsContent:function(){for(var a=function(a){this.insertChild(a,this.$(".content")),a.render().then(function(){a.hide()})}.bind(this),b=0;b<this.getTabCount();b++)if(!this.modulePromises[b]){var c=this.options.tabs[b].content_module,d=P.loadModule(c);this.modulePromises[b]=d,d.then(a)}},setSelectedTabIndex:function(a){if(this.modulePromises[a])return this._setNewIndex(a),this.modulePromises[this.currentIndex].then(function(a){a.show()});var b=this.options.tabs[a].content_module,c=P.loadModule(b);return this.modulePromises[a]=c,c.then(function(b){this.insertChild(b,this.$(".content")),this._setNewIndex(a),b.showLoading(),b.render().then(function(){b.hideLoading(),a===this.currentIndex?b.show():b.hide()}.bind(this))}.bind(this))},_setNewIndex:function(a){void 0!==this.currentIndex&&this.modulePromises[this.currentIndex].then(function(a){a.hide()}),this._setTabActive(a)},_onNoData:function(a){var b=a.data;void 0!==this.currentIndex&&(this.currentIndex=0);var c=this._getTabLabels();c.eq(this.currentIndex).addClass(this.CssClassName.DISABLED),this.setSelectedTabIndex(b)},onTabSelected:function(a){if(!$(a.target).hasClass(this.CssClassName.DISABLED)){var b=a.currentTarget.getAttribute("data-tab-index");this.setSelectedTabIndex(b)}},_setTabActive:function(a){this.currentIndex=a;var b=this._getTabLabels();b.removeClass(this.CssClassName.ACTIVE),b.eq(a).addClass(this.CssClassName.ACTIVE),this.modulePromises[a].then(function(b){b.triggerEvent(P.CONST.EVENT_TAB_SELECTED,a,!1)})},_getTabLabels:function(){return this.$(".header > .tab > div")}}),goog.provide("P.modules.TakedownForm"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.OffsiteWork"),goog.require("P.modules.ReportedContent");var MAX_REPORTED_ITEMS=100,MAX_CONTEXT_NOTES_CHARS=800,MAX_MISC_FIELD_CHARS=128;P.modules.TakedownForm=P.Module.extend({events:{"click .addAnotherInfringingButton":"onAddAnotherInfringingClick","click .removeInfringingItemButton":"onRemoveInfringingItemClick","click .sameInfoButton":"onSameInfoClicked","click .addAnotherOffsiteButton":"onAddAnotherOffsiteClick","click .removeOffsiteItemButton":"onRemoveOffsiteItemClick"},onCreated:function(){this.numOffsiteUrls=1,this.numReportedItems=1},onAddAnotherInfringingClick:function(){var a=new P.modules.ReportedContent({options:{view_type:this.extraData.view_type}});this._onAddAnotherClick(a,".ReportedContentWrapper","numReportedItems")},onAddAnotherOffsiteClick:function(){this._onAddAnotherClick(new P.modules.OffsiteWork({}),".OffsiteWorkWrapper","numOffsiteUrls")},_onAddAnotherClick:function(a,b,c){var d=this.$(b);a.render().then(function(){if(this[c]<MAX_REPORTED_ITEMS)this.insertChild(a,d),$(b).children().last().wrap("<li></li>"),this[c]+=1,this.onContentReady();else{var e={name:"ConfirmDialog",options:{message:"No more than "+MAX_REPORTED_ITEMS+" reported items per form, please."}};P.loadModule(e).then(function(a){this.showInModal(a)}.bind(this))}}.bind(this))},onRemoveInfringingItemClick:function(){this._onRemoveItemClick(".ReportedContentWrapper","numReportedItems")},onRemoveOffsiteItemClick:function(){this._onRemoveItemClick(".OffsiteWorkWrapper","numOffsiteUrls")},_onRemoveItemClick:function(a,b){if(this[b]>1){var c=this.$(a).children().last();c.remove(),this[b]-=1}else{var d={name:"ConfirmDialog",options:{message:"You must report at least one item."}};P.loadModule(d).then(function(a){this.showInModal(a)}.bind(this))}},onContentReady:function(){var a={agent_name:[P.Validator.Required()],agent_street_address:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_city:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_state:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_zipcode:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_country:[],agent_phone:[P.Validator.PhoneNumber()],agent_email:[P.Validator.Email({}),P.Validator.Required()],is_accurate:[P.Validator.Required()],is_good_faith:[P.Validator.Required()],is_authorized_agent:[P.Validator.Required()],signed_name:[P.Validator.Required(),P.Validator.EqualTo({targetFieldName:"agent_name",message:"Electronic signature doesn't match your name."})]};this.$(".owner_website_url")&&(a.owner_website_url=[P.Validator.Required()]),this.$(".reported_content_url")&&(a.reported_content_url=[P.Validator.Required(),P.Validator.URL()]),this.$(".context_notes")&&(a.context_notes=[P.Validator.Length({max:MAX_CONTEXT_NOTES_CHARS})]),this.$(".exact_string")&&(a.exact_string=[P.Validator.Required()]),this.$(".remove_all")&&(a.remove_all=[]),this.$(".strike")&&(a.strike=[]);var b={prevalidate:!0};this.$form=this.$("form"),this.form=new P.Form(this.$form,a,b),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},getFormData:function(){var a=[],b={},c=this.form.$el.serializeArray(),d=["owner_website_url","reported_content_url","context_notes","exact_string","remove_all","strike"],e=[],f={};return _.each(c,function(c){-1!==d.indexOf(c.name)?(-1!==e.indexOf(c.name)&&(a.push(f),e=[],f={}),f[c.name]=c.value,e.push(c.name)):b[c.name]=b[c.name]="on"===c.value?!0:c.value}),a.push(f),b.reported_content=a,b},onSubmitValidated:function(a){var b;if(!a.errors[0]){var c=this.getChildById("submitButton");c.showLoading(),b="dmcapin"===this.extraData.view_type?this.form.getData():this.getFormData(),b.form_type=this.extraData.view_type,b.num_offsite_urls=this.numOffsiteUrls,b.num_reported_items=this.numReportedItems;var d=P.resourceFactory.create("TakedownRequestResource",b);d.options=b,d.callCreate({showError:!0}).then(function(a){c.hideLoading();var b=a.resource_response.data,d="Thanks for submitting. Your confirmation number is "+b+".",e={name:"ConfirmDialog",options:{button_text:"Got it!",body_message:d,title:"Request Submitted",template:"generic"}};P.loadModule(e).then(function(a){this.showInModal(a)}.bind(this))}.bind(this)).fin(function(){c.hideLoading()})}}}),goog.provide("P.modules.TextContainer"),goog.require("P.Module"),P.modules.TextContainer=P.Module.extend({}),goog.provide("P.modules.TextField"),goog.require("P.Module"),goog.require("P.TypeaheadProvider");var MENTION_TEMPLATE="<li data-value='${name}'><img src='${img}' /> ${name} <span>(${fullName})</span></li>";P.modules.TextField=P.Module.extend({events:{click:"_onClick","focus .content":"_onContentFocus","blur .content":"_onContentBlur","input .content":"_onContentInput","keydown .content":"_onContentKeydown","keyup .content":"_onContentKeyup","paste .content":"_onContentPaste"},CssClassName:{ACTIVE:"active",HAS_VALUE:"has-value",MAX_HEIGHT:"maxheight"},onContentReady:function(){this.options.mentions&&this.initAtMentions(),this._getContent().placeholder()},initAtMentions:function(){this.typeahead=new P.TypeaheadProvider({tags:"mentions",pin_id:this.options.pin_id}),this._getContent().atwho("@",{data:"/",tpl:MENTION_TEMPLATE,callbacks:{remote_filter:this.onAtMentionFilter.bind(this)}}),this.atwho=this._getContent().data("atwho")},onAtMentionFilter:function(a,b,c){a.q&&this.typeahead.search(a.q,function(a){var b=_.map(a.items,function(a){return{name:P.stripTags(a.username),fullName:P.stripTags(a.label),img:a.image}});c(b),this.atwho.settings["@"].data="/"}.bind(this))},_getContent:function(){return this.$content||(this.$content=this.$(".content")),this.$content},getValue:function(){var a=this._getContent(),b=a.val().trim();return this.log.debug("value:",b,a),b},getUntrimmedValue:function(){return this._getContent().val()},setValue:function(a){this._getContent().val(a)},focus:function(){this._getContent().focus()},_onClick:function(){this.focus()},_onContentFocus:function(){this.$el.addClass(this.CssClassName.ACTIVE),this.triggerEvent(P.CONST.EVENT_FOCUS,null,!0)},_onContentBlur:function(){var a=this.getValue().length;this.$el.toggleClass(this.CssClassName.HAS_VALUE,a),this.$el.removeClass(this.CssClassName.ACTIVE),this.triggerEvent(P.CONST.EVENT_BLUR,{hasValue:a},!0)},_onContentInput:function(){this.options.autogrow&&this._updateInputSize(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},_shouldListenToKeyup:function(){return"onpropertychange"in this.$el[0]&&!("oninput"in this.$el[0])},_onContentKeydown:function(a){var b=a.keyCode;b===P.keyCode.ENTER?(this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,null,!0),this.options.prevent_default_on_enter&&(a.preventDefault(),this._onContentInput()),this.options.stop_propagation_on_enter&&a.stopPropagation()):(b===P.keyCode.LEFT||b===P.keyCode.RIGHT)&&a.stopPropagation()},_onContentKeyup:function(){this._shouldListenToKeyup()&&this._onContentInput()},_updateInputSize:function(){var a=this._estimateInputSize(),b=this._getContent();if(b.height()!==a){var c=this.options.maxheight;c&&c<a?(b.height(c),b.addClass(this.CssClassName.MAX_HEIGHT)):(b.removeClass(this.CssClassName.MAX_HEIGHT),b.height(this._estimateInputSize())),this.triggerEvent(P.CONST.EVENT_TEXT_INPUT_RESIZED,null,!0)}},_estimateInputSize:function(){var a=this._getContent();if(!this.$_mirrorInput){var b='<div class="invisibleElemContainer"><textarea class="content invisibleElem"></textarea></div>';this.$el.append(b),this.$_mirrorInput=this.$(".invisibleElem"),this.$_mirrorInput.width(a.width()),a.attr("rows")&&this.$_mirrorInput.attr("rows",a.attr("rows")),this._initInputHeight=a.height()}var c=this._getContent().val();this.$_mirrorInput.val(c);var d=parseInt(a.css("padding-top"),10)||0,e=Math.max(this.$_mirrorInput[0].scrollHeight-2*d,this._initInputHeight);return this.$_mirrorInput.val(""),e},_onContentPaste:function(){this.triggerEvent(P.CONST.EVENT_PASTE,null,!0)}}),goog.provide("P.modules.ToastBase"),goog.require("P.Module");var DEFAULT_TOAST_VISIBLE_TIME=4e3;P.modules.ToastBase=P.Module.extend({CssClassName:{VISIBLE:"visible"},onAdded:function(){var a=this;this.$el.transition({y:200,opacity:0,duration:1},function(){a.$el.addClass(a.CssClassName.VISIBLE)}).transition({y:0,easing:"cubic-bezier(.19, 1.15, .48, 1)",opacity:1,duration:450})},animateOut:function(){this.$el.transition({scale:1.1,opacity:0,duration:200},function(){this.destroy()}.bind(this))},attachTimer:function(a){this._timer=P.setTimeout(function(){return this.$el.isHovering()?(clearTimeout(this._timer),void this.$el.on("mouseleave",function(){this.attachTimer(DEFAULT_TOAST_VISIBLE_TIME/2)}.bind(this))):void this.animateOut()}.bind(this),a)},onContentReady:function(){this.$el.initHovering(),this.attachTimer(DEFAULT_TOAST_VISIBLE_TIME)}}),goog.provide("P.modules.Toasts"),goog.require("P.Module"),P.modules.Toasts=P.Module.extend({}),goog.provide("P.modules.ToggleButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.ToggleButton=P.modules.Button.extend({onClick:function(a){this._logContextEvent(a),a.stopPropagation(),a.preventDefault(),this.toggleState(),P.modules.Button.prototype.onClick.call(this,a)},toggleState:function(){this.setState(!this.getState())},setState:function(a){this.options.toggled=a,this.renderExistingData()},getState:function(){return this.options.toggled}}),goog.provide("P.modules.Token"),goog.require("P.Module"),P.modules.Token=P.Module.extend({getTokenData:function(){return{}}}),goog.provide("P.modules.TokenizedInput"),goog.require("P.Module"),goog.require("P.modules.Token"),goog.require("P.modules.Input");var MIN_INPUT_FIELD_WIDTH=100;P.modules.TokenizedInput=P.Module.extend({events:{"keyup input":"onInputKeyup","keydown input":"onInputKeydown","click .tokenWrapper":"onTokenModuleWrapperClick","click .inputToken":"onInputTokenClick","click .removeAll":"onRemoveAll"},CssClassName:{TOKEN_SELECTED:"tokenSelected"},onCreated:function(){this.options.handled_by_parent||this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.tokens=[],this.savedTokens=[],this.selectedToken=null,this.childListen(P.CONST.EVENT_REMOVE_TOKEN,this.onRemoveToken),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.onBodyColumnChange),this.updateTokenizedInputView=this.updateTokenizedInputView.bind(this),this.state={scrollLeft:0}},onRemoveToken:function(a){var b=a.data,c=_.indexOf(this.tokens,b),d=this.tokens[c].getTokenData();this.removeToken(b),this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,d,!0)},onInputTokenClick:function(){this.selectedToken&&this.unselectSelectedToken(),this.options.hide_tokens_on_focus&&this.setEditingTokenText()},setEditingTokenText:function(){var a=this.getTokens();if(a.length>0){var b=this.constructTokenTextLeftToRight();this.savedTokens=$.extend(!0,[],a);var c=_.clone(a);_.each(c,function(a){this.removeToken(a)}.bind(this)),this.getInputField().setValue(b),_.defer(function(){this.getInputField().setCursorPosition(b.length)}.bind(this))}},onBodyColumnChange:function(){this.updateTokenizedInputView()},constructTokenText:function(){return"prioritized"===this.options.token_text_strategy?this.constructTokenTextBasedOnPriority():this.constructTokenTextLeftToRight()},_getTokensWidth:function(a,b){for(var c=this.getTokens(),d=0,e=a;e<=b;e++)d+=c[e].getWidth(!0);return d},updateTokenizedInputView:function(){var a=this.getWidth(),b=this.getTokens(),c=this._getTokensWidth(0,b.length-1),d=this.$(".inputToken"),e=this.$(".tokensWrapper"),f=this.$(".scrollWrapper"),g=a-c,h=this.state.scrollLeft;if(g>=MIN_INPUT_FIELD_WIDTH)e.css("width",a+"px"),d.css("width",g+"px"),f.css("overflow-x","hidden");else{var i=c+MIN_INPUT_FIELD_WIDTH;if(d.css("width",MIN_INPUT_FIELD_WIDTH+"px"),P.CONTEXT.is_mobile_agent&&f.css("overflow-x","scroll"),this.selectedToken){var j=_.indexOf(b,this.selectedToken),k=this._getTokensWidth(0,j-1);k-h>=0?k-h>a&&(h=a-i):h=0}else h=a-i;e.css("width",i-h+"px"),f.scrollLeft(-1*h),this.state.scrollLeft=h}},constructTokenTextBasedOnPriority:function(){var a=this.getTokens(),b="";return _.each(a,function(a){var c=a.getTokenData(),d=c.text,e=c.priority;"0"===e?b=d+" "+b:b+=" "+d,b=b.trim()}),b},constructTokenTextLeftToRight:function(){var a=this.getTokens(),b="";return _.each(a,function(a){var c=a.getTokenData(),d=c.text;b+=" "+d,b=b.trim()}),b},getTokenInputValue:function(){var a=this.constructTokenText();return(a+" "+this.getInputValue()).trim()},getInputValue:function(){return this.getInputField().getValue().trim()},setTokenValue:function(a){var b=a;if(this.savedTokens.length>0)return this.clearTokens(),this.addTokensAndUpdateInputView(this.savedTokens),this.clearSavedTokens(),"";var c=this.getTokens(),d=_.clone(c);return _.each(d,function(a){var c=a.getTokenData(),d=c.text,e=new RegExp("(^|\\s)"+d+"(?=\\s|$)");b.match(e)?b=b.replace(d,""):this.removeToken(a),b=b.trim()}.bind(this)),b.trim()},setInputValue:function(a){this.getInputField().setValue(a)},onTokenModuleWrapperClick:function(a){var b=$(a.currentTarget),c=b.find(".Module").first(),d=this.getChildByElement(c);if(d&&(d===this.selectedToken?this.unselectSelectedToken():this.selectToken(d),a.stopPropagation()),this.options.hide_tokens_on_focus){var e=this._findIndexSelectedToken();this.setEditingTokenText(),e>=0&&(_.defer(function(){this.getInputField().focus(),this.getInputField().setCursorPosition(e)}.bind(this)),this.unselectSelectedToken())}},getTokens:function(){return this.tokens},onInputKeydown:function(a){var b=a.keyCode,c=$(a.target),d=c[0].selectionEnd,e=_.indexOf(this.tokens,this.selectedToken);switch(b){case P.keyCode.LEFT:if(0!==d)break;if(!this.tokens.length)break;this.selectedToken?0!==e?this.selectAdjacentToken(!0):this.unselectSelectedToken():this._handleNoSelectedTokenKeydown(!1);break;case P.keyCode.RIGHT:this.selectedToken&&(e!==this.tokens.length-1?this.selectAdjacentToken(!1):this.unselectSelectedToken(),a.preventDefault());break;case P.keyCode.BACKSPACE:if(0===d)if(a.preventDefault(),this.selectedToken){var f=this.selectedToken;this.unselectSelectedToken(),this.removeToken(f),this._shouldSelectOnBackspaceKeydown=!1,this.getInputField().focus()}else this.removeToken(_.last(this.tokens))}},onInputKeyup:function(a){var b=a.keyCode;return b!==P.keyCode.LEFT&&b!==P.keyCode.RIGHT&&b!==P.keyCode.BACKSPACE?void this.unselectSelectedToken():(a.preventDefault(),this._shouldSelectOnBackspaceKeydown=!0,void a.stopPropagation())},_handleNoSelectedTokenKeydown:function(a){var b;b=a?_.first(this.tokens):_.last(this.tokens),this.selectToken(b)},selectAdjacentToken:function(a){var b,c=_.indexOf(this.tokens,this.selectedToken);b=-1!==c?a?this.tokens[c-1]:this.tokens[c+1]:a?_.last(this.tokens):_.first(this.tokens),b||(b=null),this.selectToken(b)},getInputFieldValue:function(){var a=this.getInputField(),b=a.getValue();return b},selectToken:function(a){this.selectedToken&&this.selectedToken.getContent().removeClass(this.CssClassName.TOKEN_SELECTED),this.selectedToken=a,a&&this.selectedToken.getContent().addClass(this.CssClassName.TOKEN_SELECTED),this.updateTokenizedInputView()},_findIndexSelectedToken:function(){if(this.selectedToken){for(var a=_.indexOf(this.tokens,this.selectedToken),b="",c=0;c<=a;c++)b+=" "+this.tokens[c].getTokenData().text;return b.trim().length}return-1},unselectSelectedToken:function(){this.selectedToken&&(this.selectedToken.getContent().removeClass(this.CssClassName.TOKEN_SELECTED),this.selectedToken=null,this.updateTokenizedInputView())},getInputField:function(){return this.getChildById("input")},onTypeaheadItemSelected:function(a){var b=$.extend(!0,{},this.options.token_module),c=a.data.item.attributes;if(b.data=c,!b)throw new Error("TokenizedInput module needs a `token_module` option.");P.loadModule(b).then(function(a){a.renderExistingData(),this.addToken(a);var b=this.getInputField();b.clear(),b.focus()}.bind(this))},updateInputPlaceholder:function(){this.tokens&&this.tokens.length>0?this.getInputField().clearPlaceholder():this.getInputField().restorePlaceholder()},addTokensAndUpdateInputView:function(a){var b=a.map(function(a){return this.addToken(a)}.bind(this));Promise.all(b).then(this.updateTokenizedInputView)},addToken:function(a){var b=$('<li class="tokenizedItem tokenWrapper"></li>'),c=this.$(".inputToken");return b.insertBefore(c),this.insertChild(a,b),this.tokens.push(a),this.triggerEvent(P.CONST.EVENT_TOKEN_ADDED,a,!0),this.updateInputPlaceholder(),this.options.show_remove_all&&this.updateRemoveAll(),a.render()},removeToken:function(a){var b=_.indexOf(this.tokens,a);this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED,a,!0),-1!==b&&(this.tokens.splice(b,1),this.$(".tokenWrapper").eq(b).remove(),a.destroy()),this.updateInputPlaceholder(),this.updateTokenizedInputView(),this.options.show_remove_all&&this.updateRemoveAll()},clearTokens:function(){var a=this.getTokens();
if(a.length>0){var b=_.clone(a);_.each(b,function(a){this.removeToken(a)}.bind(this))}},clearSavedTokens:function(){this.savedTokens=[]},onRemoveAll:function(a){this.clearTokens(),this.clearSavedTokens(),this.getInputField().clear(),this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,null,!0),a.stopPropagation()},updateRemoveAll:function(){this.tokens.length>0?this.$(".removeAll").show():this.$(".removeAll").hide()}}),goog.provide("P.modules.TrademarkForm"),goog.require("P.Form"),goog.require("P.Module");var SELECTOR_AGENT_FIELDS=".agentFields",SELECTOR_TRANSFER_FIELD=".transferField";P.modules.TrademarkForm=P.Module.extend({onCreated:function(){this.onComplainantTypeChange=this.onComplainantTypeChange.bind(this),this.onTrademarkClaimSuccess=this.onTrademarkClaimSuccess.bind(this),this.onAddURLButtonClick=this.onAddURLButtonClick.bind(this)},onContentReady:function(){if(_.contains(["username","content","goods"],this.options.claim_type)){this.$("[name=complainant_type]").on("change",this.onComplainantTypeChange),this.$("[name=course_of_action]").on("change",this.onClaimTypeChange);var a=this.getChildById("addURL");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onAddURLButtonClick),this.complainantType=null,this.claimType=null;var b=new Date;this.$("#trademarkSignatureDate").val(b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()),this.setupForm()}},setupForm:function(){var a=this.$("form"),b={};this.form=new P.Form(a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onComplainantTypeChange:function(a){var b=$(a.target);if(b.is(":checked")){var c=b.val();this.complainantType=c,"agent"===c?this.showAgentFields():this.hideAgentFields()}},onClaimTypeChange:function(a){var b=$(a.target);if(b.is(":checked")){var c=b.val();this.claimType=c,"transfer"===c?$(SELECTOR_TRANSFER_FIELD).show():$(SELECTOR_TRANSFER_FIELD).hide()}},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.createResourceOptions(),c=this.getChildById("submitBtn");c.showLoading();var d=P.resourceFactory.create("TrademarkClaimResource",b);d.callCreate().then(this.onTrademarkClaimSuccess.bind(this)).fin(function(){c.hideLoading()})}},onTrademarkClaimSuccess:function(a){var b=a.resource_response.data,c={name:"ConfirmDialog",options:{claim_id:b,template:"trademark_claim_success"}};P.loadModule(c).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_DESTROYED,function(){this.navigate("/")})}.bind(this))},onAddURLButtonClick:function(){var a=this.$(".infringingURLs"),b=a.children().first().clone();b.find("input").removeAttr("id"),a.append(b)},showAgentFields:function(){this.$(SELECTOR_AGENT_FIELDS).show()},hideAgentFields:function(){this.$(SELECTOR_AGENT_FIELDS).hide()},createResourceOptions:function(){var a=_.omit(this.form.getData(),"complainant_type");a.claim_type=this.options.claim_type,a.is_owner="owner"===this.complainantType;var b=["infringing_content_urls","infringing_goods_urls"];return _.each(b,function(b){var c=a[b];_.isArray(c)&&(c=_.map(c,function(a){return a.trim()}),c=_.reject(c,function(a){return""===a}),a[b]=c.join(","))}),a}}),goog.provide("P.modules.TrademarkFormSelector"),goog.require("P.Module"),P.modules.TrademarkFormSelector=P.Module.extend({onContentReady:function(){this.$("[name=claim_type]").on("change",this.onClaimTypeChange.bind(this))},onClaimTypeChange:function(a){var b=$(a.target);if(b.is(":checked")){var c=b.val();this.navigate("/about/trademark/form/"+c+"/")}}}),goog.provide("P.modules.Tutorial"),goog.require("P.Module"),P.modules.Tutorial=P.Module.extend({onContentReady:function(){this.manager=P.TutorialManager.instance(),this.childListen(P.CONST.EVENT_NEXT,this.manager._next.bind(this.manager)),this.childListen(P.CONST.EVENT_PREVIOUS,this.manager._previous.bind(this.manager)),this.manager.startTutorial(this.options.tutorial_name,{moduleContainer:this})},onDestroyed:function(){this.manager.stopTutorial()}}),goog.provide("P.modules.TweetButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.TweetButton=P.modules.Button.extend({onClick:function(){var a=this.options.ga_category||"share_twitter";P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),this.openWebIntent(),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)},openWebIntent:function(){var a=this.getWindowUrl(),b=550,c=420;return P.getWindowManager().open(a,null,b,c)},getWindowUrl:function(){var a="https://twitter.com/intent/tweet?via=pinterest",b={};return this.options.tweet_path&&(b.url=encodeURIComponent(P.absolutify(this.options.tweet_path))),this.options.tweet_text&&(b.text=encodeURIComponent(this.options.tweet_text)),_.reduce(b,function(a,b,c){return a+"&"+c+"="+b},a)}}),goog.provide("P.modules.Typeahead"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.TypeaheadProvider");var DATA_MODEL_CID="cid",MODEL_ATTR_HIGHLIGHTED="highlighted",templateMap={search:"default_item",searchV2:"default_item_2",userSelect:"send_pin",title:"title",map:"add_pin_to_map",place:"place",hint_no_city:"hint_no_city",hint_specific_city:"hint_specific_city",user_circle_avatar:"user_circle_avatar",interest:"interest",emailSelect:"send_to_email",socialConnect:"social_connect"},ItemView=Backbone.View.extend({tagName:"li",initialize:function(a){this.options=a,this.$el.attr("tabindex",this.options.tabIndex?1:!1);var b=this.options.template;this.templateName=b,this.model.bind("change",this.onChange,this)},appendToElement:function(a){this.render(),a.append(this.$el)},onChange:function(){return this.render(),this.model.attributes.type===P.CONST.TYPEAHEAD_TYPE_GPLUS_NON_PINNER&&this.options.container.triggerEvent(P.CONST.EVENT_TYPEAHEAD_RENDER_DONE,this.model.attributes.id,!0),this},_getTemplateFilePath:function(){return"app/common/modules/components/Typeahead/"+this.templateName+".nunjucks"},render:function(){var a=this._getTemplateFilePath(),b=P.nunjucks.render(a,this.model.toJSON());return this.$el.html(b).toggleClass(P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED,!!this.model.get(MODEL_ATTR_HIGHLIGHTED)).data(DATA_MODEL_CID,this.model.cid),this}});P.modules.Typeahead=P.Module.extend({events:{"click .results li":"onResultClick","click .results .remove":"onRemoveResult",mousedown:"onMousedown","mouseenter .results li":"onResultMouseEnter",mouseleave:"onMouseleave",onchange:"onChange"},CssClassName:{BUTTON_TEXT:"buttonText",OPEN:"open",SHOW_RECENT_QUERIES:"showRecentQueries"},_isOpen:!1,items:[],appendedStaticItems:[],prependedStaticItems:[],onCreated:function(){this.typeahead=new P.TypeaheadProvider(this.options),this.listen(this.typeahead,P.CONST.EVENT_DATA,this.onTypeaheadData),this.listen(this.typeahead,P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.VALID_SECTIONS={board:{title:P._("BOARDS"),getUrl:function(a){return"/search/boards/?q="+a},getQuery:function(a){return a}},user:{title:P._("PINNERS"),getUrl:function(a){return"/search/people/?q="+a},getQuery:function(a){return a}},recent_query:{title:P._("RECENT SEARCHES"),getUrl:function(){return null},getQuery:function(){return" "}},trending:{title:P._("TRENDING"),getUrl:function(){return null},getQuery:function(){return" "}}}},onChildButtonClick:function(a){var b=a.target;b&&b.isCancelButton()&&(a.stopPropagation(),this.hide())},onSearchStart:function(a){this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,a,!0)},removeCacheForTerm:function(a){this.typeahead.removeCacheForTerm(a)},getResource:function(){return this.typeahead.getResource()},setPrependedStaticItems:function(a,b){this.prependedStaticItems=a,this._updateItemsToRender(),b&&this.renderResults()},resetPrependStaticItems:function(a){this.setPrependedStaticItems([],a)},setAppendedStaticItems:function(a,b){this.appendedStaticItems=a,this._updateItemsToRender(),b&&this.renderResults()},resetAppendedStaticItems:function(a){this.setAppendedStaticItems([],a)},onContentReady:function(){this.$results=this.$(".results")},getItemCount:function(){return this.itemsToRender.count},highlightItemWithAttributeAndValue:function(a,b){var c=this.itemsToRender,d=_.find(c,function(c){return c.get(a)===b});d&&this.highlight(d)},focusHighlighted:function(){this.$("."+P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED).focus()},getHighlightedItem:function(){return this.highlightedItem},search:function(a){this.lastTerm=a,this.typeahead.search(a)},setAutocompleteScope:function(a){this.typeahead.setAutocompleteScope(a)},renderResults:function(){var a=[];if(a=_.map(this.itemsToRender,function(a){return this.createItemView(a)}.bind(this)),!a.length)return void this.hide();if(this.$results.empty(),_.each(a,function(a){a.appendToElement(this.$results)}.bind(this)),!this.options.bypass_maxheight){var b=this.getScrollableElement().scrollTop(),c=P.Viewport.height-P.CONST.PIN_MARGIN-this.$results.offset().top+b;this.$results.css({"max-height":c,"overflow-y":"auto"})}this.show()},emptyResults:function(){this.itemsToRender=[],this.$results.empty()},createItemView:function(a){var b=P.experiments.instance.inExperimentGroups("web_search_autocomplete",["employees","enabled"]),c=b?templateMap.searchV2:templateMap.search,d=this.options.template?templateMap[this.options.template]:c,e=this.options.use_tab_index;a.attributes&&a.attributes.template&&(d=templateMap[a.attributes.template]);var f=new ItemView({model:a,container:this,template:d,tabIndex:e});return f},hide:function(){this._isOpen=!1,this.highlightedItem=null,this.select(null),this.$el.removeClass(this.CssClassName.OPEN),$(".mainContainer .typeaheadOverlay").remove(),this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HIDDEN,null,!0)},show:function(){if(this._isOpen=!0,this.$el.addClass(this.CssClassName.OPEN),0===$(".mainContainer .typeaheadOverlay").length){var a=$('<div class="typeaheadOverlay" />');$(".mainContainer").append(a)}this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_SHOWN,null,!0)},isOpen:function(){return this._isOpen},getLastTerm:function(){return this.lastTerm},selectElement:function(a){var b=this.getItemByElement(a);return this.select(b)},getSelectedItem:function(){return this.selectedItem},select:function(a){return a=a||this.highlightedItem,a&&a.get("selectable")===!1?null:(a&&this.triggerEvent(P.CONST.EVENT_ITEM_SELECTED,{item:a},!0),this.selectedItem=a,a)},highlightUp:function(){var a=this.highlightedItem,b=this.itemsToRender,c=a?_.indexOf(b,a)-1:b.length-1,d=b[c];return d&&d.get("selectable")===!1&&(--c,c<0&&(c=b.length-1)),this.highlight(b[c])},highlightDown:function(){var a,b=this.highlightedItem,c=this.itemsToRender;if(b){var d=_.indexOf(c,b);a=d===c.length-1?0:d+1}else a=0;var e=c[a];return e&&e.get("selectable")===!1&&++a,this.highlight(c[a])},highlightElement:function(a){var b=null;return a&&a[0]&&(b=this.getItemByElement(a)),this.highlight(b)},highlight:function(a){return a=a||null,a===this.highlightedItem?a:(this.highlightedItem&&this.highlightedItem.set(MODEL_ATTR_HIGHLIGHTED,!1),this.highlightedItem=a,a&&a.set(MODEL_ATTR_HIGHLIGHTED,!0),this.triggerEvent(P.CONST.EVENT_ITEM_HIGHLIGHTED,{item:a},!0),a)},getItemByElement:function(a){var b=a.data(DATA_MODEL_CID);return _.find(this.itemsToRender,function(a){return a.cid===b})},abortSearch:function(){this.typeahead.abortSearch()},prefetch:function(){this.typeahead.prefetch()},onMousedown:function(a){$(a.target).is("."+this.CssClassName.BUTTON_TEXT)?a.stopPropagation():this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,null,!0)},onMouseleave:function(){this.isOpen()&&this.highlightElement()},onRemoveResult:function(a){a.stopPropagation(),a.preventDefault();var b=$(a.currentTarget),c=b.parents("li").data(DATA_MODEL_CID),d=b.attr("data-query");if(d){var e=P.resourceFactory.create("TypeaheadClearRecentResource",{query:d});e.callDelete(),b.parents("li").remove(),this.items=this.items.filter(function(a){return a.query!==d}),this.itemsToRender=this.itemsToRender.filter(function(a){return a.cid!==c}),0===this.itemsToRender.length&&this.hide()}},onRemoveAllResults:function(a){a.stopPropagation(),a.preventDefault();var b=P.resourceFactory.create("TypeaheadClearRecentResource",{query:null});b.callDelete().then(function(){this.items=this.items.filter(function(a){return"recent_query"!==a.type}),this._updateItemsToRender(),this.renderResults()}.bind(this))},onResultClick:function(a){this.selectElement($(a.currentTarget)),a.stopPropagation()},onResultMouseEnter:function(a){this.highlightElement($(a.currentTarget))},_updateItemsToRender:function(){var a=this.getLastTerm(),b=this.prependedStaticItems.concat(this.items,this.appendedStaticItems),c=[],d={},e=P.experiments.instance.inExperimentGroups("web_search_autocomplete",["employees","enabled"]),f=null;b.forEach(function(a){var b=a.type,g=this.VALID_SECTIONS[b];if(g&&!d[b]&&e){var h={type:"title",label:g.title,url:g.getUrl(this.getLastTerm()),highlightLabel:g.getQuery(this.getLastTerm()),class_name:"titleItem"};c.push(h),d[b]=!0}f=a,c.push(a)}.bind(this)),this.itemsToRender=_.map(c,function(b,c){return b.tag=b.tag||"",b.resultIndex=c,b.enteredQuery=a,new Backbone.Model(b)})},onTypeaheadData:function(a){this.items=a.items,this._updateItemsToRender();var b=a.hint;this.hint=b,this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HINT,b,!0),this.renderResults(),this._triggerEvents()},_triggerEvents:function(){var a=this.getLastTerm(),b=0;a&&(b=a.length);var c=this.options.enable_recent_queries;if(0===this.itemsToRender.length||0===b){if(c)return void this.renderResults();this.hide(),this._triggerNoResultsReturned()}else this._triggerResultsReturned(),this.renderResults()},_renderEmptyState:function(){var a=[],b={},c=P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE;b[c]=!0,a.push(b),this.items=a,this._updateItemsToRender(),this._triggerEvents(),this.renderResults()},_triggerNoResultsReturned:function(a){this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,null,!0),a&&this._renderEmptyState()},_triggerResultsReturned:function(){var a={count:this.itemsToRender.length,items:this.itemsToRender};this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,a,!0)},focus:function(){}}),goog.provide("P.modules.UnauthBanner"),goog.require("P.Module"),P.modules.UnauthBanner=P.Module.extend({events:{"click .bannerOpenInApp":"onOpenInApp","click .continueSignupButton":"onContinueSignup","click .closeBanner":"onCloseBanner"},onOpenInApp:function(){P.nativeApp.setOpenInAppPreference(),this.triggerEvent(P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP,null,!0)},onContentReady:function(){this.destroyIfEmpty()||(this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.$(".emailLogin").attr("href",P.getLoginUrl()),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.setContext(this.data))},setContext:function(a){var b=this.getImageSrc(a);b&&(P.experiments.instance.activateAndPersistExperiment("contextual_banner"),P.experiments.instance.inExperimentGroups("contextual_banner",["enabled"])&&this.$(".contextImage").css("background-image","url("+b+")").show())},getImageSrc:function(a){switch(a.type){case"user":return a.image_medium_url;case"pin":return a.images["236x"].url;case"board":return a.image_cover_url;case"category":return a.images["45x"].url;case"interest":return a.images["474x"].url}},onCloseBanner:function(){this.destroy()},onContinueSignup:function(){return P.signupModalManager.showInlineSignupModalOnButtonClick("ContinueSignupButton")},onButtonClick:function(a){var b=a.target;"emailSignup"===a.target.id&&(this.navigate(P.url.appendQueryString(b.getNavigateUrl(),{prev:window.location.href})),a.stopPropagation())},openInApp:function(){P.nativeApp.setOpenInAppPreference(),this.triggerEvent(P.CONST.EVENT_OPEN_IN_APP,null,!0)},onChildNavigate:function(a){(-1!==a.data.url.indexOf("/login/")||-1!==a.data.url.indexOf("/join/"))&&(a.data.url=a.data.url+"?prev="+window.location.pathname)}}),goog.provide("P.modules.UnauthHomePage"),goog.require("P.Module"),goog.require("P.modules.BackgroundImage"),goog.require("P.modules.InlineSignup"),P.modules.UnauthHomePage=P.modules.InlineSignup.extend({events:{"click .openInApp":"openInApp"},openInApp:function(){this.triggerEvent(P.CONST.EVENT_OPEN_IN_APP,null,!0)},onContentReady:function(){P.modules.InlineSignup.prototype.onContentReady.call(this),this.facebookTooltip=this.$(".facebookTooltip"),P.getQueryStringParams().reloadToLogin&&window.setTimeout(function(){P.changeWindowLocation("/")},1e3),P.trackRegisterAction("unauth_home"),this.$(".inspiredSearchBackgroundContainer").length>0&&this.setupInspiredWall(),window.innerHeight<680&&P.getWindowManager().resizeViewPort(750,680),this.extraData&&this.extraData.pinit_landing&&P.trackRegisterAction("unauth_pinit_landing"),this.setMultiStepHeader(".title",{step1:this.story.title,step2:this.extraData.secondStepMessage})},hideFacebookTooltip:function(){this.facebookTooltip.fadeOut(500)},setupInspiredWall:function(){this.story=this.extraData.story,this.inspiredSearchContentWrapper=this.$(".inspiredSearchContentWrapper"),this.setInspiredStory()},setInspiredStory:function(){var a=this.getChildById("bgImage_"+this.story.story_id);a.setActive(!0),this.loadedBackgrounds||(this.loadedBackgrounds=!0,a.setNewImage(this.story.bg_color,this.story.bg_image),this.inspiredSearchContentWrapper.css("background-image","url("+this.story.bg_dialog_image+")"))}}),goog.provide("P.modules.UnauthLoggedOutHomePage"),goog.require("P.Module"),P.modules.UnauthLoggedOutHomePage=P.modules.InlineSignup.extend({}),goog.provide("P.modules.UnblockButton"),goog.require("P.Module"),P.modules.UnblockButton=P.Module.extend({events:{click:"onClick"},onUserUnblockSuccess:function(){var a={name:"ConfirmDialog",options:{template:"block_unblock_user_success",name:this.options.full_name,action:"unblocked"}};_.extend(a.options,this.options.dialog_options),P.loadModule(a).then(function(a){this.showInModal(a,{can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,this.onUnblockConfirm)}.bind(this))},onUnblockConfirm:function(){this.destroy()},onClick:function(){P.trackGAEvent("user_unblock",P.CONST.GA_ACTION_CLICK);var a=this.options.user_id;this.showLoading();var b=P.resourceFactory.create("UserBlockResource",{blocked_user_id:this.options.user_id});b.callDelete().then(function(){P.trackGAEvent("user_unblock",P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED),this.onUserUnblockSuccess()}.bind(this),function(){P.trackGAEvent("user_unblock",P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))}}),goog.provide("P.modules.User"),goog.require("P.Module");var VIEW_TYPE_FOLLOW_FRIENDS_ITEM="followFriendsItem",VIEW_TYPE_GRID_ITEM="gridItem";P.modules.User=P.Module.extend({events:{"click .dismiss":"onDismissClick",click:"onClick"},CssClassName:{CONTACT_CONFIRMED:"contactConfirmed",IS_CHECKED:"checked"},getLoadingSpinnerOptions:function(){var a=P.Module.prototype.getLoadingSpinnerOptions.call(this);return this.options.view_type===VIEW_TYPE_FOLLOW_FRIENDS_ITEM?_.extend(a,{size:P.Spinner.Size.SMALL}):a},getProfileImage:function(){var a;switch(this.options&&this.options.view_type){case"userSelect":a=this.$(".profileImage");break;default:return}return a.attr("src")},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onUserFollow,a[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onUserUnfollow;var b=this.getUserId();this.pubsubSubscribe(b,a)},onUserFollow:function(){this.options.view_type===VIEW_TYPE_FOLLOW_FRIENDS_ITEM&&this.$el.addClass(this.CssClassName.CONTACT_CONFIRMED),this.triggerEvent(P.CONST.EVENT_USER_FOLLOW,null,!0),this.updateFollowCounts()},onUserUnfollow:function(){this.triggerEvent(P.CONST.EVENT_USER_UNFOLLOW,null,!0),this.updateFollowCounts()},updateFollowCounts:function(){this.options.view_type&&this.options.view_type!==VIEW_TYPE_GRID_ITEM||this.render()},onDismissClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},getUserId:function(){return this.data&&this.data.id},setChecked:function(a){if("userCheckableSelectView"===this.options.view_type){var b=this.$(".selectCheck");a?b.addClass(this.CssClassName.IS_CHECKED):b.removeClass(this.CssClassName.IS_CHECKED)}},onClick:function(){if("userSelect"===this.options.view_type&&this.triggerEvent(P.CONST.EVENT_USER_CLICK,null,!0),"userCheckableSelectView"===this.options.view_type){var a=this.$(".selectCheck");a.toggleClass(this.CssClassName.IS_CHECKED);var b={user_id:this.getUserId(),is_following:a.hasClass(this.CssClassName.IS_CHECKED)};this.triggerEvent(P.CONST.EVENT_USER_CLICK,b,!0)}}}),goog.provide("P.modules.UserAppSettings"),goog.require("P.Module"),P.modules.UserAppSettings=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.target.id;-1!==b.indexOf("revokeButton")&&this.showConfirmation(b)},onRevokeConfirm:function(a){var b=this.getChildById(a),c=a.replace("revokeButton",""),d=P.resourceFactory.create("OAuthUserAuthorizationsResource",{consumer_id:c});b.showLoading(),d.callDelete().then(function(){this.render()}.bind(this)).fin(function(){b.hideLoading()})},showConfirmation:function(a){var b={name:"ConfirmDialog",options:{template:"revoke_app_access"}};P.loadModule(b).then(function(b){this.showInModal(b),this.listen(b,P.CONST.EVENT_CONFIRM,function(){this.onRevokeConfirm(a)})}.bind(this))}}),goog.provide("P.modules.UserBlock"),goog.require("P.Form"),goog.require("P.Module"),P.modules.UserBlock=P.Module.extend({events:{"click .cancelButton":"onCancelButtonClick"},onContentReady:function(){this.form=new P.Form(this.$("form"),[]),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.target;if(b){var c=this.options.blocked_by_me?"user_unblock":"user_block";"cancelButton"===b.id?P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_CANCEL):"submitButton"===b.id&&P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_SUBMIT)}},onSubmitValidated:function(a){a.errors[0]||this.blockUser()},onUserBlockSuccess:function(){var a={name:"ConfirmDialog",options:{template:"block_unblock_user_success",name:this.options.full_name,action:"blocked"}};P.loadModule(a).then(function(a){this.showInModal(a,{can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,this.onBlockConfirm)}.bind(this))},onBlockConfirm:function(){P.getModalManager().removeAllModals();var a=P.getCurrentUrl().split("/")||[];a[1]&&a[1]===this.options.username&&this.navigate("/")},blockUser:function(){var a=this.getChildById("submitButton"),b=this.options.user_id;a.showLoading();var c={blocked_user_id:b},d=P.resourceFactory.create("UserBlockResource",c),e=this.options.blocked_by_me?"user_unblock":"user_block";(this.options.blocked_by_me?d.callDelete():d.callCreate()).then(function(){P.trackGAEvent(e,P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_BLOCKED),this.onUserBlockSuccess()}.bind(this),function(){P.trackGAEvent(e,P.CONST.GA_ACTION_ERROR)}).fin(function(){a.hideLoading()})},onCancelButtonClick:function(){this.destroy()}}),goog.provide("P.modules.UserBoardFollow"),goog.require("P.Module");var USER_BOARD_FOLLOW_CLOSE_DELAY=7e3;P.modules.UserBoardFollow=P.Module.extend({CssClassName:{FOLLOWED:"followed",HIDDEN:"hidden"},onContentReady:function(){var a=this.getChildById("followButton");a&&this.listen(a,"toggleFollow",function(){a.getState()?(this.$(".UserFollowPinsPreview").addClass(this.CssClassName.FOLLOWED),this.$(".userBoardFollowButton").addClass(this.CssClassName.HIDDEN),this.$(".postUnFollow").addClass(this.CssClassName.HIDDEN),this.$(".postFollow").removeClass(this.CssClassName.HIDDEN),P.setTimeout(function(){window.close()},USER_BOARD_FOLLOW_CLOSE_DELAY)):this.$(".postUnFollow").removeClass(this.CssClassName.HIDDEN)});var b=this.$(".userBoardFakeHeader"),c=this.getChildByModuleName("UserFollowPinsPreview");if(b.length&&c){var d=b.height();c.setHeight(P.Viewport.height-d)}}}),goog.provide("P.modules.UserBoardInvites"),goog.require("P.Module"),P.modules.UserBoardInvites=P.Module.extend({onContentReady:function(){this.destroyIfEmpty(),this.pagedGrid=this.getChildById("pagedGrid"),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged)},onChildRemoved:function(){this.destroyIfEmpty()},onChildContentChanged:function(){this.pagedGrid.hasItems()||this.pagedGrid.destroy()},isEmpty:function(){return!this.children.length}}),goog.provide("P.modules.UserChangePassword"),goog.require("P.Form"),goog.require("P.Module");var changePasswordSubmitButtonId="changePasswordSubmit";P.modules.UserChangePassword=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var a={message:" "},b={"new":[P.Validator.Required(a),P.Validator.ContainsOnlyAscii({message:P.string.common.asciiPasswordError}),P.Validator.Password()],new_confirm:[P.Validator.Required(a),P.Validator.EqualTo({targetFieldName:"new",message:P._("Passwords don't match")})]};this.extraData.has_password&&(b.old=[P.Validator.Required(a)]),this.form=new P.Form(this.$form,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var c=this.getChildById("forgotPasswordButton");c&&this.listen(c,P.CONST.EVENT_BUTTON_CLICK,this.onForgotPasswordClick)},onSubmitValidated:function(a){var b=this.getChildById(changePasswordSubmitButtonId);a.errors[0]||(b.showLoading(!0),this.changePassword())},changePassword:function(){this.hideLoading(!0);var a=function(){if(this.isInModal()){var a={name:"ConfirmDialog",options:{template:"change_password_success"}},b=function(){this.triggerEvent("success",this),this.destroy(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD,this.extraData.render_social_networks)}.bind(this);P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,b)}.bind(this))}else this.navigate("/")}.bind(this),b=$("form",this.$el),c={new_password:b.find("[name=new]").val(),new_password_confirm:b.find("[name=new_confirm]").val()};this.extraData.has_password&&(c.old_password=b.find("[name=old]").val());var d=P.resourceFactory.create("UserPasswordResource",c);d.callUpdate().then(a).fin(function(){var a=this.getChildById(changePasswordSubmitButtonId);a.hideLoading()}.bind(this))},onForgotPasswordClick:function(){P.trackGAEvent("forgot_password",P.CONST.GA_ACTION_CLICK),this.showLoading();var a=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username}),b=function(){P.trackGAEvent("forgot_password",P.CONST.GA_ACTION_SUCCESS);var a={name:"ConfirmDialog",options:{template:"change_password"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.destroy)}.bind(this))}.bind(this),c=function(){this.hideLoading()}.bind(this),d=function(){P.trackGAEvent("forgot_password",P.CONST.GA_ACTION_ERROR)};a.callCreate({showError:!1}).then(b,d).fin(c)}}),goog.provide("P.modules.UserContact"),goog.require("P.Module"),P.modules.UserContact=P.Module.extend({events:{"click .dismiss":"onDismissClick","click .contactWrapper":"onAction"},CssClassName:{CONTACT_CONFIRMED:"contactConfirmed"},onDismissClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},getUserId:function(){return this.user.hash_id},onContentReady:function(){this.user=this.options.contact_info},onInviteSuccess:function(a){a&&(this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0),this.$el.addClass(this.CssClassName.CONTACT_CONFIRMED))},onAction:function(){return"facebook"===this.user.network?P.Invite.userInviteFacebook(this.user.id,this.onInviteSuccess.bind(this)):"email"===this.user.id_type&&P.Invite.userInviteEmail(this.user.id,this.onInviteSuccess.bind(this)),!1}}),goog.provide("P.modules.UserDropdown"),goog.require("P.Module"),goog.require("P.Settings"),goog.require("P.fb"),P.modules.UserDropdown=P.Module.extend({events:{"click .reportBug":"openReportBugModal","click .blockUser":"onBlockUser","click .sendProfile":"sendProfile","click .sendMessage":"sendUserMessage","click .userMenuFindBoards":"openFindBoards","click .userMenuCreateBoard":"openCreateBoard","click .userMenuAddPin":"openAddPin","click .userMenuUploadPin":"openUploadPin","click .userMenuEditProfile":"openEditProfile","click .userMenuMakeAWidget":"openMakeAWidget","click .settings":"onSettingsClick","click .userMenuMakeABoardWidget":"openMakeABoardWidget","click .sendBoard":"sendBoard","click .shareBoardOnFacebook":"onClickShareBoardOnFacebook"},onSettingsClick:function(a){if(a.stopPropagation(),a.preventDefault(),P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(this);else if(P.autologin.checkForAutologin()){var b=P._("To get to your settings, please take a second to confirm it's really you.");P.autologin.showLoginErrorDialog(this,b)}else this.navigate("/settings/")},getFindFriendsElement:function(){return this.$(".userMenuFindFriends").parent().eq(0)},getMyBoardsElement:function(){return this.$(".myBoards").parent().eq(0)},getFindBoardsElement:function(){return this.$(".userMenuFindBoards").parent().eq(0)},openFindBoards:function(){var a={name:"FastFollow",resource:{name:"UserResource",options:{username:P.currentUser.get("username"),field_set_key:"fast_follow"}},options:{post_orientation:!0}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a,{can_dismiss:!0,container_class:"fastFollowContainer"})}.bind(this)),!1},openReportBugModal:function(a){a.preventDefault();var b={name:"ReportBug",options:{shrinkToFit:!0}};return this.showLoading(),P.loadModule(b).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},onBlockUser:function(){var a=this.options.user,b={name:"UserBlock",options:{full_name:a.full_name,first_name:a.first_name,username:a.username,blocked_by_me:a.blocked_by_me,user_id:a.id}};return this.showLoading(),P.loadModule(b).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},sendProfile:function(a){if(a.stopPropagation(),a.preventDefault(),P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(this);else{var b=this.options.user,c={name:"SendPinner",options:{class_name:"modal",object_id:b.id,object_image_url:b.image_large_url,object_description:b.bio,object_url:"/"+b.username}};this.showLoading(),P.loadModule(c).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this))}},sendUserMessage:function(a){if(P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(this);else{var b=[this.options.user.id];P.getConversationsManager().sendMessageToUsers(b,[],{text:null}).then(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.render()}.bind(this)),a.stopPropagation()}},openCreateBoard:function(){var a={name:"BoardCreate",options:{}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},openAddPin:function(){var a={name:"AddPinURL",options:{shrinkToFit:!0,show_title:!0}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},openUploadPin:function(){var a={name:"PinUploader",options:{shrinkToFit:!0,show_title:!0}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},openEditProfile:function(){var a={name:"UserEdit",resource:{name:"UserSettingsResource",options:{}},options:{user_id:this.options.user_id}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},openMakeAWidget:function(){var a={name:"EmbedPinner",options:{user:this.options.user}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},openMakeABoardWidget:function(){var a={name:"EmbedBoard",options:{board:this.options.board,class_name:"v2"}};return this.showLoading(),P.loadModule(a).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this)),!1},sendBoard:function(a){if(a.preventDefault(),P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(this);else{var b=this.options.board,c={name:"SendBoard",options:{class_name:"newBoardHeaderStyle",object_id:b.id,object_image_url:b.image_cover_url,object_description:b.description,object_url:b.url}};
this.showLoading(),P.loadModule(c).then(function(a){this.hideLoading(),this.showInModal(a)}.bind(this))}return!1},onClickShareBoardOnFacebook:function(){if(P.currentUser.isAuthenticated()){var a=this.options.board,b=P.Settings.CANONICAL_MAIN_URL+a.url,c={object_type:"board",type:"feed",object_id:a.id,path:b};P.FacebookDialog.open(c),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}return!1}}),goog.provide("P.modules.UserEdit"),goog.require("P.Form"),goog.require("P.Module"),P.modules.UserEdit=P.Module.extend({CssClassName:{RESTRICT_WIDTH:"restrictWidth"},onContentReady:function(){var a={first_name:[P.Validator.Required()],username:[P.Validator.Required()],about:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})],impressum_url:[P.Validator.URL()],website_url:[P.Validator.URL()]};this.data.is_partner&&(a.business_name=[P.Validator.Required()]),this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var b={};b[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onImageUploaded,this.pubsubSubscribe(this.options.user_id,b)},onImageUploaded:function(a,b,c){if(c&&c.data&&c.data.profile_image_url){var d=this.$(".profileImage");d.attr("src",c.data.profile_image_url),d.on("load",function(){d.toggleClass(this.CssClassName.RESTRICT_WIDTH,d.height()>d.width())}.bind(this))}},onSubmitValidated:function(a){a.errors[0]||this.saveProfile()},getFormData:function(){var a=this.$("form").serializeArray(),b={};return _.each(a,function(a){b[a.name]=a.value}),b},getSaveResource:function(a){return P.resourceFactory.create("UserSettingsResource",a)},saveProfile:function(){var a=this.getFormData(),b=this.getChildById("submitButton"),c=this.extraData.currentUsername,d=a.username&&c!==a.username;b.showLoading(),this.getSaveResource(a).callUpdate().then(function(){var b=this.isInModal()&&!d;if(b)P.pubsub.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),this.destroy();else{var c="/"+a.username+"/";this.navigate(c)}}.bind(this)).fin(function(){b.hideLoading()})}}),goog.provide("P.modules.UserEditEmail"),goog.require("P.Form"),goog.require("P.Module"),P.modules.UserEditEmail=P.Module.extend({onContentReady:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{email:[P.Validator.Required()]}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){a.errors[0]||this.updateEmail()},updateEmail:function(){var a={},b=this.form.getValue("email");this.data.email.trim()!==b.trim()?a.email=b:a.email_bounced=!1;var c=P.resourceFactory.create("UserSettingsResource",a);c.callUpdate().then(function(a){var b=a.resource_response.data;if(this.isInModal()){var c;c=P._(b.email_changing_to?"Thanks! Your email update is pending. You should receive a confirmation email soon.":"Thanks! Your email has been updated. You should receive a confirmation email soon."),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_NAG_UPDATED,c),this.destroy()}}.bind(this))}}),goog.provide("P.modules.UserEditVerifyWebsite"),goog.require("P.Module"),P.modules.UserEditVerifyWebsite=P.Module.extend({events:{'keyup input[name="website_url"]':"onInput",'input input[name="website_url"]':"onInput"},CssClassName:{HIDDEN:"hidden"},onContentReady:function(){this.originalWebsite=this.data&&this.data.website_url?this.data.website_url:"";var a={};a[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a);var b=this.getChildById("verifyWebsite");this.listen(b,P.CONST.EVENT_BUTTON_CLICK,this.onClick)},onUserUpdated:function(){this.render()},onInput:function(a){var b=$(a.target).val(),c=this.getChildById("verifyWebsite"),d=this.options.domain_verified&&b===this.originalWebsite;this.$(".verifiedDomainContainer").toggleClass(this.CssClassName.HIDDEN,!d),this.$(".verifyButton").toggleClass(this.CssClassName.HIDDEN,d),b?c.enable():c.disable()},showModalForDomain:function(){this.showLoading();var a={name:"DomainVerify",resource:{name:"DomainVerifyResource",options:{}}};P.loadModule(a).then(function(a){this.hideLoading();var b={show_api_error:!0};this.showInModal(a,b)}.bind(this))},onClick:function(){var a=this.$('input[name="website_url"]').val();if(a===this.originalWebsite)return void this.showModalForDomain(a);var b=this.getChildById("verifyWebsite");b.showLoading();var c=P.resourceFactory.create("UserSettingsResource",{website_url:a});c.callUpdate().then(function(){P.pubsub.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),this.showModalForDomain(a)}.bind(this)).fin(function(){b.hideLoading()})}}),goog.provide("P.modules.UserEducationGuide"),goog.require("P.modules.Tutorial"),goog.require("P.Module"),P.modules.UserEducationGuide=P.modules.Tutorial.extend({onContentReady:function(){this.manager=P.ExperienceTutorialManager.instance(),this.childListen(P.CONST.EVENT_NEXT,this.manager._next.bind(this.manager)),this.childListen(P.CONST.EVENT_PREVIOUS,this.manager._previous.bind(this.manager)),this.childListen(P.CONST.EVENT_DISMISS,this.manager._dismiss.bind(this.manager))}}),goog.provide("P.modules.UserEducationGuideDropdown"),goog.require("P.Module"),P.modules.UserEducationGuideDropdown=P.Module.extend({events:{"click .guide":"onClickGuide"},onContentReady:function(){if(P.experiments.instance.inExperimentGroups("improve_performance_of_click_processing",["enabled","employees_enabled"])){var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE]=this._onTutorialTriggerActive,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a)}else P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,function(a,b,c){this.options.guides=c?[c]:[],this.render()}.bind(this))},onClickGuide:function(){if(this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.options.guides&&0!==this.options.guides.length){var a=this.options.guides[0];a.showFlyout=!1,a.display_data.trigger="automatic",P.ExperienceTutorialManager.instance().startTutorial(a)}},_onTutorialTriggerActive:function(a,b,c){return this.options.guides=c?[c]:[],this.render()}}),goog.provide("P.modules.UserEducationGuideStep"),goog.require("P.Module"),P.modules.UserEducationGuideStep=P.Module.extend({}),goog.provide("P.modules.UserEducationGuideStepBase"),goog.require("P.Module"),goog.require("P.modules.StepBase"),goog.require("P.CONST"),P.modules.UserEducationGuideStepBase=P.modules.StepBase.extend({CssClassName:_.extend(P.modules.StepBase.prototype.CssClassName,{HIDE_CARD:"hideCard"}),onContentReady:function(){var a=this.options.step_type,b=a===P.CONST.StepTypes.TOOLTIP,c=b?"UserEducationGuideStep":"UserEducationGuideStacked",d=this.getCardModuleLoadOptions(c),e=this.getCardPositionModuleLoadOptions(c),f=b?e:d;P.loadModule(f).then(function(a){this.guideModule=a,this.appendChild(a),a.render()}.bind(this)),this.options.anchor&&(this.loadPulser(),this.childListen(P.CONST.EVENT_PULSER_CLICKED,function(){this.goToNextStep(),$(this.options.anchor).click()}),$(this.options.anchor).on("click.userEducationGuideAnchor",function(){this.goToNextStep()}.bind(this)))},goToNextStep:function(){$(this.options.anchor).off("click.userEducationGuideAnchor"),this.guideModule.$el.find(".guideStepContent").addClass(this.CssClassName.HIDE_CARD),window.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this),200)},onShow:function(a){this.isContextualExperience=!0,a&&a()},getCardModuleLoadOptions:function(a){var b={name:a,options:{body_html:this.options.body_html,stacked_cards:this.options.stacked_cards,step_type:this.options.step_type,anchor:this.options.anchor}};return b},getCardPositionModuleLoadOptions:function(a){var b={name:"UserEducationGuideTooltip",options:{module:this.getCardModuleLoadOptions(a),anchor:this.options.anchor,position_mode:"ANCHORED",position_point:this.options.position_point,hide_caret:!0,class_name:"active",fixed:!!this.options.fixed}};return b},loadPulser:function(){var a={name:"Pulser",options:{anchor:this.options.anchor,fixed:!!this.options.fixed}};P.loadModule(a).then(function(a){this.appendChild(a),a.render()}.bind(this))},getExperienceId:function(){return this.options.experienceID},getPlacementId:function(){return this.options.placementID}}),goog.provide("P.modules.UserEducationGuideTooltip"),goog.require("P.Module"),goog.require("P.modules.PositionModule"),P.modules.UserEducationGuideTooltip=P.modules.PositionModule.extend({CssClassName:_.extend(P.modules.PositionModule.prototype.CssClassName,{CARET_ON_LEFT:"caretOnLeft",CARET_IN_MIDDLE:"caretInMiddle",CARET_ON_RIGHT:"caretOnRight"}),onContentReady:function(){var a=P.Viewport,b=$(this.options.anchor),c=b.offset().left+b.outerWidth()/2;this.$el.addClass(c>a.width*(2/3)?this.CssClassName.CARET_ON_RIGHT:c<a.width*(1/3)?this.CssClassName.CARET_ON_LEFT:this.CssClassName.CARET_IN_MIDDLE)},render:function(){return new Promise(function(a){this.renderContainer();var b=function(){this.contentReady=!0,this.onContentReady(),a()}.bind(this);this.options.module?P.loadModule(this.options.module).then(function(a){this.insertChild(a,this.getPositionElement()),a.render().then(function(){this.positionModule(),b()}.bind(this))}.bind(this)):b()}.bind(this))}}),goog.provide("P.modules.UserEducationTriggerCard"),goog.require("P.Module"),P.modules.UserEducationTriggerCard=P.Module.extend({events:{click:"onClick"},onClick:function(){this.triggerEvent(P.CONST.EVENT_TRIGGER_FLYOUT_CLICKED,null,!0)}}),goog.provide("P.modules.UserFollowPinsPreview"),goog.require("P.Module"),P.modules.UserFollowPinsPreview=P.Module.extend({onContentReady:function(){if(this.data){this.$el.height(P.Viewport.height);var a=P.CONST.PIN_WIDTH,b=P.CONST.PIN_MARGIN,c=a+b,d=this._calculateNumColumns(a,b);this._pinSlotWrapper=this.$(".pinSlotWrapper"),this._pinSlotWrapper.width(d*c);for(var e=0;e<d;e++)this._pinSlotWrapper.append($('<span class="pinSlot slot"></span>'));this._pinSlots=this._pinSlotWrapper.children();for(var f=0,g=0;g<this.data.length;g++)if(this.data[g].images){var h=document.createElement("IMG");h.src=this.data[g].images["236x"].url,this._pinSlots[f%d].appendChild(h),f+=1}this._positionSlots(a,b)}},setHeight:function(a){this.$el.height(a)},_positionSlots:function(a,b){for(var c=0,d=500,e=a+b,f=0;f<this._pinSlots.length;f++)$(this._pinSlots[f]).css("left",c),$(this._pinSlots[f]).transition({top:"30px",duration:d}),c+=e,d+=500},_calculateNumColumns:function(a,b){var c=this.$el.width(),d=a+b;return Math.floor((c+1)/d)}}),goog.provide("P.modules.UserInfoBar"),goog.require("P.Module"),P.modules.UserInfoBar=P.Module.extend({CssClassName:{INFO_BAR_ACTIVE:"active"},onCreated:function(){this.listen(this,P.CONST.EVENT_NAVIGATE,this.onTabClick),this.childListen(P.CONST.EVENT_NAVIGATE,this.onTabClick)},onTabClick:function(a){var b=a.data.url;b&&this.selectTab(b)},selectTab:function(a){var b=this;this.$("a").each(function(){var c=$(this);c.toggleClass(b.CssClassName.INFO_BAR_ACTIVE,c.attr("href")===a)})}}),goog.provide("P.modules.UserNavigateButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.UserNavigateButton=P.modules.NavigateButton.extend({onContentReady:function(){var a=this.data.id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(a,b)}},onUserUpdated:function(){this.render()}}),goog.provide("P.modules.UserOrdersPage"),goog.require("P.Module"),P.modules.UserOrdersPage=P.Module.extend({}),goog.provide("P.modules.UserProfileContent"),goog.require("P.Module");var BOARDS_TAB="boards",PINS_TAB="pins";P.modules.UserProfileContent=P.Module.extend({onCreated:function(){var a={};a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onPinAdded,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},addTutorials:function(){if(this.options.tab===BOARDS_TAB){var a=P.Experiences.Placement.WEB_USER_PROFILE_TAKEOVER;P.ExperienceManager.instance().launchPlacedExperience(a,{user_id:this.data.id})}},onContentReady:function(){if(!this.data.board_count&&!this.data.secret_board_count){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onFirstBoardCreated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)}_.defer(this.addTutorials.bind(this)),this.followingContentGrid=this.getChildByModuleName("Grid"),this.childListen(P.CONST.EVENT_REFRESH_FOLLOWING_GRID,this.onRefreshFollowingGrid);var b=this.data,c=this._in_web_empty_state();switch(this.options.tab){case"boards":!b.board_count&&c&&this._log_empty_state_view(P.ContextLogging.ViewType.EMPTY_STATE,P.ContextLogging.ViewParameterType.USER_BOARDS);break;case"pins":!b.pin_count&&c&&this._log_empty_state_view(P.ContextLogging.ViewType.EMPTY_STATE,P.ContextLogging.ViewParameterType.USER_PINS);break;case"likes":!b.like_count&&c&&this._log_empty_state_view(P.ContextLogging.ViewType.EMPTY_STATE,P.ContextLogging.ViewParameterType.USER_LIKES);break;case"followers":!b.follower_count&&c&&this._log_empty_state_view(P.ContextLogging.ViewType.EMPTY_STATE,P.ContextLogging.ViewParameterType.USER_FOLLOWERS);break;case"following":!b.following_count&&c&&this._log_empty_state_view(P.ContextLogging.ViewType.EMPTY_STATE,P.ContextLogging.ViewParameterType.USER_FOLLOWING)}},_log_empty_state_view:function(a,b){var c={event_type:P.ContextLogging.EventType.VIEW,view_type:a,view_parameter:b},d=P.ContextEvent.fromPlainObject(c);P.ContextLogger.getInstance().addEvent(d)},_in_web_empty_state:function(){return P.experiments.instance.inExperimentGroups("web_empty_states",["enabled","employees"],!1)},onRefreshFollowingGrid:function(a){var b,c={};"navFollowedInterests"===a.data.following_tab?(b="InterestFollowingResource",c.view_type="followingView"):"navFollowedPinners"===a.data.following_tab?b="UserFollowingResource":"navFollowedBoards"===a.data.following_tab&&(b="BoardFollowingResource"),b&&(this.followingContentGrid.resource=P.resourceFactory.create(b,{username:a.target.options.username}),this.followingContentGrid.options.item_options=c,this.followingContentGrid.render())},onFirstBoardCreated:function(){this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED),this.render()},onPinAdded:function(a,b,c){if(this.options.tab===PINS_TAB&&c.board.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this.extraData.isOwnProfile){var d=this.getChildById("userPins");d?d.prependNewItems(1):this.render()}}}),goog.provide("P.modules.UserProfileFollow"),goog.require("P.Module");var USER_PROFILE_FOLLOW_CLOSE_DELAY=7e3;P.modules.UserProfileFollow=P.Module.extend({CssClassName:{FOLLOWED:"followed",HIDDEN:"hidden"},onContentReady:function(){var a=this.getChildById("followButton");a&&this.listen(a,"toggleFollow",function(){a.getState()?(this.$(".UserFollowPinsPreview").addClass(this.CssClassName.FOLLOWED),this.$(".userProfileFollowButton").addClass(this.CssClassName.HIDDEN),this.$(".postUnFollow").addClass(this.CssClassName.HIDDEN),this.$(".postFollow").removeClass(this.CssClassName.HIDDEN),P.setTimeout(function(){window.close()},USER_PROFILE_FOLLOW_CLOSE_DELAY)):this.$(".postUnFollow").removeClass(this.CssClassName.HIDDEN)});var b=this.$el.find(".userProfileFakeHeader"),c=this.getChildByModuleName("UserFollowPinsPreview");if(b.length&&c){var d=b.height();c.setHeight(P.Viewport.height-d)}}}),goog.provide("P.modules.UserProfileImageUploader"),goog.require("P.Module"),P.modules.UserProfileImageUploader=P.Module.extend({onContentReady:function(){var a=this.getChildById("uploader");this.listen(a,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(a,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError)},onUploadSuccess:function(a){P.trackGAEvent("user_profile_image_upload",P.CONST.GA_ACTION_SUCCESS),this.imageUrl=a.data.image_url,this.updateUserProfileImage()},onUploadError:function(a){P.trackGAEvent("user_profile_image_upload",P.CONST.GA_ACTION_ERROR);var b=a.data;P.showError(b)},getUserSettingsResource:function(){return P.resourceFactory.create("UserSettingsResource",{profile_image_url:this.imageUrl})},updateUserProfileImage:function(){this.showLoading();var a=this.getUserSettingsResource();a.callUpdate().then(function(a){this.onUpdateSuccess(a),this.hideLoading()}.bind(this))},onUpdateSuccess:function(a){var b=a.resource_response;b.data.profile_image_url=this.imageUrl,P.pubsub.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED,b),this.destroy()}}),goog.provide("P.modules.UserRegister"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.LoginBase"),P.modules.UserRegister=P.modules.LoginBase.extend({events:{"keyup .standardForm":"handleKeydown","click .continueButton":"submitFirstStep","click .signup":"submitSecondStep","click .toggleStep > span":"toggleMultiStep"},CssClassName:_.extend(P.modules.LoginBase.prototype.CssClassName,{ACTIVE:"active",HIDDEN:"hidden"}),onContentReady:function(){if(P.currentUser.isAuthenticated())return void this.redirect();if(Cookie.get(P.CONST.COOKIE_REGISTER_RESTRICT))return P.changeWindowLocation("/restricted/age/",!1);this.setupForm(),this.logContainerViewType(),this.$emailInput=this.$("input[name='email']"),this.$passwordInput=this.$("input[name='password']"),this.$userFullNameInput=this.$("#userFullName"),this.$userAgeInput=this.$("#userAge"),this.$userFullNameField=this.$("input[name='full_name']"),this.$userAgeField=this.$("input[name='age']"),this.$finalSignupButton=this.$(".signup"),this.$confirmedEmail=this.$(".confirmedEmail"),this.firstStepComplete=!1;var a=P.getConversationsManager().getUnauthUserEmail();!this.$emailInput.val()&&a&&this.$emailInput.val(a),this.options.register=!0},logContainerViewType:function(){if(this.options.container){var a={home_page:P.ContextLogging.EventType.HOME_PAGE_SIGNUP_VIEW,plain_signup_modal:P.ContextLogging.EventType.PLAIN_MODAL_SIGNUP_VIEW,closeup_signup_modal:P.ContextLogging.EventType.CLOSEUP_MODAL_SIGNUP_VIEW,widescreen_signup_modal:P.ContextLogging.EventType.WIDESCREEN_MODAL_SIGNUP_VIEW,pinit_button_landing:P.ContextLogging.EventType.PIN_IT_BUTTON_LANDING_SIGNUP_VIEW},b=a[this.options.container];if(b){var c=P.ContextEvent.fromEventType(b);P.ContextLogger.getInstance().addEvent(c)}}},setupForm:function(){var a={first_name:[P.Validator.Required()],email:[P.Validator.Required({message:P._("<b>You missed a spot!</b> Don't forget to add your email.")}),P.Validator.Email({message:P._("<b>Hmm...</b>that doesn't look like an email address.")})],age:[P.Validator.Age({message:P._("Please enter a valid number.")})],password:[P.Validator.ContainsOnlyAscii({message:P._("<b>Oh @*&#!</b> No zany characters allowed.")}),P.Validator.Password({shortPassStr:P._("<b>Your password is too short!</b> You need 6+ characters."),badPassStyle:P._("Your password does not have the proper style."),samePasswordStr:P._("Please make your username and password different."),blackPassStr:P._("Please make a stronger password.")})],full_name:[P.Validator.Name({message:P._("<b>And your name is...?</b>")})]};this.form=new P.Form(this.$("form"),a,{disableAutoValidation:!0}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},handleKeydown:function(a){a.stopPropagation(),a.keyCode===P.keyCode.ENTER&&(this.firstStepComplete?this.$finalSignupButton.click():this.$(".continueButton").click()),this.form.disableAutoValidation=!1},validateInput:function(a){return new Promise(function(b,c){this.form.validateField(a,function(a){0!==a.errors.length?c(a.errors):b()})}.bind(this))},validateEmailAvailable:function(){var a=P.resourceFactory.create("EmailExistsResource",{email:this.$emailInput.val()});a.callGet({showError:!1}).then(function(a){a.resource_response.data===!1?this.validateComplete({message:null,type:"emailError"}):this.login({username_or_email:this.form.getValue("email"),password:this.form.getValue("password")}).then(this.onLoginComplete.bind(this),this.onLoginError.bind(this))}.bind(this),function(){var a=P._("Hmm... that doesn't look like an email address.");this.validateComplete({message:a,type:"emailError"})}.bind(this))},submitFirstStep:function(){return P.trackRegisterAction("multi_step_step_1_submit"),this.form.disableAutoValidation=!1,this.options.unified_auth?this.unifiedAuthFirstStep():void this.validateFirstStep()},validateFirstStep:function(){return this.validateInput(this.$emailInput).then(function(){this.validateInput(this.$passwordInput).then(function(){this.validateEmailAvailable()}.bind(this),function(a){this.validateComplete({message:a[0],type:"passwordError"})}.bind(this))}.bind(this),function(a){this.validateComplete({message:a[0],type:"emailError"})}.bind(this))},submitSecondStep:function(){return P.trackRegisterAction("multi_step_step_2_submit"),this.firstStepComplete?this.options.unified_auth?this.unifiedAuthSecondStep():void this.validateSecondStep():this.submitFirstStep()},validateSecondStep:function(){return this.validateInput(this.$userFullNameField).then(function(){""===this.$userAgeInput.val().trim()?this.secondStepComplete():this.validateInput(this.$userAgeField).then(function(){this.secondStepComplete()}.bind(this),function(a){this.validateComplete({message:a[0],type:"ageError"})}.bind(this))}.bind(this),function(a){this.validateComplete({message:a[0],type:"nameError"})}.bind(this))},secondStepComplete:function(){this.$finalSignupButton.submit()},validateComplete:function(a){if(!P.getQueryStringParams().email){var b;"emailError"===a.type||"passwordError"===a.type?b=this.$("#firstStepTooltip"):("nameError"===a.type||"ageError"===a.type)&&(b=this.$("#secondStepTooltip")),"passwordError"===a.type&&this.options.unified_auth&&(b=this.$("#secondStepTooltip")),a.message?(this.$(".errorIcon").hide(),this.$("input.hasError").siblings("em").fadeIn(),b.addClass(a.type),b.html(a.message).fadeIn()):("emailError"===a.type||"passwordError"===a.type)&&(P.trackRegisterAction("multi_step_step_1_complete"),this.$confirmedEmail.text(this.$emailInput.val()),this.toggleMultiStep(),this.options.unified_auth?this.$passwordInput.focus():this.extraData.disableAutofocus||this.$("input[name='full_name']").focus(),this.extraData.show_personalize_field&&(P.experiments.instance.activateAndPersistExperiment("cm_checkbox"),P.experiments.instance.inExperimentGroups("cm_checkbox",["rollout","enabled3","employee"])&&(this.$(".personalizeInput").prop("checked",!0),this.$(".personalizeField").removeClass(this.CssClassName.HIDDEN))))}},toggleMultiStep:function(){this.firstStepComplete=!this.firstStepComplete,this.$el.toggleClass("secondStep"),this.triggerEvent("toggleMultiStep",{step1:!this.firstStepComplete},!0)},onLoginError:function(){var a=P._('<b>Deja vu!</b> That email\'s taken. <a href="{{ link }}">Forgot your password?</a>'),b=P.string.format(a,{link:"/password/reset/"});this.validateComplete({message:b,type:"emailError"})},onLoginComplete:function(){P.trackRegisterAction("multi_step_login"),this.redirect(P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW))},onSubmitValidated:function(a){if(!a.errors[0]){if(this.extraData&&this.$userFullNameInput&&""===this.$userFullNameInput.val().trim())return;var b=this.getChildById("submitButton");b.showLoading();var c=this.getFormData();this.options.container&&(c.container=this.options.container),decodeURIComponent(this.options.next).indexOf("/pin/create/button/")>-1&&P.changeWindowLocation("/?reloadToLogin=true",!0),P.trackRegisterAction("multi_step_step_2_complete"),P.UserRegistration.register(this.options.network,c).then(this.redirect.bind(this,!0),function(a){b.hideLoading(),a.api_error_code===P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT&&P.changeWindowLocation("/restricted/age/",!1),a.api_error_code===P.CONST.API_ERROR_PINVITATIONAL_USED_INVITE&&this.showPinvitationalErrorDialog(a.message)}.bind(this))}},redirect:function(a){if(a)this.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0);else{var b=this.options.next||"/";if(this.options.auto_follow_interest)b=P.url.appendQueryString(b,{auto_follow_interest:this.options.auto_follow_interest});else{var c=P.getQueryStringParams();c&&(b=P.url.appendQueryString(b,c))}P.navigateAfterLoginStatusChange(b)}},getFormData:function(){var a=this.$("form").serializeArray(),b={},c="";if(_.each(a,function(a){"full_name"===a.name?c=a.value.trim():b[a.name]="on"===a.value?!0:a.value}),c){var d=c.split(" ");""===d[0]&&d.shift(),d.length>0&&(b.first_name=d[0]||""),d.length>1&&(b.last_name=d[1]||"")}return b},showPinvitationalErrorDialog:function(a){var b={name:"ConfirmDialog",options:{button_text:P._("Request invite"),dismiss_button_text:P._("Cancel"),body_message:a,title:P._("Oops!"),template:"pinvitational_invite_used"}};P.loadModule(b).then(function(a){this.showInModal(a)}.bind(this))},unifiedAuthFirstStep:function(){this.$el.removeClass("unifiedLogin"),this.validateInput(this.$emailInput).then(function(){this.unifiedAuthTestEmail()}.bind(this),function(a){this.validateComplete({message:a[0],type:"emailError"})}.bind(this))},unifiedAuthSecondStep:function(){this.$("input.hasError").siblings("em").fadeOut(),this.validateInput(this.$passwordInput).then(function(){this.$el.hasClass("unifiedLogin")?this.unifiedAuthlogin():this.validateInput(this.$userFullNameField).then(function(){""===this.$userAgeInput.val().trim()?this.$finalSignupButton.submit():this.validateInput(this.$userAgeField).then(function(){this.$finalSignupButton.submit()}.bind(this),function(a){this.validateComplete({message:a[0],type:"ageError"})}.bind(this))}.bind(this),function(a){this.validateComplete({message:a[0],type:"nameError"})}.bind(this))}.bind(this),function(a){this.validateComplete({message:a[0],type:"passwordError"})}.bind(this))},unifiedAuthTestEmail:function(){var a=P.resourceFactory.create("EmailExistsResource",{email:this.$emailInput.val()});a.callGet({showError:!1}).then(function(a){a.resource_response.data&&this.unifiedAuthAttemptLogin(),this.validateComplete({message:null,type:"emailError"})}.bind(this))},unifiedAuthAttemptLogin:function(){this.form.getValue("password")&&this.unifiedAuthlogin(),this.$el.addClass("unifiedLogin"),this.$passwordInput.attr("placeholder",P._("Password"))},unifiedAuthlogin:function(){var a={username_or_email:this.form.getValue("email"),password:this.form.getValue("password")};this.login(a).then(this.onLoginComplete.bind(this),function(){this.$passwordInput.addClass("hasError");var a=P._("Forgot your password?"),b='<a href="{{ link }}">'+a+"</a>",c=P.string.format(b,{link:"/password/reset/"});this.validateComplete({message:c,type:"passwordError"})}.bind(this))}}),goog.provide("P.modules.UserRegisterPage"),goog.require("P.Module"),P.modules.UserRegisterPage=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)}}),goog.provide("P.modules.UserRegisterRestricted"),goog.require("P.Module"),P.modules.UserRegisterRestricted=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)}}),goog.provide("P.modules.UserSecuritySettings"),goog.require("P.Module"),P.modules.UserSecuritySettings=P.Module.extend({events:{"click .revokeButton":"revokeSession","click .showHideButton":"showSessions"},CssClassName:{HIDDEN:"hidden"},revokeSession:function(a){var b=$(a.currentTarget),c=b.parent().parent();this.showConfirmation(c)},showSessions:function(){var a=this.getChildById("showHideButton"),b=this.$(".activeSessions");b.hasClass(this.CssClassName.HIDDEN)?(b.removeClass(this.CssClassName.HIDDEN),a.setText(P._("Hide Sessions"))):(b.addClass(this.CssClassName.HIDDEN),a.setText(P._("Show Sessions")))},onConfirm:function(a){var b=a.attr("data-sess-id"),c=P.resourceFactory.create("UserSessionStoreResource",{sess_id:b});c.callDelete().then(function(){a.hide()})},showConfirmation:function(a){var b={name:"ConfirmDialog",options:{template:"revoke_session"}};P.loadModule(b).then(function(b){this.showInModal(b),this.listen(b,P.CONST.EVENT_CONFIRM,function(){this.onConfirm(a)})}.bind(this))}}),goog.provide("P.modules.UserSettingsPage"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.ContextLogging.EventType"),goog.require("P.ContextLogging.ViewType"),goog.require("P.ContextLogging.ViewParameterType");var GOOGLE_SEARCH_PRIVACY_URL="https://www.google.com/webmasters/tools/removals?pli=1",SCROLL_MARGIN_OF_ERROR=2;P.modules.UserSettingsPage=P.Module.extend({events:{"click .toc li":"onTOCClick"},CssClassName:{HIDDEN:"hidden",TOC_SELECTED:"selected"},onContentReady:function(){var a={email:[P.Validator.Required(),P.Validator.Email()],first_name:[P.Validator.Required()],username:[P.Validator.Required()],about:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})],website_url:[P.Validator.URL()]};this.data.is_partner&&(a.contact_name=[P.Validator.Required()],a.business_name=[P.Validator.Required()]),this.$searchPrivacy=this.$(".Checkbox[name=exclude_from_search]"),this.listen(this.$searchPrivacy,P.CONST.EVENT_CHANGE,this.onSearchPrivacyChange),this.$genderButtons=this.$("input:radio[name=gender]"),this.listen(this.$genderButtons,P.CONST.EVENT_CHANGE,this.onGenderChange),this.$form=this.$("form"),this.form=new P.Form(this.$form,a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var b={};b[P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD]=this.onPasswordChanged,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,b),this.negativeSpaceAdded=0,this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll)},onAdded:function(){this.$(".formFooter").fixedsticky()},onGenderChange:function(a){var b=a.target,c=this.$(".customGender");"unspecified"===b.value&&b.checked?c.removeClass(this.CssClassName.HIDDEN):(c.addClass(this.CssClassName.HIDDEN),c.val(""))},onSearchPrivacyChange:function(a){var b=a.target;if(b.checked){var c={name:"ConfirmDialog",options:{template:"search_privacy",google_search_privacy_url:GOOGLE_SEARCH_PRIVACY_URL}};P.loadModule(c).then(function(a){this.showInModal(a);var b={event_type:P.ContextLogging.EventType.VIEW,view_type:P.ContextLogging.ViewType.SETTINGS,view_parameter:P.ContextLogging.ViewParameterType.SETTINGS_SEARCH_PRIVACY},c=P.ContextEvent.fromPlainObject(b);P.ContextLogger.getInstance().addEvent(c),this.listen(a,P.CONST.EVENT_NAVIGATE,function(a){if(a.data&&a.data.url===GOOGLE_SEARCH_PRIVACY_URL){var b={};this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.SEARCH_PRIVACY_LINK,P.ContextLogging.ComponentType.MODAL_SEARCH_PRIVACY,b)}})}.bind(this))}},onPasswordChanged:function(a,b,c){var d=this.getChildById("userChangePasswordButton");if(d.options.submodule.options.has_password=!0,d.options.text=this.extraData.change_password_text,d.render(),c){var e=this.getChildById("userSocialNetworkSettings");e.render()}},onButtonClick:function(a){var b=a.target,c=b.id;switch(c){case"clearRecentSearches":this.clearRecentSearches(a)}},clearRecentSearches:function(a){var b=a.target;b.disable();var c=P.resourceFactory.create("TypeaheadClearRecentResource");c.callDelete({showError:!1}).fin(function(){b.enable()})},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.getChildById("notifications"),c=[this.save()];return b&&c.push(b.updateResource()),Promise.all(c).then(function(a){var b=a[0];if(b&&!b.resource_response.error){var c=b.resource_response.data;this.data.email!==this.email&&c.email_changing_to?this.showPendingEmailChange():this.navigateToUserProfilePage(this.username)}}.bind(this))}},navigateToUserProfilePage:function(a){var b="/"+a+"/";this.navigate(b,null,!0)},save:function(){var a=this.$form.serializeArray(),b={};_.each(a,function(a){b[a.name]="on"===a.value||"off"===a.value?"on"===a.value:a.value}),this.$form.find("input[type=checkbox]").each(function(){var a=$(this);b[a.attr("name")]=a.is(":checked")
});var c=this.getChildById("submitButton"),d=P.resourceFactory.create("UserSettingsResource",b);return this.email=b.email,this.username=b.username,c.showLoading(),d.callUpdate().fin(function(){c.hideLoading()})},showPendingEmailChange:function(){var a=P.string.format(P._("To finish updating your address, look for the confirmation email we sent to {{ current_email }}."),{current_email:this.data.email}),b={name:"ConfirmDialog",options:{button_text:P._("Ok"),body_message:a,title:P._("You're almost done!"),template:"generic"}};P.loadModule(b).then(function(a){this.showInModal(a,{can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CLOSE,this.navigateToUserProfilePage(this.username)),this.listen(a,P.CONST.EVENT_CONFIRM,this.navigateToUserProfilePage(this.username))}.bind(this))},onTOCClick:function(a){var b=$(a.currentTarget).find("a").attr("href"),c=$(b).position().top;return this.$(".toc li").removeClass(this.CssClassName.TOC_SELECTED),$(a.currentTarget).addClass(this.CssClassName.TOC_SELECTED),this.tocClicked=!0,P.scrollToTop({newScrollOffset:c,duration:800,callback:function(){this.tocClicked=!1}.bind(this)}),a.stopPropagation(),!1},addNegativeSpace:function(){if(0===this.negativeSpaceAdded){var a=this.$(".standardForm");a.height("100%");var b=this.$("#apps").position().top,c=$(document).height()-this.getScrollableElement().height(),d=b-c;if(d>0){var e=a.height();a.height(e+d),this.negativeSpaceAdded=d}}},onScroll:function(){var a=this.getScrollableElement().scrollTop();if(!(a<0)){if(!this.tocClicked){for(var b=null,c=0,d=this.$(".sectionTitle"),e=0;e<d.length;e++){var f=d[e],g=$(f).position().top;a>=g-SCROLL_MARGIN_OF_ERROR&&(!b||c<g)&&(b=f,c=g)}this.$(".toc li").removeClass(this.CssClassName.TOC_SELECTED),this.$('.toc a[href="#'+$(b).attr("id")+'"]').parent("li").addClass(this.CssClassName.TOC_SELECTED)}this.addNegativeSpace()}}}),goog.provide("P.modules.UserSocialNetworkSettings"),goog.require("P.Module"),goog.require("P.modules.Checkbox"),P.modules.UserSocialNetworkSettings=P.Module.extend({FB_PUBLISH_ACTIONS_PERMISSION:"publish_actions",onCreated:function(){this.childListen("change",this.onChildChange);var a={};a[P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED]=this.onSocialNetworkUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},disconnectFromSocial:function(a,b,c){this.showLoading(!0);var d={error:function(){a.toggle()},complete:function(){this.hideLoading()}.bind(this)},e=P.SocialNetworkSettingsManager.instance();e.handleConnect(c,b,d)},onChildChange:function(a){var b=a.target,c=b.isChecked&&b.isChecked(),d=null;switch(b.id){case"facebookToggle":if(!(c&&!this.extraData.facebookUrl||!c&&this.extraData.facebookUrl))return;d=P.SocialConnect.FACEBOOK;break;case"twitterToggle":if(!(c&&!this.extraData.twitterUrl||!c&&this.extraData.twitterUrl))return;d=P.SocialConnect.TWITTER;break;case"gplusToggle":if(!(c&&!this.extraData.gplusUrl||!c&&this.extraData.gplusUrl))return;d=P.SocialConnect.GPLUS;break;case"googleToggle":if(!(c&&!this.extraData.connected_to_google||!c&&this.extraData.connected_to_google))return;d=P.SocialConnect.GOOGLE;break;case"yahooToggle":if(!(c&&!this.extraData.connected_to_yahoo||!c&&this.extraData.connected_to_yahoo))return;d=P.SocialConnect.YAHOO;break;case"rakutenToggle":if(!(c&&!this.extraData.connected_to_rakuten||!c&&this.extraData.connected_to_rakuten))return;d=P.SocialConnect.RAKUTEN;break;case"microsoftToggle":if(!(c&&!this.extraData.connected_to_microsoft||!c&&this.extraData.connected_to_microsoft))return;d=P.SocialConnect.MICROSOFT;break;default:return}if(c||this.extraData.has_password)this.disconnectFromSocial(b,c,d);else{var e={name:"UserChangePassword",options:{has_password:!1,render_social_networks:!1}},f=!1;P.loadModule(e).then(function(a){this.showInModal(a),this.listen(a,"destroyed",function(){f?this.disconnectFromSocial(b,c,d):(P.showError(P._("A password must be set before unlinking.")),b.toggle())}),this.listen(a,"success",function(){f=!0})}.bind(this))}},onSocialNetworkUpdated:function(){this.render()}}),goog.provide("P.modules.VisualCropSearchButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.VisualCropSearchButton=P.modules.Button.extend({onClick:function(){this.triggerEvent(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_CROP_BUTTON_PRESSED,null,!0)}}),goog.provide("P.modules.VisualSearchPage"),goog.require("P.Module"),P.modules.VisualSearchPage=P.Module.extend({onContentReady:function(){this._fadeOutBoxesIfReady()},onAddedToDom:function(){this._fadeOutBoxesIfReady()},_fadeOutBoxesIfReady:function(){this.inDom&&this.contentReady&&setTimeout(function(){this.$(".visualSearchOverlayInnerWrapper>img").fadeTo(1500,1)}.bind(this),1e3)}}),goog.provide("P.modules.VisualSearchPageQueryItem"),goog.require("P.Module"),P.modules.VisualSearchPageQueryItem=P.Module.extend({}),goog.provide("P.modules.VisualSearchSelector"),goog.require("P.Module"),P.modules.VisualSearchSelector=P.Module.extend({events:{"click label":"_onPinTypeLabelClick"},navigateToPinType:function(a){this.navigate("/search/"+a+"/"+this.options.pin_id+"/")},_onPinTypeLabelClick:function(a){var b=$(a.currentTarget),c=b.find("input"),d=c.val();if(d!==this.options.pin_type){var e=c.attr("data-url")||d;return this.navigateToPinType(e),!1}}}),goog.provide("P.modules.WidescreenSignupModal"),goog.require("P.Module"),goog.require("P.modules.InlineSignup"),P.modules.WidescreenSignupModal=P.modules.InlineSignup.extend({CssClassName:_.extend(P.modules.InlineSignup.prototype.CssClassName,{ALLOW_OVERFLOW:"allowOverflow",FULL_HEIGHT:"fullHeight",ON_CONTINUE:"onContinue"}),onContentReady:function(){P.modules.InlineSignup.prototype.onContentReady.call(this),this.listen(this.getChildById("firstContinueButton"),P.CONST.EVENT_BUTTON_CLICK,this.onFirstContinueClick),P.trackRegisterAction("widescreen_signup_modal_view"),this.setMultiStepHeader(".title",{step1:P._("Sign up to get more details about this Pin"),step2:P._("Looking good! Just a few more details...")})},onFirstContinueClick:function(a){a.stopPropagation(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SIGNUP_CONTINUE_CLICKED),this.showLoginAndRegister(),P.trackRegisterAction("contextual_signup_continue")},showLoginAndRegister:function(){this.$(".login").fadeOut(),this.$(".continue").fadeOut(500,function(){this.$(".csContent").addClass(this.CssClassName.ON_CONTINUE),this.$(".gradient").addClass(this.CssClassName.FULL_HEIGHT),setTimeout(function(){this.$el.addClass(this.CssClassName.ALLOW_OVERFLOW)}.bind(this),1e3)}.bind(this))}}),goog.provide("P.modules.WidgetLandingSignup"),goog.require("P.Module"),P.modules.WidgetLandingSignup=P.Module.extend({events:{},onContentReady:function(){P.getWindowManager().resizeViewPort(825,525),this.setupSavePinitLanding()},setupSavePinitLanding:function(){var a=P.getQueryStringParams(this.options.next),b=a.media,c=this.$(".background");b&&(c.get(0).src=b),c.load(function(){var a=$(this).height(),b=$(this).width();$(this).addClass(b/a>825/525?"wide-img":"tall-img")})}}),goog.provide("P.modules.YourWebsiteDropdown"),goog.require("P.Module"),P.modules.YourWebsiteDropdown=P.Module.extend({}),require("common/lib/external/modernizr-2.7.1-custom.js"),goog.provide("P.modules.AddPin"),goog.require("P.Module"),goog.require("P.modules.Button");var BUTTON_ID_UPLOAD="upload_button",BUTTON_ID_URL="url_button",BUTTON_BROWSER_BUTTON="browser_button";P.modules.AddPin=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),Modernizr.fileinput||this.$(".pinUpload").remove()},onButtonClick:function(a){var b,c=a.target,d=c.id;c.showLoading(),d===BUTTON_ID_UPLOAD?b={name:"PinUploader",options:{}}:d===BUTTON_ID_URL?b={name:"AddPinURL",options:{show_title:!0,pinmarklet_link_element_type:P.ContextLogging.ElementType.ADD_PIN_REP_BOOKMARKLET}}:d===BUTTON_BROWSER_BUTTON&&(b={name:"BrowserButtonUpsell",options:{extension_installed:P.browserExtension.instance.isExtensionInstalled(),suppress:!0}});var e=this.options.board_id;e&&(b.options.default_board_id=e),b&&P.loadModule(b).then(function(a){c.hideLoading(),this.modal?this.modal.setSubmodule(a):this.showInModal(a)}.bind(this))}}),goog.provide("P.modules.AddPinRep"),goog.require("P.Module"),goog.require("P.modules.ModalTrigger"),P.modules.AddPinRep=P.modules.ModalTrigger.extend({events:{click:"onClick"},onClick:function(a){a.stopPropagation(),a.preventDefault(),P.currentUser.isLimitedLogin()?P.limitedLogin.showLogin(this):this.showModalSubmodule()}}),goog.provide("P.modules.BoardCount"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.BoardCount=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onBoardCountUpdate,a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardCountUpdate,a[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardCountUpdate,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a),P.modules.NavigateButton.prototype.onContentReady.call(this)},onBoardCountUpdate:function(a,b,c){c.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this.render()}}),goog.provide("P.modules.BoardCoverEdit"),goog.require("P.Module"),goog.require("P.modules.ImageCrop"),P.modules.BoardCoverEdit=P.Module.extend({pins:null,index:null,prefetchBuffer:10,events:{"click .previous":"previous","click .next":"next"},onCreated:function(){this.imageCrop=null,this.onKeyup=this.onKeyup.bind(this),this.next=this.next.bind(this),this.previous=this.previous.bind(this),this.$img=$("<img>")},_positionIfReady:function(){!this._positioned&&this.inDom&&this.contentReady&&(this._positioned=!0,this.imageCrop=this.getChildByModuleName("ImageCrop"),this.listen($("body"),"keyup",this.onKeyup),this.coverPinId=this.options.cover_pin_id,this._initializePins(!0))},_initializePins:function(a){if(a&&null!==this.coverPinId){var b={id:this.coverPinId,field_set_key:"board_cover_picker"},c=P.resourceFactory.create("PinResource",b);c.callGet({showError:!1}).then(function(a){this._appendPinsFromData([a.resource_response.data]),this._initializePins()}.bind(this),function(){this.coverPinId=null,this._initializePins()}.bind(this))}else this._appendPinsFromData(this.data),this.setIndex(0),this.updateButtons()},_appendPinsFromData:function(a){this.pins||(this.pins=[]),_.each(a,function(a){var b={id:a.id,url:a.images["236x"].url};b.id===this.coverPinId&&this.pins.length||this.pins.push(b)}.bind(this))},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){this._positionIfReady()},onKeyup:function(a){null!==this.index&&(a.keyCode===P.keyCode.LEFT?this.previous():a.keyCode===P.keyCode.RIGHT&&this.next())},requestMoreIfNeeded:function(){this.index+this.prefetchBuffer<this.pins.length||this.resource.atEnd()||this.resource.callGet().then(function(a){this.data=a.resource_response.data,this._appendPinsFromData(this.data)}.bind(this),function(){this.data=[]}.bind(this))},next:function(){if(this.requestMoreIfNeeded(),this.index===this.pins.length-1)return!1;var a=this.index+1;return this.setIndex(a),!1},previous:function(){var a=this.index-1;return this.setIndex(a),!1},setIndex:function(a){var b=this.pins[a];b&&(this.imageCrop.setImage(b.url),this.index=a,this.preload([this.index-2,this.index-1,this.index+1,this.index+2]),this.updateButtons())},preload:function(a){_.each(a,function(a){var b=this.pins[a];b&&P.preloadImage(b.url)}.bind(this))},updateButtons:function(){var a=this.index>0;this.$(".previous").toggle(a);var b=this.index<this.pins.length-1||!this.resource.atEnd();this.$(".next").toggle(b)},getBoardCoverData:function(){var a=this.pins[this.index].id,b=this.pins[this.index].url,c=_.extend({},{pin_id:a,pin_image_url:b},this.imageCrop.getCropData());return c}}),goog.provide("P.modules.BoardCreateRep"),goog.require("P.Module"),goog.require("P.modules.ModalTrigger"),P.modules.BoardCreateRep=P.modules.ModalTrigger.extend({events:{click:"onClick"},onClick:function(a){a.stopPropagation(),a.preventDefault(),P.currentUser.isLimitedLogin()?P.limitedLogin.showLogin(this):this.showModalSubmodule()}}),goog.provide("P.modules.BoardEditBase"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.BoardCollaboratorInvitesBase"),goog.require("P.modules.BoardInvites"),P.modules.BoardEditBase=P.modules.BoardCollaboratorInvitesBase.extend({CssClassName:_.extend(P.modules.BoardCollaboratorInvitesBase.prototype.CssClassName,{INLINE_ERROR:"inlineError"}),onCreated:function(){P.modules.BoardCollaboratorInvitesBase.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},setupForm:function(){this.$form=this.$("form");var a={},b=this.extraData;if(this._isOwner()){var c=b.errorMessages.name.required;a={name:[P.Validator.Required({message:c}),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_TITLE})],description:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]}}this.form=new P.Form(this.$form,a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onContentReady:function(){this.setupForm()},onButtonClick:function(a){var b=a.target;if(b){var c=this._getGACategory();"submitButton"===b.id?P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_SUBMIT):"cancelButton"===b.id&&P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_CANCEL)}},onSubmitValidated:function(a){a.errors[0]||this.saveBoard()},getBoardId:function(){return this.data&&this.data.id},_getGACategory:function(){return this.getBoardId()?"board_edit":"board_create"},isMakePublic:function(a){return this.data&&"secret"===this.data.privacy&&"public"===a},getFieldValues:function(){var a=this.$("form"),b={},c=a.find("[name=name]");c.length&&(b.name=c.val());var d=this.getChildById("boardCategory");d&&(b.category=d.getValue());var e=a.find("[name=description]");e.length&&(b.description=e.val());var f=this.getChildById("secretCheckbox");f&&(b.privacy=f.isChecked()?"secret":"public");var g=this.getChildById("emailCheckbox");g&&(b.collab_board_email=g.isChecked());var h=this.getChildById("placeLayoutCheckbox");h&&(b.layout=h.isChecked()?"places":"default");var i=this.getChildById("collaboratorInvitesEnabledCheckbox");return i&&(b.collaborator_invites_enabled=i.isChecked()),this.extraData&&this.extraData.isProtected&&(b["protected"]=1),b},_isOwner:function(){return this.extraData&&this.extraData.isOwner},saveBoard:function(){var a=this.getChildById("submitButton");a.showLoading();var b=this.getFieldValues(),c=this.getBoardId(),d=_.clone(b);c&&(d.board_id=c);var e;if(this._isOwner()){e=P.resourceFactory.create("BoardResource",d);var f={showError:!1},g=c?e.callUpdate(f):e.callCreate(f);g.then(this.onSaveSuccess.bind(this),this.onSaveError.bind(this)).fin(function(){a.hideLoading()})}else e=P.resourceFactory.create("BoardSettingsResource",d),e.callUpdate().fin(function(){this.updateBoardPickerBoardsResource(),a.hideLoading(),this.destroy()}.bind(this))},updateBoardPickerBoardsResource:function(){var a=P.resourceFactory.create("BoardPickerBoardsResource",{filter:"all",field_set_key:"board_picker",allow_stale:!0});P.resourceCache.instance.callGet(a)},onSaveError:function(a){P.trackGAEvent(this._getGACategory(),P.CONST.GA_ACTION_ERROR);var b=this.$(".formFooter"),c=this.$(".inlineError");c.length?c.empty():c=$("<p></p>").addClass(this.CssClassName.INLINE_ERROR),c.text(a.message),c.insertBefore(b)},_isNewBoard:function(){var a=this.getBoardId();return!a},onSaveSuccess:function(a){var b,c,d,e=this.getChildById("boardInvites");e&&(b=e.getSelectedInvitees("pinner"),c=e.getSelectedInvitees("email"),d=e.getSelectedInvitees("facebook"));var f=this.getBoardId(),g=this._isNewBoard();P.trackGAEvent(this._getGACategory(),P.CONST.GA_ACTION_SUCCESS),this.updateBoardPickerBoardsResource();var h=a.resource_response.data;f?(P.pubsub.publish(f,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,h),this.isMakePublic(h.privacy)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,P.CONST.PUBSUB_MESSAGE_BOARD_SET_PUBLIC)):(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,h),this.triggerEvent(P.CONST.EVENT_BOARD_CREATED,h,!0)),g&&(b&&this.inviteUsers(h.id,b),c&&this.inviteEmail(h.id,c),d&&d.length>0&&this.inviteFacebook(h.id,d));var i="navigate_on_success"in this.options?this.options.navigate_on_success:g||!this.isInModal();i?this.navigate(h.url,null,g):this.options.custom_board_create_success_destroy||this.destroy()},displayFacebookDialog:function(a,b,c){P.FacebookDialog.open({type:"send",path:b,to:a,callback:c})},inviteUsers:function(a,b){var c={board_id:a,invited_user_ids:b};if(b&&b.length>0){var d=P.resourceFactory.create("BoardInviteResource",c);d.callCreate()}},inviteEmail:function(a,b){var c={board_id:a,emails:b};if(b&&b.length>0){var d=P.resourceFactory.create("BoardEmailInviteResource",c);d.callCreate()}},inviteFacebook:function(a,b){var c=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:a});c.callGet().then(function(c){var d=c.resource_response.data;this._inviteFacebookRecursive(a,b,d.invite_code,d.url)}.bind(this))},_inviteFacebookRecursive:function(a,b,c,d){if(b.length>0){var e=b.pop();this.displayFacebookDialog(e,d,function(e){if(this._inviteFacebookRecursive(a,b,c,d),e&&e.success){var f=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:a,invite_code:c});f.callUpdate()}}.bind(this))}}}),goog.provide("P.modules.BrowserButtonUpsell"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.BrowserButtonUpsell=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),P.ContextLogger.getInstance().logCustomViewEvent(P.ContextLogging.ViewType.SAVE,P.ContextLogging.ViewParameterType.EXTENSION_UPSELL_MODAL)},onButtonClick:function(a){var b=a.target,c=b.id;"installExtensionButton"===c?P.browserExtension.instance.isExtensionInstalled()?P.showError(P._("Oops! You already have the browser button.")):P.browserExtension.instance.handleExtensionInstall(function(){this.destroy()}.bind(this),function(){P.showError(P._("Oops! The download didn't work."))}):"cancelInstallButton"===c&&(this.options.suppress&&Cookie.set(P.CONST.COOKIE_SUPPRESS_EXTENSION_NAG,"true"),this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.CANCEL_EXTENSION_INSTALL_BUTTON,P.ContextLogging.ComponentType.BROWSER,{}),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_IGNORE_EXTENSION_NAG))}}),goog.provide("P.modules.BulkEditBar"),goog.require("P.Module"),goog.require("P.modules.PinCount"),P.modules.BulkEditBar=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BULK_PIN_SELECTED]=this.pinSelected,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,a),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.pinsSelected={},this.selectedPinsCount=0},pinSelected:function(a,b,c){if(c&&this.pinsSelected){if(this.pinsSelected.hasOwnProperty(c))this.selectedPinsCount--,delete this.pinsSelected[c];else{if(50===Object.keys(this.pinsSelected).length)return P.showError(P._("You can only move 50 Pins at a time.")),void P.pubsub.publish(c,P.CONST.PUBSUB_TOPIC_BULK_PIN_UNSELECTED);this.selectedPinsCount++,this.pinsSelected[c]=1}this.updateSelectedPinsCount()}},updateSelectedPinsCount:function(){var a=this.getChildById("selectedPinsCount");a&&a.destroy();var b={can_update_count:!0,view_type:"selectedPins"},c={pin_count:this.selectedPinsCount},d=new P.modules.PinCount({id:"selectedPinsCount",data:c,options:b});d.renderExistingData().then(function(){var a=this.$(".notifications");this.insertChild(d,a)}.bind(this))},showBoardPicker:function(a){var b=Object.keys(this.pinsSelected);0===b.length?P.showError(a===P.CONST.BulkAction.MOVE?P._("Select the Pins you want to move."):a===P.CONST.BulkAction.COPY?P._("Select the Pins you want to copy."):P._("Select some Pins first.")):P.loadModule({name:"BulkBoardPicker",options:{action_type:a,board_privacy:this.options.board_privacy,pin_count:b.length,pin_ids:b}}).then(function(a){P.getModalManager().createAndShowModal(a)})},onButtonClick:function(a){var b=a.target,c=b.id;switch(c){case"moveBulkButton":this.showBoardPicker(P.CONST.BulkAction.MOVE);break;case"copyBulkButton":this.showBoardPicker(P.CONST.BulkAction.COPY);break;case"deleteBulkButton":this.onDeleteClick();break;case"cancelBulkButton":P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}},enterBulkEditMode:function(){this.$el.transition({y:"64px",easing:"ease-out",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})},exitBulkEditMode:function(){this.$el.transition({y:"0",easing:"ease-out",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION},1,function(){this.destroy()}.bind(this))},onDeleteClick:function(){var a=Object.keys(this.pinsSelected);if(0===a.length)P.showError(P._("Select the Pins you want to delete."));else{var b="";b=1===a.length?"delete_pin":"delete_pins";var c={name:"ConfirmDialog",options:{template:b}};P.loadModule(c).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.bulkDeletePins)}.bind(this))}},bulkDeletePins:function(){var a=P.resourceFactory.create("BulkEditResource",{board_id:this.options.board_id,pin_ids:Object.keys(this.pinsSelected)});a.callDelete({showError:!0}).then(function(){for(var a in this.pinsSelected)P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_DELETED);P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}.bind(this))}}),goog.provide("P.modules.CloseupBottom"),goog.require("P.Module"),goog.require("P.modules.CloseupRelatedPins");var MODULE_ID_RELATED_PINS="relatedPins",MODULE_ID_RELATED_BOARDS="relatedBoards";P.modules.CloseupBottom=P.Module.extend({onContentReady:function(){},renderCloseupRelatedPins:function(a){return this.closeupRelatedPins?this.closeupRelatedPins.options.initial_column_lengths=[a,a,a]:(this.closeupRelatedPins=new P.modules.CloseupRelatedPins({id:MODULE_ID_RELATED_PINS,options:{show_seo_canonical_pins:this.options.show_seo_canonical_pins,pin_id:this.options.pin_id,initial_column_lengths:[a,a,a]}}),this.appendChild(this.closeupRelatedPins)),this.closeupRelatedPins.render()},onChildRendered:function(a){var b,c,d=a.id===MODULE_ID_RELATED_PINS,e=a.id===MODULE_ID_RELATED_BOARDS;if(d&&(b=a.getChildByModuleName("Grid"),c=this.$(".relatedPinsWrapper")),e&&(b=a.getChildByModuleName("PagedGrid"),c=this.$(".relatedBoardsWrapper")),b&&c.length){var f=b.hasItems(),g=f?"visible":"hidden";c.css("visibility",g)}},onDeepLink:function(){this.relatedPinsInterval&&(window.clearInterval(this.relatedPinsInterval),this.relatedPinsInterval=null)},setMinHeight:function(a){this.$el.css("min-height",null!==a?a:"")}}),goog.provide("P.modules.CloseupSignupModal"),goog.require("P.Module"),goog.require("P.modules.InlineSignup"),P.modules.CloseupSignupModal=P.modules.InlineSignup.extend({onContentReady:function(){P.trackRegisterAction("closeup_signup_modal_view"),P.modules.InlineSignup.prototype.onContentReady.call(this),this.setMultiStepHeader(".tagline",{step1:this.options.tagline,step2:P._("Looking good! Just a few more details...")})}}),goog.provide("P.modules.ConversationHead"),goog.require("P.modules.Token"),P.modules.ConversationHead=P.modules.Token.extend({events:{"click .headWrapper":"onClick"},CssClassName:_.extend(P.modules.Token.prototype.CssClassName,{DROPPABLE_HOVER:P.CONST.CLASS_DROPPABLE_HOVER,INACTIVE:"inactive",TOUCH:"touch"}),onContentReady:function(){"ontouchstart"in window&&this.$el.addClass(this.CssClassName.TOUCH);var a=this.$el;this.options.inactive?window.setTimeout(function(){a.addClass(this.CssClassName.INACTIVE)}.bind(this),100):this.$el.removeClass(this.CssClassName.INACTIVE),this.triggerEvent(P.CONST.EVENT_CONVERSATION_HEAD_READY,null,!0)},getBadgeCount:function(){return this.options.badge_count},setBadgeCount:function(a){this.options.badge_count=a,this.render()},setActive:function(){this.options.inactive=!1,this.$el.removeClass(this.CssClassName.INACTIVE)},setInactive:function(){this.options.inactive=!0,this.$el.addClass(this.CssClassName.INACTIVE)},getUsers:function(){return this.options.users||[]},toggleDroppableHover:function(a){this.$el.toggleClass(this.CssClassName.DROPPABLE_HOVER,a)},getUserIds:function(){return _.pluck(this.getUsers(),"id")},getExternalEmails:function(){return this.options.emails||[]},getAllUserIds:function(){return this.getUserIds().concat(this.getExternalEmails())},getFirstUserId:function(){return this.getAllUserIds()[0]},onClick:function(){this.triggerEvent(P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,null,!1)}}),goog.provide("P.modules.CreateConversationGroup"),goog.require("P.conversationsUtil"),goog.require("P.Module"),goog.require("P.modules.ConversationHead"),P.modules.CreateConversationGroup=P.Module.extend({mixins:[P.Mixins.PreventScroll],events:{"click .tokenized":"onTokenizedAreaClick"},focus:function(){var a=this.getTypeaheadField();a.focus()},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClicked),this.childListen(P.CONST.EVENT_TOKEN_REMOVED,this.onTokenRemoved),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onEnterPressed),this.childListen(P.CONST.EVENT_TOKEN_ADDED,this.onTokenAdded),this.childListen(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,this.onListItemClicked),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.userIds=[],this.emails=[]},onEnterPressed:function(a){var b=this.getTypeaheadField();b.getTypeaheadHighlightedItem()||"input"===a.target.id||this.userIds.length&&this._triggerSendEvent()},getTokenizedInput:function(){return this.getTypeaheadField().getChildById("tokenizedInput")},getTypeaheadField:function(){return this.getChildById("searchField")},onTokenizedAreaClick:function(){this.focus()},onTokenAdded:function(a){var b=a.data,c=b.getUsers(),d=b.getFirstUserId();c.length>0?this.userIds.push(d):this.emails.push(d),this._setListItemWithUserId(d,!0),this.setSendButtonEnabled(!0),this.focus()},onTokenRemoved:function(a){var b=a.data,c=b.getFirstUserId(),d=_.indexOf(this.userIds,c),e=_.indexOf(this.emails,c);-1!==d?this.userIds.splice(d,1):-1!==e&&this.emails.splice(e,1),this._setListItemWithUserId(c,!1),this._getTotalUsersCount()||this.setSendButtonEnabled(!1),this.focus()},_getTotalUsersCount:function(){return this.userIds.length+this.emails.length},_setListItemWithUserId:function(a,b){this._getConversationsList().setListItemWithUserId(a,b)},_getConversationsList:function(){return this.getChildById("convosList")},onContentReady:function(){this._setup(),this.focus(),this.startPreventingScroll()},adjustTokenizedInputWidth:function(){var a=this.getTypeaheadField(),b=this.getWidth(),c=10,d=this.$(".placeholder").width();a.getContent().width(b-2*c-d)},onTypeaheadItemSelected:function(a){a.stopPropagation();var b=a.target;b.parent.reset();var c,d=a.data.item.attributes,e=d.email;c=e?{id:e}:{id:d.id,username:d.username,image_large_url:d.image_medium_url},this.setSendButtonEnabled(!0),this._addConversationHeadAsToken(c)},_addConversationHeadAsToken:function(a){var b=this.getTokenizedInput(),c=b.getTokens(),d=_.find(c,function(b){return b.getFirstUserId()===a.id});if(!d){var e={size:"small",users:[],emails:[]};a.username?e.users=[a]:e.emails=[a.id];var f=new P.modules.ConversationHead({options:e});f.render().then(function(){b.addTokensAndUpdateInputView([f])})}this.focus()},_setup:function(){this.inDom&&this.contentReady&&(this.adjustTokenizedInputWidth(),this.focus())},setSendButtonEnabled:function(a){var b=this.$(".cancelButton"),c=this.$(".sendToGroupButton");a?(b.hide(),c.show()):(b.show(),c.hide())},_removeHeadForUser:function(a){var b=this.getTokenizedInput(),c=b.getTokens();_.each(c,function(c){a.id===c.getFirstUserId()&&b.removeToken(c)})},_addUserAsToken:function(a){this._addConversationHeadAsToken(a)},onListItemClicked:function(a){a.stopPropagation();var b=a.target,c=b.getFirstUser();b.isActive()?this._removeHeadForUser(c):(b.setActive(!0),this._addUserAsToken(c))},onAddedToDom:function(){this._setup()},startPreventingScroll:function(){this.startPreventScroll(this.$(".ConversationsList"),this.$(".List"))},onButtonClicked:function(a){var b=a.target.id;"sendToGroupButton"===b&&this._triggerSendEvent()},_triggerSendEvent:function(){this.triggerEvent(P.CONST.EVENT_SEND_OBJECT_TO_USERS,{user_ids:this.userIds,emails:this.emails},!0)}}),require("common/lib/external/modernizr-2.7.1-custom.js"),goog.provide("P.modules.Dropdown"),goog.require("P.modules.PositionModule"),goog.require("P.HoverIntent");var DROPDOWN_CONTAINER_CLASS="dropdownContainer";P.modules.Dropdown=P.modules.PositionModule.extend({events:{keyup:"_onKeyUp"},CssClassName:_.extend(P.modules.PositionModule.prototype.CssClassName,{FADE_IN:"fadeIn",HIDE:"hideModule",IS_ACTIVE:"active",IS_EMPTY:"isEmpty",IS_EMPTY_WITHOUT_FRIENDS:"isEmptyWithoutFriends",MODAL:"Modal",SLIDE_IN:"slideIn"}),_onKeyUp:function(a){switch(a.keyCode){case P.keyCode.ESCAPE:a.stopPropagation(),a.stopImmediatePropagation(),this.hide(),this.triggerEvent(P.CONST.EVENT_ESCAPE_DROPDOWN,this)}},onCreated:function(){P.modules.PositionModule.prototype.onCreated.apply(this,arguments),this.renderPromise=null,this.showing=!1,this._setAllowPositioning(!1),this.childListen(P.CONST.EVENT_DISMISS,this.hide),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.hide),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE_NOT_PROPAGATE,this.hideWithoutTriggering),this.childListen(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS,this.onIsEmptyWithoutFriends),this.childListen(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY,this.onIsEmpty),this.options.persist_through_navigate||(this.childListen(P.CONST.EVENT_NAVIGATE,this.hide),this.listen(P.router.get(),P.CONST.EVENT_ROUTE_MATCHED,this.hide)),this.childListen(P.CONST.EVENT_EXTERNAL_CLICK,this.hide),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.positionModule),this.childListen(P.CONST.EVENT_CHANGE,this.positionModule)},onIsEmpty:function(){this.$el.addClass(this.CssClassName.IS_EMPTY)},onIsEmptyWithoutFriends:function(){this.$el.addClass(this.CssClassName.IS_EMPTY_WITHOUT_FRIENDS)},_positionIfReady:function(){this.inDom&&this.contentReady&&(this.positionModule(),this.ensureHoverIntent(),this.getPositionAnchor().initHovering())},onAdded:function(){this.options.prefetch&&(this.options.prefetch=!1,this.render())},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){this._positionIfReady()},onOptionsChanged:function(){this.renderPromise=null},getLoadingSpinnerOptions:function(){return _.extend(P.modules.PositionModule.prototype.getLoadingSpinnerOptions.call(this),{size:P.Spinner.Size.SMALL})},render:function(){var a=this._renderInternal2();return this.renderPromise=a,a},_renderInternal2:function(){return new Promise(function(a){this.renderContainer();var b=this.$el;this.options.append_to_closeup?$(".Closeup").append(b):$("body").append(b);var c=function(){this.contentReady=!0,this.onContentReady(),a()}.bind(this),d=this.getPositionElement();this.options.title&&d.append('<h2 class="dropdownTitle">'+this.options.title+"</h2>"),this.options.text&&d.append('<p class="dropdownText">'+this.options.text+"</p>"),this.options.module?P.loadModule(this.options.module).then(function(a){this.setContentModule(a);var b=a.data?a.renderExistingData():a.render();b.then(c),this.options.display_while_loading&&c()}.bind(this)):c(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0)}.bind(this))},setSticky:function(a){var b=_.clone(this.options);b.sticky=a,this.setOptions(b)},ensureHoverIntent:function(){this.parent.isClickButton&&!this.parent.isClickButton()&&(this._hoverIntent||this.options.manually_close||(this._hoverIntent=new P.HoverIntent(this.$el,{exitDelay:500}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,function(){this.getPositionAnchor().isHovering()||this.hide()})))},_hide:function(){this.showing=!1,this._setAllowPositioning(!1),this.options.custom_animation?this.getContentModule().animateOutDropdown(function(){this.$el.removeClass(this.CssClassName.IS_ACTIVE)
}.bind(this)):this.$el.removeClass(this.CssClassName.IS_ACTIVE).removeClass(this.CssClassName.SLIDE_IN),this._bodyListener&&(this.removeListener(this._bodyListener),this._bodyListener=null)},hideWithoutTriggering:function(){this._hide()},hide:function(){if(this.showing&&(this._hide(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),this.children.length)){var a=this.getContentModule();a.trigger(P.CONST.EVENT_DROPDOWN_CONTAINER_HIDDEN,null)}},_ensureModule:function(){return this.renderPromise||(this.renderPromise=this.render()),this.renderPromise},ensureOpenListeners:function(){this.options.sticky||(this._bodyListener=this.listen($(document),"mousedown touchstart",this._onMouseDown))},_onMouseDown:function(a){var b=this.options.mouse_close_mode;switch(b){case"never":return;case"always":return void this.hide();case"ignore_modal_click":if($(a.target).parents(".Modal").length>0||$(a.target).hasClass(this.CssClassName.MODAL))return}var c=$(a.target).closest(this.$el).length>0||$(a.target).closest(this.options.anchor).length>0;c||this.hide()},isShowing:function(){return this.showing},updateMaxHeight:function(){if(this.children.length){var a=this.getContentModule();if(this.options.constrain_height){var b=a.getHeight(!0),c=parseInt(this.$el.css("top"),10)||0,d=Math.max(P.Viewport.height-c-P.CONST.PIN_MARGIN,0);b>d&&a.getContent().css({"max-height":d,"overflow-y":"auto"})}}},show:function(a){return this.showing?void 0:(this.showing=!0,this._setAllowPositioning(!0),this.ensureOpenListeners(),this._ensureModule().then(function(){if(this.showing){this.$el.addClass(this.CssClassName.IS_ACTIVE),this.positionModule(),this.updateMaxHeight();var b=this.getContentModule();b&&P.deferDomManipulation(function(){b.trigger(P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN,null),b.focus()}),a&&P.dom.deferWrite().then(a)}this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,{moduleName:"Dropdown",action:P.CONST.ViewActions.OPEN,options:this.options})}.bind(this)))},reposition:function(a){this.showing&&(this.$el.addClass(this.CssClassName.IS_ACTIVE),this.positionModule(),this.updateMaxHeight(),a&&a())},fadeIn:function(a){this.show(function(){this.$el.addClass(this.CssClassName.FADE_IN),a&&a()}.bind(this))},slideIn:function(){return this.$el.addClass(this.CssClassName.HIDE),new Promise(function(a){this.show(function(){this.options.custom_animation?(this.$el.removeClass(this.CssClassName.HIDE),this.getContentModule().animateInDropdown()):"undefined"!==typeof Modernizr&&Modernizr.csstransforms3d?this.$el.addClass(this.CssClassName.SLIDE_IN):this.$el.removeClass(this.CssClassName.HIDE),a(void 0)}.bind(this))}.bind(this))},getDropdown:function(){return this.$("."+DROPDOWN_CONTAINER_CLASS)},isVisible:function(){return this.$el.hasClass(this.CssClassName.IS_ACTIVE)},setVisible:function(a){return this.$el.toggleClass(this.CssClassName.IS_ACTIVE,a)},isHovering:function(){return this.$el.isHovering()},initHovering:function(){this.$el.initHovering()},getContentModule:function(){return this.children[0]},getContentModulePromise:function(){return this._ensureModule().then(function(){return this.getContentModule()}.bind(this))},setContentModule:function(a){var b=this.getContentModule();b&&b.destroy(),this.insertChild(a,this.getPositionElement())}}),goog.provide("P.modules.DropdownButton"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.modules.Dropdown"),goog.require("P.modules.Dropdown2"),goog.require("P.HoverIntent");var TUTORIAL_DROPDOWN="tutorialDropdown",CLICK="click",HOVER="hover",OPEN_STRATEGY={};OPEN_STRATEGY[CLICK]=CLICK,OPEN_STRATEGY[HOVER]=HOVER,P.modules.DropdownButton=P.modules.Button.extend({CssClassName:P.modules.Button.prototype.CssClassName,onClick:function(a){if(this.options.check_write_banned&&P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this);else if(this.options.check_limited_login&&P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(this);else{if(this.openStrategy===HOVER)return!1;this._ensureDropdown();var b=this._dropdown.isVisible();b?this.hideDropdown():this.showDropdown()}this._logContextEvent(a),a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault()},onCreated:function(){this._dropdown=null,this.openStrategy=this.options.show_dropdown_on_hover?OPEN_STRATEGY[HOVER]:OPEN_STRATEGY[CLICK]},getDropdown:function(){return this._ensureDropdown(),this._dropdown},getDropdownOptions:function(){return this.options.dropdown_options||{}},getContentModuleLoadOptions:function(){return this.options.submodule},_ensureDropdown:function(){if(!this._dropdown){var a,b=this.options.anchor_selector;b&&(a="."+b);var c={anchor:a?a:this.$el,module:this.getContentModuleLoadOptions()};_.extend(c,this.getDropdownOptions());var d=this.options.use_dropdown2?P.modules.Dropdown2:P.modules.Dropdown;this._dropdown=new d({id:"dropdown",options:c}),this._dropdown.initHovering(),this.listen(this._dropdown,P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.addChild(this._dropdown)}},onMouseEnterComplete:function(){this.isHoverEnabled()&&this.$el.isHovering()&&this.showDropdown()},showDropdown:function(a){this.setActive(!0),this.hideTutorial(),this._ensureDropdown(),this._dropdown.slideIn(200).then(a)},hideDropdown:function(){this._dropdown&&this._dropdown.hide()},isDropdownVisible:function(){return this._ensureDropdown(),this._dropdown.isVisible()},onMouseOutComplete:function(){this._ensureDropdown(),this._dropdown.isHovering()||this.hideDropdown()},initListeners:function(){this.openStrategy!==CLICK&&(!this._hoverIntent||this._hoverIntent.isElement(this.$el))&&(this._hoverIntent=new P.HoverIntent(this.$el,{enterDelay:5,exitDelay:200}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE,function(){this.onMouseEnterComplete()}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,function(){this.onMouseOutComplete()}))},onButtonClick:function(a){a.stopPropagation()},onContentReady:function(){var a=!!this.getDropdownOptions().prefetch;a&&this._ensureDropdown(),this.$el.initHovering(),this.childListen(P.CONST.EVENT_TUTORIAL_SHOW,this.showTutorial),this.initListeners(),this.options.tutorial&&this.options.tutorial.topic&&this.options.tutorial.show&&this.showTutorial()},onDropdownHide:function(){this.setActive(!1),this.$el.focusWithoutScrolling()},ensureTutorialDropdown:function(){if(!this.getChildById(TUTORIAL_DROPDOWN)){var a=_.extend({},this.options.dropdown_options,{title:this.options.tutorial.title,text:this.options.tutorial.text,anchor:this.$el,class_name:"tutorial",largeCaret:!1}),b=new P.modules.Dropdown({id:TUTORIAL_DROPDOWN,options:a});this.appendChild(b)}return this.getChildById(TUTORIAL_DROPDOWN)},onShowTutorial:function(){this.showTutorial()},isClickButton:function(){return this.openStrategy===CLICK},showTutorial:function(){if(this.options.tutorial){var a=this.ensureTutorialDropdown();a.fadeIn(),this.setExperienceViewed()}},hideTutorial:function(){if(this.options.tutorial){var a=this.getChildById(TUTORIAL_DROPDOWN);a&&a.destroy(),this.setExperienceCompleted()}},setExperienceViewed:function(){if(this.options.tutorial.experienceId&&this.options.tutorial.placementId){var a=P.ExperienceManager.instance();a.viewPlacedExperience(this.options.tutorial.placementId,this.options.tutorial.experienceId)}},setExperienceCompleted:function(){if(this.options.tutorial.experienceId&&this.options.tutorial.placementId){var a=P.ExperienceManager.instance();a.completePlacedExperience(this.options.tutorial.placementId,this.options.tutorial.experienceId)}},isHoverEnabled:function(){return this.options.disabled!==!0&&this.openStrategy!==CLICK}}),goog.provide("P.modules.EmptyStateCardBoard"),goog.require("P.modules.EmptyStateCard"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.EmptyStateCardBoard=P.modules.EmptyStateCard.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var a=this.options.is_own_board;P.browserExtension.instance.isExtensionInstalled()&&a&&(P.modules.EmptyStateCard.prototype.setFooterIsVisible.call(this,!1),P.modules.EmptyStateCard.prototype.setActionButtonIsVisible.call(this,!1))},onButtonClick:function(a){var b=a.target;b.showLoading();var c=new P.modules.BrowserButtonUpsell({options:{extension_installed:P.browserExtension.instance.isExtensionInstalled(),suppress:!1}});c.render().then(function(){b.hideLoading(),this.showInModal(c)}.bind(this))}}),goog.provide("P.modules.EmptyStateCardProfileLikes"),goog.require("P.modules.EmptyStateCard"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.EmptyStateCardProfileLikes=P.modules.EmptyStateCard.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var a=this.options.is_own_profile;P.browserExtension.instance.isExtensionInstalled()&&a&&(P.modules.EmptyStateCard.prototype.setFooterIsVisible.call(this,!1),P.modules.EmptyStateCard.prototype.setActionButtonIsVisible.call(this,!1))},onButtonClick:function(a){var b=a.target;b.showLoading();var c=new P.modules.BrowserButtonUpsell({options:{extension_installed:P.browserExtension.instance.isExtensionInstalled(),suppress:!1}});this.showInModal(c),b.hideLoading()}}),goog.provide("P.modules.EmptyStateCardProfilePins"),goog.require("P.modules.EmptyStateCard"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.EmptyStateCardProfilePins=P.modules.EmptyStateCard.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var a=this.options.is_own_profile;P.browserExtension.instance.isExtensionInstalled()&&a&&(P.modules.EmptyStateCard.prototype.setFooterIsVisible.call(this,!1),P.modules.EmptyStateCard.prototype.setActionButtonIsVisible.call(this,!1))},onButtonClick:function(a){var b=a.target;b.showLoading();var c=new P.modules.BrowserButtonUpsell({options:{extension_installed:P.browserExtension.instance.isExtensionInstalled(),suppress:!1}});this.showInModal(c),b.hideLoading()}}),goog.provide("P.modules.ExperienceNag"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.ExperienceNag=P.modules.HeroHelperBase.extend({events:{"click .nagClose":"onCloseButtonClick"},onCloseButtonClick:function(){this.destroy(),P.trackGAEvent("nag",P.CONST.GA_ACTION_CLICK_CLOSE,"type",this.extraData.type)},onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.call(this),this.options.type=P.Experiences.ExperienceReverse[String(this.experienceId)]}}),goog.provide("P.modules.ExtensionInstallToast"),goog.require("P.Module"),goog.require("P.modules.ToastBase"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.ExtensionInstallToast=P.modules.ToastBase.extend({events:{"click .toastWrapper":"onToastClick"},onContentReady:function(){P.ContextLogger.getInstance().logCustomViewEvent(P.ContextLogging.ViewType.SAVE,P.ContextLogging.ViewParameterType.EXTENSION_UPSELL_TOAST)},onToastClick:function(a){this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.GET_EXTENSION_BUTTON,P.ContextLogging.ComponentType.BROWSER,{}),a.preventDefault();var b={name:"BrowserButtonUpsell",options:{extension_installed:P.browserExtension.instance.isExtensionInstalled()}};P.loadModule(b).then(function(a){P.getToastsManager().removeAllToasts(),this.modal?this.modal.setSubmodule(a):this.showInModal(a)}.bind(this))}}),goog.provide("P.modules.FacebookConnectLink"),goog.require("P.Module"),goog.require("P.modules.LoginBase"),P.modules.FacebookConnectLink=P.modules.LoginBase.extend({events:{click:"facebookConnect"}}),goog.provide("P.modules.FeedUsers"),goog.require("P.Module"),goog.require("P.modules.User"),P.modules.FeedUsers=P.Module.extend({unusedPinfluencers:[],onContentReady:function(){var a=this.data?_.pluck(this.data,"id"):[],b=this.resource.options.num_featured_users;this.unusedPinfluencers=a.length>b?a.slice(b):[],this.destroyIfEmpty()||this.childListen(P.CONST.EVENT_USER_FOLLOW,this.onChildActionTaken)},onChildActionTaken:function(a){var b=a.target;this.dismissUser(b)},dismissUser:function(a){a&&a.fadeOut(function(){this.unusedPinfluencers.length?this.replaceUser(a):this.removeUser(a)}.bind(this))},replaceUser:function(a){var b=this.unusedPinfluencers.pop();if(b){var c=new P.modules.User({resource:{name:"UserResource",options:{field_set_key:"grid_item",user_id:b}}});c.render().then(function(){c.show(),this.removeChild(a),this.appendChild(c),c.fadeIn()}.bind(this))}},removeUser:function(a){this.removeChild(a);var b=this.getChildByModuleName("User");b||this.remove(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}}),goog.provide("P.modules.FlatSignupUserRegister"),goog.require("P.modules.UserRegister"),goog.require("P.Module"),P.modules.FlatSignupUserRegister=P.modules.UserRegister.extend({CssClassName:_.extend(P.modules.UserRegister.prototype.CssClassName,{ERROR_TOOLTIP:"errorTooltip"}),onContentReady:function(){this.$emailInput=this.$("input[name='email']"),this.$passwordInput=this.$("input[name='password']"),this.$userFullNameInput=this.$("input[name='full_name']"),this.$userAgeInput=this.$("input[name='age']"),this.emailTooltip=this.$("#emailTooltip"),this.passwordTooltip=this.$("#passwordTooltip"),this.nameTooltip=this.$("#nameTooltip"),this.ageTooltip=this.$("#ageTooltip"),this.emailStep=this.$(".emailStep"),this.nameGenderAgeStep=this.$(".nameGenderAgeStep"),this.currentStep=1,this.setupForm(),this.errorTypesToTooltips={emailError:this.emailTooltip,passwordError:this.passwordTooltip,nameError:this.nameTooltip,ageError:this.ageTooltip},this.stepToNextButton=[this.$(".emailComplete"),this.$(".completeSignup")],this.$el.keypress(function(a){a.keyCode===P.keyCode.ENTER&&this.stepToNextButton[this.currentStep-1].click()}.bind(this))},submitFirstStep:function(){P.trackRegisterAction("3step_signup_email_step_1_click"),this.validateFirstStep()},submitSecondStep:function(){P.trackRegisterAction("3step_signup_email_step_2_click"),this.validateSecondStep()},secondStepComplete:function(){this.validateComplete()},validateComplete:function(a){if(a&&a.message){var b=this.errorTypesToTooltips[a.type];b===this.nameTooltip?this.ageTooltip.fadeOut():b===this.ageTooltip?this.nameTooltip.fadeOut():b===this.emailTooltip?this.passwordTooltip.fadeOut():b===this.passwordTooltip&&this.emailTooltip.fadeOut(),b.addClass(this.CssClassName.ERROR_TOOLTIP),b.find(".errorText").html(a.message),b.fadeIn()}else 1===this.currentStep?(P.trackRegisterAction("3step_signup_email_step_1_complete"),this.currentStep=2,this.emailStep.fadeOut(P.CONST.TRANSITION_DELAY).next(this.nameGenderAgeStep).delay(1.5*P.CONST.TRANSITION_DELAY).fadeIn(function(){this.$userFullNameInput.focus()}.bind(this))):2===this.currentStep&&(P.trackRegisterAction("3step_signup_email_step_2_complete"),this.stepToNextButton[this.currentStep-1].submit())}}),goog.provide("P.modules.FollowButton"),goog.require("P.modules.Button"),goog.require("P.modules.Dropdown");var UNFOLLOW_CLASS="dim",FOLLOW_CLASS="primary",MEMO_DROPDOWN="memoDropdown";P.modules.FollowButton=P.modules.Button.extend({getResourceId:function(){return null},getFollowResource:function(){return null},getFollowClass:function(){return FOLLOW_CLASS},getUnfollowClass:function(){return UNFOLLOW_CLASS},toggleState:function(){this.setState(!this.options.followed),this.trigger("toggleFollow"),this.getResourceId()&&P.pubsub.publish(this.getResourceId(),this.options.followed?P.CONST.PUBSUB_TOPIC_USER_FOLLOW:P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW,!0)},setState:function(a){this.options.text=this.options[a?"unfollow_text":"follow_text"],this.options.followed=a,this.renderExistingData()},getState:function(){return this.options.followed},toggleFollow:function(){var a=this.getFollowResource();if(!a)return void this.log.error("No resource returned in `getFollowResource()`");this.showLoading();var b=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;(this.options.followed?a.callDelete():a.callCreate()).then(function(){b&&P.trackGAEvent(b,P.CONST.GA_ACTION_SUCCESS),this.toggleState()}.bind(this),function(){b&&P.trackGAEvent(b,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))},onClick:function(){if(this.ensureAuthentication()&&!this.options.is_me){var a=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;return a&&P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),this.toggleFollow(),!1}},getAuthRedirectUrl:function(){return P.getRegisterUrl({action:"follow"})},hideMemo:function(){if(this.options.memo){var a=this.getChildById(MEMO_DROPDOWN);a&&a.fadeOut(function(){a.destroy()})}},showMemo:function(){var a=this.options.memo&&this.options.memo.show;if(a&&!this.getChildById(MEMO_DROPDOWN)){this.isClickButton=function(){return!1};var b=this.options.memo.position_point?this.options.memo.position_point:"RIGHT_CENTER",c={title:this.options.memo.title,anchor:this.$el,position_point:b,class_name:"autoFollowMemo",largeCaret:!1},d=new P.modules.Dropdown({id:MEMO_DROPDOWN,options:c});this.appendChild(d),d.fadeIn(function(){P.setTimeout(function(){this.hideMemo()}.bind(this),5e3)}.bind(this))}}}),goog.provide("P.modules.FollowerCount"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.FollowerCount=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowerChange,a[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onFollowerChange,this.pubsubSubscribe(this.data.id,a),P.modules.NavigateButton.prototype.onContentReady.call(this)},onFollowerChange:function(){this.render()}}),goog.provide("P.modules.FollowingCount"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.FollowingCount=P.Module.extend({onContentReady:function(){P.modules.NavigateButton.prototype.onContentReady.call(this);var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowingChange,a[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onFollowingChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onFollowingChange:function(){this.render()}}),goog.provide("P.modules.FriendsToFollow"),goog.require("P.Module"),goog.require("P.modules.User"),P.modules.FriendsToFollow=P.Module.extend({friendIdsUsed:[],friendsUnused:[],usersToReplace:[],usersDismissing:[],onContentReady:function(){this.friendIdsUsed=this.extraData.friendIdsUsed,this.invite_mode="invites"===this.options.mode,this.list=this.getChildByModuleName("List"),this.destroyIfEmpty()||(this.childListen(P.CONST.EVENT_DISMISS,this.onChildDismiss),this.childListen(P.CONST.EVENT_USER_FOLLOW,this.onChildActionTaken),this.childListen(P.CONST.EVENT_INVITE_USER,this.onChildActionTaken)),this.invite_mode&&P.fb.ensureInit(P.NOOP)},onChildDismiss:function(a){var b,c=a.target;this.invite_mode?(b=P.resourceFactory.create("UserInviteSuggestionResource",{}),b.set("hash_id",c.getUserId())):(b=P.resourceFactory.create("UserFriendSuggestionResource",{}),b.set("user_id",c.getUserId())),b.callDelete(),this.dismissUser(c)},onChildActionTaken:function(a){var b=a.target;window.setTimeout(function(){if(this.dismissUser(b),this.invite_mode){var a=P.resourceFactory.create("UserInviteSuggestionResource",{});a.set("hash_id",b.getUserId()),a.callDelete()}}.bind(this),500)},requestMoreFriendsIfNeeded:function(){var a=this.friendsUnused,b=this.usersDismissing.length+this.usersToReplace.length;a.length>=b||this.resource.xhr||(this.resource.resetBookmark(),this.invite_mode?this.resource.options.excluded_hash_ids=this.friendIdsUsed:this.resource.options.excluded_user_ids=this.friendIdsUsed,this.resource.callGet().then(function(a){var b=a.resource_response.data;for(this.friendsUnused=b;this.usersToReplace.length;){var c=this.usersToReplace.shift();this.replaceUser(c)}}.bind(this)))},dismissUser:function(a){a&&(this.usersDismissing.push(a),a.fadeOut(function(){this.usersDismissing=_.without(this.usersDismissing,a),this.friendsUnused.length?this.replaceUser(a):(this.usersToReplace.push(a),this.requestMoreFriendsIfNeeded())}.bind(this)))},getHeaderElement:function(){return this.$(".memoTitle")},replaceUser:function(a){var b=a.$el.parent(),c=this.friendsUnused.pop();return c?(this.invite_mode?(a.options.contact_info=c,this.friendIdsUsed.push(c.hash_id)):(a.resource.options.user_id=c.id,this.friendIdsUsed.push(c.id)),void a.render().then(function(){a.show(),this.list.removeChild(a),b.remove(),this.list.$el.append(b),this.list.insertChild(a,b),a.fadeIn()}.bind(this))):(this.list.removeChild(a),void b.remove())}}),goog.provide("P.modules.GeoFeatureList"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),P.modules.GeoFeatureList=P.Module.extend({events:{"click .dropdownTarget":"onTargetClick"},onListItemClick:function(a){var b=$(a.data).attr("data-index"),c=this.options.features[b];this.options.active_feature=c,this.hideDropdown(),this.render().then(function(){this.triggerEvent(P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST,c,!0)}.bind(this))},onContentReady:function(){var a={module:this.getContentModuleLoadOptions(),anchor:this.$(".dropdownTarget"),class_name:"aboveModal geoFeatureDropdown",prefetch:!0,position_point:"BOTTOM_LEFT"};this.options.active_feature=null,this._dropdown=new P.modules.Dropdown({options:a,id:"dropdown"})},updateFeatures:function(a){this.options.active_feature=null,this.options.features=a,this.render()},getContentModuleLoadOptions:function(){return{name:"List",options:{items:this.options.features}}},hideDropdown:function(){this._dropdown.hide()},onTargetClick:function(){if(this._dropdown.isShowing())this.hideDropdown();else{var a=this;this._dropdown.show(function(){var b=a._dropdown.getChildByModuleName("List");a.listen(b,P.CONST.EVENT_LIST_ITEM_CLICK,a.onListItemClick)})}}}),goog.provide("P.modules.Grid"),goog.require("P.Module"),goog.require("P.modules.GridFooter"),goog.require("P.modules.GridItems");var SCROLL_MARGIN_ERROR=2,UNAUTH_BANNER_HEIGHT=240;P.modules.Grid=P.Module.extend({events:{"click .navigator.left em":"onLeftNavigatorClick","click .navigator.right em":"onRightNavigatorClick"},CssClassName:{ERROR:"hasError",LOADING:"loading"},DRAGGING_ENABLED:"draggingEnabled",DRAGGING_DISABLED:"draggingDisabled",onContentReady:function(){if(this.options.show_grid_footer&&(this.childListen(P.CONST.EVENT_ERROR,this.onError),this.childListen(P.CONST.EVENT_ERROR_RESOLVED,this.onErrorResolved),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_START,this.onItemsRequestStart),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onItemsRequestSuccess),this.childListen(P.CONST.EVENT_ITEMS_END,this.onItemsEnd),this.items=this.getChildByModuleName("GridItems"),this.footer=this.getChildByModuleName("GridFooter"),this._initializeDragManagerIfPossible(),this.footer&&this.hasItems()&&this.footer.show(),P.currentUser.isAuthenticated()){var a={};a[P.CONST.PUBSUB_TOPIC_CONVERSATION_ADDED]=this.onConversationAdded,a[P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS]=this.onNoActiveConversations,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,a),P.getConversationsManager().hasActiveConversations()||this.onNoActiveConversations()}else this.showingPageTwoSneakPeek=!1,this.options.scrollable&&"row_layout"!==this.options.layout?this.attachScrollListener():this.hasMoreItems()?(this.requestMoreItemsAndBlock(),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.requestMoreItemsAndBlock)):this.options.show_grid_footer&&this.addNegativeSpace();this.options.scrollable&&"row_layout"===this.options.layout&&this.attachRowSliderScrollListener()},attachScrollListener:function(){this.scrollListener&&this.removeListener(this.scrollListener),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll)},attachRowSliderScrollListener:function(){this.scrollListener&&this.removeListener(this.scrollListener),this.$gridContainer=this.$(".gridContainer"),this.$gridItems=this.$(".GridItems.rowLayout"),this.$leftNav=this.$(".navigator.left"),this.$rightNav=this.$(".navigator.right"),this.scrollListener=this.listen(this.$gridContainer,P.CONST.EVENT_SCROLL,this._onSliderScroll),this._onSliderScroll()},hasItems:function(){return this.items.hasItems()},hasItemsOfType:function(a){return!!this.items.getChildrenByModuleName(a).length},hasMoreItems:function(){return this.items.hasMoreItems()},getGridItemsChildren:function(){var a=this.getGridItems();return a.getChildren()},requestMoreItems:function(){this.items.requestMoreItems()},requestMoreItemsIfNeeded:function(){this.items.requestMoreItemsIfNeeded()},emptyItems:function(){this.items.empty()},renderItems:function(a,b){this.items.render().then(a,b)},setPageSize:function(a){this.items.setPageSize(a)},getItemsResource:function(){return this.items.resource},setItemsResource:function(a){this.setResource(a),this.items&&this.items.setResource(a)},onConversationAdded:function(){this.setDragState(this.DRAGGING_ENABLED)},onNoActiveConversations:function(){P.experiments.instance.inExperimentGroups("rearrange_pins",["enabled","employees"])||this.setDragState(this.DRAGGING_DISABLED)},onError:function(){this.hasError=!0,this.$el.addClass(this.CssClassName.ERROR),this.footer&&(this.footer.showError(),this.footer.hideGridLoading())},onErrorResolved:function(){this.hasError&&(this.hasError=!1,this.$el.removeClass(this.CssClassName.ERROR))},onButtonClick:function(a){return"gridFooter"===a.target.id&&this.requestMoreItems(),!1},onItemsRequestStart:function(){this.footer&&this.footer.showGridLoading(),this.$rightNav&&this.$rightNav.addClass(this.CssClassName.LOADING)},_initializeDragManagerIfPossible:function(){P.currentUser.isAuthenticated()&&(this.items.initializeDragManager({}),this.dragState&&this.setDragState(this.dragState,!0))},setDragState:function(a,b){(this.dragState!==a||b)&&(this.dragState=a,this.dragState===this.DRAGGING_DISABLED?this.items.disableDragging():this.items.enableDragging())},onItemsRequestSuccess:function(){this.footer&&this.footer.hideError(),this.$rightNav&&(this.$rightNav.removeClass(this.CssClassName.LOADING),this.$rightNav.show())},forceDragState:function(){this.setDragState(this.dragState,!0)},onItemsEnd:function(){this.footer&&this.footer.hideGridLoading(),this.$rightNav&&this.$rightNav.removeClass(this.CssClassName.LOADING)},prependChildItem:function(a){this.getGridItems().prependChildItem(a)},prependNewItems:function(a,b){return this.getGridItems().prependNewItems(a,b)},getGridItems:function(){return this.items},getFirstGridItem:function(a){return this.getGridItems().getChildByModuleName(a)},requestMoreItemsAndBlock:function(){var a=this.getGridItems();if(a&&a.isReady()&&!this.showingPageTwoSneakPeek){var b=this.$el.height();this.showingPageTwoSneakPeek=!0,this.requestMoreItems(),this.$el.height(b),this.$el.css("overflow-y","hidden"),this.$el.css("margin-bottom",0)}},addNegativeSpace:function(){this.$(".GridFooter").hide(),this.$el.css("padding-bottom",UNAUTH_BANNER_HEIGHT)},onScroll:function(){var a=this.getScrollableElement().scrollTop(),b=$(document).height()-this.getScrollableElement().height();a>=b-SCROLL_MARGIN_ERROR&&(this.addNegativeSpace(),this.removeListener(this.scrollListener))},_onSliderScroll:function(a){this.scrollLeft=a?a.target.scrollLeft:0,this.updateNavigators(),this.updateActiveItem(),this.scrollLeft>.9*this.$(".gridContainer").width()&&this.requestMoreItemsIfNeeded()},updateNavigators:function(){0===this.scrollLeft?this.hideLeftNavigator():this.showLeftNavigator(),this.scrollLeft<this.$gridItems.width()-this.$gridContainer.width()?this.showRightNavigator():this.$rightNav.hasClass(this.CssClassName.LOADING)||this.hideRightNavigator()},updateActiveItem:function(){if(this.currentlyActiveItem&&!this._inScrollTransition){var a=this.currentlyActiveItem.getContent(),b=a.offset().left,c=this.$gridContainer.width();(b<this.$leftNav.width()||b>c-a.width())&&(this.triggerEvent(P.CONST.EVENT_ROW_ITEM_DEACTIVATED,null,!0),this.currentlyActiveItem=null)}},hideLeftNavigator:function(){this.$leftNav.hide()},showLeftNavigator:function(){this.$leftNav.show()},hideRightNavigator:function(){this.$rightNav.hide()},showRightNavigator:function(){this.$rightNav.show()},onLeftNavigatorClick:function(){this.scrollSliderByPageOfItems(!0)},onRightNavigatorClick:function(){this.scrollSliderByPageOfItems(!1)},scrollSliderByPageOfItems:function(a){var b=this._getSliderValues(),c=a?1-b.numberOfItemsPerPage:b.numberOfItemsPerPage+1,d=b.marginLeftOffset-b.sideMarginWidth+c*b.widthPerItem;0===b.numberOfItemsPerPage&&(d=a?b.marginLeftOffset-b.widthPerItem:b.marginLeftOffset+b.widthPerItem),this.$gridContainer.animate({scrollLeft:this.scrollLeft+d},200)},scrollToItem:function(a){var b=a.getContent().offset().left,c=this._getSliderValues(),d=function(){this.currentlyActiveItem=a,this.triggerEvent(P.CONST.EVENT_SCROLL_GRID_TO_ITEM_END,a,!0)}.bind(this),e=0;if(b<c.sideMarginWidth)e=b-c.containerLeftOffset-c.sideMarginWidth;else{if(!(b>c.sliderWidth-c.sideMarginWidth-c.widthPerItem))return void d();e=b-c.containerLeftOffset-c.sliderWidth+c.widthPerItem+c.sideMarginWidth}this._inScrollTransition=!0,this.$gridContainer.animate({scrollLeft:e},300,"swing",function(){P.setTimeout(function(){d(),this._inScrollTransition=!1}.bind(this),100)}.bind(this))},_getSliderValues:function(){var a=this.$gridItems.offset().left,b=this.$gridContainer.width(),c=this.getGridItemsChildren()[0].getWidth()+P.CONST.PIN_MARGIN,d=Math.floor(.9*b/c),e=(b-d*c)/2,f=(this.$gridItems.offset().left-this.$gridContainer.offset().left)%c;return{containerLeftOffset:a,sliderWidth:b,widthPerItem:c,numberOfItemsPerPage:d,sideMarginWidth:e,marginLeftOffset:f}},increaseRowContainerHeight:function(a){var b=this.getGridItems().getContent(),c=this.getHeight(),d=c+a,e=c-d;this.$gridContainer.css({height:d,y:e}),b.css("y",-e),this.$el.css("height",c)},resetRowContainerHeight:function(){var a=this.getGridItems().getContent();this.$gridContainer.css({height:"",transform:""}),a.css("transform",""),this.$el.css({height:"",transform:""})},updateActiveGridItem:function(a){var b=this.getGridItems();b.setActiveItemById(a)}}),goog.provide("P.modules.HeroBasic"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroBasic=P.modules.HeroHelperBase.extend({onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.call(this),this.options.type=P.Experiences.ExperienceReverse[String(this.experienceId)],P.trackRegisterAction("web_hero_app_upsell_displayed_"+this.experienceId)},onButtonClick:function(a){var b=a.target;if("close"===b.id)return void this.dismiss();if(b.options)switch(b.options.action){case P.Experiences.ExperienceCompleteAction.COMPLETE:this.complete();break;case P.Experiences.ExperienceCompleteAction.COMPLETE_AND_SHOW:this.complete(!0);break;case P.Experiences.ExperienceCompleteAction.DONT_COMPLETE_AND_HIDE:this.hide();break;case P.Experiences.ExperienceCompleteAction.DONT_COMPLETE_AND_SHOW:break;default:this.hide()}}}),goog.provide("P.modules.HeroPinvitationalInvite"),goog.require("P.Module"),goog.require("P.modules.HeroBasic");var NAG_DISMISS_WAIT=6e3;P.modules.HeroPinvitationalInvite=P.modules.HeroBasic.extend({onContentReady:function(){P.modules.HeroBasic.prototype.onContentReady.call(this),P.trackRegisterAction("pinv_web_nag_shown");var a={};a[P.CONST.PUBSUB_TOPIC_PINVITATIONAL_INVITE]=this.onInvite.bind(this),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_PINVITATIONAL,a)},onButtonClick:function(a){P.modules.HeroBasic.prototype.onButtonClick.call(this,a);var b=a.target;if("inviteButton"===b.id){P.trackRegisterAction("pinv_web_nag_button_click");var c={name:"PinvitationalInviterWrapper",options:{source:"nag"}};P.loadModule(c).then(function(a){P.trackRegisterAction("pinv_web_inviter_shown_from_nag"),this.showInModal(a,{can_dismiss:!1,only_modal:!0})}.bind(this))}},onInvite:function(a,b,c){var d=c.numInvitesLeft;this._updateInviteButton(d),0===d&&P.setTimeout(function(){this.$el.slideUp()}.bind(this),NAG_DISMISS_WAIT)},_updateInviteButton:function(a){var b=this.getChildById("inviteButton"),c="";
a<1?(c=P._("0 invites left"),b.disable()):c=1===a?P._("Invite 1 friend"):P.string.format(P._("Invite {{ num }} friends"),{num:a}),b.setText(c)}}),goog.provide("P.modules.HeroRebuildFeed"),goog.require("P.Module"),goog.require("P.modules.HeroBasic");var PICKING_INTERESTS_STATE=1;P.modules.HeroRebuildFeed=P.modules.HeroBasic.extend({complete:function(a){var b=this.getChildById("complete");b.showLoading();var c=P.resourceFactory.create("UserStateResource",{state:"RESETTING_HOME_FEED",value:PICKING_INTERESTS_STATE});c.callCreate().then(function(){P.modules.HeroBasic.prototype.complete.apply(this,[a]),window.location.reload()}.bind(this),P.NOOP)}}),goog.provide("P.modules.HeroUndoRebuildFeed"),goog.require("P.Module"),goog.require("P.modules.HeroBasic");var MAX_NUM_CALLS_TO_TRY=10,POLL_INTERVAL=500,REBUILT_STATE=2;P.modules.HeroUndoRebuildFeed=P.modules.HeroBasic.extend({dismiss:function(){var a=this.getChildById("close");a.showLoading();var b=P.resourceFactory.create("OrientationContextResource",{});b.callDelete({showError:!1}).then(function(){this.pollFeedStatus(MAX_NUM_CALLS_TO_TRY)}.bind(this))},pollFeedStatus:function(a){a<=0&&window.location.reload();var b=P.resourceFactory.create("UserStateResource",{state:"RESETTING_HOME_FEED"});b.callGet({showError:!1}).then(function(b){b.resource_response.data!==REBUILT_STATE?window.location.reload():P.setTimeout(function(){this.pollFeedStatus(a-1)}.bind(this),POLL_INTERVAL)}.bind(this),function(){P.setTimeout(function(){this.pollFeedStatus(a-1)}.bind(this),POLL_INTERVAL)}.bind(this))}}),goog.provide("P.modules.HeroWebPush"),goog.require("P.Module"),goog.require("P.modules.HeroBasic"),P.modules.HeroWebPush=P.modules.HeroBasic.extend({complete:function(a){P.modules.HeroBasic.prototype.complete.apply(this,[a]),P.WebPushManager.instance().subscribe()}}),goog.provide("P.modules.HeroWeekInviter"),goog.require("P.Module"),goog.require("P.modules.HeroBasic"),P.modules.HeroWeekInviter=P.modules.HeroBasic.extend({onContentReady:function(){P.modules.HeroBasic.prototype.onContentReady.call(this),P.trackRegisterAction("week_inviter_nag_shown")},onButtonClick:function(a){P.modules.HeroBasic.prototype.onButtonClick.call(this,a);var b=a.target;if("inviteButton"===b.id){P.trackRegisterAction("week_inviter_nag_button_click");var c={name:"MultiInviter"};P.loadModule(c).then(function(a){P.trackRegisterAction("week_inviter_shown_from_nag"),this.showInModal(a,{can_dismiss:!0,only_modal:!0})}.bind(this))}}}),goog.provide("P.modules.IncrementingNavigateButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.IncrementingNavigateButton=P.modules.NavigateButton.extend({CssClassName:_.extend(P.modules.NavigateButton.prototype.CssClassName,{IS_HIDDEN:"hidden"}),onContentReady:function(){this.updateOptions({is_hidden:!this.getValue()}),this.listen(this,P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.makeVisible),this.listen(this,P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.makeInvisible)},getValue:function(){if(void 0===this.options.actionCount){var a=$.trim(this.$el.text());return parseInt(a,10)}return this.options.actionCount},setValue:function(a){this.options.actionCount=a,this.$el.text(a)},makeVisible:function(){this.options.is_hidden&&this.updateOptionsAndDom({is_hidden:!1})},makeInvisible:function(){this.options.is_hidden||this.updateOptionsAndDom({is_hidden:!0})},updateDom:function(){this.$el.toggleClass(this.CssClassName.IS_HIDDEN,this.options.is_hidden)},increment:function(){var a=this.getValue();isNaN(a)&&(a=0),this.triggerEvent(P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.options.siblingButtonId,!0),a+=1,this.setValue(a)},decrement:function(){var a=this.getValue();return a-=1,0===a?void this.triggerEvent(P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.options.siblingButtonId,!0):void this.setValue(a)}}),goog.provide("P.modules.InterestFollowButton"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.modules.FollowButton"),P.modules.InterestFollowButton=P.modules.FollowButton.extend({getResourceId:function(){return this.options.interest_id},getFollowResource:function(){var a={interest_list:P.CONST.INTEREST_LIST_FAVORITED,interest_id:this.getResourceId()};return this.options.referrer&&(a.referrer=this.options.referrer),P.resourceFactory.create("InterestFollowResource",a)},getFollowClass:function(){return this.options.follow_class},onContentReady:function(){this.showMemo()},onClick:function(a){if(P.modules.Button.prototype.onClick.call(this,a),!P.CONTEXT.is_mobile_agent||this.ensureAuthentication()){if(!P.currentUser.isAuthenticated())return P.signupModalManager.showInlineSignupModalOnButtonClick("InterestFollowButton");var b=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;b&&P.trackGAEvent(b,P.CONST.GA_ACTION_CLICK),this.toggleFollow()}}}),goog.provide("P.modules.InviteLanding"),goog.require("P.Module"),goog.require("P.modules.InviteModal.showInviteModal"),P.modules.InviteLanding=P.Module.extend({onContentReady:function(){P.trackRegisterAction("web_invite_landing"),P.Invite.trackInviteFunnelAction("invite_landing");var a=this.extraData.invite_type;switch(a){case"reminder_1":P.Invite.trackInviteFunnelAction("recipient_invite_reminder1_landing",!0);break;case"reminder_2":P.Invite.trackInviteFunnelAction("recipient_invite_reminder2_landing",!0);break;default:P.Invite.trackInviteFunnelAction("recipient_invite_landing",!0)}this.extraData.show_invite_modal&&P.modules.InviteModal.showInviteModal(this.options.inviter_user_id,"user")}}),goog.provide("P.modules.JoinButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.JoinButton=P.modules.NavigateButton.extend({getNavigateUrl:function(){return P.getRegisterUrl({action:"join"})}}),goog.provide("P.modules.Login"),goog.require("P.Module"),goog.require("P.modules.LoginBase"),P.modules.Login=P.modules.LoginBase.extend({events:{"focus input[name=username_or_email]":"onFocusEmail","click .forgotPassword":"onForgotPassword"},onFocusEmail:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onContentReady:function(){P.getQueryStringParams().auto_facebook_signup&&this.registerWithFacebook();var a={},b=this.options.invite_follow_board,c=this.options.invite_follow_user;return c&&(b?a.invite_follow_board=c+"/"+b:a.invite_follow_user=c,P.SessionStorage.setItem(P.CONST.SESSION_KEY_INVITE_FOLLOW,a)),!P.currentUser.isAuthenticated()||P.currentUser.get("autologin")||P.currentUser.isLimitedLogin()?(P.modules.LoginBase.prototype.onContentReady.apply(this,arguments),void(this.$inputEmail=this.$("input[name=username_or_email]"))):void this.redirect(a)},onForgotPassword:function(a){P.changeWindowLocation(""+$(a.target).attr("href"))}}),goog.provide("P.modules.LoginButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.LoginButton=P.modules.NavigateButton.extend({getNavigateUrl:function(){return P.getLoginUrl({action:"login"})}}),goog.provide("P.modules.Modal"),goog.require("P.modules.PositionModule"),goog.require("P.modules.Button"),goog.require("P.Module");var DURATION=300,CHROME_MOBILE_IOS="Chrome Mobile iOS";P.modules.Modal=P.modules.PositionModule.extend({events:{"click .modalScroller":"onModalScrollerClick","touchmove .modalScroller":"onModalScrollerTouchMoveOrMouseWheel","mousewheel .modalScroller":"onModalScrollerTouchMoveOrMouseWheel","click .closeModal":"onCloseModalClick","blur .modalScroller":"onKeyboardClose"},CssClassName:_.extend(P.modules.PositionModule.prototype.CssClassName,{SHOW:"show"}),positionMode:P.CONST.PositionMode.VIEWPORT_MIDDLE,onCreated:function(){P.modules.PositionModule.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildButtonClick)},_addSubmoduleToContainer:function(a){a.id="submodule",a.errorStrategy=P.CONST.ErrorStrategy.SHOW,this.insertChild(a,this.getModuleContainer());var b=a.render().then(function(){a.setModal(this)}.bind(this));return this.listen(a,P.CONST.EVENT_ERROR,function(a){var b=P.string.common.defaultErrorMessage;this.options.show_api_error&&a.data.message&&(b=a.data.message),P.showError(b),this.animateOutAndDestroy()}),b},onContentReady:function(){var a=this.getSubmodule();a&&a.setModal(this)},_showMask:function(){var a=this.getMask();P.dom.deferWrite().then(function(){a.addClass(this.CssClassName.SHOW)}.bind(this))},setVisible:function(a){this.$el.toggleClass(this.CssClassName.SHOW,a)},_isPanel:function(){return this.options.presentation_type===P.sharedConst.ModalPresentationType.PANEL},onRendered:function(){this.positionMode=this._isPanel()?P.CONST.PositionMode.MANUAL:P.CONST.PositionMode.VIEWPORT_MIDDLE},show:function(){if(this.positionModule(),this.$el.addClass(this.CssClassName.SHOW),this.options.custom_entrance_animation)P.dom.deferWrite().then(function(){this.getSubmodule().animateEntranceToModal()}.bind(this));else{var a=this.getSubmodule(),b=this.getModuleContainer();this._showMask(),a&&a.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_SHOW_START,null,!1);var c=this._isPanel()?{x:-b.width(),duration:1}:{duration:0},d=this._isPanel()?{x:0,easing:"cubic-bezier(.19, 1.15, .48, 1)",duration:DURATION}:{duration:0};b.transition(c,function(){this.getPositionElement().addClass(this.CssClassName.SHOW)}.bind(this)).transition(d,function(){P.dom.deferWrite().then(function(){a&&a.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_SHOW_END,null,!1)})})}},animateOutAndDestroy:function(){var a=this.getSubmodule();if(this.options.custom_exit_animation&&a)a.animateExitFromModal();else{var b=this.getModuleContainer(),c=this.getSubmodule(),d=this.getMask();P.dom.deferWrite().then(function(){d.removeClass(this.CssClassName.SHOW)}.bind(this)),c&&c.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_HIDE_START,null,!1);var e=this._isPanel()?{x:-b.width(),easing:"cubic-bezier(.36, -.15, .21, 1)",duration:DURATION}:{duration:0};b.transition(e,function(){var a=this.getSubmodule();a&&a.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_HIDE_END,null,!1),P.dom.deferWrite().then(function(){b.removeClass(this.CssClassName.SHOW)}.bind(this)),this.destroy()}.bind(this))}},onAddedToDom:function(){P.Body.pushScrolling(!1)},onRemovedFromDom:function(){P.Body.pop()},getSubmodule:function(){return this.getChildById("submodule")||null},getContent:function(){return this.$(".modalContent")},getModuleContainer:function(){return this.$(".modalModule")},getMask:function(){return this.$(".modalMask")},getModalScroller:function(){return this.$(".modalScroller")},getFullName:function(){var a=P.Module.prototype.getFullName.call(this);return this.moduleOpener&&(a=this.moduleOpener.getFullName()+"#"+a),a},getPositionElement:function(){return this.$(".modalContainer")},setSubmodule:function(a){var b=this.getChildById("submodule");return b&&(b.id="",b.remove()),this._addSubmoduleToContainer(a)},onChildRemoved:function(){this.getChildById("submodule")||this.destroy()},onChildButtonClick:function(a){var b=a.target;if(b&&b.isCancelButton()){var c=this.getSubmodule(),d=c.GACategory;d||(d=c.options.ga_category),d&&P.trackGAEvent(d,P.CONST.GA_ACTION_CLICK_CANCEL),a.stopPropagation(),this.animateOutAndDestroy()}},onModalScrollerClick:function(a){var b=$(a.target).closest(".modalContent").length>0;if(!b&&(a.stopPropagation(),this.getCanDismiss()&&this.getMaskCanDismiss())){this.animateOutAndDestroy();var c=this.getSubmodule();c&&c.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)}},onModalScrollerTouchMoveOrMouseWheel:function(a){var b=$(a.target).closest(".modalContent").length>0;b||(a.preventDefault(),a.stopPropagation())},onCloseModalClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.getSubmodule().triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.destroy()},onKeyboardClose:function(){P.CONTEXT.browser_name===CHROME_MOBILE_IOS&&window.scrollTo(0,1)},getCanDismiss:function(){var a=this.options.can_dismiss;return void 0===a||a},getMaskCanDismiss:function(){var a=this.options.mask_can_dismiss;return void 0!==a?!!a:!0}}),goog.provide("P.modules.ModalStepBase"),goog.require("P.interfaces.ModalTutorialStep"),goog.require("P.Module"),goog.require("P.modules.StepBase");var CLASS_TUTORIAL_HIGHLIGHT_MASK="tutorialHighlightMask",CLASS_TUTORIAL_HIGHLIGHT_BACKGROUND="tutorialHighlightBackground",LINK_HREF_ATTR="href";P.modules.ModalStepBase=P.modules.StepBase.extend({CssClassName:_.extend(P.modules.StepBase.prototype.CssClassName,{TUTORIAL_HIGHLIGHT:"tutorialHighlight"}),highlightedElements:{},initializeStep:function(){this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize)},disableCloneLinks:function(a){var b=a.find("a");_.each(b,function(a){var b=$(a),c=b.attr(LINK_HREF_ATTR);b.attr("data-href",c).removeAttr(LINK_HREF_ATTR)})},disableButtonCloneLinks:function(a){a.removeAttr(LINK_HREF_ATTR)},setModalPosition:function(a,b,c,d){var e="VIEWPORT_MIDDLE";a&&b&&(e="ANCHORED",this.modal.options.position_point=a,this.modal.options.anchor=b),this.modal.options.position_mode=e,void 0!==d&&(this.modal.options.fixed=d),this.modal.options.caret=!0,c&&this.modal.positionModule()},setCloneInteractions:function(a){var b=$("body"),c=$('<div class="'+CLASS_TUTORIAL_HIGHLIGHT_MASK+'"/>');c.addClass(this.CssClassName.TUTORIAL_HIGHLIGHT),b.append(c),a.$mask=c,this.disableCloneLinks(a)},setCloneBackground:function(a){var b=$("body"),c=$('<div class="'+CLASS_TUTORIAL_HIGHLIGHT_BACKGROUND+'"/>');c.addClass(this.CssClassName.TUTORIAL_HIGHLIGHT),b.append(c),a.$background=c},setCloneDimensions:function(a,b){var c=b.outerWidth()+1,d=b.outerHeight()+1;a.css({width:c,height:d,"box-sizing":"border-box"})},ensurePath:function(a){window.location.pathname!==a&&this.navigate(a)},cleanHighlightedElements:function(){$("."+this.CssClassName.TUTORIAL_HIGHLIGHT).remove(),this.highlightedElements={}},_getModuleChildById:function(a,b){var c=a._childrenIdMap[b];if(c)return c;for(var d,e=0,f=a.children.length;e<f;e++)if(d=a.children[e],c=this._getModuleChildById(d,b))return c},_getModuleChildrenByModuleName:function(a,b){var c=[];return _.each(a.children,function(a){a.className===b&&c.push(a),c=c.concat(this._getModuleChildrenByModuleName(a,b))}.bind(this)),c},_highlightModule:function(a,b){return this._highlightElement(a.cid,a.$el,b)},_highlightElement:function(a,b,c){var d;if(c){d=b.clone(),d.$origin=b,d.attr("id",a),d.addClass(this.CssClassName.TUTORIAL_HIGHLIGHT),this.highlightedElements[a]=d;var e=$("body");e.append(d),this.options.has_background&&this.setCloneBackground(d),this.setCloneInteractions(d),this.setCloneDimensions(d,b),this.positionClone(d)}else d=this.highlightedElements[a],d&&(d.remove(),delete this.highlightedElements[a]);return d},positionClone:function(a){var b=a.$origin.parents().addBack();b.css("animation-duration","0s"),_.defer(function(){var c=a.$origin.offset();c={top:c.top,left:c.left};var d=c.top-$(window).scrollTop();d>0&&(c.top=d),a.css(c);var e=$.extend({},c,{height:a.outerHeight(),width:a.outerWidth()});a.$mask&&a.$mask.css(e),a.$background&&(this.options.background_class&&a.$background.addClass(this.options.background_class),a.$background.css(e)),this.modal&&this.modal.positionModule(),b.css("animation-duration","")}.bind(this))},onResize:function(){_.each(this.highlightedElements,this.positionClone.bind(this))},onRemoved:function(){this.cleanHighlightedElements()}}),goog.provide("P.modules.ModalVisualObjectSearchIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalVisualObjectSearchIntro=P.modules.ModalStepBase.extend({getExperienceId:function(){return P.Experiences.Experience.WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED},getPlacementId:function(){return P.Experiences.Placement.WEB_PIN_CLOSEUP},onShow:function(a){this.isContextualExperience=!0;var b=this._getHighlightedClickTarget();b&&(b.css({"margin-left":"auto","margin-top":"auto"}),this.setModalPosition("BOTTOM_CENTER",b,!0,!1)),a&&a(),this.setExperienceViewed()},_getHighlightedClickTarget:function(){var a=this._getModuleChildrenByModuleName(P.app,"PaddedPin");return a.length?this._highlightElement("highlightedVisualObject",a[0].getFirstVisualObject(),!0):null}}),goog.provide("P.modules.NotificationNag"),goog.require("P.Module"),goog.require("P.modules.ExperienceNag"),P.modules.NotificationNag=P.modules.ExperienceNag.extend({events:{"click .message a":"handleLinkClick","click .nagClose":"onCloseButtonClick"},onCreated:function(){var a={};a[P.CONST.PUBSUB_TOPIC_NOTIFICATION_DROPDOWN_SHOW]=this.onShow,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_DROPDOWN,a)},onShow:function(){var a=this.data;a&&a.triggerable_placed_exps&&a.triggerable_placed_exps.forEach(function(a){P.ExperienceManager.instance().triggerPlacedExperienceIds([a])})},handleLinkClick:function(){P.WebPushManager.instance().subscribe(),this.complete(!1)},onCloseButtonClick:function(){this.dismiss()}}),goog.provide("P.modules.NotificationsConversationsButton"),goog.require("P.modules.DropdownButton");var NEWS_TAB=0,YOU_TAB=1,MESSAGE_TAB=2;P.modules.NotificationsConversationsButton=P.modules.DropdownButton.extend({getContentModuleLoadOptions:function(){return this.getDropdownModule()},onCreated:function(){P.modules.DropdownButton.prototype.onCreated.call(this);var a={};a[P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT]=this.onConversationUnreadCount,a[P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE]=this.onConversationUnreadCountDecrease,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,this.onUnreadConversationListItemClick)},onConversationUnreadCountDecrease:function(a,b,c){this._decrementButtonByCount(c)},_decrementButtonByCount:function(a){var b=this.getBadgeCount(),c=Math.max(b-a,0);this.setBadgeCount(c),0===c&&P.getConversationsManager().deleteConversationBadgeCount(),!this._dropdown.isShowing()&&this._dropdown.getContentModule()&&this._dropdown.getContentModule().render()},onButtonClick:function(a){var b=a.target;b.isSegmentedControlButton()&&(this.clearAndUpdateBadgeById(b.id),this.postEventsById(b.id))},clearAndUpdateBadgeById:function(a){"networkNotificationsButton"===a?this.clearAndUpdateNetworkNotifBadge():"notificationsButton"===a?this.clearAndUpdateNotificationsBadge():"conversationsButton"===a&&this.clearAndUpdateConversationsBadge()},postEventsById:function(a){("networkNotificationsButton"===a||"notificationsButton"===a)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_DROPDOWN,P.CONST.PUBSUB_TOPIC_NOTIFICATION_DROPDOWN_SHOW,{})},clearAndUpdateBadgeByIndex:function(a){a===NEWS_TAB?this.clearAndUpdateNetworkNotifBadge():a===YOU_TAB?this.clearAndUpdateNotificationsBadge():a===MESSAGE_TAB&&this.clearAndUpdateConversationsBadge()},clearAndUpdateConversationsBadge:function(){this.unseenConversationsCount=0,P.getConversationsManager().deleteConversationBadgeCount(),this.clearConversationsSegmentButtonBadge(),this.updateBadgeCount()},clearAndUpdateNotificationsBadge:function(){this.unseenNotificationsCount=0,this.clearNotificationsSegmentButtonBadge(),this.updateBadgeCount()},clearAndUpdateNetworkNotifBadge:function(){this.unseenNetworkNotifCount=0,this.clearNetworkNotifSegmentButtonBadge(),this.updateBadgeCount()},getDropdownModule:function(){return{name:"NotificationsConversationsDropdown",options:{}}},onUnreadConversationListItemClick:function(){var a=this.getBadgeCount();a-=1,this.setBadgeCount(a),0===a&&P.getConversationsManager().deleteConversationBadgeCount()},getNotificationsSegmentButton:function(){var a,b=this.getDropdown();if(b.children.length){var c=b.getContentModule();a=c.getNotificationsSegmentedButton()}return a},getConversationsSegmentButton:function(){var a,b=this.getDropdown();if(b.children.length){var c=b.getContentModule();a=c.getConversationsSegmentedButton()}return a},getNetworkNotifSegmentButton:function(){var a,b=this.getDropdown();if(b.children.length){var c=b.getContentModule();a=c.getNetworkNotifSegmentedButton()}return a},clearConversationsSegmentButtonBadge:function(){var a=this.getConversationsSegmentButton();a&&a.clearBadge()},clearNotificationsSegmentButtonBadge:function(){var a=this.getNotificationsSegmentButton();a&&a.clearBadge()},clearNetworkNotifSegmentButtonBadge:function(){var a=this.getNetworkNotifSegmentButton();a&&a.clearBadge()},setNotificationsSegmentButtonBadgeCount:function(a){var b=this.getNotificationsSegmentButton();b&&b.setBadge(a)},setNetworkNotifSegmentButtonBadgeCount:function(a){var b=this.getNetworkNotifSegmentButton();b&&b.setBadge(a)},setConversationsSegmentButtonBadgeCount:function(a){var b=this.getConversationsSegmentButton();b&&b.setBadge(a)},onConversationUnreadCount:function(a,b,c){this.unseenConversationsCount=c,0===c?this.clearConversationsSegmentButtonBadge():this.setConversationsSegmentButtonBadgeCount(c),this.updateBadgeCount()},onContentReady:function(){P.modules.DropdownButton.prototype.onContentReady.call(this),this.unseenNetworkNotifCount=0,this.unseenNotificationsCount=0,this.unseenConversationsCount=0,this.data&&(this.unseenNetworkNotifCount=this.data.network_story_count,isNaN(this.unseenNetworkNotifCount)&&(this.unseenNetworkNotifCount=0),this.unseenNotificationsCount=this.data.notification_unseen_count,isNaN(this.unseenNotificationsCount)&&(this.unseenNotificationsCount=0),this.setBadgeCount(this.unseenNotificationsCount+this.unseenNetworkNotifCount)),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.listen(P.Updater.instance(),"notifications_count",function(a){if(a)if(this.getDropdown().isShowing()){var b=this.getDropdown(),c=b.getContentModule(),d=c._getSegmentedController(),e="notifications"===d.getActiveModule().id;e?this.clearAndUpdateNotificationsBadge():(this.unseenNotificationsCount=a,this.setNotificationsSegmentButtonBadgeCount(a))}else this.unseenNotificationsCount=a,this.setNotificationsSegmentButtonBadgeCount(a);else this.clearNotificationsSegmentButtonBadge();this.updateBadgeCount()}),this.listen(P.Updater.instance(),"network_notifications_count",function(a){if(a)if(this.getDropdown().isShowing()){var b=this.getDropdown(),c=b.getContentModule(),d=c._getSegmentedController(),e="networkNotif"===d.getActiveModule().id;e?this.clearAndUpdateNetworkNotifBadge():(this.unseenNetworkNotifCount=a,this.setNetworkNotifSegmentButtonBadgeCount(a))}else this.unseenNetworkNotifCount=a,this.setNetworkNotifSegmentButtonBadgeCount(a);else this.clearNetworkNotifSegmentButtonBadge();this.updateBadgeCount()})},onDropdownHide:function(){var a=this.getDropdown();this.setActive(!1);var b=a.getContentModule();if(!b)return void this.log.warn("modInDropdown not found in NotificationsConversationsButton");b.removeCreateConversationGroup();var c=b._getSegmentedController();if(!c)return void this.log.warn("segmentedController not found in NotificationsConversationsButton");var d=c.getSelectedTab();this.saveSelectedTab(d),this.clearAndUpdateBadgeByIndex(d)},onDropdownShow:function(a){var b=a.target,c=b.getContentModule(),d=c._getSegmentedController();d.onButtonSelected(this.getTabToShow());var e="notifications"===d.getActiveModule().id,f="networkNotif"===d.getActiveModule().id,g="conversationsListDropdown"===d.getActiveModule().id;b.getContentModulePromise().then(function(){e&&this.unseenNotificationsCount?this.clearAndUpdateNotificationsBadge():f&&this.unseenNetworkNotifCount?this.clearAndUpdateNetworkNotifBadge():g&&this.unseenConversationsCount&&this.clearAndUpdateConversationsBadge()}.bind(this)),(e||f)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_DROPDOWN,P.CONST.PUBSUB_TOPIC_NOTIFICATION_DROPDOWN_SHOW,{})},updateBadgeCount:function(){var a=0;a=this.unseenNotificationsCount+this.unseenNetworkNotifCount+this.unseenConversationsCount,this.setBadgeCount(a),P.Title.instance().setPrefixCount(a)},getTabToShow:function(){var a=-1;return this.unseenConversationsCount>0?a=MESSAGE_TAB:this.unseenNotificationsCount>0?a=YOU_TAB:this.unseenNetworkNotifCount>0&&(a=NEWS_TAB),-1===a&&(a=P.LocalStorage.getItem(P.CONST.LOCALSTORAGE_SELECTED_NOTIFICATION_TAB),null==a&&(a=NEWS_TAB)),a},saveSelectedTab:function(a){P.LocalStorage.setItem(P.CONST.LOCALSTORAGE_SELECTED_NOTIFICATION_TAB,a)}}),goog.provide("P.modules.NotificationsConversationsDropdown"),goog.require("P.Module"),goog.require("P.modules.CreateConversationGroup"),P.modules.NotificationsConversationsDropdown=P.Module.extend({CssClassName:{SHOWING_CONVERSATIONS:"conversationsShowing"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_SEND_OBJECT_TO_USERS,this.onCreateConversationWithUsers),this.showingConversationGroup=!1},onButtonClick:function(a){var b=a.target;if(b.isCancelButton())return void this.removeCreateConversationGroup();switch(b.id){case"conversationsButton":this.$el.addClass(this.CssClassName.SHOWING_CONVERSATIONS);break;case"notificationsButton":this.$el.removeClass(this.CssClassName.SHOWING_CONVERSATIONS);break;case"newMessage":this.showCreateConversationGroup()}},onCreateConversationWithUsers:function(a){var b=a.data.user_ids,c=a.data.emails,d={text:a.data.text};P.getConversationsManager().sendMessageToUsers(b,c,d).then(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.render()}.bind(this))},showCreateConversationGroup:function(){this.showingConversationGroup||(this.createConversationGroup=new P.modules.CreateConversationGroup({}),this.createConversationGroup.renderExistingData().then(function(){this.appendChild(this.createConversationGroup)}.bind(this))),this.showingConversationGroup=!0},removeCreateConversationGroup:function(){(this.showingConversationGroup||this.createConversationGroup)&&(this.createConversationGroup.destroy(),this.createConversationGroup=null),this.showingConversationGroup=!1},getConversationsSegmentedButton:function(){var a=this._getSegmentedController();return a?a.getChildById("conversationsButton"):void 0},getNotificationsSegmentedButton:function(){var a=this._getSegmentedController();return a?a.getChildById("notificationsButton"):void 0},getNetworkNotifSegmentedButton:function(){var a=this._getSegmentedController();return a?a.getChildById("networkNotificationsButton"):void 0},setConversationsActiveSegment:function(){var a=this._getSegmentedController();this.$el.addClass(this.CssClassName.SHOWING_CONVERSATIONS),a.makeActiveModuleFromIndex(1)},_getSegmentedController:function(){return this.getChildById("segmentedController")},setNotificationsActiveSegment:function(){var a=this._getSegmentedController();this.$el.removeClass(this.CssClassName.SHOWING_CONVERSATIONS),a.makeActiveModuleFromIndex(0)},getNotificationsSegment:function(){var a,b=this._getSegmentedController();return b&&(a=b.getChildByModuleName("notifications")),a}}),goog.provide("P.modules.NuxModalStepBase"),goog.require("P.Module"),goog.require("P.modules.StepBase"),goog.require("P.CONST"),P.modules.NuxModalStepBase=P.modules.StepBase.extend({onContentReady:function(){var a=this.getChildById("nuxModalDismissButton");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onDismiss)},onNextButtonClicked:function(){var a=this.getChildById("nextButton");a&&a.showLoading(),P.modules.StepBase.prototype.onNextButtonClicked.call(this)},getExperienceId:function(){return this.options.experienceID},getPlacementId:function(){return this.options.placementID},onDismiss:function(){P.ExperienceTutorialManager.instance()._dismiss()}}),goog.provide("P.modules.NuxProgress"),goog.require("P.Module"),goog.require("P.tutorialManager"),goog.require("P.modules.NuxProgressBase");var MODULE_ID_NUX_PROGRESS="nuxTutorialProgress";P.modules.NuxProgress=P.modules.NuxProgressBase.extend({CssClassName:P.modules.NuxProgressBase.prototype.CssClassName,onCreated:function(){P.modules.NuxProgressBase.prototype.onCreated.call(this);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT]=this.updateMiniStep,a[P.CONST.PUBSUB_TOPIC_TUTORIAL_SKIP_PROGRESS_BAR_STEP]=this.skipProgessBarStep,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a)},autoFollowInterest:function(a){var b={interest_list:"favorited",interest_id:a},c="InterestFollowResource",d="interest_auto_follow",e=P.resourceFactory.create(c,b);e.callCreate({showError:!1}).then(function(){P.trackGAEvent(d,P.CONST.GA_ACTION_SUCCESS)},function(){P.trackGAEvent(d,P.CONST.GA_ACTION_ERROR)})},onContentReady:function(){this.$progressWrapper=this.$(".nuxProgress"),this.progressBar=this.getChildByModuleName("Progress"),this.$progressWrapper.removeClass(this.CssClassName.HIDDEN),P.modules.NuxProgressBase.prototype.onContentReady.call(this)},onChildRendered:function(a){var b=this.progressData[this.getNuxTutorialName()];a.id===MODULE_ID_NUX_PROGRESS&&"bar"===b.progressBarType&&this.progressBar.updateStepWidths()},nextStep:function(a){P.modules.NuxProgressBase.prototype.nextStep.call(this,a),this.setProgressBar(a)},setProgressBar:function(a){var b=this.progressData[this.getNuxTutorialName()];if(b){var c=b.steps,d=_.values(c);this.hasMinisteps=_.all(d,function(a){return _.has(a,"miniStepData")}),this.hasMinisteps?(_.isUndefined(this.stepSequences)&&(this.stepSequences=_.pluck(d,"miniStepData"),this.miniStepSequences=_.flatten(this.stepSequences,!1),this.progressBar.options={steps:this.miniStepSequences.length,ministeps:this.miniStepSequences,type:b.progressBarType},this.progressBar.render()),c[this.currentStep].enableOnMiniStepsFull&&this.nextButton.disable()):(this.progressBar.options={current_step:a,steps:d.length},this.progressBar.render());var e=c[a];e&&e.hide_progress_bar?this.$(".progressFooterWrapper").addClass(this.CssClassName.HIDDEN):this.$(".progressFooterWrapper").removeClass(this.CssClassName.HIDDEN)}},updateMiniStep:function(a,b,c){var d=c,e=_.where(this.miniStepSequences,{type:d.type}).length,f=_.isNumber(d.total)?d.total:1;f=Math.min(Math.max(f,0),e),this.progressBar.setMiniStepProgress(d.type,f),this.setMiniStepMessage(d.type,f);var g=this.progressData[this.getNuxTutorialName()].steps[this.currentStep];g.enableOnMiniStepsFull&&(e===f?(this.nextButton.enable(),g.enabledButtonText&&this.nextButton.setText(g.enabledButtonText)):(this.nextButton.disable(),g.enabledButtonText&&this.nextButton.setText(g.buttonText)))},setMiniStepMessage:function(a,b){var c=_.filter(this.miniStepSequences,function(b){return b.type===a}),d="";if(b>0&&b<=c.length){var e=c[b-1];e&&(d=e.finishedStepText)}var f=this.$(".contextualProgress");f&&f.text(d)},endMandatoryFlow:function(){return P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)?P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN):Promise.resolve()},setStepTexts:function(a){var b,c,d,e;if(this.progressData){var f=this.progressData[this.getNuxTutorialName()];if(f){var g=f.steps;if(g){var h=g[a];h&&(b=h.buttonText,c=h.header1,d=h.header2,e=h.skip_data)}}}this.$skip&&(this.$skip.unbind(),P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_REBUILD_FEED)?(this.$skip.removeClass(this.CssClassName.HIDDEN),this.$skip.bind("click",function(){var a=P.resourceFactory.create("UserStateResource",{state:"RESETTING_HOME_FEED"});a.callDelete().then(function(){window.location.reload()},P.NOOP)})):this._handleSkipButton(e)),b&&(this.getNextButton().setText(b),this.getNextButton().show()),this._updateHeaders(c,d)},skipProgessBarStep:function(){var a=_.indexOf(this.tutorialManager.allStepNames,this.tutorialManager.currentStep)+1;if(this.progressData){var b=this.progressData[this.getNuxTutorialName()];if(b){var c=b.steps;if(c){var d=c[a];if(d){var e=d.skip_data;this._launchSkipConfirmDialog(e)}}}}}}),goog.provide("P.modules.OAuthAuthorizationPage"),goog.require("P.Form"),goog.require("P.modules.OAuthPageBase"),P.modules.OAuthAuthorizationPage=P.modules.OAuthPageBase.extend({onContentReady:function(){this.tryRedirect(this.data),this.form=new P.Form(this.$("form"),{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.authorizeConsumer),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)
},onButtonClick:function(a){return"cancelButton"===a.target.id?this.cancelAuthorization():void 0},authorizeConsumer:function(){var a=this.getChildById("submitButton");a.showLoading(),this.makeAuthorizationDecision(!0,a)},cancelAuthorization:function(){var a=this.getChildById("cancelButton");a.showLoading(),this.makeAuthorizationDecision(!1,a)}}),goog.provide("P.modules.OAuthPage"),goog.require("P.modules.OAuthPageBase"),P.modules.OAuthPage=P.modules.OAuthPageBase.extend({events:{"click .authorizeApp":"onAuthorizeButtonClicked","click .joinButton":"onJoinButtonClicked"},onJoinButtonClicked:function(){P.navigate("/join/register/email/?next="+encodeURIComponent(P.getCurrentUrl()))}}),goog.provide("P.modules.PagedGrid"),goog.require("P.modules.PagedCollection"),goog.require("P.modules.Grid");var DEFAULT_AJAX_PAGE_SIZE=9;P.modules.PagedGrid=P.modules.PagedCollection.extend({CssClassName:_.extend(P.modules.PagedCollection.prototype.CssClassName,{HIDE:"hide"}),onAddedToDom:function(){this.contentReady&&this._setUpGrid()},onContentReady:function(){P.modules.PagedCollection.prototype.onContentReady.call(this),this.inDom&&this._setUpGrid()},_getGrid:function(){return this.getChildById("grid")},prependChildItem:function(a){var b=this._getGrid();b.prependChildItem(a)},_setUpGrid:function(){var a=this._getGrid(),b=this.options.ajax_page_size||DEFAULT_AJAX_PAGE_SIZE;a.setPageSize(b),a.hasMoreItems()||this.getMoreItemsButton().getContent().addClass(this.CssClassName.HIDE),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_ERROR,this.onChildError)},hasItems:function(){var a=this._getGrid();return a.hasItems()},requestMore:function(){if(this.contentReady){this.showMoreItemsLoading();var a=this._getGrid();a.requestMoreItems()}},onChildContentChanged:function(){this.hideMoreItemsLoading();var a=this.getMoreItemsButton();if(a){if(this.gridHasError)return a.hide(),void(this.gridHasError=!1);var b=this._getGrid();b.hasMoreItems()?a.show():a.destroy()}},onChildError:function(a){this.log.debug("Child error!",a),a.target===this._getGrid()&&(this.gridHasError=!0)}}),goog.provide("P.modules.Picker"),goog.require("P.Module"),goog.require("P.modules.SelectList"),P.modules.Picker=P.Module.extend({events:{keydown:"_onKeydown","textchange .name":"_onNameTextChange"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onChildButtonClick),this.childListen(P.CONST.EVENT_ITEM_CLICK,this._onChildItemClick),this._list=null,this._addedCreateItem=!1},onContentReady:function(){this._list=this.getChildById("list"),this._addedCreateItem=!1},focus:function(){P.deferDomManipulation(function(){"Mobile Safari"!==P.CONTEXT.browser_name&&this.$(".name").focusWithoutScrolling(),this._list.scrollSelectedItemElementIntoView()}.bind(this))},getList:function(){return this._list},clearName:function(){this.$(".name").val(""),this._onNameTextChange()},_create:function(){return Promise.reject(new Error("subclasses must override this"))},_createAndSubmit:function(a){this.showLoading(),this._create(a).then(function(a){return a&&(this._submit(a),!this.options.skip_append_created_item)?this._list.appendItem(a,!0):void 0}.bind(this)).fin(function(){this.hideLoading()}.bind(this))},_createFromInputNameAndSubmit:function(){var a=this._getNameInputText();this._createAndSubmit(a)},_getNameInputText:function(){return this.$(".name").val().trim()},_handleChoice:function(a){if(a.is_create)this._createFromInputNameAndSubmit();else if(a.is_create_suggestion){var b=a.name,c=b.toString();this._createAndSubmit(c)}else this._submit(a)},_onChildButtonClick:function(a){var b=a.target;b&&"createButton"===b.id&&this._createFromInputNameAndSubmit()},_onChildItemClick:function(a){var b=a.target,c=a.data;b&&"list"===b.id&&this._handleChoice(c)},_logArrowEvent:function(a){"pinCreate3"===this.options.view_type&&this._logCustomContextEvent(a?P.ContextLogging.EventType.WEB_PIN_CREATE_BOARD_FILTER_KEYDOWN_ARROW_UP:P.ContextLogging.EventType.WEB_PIN_CREATE_BOARD_FILTER_KEYDOWN_ARROW_DOWN,P.ContextLogging.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.ContextLogging.ComponentType.MODAL_REPIN,{})},_logEnterEvent:function(){"pinCreate3"===this.options.view_type&&this._logCustomContextEvent(P.ContextLogging.EventType.WEB_PICKER_ENTER,P.ContextLogging.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.ContextLogging.ComponentType.MODAL_REPIN,{})},_onKeydown:function(a){if(this._list.hasVisibleItems())switch(a.keyCode){case P.keyCode.UP:a.preventDefault(),a.stopPropagation(),this._logArrowEvent(!0),this._list.highlightUp();break;case P.keyCode.DOWN:a.preventDefault(),a.stopPropagation(),this._logArrowEvent(!1),this._list.highlightDown();break;case P.keyCode.ENTER:case P.keyCode.NUMPAD_ENTER:a.preventDefault(),a.stopPropagation(),this._logEnterEvent();var b=this._list.getSelectedItemData();this._handleChoice(b?b:{name:this._getNameInputText(),is_create:!0})}},_onNameTextChange:function(){var a=void 0!==this.options.allow_create?this.options.allow_create:!0;if(a&&!this._addedCreateItem){var b={};this.options.create_item_label&&(b.create_item_label=this.options.create_item_label),"pinCreate3"===this.options.view_type&&P.experiments.instance.inExperimentGroups("web_pin_create2",["enabled_v5_toast"])&&(b.view_type="pinCreate3",this._logCustomContextEvent(P.ContextLogging.EventType.WEB_PIN_CREATE_BOARD_FILTER_KEYDOWN,P.ContextLogging.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.ContextLogging.ComponentType.MODAL_REPIN,{})),this._list.appendItem({type:"module",name:"PickerItemCreate",options:b,data:{is_create:!0}}),this._addedCreateItem=!0}var c=this._getNameInputText(),d=function(a){var b=!!c;if(b){var d=a.filter(function(a){return!a.data||a.data.is_spinner||a.data.is_create||a.data.recommendation_reason||a.data.is_create_suggestion||a.data.skip_filter?!1:!0}),e=d.map(function(a){return a.data.name}),f=P.filter.match(c,e),g={};e.forEach(function(a,b){g[a]=f.itemMatched[b]})}var h=a.map(function(a){var d=a.data;if(!d)return!1;if(d.is_spinner)return!0;if(d.is_create){var e=b&&!f.hasExactMatch,h=a;return h.setCreateName(c),e}if(d.recommendation_reason||d.is_create_suggestion)return!b;if(d.skip_filter)return!0;if(b){var i=d.name;return this.options.highlight_matched_text&&(g[i]?a.highlightMatchedText(c):a.unHighlightMatchedText()),g[i]}return this.options.highlight_matched_text&&a.unHighlightMatchedText(),!0}.bind(this));return h}.bind(this);this._list.setItemVisibilityCallback(d)},_submit:function(a){this.triggerEvent(P.CONST.EVENT_CHANGE,a,!0)}}),goog.provide("P.modules.Pin"),goog.require("P.Module"),goog.require("P.modules.RemovePinDialog"),goog.require("P.modules.PinCommentList"),goog.require("P.modules.SocialIconsCounts");var PIN_EDIT_BUTTON_ID="editButton",SCOPED_EVENT_NAME="mapPage",MOUSEENTER_EVENT_NAME="mouseenter."+SCOPED_EVENT_NAME,MOUSELEAVE_EVENT_NAME="mouseleave."+SCOPED_EVENT_NAME,VIEW_TYPES={BOARD_PINS_GRID:"boardPinsGrid",DETAILED:"detailed",SUMMARY:"summary",VISUAL_OBJECT_GRID:"visualObjectGrid",PLAIN_IMAGE_GRID:"plainImageGrid"},GRID_ACTION_BUTTON_WRAPPERS=[".likeEditButtonWrapper",".repinSendButtonWrapper"],PIN_HOVER_MASK_CLASSES=[".hoverMask",".pinImageActionButtonWrapper"];P.modules.Pin=P.Module.extend({events:{"mouseleave .pinImageSourceWrapper":"onPinMouseout","click .bulkEditPinWrapper":"onBulkEditPinWrapperClick","click .placePinActivateWrapper":"onPlacePinActivateWrapperClick","click .playIndicatorPill.gifType":"onGifClick","click .richPinMeta.hasMapButton":"onRichPinMetaWithMapClick","click .vaseButton":"onVaseToggleClick","focus .pinDescriptionInput":"onPinDescriptionInputFocus","blur .pinDescriptionInput":"onPinDescriptionInputBlur","click .pinDescription":"onPinDescriptionParagraphClick","click .hidePinTopic":"onHidePinTopic","click .pinImageActionButtonWrapper":"onPinClick"},CssClassName:{CLONED:"cloned",COLLAPSED:"collapsed",EDITING_DESCRIPTION:"editingDescription",HIDDEN:"hidden",MAP_FOCUS:"mapFocus",PIN_BLURRED:"blurred",PIN_BULK_EDIT:"bulkEditMode",PIN_CREDIT_HOVER:"creditHover",PIN_VISIBLE:"visible",PLACE_SUMMARY:"placeSummary",PLAYING:"playing",SELECTED:"selected",SQUISHED:"squished"},onPinMouseout:function(){var a=this.getChildById("sendPinButton");if(a){var b=a.getDropdown();b&&b.isVisible()&&(this.toggleActionButtons(!0),this.toggleBlurredPin(!0))}},onPinClick:function(){this.triggerEvent(P.CONST.EVENT_PIN_IMAGE_CLICK,this,!0)},onPinDescriptionParagraphClick:function(){this.isCloneForRepin()&&(this.$el.addClass(this.CssClassName.EDITING_DESCRIPTION),this.getPinDescriptionInput().is(":focus")||this.getPinDescriptionInput().focus())},onRendered:function(){this.inDesktopPlaceBoard()&&this.triggerEvent(P.CONST.EVENT_PIN_CONTENT_CHANGED,this,!0)},isCloneForRepin:function(){return this.options.is_clone_for_repin},inDesktopPlaceBoard:function(){return this.options.in_desktop_place_board},setPinImages:function(a){var b=this.data;b.image_url=a;var c=b.images;c["236x"].url=a,c["474x"].url=a},getPinDescriptionInput:function(){return this.$(".pinDescriptionInput")},getPinDescriptionElement:function(){return this.$(".pinDescription")},getDescriptionText:function(){var a=this.data.description;if(!this._clamp)return a;var b=$("<div>");return a=this._clamp.original,b.html(a.replace(/<br\s*[\/]?>/gi,"\n")),b.text()},onPinDescriptionInputFocus:function(){if(this.isCloneForRepin()&&(this.$el.addClass(this.CssClassName.EDITING_DESCRIPTION),!this.getPinDescriptionInput().is(":focus"))){var a=this._clamp.original.trim();this.getPinDescriptionInput().html(a.replace(/<br\s*[\/]?>/gi,"\n"))}},onPinDescriptionInputBlur:function(){this.isCloneForRepin()&&P.setTimeout(function(){var a=this.getPinDescriptionInput().val();a=_.escape(this.getPinDescriptionInput().val()),this.$el.toggleClass(this.CssClassName.EDITING_DESCRIPTION,!a.length),this.getPinDescriptionElement().html(a.replace(/\n/g,"<br />")),this.clampDescription()}.bind(this),50)},toggleActionButtons:function(a){this.$(GRID_ACTION_BUTTON_WRAPPERS.join(", ")).toggleClass(this.CssClassName.PIN_VISIBLE,a)},toggleBlurredPin:function(a){this.$(PIN_HOVER_MASK_CLASSES.join(", ")).toggleClass(this.CssClassName.PIN_BLURRED,a),this.$(".pinCreditWrapper").toggleClass(this.CssClassName.PIN_CREDIT_HOVER,a)},onRichPinMetaWithMapClick:function(){var a=this.getPinId();this.inDesktopPlaceBoard()||(this._forceSeeOnMap=!0),this.getPlaceData()&&this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,a,!0)},getLoggingObjectIdStr:function(){return this.getPinId()},getPlaceData:function(){return this.data.place_summary||null},getPinId:function(){return this.resource.get("id")},getPlaceProvider:function(){var a=this.getPlaceData();return a?a.source_name:null},getPlaceProviderImage:function(){var a=this.getPlaceData();return a?a.source_icon:null},beginEditingDescription:function(){this.$el.addClass(this.CssClassName.EDITING_DESCRIPTION),this.getPinDescriptionInput().focus().select()},onButtonClick:function(a){var b=a.target,c=b.id;switch(c){case"expandGiraffe":this.onExpandGiraffeClick(a),b.destroy(),this.$(".navLinkOverlay").removeClass(this.CssClassName.SQUISHED);break;case"addToMap":this.triggerEvent(P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP,this,!0);break;case"seeOnMap":b.setHighlight(!0);break;case"pinItToMapButton":var d=this.extraData.image;this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_PINIT_BUTTON_CLICKED,d,!0);break;case"editDescription":this.beginEditingDescription();break;case"pinItButton":if(P.experiments.instance.inExperimentGroups("web_pin_create2",["enabled_v5_toast"])&&this._getViewType()===VIEW_TYPES.SUMMARY){var e=_.extend({},this.options,{is_clone_for_repin:!0}),f=new P.modules.Pin({id:"pin",options:e,data:this.data});f.renderExistingData().then(function(){var a=f.getContent(),b=this.$el.parent(".item"),c=b.offset();a.css({opacity:"0",position:"absolute",top:c.top,left:c.left}),a.addClass(this.CssClassName.CLONED),this.triggerEvent(P.CONST.EVENT_APPEND_CLONED_PIN,f,!0),P.getModalManager().setAnimatedModule(f)}.bind(this))}}},getId:function(){return this.data.id},onExpandGiraffeClick:function(){this.$(".pinImageWrapper").removeClass(this.CssClassName.COLLAPSED),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},getSummaryImageUrl:function(){return this.data.images["236x"].url},getLink:function(){return this.data.link||null},getPlaceName:function(){var a=this.getPlaceData();return a?a.name:null},showEditModal:function(){var a=this.getChildById(PIN_EDIT_BUTTON_ID);return a?(a.showModalSubmodule(),!0):!1},getPinMedia:function(){var a=this._getViewType();switch(a){case VIEW_TYPES.DETAILED:return this.$(this.isEmbed()&&!this.isGif()?"iframe":".PaddedPin img.pinImage");case VIEW_TYPES.BOARD_PINS_GRID:case VIEW_TYPES.VISUAL_OBJECT_GRID:case VIEW_TYPES.PLAIN_IMAGE_GRID:return this.$("img");case VIEW_TYPES.SUMMARY:return this.$(".pinHolder .pinImg");default:return this.log.error("requesting pin media for unsupported view_type:"+a),null}},isEmbed:function(){return this.data.embed&&this.data.embed.src},isPinStory:function(){return this.data.embed&&"pinstory"===this.data.embed.subtype},isGif:function(){return this.data.embed&&"gif"===this.data.embed.type},isVideo:function(){return this.data.is_video},getDominantColor:function(){return this.data.dominant_color||"#eee"},_getViewType:function(){return this.options.view_type?this.options.view_type:VIEW_TYPES.SUMMARY},setDescriptionInputHeight:function(){this.getPinDescriptionInput().height(this.getPinDescriptionElement().height())},clampDescription:function(){var a=this.getPinDescriptionElement();a.length&&(a.html(a.html().trim()),this._clamp=window.$clamp(a[0],{clamp:6,useNativeClamp:!1}))},renderDescription:function(){var a=this.$(".descriptionJS"),b=this.$(".richPinGridTitle"),c=this.extraData.description_html,d=this.extraData.richTitleTruncated;a&&c&&a.html(c),b&&d&&b.html(d)},onContentReady:function(){P.Module.prototype.onContentReady.call(this);var a=this.data.id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN]=this.onPinHidden,b[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_BOARD]=this.onPinHiddenStopThroughBoard,b[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_PIN]=this.onPinHiddenStopThroughPin,b[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_INTEREST]=this.onPinHiddenStopThroughInterest,b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this.onPinCommentCreated,b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED]=this.onPinCommentDeleted,b[P.CONST.PUBSUB_TOPIC_PIN_REPINNED]=this.onPinRepinned,b[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,b[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this.onPinLiked,b[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this.onPinUnliked,b[P.CONST.PUBSUB_TOPIC_PIN_UPDATED]=this.onPinUpdated,b[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,b[P.CONST.PUBSUB_TOPIC_BULK_PIN_UNSELECTED]=this.togglePinSelected,this.pubsubSubscribe(a,b)}this.listen(this,P.CONST.EVENT_NAVIGATE,this.onNavigate),this.childListen(P.CONST.EVENT_NAVIGATE,this.onNavigate),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,function(a){a.data.contextualResource||(a.data.contextualResource=this.getContextualResource())}),this.listen(this,P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER,this.addHoverListenerForMapMarker),this.listen(this,P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER,this.removeHoverListenerForMapMarker),this._commentList=this.getChildById("comment_list"),this.getPinMedia().load(this.hideBackgroundText.bind(this)).each(function(){this.complete&&this.width<P.CONST.PIN_WIDTH&&$(this).trigger("load")}),this.isCloneForRepin()&&this.clampDescription(),this.options.render_desc_with_js&&this.renderDescription()},closeAddToMapModalIfNeeded:function(){var a=this.getChildById("addToMap");a&&P.getModalManager().removeTopModal()},onPinHidden:function(){var a=this.data,b={pin_id:a.id,feedback_type:P.CONST.PinFeedbackTypes.BLOCK_SINGLE_PFY_PIN},c=a.recommendation_reason;if(c){b.promoted=!1;var d=c.reason;if("REPIN_BOARD"===d){var e=c.board;e&&(b.through_id=e.id)}else"RECOMMENDED_INTEREST"===d&&(b.through_id=c.through_interest);b.recommendation_reason_id=c.reason_id}else b.promoted=!0;this._sendHidePinFeedback(b),this._showRemovePinDialog(P.CONST.PinFeedbackTypes.BLOCK_SINGLE_PFY_PIN)},onPinHiddenStopThroughBoard:function(){this.onPinHiddenStopThroughObject("board",P.CONST.PinFeedbackTypes.BLOCK_PFY_THROUGH_BOARD)},onPinHiddenStopThroughPin:function(){this.onPinHiddenStopThroughObject("pin",P.CONST.PinFeedbackTypes.BLOCK_PFY_THROUGH_PIN)},onPinHiddenStopThroughInterest:function(){this.onPinHiddenStopThroughObject("interest",P.CONST.PinFeedbackTypes.BLOCK_PFY_THROUGH_INTEREST)},onPinHiddenStopThroughObject:function(a,b){var c=this.data,d=c.recommendation_reason,e=d[a]||{},f={pin_id:c.id,feedback_type:b,through_id:e.cacheable_id||e.id,recommendation_reason_id:d.reason_id,promoted:!1};this._sendHidePinFeedback(f),this._showRemovePinDialog(b)},_sendHidePinFeedback:function(a){var b=P.resourceFactory.create("PinFeedbackResource",a);b.callUpdate({showError:!0})},_showRemovePinDialog:function(a){var b=this.data,c={pin_id:b.id,recommendation_reason:b.recommendation_reason,promoter:b.promoter,feedback_type:a},d=new P.modules.RemovePinDialog({options:c});d.render().then(function(){d.getContent().insertBefore(this.getContent()),d.parent=this.parent,this.getContent().hide(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}.bind(this))},getImageUrl:function(a){if(!a)return"";var b=this.data.images;return b[a]?b[a].url:a===P.CONST.IMAGE_SIZE_ORIG&&b.originals?b.originals.url:""},getCoordinates:function(){var a=this.getPlaceData();return a?[a.latitude,a.longitude]:null},getContextualResource:function(){return P.resourceFactory.create("PinResource",{id:this.getId()})},scrollIntoView:function(){this._forceSeeOnMap=!0;var a,b=this.$el,c=b.offset().top,d=b.height(),e=P.Viewport.height,f=$(".headerBackground").height();a=d>=e-f?c-d/2+P.Viewport.height/2-f-1.5*P.CONST.PIN_MARGIN:c-e/2-f/2+d/2,this.$el.addClass(this.CssClassName.MAP_FOCUS);var g=this.getChildById("seeOnMap");g&&g.setHighlight(!0),this._highlightMarkerOnMap();var h=function(){this._highlightMarkerOnMap()}.bind(this);P.scrollToTop({$scroller:null,newScrollOffset:a,callback:h})},resetShowOnMapButton:function(){var a=this.getChildById("seeOnMap");this.$el.removeClass(this.CssClassName.MAP_FOCUS),a&&(a.setHighlight(!1),this._forceSeeOnMap=!1)},hideBackgroundText:function(){this.$(".pinDomain").addClass(this.CssClassName.HIDDEN),this.$(".pinCanonicalDescription").addClass(this.CssClassName.HIDDEN)},onGifClick:function(a){a.preventDefault(),this.originalSrc||(this.originalSrc=this.$(".pinImg").attr("src"));var b=this.$(".playIndicatorPill.gifType");return this.isPlaying?(this.$(".pinImg").attr("src",this.originalSrc),b.removeClass(this.CssClassName.PLAYING)):(this.$(".pinImg").attr("src",this.data.embed.src),b.addClass(this.CssClassName.PLAYING)),this.isPlaying=!this.isPlaying,!1},onPinRepinned:function(){this.incrementRepinCount()},addHoverListenerForMapMarker:function(){var a=this.$el,b=this.getId(),c=this.getChildById("seeOnMap");this.removeHoverListenerForMapMarker(),a.on(MOUSEENTER_EVENT_NAME,function(){this.triggerEvent(P.CONST.EVENT_PIN_MOUSE_IN,b,!0),c&&c.setHighlight(!0)}.bind(this)),a.on(MOUSELEAVE_EVENT_NAME,function(){this._forceSeeOnMap||(this.triggerEvent(P.CONST.EVENT_PIN_MOUSE_OUT,b,!0),c&&c.setHighlight(!1))}.bind(this))},getLocality:function(){var a=this.getPlaceData();if(!a)return null;var b=a.address;return b?b.locality:null},_highlightMarkerOnMap:function(){var a=this.getPinId();this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,a,!0)},removeHoverListenerForMapMarker:function(){var a=this.$el;a.off(MOUSEENTER_EVENT_NAME+" "+MOUSELEAVE_EVENT_NAME)},onDropdownShow:function(a){var b=a.target.options.view_type;"pickedForYou"===b?P.logFrontEndEvent("pickedForYouHoverShow",.01):"pinFeedbackTool"===b?this.toggleBlurredPin(!0):this.toggleActionButtons(!0)},onDropdownHide:function(){this.toggleActionButtons(!1),this.toggleBlurredPin(!1)},isPinComment:function(a){return"PinDescriptionComment"===a.target.className&&a.target.options.is_description===!1?!0:!1},onNavigate:function(a){P.isOffsiteUrl(a.data.url)&&!this.isPinComment(a)&&(a.data.pinId=this.data.id),this.hideDropdowns()},hideDropdowns:function(){var a=this.getChildrenByModuleName("DropdownButton");_.each(a,function(a){a.getDropdown().hide()})},onBulkEditPinWrapperClick:function(){var a=this.options.can_bulk_edit||!1,b=_.contains(this.data.access,"write");if(b||a){this.togglePinSelected();var c=this.data.id;c&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_BULK_PIN_SELECTED,c)}},togglePinSelected:function(){this.$(".bulkEditCheckbox").toggleClass(this.CssClassName.SELECTED)},toggleBulkEditMode:function(a,b,c){c===P.CONST.ENTER_BULK_EDIT?this.$el.addClass(this.CssClassName.PIN_BULK_EDIT):(this.$el.removeClass(this.CssClassName.PIN_BULK_EDIT),this.$(".bulkEditCheckbox").removeClass(this.CssClassName.SELECTED))},onPlacePinActivateWrapperClick:function(){this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,this.getId(),!0)},focusPlacePin:function(){var a=this.$el.height(),b=this.$el.parent(".item");this.$el.addClass(this.CssClassName.MAP_FOCUS);var c=a-this.$el.height()-P.CONST.PIN_MARGIN;b.transition({y:c},300,"cubic-bezier(.19, 1, .48, 1)")},unfocusPlacePin:function(){var a=this.$el.parent(".item");a.transition({y:0},300,"cubic-bezier(.36, 0, .21, 1)",function(){this.$el.removeClass(this.CssClassName.MAP_FOCUS)}.bind(this))},onPinCommentCreated:function(){this._getViewType()===VIEW_TYPES.SUMMARY&&this.render()},onPinCommentDeleted:function(){this._getViewType()===VIEW_TYPES.SUMMARY&&this.render()},onPinLiked:function(){this.triggerEvent(P.CONST.EVENT_PIN_LIKED,null,!0);var a=this.getChildById("likeButton");a&&a.setState(!0),this.incrementLikeCount()},getSocialIconsCounts:function(){return this.getChildById("socialIconsCounts")},onPinUnliked:function(){this.triggerEvent(P.CONST.EVENT_PIN_UNLIKED,null,!0);var a=this.getChildById("likeButton");a&&a.setState(!1),this.decrementLikeCount()},incrementLikeCount:function(){var a=this.getSocialIconsCounts();a&&a.incrementLike()},incrementRepinCount:function(){var a=this.getSocialIconsCounts();a&&a.incrementRepin()},decrementLikeCount:function(){var a=this.getSocialIconsCounts();a&&a.decrementLike()},onPinUpdated:function(a,b,c){this.triggerEvent(P.CONST.EVENT_PIN_UPDATED,c,!0),this.model&&this.model.set(c),this.render()},onPinDeleted:function(){this.triggerEvent(P.CONST.EVENT_PIN_DELETED,this,!0),this.destroy()},onVaseToggleClick:function(){var a=this.getChildById("vaseButton");this.$(".vaseText.hidden")[0]?(a.setText(P._("Less")),this.$(".vaseText:not(.alwaysShow)").removeClass(this.CssClassName.HIDDEN)):(a.setText(P._("More")),this.$(".vaseText:not(.alwaysShow)").addClass(this.CssClassName.HIDDEN)),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},getSourceUrl:function(){return this.data.link||""},getFirstVisualObject:function(){var a=this.getChildByModuleName("PaddedPin");return a?a.getFirstVisualObject():null},onHidePinTopic:function(){var a=P.resourceFactory.create("TopicPinFeedbackResource",{feedback_type:"hide",interest:this.options.interest_page_id,pin_id:this.getId()});a.callUpdate({showError:!0}),this.getContent().hide(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},updateSendPinDropdownPosition:function(a){var b=this.getChildById("sendPinButton");b&&(b.getDropdownOptions().position_point=a)},configurePlacePinMode:function(a){a?(this.$el.addClass(this.CssClassName.PLACE_SUMMARY),this.$el.addClass(this.CssClassName.HIDDEN),this.getPlaceData()&&this.$el.removeClass(this.CssClassName.HIDDEN)):(this.$el.removeClass(this.CssClassName.PLACE_SUMMARY),this.$el.removeClass(this.CssClassName.HIDDEN))},emptyPaddedPin:function(a){var b=this.getChildByModuleName("PaddedPin"),c=null;b&&(c=b.el.parentElement,b.empty(),c&&(c.style["padding-top"]=a))}}),goog.provide("P.modules.PinActionBar"),goog.require("P.Module"),goog.require("P.modules.IncrementingNavigateButton"),goog.require("P.Sticky");var LIKES_BUTTON_ID="likesButton",REPINS_BUTTON_ID="repinsButton",PIN_IT_BUTTON_ID="pinItButton";P.modules.PinActionBar=P.Module.extend({CssClassName:{ACTION_LEFT_ROUNDED:"leftRounded"},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var a=this.options.pin_id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this.onPinLiked,b[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this.onPinUnliked,b[P.CONST.PUBSUB_TOPIC_PIN_REPINNED]=this.onPinRepinned,this.pubsubSubscribe(a,b)}this.childListen(P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.onCloseupIncrementButtonHide),this.childListen(P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.onCloseupIncrementButtonShow),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,function(a){a.data.contextualResource||(a.data.contextualResource=this.getContextualResource())}),this.extraData&&this.extraData.showPinTip&&this.showSavePinTooltip()},removeDropdowns:function(){var a=this.getDropdowns();_.each(a,function(a){a.hide()})},showSavePinTooltip:function(){var a=this.getChildById("pinItButton"),b=P._("<strong>Want to save this Pin for yourself?</strong> Go ahead and Pin It.");this.extraData.unauthPinCloseupDisplayData&&this.extraData.unauthPinCloseupDisplayData.copy&&(b=this.extraData.unauthPinCloseupDisplayData.copy);var c={name:"Dropdown",options:{anchor:a.$el,class_name:"large",fixed:!1,position_point:"BOTTOM_LEFT",text:b}};P.loadModule(c).then(function(a){a.render().then(function(){$("body").append(a.$el),a.fadeIn()})})},getDropdowns:function(){var a=this.getChildrenByModuleName("Dropdown")||[],b=this.getChildrenByModuleName("DropdownButton");return _.each(b,function(b){var c=b.getDropdown();a.push(c)}),a},areDropdownsShowing:function(){for(var a=this.getDropdowns(),b=0;b<a.length;b++){var c=a[b];if(c.isShowing())return!0}return!1},getContextualResource:function(){return P.resourceFactory.create("PinResource",{id:this.options.pin_id})},showRepinModal:function(){var a=this.getChildById(PIN_IT_BUTTON_ID);a.showModalSubmodule()},getLoadingSpinnerOptions:function(){return null},onPinRepinned:function(a,b,c){var d=this.getChildById(REPINS_BUTTON_ID);c.board&&"secret"!==c.board.privacy&&d&&d.increment()},onPinLiked:function(){var a=this.getChildById(LIKES_BUTTON_ID);a&&a.increment()},onPinUnliked:function(){var a=this.getChildById(LIKES_BUTTON_ID);a&&a.decrement()},onCloseupIncrementButtonHide:function(a){var b=a.data,c=this.getChildById(b);c.$el.removeClass(this.CssClassName.ACTION_LEFT_ROUNDED)},onCloseupIncrementButtonShow:function(a){var b=a.data,c=this.getChildById(b);c.$el.addClass(this.CssClassName.ACTION_LEFT_ROUNDED)},setDropdownsFixed:function(a){var b=this.getDropdowns();_.each(b,function(b){var c=_.clone(b.options);c.fixed=a,b.setOptions(c),b.positionModule()})},updateSticky:function(a){this._sticky||(this._sticky=new P.Sticky(this.$el,a),this.listen(this._sticky,P.CONST.EVENT_STICKY_FIXED,function(a){this.setDropdownsFixed(a)}))},unsticky:function(){this._sticky&&this._sticky.unSticky()},getLoggingObjectIdStr:function(){return this.options.pin_id},triggerPinItButton:function(){var a=this.getChildById("pinItButton");a&&a.onClick()}}),goog.provide("P.modules.PinCreateBase"),goog.require("P.Module"),goog.require("P.modules.PinCreateSuccessToast");var PIN_CREATE_API_RESPONSE_CODE_SPAM_CONTENT=14;P.modules.PinCreateBase=P.Module.extend({setImage:function(){throw new Error("override me")},isRepin:function(){return!(!this.data||!this.data.id)},onContentReady:function(){this.GACategory=this.isRepin()?"repin_create":"pin_create"},_getPinResource:function(a){var b="PinResource",c=_.extend(a,_.pick(this.options,"method","is_video"));return this.isRepin()&&(b="RepinResource",c.pin_id=this.data.id),P.resourceFactory.create(b,c)},_createPin:function(a){this.showLoading(!0);var b=this._getPinResource(a);b.callCreate({showError:!1}).then(function(a){var b=a.resource_response.data;this._onPinCreateSuccess(b)}.bind(this),function(a){if(P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_ERROR),"create"===this.options.action&&a.api_error_code===PIN_CREATE_API_RESPONSE_CODE_SPAM_CONTENT){var b={name:"ConfirmDialog",options:{fluid:!0,template:"blocked_source"}};P.loadModule(b).then(function(a){a.render().then(function(){this.parent.appendChild(a),this.destroy()}.bind(this))}.bind(this))}else P.showError(a.message)}.bind(this)).fin(function(){this.hideLoading()}.bind(this))},_showSuccessToast1:function(a){var b=a,c=b.board,d=c.name,e=c.url,f=c.privacy,g=c.is_collaborative,h=new P.modules.PinCreateSuccessToast({id:"pinSuccess",options:{pin_id:b.id,board_name:d,board_url:e,is_collaborative:g,privacy:f}});P.app.appendChild(h),h.render(),this.destroy()},_showSuccessModal:function(a){var b=a,c=b.board,d={id:"pinSuccess",name:"PinCreateSuccess",options:{action:this.options.action,board_name:c.name,board_category:c.category,board_id:c.id,board_url:c.url,domain:b.domain,pin_id:b.id,is_collaborative:c.is_collaborative,is_extension_installed:P.browserExtension.instance.isExtensionInstalled(),privacy:c.privacy,method:this.options.method},resource:P.Resource.NOOP_RESOURCE};"pin_create_ignition"===this.options.action?d.options.auto_close=!1:this._createdBoardToEdit&&this._createdBoardToEdit.id===c.id&&(d={id:"pinSuccess",name:"PinCreateSuccessBoardEdit",resource:{name:"BoardResource",options:{board_id:c.id,field_set_key:"basic"}},options:{pinCreateInfo:d}}),P.loadModule(d).then(function(a){this.modal?this.modal.setSubmodule(a):"pin_create_ignition"===this.options.action?this.showInModal(a,{}):a.render().then(function(){this.parent.appendChild(a),this.destroy()}.bind(this))}.bind(this))},_getBoardPicker:function(){throw new Error("not implemented")},_onPinCreateSuccess:function(a){P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_SUCCESS),this.showLoading(),this.triggerEvent(P.CONST.EVENT_PIN_CREATE,a),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,a),P.pubsub.publish(a.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,a),P.pubsub.publish(P.currentUser.get("id"),P.CONST.PUBSUB_TOPIC_PIN_CREATED),this.isRepin()&&P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,a);var b=this._getBoardPicker(),c=P.resourceFactory.clone(b.resource);P.resourceCache.instance.callGet(c);var d=!this.modal,e=!d&&this.isRepin();e&&P.CONTEXT.is_mobile_agent?this._showSuccessToast1(a):this._showSuccessModal(a)}}),goog.provide("P.modules.PinCreateTouch"),goog.require("P.Form"),goog.require("P.modules.PinCreateBase"),P.modules.PinCreateTouch=P.modules.PinCreateBase.extend({onCreated:function(){this.childListen(P.CONST.EVENT_CHANGE,this._onChildChange),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onChildButtonClick)},onContentReady:function(){P.modules.PinCreateBase.prototype.onContentReady.apply(this,arguments);var a={description:[P.Validator.Required(),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]};this.form=new P.Form(this.$("form"),a);var b=this.getChildById("boardPicker");b.hasBoards()||P.deferDomManipulation(function(){var a=this.$(".boardPickerSection");P.boardPickerUtil.showNoBoardsTooltip(a)}.bind(this))},_getBoardPicker:function(){return this.getChildById("boardPicker")},_onChildChange:function(a){if("boardPicker"===a.target.id){var b=a.data;this._validateAndCreate(b.id)}},_onChildButtonClick:function(a){if("createButton"===a.target.id){var b=this.getChildById("boardPicker");b.create("").then(function(a){this._validateAndCreate(a.id)}.bind(this))}},_validateAndCreate:function(a){this.form.validate(function(b){if(0===b.errors.length){var c=_.pick(this.options,"image_url","link");c.description=this.form.getValue("description"),c.board_id=a,this._createPin(c)}}.bind(this))},setImage:function(a){this.options.image_url=a,this.$(".pinImg").attr("src",a)}}),goog.provide("P.modules.RepinSuccessToast"),goog.require("P.Module"),goog.require("P.modules.ToastBase"),P.modules.RepinSuccessToast=P.modules.ToastBase.extend({}),goog.provide("P.modules.SearchInputToken"),goog.require("P.modules.Token");
var RgbColor;P.modules.SearchInputToken=P.modules.Token.extend({events:{"click .remove":"onRemoveClick"},onContentReady:function(){this.bgColor||(this.bgColor=this.options.color?this.clampColorBrightness(this.options.color):this.getRandomColor()),this.$(".tokenContainer").css("background-color",this.bgColor)},onRemoveClick:function(a){this._logContextEvent(a),this.triggerEvent(P.CONST.EVENT_REMOVE_TOKEN,this,!0),a.stopPropagation()},getTokenData:function(){var a=this.options.term,b=this.options.position;return{text:a,priority:b}},clampColorBrightness:function(a){return this._isBright(a)?this._darken(a,.2):a},_isBright:function(a){var b=this.hexToRgb(a);if(b){var c=Math.sqrt(b.r*b.r*.241+b.g*b.g*.691+b.b*b.b*.068);return c>200}return!1},_darken:function(a,b){var c=this.hexToRgb(a),d=Math.round(c.r*(1-b)),e=Math.round(c.g*(1-b)),f=Math.round(c.b*(1-b));return d=Math.min(Math.max(0,d),255),e=Math.min(Math.max(0,e),255),f=Math.min(Math.max(0,f),255),"#"+d.toString(16)+e.toString(16)+f.toString(16)},hexToRgb:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/,c=a.match(b);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},getRandomColor:function(){var a=_.random(1,360),b=_.random(20,90),c=_.random(20,75);return"hsl("+a+","+b+"%,"+c+"%)"}}),goog.provide("P.modules.SendObjectBase"),goog.require("P.Module"),goog.require("P.modules.CreateConversationGroup"),goog.require("P.modules.ConversationsList"),goog.require("P.conversationsUtil"),P.modules.SendObjectBase=P.Module.extend({_OBJECT_ID_NAME:"",_SEND_RESOURCE_NAME:"ConversationsResource",mixins:[P.Mixins.PreventScroll],CssClassName:{VISIBLE:"visible"},onContentReady:function(){this.childListen(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,this.onListItemClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoResultsReturned),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onContentChanged),this.listen(this.parent,P.CONST.EVENT_DROPDOWN_SHOW,this.onShow),this.startPreventingScroll(),this._setup()},onSearchStart:function(){this.$(".spinner").addClass(this.CssClassName.VISIBLE),this.hideConversationsList()},onShow:function(){this._focusTypeahead()},_getTypeaheadField:function(){return this.getChildById("typeaheadField")},_focusTypeahead:function(){var a=this._getTypeaheadField();window.setTimeout(function(){a.focus()},100)},onContentChanged:function(){this.startPreventingScroll()},onNoResultsReturned:function(){this.$(".spinner").removeClass(this.CssClassName.VISIBLE);var a=this._getTypeaheadField();a.getValue().trim().length||this.showConversationsList()},onResultsReturned:function(){this.$(".spinner").removeClass(this.CssClassName.VISIBLE)},hideConversationsList:function(){var a=this._getConversationsList();a.fadeOut()},showConversationsList:function(){var a=this._getConversationsList();a.fadeIn()},_getConversationsList:function(){return this.getChildById("conversationsList")},_setup:function(){this._setMaxHeight()},_setMaxHeight:function(){this.$el.css("maxHeight",this.$el.height())},startPreventingScroll:function(){this.startPreventScroll(this.$(".ConversationsList").last(),this.$(".List").last())},onItemSelected:function(a){var b=a.data.item,c=b.attributes,d=c.username?[c.id]:[],e=c.email?[c.email]:[];this._sendToUsers(d,e),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},reset:function(){this.render()},onListItemClick:function(a){var b=a.target;this._sendToUsers(b.getUserIds(),b.getEmails()),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},_getMessageEl:function(){return this.$(".message")},getMessageValue:function(){return this._getMessageEl().val().trim()},clearMessageValue:function(){this._getMessageEl().val("")},_sendToUsers:function(a,b){if(b||(b=[]),a.length+b.length!==0){var c={text:this.getMessageValue(),object_type:this._OBJECT_ID_NAME,object_id:this.options.object_id};P.getConversationsManager().sendMessageToUsers(a,b,c).then(function(a){this.clearMessageValue(),this.resetTypeaheadField();var b=a.resource_response.data;P.getConversationsManager().logContextEvent(P.ContextLogging.EventType.CONVERSATION_MESSAGE_SEND,b.id,this.options.object_id,this.$el)}.bind(this))}},resetTypeaheadField:function(){var a=this._getTypeaheadField();a.reset(),a.clear()}}),goog.provide("P.modules.SendPin"),goog.require("P.Module"),goog.require("P.modules.SendObjectBase"),P.modules.SendPin=P.modules.SendObjectBase.extend({_OBJECT_ID_NAME:"pin"}),goog.provide("P.modules.SendPinner"),goog.require("P.Module"),goog.require("P.modules.SendObjectBase"),P.modules.SendPinner=P.modules.SendObjectBase.extend({_OBJECT_ID_NAME:"user"}),goog.provide("P.modules.TypeaheadField"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),goog.require("P.modules.Typeahead"),P.modules.TypeaheadField=P.Module.extend({events:{"input .field":"onFieldInput","blur .field":"onFieldBlur","focus .field":"onFieldFocus","keyup .field":"onFieldKeyup","keydown .field":"onFieldKeydown","textchange .field":"onFieldTextChange"},CssClassName:{DISABLED:"disabled",VISIBLE:"visible"},onCreated:function(){this.valueFromHighlight=!1,this.showNewTypeahead=!!this.options.support_advanced_typeahead,this.showGuidedSearch=!!this.options.support_guided_search},getTypeahead:function(){return this.showNewTypeahead?this.getChildById("typeaheadDropdown").getContentModule():this.getChildById("typeahead")},onFieldTextChange:function(){this.isFocussed()&&this.search()},initTypeahead:function(){this.showNewTypeahead?(this.initTypeaheadDropdown(),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onChildItemHighlighted),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown),this.childListen(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,this.onTypeaheadMousedown)):(this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onChildItemHighlighted),this.childListen(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,this.onTypeaheadMousedown),this.options.show_caret&&(this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown)))},initTypeaheadDropdown:function(){this.typeaheadDropdown=new P.modules.Dropdown({id:"typeaheadDropdown",options:{class_name:"typeaheadDropdown",fixed:!0,hide_caret:!0,position_mode:P.CONST.PositionMode.MANUAL,prefetch:!0,mouse_close_mode:"never",submodule:{name:"Typeahead",options:{bypass_lru_cache:this.options.bypass_lru_cache,bypass_maxheight:!0,class_name:"centeredWithinWrapper",enable_recent_queries:this.options.enable_recent_queries,exclude_non_followers:this.options.exclude_non_followers,minimum_term_character_length:this.options.minimum_term_character_length,num_places:this.options.num_places,resource_name:this.options.resource_name,should_geocode:this.options.should_geocode,tags:this.options.tags,template:this.options.template,use_tab_index:this.options.use_tab_index,view_type:"expanded"}}}}),this.addChild(this.typeaheadDropdown)},hideTypeaheadUnlessPreserved:function(){this.options.preserve_typeahead||this.getTypeahead().hide()},enableInput:function(){this._setInputEnabled(!0)},_setInputEnabled:function(a){var b="disabled";this.$field.toggleClass(this.CssClassName.DISABLED,!a),a?this.$field.removeAttr(b):this.$field.attr(b,b)},disableInput:function(){this._setInputEnabled(!1)},onChildItemSelected:function(a){var b=a.data.item,c=b&&!b.get("ignoreLabel")?b.get("label"):this.getValue(),d=this.options.set_input_value_on_selection;void 0===d&&(d=!0),c&&d&&(this.valueFromHighlight=!1,this.setValue(c)),this.blur()},onChildItemHighlighted:function(a){var b=a.data.item,c=b&&!b.get("ignoreLabel")?b.get("highlightLabel")||b.get("label"):this.getTypeahead().getLastTerm();this.options.populate_on_result_highlight&&(this.valueFromHighlight=!!b,this.setValue(c))},onTypeaheadResultsReturned:function(){this.showCaret()},onTypeaheadHidden:function(){this.hideCaret(),this.typeaheadDropdown&&this.typeaheadDropdown.hide()},onTypeaheadShown:function(){this.showCaret(),this.typeaheadDropdown&&!this.typeaheadDropdown.isShowing()&&this.typeaheadDropdown.show()},onTypeaheadNoResultsReturned:function(){this.hideCaret()},showCaret:function(){this._setCaretVisible(!0)},hideCaret:function(){this._setCaretVisible(!1)},_setCaretVisible:function(a){this.$(".typeaheadCaret").toggleClass(this.CssClassName.VISIBLE,a)},highlightTypehaeadUp:function(){this.getTypeahead().highlightUp()},highlightTypeaheadDown:function(){this.getTypeahead().highlightDown()},onContentReady:function(){this.initTypeahead(),this.$field=this.$(".field"),this.$field.placeholder()},onFieldInput:function(){this.isFocussed()&&this.search()},_focusHighlightedIfNeeded:function(){this.options.use_tab_index&&(this.getTypeahead().focusHighlighted(),this.focus())},onFieldKeydown:function(a){var b=this.getTypeahead(),c=P.keyCode;if(b.isOpen())switch(a.keyCode){case c.ENTER:this.valueFromHighlight&&(this.cancelBlur=!0,window.setTimeout(function(){this.cancelBlur=!1}.bind(this),500)),(this.options.prevent_default_on_enter||this.options.close_typeahead_on_selection)&&a.preventDefault();break;case c.BACKSPACE:this.valueFromHighlight=!1}},focus:function(){this.getField().focusWithoutScrolling()},onFieldKeyup:function(a){var b=this.getTypeahead(),c=P.keyCode;if(b.isOpen())switch(a.keyCode){case c.UP:b.highlightUp(),this._focusHighlightedIfNeeded(),a.preventDefault();break;case c.DOWN:b.highlightDown(),this._focusHighlightedIfNeeded(),a.preventDefault();break;case c.ENTER:case c.NUMPAD_ENTER:case c.TAB:var d={};if(b.highlightedItem){var e="pins",f=b.highlightedItem.get("type");"pin_search"===f&&(f="query"),"board_search"===f&&(e="boards",f="query"),"people_search"===f&&(e="users",f="query"),d={entered_query:b.getLastTerm(),selected_query:b.highlightedItem.get("label"),result_index:b.highlightedItem.get("resultIndex"),autocomplete_type:f,search_mode:e}}var g=b.select();this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.AUTOCOMPLETE_SUGGESTION,P.ContextLogging.ComponentType.TYPEAHEAD_SUGGESTIONS,d),g&&(this.abortSearch(),a.preventDefault()),this.options.close_on_selection&&this.closeTypeahead();break;case c.ESCAPE:this.blur(),a.preventDefault();break;default:this.valueFromHighlight=!1}else switch(a.keyCode){case c.ENTER:case c.NUMPAD_ENTER:this.abortSearch(),this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,{},!0)}},getTypeaheadItemsToRender:function(){return this.getTypeahead().itemsToRender},getTypeaheadHighlightedItem:function(){return this.valueFromHighlight?this.getTypeahead().getHighlightedItem():null},getTypeaheadSelectedItem:function(){return this.getTypeahead().getSelectedItem()},removeCacheForTerm:function(a){this.getTypeahead().removeCacheForTerm(a)},removeCacheForCurrentTerm:function(){var a=this.getValue();this.removeCacheForTerm(a)},closeTypeahead:function(){this.abortSearch(),this.getTypeahead().hide()},onFieldBlur:function(){return this.cancelBlur?void(this.cancelBlur=!1):(this.valueFromHighlight?(this.valueFromHighlight=!1,this.reset()):this.showGuidedSearch&&(this.abortSearch(),this.setValue("")),this.hideTypeaheadUnlessPreserved(),void this.triggerEvent(P.CONST.EVENT_BLUR,null,!0))},onFieldFocus:function(){this.$field.trigger("mousedown"),this.options.search_on_focus&&this.search(),this.options.prefetch_on_focus&&this.getTypeahead().prefetch(),this.triggerEvent(P.CONST.EVENT_FOCUS,null,!0)},onTypeaheadMousedown:function(){this.cancelBlur=!0,window.setTimeout(function(){this.cancelBlur=!1}.bind(this),300)},getValue:function(){if("tokenized"===this.options.type){var a=this.getChildById("tokenizedInput");return this.showGuidedSearch?a.getTokenInputValue():a.getInputValue()}return this.$field.val()},getField:function(){return this.$field},reset:function(){this.abortSearch(),this.setValue(""),this.getTypeahead().emptyResults(),this.getTypeahead().hide()},setValue:function(a){if("tokenized"===this.options.type){var b=this.getChildById("tokenizedInput");b.setInputValue(a)}else this.$field.val(a);this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,{value:a},!0)},getTypeaheadResultCount:function(){return this.getTypeahead().getItemCount()},setAutocompleteScope:function(a){this.getTypeahead().setAutocompleteScope(a)},clear:function(){if("tokenized"===this.options.type){var a=this.getChildById("tokenizedInput");a.clearTokens(),a.clearSavedTokens()}this.setValue("")},abortSearch:function(){this.searchTimer&&window.clearTimeout(this.searchTimer),this.getTypeahead().abortSearch()},setResourceOptionForTypeahead:function(a,b){var c=this.getTypeahead().getResource();c.set(a,b)},setPrependedStaticItems:function(a){this.getTypeahead().setPrependedStaticItems(a)},setAppendedStaticItems:function(a){this.getTypeahead().setAppendedStaticItems(a)},resetPrependedStaticItems:function(){this.getTypeahead().resetPrependedStaticItems()},resetAppendedStaticItems:function(){this.getTypeahead().resetAppendedStaticItems()},search:function(a){var b=a;b||(b=this.getValue()),this.searchTimer&&window.clearTimeout(this.searchTimer);var c=function(){this.getTypeahead().search(b)}.bind(this),d=this.options.search_delay;d?this.searchTimer=window.setTimeout(c,d):c()},blur:function(){this.$field.blur()},isFocussed:function(){return this.$field.is(":focus")}}),goog.provide("P.modules.UserEducationDropdownButton"),goog.require("P.Module"),goog.require("P.modules.DropdownButton"),P.modules.UserEducationDropdownButton=P.modules.DropdownButton.extend({CssClassName:_.extend(P.modules.DropdownButton.prototype.CssClassName,{TRIGGER_ACTIVE:"triggerActive"}),onClick:function(a){P.modules.DropdownButton.prototype.onClick.call(this,a),this.triggerEvent(P.CONST.EVENT_TUTORIAL_TRIGGER_CLICKED,null,!0)},onContentReady:function(){P.modules.DropdownButton.prototype.onContentReady.call(this),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,function(a,b,c){c&&!c.showFlyout&&this.setTriggerActiveState(!0)}.bind(this))},setTriggerActiveState:function(a){this.$el.toggleClass(this.CssClassName.TRIGGER_ACTIVE,a)}}),goog.provide("P.modules.UserEducationGuideStacked"),goog.require("P.Module"),goog.require("P.modules.UserEducationGuideStep");var MAX_ROTATION_ANGLE=30,MIN_ROTATION_ANGLE=10;P.modules.UserEducationGuideStacked=P.modules.UserEducationGuideStep.extend({CssClassName:_.extend(P.modules.UserEducationGuideStep.prototype.CssClassName,{ACTIVE:"active"}),onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,function(a){var b=a.target;b&&("nextButton"===b.id?(a.stopPropagation(),this.updateCardsForNextStep().then(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this))):"dismissButton"===b.id&&(a.stopPropagation(),this.$el.removeClass(this.CssClassName.ACTIVE),window.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}.bind(this),500)))}),window.setTimeout(function(){this.$el.addClass(this.CssClassName.ACTIVE)}.bind(this),200)},updateCardsForNextStep:function(){return new Promise(function(a){var b=this.$(".guideStepContent:first-child");b.appendTo(this.$(".cardPositionAnimation.cardPosition")).transition({y:350,rotate:this._getRotateAngle(),visibility:"hidden"},800,"ease",function(){b.remove(),a(void 0)})}.bind(this))},_getRotateAngle:function(){var a=Math.random()*MAX_ROTATION_ANGLE;return a<MIN_ROTATION_ANGLE&&(a=MIN_ROTATION_ANGLE),Math.random()<.5&&(a*=-1),a+"deg"}}),goog.provide("P.modules.UserFollowButton"),goog.require("P.Module"),goog.require("P.modules.FollowButton"),P.modules.UserFollowButton=P.modules.FollowButton.extend({getResourceId:function(){return this.options.user_id},getFollowResource:function(){return P.resourceFactory.create("UserFollowResource",{user_id:this.getResourceId()})},getFollowClass:function(){return this.options.follow_class},getAuthRedirectUrl:function(){return P.currentUser.isAuthenticated()?void 0:P.signupModalManager.showInlineSignupModalOnButtonClick("UserFollowButton")},toggleState:function(){P.modules.FollowButton.prototype.toggleState.call(this),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,this.options.followed?P.CONST.PUBSUB_TOPIC_USER_FOLLOW:P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW,!0)},onContentReady:function(){this.showMemo()},getContextualResource:function(){return P.resourceFactory.create("UserResource",{user_id:this.getResourceId(),field_set_key:"grid_item"})}}),goog.provide("P.modules.UserMenu"),goog.require("P.Module"),goog.require("P.modules.DropdownButton"),P.modules.UserMenu=P.modules.DropdownButton.extend({onContentReady:function(){var a=this.extraData.userId;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(this.extraData.userId,b)}P.modules.DropdownButton.prototype.onContentReady.apply(this,arguments)},onUserUpdated:function(){this.render()},setSticky:function(a){this.getDropdown().setSticky(a)}}),goog.provide("P.modules.UserNews"),goog.require("P.Module"),goog.require("P.modules.FriendsToFollow"),P.modules.UserNews=P.Module.extend({events:{"click .sendInvite":"showBulkInviteBox","click .launchFlexibleSetup":"launchFlexibleSetup"},onContentReady:function(){this.destroyIfEmpty()},onChildRemoved:function(){this.destroyIfEmpty()||this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},getFriendsToFollowButton:function(){var a=this.getChildByModuleName("FriendsToFollow");return a.getHeaderElement()},showBulkInviteBox:function(){var a=P.experiments.instance.inExperimentGroups("pinvitational_philippines",["enabled","employees"]),b={name:a?"PinvitationalInviterWrapper":"MultiInviter"};P.loadModule(b).then(function(b){this.showInModal(b,{can_dismiss:!a,only_modal:!0})}.bind(this))},launchFlexibleSetup:function(){P.ExperienceTutorialManager.instance().startTutorial({type:P.Experiences.ExperienceType.NUX,id:"31:10035",display_data:{steps:[{moduleName:"NuxModalInterestPicker"},{moduleName:"NuxModalCompassStep",options:{mode:"final_loading"}}]}})}}),goog.provide("P.modules.UserProfileHeader"),goog.require("P.modules.BulkEditBar"),goog.require("P.Module"),P.modules.UserProfileHeader=P.Module.extend({events:{"click .movePinsButton":"onMovePinsClicked"},CssClassName:{ACTIVE:"active",SHADOW:"shadow"},onCreated:function(){this._resized=!1,this._canSeeFixedHeader=!1},_resizeTextIfReady:function(){!this._resized&&this.inDom&&this.contentReady&&this.$(".userProfileHeaderBio").overflowingText()},onContentReady:function(){if(this._resizeTextIfReady(),this.options.user_id){var a={};a[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(this.options.user_id,a)}var b={};if(b[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,b),this.options.report_user_spam&&!this.data.blocked_by_me){P.getModalManager().removeAllModals();var c={name:"FlagUser",options:{full_name:this.data.full_name,first_name:this.data.first_name,blocked_by_me:this.data.blocked_by_me,user_id:this.data.id,username:this.data.username,hide_other_field:!0}};P.loadModule(c).then(function(a){this.showInModal(a)}.bind(this))}"likes"===this.options.tab&&P.experiments.instance.inExperimentGroups("web_bulk_copy_like_page",["employees","enabled"])&&this.showMovePinsButton(),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll)},showMovePinsButton:function(){this.$(".movePinsButton").transition({top:"0px",easing:"ease-in",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})},hideMovePinsButton:function(){this.$(".movePinsButton").transition({top:"-68px",easing:"ease-in",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})},onMovePinsClicked:function(){if(!this.inBulkEditMode){this._setBulkEditMode(!0);var a=this.data,b={board_id:a.id,board_privacy:a.privacy,enable_move:!1,enable_copy:!0,enable_delete:!1},c=new P.modules.BulkEditBar({options:b});return c.render().then(function(){this.insertChild(c,this.$(".fixedHeader")),this.bulkEditBar=c,P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.ENTER_BULK_EDIT)}.bind(this))}},enterBulkEditMode:function(){var a=this._getFixedHeaderNameAndImage();this._canSeeFixedHeader&&a.transition({y:"102px",easing:"ease-in",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION}),a.hide(),this.$(".titleBar .buttons").transition({y:"64px",easing:"ease-in",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION}),this.bulkEditBar&&this.bulkEditBar.enterBulkEditMode()},exitBulkEditMode:function(){this.bulkEditBar&&this.bulkEditBar.exitBulkEditMode(),this.$(".titleBar .buttons").transition({y:"0",easing:"ease-in",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION});var a=this._getFixedHeaderNameAndImage();this._canSeeFixedHeader?(a.css({translate:"0, 102px"}),a.show(),a.transition({y:"56px",easing:"ease-in",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})):(a.css({translate:"0, 0"}),a.show())},toggleBulkEditMode:function(a,b,c){c===P.CONST.ENTER_BULK_EDIT?this.enterBulkEditMode():(this._setBulkEditMode(!1),this.exitBulkEditMode())},_setBulkEditMode:function(a){this.inBulkEditMode=a},_getFixedHeaderNameAndImage:function(){return this.$(".fixedHeaderNameAndImage")},onAddedToDom:function(){this._resizeTextIfReady()},onUserUpdated:function(){this.render()},onScroll:function(){var a=this.getScrollableElement().scrollTop();if(!(a<0)){var b=a>120;if(b^this._canSeeFixedHeader&&(this.inBulkEditMode||this.$(".fixedHeaderNameAndImage").transition({y:this._canSeeFixedHeader?"0":"50px",duration:200}),this.$(".fixedHeader").toggleClass(this.CssClassName.SHADOW),this._canSeeFixedHeader=b),P.CONTEXT.is_mobile_agent){var c=this.$(".userProfileMenu");c.hasClass(this.CssClassName.ACTIVE)&&c.trigger("click")}}}}),goog.provide("P.modules.VisuallySimilar"),goog.require("P.Module"),goog.require("P.modules.SearchInputToken"),P.modules.VisuallySimilar=P.Module.extend({events:{"change .queryType":"onButtonClick","click .flashlightAnnotation":"onAnnotationClick"},onCreated:function(){this.fetchVisuallySimilarResults(this.options),this.typeaheadField=this.getChildById("flashlightSearchField"),this.selectedAnnotations={}},onContentReady:function(){$(".tokensWrapper Input").hide(),this.childListen(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,this.onTokenRemovedByUser)},onTokenRemovedByUser:function(a){if(a.data){var b=a.data.text;delete this.selectedAnnotations[b],this.options.text_filters=Object.keys(this.selectedAnnotations)}this.fetchVisuallySimilarResults(this.options)},fetchVisuallySimilarResults:function(a){var b="VisualLiveSearchResource",c={name:"FlashlightResults",id:"flashlightResults",resource:{name:b,options:a}},d=this.getChildById("flashlightResults");d&&d.fadeOut(function(){d.destroy()}),this.showLoading(),P.loadModule(c).then(function(a){a.render().then(function(){this.hideLoading(),this.insertChild(a,this.$(".flashlightResultsContainer"))}.bind(this))}.bind(this))},onAnnotationClick:function(a){var b=$(a.target).attr("data-annotation");this.selectedAnnotations[b]=!0,this.options.text_filters=Object.keys(this.selectedAnnotations),this.typeaheadField=this.getChildById("flashlightSearchField"),this.tokenizedInput=this.typeaheadField.getChildById("tokenizedInput");var c=new P.modules.SearchInputToken({options:{term:$(a.target).attr("data-annotation"),position:0,color:"#B6C5BE"}});this.tokenizedInput.addToken(c),this.fetchVisuallySimilarResults(this.options)}}),require("common/lib/external/mapbox.uncompressed-2.1.5-patched.js"),goog.provide("P.modules.AddPinToMap"),goog.require("P.Module"),goog.require("P.modules.GeoFeatureList"),goog.require("P.modules.Map");var ID_BACK_BUTTON="backButton",ID_CLOSE_BUTTON="closeButton",RADIUS_MAX=1e5;P.modules.AddPinToMap=P.Module.extend({events:{"keydown input":"onSearchFieldKeydown","click .exampleQuery":"onExampleQueryClick"},CssClassName:{EMPTY_STATE:"isEmpty",HAS_GEO_FEATURES:"hasGeoFeatures",HAS_NO_RESULTS:"hasNoResults",LOADING:"loading"},onExampleQueryClick:function(a){var b=$(a.target),c=b.text();this.typeaheadField.setValue(c),this.typeaheadField.search()},onSearchFieldKeydown:function(){this.typeaheadField.setResourceOptionForTypeahead("center",this.center),this.typeaheadField.setResourceOptionForTypeahead("radius",null!=this.center?RADIUS_MAX:null),this.typeaheadField.setResourceOptionForTypeahead("near",null),this.typeaheadField.setResourceOptionForTypeahead("should_geocode",!0),this._ignoreHints=!1},onCreated:function(){this.onUploadSuccess=this.onUploadSuccess.bind(this),this._place=null,this.center=null,this.typeaheadItems=null,this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onTypeaheadItemHighlighted),this.childListen(P.CONST.EVENT_EXTERNAL_CLICK,this.onExternalClick),this.listen(this,P.CONST.EVENT_EXTERNAL_CLICK,this.onExternalClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onTypeaheadSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onTypeaheadHint),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.childListen(P.CONST.EVENT_PINIT_BUTTON_CLICKED,this.onPinItButtonClicked),this.childListen(P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST,this.onUpdateGeo)},onExternalClick:function(a){a.stopPropagation()},getTerm:function(){var a=this.typeaheadField.getValue();return a},search:function(){var a=this.getTerm();a.length&&this.typeaheadField.getTypeahead().search()},onTypeaheadHint:function(a){if(!this._ignoreHints){var b=a.data||[];this._loadFeatures(b),this.features.length>1?this._addGeoFeatureList():this._removeGeoFeatureList(),this._panMapAsNeeded(),this._toggleRegionEmptyResult()}},_toggleRegionEmptyResult:function(){var a,b=this.$(".noResults");a=this.features.length?P.string.format(P._("Sorry, we couldn't find {{ what }} in {{ where }}."),{where:this.$(".featureName").text(),what:this.interpretation.what}):P._("Sorry, we couldn't find that"),b.text(a)},_loadFeatures:function(a){var b=_.map(a,function(a){var b={},c=a.feature;return b.text=c.name,b.icon_class_name="flag"+c.cc,b.class_name="geoFeature",b.cc=c.cc,b.center=c.center,b});if(this.features=b,a.length){var c=a[0];this.interpretation={what:c.what,where:c.where,center:b[0].center}}},_removeGeoFeatureList:function(){this.$el.removeClass(this.CssClassName.HAS_GEO_FEATURES),this._geoFeatureList&&(this._geoFeatureList.hide(),this._geo=null,this._toggleRegionEmptyResult())},_addGeoFeatureList:function(){if(this.$el.addClass(this.CssClassName.HAS_GEO_FEATURES),this._geoFeatureList)this._geoFeatureList.updateFeatures(this.features),this._geoFeatureList.show();else{var a=this.typeaheadField,b=a.$el,c=new P.modules.GeoFeatureList({options:{features:this.features}});this._geoFeatureList=c,c.render().then(function(){this.insertChild(c,b)}.bind(this))}this._panMapAsNeeded()},_panMapAsNeeded:function(){if(this.interpretation){var a=this.interpretation.center,b=new L.LatLng(a.latitude,a.longitude);this._triggerCenter(b)}},onTypeaheadSearchStart:function(){this.showLoading()},hideTypeaheadResults:function(){this.typeaheadField.getTypeahead().emptyResults()},showLoading:function(){this.$el.toggleClass(this.CssClassName.LOADING,!0)},hideLoading:function(){this.$el.toggleClass(this.CssClassName.LOADING,!1)},_setLoading:function(a){this.$el.toggleClass(this.CssClassName.LOADING,a)},onTypeaheadResultsReturned:function(a){var b=a.data.items;this._setPlaceholderMarkersOnMap(b),this.hideEmptyState(),this.hideNoResults(),this.hideLoading()},showEmptyState:function(){this.hideNoResults(),this._setEmptyStateVisible(!0)},hideEmptyState:function(){this._setEmptyStateVisible(!1)},_setEmptyStateVisible:function(a){this.$el.toggleClass(this.CssClassName.EMPTY_STATE,a)},showNoResults:function(){this._setNoResultsVisible(!0)},hideNoResults:function(){this._setNoResultsVisible(!1)},_setNoResultsVisible:function(a){this.$el.toggleClass(this.CssClassName.HAS_NO_RESULTS,a)},onTypeaheadNoResultsReturned:function(){this.$(".Typeahead").show(),this.clearPlaceholderMarkersFromMap(),this.hideLoading(),this.hideTypeaheadResults(),this._toggleRegionEmptyResult();var a=this.getTerm();a.trim().length>1?this.showNoResults():this.showEmptyState()},_triggerCenter:function(a){this.triggerEvent(P.CONST.EVENT_CENTER_MAP_GEO_FEATURE,a)},getPlaceSelector:function(){return this.getChildByModuleName("PlaceSelector")},onContentReady:function(){var a=this.options.board_id,b=this.getPlaceSelector(),c=b.getTypeaheadField();this.typeaheadField=c;var d={};d[P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED]=this.onPlaceholderMarkerOpen,this.pubsubSubscribe(a,d)},onUpdateGeo:function(a){var b=a.data;this._geo=b,this._updateGeo(b),this._panMapAsNeeded();var c=this._geo.center,d=new L.LatLng(c.latitude,c.longitude);this._triggerCenter(d)},_updateGeo:function(a){var b=a.text,c=this.interpretation.what;this.typeaheadField.setResourceOptionForTypeahead("center",null),this.typeaheadField.setResourceOptionForTypeahead("radius",null),this.typeaheadField.setResourceOptionForTypeahead("near",b),this.typeaheadField.setResourceOptionForTypeahead("should_geocode",!1),this.typeaheadField.search(c),this._ignoreHints=!0},focus:function(){this.typeaheadField.focus()},onPlaceholderMarkerOpen:function(a,b,c){var d=c.place_id;if(d){var e=this.typeaheadField.getTypeahead();e.highlightItemWithAttributeAndValue("id",d),e.focusHighlighted()}},onUploadSuccess:function(a){a.stopPropagation();var b=a.data.image_url;this._setActiveImage(b)},onButtonClick:function(a){var b=a.target,c=b.id;if(c===ID_BACK_BUTTON){var d=this.getChildById("addPlace");d&&d.remove(),this._panMapAsNeeded(),this._setPlaceholderMarkersOnMap(this.typeaheadItems),this.setBackButton(!1),a.stopPropagation()}else c===ID_CLOSE_BUTTON&&this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null)},reset:function(){var a=this.typeaheadField;a.reset(),this.hideTypeaheadResults(),this._removeAddPlace()},onPinItButtonClicked:function(a){var b=a.data;this._setActiveImage(b),this.createPin()},_setActiveImage:function(a){this._activeImageUrl=a},_getActiveImage:function(){return this._activeImageUrl},createPin:function(){var a=this._place,b=a.get("id"),c=this.$("textarea").val(),d=this.options.board_id,e=this._getActiveImage(),f={board_id:d,place:b,description:c,image_url:e},g=P.resourceFactory.create("PinResource",f);g.callCreate().then(function(){this._place.set("placeholder",!1),this._setActiveImage(null),P.pubsub.publish(d,P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD,this._place.attributes),this.reset()}.bind(this))},addPermanentMarkerToMap:function(a){var b=a.attributes;this.triggerEvent(P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD,b)},_isNewPin:function(){return!this.options.pin_id},setBackButton:function(a){var b=this.getChildById("closeButton");a?(b.options.text=P._("Back"),b.id=ID_BACK_BUTTON,b.options.cancelButton=!1):(b.options.text=P._("Close"),b.id=ID_CLOSE_BUTTON,b.options.cancelButton=!0),b.render()},_replaceContentWithPinForm:function(a){var b=this.options.board_id,c={id:"addPlace",name:"AddAPlace",options:{place:a.attributes,board_id:b}};P.loadModule(c).then(function(b){this.showLoading(),b.render().then(function(){this.setBackButton(!0),this.hideLoading();var c=this.$(".typeaheadWrapper");this.insertChild(b,c),b.setPlace(a)}.bind(this))}.bind(this))},_removeAddPlace:function(){var a=this.getChildById("addPlace");
a&&a.remove()},_getMarkerOptions:function(a){var b=P.MarkerOptionsFactory.fromPlainObject(a.attributes);return b},onRemovedFromDom:function(){this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null)},_setPlaceholderMarkersOnMap:function(a){this.typeaheadItems=a;var b=_.map(a,function(a){return a.get("template")?void 0:this._getMarkerOptions(a)}.bind(this));b=b;var c={markerOptionsList:b};this.triggerEvent(P.CONST.EVENT_SET_PLACEHOLDER_MARKERS,c)},highlightPlaceholderMarkerOnMap:function(a){var b=a.get("resultIndex"),c={index:b};this.triggerEvent(P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER,c)},clearPlaceholderMarkersFromMap:function(){this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null),this.triggerEvent(P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,null)},hideChildDropdowns:function(){this._geoFeatureList&&this._geoFeatureList.hideDropdown()},onTypeaheadItemSelected:function(a){a.stopPropagation();var b=a.data.item;if(b&&!b.get(P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE)){var c=b.get("search_id"),d=b.get("id");if(c){var e={search_id:c,place:d},f=P.resourceFactory.create("PlacePingbackResource",e);f.call("update",{error:P.NOOP,success:P.NOOP,complete:P.NOOP})}if(this._isNewPin()){this._place=b;var g=b.get("latitude"),h=b.get("longitude"),i=L.latLng(g,h),j=b.get("resultIndex"),k={latLng:i,index:j};return this.triggerEvent(P.CONST.EVENT_PLACE_SELECTED,k),this._replaceContentWithPinForm(b),void this.highlightPlaceholderMarkerOnMap(b)}var l=a.target;l.showLoading(!0);var m=this.options.pin_id,n=P.resourceFactory.create("PinResource",{id:m,place:d});n.callUpdate({showError:!1}).then(function(a){var c=a.resource_response.data;l.hideLoading(),this.addPermanentMarkerToMap(b),P.pubsub.publish(m,P.CONST.PUBSUB_TOPIC_PIN_UPDATED,c)}.bind(this))}},onTypeaheadItemHighlighted:function(a){var b=a.data.item;b||this._place?(b&&this.highlightPlaceholderMarkerOnMap(b),a.stopPropagation()):this.triggerEvent(P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,null)}}),goog.provide("P.modules.Board"),goog.require("P.HoverIntent"),goog.require("P.Module"),goog.require("P.modules.Dropdown");var VIEW_TYPE_FOLLOW="follow_view",VIEW_TYPE_BOARD_PINS_GRID="boardPinsGrid",VIEW_TYPE_BOARD_COVER_IMAGE="boardCoverImage";P.modules.Board=P.Module.extend({events:{"click .dismiss":"onDismissClick"},CssClassName:{NOT_NAVIGATABLE:"notNavigatable",NO_SHADOW:"noShadow"},getOwnedScrollables:function(){return this.$(".pinGridWrapper")},onContentReady:function(){var a=this.getId();if(a){var b={};b[P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED]=this.onBoardCoverUpdated,b[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,b[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,b[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,this.pubsubSubscribe(a,b)}if(this.options.view_type===VIEW_TYPE_BOARD_PINS_GRID){var c=this.getChildById("pinGrid");this.listen(c,P.CONST.EVENT_CONTENT_CHANGED,this.updateDom)}this.options.view_type===VIEW_TYPE_FOLLOW&&this.initHoverListeners()},onDismissClick:function(){this.dismissed=!0,this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},onBoardHoverEnter:function(){this.$el.isHovering()&&this._dropdown.show()},onBoardHoverExit:function(){this._dropdown.isHovering()||this._dropdown.hide()},onPinDeleted:function(){this.options.view_type===VIEW_TYPE_BOARD_COVER_IMAGE&&this.onBoardUpdated()},onBoardCoverUpdated:function(a,b,c){this.setBoardCover(c)},positionBoardPinsGrid:function(){var a=this.getChildById("pinGrid");a.$(".activeItem").focus()},toggleFollow:function(){this.getChildByModuleName("BoardFollowButton").toggleFollow()},initHoverListeners:function(){!this._hoverIntent&&this.options.use_flyout&&(this._hoverIntent=new P.HoverIntent(this.$el,{enterDelay:500,exitDelay:200}),this.listen(this,P.CONST.EVENT_NAVIGATE,this.onBoardHoverExit),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE,this.onBoardHoverEnter),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,this.onBoardHoverExit),this.isClickButton=function(){return!1},this._dropdown=new P.modules.Dropdown({options:{anchor:this.$el,class_name:"followViewHover underneathHeader",position_point:"RIGHT_TOP",module:{name:"Board",options:{view_type:"boardPinsGrid",scrollable:!0,prevent_default_scroll:!0,board_follow_button_options:{board_id:this.resource.options.board_id}},resource:{name:"BoardResource",options:{board_id:this.resource.options.board_id}}}}}),this.appendChild(this._dropdown),this.$el.initHovering(),this._dropdown.initHovering())},setBoardCover:function(a){var b=a.url,c=a.crop_x,d=a.crop_y,e=a.nativeHeight,f=a.nativeWidth,g=a.scale,h=this.$(".boardCoverWrapper img");h.attr("src",b).css({height:e*g,left:-c,"max-width":"none",position:"absolute",top:-d,width:f*g})},disabledButtons:[],disable:function(){this.$el.find(".hoverMask").addClass(this.CssClassName.NOT_NAVIGATABLE),this.disabledButtons=[],_.each(this.getChildrenByModuleName("ShowModalButton"),function(a){a.isDisabled()||(a.disable(),this.disabledButtons.push(a))}.bind(this))},enable:function(){this.$el.find(".hoverMask").removeClass(this.CssClassName.NOT_NAVIGATABLE),_.each(this.disabledButtons,function(a){a.enable()})},setFollowButtonState:function(a){var b=this.getChildByModuleName("BoardFollowButton");b&&b.setState(a)},getId:function(){return this.data&&this.data.id},onBoardDeleted:function(){this.triggerEvent(P.CONST.EVENT_BOARD_DELETED,this,!0),this.destroy()},onBoardUpdated:function(){this.render()},getLoggingObjectIdStr:function(){return this.getId()},updateBoardPinsGrid:function(a,b){this.updatePinGrid(a.id,b),this.updateUser(a.name,a.url,(a.owner||{}).id)},updateBoardGridActiveItem:function(a){var b=this.getChildById("pinGrid");b&&a&&b.updateActiveGridItem(a)},updateBoardDetails:function(a){this.data.id=a.id,this.updateBoardIcons(a),this.updateBoardButtons(a)},updateBoardIcons:function(a){var b=this.getChildByModuleName("BoardIcons");b&&a&&(b.data=a,b.render())},updateDom:function(){var a=this.$el.css("max-height")||"0";a=a.replace(/[^0-9]/g,""),this.$el.outerHeight()<a&&this.$el.addClass(this.CssClassName.NO_SHADOW)},updateUser:function(a,b,c){var d=this.getChildByModuleName("User");d&&a&&c&&(d.options.title_text=a,d.options.url=b,d.options.spinner={enable:!1},d.resource.set("user_id",c),d.render())},updatePinGrid:function(a,b){var c=this.getChildById("pinGrid");c&&a&&b&&(c.options.active_item_id=b,c.options.spinner={enable:!1},c.resource.set("board_id",a),c.render())},updateBoardButtons:function(a){var b=this.getChildById("boardButtons");if(b&&a){var c={board_access:a.access||[],board_followed_by_me:a.followed_by_me,board_owner:(a.owner||{}).id,board_id:a.id};b.options.button_options=c,b.options.url=a.url,b.render()}}}),goog.provide("P.modules.BoardCreate"),goog.require("P.Module"),goog.require("P.modules.BoardEditBase"),goog.require("P.modules.BoardInvites");var ANIMATE_ENTRANCE_EXIT_DURATION=150;P.modules.BoardCreate=P.modules.BoardEditBase.extend({CssClassName:_.extend(P.modules.BoardEditBase.prototype.CssClassName,{HAS_MAX_HEIGHT:"hasMaxHeight"}),_clearInviteForm:function(){var a=this.getChildById("boardInviteForm");a.clearTypeahead()},onChildInviteUser:function(a){var b=this.getChildById("boardInvites"),c=a.data.userId,d=a.data.type,e=a.data.attributes;if(d===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER)b.addInvitee({type:"facebook",identifier:c,attributes:e});else if("user"===d)b.addInvitee({type:"pinner",identifier:c});else{var f=a.data.userId;b.addInvitee({type:"email",identifier:f})}this._clearInviteForm()},setCollabsMaxHeight:function(){this.updateDom()},updateDom:function(){var a=this.getChildById("boardInvites"),b=a.getContent(),c=b.position().top,d=this.$(".formFooter").outerHeight(),e=this.getHeight()-d-c;b.addClass(this.CssClassName.HAS_MAX_HEIGHT).css("max-height",e)},animateOut:function(a){var b=this.getWidth();this.$el.transition({x:b,duration:ANIMATE_ENTRANCE_EXIT_DURATION},function(){a&&a(),this.destroy()}.bind(this))},animateIn:function(a){var b=this.getWidth();this.$el.transition({x:b,opacity:1,duration:1}).transition({x:0,duration:ANIMATE_ENTRANCE_EXIT_DURATION,easing:"ease-out"},function(){this.focusDescription(),a&&a()}.bind(this))},focusDescription:function(){this.$(".boardEditDescription").focus()},onChildInviteEmail:function(a){var b=this.getChildById("boardInvites"),c=a.data.email;b.addInvitee({type:"email",identifier:c}),this._clearInviteForm()}}),goog.provide("P.modules.BoardEditActionBase"),goog.require("P.Module"),goog.require("P.modules.BoardEditBase"),goog.require("P.modules.BoardInvites"),P.modules.BoardEditActionBase=P.modules.BoardEditBase.extend({onCreated:function(){P.modules.BoardEditBase.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange)},onContentReady:function(){if(P.autologin.checkForAutologin()){var a=P._("To edit your board, please take a second to confirm it's really you.");return P.autologin.showLoginErrorDialog(this,a),void this.destroy()}P.modules.BoardEditBase.prototype.onContentReady.call(this);var b={};b[P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR]=this.onBannedUser,b[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,this.pubsubSubscribe(this.data.id,b)},onInviteAdded:function(a,b){var c=this.getChildById(a?"boardPendingInvites":"boardInvites");P.trackGAEvent("collaborator_invite_user",P.CONST.GA_ACTION_SUCCESS),c.addInvitee({type:b.type,identifier:b.invitee})},onSubmitValidated:function(){if(!this._showSecretBoardStatusChangeConfirmation)return void this.saveBoard();var a={name:"ConfirmDialog",options:{template:"make_public"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.saveBoard)}.bind(this))},onChildChange:function(a){if("secretCheckbox"===a.target.id){var b=!a.target.isChecked();this._showSecretBoardStatusChangeConfirmation=b?!0:!1}},deleteBoard:function(){var a=this.getBoardId(),b=this.getFieldValues(),c=b.privacy,d=P.resourceFactory.create("BoardResource",{board_id:a}),e=function(a){P.showError(a.message),P.trackGAEvent("board_delete",P.CONST.GA_ACTION_ERROR)},f=function(b){if(P.trackGAEvent("board_delete",P.CONST.GA_ACTION_SUCCESS),this.updateBoardPickerBoardsResource(),b){var d=b.resource_response;if(d&&!d.error){this.handleDelete(a,c);var f=P.resourceFactory.create("BoardPickerBoardsResource",{filter:"all",field_set_key:"board_picker",allow_stale:!0});return void P.resourceCache.instance.invalidate(f)}}e(b)}.bind(this);this.showLoading(),d.callDelete({showError:!1}).then(f,e).fin(function(){this.hideLoading()}.bind(this))},handleDelete:function(){},redirectAfterDelete:function(){var a=this.data.owner?"/"+this.data.owner.username+"/":"/";window.location.href!==a&&this.navigate(a)},onBoardRemovedSelf:function(){this.destroy()},onBannedUser:function(){var a=this.getChildById("boardInvites");a.render();var b=this.getChildById("boardPendingInvites");b&&b.render()}}),goog.provide("P.modules.BoardFollowButton"),goog.require("P.Module"),goog.require("P.modules.FollowButton"),P.modules.BoardFollowButton=P.modules.FollowButton.extend({getResourceId:function(){return this.options.board_id},getFollowResource:function(){return P.resourceFactory.create("BoardFollowResource",{board_id:this.getResourceId()})},getFollowClass:function(){return this.options.follow_class},getContextualResource:function(){return P.resourceFactory.create("BoardResource",{board_id:this.getResourceId(),field_set_key:"grid_item"})},getAuthRedirectUrl:function(){return P.currentUser.isAuthenticated()?void 0:P.signupModalManager.showInlineSignupModalOnButtonClick("BoardFollowButton")},onContentReady:function(){if(this.options.user_id){var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowUser,a[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onUnfollowUser,this.pubsubSubscribe(this.options.user_id,a)}var b={};b[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this._onFollow,b[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this._onUnfollow,this.pubsubSubscribe(this.getResourceId(),b),this.showMemo()},_onFollow:function(){var a={board_id:this.getResourceId()};this.triggerEvent(P.CONST.EVENT_BOARD_FOLLOW,a,!0)},_onUnfollow:function(){var a={board_id:this.getResourceId()};this.triggerEvent(P.CONST.EVENT_BOARD_UNFOLLOW,a,!0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW,!0)},onFollowUser:function(){this.setState(!0)},onUnfollowUser:function(){this.setState(!1)}}),goog.provide("P.modules.BoardInfoBar"),goog.require("P.Module"),goog.require("P.modules.BulkEditBar");var EDIT_BUTTON_ID="editButton",ANIMATION_DURATION=300,ANIMATION_EASING="ease-out";P.modules.BoardInfoBar=P.Module.extend({CssClassName:{FIXED_HEADER:"fixedHeader",HEADER_COLLAPSED:P.CONST.CLASS_HEADER_COLLAPSED},events:{"click .movePinsButton":"onMovePinsClicked","click .backtoTop":"scrollToTop"},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED]=this.onWriteAccessChange,this.pubsubSubscribe(this.data.id,a),this._isPlaceBoard="places"===this.data.layout;var b={};b[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,b)},onAddedToDom:function(){var a=this.$el.position().top;"places"===this.data.layout&&(a+=P.CONST.PIN_MARGIN,P.CONTEXT.is_mobile_agent||(a=300)),this.infoBarPosition=a,P.CONTEXT.is_mobile_agent||("undefined"===typeof this.options.fixedHeader&&this.updateOptions({fixedHeader:!1}),"undefined"===typeof this.inBulkEditMode&&this._setBulkEditMode(!1),"undefined"===typeof this.options.collapsible&&this.setCollapsible(!0),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll),this.onScroll())},onRemovedFromDom:function(){this.scrollListener&&this.removeListener(this.scrollListener)},onWriteAccessChange:function(){this.render()},showEditModal:function(){var a=this.getChildById(EDIT_BUTTON_ID);return a?(a.showModalSubmodule(),!0):!1},onScroll:function(){var a=this.getScrollableElement().scrollTop();a<0||!this.options.collapsible||(a>=this.infoBarPosition&&!this.options.fixedHeader?this.collapse():a<this.infoBarPosition&&this.options.fixedHeader&&this.expand())},collapse:function(){this.options.fixedHeader||(this.triggerEvent(P.CONST.EVENT_INFO_BAR_COLLAPSED,null,!0),this.updateOptionsAndDom({collapsed:!0,fixedHeader:!0}))},expand:function(){this.options.fixedHeader&&(this.triggerEvent(P.CONST.EVENT_INFO_BAR_EXPANDED,null,!0),this.updateOptionsAndDom({collapsed:!1,fixedHeader:!1}))},toggleOtherPinsHeader:function(a){var b=this.$(".smallBoardName"),c=this.$(".boardButtons"),d=this.$(".collaborators"),e=this.$(".backtoTop");this.options.boardName||(this.options.boardName=b.text()),!this.options.otherPinsHeaderShowing&&a?(b.fadeOut(ANIMATION_DURATION,function(){b.text(P._("More Pins like these"))}).fadeIn(ANIMATION_DURATION),c.fadeOut(ANIMATION_DURATION),d.fadeOut(ANIMATION_DURATION,function(){e.fadeIn(ANIMATION_DURATION)})):this.options.otherPinsHeaderShowing&&!a&&(b.fadeOut(ANIMATION_DURATION,function(){b.text(this.options.boardName)}.bind(this)).fadeIn(ANIMATION_DURATION),c.fadeIn(ANIMATION_DURATION),d.fadeIn(ANIMATION_DURATION),e.fadeOut(ANIMATION_DURATION,function(){d.fadeIn(ANIMATION_DURATION)})),this.options.otherPinsHeaderShowing=a},scrollToTop:function(){this.$(".smallBoardName").css("opacity","0"),P.scrollToTop({})},onMovePinsClicked:function(){if(!this.inBulkEditMode){this._setBulkEditMode(!0);var a=this.data,b={board_id:a.id,board_privacy:a.privacy,is_place_board:this._isPlaceBoard},c=new P.modules.BulkEditBar({options:b});return c.render().then(function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.ENTER_BULK_EDIT);var a="64px";this.insertChild(c,this.$el),this.bulkEditBar=c,this.enterBulkEditMode(a)}.bind(this))}},enterBulkEditMode:function(a){this.$(".infoBarWrapper").transition({y:a,easing:ANIMATION_EASING,duration:P.CONST.BULK_EDIT_ANIMATION_DURATION}),this.bulkEditBar.enterBulkEditMode()},exitBulkEditMode:function(){this.bulkEditBar.exitBulkEditMode(),this._setBulkEditMode(!1),this.$(".infoBarWrapper").transition({y:"0",easing:ANIMATION_EASING,duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})},toggleBulkEditMode:function(a,b,c){c===P.CONST.EXIT_BULK_EDIT&&(this.bulkEditBar&&this.bulkEditBar.exitBulkEditMode(),this.exitBulkEditMode())},updateDom:function(){this.$el.toggleClass(this.CssClassName.HEADER_COLLAPSED,this.options.collapsed),this.$el.toggleClass(this.CssClassName.FIXED_HEADER,this.options.fixedHeader);var a={easing:ANIMATION_EASING,duration:ANIMATION_DURATION},b=this.$(".smallBoardName"),c=this.$(".pinsAndFollowerCount");this.inBulkEditMode||(this.options.fixedHeader?(a.y="66px",b.css("opacity",1),b.transition(a)):(a.y="0",b.transition(a,function(){b.css("opacity",0)})),c.transition(a))},_setBulkEditMode:function(a){this.inBulkEditMode=a},setCollapsible:function(a){this.updateOptions({collapsible:a})}}),goog.provide("P.modules.BoardPicker"),goog.require("P.modules.Picker"),goog.require("P.modules.BoardCreate"),P.modules.BoardPicker=P.modules.Picker.extend({onCreated:function(){P.modules.Picker.prototype.onCreated.call(this)},onContentReady:function(){P.modules.Picker.prototype.onContentReady.call(this),this.options.async&&this.getBoardsShortList().length&&this._renderQuickPicksItems(),this.options.select_first_board&&this.selectFirstBoard(),this.options.default_board_id&&this.selectBoardById(this.options.default_board_id),this.model&&this.model.on("change",function(){this.renderExistingData()}.bind(this))},_renderQuickPicksItems:function(){var a=P.resourceFactory.create("BoardPickerBoardsResource",{pin_id:this.options.pin_id,filter:"all",field_set_key:"board_picker",allow_stale:"true",shortlist_length:3,shortlist_suggestions:2});a.callGet({showError:!1}).then(function(a){var b=this.getList();this.data=a.resource_response.data,b.removeItem($(".recentBoards .item").eq(1));var c=a.resource_response&&a.resource_response.data&&a.resource_response.data.boards_shortlist,d=c.slice(1);d.forEach(function(a){b.appendItem({type:"module",name:"BoardLabel",item_module:"BoardLabel",data:a,options:{view_type:"pinCreate3",show_pin_it_button:!0}},!1,0)})}.bind(this)),this.focus()},selectBoardAtIndex:function(a){var b=this._list.$(".allBoards"),c=b.find(".item").eq(a);this._list._selectItem(c)},selectBoardById:function(a){var b=-1;this.getAllBoards().forEach(function(c,d){c.id===a&&(b=d)}),b>0&&this.selectBoardAtIndex(b)},selectFirstBoard:function(){this._list.selectFirstVisibleItem()},create:function(a){return this._create(a)},getSelectedElement:function(){return this._list.getSelectedItemElement()},getSelectedBoardData:function(){return this._list.getSelectedItemData()},getAllBoards:function(){return this.data.all_boards},getBoardsShortList:function(){return this.data.boards_shortlist},_onNameTextChange:function(){if(P.modules.Picker.prototype._onNameTextChange.call(this),this.options.hide_all_boards_heading_on_filter){var a=this._getNameInputText(),b=this.$(".allBoards .sectionHeading");a.length?b.hide():b.show()}},_create:function(a){var b=P.experiments.instance.inExperimentGroupsActiveOrTriggerable("web_pin_create2",["enabled_v5_toast"]),c=!!this.options.in_bulk_edit,d="compact"===this.options.view_type;if(a&&(!b||c||d)){var e=P.resourceFactory.create("BoardResource",{name:a});return e.callCreate().then(function(a){var b=a.resource_response.data,c=b.id;return this.triggerEvent(P.CONST.EVENT_BOARD_CREATED,c,!0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,b),b}.bind(this))}return a||b?Promise.resolve({name:a}):new Promise(function(b){var c=new P.modules.BoardCreate;c.setOptions({name:a,navigate_on_success:!1}),this.listen(c,P.CONST.EVENT_DESTROYED,function(){b(null)}),this.listen(c,P.CONST.EVENT_BOARD_CREATED,function(a){b(a.data)}),this.showInModal(c)}.bind(this))},hasBoards:function(){return this.extraData.hasBoards},appendModuleToList:function(a,b){var c=this.getList();c.appendItem(a,!1,b)}}),goog.provide("P.modules.BoardPickerDropdownButton"),goog.require("P.modules.BoardPicker"),goog.require("P.modules.DropdownButton"),P.modules.BoardPickerDropdownButton=P.modules.DropdownButton.extend({CssClassName:_.extend(P.modules.DropdownButton.prototype.CssClassName,{PRIMARY:"primary"}),onCreated:function(){P.modules.DropdownButton.prototype.onCreated.call(this),this._selectedBoard=null,this.childListen(P.CONST.EVENT_CHANGE,this._onChildChange),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this._onChildDropdownHide)},onContentReady:function(){this.extraData&&(this._selectedBoard=this.extraData.selectedBoard),P.modules.DropdownButton.prototype.onContentReady.call(this),this.extraData.noBoards&&P.deferDomManipulation(function(){var a=this.$el;P.boardPickerUtil.showNoBoardsTooltip(a)}.bind(this))},getContentModuleLoadOptions:function(){var a=!!this.options.in_bulk_edit,b={name:"BoardPicker",options:{view_type:"compact",in_popover:!0,in_bulk_edit:a},resource:{name:this.resource.name,options:this.resource.options}};return this.options.selected_board_id?b.options.selected_board_id=this.options.selected_board_id:(b.options.selected_section_index=0,b.options.selected_item_index=0),b},getSelectedBoardId:function(){return this._selectedBoard?this._selectedBoard.id:null},getSelectedBoardPrivacy:function(){return this._selectedBoard?this._selectedBoard.privacy:null},_onChildChange:function(a){a.stopPropagation(),this._selectedBoard=a.data,this.options.selected_board_id=this._selectedBoard.id;var b=this._getLabelModule();b.data=this._selectedBoard,b.renderExistingData(),this.hideDropdown(),this.$el.removeClass(this.CssClassName.PRIMARY),this.triggerEvent(P.CONST.EVENT_CHANGE,a.data,!0),this.$el.blur()},_onChildDropdownHide:function(){var a=this.getDropdown().getContentModule();a.clearName()}}),goog.provide("P.modules.BuildingHomeFeedSpinner"),goog.require("P.modules.StepBase"),goog.require("P.modules.NuxProgress");var MAX_STATUS_CHECKS=10,HOME_FEED_STATUS_POLL_INTERVAL=500;P.modules.BuildingHomeFeedSpinner=P.modules.StepBase.extend({numChecks:0,onContentReady:function(){this.options.is_nux&&_.defer(function(){var a=P.app.getChildByModuleName("NuxProgress");a.initializeProgress({module:this})}.bind(this))},_checkHomeFeedRebuildStatus:function(){var a,b=function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)};a=P.resourceFactory.create("OrientationContextStatusResource",{redo_homefeed:this.options.is_nux===!1}),this.numChecks+=1,a.callGet({showError:!1}).then(function(){b()},function(){this.numChecks<=MAX_STATUS_CHECKS?P.setTimeout(this._checkHomeFeedRebuildStatus.bind(this),HOME_FEED_STATUS_POLL_INTERVAL):b()}.bind(this))},onShow:function(a){P.setTimeout(this._checkHomeFeedRebuildStatus.bind(this),HOME_FEED_STATUS_POLL_INTERVAL),P.modules.StepBase.prototype.onShow.call(this,a)}}),goog.provide("P.modules.BusinessGetStarted"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),P.modules.BusinessGetStarted=P.Module.extend({events:{"click .partnerCreateBoard":"createBoard"},createBoard:function(){return P.trackGAEvent("board_create",P.CONST.GA_ACTION_OPEN_MODAL),this.showBoardCreateModal(),!1},showBoardCreateModal:function(){var a=new P.modules.BoardCreate({options:{}});this.showInModal(a)}}),goog.provide("P.modules.CloseupSidebar"),goog.require("P.Module"),goog.require("P.modules.Board"),P.modules.CloseupSidebar=P.Module.extend({onContentReady:function(){if(this.data.id){var a={};a[P.CONST.PUBSUB_TOPIC_PIN_UPDATED]=this.onPinUpdated,this.pubsubSubscribe(this.data.id,a)}var b=this.getChildByModuleName("Board");b&&b.positionBoardPinsGrid()},onPinUpdated:function(){this.render()},_updateVisualModule:function(a){if(this.$(".visuallySimilarContainer")){var b=this.getChildById("visuallySimilar"),c=this.$(".nonVisuallySimilarContainer");if(!a)return void(b&&b.fadeOut(function(){b.destroy(),c.fadeIn()}));var d={name:"VisuallySimilar",id:"visuallySimilar",options:a};c.fadeOut(),this.showLoading(),P.loadModule(d).then(function(a){a.render().then(function(){_.each(this.getChildrenByModuleName("VisuallySimilar"),function(a){this.removeChild(a)}.bind(this)),this.hideLoading(),this.insertChild(a,this.$(".visuallySimilarContainer")),a.fadeIn()}.bind(this))}.bind(this))}},updateVisuallySimilar:function(a){var b=null;a&&(b={pin_id:a.pinId,obj_id:a.objId}),this._updateVisualModule(b,"VisualSearchResource")},updateLiveVisualSearch:function(a){var b=null;a&&(b={pin_id:a.pinId,crop:a.crop}),this._updateVisualModule(b,"VisualLiveSearchResource")},updateDomain:function(a){var b=this.getChildById("domain");if(!a)return void(b&&(b.destroy(),this.$(".domainContainerTitle").hide()));if(!b&&a){var c={name:"Domain",id:"domain",options:{spinner:{enable:!1}},resource:{name:"DomainResource",options:{domain:a}}};return P.loadModule(c).then(function(a){return a.render().then(function(){this.$(".domainContainerTitle").show(),this.insertChild(a,this.$("#domainContainer"))}.bind(this))}.bind(this))}return b.resource.set("domain",a),b.render().then(function(){b.fadeIn()})},updateRelatedRecipes:function(a){if(this.$(".relatedRecipeContainer")){var b=this.getChildById("relatedRecipe");if(!a||0===a.length)return void(b&&b.destroy());if(!b&&a){var c={name:"RelatedRecipe",id:"relatedRecipe",options:{ingredients:a},resource:{name:"NoopResource",options:{}}};return void P.loadModule(c).then(function(a){a.render().then(function(){this.insertChild(a,this.$(".relatedRecipeContainer"))}.bind(this))}.bind(this))}b.options={ingredients:a},b.render().then(function(){b.fadeIn()})}},updateBoardGrid:function(a,b){var c=this.getChildById("boardGrid");c&&a&&b&&(c.getId()===a.id?c.updateBoardGridActiveItem(b):(this.data.board=a,c.updateBoardPinsGrid(a,b)))},updateBoardDetails:function(a){var b=this.getChildById("boardGrid");b&&a&&b.getId()!==a.id&&b.updateBoardDetails(a)}}),goog.provide("P.modules.Conversation"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),goog.require("P.modules.ConversationHead"),goog.require("P.modules.ConversationPopup"),P.modules.Conversation=P.Module.extend({CssClassName:{UI_STATE_CONVERSATION:"ui-state-conversation",UI_STATE_HOVER:"ui-state-hover"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CONVERSATION_HEAD_READY,this.onConversationHeadReady)},onEscape:function(){P.getConversationsManager().closeConversation(this)},onContentReady:function(){this._attachPopup()},onConversationHeadReady:function(a){var b=a.target;_.contains(this.children,b)&&(this._headClickListener||(this._headClickListener=this.listen(b,P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,this.onConversationHeadClick)),b.getContent().droppable({activeClass:"ui-state-highlight",tolerance:"pointer",over:function(a,b){$(b.helper).transition({scale:.24},230,"ease").transition({scale:.25,duration:20}),$(this).transition({scale:1.3,duration:150}).transition({scale:1.2,duration:100})},out:function(a,b){$(b.helper).transition({scale:1,duration:250}),$(this).transition({scale:1,duration:250})},drop:function(a,b){var c=this.getConversationPopup(),d=P.getConversationsManager().getDraggedObject();c.sendMessage(null,d),P.getConversationsManager().openConversation(this),$(b.helper).transition({scale:1,duration:0})}.bind(this)}))},onConversationHeadClick:function(){if(this._popup)if(this._popup.isShowing()){if(this.getConversationHeadBadgeCount())return void this.getConversationPopup().scrollToLatest();P.getConversationsManager().closeConversation(this)}else P.getConversationsManager().openConversation(this);else this._attachPopup()},onDropdownShow:function(){var a=this.getConversationPopup();this.focusInput();var b=this._popup.getContent();b.droppable({activeClass:"ui-state-highlight",tolerance:"pointer",activate:function(){P.getConversationsManager().getDraggedObject()&&a.showDropTarget()},deactivate:function(){a.hideDropTarget()},over:function(c,d){P.getConversationsManager().getDraggedObject()&&($(d.helper).addClass(this.CssClassName.UI_STATE_CONVERSATION),a.setDropTargetText(P._("Drop here to send!")),d.helper.transition({scale:.5,duration:130}).transition({scale:.53,duration:50}),b.addClass(this.CssClassName.UI_STATE_HOVER))}.bind(this),out:function(c,d){$(d.helper).removeClass(this.CssClassName.UI_STATE_CONVERSATION),a.setDropTargetText(P._("Drag here to send!")),b.removeClass(this.CssClassName.UI_STATE_HOVER),d.helper.animate({scale:1},150)}.bind(this),drop:function(c,d){if(P.getConversationsManager().getDraggedObject()){var e=P.getConversationsManager().getDraggedObject();a.sendMessage(null,e),$(d.helper).transition({scale:1,duration:0}),P.setTimeout(function(){$(d.helper).removeClass(this.CssClassName.UI_STATE_CONVERSATION)}.bind(this),100),b.addClass(this.CssClassName.UI_STATE_HOVER)}}.bind(this)}),this._shouldScrollToBottom&&a.scrollToLatest(),this._shouldScrollToBottom=!1},_attachPopup:function(){var a={module:this.getPopupModuleLoadOptions(),anchor:this.getContent(),mouse_close_mode:"never",persist_through_navigate:!0,fixed:!0,caret_style:"lightGray lightGrayConversations",position_point:"RIGHT_BOTTOM",class_name:"aboveModal activeConversationDropdown",prefetch:!0};this._popup=new P.modules.Dropdown({options:a,id:"popup"}),this.addChild(this._popup),this._shouldScrollToBottom=!0,this.listen(this._popup,P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.listen(this._popup,P.CONST.EVENT_ESCAPE_DROPDOWN,this.onEscape),this.childListen(P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE,this.onDecrementBadge)},onDecrementBadge:function(){var a=this._getConversationHead(),b=this.getConversationHeadBadgeCount(),c=Math.max(b-1,0);a.setBadgeCount(c)},getPopupModuleLoadOptions:function(){var a=_.clone(this.options);return a.peek=!0,_.isUndefined(this.options.peek)||(a.peek=this.options.peek),a.popup_log_component_type=P.ContextLogging.ComponentType.CONVERSATION_MESSAGES,{name:"ConversationPopup",options:a,data:this.data}},focusInput:function(){var a=this.getConversationPopup();a&&a.focus()},updateConversation:function(a){this.data=a;var b=a.unread,c=this.getConversationPopup();if(this.popupIsVisible()){if(!c.isScrolledToBottom()){var d=this.getConversationHeadBadgeCount(),e=d+b;c.setUnseenMessageCount(e),this.setBadgeCount(e)}c.fetchNewMessages(b)}else this.setBadgeCount(b),c.fetchNewMessages(b,!0)},getConversationPopup:function(){return this._popup.getContentModule()},focus:function(){this.focusInput()},onDestroyed:function(){this.closePopup()},showPopup:function(){var a=this.getConversationHeadBadgeCount();a&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,a),this.setBadgeCount(0),this._popup.show(),this.focusInput()},adjustPopup:function(){this._popup.reposition()},getConversationHeadBadgeCount:function(){var a=this._getConversationHead();return a.getBadgeCount()},closePopup:function(){this._popup.hide()},setBadgeCount:function(a){var b=this._getConversationHead();b.setBadgeCount(a)},setActive:function(){var a=this._getConversationHead();a.setActive()},setInactive:function(){var a=this._getConversationHead();a.setInactive()},popupIsVisible:function(){return this._popup.isVisible()},_getConversationHead:function(){return this.getChildById("conversationHead")},onButtonClick:function(a){var b=a.target;b.isCancelButton()&&(this.closePopup(),P.getConversationsManager().scaleConversationDownAndRemove(this.getConversationId()))},getConversationId:function(){return this.options.id}}),goog.provide("P.modules.FastFollow"),goog.require("P.Module"),goog.require("P.modules.Grid");var FAST_FOLLOW_CONTENT_CLASS="fastFollowContent",FAST_FOLLOW_HEADER_ID="fastFollowHeader",FAST_FOLLOW_GRID_ID="categoryBoardsGrid",FAST_FOLLOW_BOARD_MASK="wholeBoardMask",FAST_FOLLOW_MIN_HEIGHT=355,FAST_FOLLOW_MODAL_TOP_PADDING=102,FAST_FOLLOW_MODAL_BOTTOM_PADDING=56,NUM_REQUIRED_BOARDS=5,FastFollowSidebarActions={CATEGORY:0,SEARCH_TERM:1};P.modules.FastFollow=P.Module.extend({_boardsFollowed:[],_modalDisplayed:!1,_cachedGrids:{},_currentAction:FastFollowSidebarActions.CATEGORY,getOwnedScrollables:function(){return this.$(".fastFollowGridContainer")
},_getBoardIdFromEvent:function(a){var b=a.data||{};return b.board_id},_onBoardFollow:function(a){var b=this._getBoardIdFromEvent(a),c=$.inArray(b,this._boardsFollowed);b&&-1===c&&(this._boardsFollowed.push(b),this._updateFollowedBoards(1),this._updateFollowedBoardMask(a,!0))},_onBoardUnfollow:function(a){var b=this._getBoardIdFromEvent(a);if(b){var c=$.inArray(b,this._boardsFollowed);-1!==c&&(this._boardsFollowed.splice(c,1),this._updateFollowedBoards(-1)),this._updateFollowedBoardMask(a,!1),this._boardsFollowed.length===NUM_REQUIRED_BOARDS-1&&this._setProgressCompletion(!1)}},_updateFollowedBoardMask:function(a,b){var c=this._getBoardIdFromEvent(a);if(c){var d=this.$("."+FAST_FOLLOW_BOARD_MASK+".mask"+c);b?d.show():d.hide()}},_onCategoryUpdate:function(a){var b=a.data,c={name:"CategoryBoardsResource",options:{category:b}};this._currentAction=FastFollowSidebarActions.CATEGORY,this._updateGridFromResource(c,b,b)},_onSearchQueryUpdate:function(a){var b=a.data,c={name:"SearchResource",options:{query:b,scope:"boards",search_context:"fast_follow"}};this._currentAction=FastFollowSidebarActions.SEARCH_TERM,this._updateGridFromResource(c,null,b)},_updateGridFromResource:function(a,b){this._currentGrid||(this._currentGrid=this.getChildById(FAST_FOLLOW_GRID_ID),this._cachedGrids[this._currentGrid.resource.options.category]=this._currentGrid),this._currentGrid.remove();var c=this._cachedGrids[b];c||(c=new P.modules.Grid({id:FAST_FOLLOW_GRID_ID,options:{centered:!1,layout:"fixed_height",show_grid_footer:!1,scrollable:!0,item_options:{allow_click_thru:!1,board_click_mask:!0}},resource:a}),c.render(),b&&(this._cachedGrids[b]=c));var d=this.$(".fastFollowGridContainer");this.$("."+FAST_FOLLOW_CONTENT_CLASS).scrollTop(0),this.insertChild(c,d),this._currentGrid=c},_updateBoardHeading:function(a){this.$(".heading").hide(),this._currentAction===FastFollowSidebarActions.CATEGORY?(a=this.$(".followPageSidebarCategory[data-category="+a+"]"),a=a?a.text():null,this.$(".categoryHeading").show()):this.$(".searchHeading").show();var b=this.$(".categoryOrQuery");b&&b.length&&a&&b.text(a)},_onProgressCompletion:function(){this._userRegisterTrackActionOrientationComplete(),this._setProgressCompletion(!0)},_onFastFollowCompletion:function(a){var b=a.target;b&&"tryOutYourFeedButton"===b.id&&(this.hide(),this.navigate("/",null,!0))},_userRegisterTrackActionOrientationComplete:function(){P.trackRegisterAction("orientation_complete")},_setProgressCompletion:function(a){var b=this.getChildById(FAST_FOLLOW_HEADER_ID);return b?(b.options.progress_completed=a,a?b.render():(b.options.num_boards_followed=this._boardsFollowed.length,b.render())):Promise.resolve(void 0)},_updateFollowedBoards:function(a){if(!this._modalDisplayed){var b=this.getChildById(FAST_FOLLOW_HEADER_ID);b&&b.stepProgress(a)}},onContentReady:function(){_.each(this.extraData.followed_boards,function(a){this._boardsFollowed.push(a.id)}.bind(this)),this.childListen(P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED,this._onCategoryUpdate),this.childListen(P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED,this._onSearchQueryUpdate),this.childListen(P.CONST.EVENT_PROGRESS_COMPLETED,this._onProgressCompletion),this.childListen(P.CONST.EVENT_BOARD_FOLLOW,this._onBoardFollow,this),this.childListen(P.CONST.EVENT_BOARD_UNFOLLOW,this._onBoardUnfollow,this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onFastFollowCompletion),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.position),this.position()},position:function(){if(this.inDom&&this.contentReady){this.fastFollowHeaderHeight||(this.fastFollowHeaderHeight=this.$(".FastFollowHeader").outerHeight(!0));var a=FAST_FOLLOW_MODAL_TOP_PADDING+FAST_FOLLOW_MODAL_BOTTOM_PADDING,b=P.Viewport.height,c=b-a-this.fastFollowHeaderHeight,d=Math.max(FAST_FOLLOW_MIN_HEIGHT,c);this.$(".fastFollowContent").height(d)}},onDestroyed:function(){_.each(_.values(this._cachedGrids),function(a){a.destroy()})}}),goog.provide("P.modules.ModalAnalyticsAudienceSelectorIntro"),goog.require("P.modules.ModalStepBase"),P.modules.ModalAnalyticsAudienceSelectorIntro=P.modules.ModalStepBase.extend({getPlacementId:function(){return P.Experiences.Placement.ANALYTICS_AUDIENCE_DASHBOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.ANALYTICS_AUDIENCE_SELECTOR_USER_ED},getHighlightedElement:function(){var a=this._getModuleChildrenByModuleName(P.app,"SelectButtonWrapper");return this._highlightModule(a[0],!0)},onShow:function(a){var b=this.getHighlightedElement();b&&this.setModalPosition("BOTTOM_CENTER",b,!0),a&&a()}}),goog.provide("P.modules.ModalAnalyticsHomeIntroBase"),goog.require("P.modules.ModalStepBase"),P.modules.ModalAnalyticsHomeIntroBase=P.modules.ModalStepBase.extend({getPlacementId:function(){return P.Experiences.Placement.ANALYTICS_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.ANALYTICS_HOME_USER_ED},getHighlightedCardModule:function(a){var b=this._getModuleChildrenByModuleName(P.app,"HomePageAnalyticsCard"),c=null;switch(a){case"profile":c=b[0];break;case"audience":c=b[1];break;case"domain":c=b[2]}return c?this._highlightModule(c,!0):null},getStepPosition:P.NOOP,getHighlightedElement:function(){throw new Error("must be overridden")},onShow:function(a){var b=this.getHighlightedElement();b?this.setModalPosition(this.getStepPosition(),b,!0):this.setModalPosition(null,null,!0),a&&a()}}),goog.provide("P.modules.ModalAnalyticsHomeOverallIntro"),goog.require("P.Module"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeOverallIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return null},getHighlightedElement:function(){return null}}),goog.provide("P.modules.ModalAnalyticsHomeProfileCardIntro"),goog.require("P.Module"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeProfileCardIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return"RIGHT_CENTER"},getHighlightedElement:function(){return this.getHighlightedCardModule("profile")}}),goog.provide("P.modules.ModalFindFriendsIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalFindFriendsIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{FIND_FRIENDS_INTRO_HIGHLIGHT:"findFriendsIntroHighlight",FIND_FRIENDS_INTRO_HIGHLIGHT_MENU:"findFriendsIntroHighlightMenu"}),onShow:function(a){var b=this._getModuleChildrenByModuleName(P.app,"UserMenu")[0];this.noUserMenu=!b,this.highlightFindFriendsInMenu(a)},onExit:function(a){if(!this.noUserMenu&&P.app)try{var b=this._getMenu();b.getDropdown().setSticky(!1),b.hideDropdown()}catch(c){}a&&a()},highlightFindFriendsInMenu:function(a){if(this.noUserMenu){var b=this._getFindFriendsItem(),c=this._highlightModule(b,!0);this.setModalPosition("RIGHT_CENTER",c,!0),c.addClass(this.CssClassName.FIND_FRIENDS_INTRO_HIGHLIGHT)}else{var d=this._getMenu();d.getDropdown().setSticky(!0),d.showDropdown(function(){d.getDropdown().getContentModulePromise().then(function(b){var c=b.getFindFriendsElement(),d=this._highlightElement("highlightContainer",c,!0);d.addClass(this.CssClassName.FIND_FRIENDS_INTRO_HIGHLIGHT_MENU),d.on("click",function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this));var e="LEFT_TOP";this.setModalPosition(e,d,!0),a&&a()}.bind(this))}.bind(this))}},_getFindFriendsItem:function(){return this._getModuleChildById(P.app,"friendsToFollow")},_getMenu:function(){return this._getModuleChildById(P.app,"userMenu")},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FIND_FRIENDS_USER_ED}}),goog.provide("P.modules.ModalFirstBoardIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalFirstBoardIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{FIRST_BOARD_INTRO_HIGHLIGHT:"firstBoardIntroHighlight"}),onShow:function(a){this.isContextualExperience=!0,$("html, body").scrollTop(0);var b=!1,c=this._getModuleChildrenByModuleName(P.app,"UserProfileContent");if(c&&c[0]){var d=c[0].data,e=d.board_count+d.secret_board_count;b=e>0}var f,g;b?(f=this.$(".hasBoardsTitle"),g=this.$(".hasBoardsContent")):(f=this.$(".hasNoBoardsTitle"),g=this.$(".hasNoBoardsContent")),f.show(),g.show(),this.highlightBoard(),a&&a(),this.setExperienceViewed()},highlightBoard:function(){if(this.board=this.getTargetBoard(),this.board){var a=this._highlightModule(this.board,!0);a.on("click",this.onBoardClicked.bind(this)),a.addClass(this.CssClassName.FIRST_BOARD_INTRO_HIGHLIGHT);var b,c=$(window).height();b=a.offset().top+a.height()>c?"TOP_LEFT":"RIGHT_TOP",this.setModalPosition(b,a,!0)}},setCloneInteractions:function(a){this.disableCloneLinks(a)},getTargetBoard:function(){var a,b=this._getModuleChildrenByModuleName(P.app,"Grid")[0];if(b){var c=b.getGridItems();a=c.getChildModuleAtIndex(0,"BoardCreateRep")}return a},onBoardClicked:function(a){return a.preventDefault(),this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0),this.board.showModalSubmodule(),!1},getPlacementId:function(){return P.Experiences.Placement.WEB_USER_PROFILE_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FIRST_BOARD_USER_ED}}),goog.provide("P.modules.ModalFirstPinIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalFirstPinIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{FIRST_PIN_INTRO_HIGHLIGHT:"firstPinIntroHighlight",MODAL_PIN_INTRO:"modalPinIntro"}),onCreated:function(){P.modules.ModalStepBase.prototype.onCreated.apply(this,arguments),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.onBodyColumnChange)},onShow:function(a){this.highlightPin(),a&&a()},highlightPin:function(){if(this.pin=this.getTargetPin(),this.pin){var a=this._highlightModule(this.pin,!0);a.remove(),this.modal.getModalScroller().append(a),this.$repinButton=a.find(".repinSmall"),this.$repinButton.on("click",this.onRepinClicked.bind(this)),this.modal.$el.addClass(this.CssClassName.MODAL_PIN_INTRO),this.setModalPosition("LEFT_TOP",this.$repinButton,!0),a.addClass(this.CssClassName.FIRST_PIN_INTRO_HIGHLIGHT)}},setCloneInteractions:function(a){this.disableCloneLinks(a)},getTargetPin:function(){var a=this._getModuleChildrenByModuleName(P.app,"Grid")[0];if(a){var b=a.getGridItems(),c=Math.ceil(P.Viewport.numColumns/2);return b.getChildModuleAtIndex(c,"Pin")}},onBodyColumnChange:function(){this.$repinButton.off(),this.$repinButton=null,this.cleanHighlightedElements(),this.highlightPin()},onRepinClicked:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0);var a=this.pin.getChildById("pinItButton");a.$el.trigger("click")},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FIRST_PIN_USER_ED}}),goog.provide("P.modules.ModalHomeFeedPinIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalHomeFeedPinIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{LOGO_STEP_BACKGROUND:"pinterestLogoStepBackground"}),onEnter:function(a){this.ensurePath("/"),a&&a()},onShow:function(a){var b=this._getModuleChildById(P.app,"header"),c=b.getHomeElement(),d=this._highlightElement("homeButton",c,!0),e=$("<div>");e.addClass(this.CssClassName.LOGO_STEP_BACKGROUND),e.css({top:d.offset().top-60,left:d.offset().left}),$("body").append(e),a&&a()},onExit:function(a){$("."+this.CssClassName.LOGO_STEP_BACKGROUND).remove(),a&&a()}}),goog.provide("P.modules.ModalPinIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase");var SAMPLE_PIN_CLASS="samplePinTutorialStep";P.modules.ModalPinIntro=P.modules.ModalStepBase.extend({onEnter:function(a){this.ensurePath("/"),$("body").append('<div class="'+SAMPLE_PIN_CLASS+'">&nbsp;</div>'),a&&a()},onShow:function(a){var b=$("."+SAMPLE_PIN_CLASS);this.setModalPosition("RIGHT_TOP",b,!0),a&&a()},onExit:function(a){$("."+SAMPLE_PIN_CLASS).remove(),a&&a()}}),goog.provide("P.modules.ModalPlacePinsAddBase"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalPlacePinsAddBase=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{ADD_PLACE:"addAPlace"}),onShow:function(){this.highlightAddButton()},highlightAddButton:function(){if(this.button=this.getTargetModule(),this.button){var a=this._highlightModule(this.button,!0),b="RIGHT_TOP";$(window).width()<=5*(P.CONST.PIN_WIDTH+P.CONST.PIN_MARGIN)&&(b="BOTTOM_RIGHT"),this.setModalPosition(b,a,!0)}},getTargetModule:function(){var a=this._getModuleChildrenByModuleName(P.app,"BoardPage")[0];if(a){var b=this._getModuleChildrenByModuleName(a,"ShowModalButton");if(!_.isEmpty(b)){var c=_.find(b,function(a){return a.$el.hasClass(this.CssClassName.ADD_PLACE)}.bind(this));return c}}}}),goog.provide("P.modules.ModalPlacePinsAddEmpty"),goog.require("P.Module"),goog.require("P.modules.ModalPlacePinsAddBase"),P.modules.ModalPlacePinsAddEmpty=P.modules.ModalPlacePinsAddBase.extend({getPlacementId:function(){return P.Experiences.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED},onNextButtonClicked:function(){this.button.$el.click()}}),goog.provide("P.modules.ModalPlacePinsAddFilled"),goog.require("P.Module"),goog.require("P.modules.ModalPlacePinsAddBase"),P.modules.ModalPlacePinsAddFilled=P.modules.ModalPlacePinsAddBase.extend({getPlacementId:function(){return P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.ModalPlacePinsEdit"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalPlacePinsEdit=P.modules.ModalStepBase.extend({onShow:function(a){$("html, body").scrollTop(0),this.highlightEditButton(),a&&a()},highlightEditButton:function(){var a=this.getTargetModule();if(a){var b=this._highlightModule(a,!0);this.setModalPosition("RIGHT_CENTER",b,!0)}},getTargetModule:function(){var a=this._getModuleChildrenByModuleName(P.app,"PlaceBoardInfoBar")[0];if(a){var b=this._getModuleChildById(a,"editButton");if(b)return b}},getPlacementId:function(){return P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.ModalPlacePinsSearch"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),goog.require("P.modules.AddPinToMap"),goog.require("P.modules.Modal"),P.modules.ModalPlacePinsSearch=P.modules.ModalStepBase.extend({onShow:function(){this.highlightAddPinToMap()},highlightAddPinToMap:function(){var a=this.getTargetModule();if(a){var b=this._highlightModule(a,!0);this.setModalPosition("RIGHT_TOP",b,!0);var c=this._getModal();c&&this._setModalVisible(c,!1)}},_setModalVisible:function(a,b){var c=a.getMask();c=c.add(a.getModalScroller()),b?c.css("visibility","visible"):c.css("visibility","hidden")},_getModal:function(){var a=P.getModalManager(),b=a.getTopModal();return b?b:null},getTargetModule:function(){var a=this._getModal();if(!a)return null;var b=a.getModule();return b?b:null},onPreviousButtonClicked:function(){P.modules.ModalStepBase.prototype.onPreviousButtonClicked.call(this),this.clickCloseButton()},clickCloseButton:function(){var a=this.getTargetModule(),b=a.getChildById("closeButton");b.$el.click();var c=this._getModal();c&&this._setModalVisible(c,!0)},getPlacementId:function(){return P.Experiences.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.ModalPlacePinsShow"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalPlacePinsShow=P.modules.ModalStepBase.extend({onShow:function(a){this.highlightAddPlace(),a&&a()},highlightAddPlace:function(){var a=this.getTargetPin(),b=this._getModuleChildById(a,"addToMap");if(b||(b=this._getModuleChildById(a,"seeOnMap")),b){var c=b.$el,d=c.offset().top,e=c.height(),f=P.Viewport.height,g=$(".headerBackground").height(),h=d-f/2-g/2+e/2;this.$("."+b.id).show(),$(window).scrollTop(h);var i=this._highlightModule(b,!0);this.setModalPosition("RIGHT_CENTER",i,!0,!0)}},getTargetPin:function(){var a=this._getModuleChildrenByModuleName(P.app,"Grid")[0];if(!a)return void 0;var b=a.getGridItems();return b.getChildModuleAtIndex(0,"Pin")},getPlacementId:function(){return P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.ModalSeeProfileIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),P.modules.ModalSeeProfileIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{SEE_PROFILE_INTRO_HIGHLIGHT:"seeProfileIntroHighlight"}),onShow:function(a){var b=this._getModuleChildrenByModuleName(P.app,"UserMenu")[0];if(this.noUserMenu=!b,this.noUserMenu){var c=this._getModuleChildById(P.app,"userMenu"),d=this._highlightModule(c,!0);this.setModalPosition("BOTTOM_CENTER",d,!0)}else b.setSticky(!0),b.showDropdown(function(){b.getDropdown().getContentModulePromise().then(function(b){var c=b.getMyBoardsElement(),d=this._highlightElement("highlightContainer",c,!0);d.addClass(this.CssClassName.SEE_PROFILE_INTRO_HIGHLIGHT),d.on("click",function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this)),this.setModalPosition("LEFT_TOP",d,!0),a&&a()}.bind(this))}.bind(this))},onExit:function(a){if(!this.noUserMenu&&P.app){var b=this._getModuleChildrenByModuleName(P.app,"UserMenu")[0];b.setSticky(!1),b.hideDropdown()}a&&a()},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_YOUR_BOARDS_USER_ED}}),goog.provide("P.modules.NewUserStepBase"),goog.require("P.Module"),goog.require("P.modules.StepBase"),goog.require("P.modules.NuxProgress"),P.modules.NewUserStepBase=P.modules.StepBase.extend({CssClassName:_.extend(P.modules.StepBase.prototype.CssClassName,{HIDDEN:"hidden"}),onContentReady:function(){this.nuxProgress=P.app.getChildById("nuxProgress"),this.nuxProgress.initializeProgress({module:this})},hideStepHeader:function(){this.$(".newUserStepHeader").addClass(this.CssClassName.HIDDEN)}}),goog.provide("P.modules.NewUserWelcome"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserWelcome=P.modules.NewUserStepBase.extend({onButtonClick:function(a){var b=a.target;b.disable(),this.$(".spinner").show()}}),goog.provide("P.modules.NuxModalCompassStep"),goog.require("P.modules.Interest"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.CONST"),P.modules.NuxModalCompassStep=P.modules.NuxModalStepBase.extend({onContentReady:function(){if("final_loading"===this.options.mode){P.setTimeout(this._checkHomeFeedReady.bind(this),1500);var a=this.extraData.truncateLength,b=P.ExperienceTutorialManager.instance().tutorial,c=b?b.getStorage("interest_follow_count"):0,d=this.getChildByModuleName("List");if(c>a&&d.children.length===a){var e=_.last(d.children),f=P.string.format(P._("+{{ num }} more interests"),{num:c-a+1});e.showOverflowMask(f)}}P.modules.NuxModalStepBase.prototype.onContentReady.call(this)},numChecks:0,_checkHomeFeedReady:function(){var a=P.resourceFactory.create("OrientationContextStatusResource",{});this.numChecks+=1,a.callGet({showError:!1}).then(function(){this._refreshGrid()}.bind(this),function(){this.numChecks<=10?P.setTimeout(this._checkHomeFeedReady.bind(this),500):this._refreshGrid()}.bind(this))},_refreshGrid:function(){$(".AuthHomePage").length?P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_HOMEFEED_REFRESH,{callback:this._goToNextStep.bind(this)}):this._goToNextStep()},_goToNextStep:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}}),goog.provide("P.modules.NuxModalFindFriends"),goog.require("P.Module"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.modules.FindFriendsContent"),P.modules.NuxModalFindFriends=P.modules.NuxModalStepBase.extend({CssClassName:_.extend(P.modules.NuxModalStepBase.prototype.CssClassName,{HIDDEN:"hidden"}),events:{"click .optionalSkip":"onSkipClick"},mixins:[P.Mixins.NuxFindFriends],onContentReady:function(){P.modules.NuxModalStepBase.prototype.onContentReady.call(this),this.nextButton=this.getChildById("nextButton"),this._enableNextButton(!1),this.setup()},onSkipClick:function(){this._launchSkipConfirmDialog()},_launchSkipConfirmDialog:function(){var a={name:"ConfirmDialog",options:{title:P._("Skip this step?"),body_message:P._("You'll be missing out on everyone's latest projects and interests."),dismiss_button_text:P._("Go back"),button_text:P._("Skip"),template:"generic"}};P.loadModule(a).then(function(a){this.showInModal(a,{mask_type:"dark",can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,this._goToNextStep)}.bind(this))},_goToNextStep:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},_enableNextButton:function(a){a?this.nextButton.enable():this.nextButton.disable()},onNextButtonClicked:function(){if(this.followingFriendsChanged()){this.nextButton.showLoading();var a=this.$(".optionalSkip");a.addClass(this.CssClassName.HIDDEN),this.signalFollowFriends().then(function(){this.nextButton.hideLoading(),a.removeClass(this.CssClassName.HIDDEN),P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)}.bind(this))}else P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)},_showSelectedTab:function(){this._enableNextButton(!1),this.$(".emptyGridWrapper").addClass(this.CssClassName.HIDDEN),this.$(".friendGridWrapper").removeClass(this.CssClassName.HIDDEN),this.hideFollowAllButton();var a=null;if(this.tab){switch(this.tab){case P.SocialConnect.FACEBOOK:this.setNetwork(P.SocialConnect.FACEBOOK),this.facebookConnected&&(a="UserFacebookFriendsResource",this._enableNextButton(!0),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!0),this.getChildById("twTab").setSelected(!1);break;case P.SocialConnect.TWITTER:this.setNetwork(P.SocialConnect.TWITTER),this.twitterConnected&&(a="UserTwitterFriendsResource",this._enableNextButton(!0),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!1),this.getChildById("twTab").setSelected(!0)}var b=new P.modules.FindFriendsContent({id:"friendsGrid",options:{tab:this.tab,username:P.currentUser.get("username"),exclude_following:!1,item_options:{view_type:"userCheckableSelectView",is_checked:!1,no_padding:!0}}});if(a){var c={username:P.currentUser.get("username"),exclude_following:!1};b.resource=P.resourceFactory.create(a,c)}var d=this.getFriendGrid();d&&this.removeChild(d),b.render().then(function(){switch(this.insertChild(b,this.$(".friendGridWrapper")),this.tab){case P.SocialConnect.FACEBOOK:this.facebookConnected&&this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this.twitterConnected&&this.resetFollowAllState()}this.listen(b,P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,function(a){switch(a.data.network){case P.SocialConnect.FACEBOOK:this.facebookConnected=!0,this._enableNextButton(!0),this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this.twitterConnected=!0,this._enableNextButton(!0),this.resetFollowAllState()}})}.bind(this))}}}),goog.provide("P.modules.NuxModalInstallExtensionContainer"),goog.require("P.modules.NuxModalStepBase"),P.modules.NuxModalInstallExtensionContainer=P.modules.NuxModalStepBase.extend({}),goog.provide("P.modules.NuxModalInterestPicker"),goog.require("P.CONST"),goog.require("P.Module"),goog.require("P.modules.Interest"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.resourceResponse"),goog.require("P.TypeaheadProvider"),P.modules.NuxModalInterestPicker=P.modules.NuxModalStepBase.extend({events:{'textchange input[type="text"]':"_onSearchTextUpdate","click .clearSearch":"_clearSearch"},nuxInterests:[],currentlyFollowedInterests:[],onContentReady:function(){this._setup(),P.modules.NuxModalStepBase.prototype.onContentReady.call(this)},_setup:function(){this.inNux=P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_FLEXIBLE_NUX),this._throttledSyncBothInterestCaches=_.throttle(this._syncBothInterestCaches.bind(this),200),this.nextButton=this.getChildById("nextButton"),this.grid=this.getChildById("grid"),this.interestFollowChange=!1,this.syncInterestsCacheAndGridUI().then(function(){this.updateNextButton()}.bind(this));var a={field_set_key:"blur",resource_name:"InterestTypeaheadResource"};this._typeahead=new P.TypeaheadProvider(a),this.listen(this._typeahead,P.CONST.EVENT_DATA,this._onTypeaheadData),this.childListen(P.CONST.EVENT_INTEREST_FOLLOW,this._onInterestClick),this.childListen(P.CONST.EVENT_INTEREST_UNFOLLOW,this._onInterestClick)},getEmptySearchResultsFromCache:function(){var a=_.pluck(this.currentlyFollowedInterests,"id"),b=_.reject(this.nuxInterests,function(b){return _.contains(a,b.id)});return this.currentlyFollowedInterests.concat(b)},syncInterestsCacheAndGridUI:function(){return this.grid.showLoading(),this._throttledSyncBothInterestCaches().then(function(){this.createInterestModulesAndReplaceGrid(this.getEmptySearchResultsFromCache())}.bind(this))},_syncBothInterestCaches:function(){var a=[this._syncFollowedInterestsCache(),this._syncNUXInterestsCache()];return Promise.all(a).then(P.NOOP)},_syncFollowedInterestsCache:function(){var a=P.resourceFactory.create("InterestFollowingResource",{username:P.currentUser.get("username")}),b=[],c=function d(c){var e=c.resource_response.data;return _.isArray(e)&&(b=b.concat(e)),a.atEnd()?Promise.resolve(b):a.callGet().then(d)};return a.callGet().then(c).then(function(a){this.currentlyFollowedInterests=a}.bind(this))},_syncNUXInterestsCache:function(){var a=P.resourceFactory.create("UserInterestsResource",{blend_type:"nux",sort:"ranked"});return a.callGet().then(function(a){var b=a.resource_response.data;_.isArray(b)&&(this.nuxInterests=b)}.bind(this))},_onTypeaheadData:function(a){if(!a.term||this._getSearchText()===a.term){var b=this.$(".noResults");if(a.term){if(_.isEmpty(a.items)){var c=P.string.format(P._("Sorry! We couldn't find <b>{{ searchTerm }}</b>."),{searchTerm:_.escape(a.term)});b.html(c),b.show(),this.createInterestModulesAndReplaceGrid(this.getEmptySearchResultsFromCache())}else this.createInterestModulesAndReplaceGrid(a.items),b.hide();this.logToContextLog(a.term,!_.isEmpty(a.items))}else this._searchFieldIsEmpty()&&(this.createInterestModulesAndReplaceGrid(this.getEmptySearchResultsFromCache()),b.hide())}},_createInterestModuleAndPrependToGrid:function(a){var b=new P.modules.Interest({data:a,options:{view_type:"homefeedSetupView",show_mask:!0}});b.renderExistingData().then(function(){this.grid.getGridItems().prependChildItem(b)}.bind(this))},createInterestModulesAndReplaceGrid:function(a){this.grid.emptyItems();for(var b=a.length-1;b>=0;b--)this._createInterestModuleAndPrependToGrid(a[b]);this.grid.hideLoading()},_searchFieldIsEmpty:function(){return _.isEmpty(this._getSearchText())},_getSearchText:function(){var a=$.trim(this.$("input[type='text']").val());return a.replace(/'/g,"`")},_onInterestClick:function(a){this._invalidateTypeaheadCacheForInterestSearchTerm();var b=a.data||{};if(_.has(b,"is_followed")){if(b.is_followed){var c=_.find(this.currentlyFollowedInterests,function(a){return a.id===b.id});c||this.currentlyFollowedInterests.unshift(b)}else this.currentlyFollowedInterests=_.reject(this.currentlyFollowedInterests,function(a){return a.id===b.id});var d=_.find(this.nuxInterests,function(a){return a.id===b.id});d&&(d.is_followed=b.is_followed),this.interestFollowChange=!0}this.updateNextButton(),_.defer(this._throttledSyncBothInterestCaches)},_invalidateTypeaheadCacheForInterestSearchTerm:function(){var a=this._getSearchText();if(a){this._getTypeahead().removeCacheForTerm(a);var b=a.split(" ");b.length>=2&&_.each(b,function(a){this._getTypeahead().removeCacheForTerm(a)}.bind(this));for(var c=a.substring(0,a.length-1);c;)this._getTypeahead().removeCacheForTerm(c),c=c.substring(0,c.length-1)}},_getTypeahead:function(){return this._typeahead},updateFollowCount:function(){var a=P.ExperienceTutorialManager.instance().tutorial;a&&a.setStorage("interest_follow_count",this.currentlyFollowedInterests.length)},updateNextButton:function(){var a,b=this.inNux?5:1,c=b-this.currentlyFollowedInterests.length;c>0?(a=P.string.format(P._("Follow {{ numToFollow }} more"),{numToFollow:c}),this.nextButton.setText(a),this.nextButton.disable()):(a=P._("Done"),this.nextButton.setText(a),this.nextButton.enable()),this.nextButton.show()},_clearSearch:function(){this.$("input").val(""),this._onSearchTextUpdate()},_onSearchTextUpdate:function(){this._getTypeahead().search(this._getSearchText()),this._searchFieldIsEmpty()?this.$(".clearSearch").hide():this.$(".clearSearch").show()},onNextButtonClicked:function(){if(this.updateFollowCount(),this.currentlyFollowedInterests&&!this.inNux&&this.interestFollowChange){var a=P.resourceFactory.create("OrientationRefreshHomefeedResource");a.callUpdate()}P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)},logToContextLog:function(a,b){var c={entered_query:a,results_exist:b};this._logCustomContextEvent(P.ContextLogging.EventType.SEARCH_INTERESTS,P.ContextLogging.ElementType.SEARCH_BOX_TEXT_INPUT,P.ContextLogging.ComponentType.INTEREST_PICKER,c)}}),goog.provide("P.modules.NuxModalJumpStartStep"),goog.require("P.Module"),goog.require("P.modules.NuxModalStepBase");var NUX_STEPS_PROGRESS_ID="NuxStepsProgress";P.modules.NuxModalJumpStartStep=P.modules.NuxModalStepBase.extend({events:{"click .next":"onNextClick"},onContentReady:function(){var a=P.ExperienceTutorialManager.instance().currentStep;if(a>0){this.$(".progressBar").show();var b=a===this.extraData.numSteps?"":P._("Next");this.$(".next").text(b);var c=this.getChildById(NUX_STEPS_PROGRESS_ID);c&&c.setStep(a)}},onNextClick:function(){P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)},animateOut:function(a,b){this.animateOpacity(a,0,b)},animateIn:function(a,b){this.animateOpacity(a,1,b)},animateOpacity:function(a,b,c){var d={duration:400};c&&(d.complete=function(){c()}),a.animate({opacity:b},d)},animateChain:function(a,b,c){if(1===a.length)b(this.$(a[0]),c);else{var d=this.$(a[0]);b(d,function(){this.animateChain(a.slice(1),b,c)}.bind(this))}}}),goog.provide("P.modules.NuxModalJumpStartWelcomeStep"),goog.require("P.Module"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartWelcomeStep=P.modules.NuxModalJumpStartStep.extend({onContentReady:function(){P.setTimeout(function(){P.modules.NuxModalJumpStartStep.prototype.onNextButtonClicked.call(this)}.bind(this),2e3)},onExit:function(a){this.animateOut(this.$(".title")),P.modules.NuxModalJumpStartStep.prototype.onExit.call(this,a)}}),goog.provide("P.modules.PaddedPin"),goog.require("P.Module"),goog.require("P.modules.Pin"),P.modules.PaddedPin=P.Module.extend({events:{"mouseenter .visualSearchObjectTagClickTarget":"visualSearchToolTipShow","mouseleave .visualSearchObjectTagClickTarget":"visualSearchToolTipHide","mousemove .paddedPinLink":"onLinkMousemove"},onCreated:function(){this._hasBeenSetDraggable=!1,this._draggablePin=null,this._isDraggable=!1},onLinkMousemove:function(){P.getConversationsManager().getConversationIds().length&&!this._draggablePin&&this.generateAndSetDraggablePin()},detatchDraggable:function(){this.$(".paddedPinLink").draggable({disabled:!0}),this._isDraggable=!1,this._draggablePin=null},attachDraggable:function(){var a=this;this._hasBeenSetDraggable&&!this._isDraggable?this.$(".paddedPinLink").draggable("enable"):this._isDraggable||this.$(".paddedPinLink").draggable({appendTo:$(".App"),cursor:"move",cursorAt:{left:P.CONST.PIN_WIDTH/2,top:50},helper:function(){return a._draggablePin.getContent()
},drag:function(a,b){var c=parseInt($(this).data("startingScrollTop"),10);b.position.top-=c;var d=a.clientX-b.position.left,e=window.pageYOffset+a.clientY-b.position.top,f=b.helper.height(),g=b.helper.width(),h=d/g*100,i=e/f*100,j=""+h+"% "+i+"%";b.helper.css("transformOrigin",j)},scroll:!1,revert:!1,start:function(){P.getConversationsManager().setDraggedObject(a._draggablePin),$(this).data("startingScrollTop",window.pageYOffset-P.CONST.PIN_MARGIN)},stop:function(a,b){P.getConversationsManager().setDraggedObject(null);var c=parseInt($(this).data("startingScrollTop"),10);b.position.top-=c}}),this._isDraggable=!0,this._hasBeenSetDraggable=!0},generateAndSetDraggablePin:function(){var a=this,b=new P.modules.Pin({data:this.data,options:{show_comments:!1,squish_giraffe_pins:!1}});b.renderExistingData().then(function(){a._draggablePin=b,a.attachDraggable()})},getLoggingObjectIdStr:function(){return this.resource.options.id},onAddedToDom:function(){this._setupClickIfReady()},onContentReady:function(){this._setupClickIfReady();var a={};a[P.CONST.PUBSUB_TOPIC_CONVERSATION_ADDED]=this.onConversationAdded,a[P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS]=this.onNoActiveConversations,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,a)},onConversationAdded:function(){this.attachDraggable()},onNoActiveConversations:function(){this.detatchDraggable()},_setupClickIfReady:function(){if(this.contentReady&&this.inDom){var a=this;this.createToolTips(),this.$(".visualSearchObjectTagClickTarget").click(function(){a.triggerEvent(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_SELECTED,$(this).data("visualobjectid").toString(),!0)})}},visualSearchToolTipHide:function(a){this.dropdown[$(a.currentTarget).data("visualobjectid")].hide()},visualSearchToolTipShow:function(a){this.dropdown[$(a.currentTarget).data("visualobjectid")].show(function(){})},createToolTips:function(){this.dropdown={},jQuery.each(this.$(".visualSearchObjectTagClickTarget"),function(a,b){this.createVisualSearchDropdown($(b))}.bind(this))},createVisualSearchDropdown:function(a){var b={name:"Dropdown",options:{anchor:a,class_name:"large aboveModal",position_point:"BOTTOM_CENTER",text:P._("Click the red dot to see similar looks"),append_to_closeup:!0}};P.loadModule(b).then(function(b){var c=b;this.dropdown[a.data("visualobjectid")]=c,c.render().then(function(){_.defer(function(){c.positionModule()})})}.bind(this))},getFirstVisualObject:function(){var a=this.$(".visualSearchObjectTagClickTarget");return a.length?a.first():null}}),goog.provide("P.modules.PinCreate"),goog.require("P.modules.PinCreateBase"),P.modules.PinCreate=P.modules.PinCreateBase.extend({_getBoardPicker:function(){return this.pinForm.getBoardPicker()},setImage:function(a){this.options.image_url=a;var b=this.getChildById("pinForm");b.setImage(a)},onButtonClick:function(a){var b=a.target;switch(b.id){case"submitButton":P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_CLICK_SUBMIT);break;case"cancelButton":P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_CLICK_CANCEL),this.modal||this.destroy()}},onContentReady:function(){P.modules.PinCreateBase.prototype.onContentReady.apply(this,arguments),this.pinForm=this.getChildById("pinForm"),this.listen(this.pinForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange),this.updateSubmitButtons()},onChildChange:function(a){switch(a.target.id){case"boardPicker":this.updateSubmitButtons()}},updateSubmitButtons:function(){var a=this.pinForm.getBoardPicker();a.getSelectedBoardId()?this.pinForm.form.enableSubmitButtons():this.pinForm.form.disableSubmitButtons()},onSubmitValidated:function(a){var b=a.data;if(!b.errors[0]){var c=this.pinForm.getData();this._createPin(c)}}}),goog.provide("P.modules.PinCreate3"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),goog.require("P.modules.BoardPicker"),goog.require("P.modules.RepinSuccessToast");var PIN_CREATE3_API_RESPONSE_CODE_SPAM_CONTENT=14,MODULE_MIN_HEIGHT=490,SPACER=47,MODULE_MAX_HEIGHT=660,MS_ANIMATION_DURATION=200,EASING_ANIMATION="ease-out";P.modules.PinCreate3=P.Module.extend({events:{'change [name="share_facebook"]':"onFacebookCheckboxChanged"},CssClassName:{ANIMATE_OUT:"animateOut",CAPPED_MAX_HEIGHT:"cappedMaxHeight",PINIT_BUTTON_LOADING:"loading",PINIT_BUTTON_SUCCESS:"success",PINIT_ITEM_ACTIVE:"activeItem",PINIT_PINNING:"pinning",SHOWING_CREATE_BOARD:"showingCreateBoard"},onCreated:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange),this.childListen(P.CONST.EVENT_BOARD_CREATED,this.onBoardCreated),this.childListen(P.CONST.EVENT_DUPE_DETECTED,this.onDupeDetected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this._shouldAnimatePinBackToGrid=!0,this.networkToSelectorMap={},this.networkToSelectorMap[P.SocialConnect.FACEBOOK]='[name="share_facebook"]',this.networkToSelectorMap[P.SocialConnect.TWITTER]='[name="share_twitter"]'},onFacebookCheckboxChanged:function(){var a=this.getNetworkChecked(P.SocialConnect.FACEBOOK);P.currentUser.set(P.CONST.FB_PUBLISH_KEY,a),a&&P.FbUtil.maybeRequestFbTimelinePermission({error:function(){this.setNetworkChecked(P.SocialConnect.FACEBOOK,!1),P.currentUser.set(P.CONST.FB_PUBLISH_KEY,!1)}.bind(this)})},onDupeDetected:function(){this.adjustHeight(!0)},onChildContentChanged:function(){this.addCreateBoardStaticItems(),this.adjustHeight()},setImage:function(a){var b=this.getChildById("pin");b.setPinImages(a),b.renderExistingData()},onButtonClick:function(a){var b=a.target;if(b.isCancelButton()){var c=this.getChildById("boardCreate");c?(a.stopPropagation(),this.getCloseButton().fadeOut(),this.hideCreateBoard()):("closeButton"===b.id&&this._logCustomContextEvent(P.ContextLogging.EventType.WEB_PIN_CREATE_CLOSE_MODAL_BEFORE_PINNING,P.ContextLogging.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.ContextLogging.ComponentType.MODAL_REPIN,{}),this.modal||this.destroy())}},setNetworkChecked:function(a,b){var c=this.networkToSelectorMap[a];c&&this.$(c).prop("checked",b)},getNetworkChecked:function(a){var b=this.networkToSelectorMap[a];if(b){var c=this.$(b);return c.length?c.is(":checked"):""}},animateEntranceToModal:function(){this.modal&&(this.modal.setVisible(!0),this.$el.transition({duration:0,opacity:0},function(){this.isSkinnyVariant()||this.animatePinToModal(),this.adjustHeight()}.bind(this)).transition({duration:0,scale:.95}).transition({opacity:1,scale:1,duration:MS_ANIMATION_DURATION}))},isSkinnyVariant:function(){return P.experiments.instance.inExperimentGroups("web_pin_create2",["enabled_v5_skinny_pin_by_selecting_board","enabled_v5_skinny_second_step"])},_onAnimateModalOutComplete:function(){P.getModalManager().setAnimatedModule(null),this._pinGridOffset=0,this.modal&&this.modal.destroy()},_animateModalOut:function(){if(this.modal){var a=this.modal.getMask();if(a.addClass(this.CssClassName.ANIMATE_OUT),this.shouldAnimatePinBackToGrid()){this.animatePinBackToGrid();var b=this.modal.getContent();b.transition({duration:MS_ANIMATION_DURATION,opacity:0,scale:.95,easing:EASING_ANIMATION},function(){this._onAnimateModalOutComplete()}.bind(this))}else{var c=this.$el.outerHeight(),d=this.modal.getPositionElement(),e=this.modal.getContent(),f=0;e.length&&(f=e.offset().top),d.transition({y:f+c+SPACER,duration:MS_ANIMATION_DURATION},function(){this._onAnimateModalOutComplete()}.bind(this))}}},animateExitFromModal:function(){this._animateModalOut()},shouldAnimatePinBackToGrid:function(){return this._shouldAnimatePinBackToGrid},adjustHeight:function(a){var b=P.getModalManager(),c=b&&b.getAnimatedModule();if(c||(c=this.getChildById("pin")),c){var d=c.getContent(),e=d.height();e+=2*SPACER;var f,g=this.$(".socialShareWrapper").height();if(g&&(g+=P.CONST.PIN_MARGIN),e<MODULE_MIN_HEIGHT)f=MODULE_MIN_HEIGHT;else if(e>MODULE_MAX_HEIGHT-SPACER-g){d.addClass(this.CssClassName.CAPPED_MAX_HEIGHT);var h=d.find(".pinImageActionButtonWrapper"),i=e-h.height(),j=MODULE_MAX_HEIGHT-i-g;f=MODULE_MAX_HEIGHT-g,a||h.css("maxHeight",j+"px")}else f=e;a||this.$el.height(f)}else{var k=this.$(".socialShareWrapper").height(),l=0;k&&(l=k+P.CONST.PIN_MARGIN),this.$el.height(MODULE_MAX_HEIGHT-l)}var m=this.getBoardpicker(),n=m.getList(),o=n.getContent(),p=o.offset().top-this.$el.offset().top;o.height(this.$el.height()-p)},animatePinToModal:function(){var a=P.getModalManager().getAnimatedModule();if(a){a.setDescriptionInputHeight();var b=a.getContent(),c=b.offset(),d=this.$el.offset().left;d+=(this.$el.width()/2-P.CONST.PIN_WIDTH)/2,this._pinGridOffset=c;var e=Math.round((this.$el.height()-2*SPACER-b.height())/2),f=this.$el.offset().top-c.top+e+SPACER;b.transition({x:d-c.left,y:f,duration:MS_ANIMATION_DURATION,easing:"cubic-bezier(0,0.9,0.3,1)",opacity:1},function(){b.detach(),this.insertChild(a,this.$(".pinModuleHolder")),b.transition({x:0,y:0,duration:0}).css({top:0,position:"static",left:0})}.bind(this))}},onChildChange:function(a){switch(a.target.id){case"boardPicker":var b=a.data,c=b.id,d=b.name;c||d?(c||d)&&(c?P.setTimeout(function(){this.createPin(b)}.bind(this),50):this.showCreateBoard(d)):this.showCreateBoard("")}},getCloseButton:function(){return this.getChildById("closeButton")},showCreateBoard:function(a){if(!this._showingCreateBoard){this.setShowingCreateBoard(!0);var b={board_name:a,form_class:"modalPinCreate3",class_name:"pinCreate3",custom_board_create_success_destroy:!0,close_typeahead_on_selection:!0,link_to_users_profiles:!1,add_collaborators_after_creating:!0,navigate_on_success:!1,show_secret_boards_learn_more:!1,show_collaborators_learn_more:!1,typeahead_overflow_visible:!1,hide_created_by_user:!0,prevent_default_on_enter_collabs:!0};this.getCloseButton().fadeOut();var c=new P.modules.BoardCreate({id:"boardCreate",options:b});c.render().then(function(){var a=c.getContent();a.transition({opacity:0,duration:1}),this.insertChild(c,this.$(".boardsWrapper")),c.animateIn(function(){this.getCloseButton().fadeIn(),c.setCollabsMaxHeight()}.bind(this))}.bind(this))}},setShowingCreateBoard:function(a){this._showingCreateBoard=a,this.$el.toggleClass(this.CssClassName.SHOWING_CREATE_BOARD,a)},hideCreateBoard:function(){this.setShowingCreateBoard(!1);var a=this.getChildById("boardCreate");a&&(a.animateOut(function(){this.getCloseButton().fadeIn()}.bind(this)),this.focus())},getPinResource:function(){var a,b="PinResource",c={},d=P.getModalManager(),e=d&&d.getAnimatedModule();e&&(a=e);var f=this.getChildById("pin");f&&(a=f);var g,h;a?(g=a.data,h=a.getDescriptionText()):(g=this._pinData,h=this.getChildById("pinDescriptionField").getValue()),this.isRepin()&&(c.pin_id=g.id,b="RepinResource");var i=this.options.method;i&&(c.method=i),c.description=h;var j=g.link;if(c.link=j,c.is_video=g.is_video,!this.isRepin()){var k=g.image_url;k=this.prependSchemeIfNeeded(k,j),c.image_url=k}var l=this.getNetworkChecked(P.SocialConnect.TWITTER);return""!==l&&(c.share_twitter=l),l=this.getNetworkChecked(P.SocialConnect.FACEBOOK),""!==l&&(c.share_facebook=l),P.resourceFactory.create(b,c)},prependSchemeIfNeeded:function(a,b){if(!b)return a;var c=new RegExp(/http(s?):/);if(!c.test(a)){var d=c.exec(b);if(d&&d.length){var e=d[0];a=e+a}}return a},showPinItLoadingForBoardId:function(){this.$el.addClass(this.CssClassName.PINIT_PINNING);var a=this.getBoardpicker(),b=a.getSelectedElement(),c=b.find(".Button");b.addClass(this.CssClassName.PINIT_ITEM_ACTIVE),this._$button=c,c.addClass(this.CssClassName.PINIT_BUTTON_LOADING)},showPinItSuccess:function(){return new Promise(function(a){this._removeButtonLoadingClass().addClass(this.CssClassName.PINIT_BUTTON_SUCCESS),setTimeout(a,500)}.bind(this))},_removeButtonLoadingClass:function(){var a=this.getBoardpicker(),b=a.getSelectedElement();return b.removeClass(this.CssClassName.PINIT_ITEM_ACTIVE),this._$button.removeClass(this.CssClassName.PINIT_BUTTON_LOADING)},_hideSocialCheckboxes:function(){this.$(".socialShareWrapper").hide()},createPin:function(a){if(!this.requestPending){var b=a.id;this.showPinItLoadingForBoardId(b);var c=a.privacy===P.CONST.BoardPrivacy.SECRET;c&&this._hideSocialCheckboxes();var d=this.getPinResource();d.options.board_id=b,this.requestPending=!0,d.callCreate({showError:!1}).then(function(a){this._onPinCreateSuccess(a)}.bind(this),function(a){if(P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_ERROR),this._removeButtonLoadingClass(),this.$el.removeClass(this.CssClassName.PINIT_PINNING),"create"===this.options.action&&a.api_error_code===PIN_CREATE3_API_RESPONSE_CODE_SPAM_CONTENT){var b={name:"ConfirmDialog",options:{fluid:!0,template:"blocked_source"}};P.loadModule(b).then(function(a){a.render().then(function(){this.parent.appendChild(a),this.destroy()}.bind(this))}.bind(this))}else P.showError(a.message)}.bind(this)).fin(function(){this.requestPending=!1,this.hideLoading()}.bind(this))}},onBoardCreated:function(a){var b=a.data,c=this.getBoardpicker(),d=_.clone(c.resource);return d.callGet(d).then(function(a){if(a&&!a.error){var c=this.getBoardpicker();c.options.select_first_board=!1,c.model.set(a.resource_response.data),c.renderExistingData().then(function(){this.hideCreateBoardModuleAndHighlightBoard(b)}.bind(this))}}.bind(this))},hideCreateBoardModuleAndHighlightBoard:function(a){this.hideCreateBoard(),this.adjustHeight(!0),P.deferDomManipulation(function(){var b=a.id;this.hightlightBoardWithId(b),this.createPin(a)}.bind(this))},hightlightBoardWithId:function(a){var b=this.getBoardpicker(),c=b.getAllBoards(),d=_.find(c,function(b){return b.id===a}),e=_.indexOf(c,d);e>=0&&b.selectBoardAtIndex(e)},_onPinCreateSuccess:function(a){P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_SUCCESS),this._shouldAnimatePinBackToGrid=!1;var b=this.getBoardpicker();this.pinForm&&(b=this.pinForm.getBoardPicker());var c=P.resourceFactory.clone(b.resource);P.resourceCache.instance.callGet(c),P.ExperienceManager.instance().refreshPlacedExperiences(),this.showPinItSuccess().then(function(){var b=a.resource_response.data;if(P.experiments.instance.inExperimentGroups("web_pin_create2",["enabled_v5_toast"])&&this.modal&&this.isRepin()){var c={pin:b};this.triggerEvent(P.CONST.EVENT_PIN_CREATE,b),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,b),P.pubsub.publish(b.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,b),P.pubsub.publish(P.currentUser.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED),this.isRepin()&&P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,b),this._animateModalOut(),P.getToastsManager().removeAllToasts();var d=new P.modules.RepinSuccessToast({data:c}),e=P.browserExtension.instance.isExtensionInstalled(),f={is_extension_installed:e,pinned_with_bookmarklet:!this.isRepin()},g=P.ExperienceManager.instance();return void g.launchPlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,f).then(function(a){if(!a&&this._suggestedBoard){c.suggested_board=this._suggestedBoard;var b=new P.modules.RepinSuccessToast({options:{is_recommendation:!0},data:c});P.getToastsManager().addToast(b)}P.getToastsManager().addToast(d,0)}.bind(this))}this.modal&&(this.modal.options.custom_exit_animation=!1);var h=b.board,i=h.url,j=h.category,k=h.id,l=this.options.action,m=h.name,n=h.privacy,o=h.is_collaborative,p={id:"pinSuccess",name:"PinCreateSuccess",options:{action:l,board_name:m,board_category:j,board_id:k,board_url:i,domain:b.domain,pin_id:b.id,is_collaborative:o,is_extension_installed:P.browserExtension.instance.isExtensionInstalled(),privacy:n,method:this.options.method},resource:P.Resource.NOOP_RESOURCE};"pin_create_ignition"===this.options.action?p.options.auto_close=!1:this._createdBoardToEdit&&this._createdBoardToEdit.id===h.id&&(p={id:"pinSuccess",name:"PinCreateSuccessBoardEdit",resource:{name:"BoardResource",options:{board_id:h.id,field_set_key:"basic"}},options:{pinCreateInfo:p}}),this.showLoading(),P.loadModule(p).then(function(a){this.modal?this.modal.setSubmodule(a):"pin_create_ignition"===this.options.action?this.showInModal(a,{}):a.render().then(function(){this.parent.appendChild(a),this.destroy()}.bind(this))}.bind(this)),this.triggerEvent(P.CONST.EVENT_PIN_CREATE,b),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,b),P.pubsub.publish(b.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,b),P.pubsub.publish(P.currentUser.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED),this.isRepin()&&P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,b)}.bind(this))},isRepin:function(){return!(!this.data||!this.data.id)},animatePinBackToGrid:function(){var a=P.getModalManager().getAnimatedModule();if(a){var b=a.getContent(),c=b.offset(),d=this._pinGridOffset.left-c.left,e=this._pinGridOffset.top-c.top;b.detach().appendTo($(".App")).css({position:"absolute",top:c.top+"px",left:c.left+"px"}).transition({x:0,y:0,duration:0}).transition({x:d,y:e,duration:MS_ANIMATION_DURATION,easing:"cubic-bezier(0,0.1,0.7,1)",opacity:0},function(){b.css("zIndex",""),a.destroy(),this.modal.destroy(),P.getModalManager().setAnimatedModule(null)}.bind(this))}},onContentReady:function(){if(this.isRepin()&&P.experiments.instance.inExperimentGroupsActiveOrTriggerable("web_pin_create2",["enabled_v5_toast"])&&this.data&&this.data.id){var a=P.resourceFactory.create("RelatedBoardForPinRandomFeedResource",{pin:this.data.id,page_size:1});a.callGet({showError:!1}).then(function(a){a.resource_response.error||(this._suggestedBoard=a.resource_response.data[0])}.bind(this))}if(this.isRepin()&&(MODULE_MAX_HEIGHT=Math.min(660,$(window).height()-2*SPACER)),this.adjustHeight(!1),this.focus(),this.addCreateBoardStaticItems(),this.isRepin()&&this.addQuickPicksLoadingStaticItem(),this.isSkinnyVariant())if(this.isRepin()){var b=P.resourceFactory.create("PinResource",{id:this.options.pin_id});P.resourceCache.instance.callGet(b).then(function(a){this._pinData=a}.bind(this))}else this._pinData=this.data},addCreateBoardStaticItems:function(){var a=this.getBoardpicker();if(this.getBoardpicker()&&this.getBoardpicker().getAllBoards().length&&!this.$el.find(".PickerItemCreate").length){var b={type:"module",name:"PickerItemCreate",options:{display_text:P._("Create a Board"),view_type:"pinCreate3 createBoard allBoardsStaticItem"},data:{is_create_suggestion:!0,name:""}};a.appendModuleToList(b,1)}},addQuickPicksLoadingStaticItem:function(){if(this.isRepin()){var a=this.getBoardpicker();if(a&&a.getBoardsShortList().length&&a.getAllBoards().length){var b={type:"module",name:"QuickPicksSpinnerBlock"};a.appendModuleToList(b,0)}}},getBoardpicker:function(){return this.getChildById("boardPicker")},focus:function(){this.getBoardpicker().focus()}}),goog.provide("P.modules.PinCreateSuccessBoardEdit"),goog.require("P.Module"),goog.require("P.modules.BoardEditActionBase"),P.modules.PinCreateSuccessBoardEdit=P.modules.BoardEditActionBase.extend({onContentReady:function(){P.modules.BoardEditActionBase.prototype.onContentReady.call(this);var a=this.getChildById("doneButton");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onDone)},onDone:function(){this.showLoading();var a={board_id:this.data&&this.data.id},b=this.getChildById("placeLayoutCheckbox");b&&(a.layout=b.isChecked()?"places":"default");var c=P.resourceFactory.create("BoardResource",a),d=this.options.pinCreateInfo,e=function(){d&&P.loadModule(d).then(function(a){this.showInModal(a),this.hideLoading(),this.destroy()}.bind(this))}.bind(this);c.callUpdate({showError:!1}).fin(e)}}),goog.provide("P.modules.PinUploader"),goog.require("P.Module"),goog.require("P.modules.PinCreate3"),P.modules.PinUploader=P.Module.extend({onContentReady:function(){var a=this.getChildById("uploader");this.listen(a,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(a,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError)},onUploadSuccess:function(a){P.trackGAEvent("pin_upload",P.CONST.GA_ACTION_SUCCESS),this.imageUrl=a.data.image_url,this.ensurePinCreate()},onUploadError:function(a){P.trackGAEvent("pin_upload",P.CONST.GA_ACTION_ERROR),P.showError(a.data)},ensurePinCreate:function(){var a={image_url:this.imageUrl,action:"upload",method:"uploaded",render_existing_pin:!0};this.options.default_board_id&&(a.default_board_id=this.options.default_board_id);var b={container_class:"webNewContentNewRepin",mask_type:"webNewContentNewRepin",modal_style:"webNewContentNewRepin",custom_entrance_animation:!0,custom_exit_animation:!0},c=new P.modules.PinCreate3({options:a,id:"pinCreate",resource:P.resourceFactory.create("FakePinResource",{description:"",image_url:this.imageUrl,link:""})});this.showLoading(),c.render().then(function(){this.hideLoading(),this.showInModal(c,b),this.triggerEvent(P.CONST.EVENT_PIN_CREATE_OPENED,null,!0),this.destroy()}.bind(this))}}),goog.provide("P.modules.Pinnable"),goog.require("P.Module"),goog.require("P.modules.PinCreate3");var ADD_TO_MAP_VIEWTYPE="add_to_map";P.modules.Pinnable=P.Module.extend({events:{"click a.pinImageWrapper":"onClick",click:"onClick"},CssClassName:{DISABLED:"disabled",SELECTED:"selected"},onCreated:function(){this.onImageLoad=this.onImageLoad.bind(this),this.onImageError=this.onImageError.bind(this)},onAdded:function(){this.updateImage()},updateImage:function(){var a=this.$(".pinImageWrapper"),b=this.$img=$("<img>");b.on("load",this.onImageLoad),b.on("error",this.onImageError),b.attr("src",this.options.url),a.append(b)},onImageLoad:function(){this.$img.width()<P.CONST.MIN_PINNABLE_IMAGE_WIDTH||this.$img.height()<P.CONST.MIN_PINNABLE_IMAGE_HEIGHT?(this.log.debug("Too small!",this.$img.width(),this.$img.height()),this.destroy()):this.$el.css("visibility","visible"),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},onImageError:function(){this.destroy()},enable:function(){this.$el.removeClass(this.CssClassName.DISABLED)},disable:function(){this.$el.addClass(this.CssClassName.DISABLED)},select:function(){this._setSelected(!0)},_setSelected:function(a){this.$el.toggleClass(this.CssClassName.SELECTED,a)},deselect:function(){this._setSelected(!1)},onClick:function(a){if(this.options.view_type===ADD_TO_MAP_VIEWTYPE){var b=this.$("img").attr("src");this.triggerEvent(P.CONST.EVENT_PLACE_IMAGE_SELECTED,b,!0),this.select()}else if("hoverMask"===a.target.className)return this.createPin(),!1},createPin:function(){var a=this.options.link,b=this.options.url,c={action:"create",method:"scraped",render_existing_pin:!0,hide_pin_credits:!0,is_clone_for_repin:!0,image_url:b},d={container_class:"webNewContentNewRepin",mask_type:"webNewContentNewRepin",modal_style:"webNewContentNewRepin",custom_entrance_animation:!0,custom_exit_animation:!0};if(P.experiments.instance.inExperimentGroupsActiveOrTriggerable("web_pin_create2",["enabled_v5_toast"])){var e=new P.modules.PinCreate3({id:"pinCreate",options:c,resource:P.resourceFactory.create("FakePinResource",{description:"",image_url:b,link:a})});this.showInModal(e,d)}else{var f={name:Pc.siteConst.PIN_CREATE_MODULE_NAME,options:c,id:"pinCreate"};P.loadModule(f).then(function(a){this.showInModal(a,{})}.bind(this))}}}),goog.provide("P.modules.PlaceSelector"),goog.require("P.Module"),goog.require("P.modules.TypeaheadField"),P.modules.PlaceSelector=P.Module.extend({onContentReady:function(){this._placeChanged=!1,this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onHint)},onHint:function(a){this.hintData=a.data,this.options.show_hints&&this.determineHint()},determineHint:function(){if(this.hintData&&this.hintData.length){var a=this.getTypeaheadField();if(_.isEmpty(this.results))a.setPrependedStaticItems([{template:"hint_no_city",selectable:!1}]);else{var b=this.hintData[0].feature.name,c=b;-1!==b.indexOf(",")&&(c=b.split(",")[0]),a.setPrependedStaticItems([{template:"hint_specific_city",selectable:!1,locality:c,place:b}])}}},onNoResultsReturned:function(a){this.results=a.data;var b=this.getTypeaheadField();b.setPrependedStaticItems([]),this.hideTypeaheadLoading()},getTypeaheadField:function(){return this.getChildById("placeField")},onResultsReturned:function(a){this.results=a.data;var b=this.getTypeaheadField();b.setPrependedStaticItems([]),this.hideTypeaheadLoading()},onSearchStart:function(){var a=this.getTypeaheadField();a.showLoading()},hideTypeaheadLoading:function(){var a=this.getTypeaheadField();a.hideLoading()},getSelectedPlace:function(){if(!this._placeChanged)return null;var a=this.getTypeaheadField();if(!a)return"0";var b=a.getTypeaheadSelectedItem();if(!b)return"0";var c=b.get("id");return c?c:"0"},focusPlaceField:function(){var a=this.getTypeaheadField();a.focus()},onItemSelected:function(a){this._placeChanged=!0;var b=a.data.item,c=this.getTypeaheadField(),d=b.get("name");c.setValue(d)}}),goog.provide("P.modules.SearchForm"),goog.require("P.Module"),goog.require("P.modules.SearchInputToken"),P.modules.SearchForm=P.Module.extend({events:{"submit > form":"onSubmit",click:"onClick"},CssClassName:{FOCUS:"focus"},onChildItemSelected:function(a){var b=a.data.item,c=b.get("query")||"";this.showGuidedSearch&&this.updateSearchTokens(c,!0);var d=b.get("url");if(d){if(this.options.navigate_on_search){if(this.showGuidedSearch){var e=b.get("type");this.updateQueryStates(c,e,b.get("resultIndex")),"board"!==e&&"user"!==e&&(d+=this.constructQueryStatesParams())}this.navigateInProgress?this.savedUrl=d:this.navigate(d)}return this.typeaheadField.blur(),!1}},onContentReady:function(){this.savedUrl="",this.navigateInProgress=!1;var a={};a[P.CONST.PUBSUB_TOPIC_NAVIGATE_COMPLETE]=this.onNavigateComplete,a[P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED]=this.onNavigateStarted,a[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,a[P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED]=this.onSearchScopeUpdated,a[P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED]=this.onSearchBoostUpdated,a[P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED]=this.onSearchGuideSelected,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.typeaheadField=this.getChildById("searchField"),this.showGuidedSearch=this.options.support_guided_search,this.showGuidedSearch&&(this.tokenizedInput=this.typeaheadField.getChildById("tokenizedInput"),this.queryStates=[],this.queryStatesChange=null),this.selectedListener=this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,this.onTokenRemovedByUser),this.childListen(P.CONST.EVENT_FOCUS,this.onTypeaheadFieldFocus),this.childListen(P.CONST.EVENT_BLUR,this.onTypeaheadFieldBlur),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.listen(P.router.get(),P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),$(document).on("keydown",function(a){this.onKeydown(a)}.bind(this))},onNavigateComplete:function(){this.savedUrl.length>0&&(this.navigate(this.savedUrl),this.savedUrl=""),this.navigateInProgress=!1},onNavigateStarted:function(){this.navigateInProgress=!0},onRouteMatched:function(a){this.showGuidedSearch&&a.options.query&&a.options.query!==this.typeaheadField.getValue()&&this.updateSearchTokens(a.options.query)},onTokenRemovedByUser:function(a){if(this.showGuidedSearch&&a.data){var b=a.data.text;this.updateQueryStates(b,"remove_refine")}this.navigateWithTokens()},onTypeaheadFieldFocus:function(){this.$el.addClass(this.CssClassName.FOCUS),this.showGuidedSearch&&this.tokenizedInput.setEditingTokenText()},onTypeaheadFieldBlur:function(){if(this.$el.removeClass(this.CssClassName.FOCUS),this.showGuidedSearch){var a=this.typeaheadField.getValue();this.tokenizedInput.setInputValue(""),this.updateSearchTokens(a,!1)}},onTypeaheadHidden:function(){if(this.showGuidedSearch){var a=this.typeaheadField.getValue();this.tokenizedInput.setInputValue(""),this.updateSearchTokens(a,!1)}},navigateWithTokens:function(){var a=this.typeaheadField.getValue(),b=encodeURIComponent(a),c="/",d=this.currentScope||this.options.scope||"pins";b&&(c="/search/"+d+"/?q="+b,c+=this.constructQueryStatesParams()),this.options.navigate_on_search&&(this.navigateInProgress?this.savedUrl=c:this.navigate(c))},tokenizeQuery:function(a){var b=a.split(/\s+/),c=_.find(b,function(a){return _.contains(P.CONST.SEARCH_FILTER_CONJUNCTIONS,a.toLowerCase())});return c?[a]:b},updateSearchTokens:function(a,b){var c;if(b?(this.clearTypeaheadField(),c=a):c=this.tokenizedInput.setTokenValue(a),c){var d=this.tokenizeQuery(c),e=_.map(d,function(a){return{term:a,position:"1"}});this.addSearchInputTokens(e)}},onSearchQueryUpdated:function(a,b,c){var d=c||"";this.showGuidedSearch?this.typeaheadField.isFocussed()||(this.tokenizedInput.setInputValue(""),this.updateSearchTokens(d,!1)):this.setTypeaheadValue(d)},onSearchScopeUpdated:function(a,b,c){var d=c||"pins";this.currentScope=d,this.typeaheadField.setAutocompleteScope(d)},onSearchBoostUpdated:function(a,b,c){var d=c||"";this.currentBoost=d},onSearchGuideSelected:function(a,b,c){var d=c.term||"",e=c.position,f=c.color,g=c.index;if(d){var h=[{term:d,position:e,color:f}];this.addSearchInputTokens(h),this.updateQueryStates(d,"add_refine",g)}this.navigateWithTokens()},removeSearchInputToken:function(a){this.tokenizedInput.removeToken(a)},addSearchInputTokens:function(a){var b=_.map(a,function(a){return new P.modules.SearchInputToken({options:{term:a.term,position:a.position,color:a.color}})});this.tokenizedInput.addTokensAndUpdateInputView(b)},setTypeaheadValue:function(a){this.typeaheadField.setValue(a)},clearTypeaheadField:function(){this.typeaheadField.clear()},_getTypeaheadHighlightedItem:function(){return this.typeaheadField.getTypeaheadHighlightedItem()},focus:function(){this.typeaheadField.focus()},onSubmit:function(){var a=this._getTypeaheadHighlightedItem();if(a)return!1;var b=this.typeaheadField.getValue();if(""===b.trim())return P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED_WITH_EMPTY_QUERY,b),!1;this.showGuidedSearch&&(this.updateSearchTokens(b,!0),this.typeaheadField.abortSearch(),this.typeaheadField.blur());var c=encodeURIComponent(b),d=this.currentScope||this.options.scope||"pins";if(this.typeaheadField.setAutocompleteScope(d),this.options.navigate_on_search){var e="/search/"+d+"/?q="+c;"recent_week"===this.currentBoost&&(e="/search/pins/recent/?q="+c),this.showGuidedSearch&&this.updateQueryStates(b,"typed"),this.navigate(e)}return P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,b),this.typeaheadField.blur(),this.typeaheadField.abortSearch(),!1},constructSingleQueryStateParam:function(a){var b="";return"typed"===a.type?b+=a.term+"|"+a.type:"recentsearch"===a.type||"autocomplete"===a.type?b+=a.term+"|"+a.type+"|"+a.index:"guide"===a.type&&(b+=a.term+"|"+a.type+"|"+a.filter_type+"|"+a.index),b},constructQueryStatesParams:function(){var a="";if(this.queryStates.length>0){var b=[];_.each(this.queryStates,function(a){b.push(this.constructSingleQueryStateParam(a))}.bind(this));var c={term_meta:b};this.queryStatesChange&&(c[this.queryStatesChange.action]=this.constructSingleQueryStateParam(this.queryStatesChange),this.queryStatesChange=null),a="&"+$.param(c)}return a},updateQueryStates:function(a,b,c){var d;if("typed"===b)this.queryStates=[],d=this.tokenizeQuery(a),_.each(d,function(a){this.queryStates.push({term:a,type:b})}.bind(this));else if("recent_query"===b)this.queryStates=[],d=this.tokenizeQuery(a),_.each(d,function(a){this.queryStates.push({term:a,type:"recentsearch",index:c})}.bind(this));else if(_.contains(["query","pin_search","board_search","people_search"],b))this.queryStates=[],d=this.tokenizeQuery(a),_.each(d,function(a){this.queryStates.push({term:a,type:"autocomplete",index:c})}.bind(this));else if("add_refine"===b)this.queryStates.push({term:a,type:"guide",filter_type:"word",index:c}),this.queryStatesChange={action:"add_refine",term:a,type:"guide",filter_type:"word",index:c};else if("remove_refine"===b){var e=_.find(this.queryStates,function(b){return b.term===a
});e&&(this.queryStates.splice(_.indexOf(this.queryStates,e),1),e.action="remove_refine",this.queryStatesChange=e)}},onClick:function(){this.focus()},onKeydown:function(a){var b=P.getModalManager();b.hasModals()||a.keyCode===P.keyCode.TAB&&(this.typeaheadField.isFocussed()?this.typeaheadField.blur():this.typeaheadField.focus(),a.preventDefault())}}),goog.provide("P.modules.SendBoard"),goog.require("P.Module"),goog.require("P.modules.SendObjectBase"),P.modules.SendBoard=P.modules.SendObjectBase.extend({_OBJECT_ID_NAME:"board"}),goog.provide("P.modules.SocialTypeaheadField"),goog.require("P.Module"),goog.require("P.modules.TypeaheadField"),P.modules.SocialTypeaheadField=P.modules.TypeaheadField.extend({onCreated:function(){P.modules.TypeaheadField.prototype.onCreated.apply(this),this._updateNetworks()},onContentReady:function(){P.modules.TypeaheadField.prototype.onContentReady.apply(this),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.updateTypeaheadStaticItems),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED,function(){this._updateNetworks(),this.updateTypeaheadStaticItems(),this.render()}.bind(this))},onItemSelected:function(a){var b=a.data.item,c=b.attributes;c.network&&(this.connectToNetwork(c.network),this.options.bubble_network_item_click||a.stopPropagation())},_updateSocialConnectItems:function(){this._socialConnectItems=_.map(this._networksToConnect,function(a){return{template:"socialConnect",selectable:!0,network:a}})},_updateNetworks:function(){var a=P.currentUser;this._networksToConnect=[],a.get("connected_to_facebook")||a.get("facebook_url")||this._networksToConnect.push(P.SocialConnect.FACEBOOK),a.get("connected_to_twitter")||a.get("twitter_url")||this._networksToConnect.push(P.SocialConnect.TWITTER),a.get("connected_to_gplus")||a.get("gplus_url")||this._networksToConnect.push(P.SocialConnect.GPLUS),a.get("connected_to_yahoo")||this._networksToConnect.push(P.SocialConnect.YAHOO),this._updateSocialConnectItems()},updateTypeaheadStaticItems:function(){var a=[];if(this.options.allow_email){var b=this.getValue();if(b){var c=P.isEmailAddress(b),d=this.options.email_options||{};d.template||(d.template="emailSelect"),a=[_.extend(d,{selectable:c,email:b,is_valid:c})]}}var e=a.concat(this._socialConnectItems);this.setAppendedStaticItems(e)},_markNetworkAsConnected:function(a){this._networksToConnect=_.without(this._networksToConnect,a),this._updateSocialConnectItems(),this.updateTypeaheadStaticItems(),this.render()},connectToNetwork:function(a){var b={success:function(){this._markNetworkAsConnected(a)}.bind(this)};P.SocialNetworkSettingsManager.instance().handleConnect(a,!0,b)}}),goog.provide("P.modules.UserBoards"),goog.require("P.Module"),goog.require("P.modules.Board"),goog.require("P.modules.BoardCreateRep");var SECRET_BOARD_TYPE=P.CONST.BOARD_PRIVACY_SECRET,MODULE_ID_PUBLIC_BOARDS_GRID="publicBoardsGrid",MODULE_ID_SECRET_BOARDS_GRID="secretBoardsGrid";P.modules.UserBoards=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onBoardCreated,a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,a[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,this.extraData.isOwnProfile&&(a[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,this.initializeBoardsSortManager(MODULE_ID_PUBLIC_BOARDS_GRID),this.initializeBoardsSortManager(MODULE_ID_SECRET_BOARDS_GRID),this.setupMessageHandlers()),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onBoardCreated:function(a,b,c){var d=c,e=d.id,f=d.privacy,g=f===SECRET_BOARD_TYPE?MODULE_ID_SECRET_BOARDS_GRID:MODULE_ID_PUBLIC_BOARDS_GRID,h=this.getChildById(g),i=new P.modules.Board({options:{show_board_context:!1},resource:{name:"BoardResource",options:{board_id:e}}});h.items.appendChild(i),i.render(),h.forceDragState()},onBoardDeleted:function(){},onBoardUpdated:function(a,b,c){c===P.CONST.PUBSUB_MESSAGE_BOARD_SET_PUBLIC&&this.render()},onBoardRemovedSelf:function(){this.render()},addCreateBoardRep:function(a,b,c){if(!c.items.getChildById(a)){var d=new P.modules.BoardCreateRep({id:a,options:{secret:b===SECRET_BOARD_TYPE}});d.render().then(function(){c.items.appendChild(d)})}},initializeBoardsSortManager:function(a){var b=this.getChildById(a),c={cancel:".BoardCreateRep",over:function(a,b){var c=30,d=$(window).scrollTop(),e=b.offset.top-d,f=b.item.height(),g=e<0,h=e>P.Viewport.height-f;h&&(c*=-1),(g||h)&&$(window).scrollTop(d-c)},update:function(b,c){this.onBoardsSortUpdate(b,c,a)}.bind(this)};b.setDragState(b.DRAGGING_DISABLED),b.items.initializeSortManager(c,"Board",function(a){return a.data&&a.data.id})},onBoardsSortUpdate:function(a,b,c){var d=this.getChildById(c);this.saveBoardOrder(d.items.getSortOrder())},saveBoardOrder:function(a){var b="BoardsReorderResource",c={board_ids:a},d=P.resourceFactory.create(b,c),e="user_boards_reorder";d.callUpdate({showError:!1}).then(function(){P.trackGAEvent(e,P.CONST.GA_ACTION_SUCCESS)},function(){P.trackGAEvent(e,P.CONST.GA_ACTION_ERROR)})},setupMessageHandlers:function(){var a=[this.getChildById(MODULE_ID_PUBLIC_BOARDS_GRID),this.getChildById(MODULE_ID_SECRET_BOARDS_GRID)],b={};b[P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN]=this.handleConversationOpen.bind(this,a),b[P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED]=this.handleConversationClosed.bind(this,a),b[P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS]=this.handleConversationClosed.bind(this,a),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,b),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onItemsRequestSuccess.bind(this,a))},handleConversationOpen:function(a){a.forEach(function(a){a.setDragState(a.DRAGGING_ENABLED)})},handleConversationClosed:function(a){a.forEach(function(a){a.setDragState(a.DRAGGING_DISABLED)})},onItemsRequestSuccess:function(a){a.forEach(function(a){a.forceDragState()})}}),goog.provide("P.modules.UserProfilePage"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),P.modules.UserProfilePage=P.Module.extend({events:{},_tabs_to_resource:{boards:"BoardsResource",pins:"UserPinsResource",likes:"UserLikesResource",followers:"UserFollowersResource",following:"UserFollowingResource"},getLoggingObjectIdStr:function(){return this.data.id},onAddedToDom:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onRemovedFromDom:function(){this._removeListeners()},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_USER_BLOCKED]=this.onAccessChange,a[P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED]=this.onAccessChange,this.data&&this.data.id&&this.pubsubSubscribe(this.data.id,a);var b={};b[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,b),"1"===this.options.show_redirected_memo&&this.showRedirectDialog(),"1"===this.options.board_create&&this.showBoardCreateModal(),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onChildItemsAddedToGrid),this.inBulkEditMode=!1},showRedirectDialog:function(){var a={name:"ConfirmDialog",options:{template:"deleted_board_redirect",user_name:this.data.full_name,auto_close_delay_ms:7e3}};P.loadModule(a).then(function(a){P.getModalManager().createAndShowModal(a)})},showBoardCreateModal:function(){var a=new P.modules.BoardCreate({options:{}});this.showInModal(a)},getPins:function(){var a=this.getChildByModuleName("UserProfileContent");if(!a)return[];var b=a.getChildByModuleName("Grid");if(!b)return[];var c=b.getGridItemsChildren();return c.length?c:[]},toggleBulkEditMode:function(a,b,c){(c===P.CONST.ENTER_BULK_EDIT&&!this.inBulkEditMode||c===P.CONST.EXIT_BULK_EDIT&&this.inBulkEditMode)&&(this.inBulkEditMode=!this.inBulkEditMode,this.getPins().forEach(function(a){a.data&&P.pubsub.publish(a.data.id,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,c)}))},onChildItemsAddedToGrid:function(){this.inBulkEditMode&&this.getPins().forEach(function(a){a.data&&P.pubsub.publish(a.data.id,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.ENTER_BULK_EDIT)})},onAccessChange:function(){this.render()},onChildNavigate:function(a){this.log.debug("UserProfilePage got navigate event from child",a.target,"for url:",a.data.url);var b=P.router.get()&&P.router.get().resolve(a.data.url);if(b){var c=b.module,d=b.options,e=b.resource,f=e.options&&e.options.username,g=this.data;if(this.contentReady&&c===this.className&&f===(g&&g.username)){this.setOptions(d),this.setResource(e);var h=this.$el.height();this.$el.css("min-height",h);var i=this.getScrollableElement(),j=i.scrollTop(),k=d.tab,l=this.getChildByModuleName("UserProfileContent"),m=this.getChildByModuleName("UserInfoBar"),n=this.getChildByModuleName("UserProfileHeader");m.setOptions({tab:k,spinner:{enable:!1}}),m.render(),"likes"===k?n.showMovePinsButton():(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT),n.hideMovePinsButton()),l.setOptions({tab:k}),l.showLoading(),l.render().then(function(){l.hideLoading(),this.$el.css("min-height","");var a=i.height(),b=this.$el.positionAncestor(i).top,c=this.$el.height(),d=j+a-c+b;d>0&&(this.$el.css("min-height",c+d),i.scrollTop(j))}.bind(this)),a.data.handled=!0}}}}),goog.provide("P.modules.AddAPlace"),goog.require("P.Module"),goog.require("P.modules.Pinnable"),goog.require("P.modules.GridItems");var PINIT_BUTTON_ID="pinitButton";P.modules.AddAPlace=P.Module.extend({events:{"keyup .description":"onDescriptionKeyup"},CssClassName:{ERROR:"error",HAS_ERROR:"hasError",VISIBLE:"visible"},onDescriptionKeyup:function(){this._enableIfReady()},onContentReady:function(){if(this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.childListen(P.CONST.EVENT_PLACE_IMAGE_SELECTED,this.onPlaceImageSelected),P.scrollbarWidth()>0){var a=this.getChildById("images");if(a){var b=a.getGridItems();b&&b.setHasScroll(!0)}}},setPlace:function(a){this.place=a},onUploadSuccess:function(a){var b=a.data.image_url;this.setImage(b);var c={name:"Pinnable",options:{url:b,view_type:"add_to_map"}};P.loadModule(c).then(function(a){var b=a;a.render().then(function(){var c=this.getGridItems();c.prependChildItem(a);var d=this.getImages();_.each(d,function(a){a.deselect()}),b.select(),this._enableIfReady()}.bind(this))}.bind(this))},getGridItems:function(){var a=this.getChildById("images").getGridItems();return a},setImage:function(a){this._image=a},onButtonClick:function(a){var b=a.target;if(b.id===PINIT_BUTTON_ID){a.stopPropagation();var c=this._image;if(!c)return void P.showError(P._("Please pick an image for this pin."));this._enableIfReady()&&(b.showLoading(),this.triggerEvent(P.CONST.EVENT_PINIT_BUTTON_CLICKED,c,!0))}},_enableIfReady:function(){var a=this.getChildById(PINIT_BUTTON_ID),b=this.hasValidDescription();return b?(this.removeErrorState(),this._image?(this.removeErrorState(),a.enable(),!0):!1):(this.addErrorState(),!1)},onPlaceImageSelected:function(a){var b=this.getImages();_.each(b,function(a){a.deselect()});var c=a.data;this._image=c,this._enableIfReady(),this.focus()},onAddedToDom:function(){this.focus()},focus:function(){this.$(".description").focus()},addErrorState:function(){this._setDescriptionError(!0),this.focus()},_setDescriptionError:function(a){this.$(".description").toggleClass(this.CssClassName.HAS_ERROR,a),this.$(".descriptionLabel").toggleClass(this.CssClassName.ERROR,a),this.$(".required").toggleClass(this.CssClassName.VISIBLE,a)},removeErrorState:function(){this._setDescriptionError(!1)},getImages:function(){var a=this.getChildById("images").getGridItems(),b=a.children;return b},hasValidDescription:function(){var a=this.$(".description");return!!a.val().length}}),goog.provide("P.modules.AppBase"),goog.require("P.BrowserDetector"),goog.require("P.date"),goog.require("P.HistoryManager"),goog.require("P.interfaces.HistoryManagerProvider"),goog.require("P.Module"),goog.require("P.modules.PinCreate"),goog.require("P.navigateData.NavigateData"),goog.require("P.util");var LOADING_DELAY=500,NEXT_ACTION={REPLACE:0,REPLACE_TOP:1,APPEND:2,CLOSE:3,IGNORE:4};P.modules.AppBase=P.Module.extend({MAIN_MODULE_ID:"mainModule",CLOSEUP_NAME:"Closeup",CssClassName:{HAS_KLP_BAR:"hasKLPBar"},onCreated:function(){P.currentUser.isAuthenticated()||P.currentUser.attemptLogin(),this.historyManager=new P.HistoryManager,this.backgroundModule=null,this.canUpdatePageInfo=!1,this.browser=P.BrowserDetector.getBrowser();var a={};a[P.CONST.PUBSUB_TOPIC_WINDOW_LOCATION_CHANGE]=this._onWindowLocationChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a);var b={};b[P.CONST.PUBSUB_TOPIC_KLP_BAR_HIDDEN]=this.removeHasKLPBarClass,b[P.CONST.PUBSUB_TOPIC_KLP_BAR_SHOWN]=this.addHasKLPBarClass,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_KLP_BAR,b),this._modalManager=null},onAddedToDom:function(){var a=P.router.get();a.start(),P.AppVersion.setup(P.CONTEXT.app_version),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_SCROLL_TO_ELEMENT,this._onChildScrollToElement),this.listen(a,P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),this.listen(a,P.CONST.EVENT_ROUTE_NO_MATCH,this.onRouteNoMatch),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,this.onChildEventRequiresAuthentication),this.childListen(P.CONST.EVENT_CLOSE,this._onChildClose);var b={};b[P.CONST.PUBSUB_TOPIC_PAGE_INFO]=this.onPageInfoChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,b),this.childListen(P.CONST.EVENT_MODAL,this._onChildModal)},onChildAdded:function(){this._adjustScrollToTopPositionIfNeeded()},onChildEventRequiresAuthentication:function(a){var b=a.data.authRedirectUrl;b&&this.navigate(a.data.authRedirectUrl)},_onChildClose:function(){this.historyManager.closeCurrentModule()},getHistoryManager:function(){return this.historyManager},_onChildScrollToElement:function(a){var b=a.data,c=b.$el,d={scrollOffset:b.scrollOffset,callback:b.callback};this._scrollToElement(c,d)},_onWindowLocationChange:function(){this.midNavigate=!1},_getCurrentMainModule:function(){var a=this.getChildById(this.MAIN_MODULE_ID);return a?a:this.children[this.children.length-1]},_scrollToElement:function(a,b){var c=this._getCurrentMainModule(),d=P.normalizeScroller(c.getScrollableElement()),e=a.positionAncestor(d).top,f=0===b.scrollOffset?0:b.scrollOffset||P.CONST.SCROLL_TO_ELEMENT_OFFSET,g={newScrollOffset:Math.max(e-f,0),$scroller:d,callback:b.callback};P.scrollToTop(g)},setUpContextLogging:function(){var a=this._getCurrentMainModule();if(!a.getHasError()){var b=window.location.pathname+window.location.search,c=P.router.get().resolve(b);if(c){var d=c.extraContent.log;if(d){var e=P.ContextEvent.fromPlainObject(d);e.setEventType(P.ContextLogging.EventType.VIEW),e.setRequestIdentifier(P.PAGE_LOAD_REQUEST_IDENTIFIER);var f=a.getLoggingObjectIdStr();f&&e.setObjectIdStr(f),P.ContextLogger.getInstance().addEvent(e)}}else this.log.error("Router couldn't resolve url for context logging",{url:b})}},onRemovedFromDom:function(){this._removeListeners()},onRouteMatched:function(a){if(P.AppVersion.isNewVersionAvailable()&&this.midNavigate&&(P.AppVersion.isNewVersionRequired()||"Closeup"!==a.module))return this._setVersionRedirectCookie(),void window.location.reload();this.log.debug("onRoute",a),P.trackGAPageview(a.module);var b=a.module,c=a.options,d=a.resource;a.extraContent.perf_log&&P.trackingTimer.start(b,"NavigateToRender");var e;this.extraData&&this.extraData.userAgent&&a.extraContent&&(e=P.DeepLink.getLinkForUserAgent(this.extraData.userAgent,a.extraContent)),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_DEEP_LINK,e);var f="https:"===window.location.protocol,g=!0;if(a.extraContent.require_explicit_login&&P.currentUser.get("autologin"))return void P.navigate(P.getLoginUrl());if(a.extraContent.require_authentication&&!P.currentUser.isAuthenticated())return void P.navigate(P.getRegisterUrl({prev:a.navigateData.fromHistoryUid}));if(a.extraContent.require_sterling_access&&!P.currentUser.get("has_sterling_access"))return void P.navigate("/");if(a.extraContent.require_business_user&&!P.currentUser.get("is_partner"))return void P.navigate("/");if(g&&!f)return void window.location.replace(window.location.href.replace(/http:\/\//,"https://"));this.removeAllModals();var h=this._getCurrentMainModule();a.navigateData.currentModule=h,P.loadModuleConstructor(b).then(function(b){var e=this.historyManager.getModule(b,a.navigateData);if(!this._getCurrentMainModule())return void window.location.reload();var f=null,g=a.extraContent.log;g?(g.event_type=P.ContextLogging.EventType.VIEW,f=P.ContextEvent.fromPlainObject(g)):P.ContextLogger.getInstance().clearContext(),this.updateMainModule(e,c,d,a,f)}.bind(this));var i=this.historyManager.getPageInfo();i&&this.setPageInfo(i),this.canUpdatePageInfo=!i},onRouteNoMatch:function(){window.location.reload()},onPageInfoChange:function(a,b,c){this.canUpdatePageInfo&&(this.historyManager.setPageInfo(c),this.setPageInfo(c),this.canUpdatePageInfo=!1)},setPageInfo:function(a){a.title&&$(document).attr("title",a.title),$("head meta[data-app]").remove();var b=[];_.each(a.meta,function(a,c){b.push($("<meta>").prop({name:c,property:c,content:a,"data-app":1}))}),$("head").append(b)},startModuleTransition:function(a){this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID||this.browser===P.CONST.BrowserType.SAFARI?a.hideModule():a.fadeOut(),clearTimeout(this._loaderTimeout),this._loaderTimeout=P.setTimeout(function(){this.loadingShown=!0,this.showLoading()}.bind(this),LOADING_DELAY,"App loader")},stopModuleTransition:function(a){clearTimeout(this._loaderTimeout),this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID||this.browser===P.CONST.BrowserType.SAFARI?a.showModule():a.fadeIn(),this.loadingShown&&(this.hideLoading(),this.loadingShown=!1)},updateMainModule:function(a,b,c,d,e){var f=d.navigateData,g=a.module,h=a.backgroundModule,i=this._getCurrentMainModule();i.saveExtraState(!0),this.log.debug("Current:",i.className,"New:",g.className);var j=this._getNextAction(i,g,h,f),k=j===NEXT_ACTION.REPLACE&&i.className!==this.CLOSEUP_NAME&&g.className!==this.CLOSEUP_NAME;k&&this.startModuleTransition(i),g.clearFades();var l=this._getCanClose(i,a,j);null!==l&&(b.can_close=l,b.origin_location=i.options.origin_location||f.fromHistoryUid,b.source_data=i.options.source_data||this.getChildInfoByModuleName("GridItems"));var m=null===l||l===!1;if(P.Body.setScrolling(m),e){var n=function(a,b,c){var d=c;e.setRequestIdentifier(d),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_REQUEST)}.bind(this),o={};o[P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER]=n,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_REQUEST,o)}var p=function(){if(this.midNavigate=!1,k&&this.stopModuleTransition(g),j!==NEXT_ACTION.IGNORE&&j!==NEXT_ACTION.CLOSE&&g.showModule(),this.updateScrollWatchers(g),e&&!g.getHasError()){var a=g.getLoggingObjectIdStr();if(a&&e.setObjectIdStr(a),d.extraContent.perf_log){var b=P.trackingTimer.end(d.module,"NavigateToRender");b&&e.updateAuxData({interaction_wait:b.elapsedTime})}P.ContextLogger.getInstance().addEvent(e),P.pubsub.clearChannel(P.CONST.PUBSUB_CHANNEL_REQUEST)}P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAVIGATE_COMPLETE)}.bind(this);g.errorStrategy=P.CONST.ErrorStrategy.SHOW,g.setAsMainModule(b,c,f).then(function(){j!==NEXT_ACTION.IGNORE&&j!==NEXT_ACTION.CLOSE&&g.hideModule(),this._performNextAction(j,i,a,f),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW,this._getCurrentMainModule()),this._adjustScrollToTopPositionIfNeeded(),this._scrollMainModuleIfNeeded()}.bind(this),function(){this.historyManager.cancelNavigation()}.bind(this)).fin(function(){p(),!P.currentUser.isAuthenticated()&&f.fromNavigate&&P.signupModalManager.modalsEnabled&&P.signupModalManager.showInlineSignupModal(g,g.resource)})},_getNextAction:function(a,b,c,d){var e=null;return e=a===b?NEXT_ACTION.IGNORE:b.className!==this.CLOSEUP_NAME?a.className===this.CLOSEUP_NAME&&a.options.can_close&&this.backgroundModule&&b===this.backgroundModule?NEXT_ACTION.CLOSE:NEXT_ACTION.REPLACE:d.fromNavigate?a.className===this.CLOSEUP_NAME?a.options.can_close?NEXT_ACTION.REPLACE_TOP:NEXT_ACTION.REPLACE:NEXT_ACTION.APPEND:a===c&&b.className===this.CLOSEUP_NAME?NEXT_ACTION.APPEND:NEXT_ACTION.REPLACE},_getCanClose:function(a,b,c){var d=b.module,e=b.backgroundModule;if(d.className!==this.CLOSEUP_NAME)return null;var f=a.className===this.CLOSEUP_NAME,g=!!a.options.can_close;switch(c){case NEXT_ACTION.REPLACE:return!!e;case NEXT_ACTION.REPLACE_TOP:return g;case NEXT_ACTION.APPEND:return!f||g;case NEXT_ACTION.IGNORE:return g}return null},_performNextAction:function(a,b,c,d){var e=c.module,f=c.backgroundModule,g=e.$el,h=a!==NEXT_ACTION.IGNORE,i=this.getChildById("header"),j=0;if(i&&(j=i.getHeight()),a===NEXT_ACTION.IGNORE)this.backgroundModule&&this.historyManager.updateBackgroundModule(this.backgroundModule,d);else if(a===NEXT_ACTION.CLOSE)this.backgroundModule=null,b.detachElement(),this.removeChildId(b);else if(a===NEXT_ACTION.REPLACE){this.backgroundModule!==f&&(this.backgroundModule&&(this.backgroundModule.detachElement(),this.backgroundModule=null),f&&(f!==b&&(f.appendToElement(this.$(".mainContainer")),this.addChild(f)),this.backgroundModule=f)),b!==f&&(this.removeChildId(b),b.detachElement()),this.removeChildId(b),g.css("min-height",P.Viewport.height-j);var k=$(this.backgroundModule?".appendedContainer":".mainContainer");k.append(g),this.addChild(e)}else a===NEXT_ACTION.REPLACE_TOP?(b.detachElement(),g.css("min-height",P.Viewport.height-j),$(".appendedContainer").append(g),this.addChild(e),this.historyManager.updateBackgroundModule(this.backgroundModule,d)):a===NEXT_ACTION.APPEND&&(this.backgroundModule=b,this.removeChildId(b),g.css("min-height",P.Viewport.height-j),$(".appendedContainer").append(g),this.addChild(e),this.historyManager.updateBackgroundModule(this.backgroundModule,d));(h||this._forceRefreshRequested(d))&&(this.setChildId(e,this.MAIN_MODULE_ID),e.restoreExtraState(!0))},_setVersionRedirectCookie:function(){Cookie.set(P.CONST.COOKIE_VERSION_REFRESH,P.AppVersion.currentVersion,1)},onContentReady:function(){this._modalManager=this.getChildById("modalManager"),this.setUpContextLogging();var a=this._getCurrentMainModule();P.trackGAPageview(a.className),_.defer(this._startTutorials.bind(this)),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW,a),this.setChildId(a,this.MAIN_MODULE_ID),this.historyManager.start(a),this.historyManager.setPageInfo(P.PAGE_INFO),this.setPageInfo(P.PAGE_INFO),this.updateScrollWatchers(a),this._setDevicePixelRatioCookie(),this._adjustScrollToTopPositionIfNeeded(),this._scrollMainModuleIfNeeded()},_setDevicePixelRatioCookie:function(){var a=(window.devicePixelRatio||1)+"";Cookie.set(P.CONST.COOKIE_DEVICE_PIXEL_RATIO,a)},onChildNavigate:function(a){var b=a.data.url,c=P.isOffsiteUrl(b);if(this.midNavigate&&!c)return void a.stopPropagation();if(this._adjustScrollToTopPositionIfNeeded(),!c&&(this.midNavigate=!0,P.AppVersion.isNewVersionRequired()))return this._setVersionRedirectCookie(),P.changeWindowLocation(b,!1),void a.stopPropagation();this.log.debug("App got navigate event from child",a.target,"for url:",b);var d=new P.navigateData.NavigateData;d.handled=!!a.data.handled,d.evt=a,this.historyManager.navigate(b,d),a.stopPropagation()},_adjustScrollToTopPositionIfNeeded:function(){},_scrollMainModuleIfNeeded:P.NOOP,_startTutorials:function(){P.TutorialManager.instance().resumeTutorial(),P.ExperienceTutorialManager.instance().startTutorial()},isTutorialActive:function(){return P.TutorialManager.instance().isTutorialActive()},updateScrollWatchers:function(){},addHasKLPBarClass:function(){this.$(".appContent").addClass(this.CssClassName.HAS_KLP_BAR),this.$(".message.messageUnauth").addClass(this.CssClassName.HAS_KLP_BAR)},removeHasKLPBarClass:function(){this.$(".appContent").removeClass(this.CssClassName.HAS_KLP_BAR),this.$(".message.messageUnauth").removeClass(this.CssClassName.HAS_KLP_BAR)},updateNavigationBar:function(){var a=P.app.getChildByModuleName("Nags");a&&a.render();var b=P.app.getChildById("header");b&&(delete b.options.class_name,b.render()),this._showFooterButtons()},_showFooterButtons:function(){var a=P.app.getChildById("footerButtons");a&&a.setVisible(!0)},_onChildModal:function(a){this.log.debug("Got modal event from child",a.target,"for module:",a.data.module),a.stopPropagation(),this._modalManager.createAndShowModal(a.data.module,a.data.showModalOptions||{},a.target)},_isTutorialActive:function(){return P.TutorialManager.instance().isTutorialActive()},removeAllModals:function(){this._isTutorialActive()||this._modalManager.removeAllModals(!0)},debugNumGridItems:function(){for(var a,b=[],c=[this];c.length>0;)a=c.pop(),"GridItems"===a.className&&b.push(a),c=c.concat(a.children);return _.each(b,function(a,b){for(var c=a.parent,d=a.className+" has "+a.children.length+" children";c;)d=c.className+"->"+d,c=c.parent;this.log.debug(b+1+": "+d)}.bind(this)),0===b.length&&this.log.debug("There are no grids in the page."),":)"}}),P.Errors.wrap(P.modules.AppBase.prototype,["_onChildModal"]),goog.provide("P.modules.BoardCollaboratorInviter"),goog.require("P.Module"),goog.require("P.modules.BoardEditActionBase"),P.modules.BoardCollaboratorInviter=P.modules.BoardEditActionBase.extend({onContentReady:function(){P.modules.BoardEditActionBase.prototype.onContentReady.call(this);var a=this.$(".BoardInviteForm .TypeaheadField .Input"),b=this.$(".BoardInviteForm .inviteButton");a.width(a.width()-b.innerWidth())}}),goog.provide("P.modules.BoardEdit"),goog.require("P.Module"),goog.require("P.modules.BoardEditActionBase"),goog.require("P.modules.BoardEditBase"),P.modules.BoardEdit=P.modules.BoardEditActionBase.extend({handleDelete:function(a,b){this.isInModal()?(P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_DELETED),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_DELETED,{privacy:b}),this.destroy()):this.redirectAfterDelete()},onButtonClick:function(a){P.modules.BoardEditBase.prototype.onButtonClick.call(this,a);var b=a.target;"deleteBoardButton"===b.id&&this.onDeleteClick()},onDeleteClick:function(){P.trackGAEvent("board_delete",P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()},onDeleteConfirm:function(){P.trackGAEvent("board_delete",P.CONST.GA_ACTION_CLICK_SUBMIT),this.deleteBoard()},showConfirmation:function(){var a={name:"ConfirmDialog",options:{template:"delete_board"}};P.loadModule(a).then(function(a){this.showInModal(a),this.listen(a,P.CONST.EVENT_CONFIRM,this.onDeleteConfirm)}.bind(this))}}),require("common/lib/external/mapbox.uncompressed-2.1.5-patched.js"),goog.provide("P.modules.BoardPage"),goog.require("P.Module"),goog.require("P.modules.AddPinToMap"),goog.require("P.modules.BoardCollaboratorInviter"),goog.require("P.modules.InviteModal"),goog.require("P.modules.InviteModal.showInviteModal"),goog.require("P.modules.Map"),goog.require("P.number"),goog.require("P.Sticky");var ID_ADD_TO_MAP_BUTTON="addToMap",HEADER_DATA_KEYS=["description","privacy"],PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW=300,PLACE_BOARD_V2_BOARD_HEIGHT_IN_MAP_VIEW=220,ID_TOGGLE_VIEW_BUTTON="toggleView",MS_ANIMATION_DURATION_MAP=400,MS_ANIMATION_DURATION_MAP_FAST=200,TIME_UNTIL_MARKER_UNHIGHLIGHTS_SELF=1500,ANIMATION_EASING_LINEAR="linear",ANIMATION_EASING_MAP_EASE_OUT="cubic-bezier(.19, 1, .48, 1)",ANIMATION_EASING_MAP_EASE_IN_AND_OUT="cubic-bezier(.29, 0, .29, 1)",ANIMATION_EASING_DISPLACE_PIN="cubic-bezier(.19, 1, .48, 1)",MAP_ANIMATION_DURATION_MS=250,SCOPED_TOUCH_EVENT="touchmove.placePinsBoard",CSS_PADDING_TOP="paddingTop";P.modules.BoardPage=P.Module.extend({events:{click:"onClick"},CssClassName:{CENTERED_WITHIN_WRAPPER:"centeredWithinWrapper",DROP_PREVIEW:"dropPreview",GRID_ROW_LAYOUT:"rowLayout",GRID_VARIABLE_HEIGHT:"variableHeightLayout",FADE:"fade",HAS_FOOTER:"hasFooter",HIDDEN:"hidden",MAP_HIDE:"hideMap",MAP_SHOW:"showMap",MAP_VIEW:"mapView",NUB_VISIBLE:"visible",PAD_ITEMS:"padItems",POSITION_ADD_PIN_REP:"positionAddPinRep",UI_STATE_CONVERSATION:"ui-state-conversation"},isPlaceBoard:function(){var a=this.data;return a?a.layout===P.CONST.BOARD_LAYOUT_PLACES:!1},isDesktopPlaceBoard:function(){return this.isPlaceBoard()&&!P.CONTEXT.is_mobile_agent},onCreated:function(){this.map=null,this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady),this._pinCount=0,this._onPrependedToMapBoard=this._onPrependedToMapBoard.bind(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.isDesktopPlaceBoard()&&this.alignHeaderToMap()},addTutorials:function(){var a;a=this.isPlaceBoard()&&this.extraData.canEdit?_.isEmpty(this.getPins())?P.Experiences.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER:P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER:P.Experiences.Placement.WEB_BOARD_TAKEOVER,P.ExperienceManager.instance().launchPlacedExperience(a,{board_id:this.data.id})},getGrid:function(){return this.getChildById("grid")},getBoardHeader:function(){return this.getChildById("boardHeader")},getBoardInfoBar:function(){return this.getBoardHeader().getChildById("boardInfoBar")},getBoardTitleHeight:function(){return this.$(".boardHeaderWrapper").height()},getMapControlButtons:function(){return this.$(".mapControlButtons, .leaflet-control-container")},showMapButtonsIfPossible:function(){this.showAddToMapButtonIfPossible(),this.showToggleViewButtonIfPossible(),this.showAddPinRepWithPlaceIfPossible()},showAddToMapButtonIfPossible:function(){var a=this._getAddToMapButton();a&&a.getContent().show()},showToggleViewButtonIfPossible:function(){var a=this._getToggleViewButton();a&&a.getContent().show()},showAddPinRepWithPlaceIfPossible:function(){var a=this.$(".AddPinRepWithPlace");a&&a.css("pointer-events","auto")},addMarkersToMap:function(){var a=this.getPins();this._pinCount=a.length;var b=_.filter(a,function(a){return a.getCoordinates&&null!==a.getCoordinates()}),c=b.length>0;this._pinCount&&c&&(this.map.addMarkersToMap(a),this.map.fitViewToPinMarkers())},getPins:function(){var a=this.getGrid();if(!a)return[];var b=a.getGridItemsChildren();return b.length?b:[]},_getAddToMapButton:function(){return this.getChildById(ID_ADD_TO_MAP_BUTTON)},_getToggleViewButton:function(){return this.getChildById(ID_TOGGLE_VIEW_BUTTON)},onMapReady:function(){this.showMapButtonsIfPossible(),this.setMapPaddingTopLeft(),this.addMarkersToMap(),this.isDesktopPlaceBoard()&&(this._lockMapControls(),this.alignHeaderToMap(),this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize))},onPinContentChanged:function(a){var b=a.target;this.isDesktopPlaceBoard()&&this.inMapViewMode&&(b.getPlaceData()?(this.reconfigurePin(b,this.CssClassName.GRID_ROW_LAYOUT),b.focusPlacePin()):(b.unfocusPlacePin(),b.getContent().addClass(this.CssClassName.HIDDEN),this.repositionGrid()))},onResize:function(){if(this.inMapViewMode){var a=this.map.getContent(),b=this.getMapHeightInMapViewMode();a.css("height",b),this.getGrid().updateNavigators(),this.setMapPaddingTopLeft(),this.map.resizeMap()}},onScroll:function(){if(this.isDesktopPlaceBoard()&&!this.inMapViewMode&&!this.inTransition){var a=this.getScrollableElement().scrollTop();if(a<=400){var b=PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW,c=1-a/b,d=.35*a,e=this.map.getContent();e.css({opacity:c,y:d})}}this.extraData.hasRelatedPins&&this.getBoardInfoBar().toggleOtherPinsHeader(this.boardInfoBar.offset().top>this.relatedPinsTitle.offset().top)},getLoggingObjectIdStr:function(){return this.data.id},addPermanentMarkerFromTypeahead:function(a){this.map.clearPlaceholderMarkers(),this.addPermanentMarkerToMap(a),this.hideMapModal()},addPermanentMarkerToMap:function(a){a=a.data,a.highlighted=!0,a.animated=!0,a.placeholder=!1,a=this._generateMapMarkerData(a),this.map.addPermanentMarker(a)},onSetPlaceholderMarkers:function(a){var b=a.data,c=b.markerOptionsList;c=_.compact(c),_.each(c,function(a){a.placeholder=!0,a.highlighted=!1,a.animated=!1});var d=_.map(c,function(a){return this._generateMapMarkerData(a)
}.bind(this));this.map.setPlaceholderMarkers(d,!1)},onHighlightPlaceholderMarker:function(a){var b=a.data.index;this.map.clearPlaceholderHighlights(),this.map.highlightPlaceholderMarker(b)},onClearHighlightedPlaceholderMarkerHighlight:function(){this.map.clearPlaceholderHighlights()},onClearPlaceholderMarkers:function(){this.map.clearPlaceholderMarkers()},_generateMapMarkerData:function(a){var b=a.pin||this.getPinToAddToMap(),c=[a.latitude,a.longitude],d=a.id,e={pin:b,coordinates:c,id:d},f=_.extend(e,a);return f},onRemovedFromDom:function(){P.CONTEXT.is_mobile_agent?this._detachTouchmoveListener():this.isPlaceBoard()&&(this.hideMapModal(),this.map.clearMarkers(),this.getPins().forEach(function(a){a.data&&a.resetShowOnMapButton()}))},_getPinByPinId:function(a){for(var b,c=this.getPins(),d=0,e=c.length;d<e;++d)if(b=c[d],b.data&&b.getId()===a)return b;return null},onMapPopupOpened:function(a){var b=a.data,c=this._getPinByPinId(b);c.scrollIntoView(),this.map.highlightMarkerForPinId(b)},onContentReady:function(){var a={};if(this.map=this.getChildById("map"),this.extraData.show_invite_modal){var b,c=this.extraData.invite_type;switch(c){case"reminder_1":P.Invite.trackInviteFunnelAction("recipient_invite_reminder1_landing",!0),b="user";break;case"reminder_2":P.Invite.trackInviteFunnelAction("recipient_invite_reminder2_landing",!0),b="user";break;case"user":P.Invite.trackInviteFunnelAction("recipient_invite_landing",!0),P.Invite.trackInviteFunnelAction("invite_landing"),b="user";break;default:case"board":P.trackRegisterAction("board_invite_landing"),b="board"}P.modules.InviteModal.showInviteModal(this.options.inviter_user_id,b)}P.currentUser.isAuthenticated()?this.options.board_collab_inviter&&this.showBoardCollaboratorInviterModal():Cookie.set(P.CONST.COOKIE_LAST_UNAUTH_BOARD_ID,this.data.id),this.data.id&&(a={},a[P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR]=this.onBannedUser,a[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,a[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,a[P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED]=this.onBoardWriteAccessUpdated,a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onPinAdded,a[P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED]=this.onBulkPinsAdded,a[P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD]=this.onPrependNewPinMapBoard,a[P.CONST.PUBSUB_TOPIC_PIN_FLAGGED]=this.onPinFlagged,this.pubsubSubscribe(this.data.id,a));var d={};if(d[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,d),this.childListen(P.CONST.EVENT_PIN_UPDATED,this.onChildPinUpdated),this.childListen(P.CONST.EVENT_PIN_DELETED,this.onPinDeleted),this.childListen(P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON,this.resetShowPinOnMapButtonStates),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onChildItemsAddedToGrid),this.map&&(this.childListen(P.CONST.EVENT_PIN_DELETED,this.onPinDeleted),this.childListen(P.CONST.EVENT_MAP_CLICK,this.onMapClick),this.childListen(P.CONST.EVENT_MAP_CLUSTER_CLICK,this.onClusterClick),P.CONTEXT.is_mobile_agent?(this.childListen(P.CONST.EVENT_MAP_POPUP_OPENED,this.onPopupOpened),a={},this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a)):(this.attachHoverListeners(),this.childListen(P.CONST.EVENT_PIN_PLACE_CLICK,this.onPinPlaceClick),this.childListen(P.CONST.EVENT_MAP_POPUP_OPENED,this.onMapPopupOpened),this.childListen(P.CONST.EVENT_PIN_MOUSE_IN,this.onPinMouseIn),this.childListen(P.CONST.EVENT_PIN_MOUSE_OUT,this.onPinMouseOut),this.childListen(P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP,this.onPinAddToMapCachePinId),this.childListen(P.CONST.EVENT_MODAL,this.onPlaceBoardModal))),this.options.show_edit&&(this.extraData.canEdit&&this.showEditModal(),delete this.options.show_edit),this.extraData&&this.extraData.canEdit&&P.experiments.instance.inExperimentGroups("rearrange_pins",["enabled","employees"])&&this._initializePinsRearrangeManagers(),this.isPlaceBoard()&&!this.isDesktopPlaceBoard()&&(this._sticky=new P.Sticky(this.$(".addPinToMapButton"),{$boundTo:this.$el,$scrollable:this.getScrollableElement(),headerHeight:$(".headerBackground").height()})),_.defer(this.addTutorials.bind(this)),this.inBulkEditMode=!1,this.numPinsFlagged=0,this.extraData.hasRelatedPins||this.isDesktopPlaceBoard()){this.relatedPinsTitle=this.$(".relatedPinsTitle"),this.boardInfoBar=this.$(".BoardInfoBar");var e=_.throttle(this.onScroll,16);this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,e)}if(this.isDesktopPlaceBoard()&&(this.inTransition=!1,this.currentlyFocusedPin=null,this._setMapView(!1),this.childListen(P.CONST.EVENT_PIN_CONTENT_CHANGED,this.onPinContentChanged),this.childListen(P.CONST.EVENT_PIN_PLACE_ADDED,this.onPinPlaceAdded),this.childListen(P.CONST.EVENT_ROW_ITEM_DEACTIVATED,this.onRowPlacePinDeactivated),this.childListen(P.CONST.EVENT_SCROLL_GRID_TO_ITEM_END,this.onScrollToGridItemEnd)),!this.data.pin_count&&this._in_web_empty_state()){var f={event_type:P.ContextLogging.EventType.VIEW,view_type:P.ContextLogging.ViewType.EMPTY_STATE,view_parameter:P.ContextLogging.ViewParameterType.BOARD_EMPTY},g=P.ContextEvent.fromPlainObject(f);P.ContextLogger.getInstance().addEvent(g)}},_in_web_empty_state:function(){return P.experiments.instance.inExperimentGroups("web_empty_states",["enabled","employees"])},_initializePinsRearrangeManagers:function(){var a=this,b=this.getGrid();if(b){var c="addPinRep",d=a.getGrid().items.getChildById(c),e={drop:function(b,c){a._onPinRearrangeDroppableDrop(c,$(this))},over:function(b,c){a._onPinRearrangeDroppableOver(c,$(this))},out:function(){a._onPinRearrangeDroppableOut($(this))}};b.setDragState(b.DRAGGING_ENABLED),b.items.initializeDropManager(e),d&&(b.items.disableDraggingForChildModule(d),b.items.disableDroppingForChildModule(d))}},_onPinRearrangeDroppableDrop:function(a,b){var c=a.draggable,d=this.getGrid().items.getChildByElement(c.find(".Pin")),e=this.getGrid().items.getChildByElement(b.find(".Pin"));b.removeClass(this.CssClassName.DROP_PREVIEW),b.transition({paddingLeft:0,easing:ANIMATION_EASING_DISPLACE_PIN,duration:230}),a.helper.hasClass(this.CssClassName.UI_STATE_CONVERSATION)||this.splicePinOrder(d,e)},_onPinRearrangeDroppableOver:function(a,b){a.helper.hasClass(this.CssClassName.UI_STATE_CONVERSATION)||(b.addClass(this.CssClassName.DROP_PREVIEW),b.transition({paddingLeft:25,easing:ANIMATION_EASING_DISPLACE_PIN,duration:230}))},_onPinRearrangeDroppableOut:function(a){a.removeClass(this.CssClassName.DROP_PREVIEW),a.transition({paddingLeft:0,easing:ANIMATION_EASING_DISPLACE_PIN,duration:230})},splicePinOrder:function(a,b){var c="SplicePinResource",d={board_id:this.data.id,source_pin:a.getId(),target_pin:b.getId()},e=P.resourceFactory.create(c,d),f="board_pins_reorder";e.callUpdate().then(function(){P.trackGAEvent(f,P.CONST.GA_ACTION_SUCCESS),this.getGrid().items.reorderChildModule(a,b)}.bind(this),function(){P.trackGAEvent(f,P.CONST.GA_ACTION_ERROR)})},showBoardCollaboratorInviterModal:function(){var a=new P.modules.BoardCollaboratorInviter({options:{},resource:{name:"BoardResource",options:{board_id:this.data.id}}});this.showInModal(a)},toggleBulkEditMode:function(a,b,c){(c===P.CONST.ENTER_BULK_EDIT&&!this.inBulkEditMode||c===P.CONST.EXIT_BULK_EDIT&&this.inBulkEditMode)&&(this.inBulkEditMode=!this.inBulkEditMode,this.getPins().forEach(function(a){a.data&&P.pubsub.publish(a.data.id,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,c)}))},onPlaceBoardModal:function(a){var b=a.data.module;"AddPinToMap"===b.className&&(this.listen(b,P.CONST.EVENT_MODAL_ANIMATE_SHOW_START,this.onAddPinToMapBeginShowing),this.listen(b,P.CONST.EVENT_MODAL_ANIMATE_SHOW_END,this.onAddPinToMapEndShowing),this.listen(b,P.CONST.EVENT_MODAL_ANIMATE_HIDE_START,this.onAddPinToMapBeginHiding),this.listen(b,P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.listen(b,P.CONST.EVENT_CENTER_MAP_GEO_FEATURE,this.onCenterMapGeoFeature),this.listen(b,P.CONST.EVENT_BUTTON_CLICK,this.onModalButtonClick),this.listen(b,P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD,this.addPermanentMarkerFromTypeahead),this.listen(b,P.CONST.EVENT_PLACE_SELECTED,this.onPlaceSelected),this.listen(b,P.CONST.EVENT_SET_PLACEHOLDER_MARKERS,this.onSetPlaceholderMarkers),this.listen(b,P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER,this.onHighlightPlaceholderMarker),this.listen(b,P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,this.onClearHighlightedPlaceholderMarkerHighlight),this.listen(b,P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,this.onClearPlaceholderMarkers),this.listen(b,P.CONST.EVENT_TYPEAHEAD_SEARCH_WORLD,this.onSearchGlobally))},onButtonClick:function(a){var b=a.target;b.id===ID_TOGGLE_VIEW_BUTTON&&this._toggleBoardView()},onModalButtonClick:function(a){var b=a.target;"wrongPlace"===b.id?this._place=null:b.id===ID_ADD_TO_MAP_BUTTON&&this.disablePinsAndButton()},_setMapView:function(a){this.inMapViewMode=a},_toggleBoardView:function(){this._switchBoardViewTo(this.inMapViewMode?"board":"map")},_switchBoardViewTo:function(a){if(!this.inTransition){this.inTransition=!0,this._changeCurrentlyFocusedPin(null);var b,c,d;"map"===a?(d=this.CssClassName.GRID_ROW_LAYOUT,b=this._maximizeMapStartAnimation.bind(this),c=this._maximizeMapEndAnimation.bind(this)):(d=this.CssClassName.GRID_VARIABLE_HEIGHT,b=this._minimizeMapStartAnimation.bind(this),c=this._minimizeMapEndAnimation.bind(this));var e=this;return new Promise(function(f){e.disablePinsAndButton(),e._scrollToTopAndClearMapEffects().then(function(){b().then(function(){e._getToggleViewButton().showLoading(),e.getGrid().hide(),e._switchGridViewTo(d),c().then(function(){e._getToggleViewButton().hideLoading(),e._setMapView("map"===a),e.enablePinsAndButton(),e.inTransition=!1,f(void 0)})})})})}},_scrollToTopAndClearMapEffects:function(){return new Promise(function(a){var b=this.map.getContent(),c=[];c.push(b.transition({opacity:1,y:0,duration:MS_ANIMATION_DURATION_MAP_FAST}));var d=Math.round(this.scrollY/6)+1;c.push(P.scrollToTop({newScrollOffset:0,duration:d})),$.when.apply($,c).done(function(){a(void 0)})}.bind(this))},_switchGridViewTo:function(a){var b=a===this.CssClassName.GRID_ROW_LAYOUT,c=this.getGrid(),d=c.getContent(),e=c.getGridItems(),f=e.getContent();d.toggleClass(this.CssClassName.GRID_ROW_LAYOUT,b),d.toggleClass(this.CssClassName.HAS_FOOTER,!b),f.toggleClass(this.CssClassName.PAD_ITEMS,!b),f.toggleClass(this.CssClassName.CENTERED_WITHIN_WRAPPER,!b),c.show(),this.reconfigurePins(a),this.switchGridLayout(a)},switchGridLayout:function(a){var b=a===this.CssClassName.GRID_ROW_LAYOUT,c=this.getGrid(),d=c.getGridItems(),e=d.$el;e.toggleClass(this.CssClassName.GRID_ROW_LAYOUT,b),e.toggleClass(this.CssClassName.GRID_VARIABLE_HEIGHT,!b),this.$el.addClass(this.CssClassName.POSITION_ADD_PIN_REP),d.switchLayoutManager(a),this.$el.removeClass(this.CssClassName.POSITION_ADD_PIN_REP),b?(c.attachRowSliderScrollListener(),c.increaseRowContainerHeight(100)):(P.currentUser.isAuthenticated()||c.attachScrollListener(),c.resetRowContainerHeight())},reconfigurePins:function(a){this.getPins().forEach(function(b){this.reconfigurePin(b,a)}.bind(this))},reconfigurePin:function(a,b){var c=b===this.CssClassName.GRID_ROW_LAYOUT?!0:!1,d=b===this.CssClassName.GRID_ROW_LAYOUT?"TOP_CENTER":"BOTTOM_CENTER";a.data&&(a.configurePlacePinMode(c),a.updateSendPinDropdownPosition(d))},_maximizeMapStartAnimation:function(){var a=this;return new Promise(function(b){var c=a.map.getContent(),d=a.$(".transformWrapper"),e=P.Viewport.height-c.offset().top;a.map.zoomIntoBounds(),c.css("height",e),a.map.resizeMap(),d.css("y",PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW-e),d.transition({y:a.getBoardTitleHeight(),duration:MS_ANIMATION_DURATION_MAP},function(){a.collapseBoardInfoBar(),a.$el.addClass(a.CssClassName.MAP_VIEW),d.css("top",""),d.css("transform",""),b(void 0)})})},_maximizeMapEndAnimation:function(){var a=this;return new Promise(function(b){var c=a.map.getContent(),d=a.getGrid().getContent(),e=a.getMapHeightInMapViewMode();d.transition({y:-d.height(),easing:ANIMATION_EASING_MAP_EASE_IN_AND_OUT,duration:MS_ANIMATION_DURATION_MAP_FAST},function(){c.css("height",e),a.map.resizeMap(),d.css("transform",""),a._unlockMapControls(),b(void 0)})})},_minimizeMapStartAnimation:function(){var a=this;return new Promise(function(b){var c=a.map.getContent(),d=a.getGrid().getContent(),e=P.Viewport.height-c.offset().top;c.css("height",e),d.css("y",-d.height()),d.transition({y:0,easing:ANIMATION_EASING_MAP_EASE_IN_AND_OUT,duration:MS_ANIMATION_DURATION_MAP},function(){d.css("transform",""),b(void 0)})})},_minimizeMapEndAnimation:function(){var a=this;return new Promise(function(b){var c=a.map.getContent(),d=a.$(".transformWrapper"),e=a.getBoardInfoBar().getContent(),f=a.$(".smallBoardName");a._lockMapControls();var g=[];g.push(f.transition({y:0,easing:ANIMATION_EASING_LINEAR,duration:MS_ANIMATION_DURATION_MAP_FAST})),g.push(e.transition({y:-e.height(),easing:ANIMATION_EASING_LINEAR,duration:MS_ANIMATION_DURATION_MAP_FAST})),$.when.apply($,g).done(function(){a.$el.removeClass(a.CssClassName.MAP_VIEW),e.css("y",0),a.expandBoardInfoBar(),a.map.zoomOutOfBounds(PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW);var f=a.getBoardTitleHeight();d.transition({y:PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW-c.height(),easing:ANIMATION_EASING_MAP_EASE_OUT,duration:MS_ANIMATION_DURATION_MAP},function(){c.css("height",PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW),d.css({transform:"",top:-f}),b(void 0)})})})},collapseBoardInfoBar:function(){this.getBoardInfoBar().setCollapsible(!1),this.getBoardInfoBar().collapse()},expandBoardInfoBar:function(){this.getBoardInfoBar().setCollapsible(!0),this.getBoardInfoBar().expand()},_lockMapControls:function(){this.map.disableMapControls()},_unlockMapControls:function(){this.map.enableMapControls()},onBoardWriteAccessUpdated:function(){this.renderHeader()},getMapHeightInMapViewMode:function(){var a=this.map.getContent(),b=P.Viewport.height-a.offset().top,c=b-PLACE_BOARD_V2_BOARD_HEIGHT_IN_MAP_VIEW;return c},_removePinFromMap:function(a){if(this.map){var b=a.getId();this.map.removeMarkerForPinId(b)}},onPinDeleted:function(a){if(P.CONTEXT.is_mobile_agent||this.renderHeader(),this.map){var b=a.data;this.isDesktopPlaceBoard()&&this.inMapViewMode&&(b.getContent().addClass(this.CssClassName.HIDDEN),this.repositionGrid()),this._removePinFromMap(b)}},onCenterMapGeoFeature:function(a){var b=a.data,c=this.map.getCityBoundsFromCenter(b);this.map.fitBounds(c)},onPinFlagged:function(){this.numPinsFlagged+=1},getNumPinsFlagged:function(){return this.numPinsFlagged},onSearchGlobally:function(){this._searchingGlobally=!0,this.map.fitWorld()},onCitySelected:function(a){var b=a.data;this._city=b;var c,d;b.bounds?d=b.bounds:c=b.latLng,d||(d=this.getCityBoundsFromCenter(c)),this.map.fitBounds(d)},makeLatLngBoundsFromLatLngAndPadding:function(a,b){var c=L.latLng(a.lat-b,a.lng-b),d=L.latLng(a.lat+b,a.lng+b);return L.latLngBounds(c,d)},getCityBoundsFromCenter:function(a){var b=.05;return this.makeLatLngBoundsFromLatLngAndPadding(a,b)},onTypeaheadNoResultsReturned:function(){this.map&&this.map.clearPlaceholderMarkers()},onPlaceSelected:function(a){var b=a.data.index;this.map.showOnlyPlaceholderMarkerAtIndex(b),this._place=a.data},onPlaceholderMarkerOpened:function(a){var b=a.data.place_id,c=a.data.index,d=this.data.id;P.pubsub.publish(d,P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED,{place_id:b}),this.map.highlightPlaceholderMarker(c)},disablePinsAndButton:function(){this._setPinsAndButtonEnabled(!1)},enablePinsAndButton:function(){this._setPinsAndButtonEnabled(!0)},_setPinsAndButtonEnabled:function(a){var b,c=this.$(".locationBoardPageContentWrapper, .locationBoardContentWrapperBackground, .addAPlace"),d=this.map.getAttributionElement(),e=P.app._getScrollToTopModule();e&&(b=e.$el),c=c.add(d),e&&(b.length&&(c=c.add(b)),c.toggleClass(this.CssClassName.FADE,!a))},toggleMapControlButtonsFade:function(){this.getMapControlButtons().fadeToggle(MS_ANIMATION_DURATION_MAP_FAST)},setMapPaddingTopLeft:function(){var a,b;if(P.CONTEXT.is_mobile_agent){var c=P.app.getHeader();if(!c)return;a=c.getHeight()+P.CONST.PIN_MARGIN/2,b=L.point(0,a),this.map.setPaddingTopLeft(b)}else if(this.isDesktopPlaceBoard()&&!this.inMapViewMode)b=L.point(0,100);else{var d,e=this._getAddToMapButton();this.isDesktopPlaceBoard()||e||(d=this.getGrid());var f=d||e;if(!f)return;var g=f.getOffset(),h=f.getPosition(),i=f.getWidth()+g.left+h.left;a=100,b=L.point(i,a),this.map.setPaddingTopLeft(b)}},hideMapModal:function(){P.getModalManager().removeTopModal()},alignHeaderToMap:function(){var a=this.$(".transformWrapper"),b=this.getBoardTitleHeight();a.css("top",-b)},_onPrependedToMapBoard:function(){var a=this.getPins()[0];a.data||(a=this.getPins()[1]);var b=this._markerToPrepend;b.pin=a,this.addPermanentMarkerFromTypeahead({data:b}),this.isDesktopPlaceBoard()&&this.inMapViewMode&&this.reconfigurePin(a,this.CssClassName.GRID_ROW_LAYOUT)},onPrependNewPinMapBoard:function(a,b,c){var d=this.getGrid();this._markerToPrepend=c,this.hideMapModal(),d.prependNewItems(1,this._onPrependedToMapBoard),this.renderHeader()},onPinMouseOut:function(a){var b=a.data;this.currentlyFocusedPin&&this.currentlyFocusedPin.getId()===b||this.map.unHighlightMarkerForPinId(b)},onPinMouseIn:function(a){var b=a.data;this.map.highlightMarkerForPinId(b)},onPinPlaceClick:function(a){var b=a.data;this.isDesktopPlaceBoard()?this.inMapViewMode?this._changeCurrentlyFocusedPin(b):this._switchBoardViewTo("map").then(function(){this._changeCurrentlyFocusedPin(b)}.bind(this)):(this.map.highlightMarkerForPinId(b),this.map.openPopupForPin(b))},onPinPlaceAdded:function(a){if(this.inMapViewMode)this.onPinPlaceClick(a);else{var b=a.data;this.map.highlightMarkerForPinId(b),P.setTimeout(function(){this.map.unHighlightMarkerForPinId(b)}.bind(this),TIME_UNTIL_MARKER_UNHIGHLIGHTS_SELF)}},repositionGrid:function(){this.getGrid().getGridItems().positionGrid()},_changeCurrentlyFocusedPin:function(a){var b=this._getPinByPinId(a);if(this.currentlyFocusedPin!==b){var c=this.currentlyFocusedPin;if(c){var d=c.getId();c.unfocusPlacePin(),this.map.unHighlightMarkerForPinId(d)}b&&(this.getGrid().scrollToItem(b),this.map.zoomToAndHighlightMarkerForPinId(a)),this.currentlyFocusedPin=b}},onScrollToGridItemEnd:function(a){var b=a.data;b.focusPlacePin()},onAddPinToMapBeginShowing:function(a){var b=a.target;this.configureAddPinToMapModal(b),this.disablePinsAndButton(),this.map.toggleTranslucentMarkers(!0),this.detachHoverListeners(),this.map.closeAllMarkerPopups(),this.attachHoverListeners(),this.isDesktopPlaceBoard()&&(this._changeCurrentlyFocusedPin(null),this._scrollToTopAndClearMapEffects().then(function(){var a=this.$(".transformWrapper"),b=this.map.getContent(),c=this.getGrid().getContent(),d=P.Viewport.height-b.offset().top;b.css("height",d),this.map.resizeMap(),this.inMapViewMode?c.css("y",-PLACE_BOARD_V2_BOARD_HEIGHT_IN_MAP_VIEW):a.css("y",PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW-d),this.toggleMapControlButtonsFade(),a.addClass(this.CssClassName.FADE),P.setTimeout(function(){this.setMapPaddingTopLeft()}.bind(this),200)}.bind(this)))},configureAddPinToMapModal:function(a){a.center=this.map.getZoom()>=8?this.map.getCenter():null},onRowPlacePinDeactivated:function(){this._changeCurrentlyFocusedPin(null)},onAddPinToMapEndShowing:function(a){var b=a.target;b.focus(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},onAddPinToMapBeginHiding:function(a){if(!this.inTransition){var b=a.target;if(this.isDesktopPlaceBoard()||this.enablePinsAndButton(),this.setPinToAddToMap(null),this.ensureModalChildDropdownsHidden(b),this.map.clearPlaceholderMarkers(),this.detachHoverListeners(),this.map.toggleTranslucentMarkers(!1),this.attachHoverListeners(),this.isDesktopPlaceBoard()){var c=this.$(".transformWrapper"),d=this.map.getContent(),e=this.getGrid().getContent();this.toggleMapControlButtonsFade(),c.removeClass(this.CssClassName.FADE),P.setTimeout(function(){this.setMapPaddingTopLeft();var a=this.inMapViewMode?this.getMapHeightInMapViewMode():PLACE_BOARD_V2_MAP_HEIGHT_IN_BOARD_VIEW;d.css("height",a),this.inMapViewMode?e.css("transform","none"):c.css("transform","none"),this.enablePinsAndButton()}.bind(this),200)}}},ensureModalChildDropdownsHidden:function(a){a.hideChildDropdowns()},onPinAddToMapCachePinId:function(a){var b=a&&a.data;this.setPinToAddToMap(b)},getPinToAddToMap:function(){return this._pinToAddToMap},setPinToAddToMap:function(a){this._pinToAddToMap=a},_getPinsWithCoordinates:function(){var a=[];return this.map&&this.getPins().forEach(function(b){if(b.data){var c=b.getCoordinates&&b.getCoordinates();c&&a.push(b)}}),a},detachHoverListeners:function(){this.map&&this._toggleHoverListeners(!1)},_toggleHoverListeners:function(a){var b=this._getPinsWithCoordinates();_.each(b,function(b){var c=b.getCoordinates&&b.getCoordinates();if(c){var d=a?P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER:P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER;b.trigger(d)}})},attachHoverListeners:function(){this.map&&this._toggleHoverListeners(!0)},onRendered:function(){this.isPlaceBoard()&&this.attachHoverListeners(),P.Module.prototype.onRendered()},resetShowPinOnMapButtonStates:function(){this.isDesktopPlaceBoard()?this._changeCurrentlyFocusedPin(null):this.getPins().forEach(function(a){a.data&&a.resetShowOnMapButton()})},onChildItemsAddedToGrid:function(){this.map&&(this.attachHoverListeners(),this.updatePinsOnMap()),this.inBulkEditMode&&this.getPins().forEach(function(a){a.data&&P.pubsub.publish(a.data.id,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.ENTER_BULK_EDIT)}),this.inMapViewMode&&(this.reconfigurePins(this.CssClassName.GRID_ROW_LAYOUT),this.repositionGrid())},updatePinsOnMap:function(){var a=this._pinCount,b=this.getPins();if(!b)return void(this._pinCount=0);var c=b.length,d=c-a-1;d&&(b=b.slice(a),this.map.addMarkersToMap(b,!0),this._pinCount=c)},onBoardUpdated:function(a,b,c){var d=!1;if(c.url!==this.data.url&&this.inDom)this.data.url=c.url,this.navigate(c.url);else{for(var e=0;e<HEADER_DATA_KEYS.length;e++){var f=c[HEADER_DATA_KEYS[e]];"undefined"!==typeof f&&this.data[HEADER_DATA_KEYS[e]]!==f&&(d=!0,this.data[HEADER_DATA_KEYS[e]]=f)}d&&this.renderHeader()}c.layout!==this.data.layout&&(this.data.layout=c.layout,c.url===this.data.url?window.location.reload():this.navigate(c.url,this,!0))},onPinAdded:function(){var a=this.getGrid();a.prependNewItems(1),this.renderHeader(),this.map&&(this.addMarkersToMap(),P.CONTEXT.is_mobile_agent||(this.detachHoverListeners(),this.attachHoverListeners()),this.isDesktopPlaceBoard()&&this.inMapViewMode&&(this.reconfigurePins(this.CssClassName.GRID_ROW_LAYOUT),this.repositionGrid(),this.getGrid().updateNavigators()))},onBulkPinsAdded:function(){var a=this.getGrid();a.render().then(function(){_.defer(function(){this.isDesktopPlaceBoard()&&this.inMapViewMode&&this._switchGridViewTo(this.CssClassName.GRID_ROW_LAYOUT)}.bind(this))}.bind(this))},onBannedUser:function(){this.renderHeader();var a=this.getGrid();a.render()},onBoardDeleted:function(){this.inDom&&this.navigateToUserPage()},navigateToUserPage:function(){var a=this.extraData&&this.extraData.currentUsername,b="/",c=a?b+a+"/":b;this.navigate(c)},getHeader:function(){return this.getChildById("boardHeader")},renderHeader:function(){var a=this.getHeader();this.isDesktopPlaceBoard()&&this.inMapViewMode||a.render().then(function(){this.isDesktopPlaceBoard()&&!this.inMapViewMode&&_.defer(function(){this.alignHeaderToMap()}.bind(this))}.bind(this))},showEditModal:function(){var a=this.getHeader();return a.showEditModal()},onChildPinUpdated:function(a){var b=a.data,c=b.board.id,d=b.place,e=a.target,f=b.id;if(c!==this.data.id)return e.destroy(),void this._removePinFromMap(e);if(!d)return void this._removePinFromMap(e);if(this.map){var g=this.map.getMarkerForPin(f);if(g){var h=g.getLatLng(),i=h.lat,j=h.lng,k=d.latitude,l=d.longitude;if(l!==j||k!==i){this.map.removeMarkerForPinId(f);var m={data:d};m.data.pin=e,this.addPermanentMarkerFromTypeahead(m)}}else{var n={data:d};n.data.pin=e,this.addPermanentMarkerToMap(n)}}},onBoardRemovedSelf:function(){this.data.privacy===P.CONST.BOARD_PRIVACY_SECRET&&this.inDom?this.navigateToUserPage():this.renderHeader()},onClick:function(a){if(P.CONTEXT.is_mobile_agent){var b=!this.$el.hasClass(this.CssClassName.MAP_HIDE);if(!b)return;if(!this.map)return;var c=a.target,d=$(this.map.$el).has(c);d.length||(this.hidePlaceBoardNub(),P.setTimeout(function(){this.$el.addClass(this.CssClassName.MAP_HIDE).removeClass(this.CssClassName.MAP_SHOW).css(CSS_PADDING_TOP,""),P.setTimeout(function(){this.map.closeAllMarkerPopups(),this.map.fitViewToPinMarkers(),this._detachTouchmoveListener()}.bind(this),MAP_ANIMATION_DURATION_MS)}.bind(this),250))}},showPlaceBoardNub:function(){this._getNub().addClass(this.CssClassName.NUB_VISIBLE)},hidePlaceBoardNub:function(){this._getNub().removeClass(this.CssClassName.NUB_VISIBLE)},_getNub:function(){return this.$(".mapUnfocusNub")},onMapClick:function(){P.CONTEXT.is_mobile_agent?this._focusMap(!0):this.isDesktopPlaceBoard()&&(this.inMapViewMode?this._changeCurrentlyFocusedPin(null):this._switchBoardViewTo("map"))},_getPlaceBoardFocusPaddingTop:function(){var a=this.getChildById("boardHeader"),b=a.getOffset(),c=$(window).height(),d=c-b.top,e=this.getChildById("boardInvites");e&&(d+=e.getHeight(!0));var f=this.getScrollableElement().scrollTop();return d+=f},_focusMap:function(a){var b=!this.$el.hasClass(this.CssClassName.MAP_SHOW);if(b){var c=this._getPlaceBoardFocusPaddingTop(),d=parseInt(this.$el.css(CSS_PADDING_TOP),10);c=d+c+"px",this.$el.addClass(this.CssClassName.MAP_SHOW).removeClass(this.CssClassName.MAP_HIDE).css(CSS_PADDING_TOP,c),P.setTimeout(function(){a&&this.map.zoomIn(),this._attachTouchmoveListener(),this.showPlaceBoardNub()}.bind(this),MAP_ANIMATION_DURATION_MS)}},onPopupOpened:function(){this._focusMap(!1)},onClusterClick:function(){P.CONTEXT.is_mobile_agent?this._focusMap(!0):this.isDesktopPlaceBoard()&&!this.inMapViewMode&&this._switchBoardViewTo("map")},_attachTouchmoveListener:function(){$(document).on(SCOPED_TOUCH_EVENT,function(a){a.preventDefault()})},_detachTouchmoveListener:function(){$(document).off(SCOPED_TOUCH_EVENT)}}),goog.provide("P.modules.Closeup"),goog.require("P.Module"),goog.require("P.modules.CloseupBottom"),goog.require("P.modules.CloseupContent"),goog.require("P.modules.CloseupSidebar"),goog.require("P.modules.Pin"),goog.require("P.modules.PinActionBar"),goog.require("P.SourceContentManager");var MODULE_ID_ACTION_BAR="actions",MODULE_ID_CONTENT="content",MODULE_ID_SIDEBAR="sidebar",MODULE_ID_BOTTOM="bottom",SELECTOR_CLOSEUP_ACTION_BAR=".closeupActionBarContainer",FIXED_IMAGE_WIDTH=736,ACTIONBAR_HEIGHT=57,DEFAULT_PADDING=40,PIN_MARGIN=14,CLOSEUP_GRID_PIN_WIDTH=250;P.modules.Closeup=P.Module.extend({events:{click:"_onClick","click button.close":"onCloseButtonClick","click div.arrow-nav":"onNavArrowClick"},CssClassName:{CAN_CLOSE:"canClose",CLOSE_BUTTON_VISIBLE:"visible",LITE:"lite",LITE_WITH_RELATED_PINS:"liteWithRelatedPins",RELATED_PINS:"relatedPinsFlow"},onVisualSearchObjectSelected:function(a){var b=this.getChildById(MODULE_ID_SIDEBAR);if(b){var c=this.resource.options.id,d=a.data;b.updateVisuallySimilar({pinId:c,objId:d})}return!1},getOwnedScrollables:function(){return this.options.can_close?this.$el:$()},onCreated:function(){this.closeDiv=$('<button class="Button borderless close"><em></em>&nbsp;</button>')},onKeydown:function(a){var b=P.getModalManager();b.hasModals()||(this.options.can_close&&a.keyCode===P.keyCode.ESCAPE&&this._close(),a.keyCode!==P.keyCode.RIGHT&&a.keyCode!==P.keyCode.LEFT||this.navigateStarted||this._shouldRenderAsLite()?a.keyCode===P.keyCode.ENTER&&this._actionBar&&!this._actionBar.areDropdownsShowing()&&(this._logCustomContextEvent(P.ContextLogging.EventType.KEYPRESS,P.ContextLogging.ElementType.CLOSEUP_PINIT_SHORTCUT,P.ContextLogging.ComponentType.CLOSEUP_SHORTCUT_BUTTON,{}),this._actionBar.triggerPinItButton()):(this._logCustomContextEvent(P.ContextLogging.EventType.KEYPRESS,a.keyCode===P.keyCode.RIGHT?P.ContextLogging.ElementType.NEXT_CLOSEUP_BUTTON:P.ContextLogging.ElementType.PREV_CLOSEUP_BUTTON,P.ContextLogging.ComponentType.CLOSEUP_NAV_BUTTON,{}),this.triggerCloseupNav(a.keyCode)))},triggerCloseupNav:function(a){this.sourceContentManager||this.setSourceContentManager(),this.navigateStarted=!0,this.sourceContentManager.setItemByKeyPress(a),this._removeTransitionImage(),this.clearBottomRenderInterval()},setNewCloseupPin:function(a){var b=this.getChildById(MODULE_ID_CONTENT);a&&b?b.changeCloseupContent(a):this._close()},setSourceContentManager:function(){this.sourceContentManager=this.options.source_data&&this.resource.options.id?new P.SourceContentManager(this.resource.options.id,this.options.source_data,this.setNewCloseupPin.bind(this)):null},_close:function(){this._removeTransitionImage(),delete this.options.source_data,this.options.origin_location?this.navigate(this.options.origin_location):this.triggerEvent(P.CONST.EVENT_CLOSE,this,!0)},_unsticky:function(){this._actionBar&&this._actionBar.unsticky()},_updateSticky:function(){if(this.parent&&this.inDom&&this._actionBar){var a=this.$(".pinActionBarStickyContainer"),b=this.getScrollableElement(),c=0;this.options.can_close||P.CONTEXT.is_mobile_agent||(c=$(".headerBackground").height()),this._actionBar.updateSticky({$boundTo:a,$scrollable:b,headerHeight:c})}},resetCloseButton:function(){this.$close.removeClass(this.CssClassName.CLOSE_BUTTON_VISIBLE)},setupCropper:function(){var a=this;P.VersionedFileLoader.instance.loadScript("webapp/js/app/common/bundle-jcrop.js",function(){$(".visualLiveSearchOverlayOuterWrapper").show();var b=$(".imageContainer .Image");return $(".visualLiveSearchOverlay").Jcrop({keySupport:!1,setSelect:[50+parseInt(b.css("margin-left"),10),50,b.width()+parseInt(b.css("margin-left"),10)-50,b.height()-50],onSelect:function(c){var d=b.width(),e=b.height(),f=parseInt(b.css("margin-left"),10),g=parseInt(b.css("padding-top"),10),h=Math.max(c.x-f,0),i=Math.min(c.x2-f,d),j=Math.max(c.y-g,0),k=Math.min(c.y2-g,e),l={x:h/d,y:j/e,w:(i-h)/d,h:(k-j)/e},m=a.getChildById(MODULE_ID_SIDEBAR);if(m){var n=a.resource.options.id;m.updateLiveVisualSearch({pinId:n,crop:l})}}}),$(".jcrop-holder").css({"background-color":""}),!1})},onAddedToDom:function(){if(this.hasError)return this.detachElement(),void this.destroy();this._positionActionBar(),this.options.can_close&&$("body").on("keydown.closeup",function(a){this.onKeydown(a)}.bind(this)),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_SELECTED,this.onVisualSearchObjectSelected),this.childListen(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_CROP_BUTTON_PRESSED,this.setupCropper);var a=P.scrollbarWidth();this.$close||(this.$close=this.$(".close")),this.$close.css("right",a+PIN_MARGIN+"px").addClass(this.CssClassName.CLOSE_BUTTON_VISIBLE)},_positionActionBar:function(){this._actionBar&&this.inDom&&this.contentReady&&this._updateSticky()},onContentReady:function(){this._actionBar=this.getChildById(MODULE_ID_ACTION_BAR),this.options.show_repin?(this.showRepinModal(),delete this.options.show_repin):this.options.show_edit&&(this.extraData.canEdit&&this.showEditModal(),delete this.options.show_edit),this._positionActionBar(),this.extraData&&this.extraData.showContextualReg&&P.UserRegistration.showSignupModal("CloseupSignupModal",this.resource,{sent_pin:!0,sender:this.options.sender,redirect_to_signup:!0}),this._sourceData={};var a=this.getChildById(MODULE_ID_CONTENT);a&&_.defer(a.addTutorials.bind(a));var b={};b[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,b[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN]=this.onPinHidden,this.pubsubSubscribe(this.resource.options.id,b),this.listen(P.router.get(),P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched)},onPinDeleted:function(){this.options.can_close?this._close():(this.destroy(),this.navigate("/"))},onPinHidden:function(){this.options.can_close&&this._close()
},_removeTransitionImage:function(){this.transitionPinImage&&(this.transitionPinImage.remove(),this.transitionPinImage=null)},removeTransitionImageOnLoad:function(a){var b=a.getPin(),c=b.getPinMedia(),d=c.attr("src");c.load(this._removeTransitionImage.bind(this)),c.error(this._removeTransitionImage.bind(this)),c.attr("src",d),c[0]&&c[0].complete&&this._removeTransitionImage()},onRemovedFromDom:function(){this._actionBar&&this._actionBar.removeDropdowns(),this._unsticky(),this.options.can_close&&$("body").off("keydown.closeup"),this._removeListeners()},_shouldRenderAsLite:function(){var a=P.ExperienceManager.instance().getPlacedExperience(P.Experiences.Placement.WEB_PIN_CLOSEUP);return a&&(a.experience_id===P.Experiences.Experience.WEB_PIN_CLOSEUP_LITE||a.display_data&&a.display_data.lite)},isPinInSourceData:function(){var a=this.resource.options.id,b=this.options.source_data;if(!b||!b.data)return!1;for(var c=0;c<b.data.length;c++)if(b.data[c]&&"pin"===b.data[c].type&&b.data[c].id===a)return!0;return!1},render:function(){if(!this.options.can_close)try{return P.Module.prototype.render.apply(this,arguments)}catch(a){throw console.error(a),a}this._shouldShowRelatedPinCloseup()&&this.$el.addClass(this.CssClassName.RELATED_PINS),this.$el.empty().addClass(this.CssClassName.CAN_CLOSE);var b=this._shouldRenderAsLite(),c=!1;b&&(c=P.experiments.instance.inExperimentGroups("show_related_pins_to_first_pinners",["employee","enabled"]),this.$el.addClass(c?this.CssClassName.LITE_WITH_RELATED_PINS:this.CssClassName.LITE)),this.$el.append(this.closeDiv),this.$el.append('<div class="closeupActionBarContainer" data-component-type="'+P.ContextLogging.ComponentType.MODAL_PIN+'"></div><div class="closeupContainer"></div><div class="closeupBottom"></div>');var d=!!this.transitionPinImage;d&&this.$el.append(this.transitionPinImage);var e=P.resourceFactory.clone(this.resource);e.options.allow_stale=!0;var f=this.resource.options.id,g=P.resourceFactory.clone(this.resource);g.options.field_set_key="detailed";var h=this.isPinInSourceData(),i=new P.modules.CloseupContent({id:MODULE_ID_CONTENT,resource:g,options:{show_comments:this.options.show_comments,has_source_data:h}}),j=this.$(SELECTOR_CLOSEUP_ACTION_BAR),k=new P.modules.PinActionBar({id:MODULE_ID_ACTION_BAR,options:{pin_id:f},resource:e});k.errorStrategy=P.CONST.ErrorStrategy.BUBBLE,k.render(),this._actionBar=k,this.insertChild(k,j);var l=this.$(".closeupContainer"),m=P.resourceFactory.clone(this.resource);m.options.field_set_key="closeup_sidebar";var n=new P.modules.CloseupSidebar({id:MODULE_ID_SIDEBAR,resource:m,options:{force_render_remote:!0}});n.render().then(function(){this.insertChild(n,l)}.bind(this));var o=i.render().then(function(){this.insertChild(i,l),d&&this.removeTransitionImageOnLoad(i),this.contentReady=!0,this.onContentReady();var a=c?"firstPinnerRelatedPinsOnly":null,e=new P.modules.CloseupBottom({id:MODULE_ID_BOTTOM,options:{pin_id:this.resource.options.id,view_type:a}});if(!b||c){var f=this.$(".closeupBottom");e.render().then(function(){this.insertChild(e,f)}.bind(this))}P.dom.blur()}.bind(this));return d?Promise.resolve(void 0):o},handleError:function(a){a.api_error_code===P.CONST.API_ERROR_PIN_NOT_FOUND&&(this.hasError=!0),P.Module.prototype.handleError.call(this,a)},setCloseupBottomMinHeight:function(){var a=this.$(".closeupContainer").height(),b=this.getScrollableElement().scrollTop(),c=this.getChildById(MODULE_ID_BOTTOM);if(c){var d=P.Viewport.height,e=b+d-a;c.setMinHeight(e)}},removeCloseupBottomMinHeight:function(){var a=this.getChildById(MODULE_ID_BOTTOM);a&&a.setMinHeight(null)},showRepinModal:function(){this._actionBar&&P.currentUser.isAuthenticated()&&this._actionBar.showRepinModal()},showEditModal:function(){var a=this.getChildById(MODULE_ID_CONTENT);return a.showEditModal()},setAsMainModule:function(a,b,c){var d=this.getChildById(MODULE_ID_CONTENT),e=this.getChildById(MODULE_ID_SIDEBAR),f=this.getChildById(MODULE_ID_BOTTOM),g=b.options.id;if(!d||!e||!f)return c.evt.data.pinId=g,P.Module.prototype.setAsMainModule.apply(this,arguments);if(a.can_close?0===this.closeDiv.parent().length&&(this.$el.prepend(this.closeDiv),this.$el.addClass(this.CssClassName.CAN_CLOSE)):this.closeDiv.parent().length>0&&(this.closeDiv.remove(),this.$el.removeClass(this.CssClassName.CAN_CLOSE)),this.options.can_close=a.can_close,this.hasSameOptions(a,b)&&this.contentReady&&!this._forceRefreshRequested(c))return Promise.resolve(void 0);this.setOptions(a),this.setResource(b);var h=this.sourceContentManager&&this.sourceContentManager.getCurrentPinData();h?(h.id!==g&&(this.sourceContentManager.setupSourceContentManager(this.options.source_data,g),h=this.sourceContentManager.getCurrentPinData()),this.transitionPinImage=this._getCloseupTransitionPinImage(),this.transitionPinImage&&(this.$el.append(this.transitionPinImage),d.emptyCloseupImage(this.transitionPinImage[0].style.height,h))):c.evt&&c.evt.currentTarget&&"Closeup"===c.evt.currentTarget.className||d.empty();var i={name:b.name,options:_.extend({},b.options)},j=P.resourceFactory.clone(this.resource);j.options.allow_stale=!0;var k=new P.modules.PinActionBar({id:MODULE_ID_ACTION_BAR,options:{pin_id:g},resource:j});return i.options.field_set_key="detailed",d.setResource(i),h&&h.promoter?(d.options.show_promoted_pin_credit_detailed=!0,d.options.promoter_detailed_view=h.promoter):d.options.show_promoted_pin_credit_detailed=!1,this.transitionPinImage&&(d.options.spinner={enable:!1}),this.setCloseupBottomMinHeight(),k.render(),h&&e.updateBoardGrid(h.board,g),d.render().then(function(){var a=this.$(SELECTOR_CLOSEUP_ACTION_BAR);this.insertChild(k,a),this._actionBar&&this._actionBar.destroy(),this._actionBar=k,this._positionActionBar(),this.removeTransitionImageOnLoad(d),f.setOptions({pin_id:g}),this.bottomRenderInterval=window.setInterval(function(){f.render().then(function(){this.removeCloseupBottomMinHeight()}.bind(this)),this.clearBottomRenderInterval()}.bind(this),1e3),this.navigateStarted=!1,P.dom.blur(),h&&e.updateBoardDetails(d.data.board),e.updateDomain(d.data.link?d.data.domain:null),e.updateRelatedRecipes(d.data.rich_recipe_top_ingredients)}.bind(this))},onRouteMatched:function(a){if(!a.navigateData.fromNavigate){this._sourceData[this.resource.options.id]=this.options.source_data;var b=a.resource&&a.resource.options&&a.resource.options.id,c=this._sourceData[b];c&&(this.updateOptions({source_data:c}),this.sourceContentManager.setupSourceContentManager(this.options.source_data,b))}},onChildNavigate:function(a){if(P.NuxUtils.preventNavigationIfNecessary(a),this.log.debug("Closeup got navigate event from child",a.target,"for url:",a.data.url),!P.isOffsiteUrl(a.data.url)){var b=this.getChildById(MODULE_ID_SIDEBAR),c=a.target.data&&a.target.data.id;if(b===a.currentTarget&&"Pin"===a.target.className||"CloseupContent"===a.target.className&&this.navigateStarted){if(a.target.$el.closest(".CloseupRelatedPins").length>0)return;if(a.data.handled=!0,"boardPinsGrid"===a.target.options.view_type){b.updateVisuallySimilar(null);var d=b.data&&b.data.board&&b.data.board.id;c&&d&&this.sourceContentManager&&this.sourceContentManager.setupResource(P.resourceFactory.create("BoardFeedResource",{board_id:d}),c)}}else if(a.target.$el.closest(".CloseupRelatedPins").length>0){var e=this.getChildById(MODULE_ID_BOTTOM),f=a.data.url;if(!e||-1===f.indexOf("/pin/")||-1!==f.indexOf("/repins/")||-1!==f.indexOf("/likes/"))return;a.data.handled=!0,this._sourceData[this.resource.options.id]=this.options.source_data,this.updateOptions({source_data:e.getChildInfoByModuleName("GridItems")}),this.sourceContentManager&&this.sourceContentManager.setupSourceContentManager(this.options.source_data,c)}return!1}},onNavArrowClick:function(a){var b=a.target;b&&(b.classList.contains("right-arrow")?this.triggerCloseupNav(P.keyCode.RIGHT):b.classList.contains("left-arrow")&&this.triggerCloseupNav(P.keyCode.LEFT))},onCloseButtonClick:function(){return this._close(),this.resetCloseButton(),!1},_onClick:function(a){if(this.options.can_close){var b=a.target;(b&&(b===this.$el[0]||b===this.$(".closeupContainer")[0])||b===this.$(".closeupBottom")[0])&&(a.stopPropagation(),this._close())}},performTransition:function(a){var b=a.evt&&a.evt.target||null,c=a.evt&&a.evt.currentTarget||null;return b&&"Pin"===b.className&&"summary"===b._getViewType()&&"Closeup"!==c.className&&(this.transitionPinImage=this._getTransitionPinImage(b)),this.render()},calculateTransitionCSS:function(a,b){var c,d=a.height,e=a.width;if(e<FIXED_IMAGE_WIDTH){var f=Math.round((FIXED_IMAGE_WIDTH-e)/2);c=f<DEFAULT_PADDING?f+ACTIONBAR_HEIGHT:DEFAULT_PADDING+ACTIONBAR_HEIGHT}else c=ACTIONBAR_HEIGHT;var g=2*PIN_MARGIN,h=P.CONTEXT.is_tablet_agent?P.Viewport.width:1e3,i=(P.Viewport.width-h+PIN_MARGIN)/2,j=(FIXED_IMAGE_WIDTH-e)/2;this._shouldShowRelatedPinCloseup()&&(i=(P.Viewport.width-P.Viewport.numColumns*CLOSEUP_GRID_PIN_WIDTH)/2);var k={linkImageCSS:{height:d,padding:c+"px "+j+"px"+(c-ACTIONBAR_HEIGHT)+"px",left:this._shouldRenderAsLite()?"50%":i,top:g},imageCSS:{height:d,width:e}};return b&&(k.linkImageCSS.padding=ACTIONBAR_HEIGHT+"px 0px 0px"),k},_getTransitionPinImage:function(a){var b=a.getPinMedia();if(!b)return null;var c=b.clone(),d=a.getSourceUrl()||a.getImageUrl(P.CONST.IMAGE_SIZE_ORIG),e=$("<a class='transitionImage'></a>").append(c);if(e[0].onclick=function(){this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.PIN_CLOSEUP_TRANSITION_IMAGE,P.ContextLogging.ComponentType.PIN_CLOSEUP_TRANSITION_IMAGE,{}),this.navigate(d,null,!1,{pinId:a.getId()})}.bind(this),c.length&&(c[0].onload=null),a.isPinStory())return null;var f=this.calculateTransitionCSS(P.ImageDimensions.getDetailedImageDimensions(a.data),a.isVideo()&&a.data.attribution);return e.css(f.linkImageCSS),c.css(f.imageCSS),e},_getCloseupTransitionPinImage:function(){var a=this.sourceContentManager&&this.sourceContentManager.getCurrentPinData();if(!a)return null;var b=document.createElement("img");b.src=a.images["236x"].url,b.className="pinImg fullBleed noFade",b.alt=a.title,b.onload=null;var c=document.createElement("a");c.className="transitionImage",c.onclick=function(){this.navigate(a.link,null,!1,{pinId:a.id})}.bind(this),c.appendChild(b);var d=this.calculateTransitionCSS(P.ImageDimensions.getDetailedImageDimensions(a),a.is_video&&a.attribution);return a.embed&&"pinstory"===a.embed.subtype?null:($(c).css(d.linkImageCSS),d.imageCSS.background=a.dominant_color||"#f8f8f8",$(b).css(d.imageCSS),$(c))},getPin:function(){return this.getChildById(MODULE_ID_CONTENT).getPin()},getLoggingObjectIdStr:function(){return this.resource.options.id},_shouldShowRelatedPinCloseup:function(){var a=P.experiments.instance.inExperimentGroups("related_pins_closeup_grid_2_unauth",["employees","enabled"]);return a&&!this._shouldRenderAsLite()},clearBottomRenderInterval:function(){window.clearInterval(this.bottomRenderInterval),this.bottomRenderInterval=null}}),goog.provide("P.modules.Header"),goog.require("P.modules.HeaderBase"),goog.require("P.modules.SearchForm"),goog.require("P.router"),P.modules.Header=P.modules.HeaderBase.extend({events:{"click .menuContainer":"toggleSlideout","click .closeMenu":"toggleSlideout","click .openInApp":"openInApp","click .circleLogo":"redirectToHomePage"},CssClassName:_.extend(P.modules.HeaderBase.prototype.CssClassName,{OPEN:"open"}),onContentReady:function(){P.modules.HeaderBase.prototype.onContentReady.call(this);var a={};this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.listen(P.router.get(),P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched)},onRouteMatched:function(a){var b=a.navigateData.currentModule||{},c=["SearchPage","Closeup"];if(!_.contains(c,a.module)&&_.contains(c,b.className)){var d=this.getChildById("mainSearchTextbox");d.clearTypeaheadField()}},getHeight:function(){return this.$(".headerBackground").height()},getUserMenu:function(){return this.getChildById("userMenu")},getHomeElement:function(){return this.$(".logo")},toggleSlideout:function(){this.$(".menuOverlay").toggleClass(this.CssClassName.OPEN)},openInApp:function(){this.triggerEvent(P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP,null,!0)},redirectToHomePage:function(){P.changeWindowLocation("/",!1)}}),goog.provide("P.modules.ModalAnalyticsHomeAudienceCardIntro"),goog.require("P.Module"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeAudienceCardIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return"RIGHT_CENTER"},getHighlightedElement:function(){return this.getHighlightedCardModule("audience")}}),goog.provide("P.modules.ModalAnalyticsHomeDomainCardIntro"),goog.require("P.Module"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeDomainCardIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return"LEFT_CENTER"},getHighlightedElement:function(){return this.getHighlightedCardModule("domain")}}),goog.provide("P.modules.NewUserFindFriends"),goog.provide("P.modules.NuxFindFriends"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),goog.require("P.modules.FindFriendsContent"),P.modules.NewUserFindFriends=P.modules.NewUserStepBase.extend({CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{HIDDEN:"hidden"}),mixins:[P.Mixins.NuxFindFriends],onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.content=null,this.listen(this.nuxProgress.getNextButton(),P.CONST.EVENT_BUTTON_CLICK,this._onButtonNextClick),this.setup()},onEnter:function(a){P.scrollToTop({}),a&&a()},_notifyProgressBar:function(a){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT,{type:a,total:1})},_onButtonNextClick:function(){if(this.followingFriendsChanged()){var a=this.nuxProgress.getNextButton();a.showLoading();var b=this.nuxProgress.$skip;b.addClass(this.CssClassName.HIDDEN),this.signalFollowFriends().then(function(){a.hideLoading(),b.removeClass(this.CssClassName.HIDDEN)}.bind(this))}},_showSelectedTab:function(){this.$(".emptyContactGrid").addClass(this.CssClassName.HIDDEN),this.hideFollowAllButton();var a=null;if(this.tab){switch(this.tab){case P.SocialConnect.FACEBOOK:this.setNetwork(P.SocialConnect.FACEBOOK),this.facebookConnected&&(a="UserFacebookFriendsResource",this._notifyProgressBar("facebook"),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!0),this.getChildById("twTab").setSelected(!1);break;case P.SocialConnect.TWITTER:this.setNetwork(P.SocialConnect.TWITTER),this.twitterConnected&&(a="UserTwitterFriendsResource",this._notifyProgressBar("twitter"),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!1),this.getChildById("twTab").setSelected(!0)}var b=new P.modules.FindFriendsContent({id:"friendsGrid",options:{tab:this.tab,username:P.currentUser.get("username"),exclude_following:!1,item_options:{view_type:"userCheckableSelectView",is_checked:!1}}});if(a){var c={username:P.currentUser.get("username"),exclude_following:!1};b.resource=P.resourceFactory.create(a,c)}this.content&&this.content.remove(),b.render().then(function(){switch(this.appendChild(b),this.content=b,this.tab){case P.SocialConnect.FACEBOOK:this.facebookConnected&&this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this.twitterConnected&&this.resetFollowAllState()}this.listen(this.getFriendGrid(),P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,function(a){switch(a.data.network){case P.SocialConnect.FACEBOOK:this._notifyProgressBar("facebook"),this.facebookConnected=!0,this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this._notifyProgressBar("twitter"),this.twitterConnected=!1,this.resetFollowAllState()}})}.bind(this))}}}),goog.provide("P.modules.NewUserInstallExtension"),goog.require("P.Module"),goog.require("P.browserExtension"),goog.require("P.modules.NewUserStepBase");var BUTTON_ID_INSTALL_BUTTON="installButton";P.modules.NewUserInstallExtension=P.modules.NewUserStepBase.extend({onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.optionalSkip=this.$(".optionalSkip"),this.optionalSkip.bind("click",this.onSkipClick)},onEnter:function(a){P.scrollToTop({});var b=void 0!==$("body").attr("data-pinterest-extension-installed");b&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT),a&&a()},onShow:function(a){var b=void 0!==$("body").attr("data-pinterest-extension-installed");b||this.show(),a&&a()},onButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_INSTALL_BUTTON&&P.browserExtension.instance.handleExtensionInstall(this.onChromeExtensionInstallationSuccess,P.NOOP)},onChromeExtensionInstallationSuccess:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},onSkipClick:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_SKIP_PROGRESS_BAR_STEP)}}),goog.provide("P.modules.NewUserInterestPicker"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),goog.require("P.tutorialManager");var INIT_FEED_DELAY_MS=1500;P.modules.NewUserInterestPicker=P.modules.NewUserStepBase.extend({CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{HIDDEN:"hidden"}),onAddedToDom:function(){this.childListen(P.CONST.EVENT_ITEM_CLICK,this.onInterestClick)},onInterestClick:function(a){var b=a.data||{},c=b.url_name;_.contains(this.selectedInterests,c)?this.selectedInterests=_.without(this.selectedInterests,c):this.selectedInterests.push(c),this._notifyProgressBar()},_notifyProgressBar:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT,{type:"interest",total:this.selectedInterests.length})},initializeStep:function(){this.selectedInterests=[]},onExit:function(a){var b=this.selectedInterests.join(",");if(b){var c=this.nuxProgress.getNextButton();c.showLoading();var d=this.nuxProgress.$skip;d.addClass(this.CssClassName.HIDDEN);var e=function(){P.setTimeout(function(){a&&(a(),c.hideLoading(),d.removeClass(this.CssClassName.HIDDEN))}.bind(this),INIT_FEED_DELAY_MS)}.bind(this);this.signalFollowedInterests(b,e)}else a&&a()},signalFollowedInterests:function(a,b){var c={interests:a};P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_REBUILD_FEED)&&(c.redo_homefeed=!0);var d=P.resourceFactory.create("OrientationContextResource",c);d.callCreate().then(b)}}),goog.provide("P.modules.NewUserInterestSearch"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase");var SELECTOR_TOOLTIP_CLOSER_LOOK=".tooltipCloserLook",EXIT_TOUR_TIME=15e3,FORCE_EXIT_TIME=48e4,MIN_SEARCHES=1,SEARCH_ITEM_OPTIONS={show_pinner:!0,show_board:!0,lite:!0,show_via:!1,show_pinned_from:!1};P.modules.NewUserInterestSearch=P.modules.NewUserStepBase.extend({CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{VISIBLE:"visible"}),onAddedToDom:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onButtonClick:function(a){var b=a.target.id;"previous"===b&&this.triggerInterest()},initializeStep:function(){this.childListen(P.CONST.EVENT_NAVIGATE,P.NuxUtils.preventNavigationIfNecessary),this.numSearches=0,this.endTourTooltip=null;var a={};a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this._onRepinned,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onChildNavigate:function(a){var b=P.router.get().resolve(a.data.url);"FeedPage"===b.module?(this.triggerCategory(b.options.feed),a.data.handled=!0):"SearchPage"===b.module?(this.triggerPinSearch(b.options.query),a.data.handled=!0):"Closeup"===b.module&&this._closeTooltip(),a.data.handled&&a.stopPropagation()},onEnter:function(a){var b={name:"ConfirmDialog",options:{template:"new_user_ready"}};this.forceExit=window.setTimeout(function(){P.loadModule(b).then(function(a){this.showInModal(a,{mask_type:"dark",can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,function(){this.nuxProgress.triggerEvent(P.CONST.EVENT_NEXT)}),P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN),P.trackRegisterAction("autobahn_force_exit")}.bind(this))}.bind(this),FORCE_EXIT_TIME),this.autoEnableExit=window.setTimeout(function(){this._enableExitTour()}.bind(this),EXIT_TOUR_TIME),a&&a()},_onRepinned:function(){this._enableExitTour(),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.trackRegisterAction("autobahn_repinned")},onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.grid=this.getChildById("grid"),this.$previousButton=this.$(".previous"),this.endTourButton=this.nuxProgress.getNextButton(),this.endTourButton.disable();var a=this.extraData?this.extraData.showAutobahnV3Tooltip:!1;a===!0&&this.showEndTourTip()},showEndTourTip:function(){if(this.endTourButton){var a={name:"Dropdown",options:{anchor:this.endTourButton.$el,class_name:"endTourTooltip",position_point:"BOTTOM_RIGHT",sticky:!0,text:P._("Try a pin search below. <br>(The more specific, the better!)"),title:P._("Psst! Before you leave...")}};P.loadModule(a).then(function(a){this.endTourTooltip=a,a.render().then(function(){this.endTourButton.appendChild(a),a.positionModule(),a.fadeIn()}.bind(this))}.bind(this))}},hideEndTourTip:function(){this.endTourTooltip&&this.endTourTooltip.fadeOut()},showPrevious:function(){this.togglePrevious(!0),this._toggleTooltip(!0),this._handleSearchCount()},hidePrevious:function(){this.togglePrevious(!1),this._toggleTooltip(!1)},togglePrevious:function(a){this.$previousButton.toggleClass(this.CssClassName.VISIBLE,a)},_handleSearchCount:function(){this.numSearches=1,this.numSearches===MIN_SEARCHES&&(P.trackRegisterAction("autobahn_user_search"),this._enableExitTour())},triggerCategory:function(a){this.grid.options.layout="variable_height",this.grid.options.item_options=SEARCH_ITEM_OPTIONS,this.grid.resource=P.resourceFactory.create("CategoryFeedResource",{feed:a}),this.grid.empty(),this.grid.render().then(this.showPrevious.bind(this))},triggerInterest:function(){this.grid.options.layout="fixed_height",this.grid.resource=P.resourceFactory.create("AllCategoriesResource",{field_set_key:"grid_item"}),this.grid.render().then(this.hidePrevious.bind(this))},triggerPinSearch:function(a){return""===a.trim()?this.triggerInterest():(this.grid.resource=P.resourceFactory.create("SearchResource",{query:a,scope:"pins"}),this.grid.options.layout="variable_height",this.grid.options.item_options=SEARCH_ITEM_OPTIONS,this.grid.empty(),void this.grid.render().then(this.showPrevious.bind(this)))},_enableExitTour:function(){this.endTourButton.enable(),this.hideEndTourTip()},onExit:function(a){clearTimeout(this.forceExit),clearTimeout(this.autoEnableExit),a&&a()},_toggleTooltip:function(a){var b=this.$(SELECTOR_TOOLTIP_CLOSER_LOOK);b&&b.toggleClass(this.CssClassName.VISIBLE,a)},_closeTooltip:function(){var a=this.$(SELECTOR_TOOLTIP_CLOSER_LOOK);a&&a.remove()}}),goog.provide("P.modules.NewUserPin"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase");var FACEBOOK_SCRIPT_ID="fb_pixel",FACEBOOK_PIXEL_CONFIGURATION={pixel_id:"6011522978142",value:"0.00",currency:"USD"};P.modules.NewUserPin=P.modules.NewUserStepBase.extend({onContentReady:function(){window.fb_param=FACEBOOK_PIXEL_CONFIGURATION,P.script.load([],"//connect.facebook.net/en_US/fp.js",FACEBOOK_SCRIPT_ID),P.modules.NewUserStepBase.prototype.onContentReady.call(this)}}),goog.provide("P.modules.NewUserPinCreate"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserPinCreate=P.modules.NewUserStepBase.extend({onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.nextStepButton=this.nuxProgress.getNextButton(),this.nextStepButton.disable()}}),goog.provide("P.modules.NewUserPinSearch"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase");var MIN_BOTTOM_GUTTER=-220,MIN_REQUESTED_ITEMS=3,NEW_USER_SELECTOR_TOOLTIP_CLOSER_LOOK=".tooltipCloserLook",INTERVAL_TIME=5e3,NEW_USER_EXIT_TOUR_TIME=15e3,NEW_USER_FORCE_EXIT_TIME=48e4,TEMPLATE_SUGGESTIONS="<% _.each(suggestions, function(suggestion) { %><li><%= suggestion %></li><% }) %>";P.modules.NewUserPinSearch=P.modules.NewUserStepBase.extend({events:{"click .searchSuggestions li":"_onSuggestionClick","click .searchInterestField":"stopInterval","submit .searchInterest":"_onSubmit"},CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{HIGHLIGHT:"highlight",VISIBLE:"visible"}),initializeStep:function(){this.currentQuestion=0,this._requestedItems=0,this._startCountingRequestedItems=!1,this.childListen(P.CONST.EVENT_NAVIGATE,P.NuxUtils.preventNavigationIfNecessary),this._onScrollHandle=this.listen($(window),"scroll",_.debounce(this._onScroll.bind(this),50)),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this._onRequestItemSuccess);var a={};a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this._onRepinned,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onContentReady:function(){this.$searchTitle=this.$(".searchTitle"),this.$searchSuggestions=this.$(".searchSuggestions ul"),this.$searchField=this.$(".searchInterestField"),this.endTourButton=this.getChildById("nextButton"),this.interestGrid=this.getChildById("interestGrid"),this.interval=P.setInterval(this._nextQuestion.bind(this),INTERVAL_TIME),this.$searchField.placeholder(),this.endTourButton.setText(this.extraData.nextButtonText),this.endTourButton.disable(),this.siteWideNags=P.app.getChildByModuleName("Nags"),this.header=P.app.getChildById("header")},onEnter:function(a){var b={name:"ConfirmDialog",options:{template:"new_user_ready"}};this.forceExit=window.setTimeout(function(){P.loadModule(b).then(function(a){this.showInModal(a,{mask_type:"dark",can_dismiss:!1}),this.listen(a,P.CONST.EVENT_CONFIRM,function(){this._endMandatoryFlow()}),P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN),P.trackRegisterAction("autobahn_force_exit")}.bind(this))}.bind(this),NEW_USER_FORCE_EXIT_TIME),this.autoEnableExit=window.setTimeout(function(){this._enableExitTour()}.bind(this),NEW_USER_EXIT_TOUR_TIME),a&&a()},_onRepinned:function(){this._enableExitTour(),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.trackRegisterAction("autobahn_repinned")},setInterest:function(a,b){a=a.trim(),b?(this.$searchField.val(""),this.$searchField.attr("placeholder",a)):(this.$searchField.val(a),this._onRequestItemSuccess(),P.trackRegisterAction("autobahn_user_search")),this.$searchField.placeholder();var c=this.$searchField.val(),d=this.$searchSuggestions.children("li");_.each(d,function(b){var d=$(b),e=d.text().toLowerCase()===a.toLowerCase(),f=d.text().toLowerCase()===c.toLowerCase();d.toggleClass(this.CssClassName.HIGHLIGHT,f||e)}.bind(this)),this.interestGrid.resource.options.interest=a,this.renderGrid()},renderGrid:_.debounce(function(){this.interestGrid.render()},250),stopInterval:function(){clearInterval(this.interval)},onRemovedFromDom:function(){this._closeTooltip(),this.stopInterval()},_closeTooltip:function(){var a=this.$(NEW_USER_SELECTOR_TOOLTIP_CLOSER_LOOK);a&&(a.remove(),this.removeListener(this._onScrollHandle))},_nextQuestion:function(){this.currentQuestion++;var a=this.extraData.search_suggestions.length;this.currentQuestion===a&&(this.currentQuestion=0),this._refreshQuestion()},_previousQuestion:function(){this.currentQuestion--;var a=this.extraData.search_suggestions.length;this.currentQuestion<0&&(this.currentQuestion=a-1),this._refreshQuestion()},_refreshQuestion:function(){var a=this.extraData.search_suggestions,b=a[this.currentQuestion];if(b){var c=b.suggestions[0],d=_.template(TEMPLATE_SUGGESTIONS,b);this.$searchTitle.html(b.title),this.$searchSuggestions.html(d),this.setInterest(c,!0)}},_search:function(){this.setInterest(this.$searchField.val(),!1)},_onButtonClick:function(a){this.stopInterval();var b=a.target.id;"next"===b?this._nextQuestion():"prev"===b?this._previousQuestion():"search"===b?this._search():("close"===b||"nextButton"===b)&&this._endMandatoryFlow()},_endMandatoryFlow:function(){if(clearTimeout(this.forceExit),clearTimeout(this.autoEnableExit),P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)){var a=P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN);a.fin(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),this._endMandatoryFlowRender()}.bind(this))}else this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),this._endMandatoryFlowRender()},_endMandatoryFlowRender:function(){this.header&&this.header.render(),this.siteWideNags&&this.siteWideNags.render()},_onRequestItemSuccess:function(){this._requestedItems===MIN_REQUESTED_ITEMS&&(this._enableExitTour(),P.trackRegisterAction("autobahn_search_done")),this._requestedItems++},_enableExitTour:function(){this.endTourButton.enable()},_onScroll:function(){this.stopInterval();var a=this.$(".newUserStepHeader"),b=this.$(NEW_USER_SELECTOR_TOOLTIP_CLOSER_LOOK),c=a.offset().top+a.height();if(b){var d=c+MIN_BOTTOM_GUTTER;b.toggleClass(this.CssClassName.VISIBLE,$(window).scrollTop()>d)}},_onSubmit:function(a){a.preventDefault(),this._search()},_onSuggestionClick:function(a){this.stopInterval(),this.setInterest($(a.target).text(),!1)}}),goog.provide("P.modules.NewUserPinSource"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserPinSource=P.modules.NewUserStepBase.extend({}),goog.provide("P.modules.NewUserPinUsage"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserPinUsage=P.modules.NewUserStepBase.extend({}),goog.provide("P.modules.NewUserSetupSpinner"),goog.require("P.Module"),goog.require("P.modules.NewUserStepBase"),goog.require("P.modules.StepBase");var SPINNER_STATUS_POLL_INTERVAL=5e3;P.modules.NewUserSetupSpinner=P.modules.NewUserStepBase.extend({onShow:function(a){this.nuxProgress&&this.nuxProgress.endMandatoryFlow(),P.setTimeout(this._goToNextStep,SPINNER_STATUS_POLL_INTERVAL),P.modules.StepBase.prototype.onShow.call(this,a)},_goToNextStep:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)}}),goog.provide("P.modules.NuxModalJumpStartBoardStep"),goog.require("P.Module"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartBoardStep=P.modules.NuxModalJumpStartStep.extend({onShow:function(a){this.animateChain([".boardImage",".title"],function(a,b){this.animateIn(a,b)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,a)},onExit:function(a){this.animateChain([".title",".boardImage"],function(a,b){this.animateOut(a,b)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,a)}}),goog.provide("P.modules.NuxModalJumpStartExtensionStep"),goog.require("P.Module"),goog.require("P.modules.NuxModalJumpStartStep");var INSTALL_BUTTON_ID="installButton";P.modules.NuxModalJumpStartExtensionStep=P.modules.NuxModalJumpStartStep.extend({onContentReady:function(){P.modules.NuxModalJumpStartStep.prototype.onContentReady.call(this);var a=this.getChildById(INSTALL_BUTTON_ID);a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onInstallButtonClick)},onInstallButtonClick:function(){P.browserExtension.instance.handleExtensionInstall(P.NOOP,P.NOOP)},onShow:function(a){this.animateChain([".pinItImage",".title",".textAndButton",".install"],function(a,b){this.animateIn(a,b)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,a)},onExit:function(a){this.animateChain([".title",".pinItImage",".textAndButton"],function(a,b){this.animateOut(a,b)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,a)}}),goog.provide("P.modules.NuxModalJumpStartPinStep"),goog.require("P.Module"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartPinStep=P.modules.NuxModalJumpStartStep.extend({onShow:function(a){this.animateChain([".pinImage",".title"],function(a,b){this.animateIn(a,b)
}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,a)},onExit:function(a){this.animateChain([".title",".pinImage"],function(a,b){this.animateOut(a,b)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,a)}}),goog.provide("P.modules.NuxModalJumpStartSaveStep"),goog.require("P.Module"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartSaveStep=P.modules.NuxModalJumpStartStep.extend({onShow:function(a){this.animateChain([".browserContainer",".title"],function(a,b){this.animateIn(a,b)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,a)},onExit:function(a){this.animateChain([".title",".browserContainer"],function(a,b){this.animateOut(a,b)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,a)}}),goog.provide("P.modules.PinForm"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.UserSocialNetworkSettings"),goog.require("P.modules.PlaceSelector");var FB_KEY=P.SocialConnect.FACEBOOK,TW_KEY=P.SocialConnect.TWITTER,SHARE_SOCIAL_WRAPPER_SELECT=".socialShareWrapper";P.modules.PinForm=P.modules.UserSocialNetworkSettings.extend({events:{'change [name="share_facebook"]':"onFacebookCheckboxChanged","focus .PlaceSelector input":"onPlaceSelectorFocus",click:"_onClick"},setImage:function(a){this.options.image_url=a;var b=this.getChildById("pinPreview");b.setImage(a)},_onClick:function(a){var b=$(a.target).closest(".PlaceSelector").length;if(!b){var c=this.getPlaceSelector();if(c){var d=c.getTypeaheadField(),e=d.getTypeahead();e.isOpen()&&e.hide()}}},getPlaceSelector:function(){return this.getChildById("placeSelector")},onPlaceSelectorFocus:function(){var a=this.getPlaceSelector();if(a){var b=a.getTypeaheadField(),c=b.getTypeaheadItemsToRender(),d=c&&c.length>0;if(d){var e=b.getTypeahead();e.show()}}},onCreated:function(){P.modules.UserSocialNetworkSettings.prototype.onCreated.apply(this,arguments),this.networkToSelectorMap={},this.networkToSelectorMap[FB_KEY]='[name="share_facebook"]',this.networkToSelectorMap[TW_KEY]='[name="share_twitter"]'},onItemSelected:function(){this.getChildById("removePlaceButton").show()},onFacebookCheckboxChanged:function(){var a=this.getNetworkChecked(FB_KEY);P.currentUser.set(P.CONST.FB_PUBLISH_KEY,a),a&&P.FbUtil.maybeRequestFbTimelinePermission({error:function(){this.setNetworkChecked(FB_KEY,!1),P.currentUser.set(P.CONST.FB_PUBLISH_KEY,!1)}.bind(this)})},onContentReady:function(){var a={message:P._("Don't forget a description!")},b={description:[P.Validator.Required(a),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]};this.form=new P.Form(this.$("form"),b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_CHANGE,this._onChildChange),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var c=this.getBoardPicker();c.getSelectedBoardPrivacy()===P.CONST.BoardPrivacy.SECRET&&this.hideSocialExplicitSharing();var d=this.getChildById("uploader");d&&this.listen(d,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess)},onButtonClick:function(a){var b=a.target;"removePlaceButton"===b.id&&this.removePlace()},removePlace:function(){this.$(".pinPlaceId").val(0);var a=this.getPlaceSelector(),b=a.getTypeaheadField();b.reset(),b.enableInput(),this.getChildById("removePlaceButton").hide()},_onChildChange:function(a){if("boardPicker"===a.target.id){var b=a.data;b.privacy===P.CONST.BoardPrivacy.SECRET?this.hideSocialExplicitSharing():this.showSocialExplicitSharing()}},hideSocialExplicitSharing:function(){this.$(SHARE_SOCIAL_WRAPPER_SELECT).hide()},showSocialExplicitSharing:function(){this.$(SHARE_SOCIAL_WRAPPER_SELECT).show()},onSubmitValidated:function(a){this.triggerEvent(P.CONST.EVENT_SUBMIT_VALIDATED,a,!0)},onUploadSuccess:function(a){var b=a.data.image_url,c=this.getChildById("pinPreview");c.setImage(b),this.options.image_url=b},getBoardPicker:function(){return this.getChildById("boardPicker")},getBoardId:function(){return this.getBoardPicker().getSelectedBoardId()},getDescription:function(){return this.getChildById("pinDescriptionField").getValue()},setNetworkChecked:function(a,b){var c=this.networkToSelectorMap[a];c&&this.$(c).prop("checked",b)},getNetworkChecked:function(a){var b=this.networkToSelectorMap[a];if(b){var c=this.$(b);return c.length?c.is(":checked"):""}},getImageUrl:function(){return this.options.image_url},getLink:function(){return this.$("#pinFormLink").val()||""},getData:function(){var a={board_id:this.getBoardId(),description:this.getDescription(),link:this.getLink()},b=this.getNetworkChecked(P.SocialConnect.TWITTER);""!==b&&(a.share_twitter=b),b=this.getNetworkChecked(P.SocialConnect.FACEBOOK),""!==b&&(a.share_facebook=b);var c=this.getImageUrl();if(c&&(a.image_url=c,P.beginsWith(c,"//"))){var d=document.referrer;if(d){var e;P.beginsWith(d,"http://")?e="http:":P.beginsWith(d,"https://")&&(e="https:"),e&&(a.image_url=e+a.image_url)}}var f=this.$(".pinPlaceId");if(f.length){a.place=f.val();var g=this.getPlaceSelector();if(g){var h=g.getTypeaheadField(),i=h.getValue();(0===i.length||"0"===f.val())&&(a.place=0)}}return this.data&&this.data.source_interest&&(a.source_interest_id=this.data.source_interest.id),a}}),goog.provide("P.modules.App"),goog.require("P.HistoryManager"),goog.require("P.interfaces.HistoryManagerProvider"),goog.require("P.modules.AppBase"),goog.require("P.modules.Grid"),goog.require("P.modules.Header"),goog.require("P.modules.Modal"),goog.require("P.nativeApp"),P.modules.App=P.modules.AppBase.extend({events:{dragenter:"_onDragEnter",dragover:"_eventPreventDefault",dragdrop:"_eventPreventDefault",drop:"_eventPreventDefault",dragleave:"_eventPreventDefault"},CssClassName:_.extend(P.modules.AppBase.prototype.CssClassName,{FADE:"fade",INVISIBLE:"invisible",IS_HIDDEN:"isHidden",NO_SHOW:"doNotShow",SHOW_CLOSEUP:"showingCloseup",SHOW_PLACE_BOARD:"showingPlaceBoard"}),onAddedToDom:function(){P.modules.AppBase.prototype.onAddedToDom.apply(this,arguments);var a=this.extraData?this.extraData.deepLinkTracking:null;P.DeepLink.setup(P.CONTEXT.ios_deep_link,"pinterest://",a),this.childListen(P.CONST.EVENT_APPEND_CLONED_PIN,this._onAppendClonedPin)},_onAppendClonedPin:function(a){var b=a.data,c=b.getContent();c.appendTo(this.$el),b.clampDescription&&b.clampDescription()},_adjustScrollToTopPositionIfNeeded:function(){var a=this._getCurrentMainModule();if(a){if("BoardPage"===a.className&&a.isPlaceBoard())return void this.$el.addClass(this.CssClassName.SHOW_PLACE_BOARD);this.$el.removeClass(this.CssClassName.SHOW_PLACE_BOARD);var b="Closeup"===a.className;this.$el.toggleClass(this.CssClassName.SHOW_CLOSEUP,b)}},_scrollMainModuleIfNeeded:function(){var a=this._getCurrentMainModule();a&&a.initScroll()},isContentOnly:function(){return"content_only"===this.options.view_type},onChildNavigate:function(a){var b,c=a.data.url,d=P.CONTEXT.user_agent_can_use_native_app,e=P.currentUser.isAuthenticated();return this._shouldDeepLinkInsteadOfNavigate(e,d,this.userAgentPlatform,c)&&(b=P.router.get().resolve(c)),b&&b.extraContent?(P.DeepLink.navigateToDeepLink(this.userAgentPlatform,b.extraContent,this.extraData.defaultYozio),void a.stopPropagation()):void P.modules.AppBase.prototype.onChildNavigate.apply(this,arguments)},onContentReady:function(){P.modules.AppBase.prototype.onContentReady.apply(this,arguments),this.userAgentPlatform=this.extraData.userAgentPlatform,this.logTraffic(),this.setupInterstitialAndAppRedirect(),P.CONTEXT.is_mobile_agent&&(this.CLOSEUP_NAME=null),0===window.location.pathname.indexOf("/conversation/")&&this.openInApp(),P.requestPushNotifications();var a,b=P.getConversationFromUrl();if(P.currentUser.isAuthenticated()&&P.experiments.instance.inExperimentGroupsActiveOrTriggerable("web_pin_create2",["enabled_v5_toast"])){var c=this.getChildById("toasts");P.getToastsManager().setContainer(c)}if((P.currentUser.isAuthenticated()||b)&&!P.currentUser.isLimitedLogin()&&!this.isContentOnly())if(a=P.getConversationsManager(),a.setContainer(this.getChildById("activeConversations")),P.currentUser.isAuthenticated()){var d=P.Experiences.Placement.WEB_ONLOAD_AUTO_COMPLETE,e=P.Experiences.Experience.WEB_MSGS_WELCOME_MESSAGE;P.ExperienceManager.instance().isPlacedExperience(d,e)&&P.ExperienceManager.instance().completePlacedExperience(d,e),a.loadInitialConversations(b),a.listenForConversations()}else a.addConversationForUnauthUser(b);var f={};this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,f),P.currentUser.isAuthenticated()||this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),P.experiments.instance.inExperimentGroupsActiveOrTriggerable("web_pin_create2",["enabled_v5_toast"])&&P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_VISIBILITY_FOCUS,function(){var a=P.resourceFactory.create("BoardPickerBoardsResource",{filter:"all",field_set_key:"board_picker",allow_stale:!0});P.resourceCache.instance.callGet(a)}),P.CONTEXT.is_mobile_agent||P.currentUser.isAuthenticated()||!P.experiments.instance.inExperimentGroups("black_banner_replacement",["enabled_2"])||(this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll),this.childListen(P.CONST.EVENT_CLOSE_SIGNUP_OVERLAY,this.closeSignupOverlay))},logTraffic:function(){if(!Cookie.get(P.CONST.COOKIE_SESSION_FUNNEL_EVENT_LOGGED)){Cookie.set(P.CONST.COOKIE_SESSION_FUNNEL_EVENT_LOGGED,"1",12);var a;a=P.CONTEXT.is_mobile_agent?this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_IOS?"iphone":this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID?"android":"mobile_other":"desktop";var b,c=document.referrer;b=c?c.indexOf("/t.co/")>-1?"twitter":c.indexOf("google.")>-1?"google":c.indexOf("bing.")>-1?"bing":c.indexOf("facebook.")>-1?"facebook":"other":"direct";var d=this._getCurrentMainModule().className,e=P.currentUser.isAuthenticated()?"auth":"unauth";P.trackRegisterAction("traffic."+a+"."+b+"."+d+"."+e)}},onScroll:function(){var a=this.getScrollableElement().scrollTop();if(!(a<0)){var b=a>1e3;b^this._isShowingOverlay&&(this._isShowingOverlay=b,this.toggleSignupOverlay())}},toggleSignupOverlay:function(){this.$(".Header").toggleClass(this.CssClassName.INVISIBLE),this.$(".BoardHeader").toggleClass(this.CssClassName.INVISIBLE),this.$(".UserProfileHeader").toggleClass(this.CssClassName.INVISIBLE),this.$(".inspiredWallOverlay").toggleClass(this.CssClassName.NO_SHOW)},closeSignupOverlay:function(){this.toggleSignupOverlay()},setupInterstitialAndAppRedirect:function(){switch(this.childListen(P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP,function(){this.openInApp(P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP)}),this.childListen(P.CONST.EVENT_OPEN_IN_APP,this.openInApp),this.childListen(P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP,function(){this.openInApp(P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP)}),P.DeepLink.setup(P.CONTEXT.deep_link,P.CONTEXT.deep_link_default,P.CONTEXT.deep_link_tracking),P.CONTEXT.deep_link_action){case P.sharedConst.DeepLinkAction.OPEN_IN_APP:this.openInApp(P.CONST.EVENT_COOKIE_BASED_REDIRECT_TO_APP);break;case P.sharedConst.DeepLinkAction.SHOW_APP_INTERSTITIAL:P.experiments.instance.inExperimentGroups("web_show_app_interstitial_early",["enabled"])||this.showInterstitial()}},_shouldDeepLinkInsteadOfNavigate:function(a,b,c,d){if(!b)return!1;if(c===P.CONST.USER_AGENT_PLATFORM_IPAD)return!1;var e=/^\/(join|login)\//;return d&&e.test(d)?!1:a?!1:!0},showInterstitial:function(){var a=this.extraData.isTablet||!1,b={name:"AppInterstitial",options:{interstitial_data:this.extraData.appInterstitialData,is_tablet:a,on_home_page:"/"===window.location.pathname}};P.loadModule(b).then(function(a){this._modalManager.createAndShowModal(a,{can_dismiss:!1,modal_style:"fullScreen"})}.bind(this))},openInApp:function(a){var b;b=a===P.CONST.EVENT_COOKIE_BASED_REDIRECT_TO_APP?this.extraData.redirectYozioLink:a===P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP?this.extraData.interstitialYozioLink:a===P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP?this.extraData.unauthBannerYozioLink:this.extraData.defaultYozio,Cookie.set(P.sharedConst.CookieName.SUPRESS_AUTO_REDIRECT,window.location.pathname),P.DeepLink.redirectToDeepLink(b,this.userAgentPlatform,!1)},_getScrollToTopModule:function(){var a=this.getChildById("scrollToTop");return a},updateScrollWatchers:function(a){var b=this._getScrollToTopModule();b&&b.setScroller(a.getScrollableElement())},_eventPreventDefault:function(a){a.preventDefault()},_onDragEnter:function(a){a.preventDefault();var b=a.originalEvent.dataTransfer.types;if((!b||-1!==_.values(b).indexOf("Files"))&&(!this.dragOverlayModule||this.dragOverlayModule.destroyed)&&P.currentUser&&P.currentUser.isAuthenticated()){var c={name:"PinDragAndDrop",options:{}};P.loadModule(c).then(function(a){this.dragOverlayModule=a,a.render().then(function(){this.appendChild(a)}.bind(this))}.bind(this))}},_showUnauthBanner:function(){this.$(".UnauthBanner").removeClass(this.CssClassName.IS_HIDDEN+" "+this.CssClassName.FADE)},_hideUnauthBanner:function(){var a=this.$(".UnauthBanner"),b=this.listen(a,P.CONST.EVENT_TRANSITIONEND,function(){a.addClass(this.CssClassName.IS_HIDDEN),this.removeListener(b)});a.addClass(this.CssClassName.FADE)},_onScroll:function(){P.getModalManager().hasModals()||this._showUnauthBanner()},getHeader:function(){return this.getChildById("header")}}),P.Errors.wrap(P.modules.App.prototype,["initialize","onAddedToDom","onContentReady"]);