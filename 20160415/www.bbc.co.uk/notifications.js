//Build 1.4.2 at Wed Mar 23 2016 12:11:04 GMT+0000 (UTC) for live
!function(t,e,i){function n(t,e){return typeof t===e}function o(){var t,e,i,o,a,s,r;for(var c in b)if(b.hasOwnProperty(c)){if(t=[],e=b[c],e.name&&(t.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(i=0;i<e.options.aliases.length;i++)t.push(e.options.aliases[i].toLowerCase());for(o=n(e.fn,"function")?e.fn():e.fn,a=0;a<t.length;a++)s=t[a],r=s.split("."),1===r.length?w[r[0]]=o:(!w[r[0]]||w[r[0]]instanceof Boolean||(w[r[0]]=new Boolean(w[r[0]])),w[r[0]][r[1]]=o),_.push((o?"":"no-")+r.join("-"))}}function a(t){var e=k.className,i="n-";if(E&&(e=e.baseVal),w._config.enableJSClass){var n=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");e=e.replace(n,"$1"+i+"js$2")}w._config.enableClasses&&(e+=" "+i+t.join(" "+i),E?k.className.baseVal=e:k.className=e)}function s(){return"function"!=typeof e.createElement?e.createElement(arguments[0]):E?e.createElementNS.call(e,"http://www.w3.org/2000/svg",arguments[0]):e.createElement.apply(e,arguments)}function r(){var t=e.body;return t||(t=s(E?"svg":"body"),t.fake=!0),t}function c(t,i,n,o){var a,c,l,d,f="modernizr",u=s("div"),h=r();if(parseInt(n,10))for(;n--;)l=s("div"),l.id=o?o[n]:f+(n+1),u.appendChild(l);return a=s("style"),a.type="text/css",a.id="s"+f,(h.fake?h:u).appendChild(a),h.appendChild(u),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),u.id=f,h.fake&&(h.style.background="",h.style.overflow="hidden",d=k.style.overflow,k.style.overflow="hidden",k.appendChild(h)),c=i(u,t),h.fake?(h.parentNode.removeChild(h),k.style.overflow=d,k.offsetHeight):u.parentNode.removeChild(u),!!c}function l(t,e){return!!~(""+t).indexOf(e)}function d(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-")}function f(e,n){var o=e.length;if("CSS"in t&&"supports"in t.CSS){for(;o--;)if(t.CSS.supports(d(e[o]),n))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];o--;)a.push("("+d(e[o])+":"+n+")");return a=a.join(" or "),c("@supports ("+a+") { #modernizr { position: absolute; } }",function(t){return"absolute"==getComputedStyle(t,null).position})}return i}function u(t){return t.replace(/([a-z])-([a-z])/g,function(t,e,i){return e+i.toUpperCase()}).replace(/^-/,"")}function h(t,e,o,a){function r(){d&&(delete I.style,delete I.modElem)}if(a=n(a,"undefined")?!1:a,!n(o,"undefined")){var c=f(t,o);if(!n(c,"undefined"))return c}for(var d,h,p,g,m,v=["modernizr","tspan"];!I.style;)d=!0,I.modElem=s(v.shift()),I.style=I.modElem.style;for(p=t.length,h=0;p>h;h++)if(g=t[h],m=I.style[g],l(g,"-")&&(g=u(g)),I.style[g]!==i){if(a||n(o,"undefined"))return r(),"pfx"==e?g:!0;try{I.style[g]=o}catch(b){}if(I.style[g]!=m)return r(),"pfx"==e?g:!0}return r(),!1}function p(t,e){return function(){return t.apply(e,arguments)}}function g(t,e,i){var o;for(var a in t)if(t[a]in e)return i===!1?t[a]:(o=e[t[a]],n(o,"function")?p(o,i||e):o);return!1}function m(t,e,i,o,a){var s=t.charAt(0).toUpperCase()+t.slice(1),r=(t+" "+T.join(s+" ")+s).split(" ");return n(e,"string")||n(e,"undefined")?h(r,e,o,a):(r=(t+" "+P.join(s+" ")+s).split(" "),g(r,e,i))}function v(t,e,n){return m(t,i,i,e,n)}var b=[],y={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,e){var i=this;setTimeout(function(){e(i[t])},0)},addTest:function(t,e,i){b.push({name:t,fn:e,options:i})},addAsyncTest:function(t){b.push({name:null,fn:t})}},w=function(){};w.prototype=y,w=new w;var _=[],k=e.documentElement,E="svg"===k.nodeName.toLowerCase();w.addTest("localstorage",function(){var t="modernizr";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(e){return!1}});var C=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):[];y._prefixes=C;var S=y.testStyles=c;w.addTest("touchevents",function(){var i;if("ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch)i=!0;else{var n=["@media (",C.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");S(n,function(t){i=9===t.offsetTop})}return i}),w.addTest("svg",!!e.createElementNS&&!!e.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);var x="Moz O ms Webkit",T=y._config.usePrefixes?x.split(" "):[];y._cssomPrefixes=T;var A={elem:s("modernizr")};w._q.push(function(){delete A.elem});var I={style:A.elem.style};w._q.unshift(function(){delete I.style});var P=y._config.usePrefixes?x.toLowerCase().split(" "):[];y._domPrefixes=P,y.testAllProps=m,y.testAllProps=v,w.addTest("cssanimations",v("animationName","a",!0)),w.addTest("texttrackapi","function"==typeof s("video").addTextTrack),w.addTest("track","kind"in s("track")),o(),a(_),delete y.addTest,delete y.addAsyncTest;for(var j=0;j<w._q.length;j++)w._q[j]();t.NotificationsModernizr=w}(window,document),define("mybbc/notifications/vendor/modernizr-custom",function(){}),define("mybbc/templates/signed-in",[],function(){return'<section class="notification-error__container"></section><section class="notification-settings__container notification-settings__container--js"></section><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title">Notifications<sup class="notification-title__beta">beta</sup></h2><ul class="notification-header-icons"><li><a class="notifications__settings--js" href="#"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul><a href="#" class="notifications-pop-up"></a></header><div id="notifications-wrapper"><div class="notification-panel" style="display: block;"><notifications><div class="spinner"><img class="loader-icon notifications-image" src="{{baseAssetUrl}}img/loader/32px/34px_Icon32px_Lively_Dark.gif" alt="Settings"></div></notifications></div></div></div>'}),define("mybbc/templates/signed-out",[],function(){return'<div id="notifications-main" class="notifications-main--css notifications-main--js notification-signed-out"><div class="notifications-no-scroll"><div class="notifications-fake"><div class="notifications-top-header"><p class="notifications-main-header notifications-trafalgar">Never miss your favourites</p><p class="notifications-description notifications-pica">Get notifications about your favourite&nbsp;<span>programmes, music and more.</span></p></div><div class="notifications-cta notifications-cta--upsell"><div class="notification-sign-in"><a href="{{idConfig.urls.signin}}?ptrt={{ptrt}}" tabindex="3" class="notifications-sign-in__link--js notifications-pica"><span>Sign in</span></a></div><p class="notifications-pica">or <a href="{{idConfig.urls.register}}?ptrt={{ptrt}}" class="notifications-register__link--js notifications-upsell-register notifications-pica-bold">Register</a></p></div></div><div class="notifications-wide-spread"><div class="notifications-limitation-container"><div class="notifications-top-header"><p class="notifications-main-header notifications-trafalgar" tabindex="1">Never miss your favourites</p><p class="notifications-description notifications-pica" tabindex="2">Get notifications about your favourite&nbsp;<span>programmes, music and more.</span></p></div><div class="notifications-cta notifications-cta--upsell"><div class="notification-sign-in"><a href="{{idConfig.urls.signin}}?ptrt={{ptrt}}" tabindex="3" class="notifications-sign-in__link--js notifications-pica"><span>Sign in</span></a></div><p class="notifications-pica">or&nbsp; <a href="{{idConfig.urls.register}}?ptrt={{ptrt}}" tabindex="4" class="notifications-register__link--js notifications-upsell-register notifications-pica-bold">Register</a></p></div></div></div></div></div>'}),define("mybbc/templates/on-boarding",[],function(){return'<section class="notification-error__container"></section><div id="notifications-main" class="notifications-main--css notifications-main--js notifications-on-boarding--js notifications-on-boarding notifications-no-scroll"><div class="notifications-carousel notifications-onboarding-parent-carousel--js hidden" id="notifications-onboarding-parent-carousel"><div class="notifications-carousel__wrap"><div class="notifications-carousel__slide"><div class="on-boarding"><div aria-label="Close" class="on-boarding-close">&nbsp;</div><div class="notifications-fake"><div class="notifications--desktop"><div class="onboarding-image enter-animation"></div><div class="notifications-top-header"><p class="notifications-main-header notifications-10/12 notifications-canon" role="heading">Never miss<br>your favourites</p><p class="notifications-description notifications-10/12 notifications-pica">This is the place to get notifications about your programmes, music, radio and much more.</p><p class="notifications-description notifications-10/12 notifications-pica">If you have favourites, we&#39;ll keep you updated on those, and anything new you add. Manage your notifications at any time in settings.</p></div><div class="notifications-cta notifications-10/12"><div class="notification-sign-in"><a href="javascript:void(0)" role="link" class="notifications-sign-in__link--js notifications-pica"><span>OK, get me started</span></a></div></div></div></div><div class="notifications-wide-spread"><div class="notifications--desktop"><div class="onboarding-image enter-animation"></div><div class="notifications-wide-spread--absolute"><div class="notifications-top-header"><p class="notifications-main-header notifications-main-header__first--js notifications-10/12 notifications-canon enter-animation" role="heading" tabindex="0">Never miss<br>your favourites</p><div class="notifications-description__first--js" tabindex="0"><p class="notifications-description notifications-10/12 notifications-pica enter-animation">This is the place to get notifications about your programmes, music, radio and much more.</p><p class="notifications-description notifications-10/12 notifications-pica enter-animation">If you have favourites, we&#39;ll keep you updated on those, and anything new you add. Manage your notifications at any time in settings.</p></div></div><div class="notifications-cta notifications-10/12 enter-animation"><div class="notification-sign-in notifications-start-onboarding__link--js" id="start-onboarding"><a href="javascript:void(0)" role="link" aria-label="OK, get me started" alt="OK, get me started" title="OK, get me started" class="notifications-pica"><span>OK, get me started</span></a></div></div></div></div></div></div></div><div class="notifications-carousel__slide"><div class="notifications-carousel notifications-onboarding-carousel notifications-onboarding-carousel--js hidden" id="notifications-onboarding-carousel"><div class="notifications-carousel__wrap"><div class="notifications-carousel__slide notifications-carousel__slide--slide-0"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" role="heading" class="notifications__header notifications__header--js"><h2 class="notification-title notifications__title--js-1" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a role="link" class="notifications__settings--js" href="javascript:void(0)"><img role="img" class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings" aria-label="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation first-time" tabindex="0"><a role="link" aria-label="Notification title" tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-unread"></span></div><div class="notification-text notifications-11/12"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev inactive" data-slide="prev" tabindex="-1"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" role="link" class="notifications-carousel__controls--skip__link--js" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-1"><div class="notifications-favourites__container"><div class="notifications-favourites--preview"></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-2"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title notifications__title--js-3" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a role="link" class="notifications__settings--js" href="javascript:void(0)"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-music-icon"></div><span class="notification-dot notification-new"></span></div><div class="notification-text notifications-11/12 notification-new"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">Here&#39;s a new notification about an available music clip from one of your followed artists.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">Music</span> <span class="notification-time notifications-brevier">Just Now</span></div></div></div></a></li><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-read"></span></div><div class="notification-text notifications-11/12 notification-read"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">Simply click on an episode to start watching.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-3"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title enter-animation notifications__title--js-4" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a class="notifications__settings--js" href="javascript:void(0)"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div class="notifications-arrow-pointer enter-animation"></div><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-music-icon"></div><span class="notification-dot notification-new"></span></div><div class="notification-text notifications-11/12 notification-new"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">Here&#39;s a new notification about an available music clip from one of your followed artists.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">Music</span> <span class="notification-time notifications-brevier">Just Now</span></div></div></div></a></li><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-read"></span></div><div class="notification-text notifications-11/12 notification-read"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">Simply click on an episode to start watching.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div></div></div></div><div class="notifications-carousel__slide"><div class="on-boarding on-boarding--js on-boarding-last-slide hidden"><div aria-label="Close" class="on-boarding-close">&nbsp;</div><div class="notifications-fake"><div class="onboarding-image"></div><div class="notifications-top-header"><p class="notifications-main-header notifications-10/12" tabindex="0">Are you ready for notifications?</p></div><div class="notifications-cta"><div class="notification-sign-in"><a href="javascript:void(0)" role="link" class="notifications-sign-in__link--js notifications-pica"><span>Yes, I&#39;m in</span></a></div></div></div><div class="notifications-wide-spread"><div class="notifications-limitation-container"><div class="onboarding-image enter-animation"></div><div class="notifications-wide-spread--absolute"><div class="notifications-top-header"><p class="notifications-main-header notifications-main-header__are-you-ready--js notifications-10/12 enter-animation" tabindex="0">Are you ready for notifications?</p></div><div class="notifications-cta enter-animation first-time"><div class="notification-sign-in notifications-opt-in__link--js"><a href="javascript:void(0)" role="link" class="notifications-pica"><span>Yes, I&#39;m in</span></a></div><p class="notifications-pica"></p></div></div></div></div></div></div></div></div></div>'}),define("mybbc/templates/error",[],function(){return'<div class="notifications-error" id="hub-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, something has gone wrong.</p></div><p class="notifications-pica notifications-error__body">Thereâs been an error and your notifications<br>canât be displayed at the moment. Please try again later.</p></div><div class="notifications-error--inner" id="hub-error-inner"><p class="notifications-error--inner__body notifications-10/12">Sorry, something has gone wrong.<br>&nbsp;Your notifications could not be updated. Please try again later.</p><div class="notifications-error--inner__container"><div aria-label="Close notification error message" class="notifications-error--inner__close" aria-action="close">&nbsp;</div></div></div><div class="notifications-error" id="settings-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, something has gone wrong.</p></div><p class="notifications-pica notifications-error__body">Thereâs been an error and your notifications settings<br>cannot be retrieved. Please try again later.</p><div class="notifications-error__back" aria-action="close"><div class="notifications-error__back__arrow"></div><div class="notifications-error__back__text">Back</div></div></div><div class="notifications-error--inner" id="settings-error-inner"><p class="notifications-error--inner__body notifications-10/12">Sorry, something has gone wrong.<br>&nbsp;Your settings could not be updated. Please try again later.</p><div class="notifications-error--inner__container"><div aria-label="Close notification error message" class="notifications-error--inner__close" aria-action="close">&nbsp;</div></div></div><div class="notifications-error" id="onboarding-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, something has gone wrong.</p></div><p class="notifications-pica notifications-error__body">Thereâs been an error and we are unable to get you<br>started with notifications. Please try again later.</p></div>';
}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/classie",[],function(){return e()}):"undefined"!=typeof exports?module.exports=e():t.classie=e()}(this,function(){function t(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}function e(t,e){var a=i(t,e)?o:n;a(t,e)}var i,n,o;"classList"in document.documentElement?(i=function(t,e){return t.classList.contains(e)},n=function(t,e){var i=e.split(" ");t.classList.add(i[0]),i.length>1&&n(t,i.slice(1).join(" "))},o=function(t,e){var i=e.split(" ");t.classList.remove(i[0]),i.length>1&&o(t,i.slice(1).join(" "))}):(i=function(e,i){return t(i).test(e.className)},n=function(t,e){var o=e.split(" ");i(t,o[0])||(t.className=t.className+" "+o[0]),o.length>1&&n(t,o.slice(1).join(" "))},o=function(e,i){var n=i.split(" ");e.className=e.className.replace(t(n[0])," "),n.length>1&&o(e,n.slice(1).join(" "))});var a={hasClass:i,addClass:n,removeClass:o,toggleClass:e,has:i,add:n,remove:o,toggle:e};return a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/eventie",[],function(){return e()}):"undefined"!=typeof exports?module.exports=e():t.eventie=e()}(this,function(){return{isMatchingKeyEvent:function(t,e,i){if(t.type===e||"any"===e){var n=t.which||t.charCode;return"object"!=typeof i&&(i=[i]),-1!==i.indexOf(n)}return!1},addEvent:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i]))},removeEvent:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):(t.detachEvent("on"+e,t[e+i]),t[e+i]=null)},triggerEvent:function(t,e,i,n){var o=document.createEvent("Event");n=n||!1,""===o.type&&o.initEvent(e,!0,n),o.data=i||{},t.dispatchEvent(o)}}}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/logger",[],e):"undefined"!=typeof exports?module.exports=e():t.logger=e()}(this,function(){function t(t){var e;this.root.console&&this.isLoggingEnabled()&&(e=arguments.length>0?Array.prototype.slice.call(arguments,1):[],t=t.toLowerCase(),this.level="function"==typeof this.root.console[t]?t:"log",e[0]=this.getLogTitle()+" "+e[0],this.root.console[this.level].apply?this.root.console[this.level].apply(this.root.console,e):this.root.console.log&&this.root.console.log(e))}function e(t,e){var i;return e=e||[],i=Array.prototype.slice.call(e),i.unshift(t),i}var i=this,n=function(t,e){e=e||{},this.context=t||"No Context",this.root=window?window:i,this.mode=e.mode||n.defaults.mode,this.cookieName=e.cookieName||n.defaults.cookieName,this.level="log"};return n.defaults={mode:"cookie",cookieName:"ckps_notifications_log"},n.getLogger=function(t,e){return new this(t,e)},n.prototype={log:function(){t.apply(this,e("log",arguments))},info:function(){t.apply(this,e("info",arguments))},error:function(){t.apply(this,e("error",arguments))},warn:function(){t.apply(this,e("warn",arguments))},debug:function(){t.apply(this,e("debug",arguments))},getLogTitle:function(){return["[",this.context,":",this.level.toUpperCase(),"]"].join("")},isLoggingEnabled:function(){return"cookie"===this.mode?-1!==document.cookie.indexOf(this.cookieName):!0}},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/utils",[],function(){return e(t)}):"undefined"!=typeof exports?module.exports=e(t):t.utils=e(t)}(this,function(t){var e=function(t){t&&(this.logger=t)};return e.prototype={handledParse:function(t,e,i){try{return JSON.parse(t)}catch(n){return this.logger&&this.logger.error(n,t),"function"==typeof i&&i(),e||null}},extend:function(){function t(t,i){e[o][i]=r.isObject(t)?r.extend(e[o][i],t,a):t}var e,i,n,o,a,s=Array.prototype.slice.call(arguments),r=this;if(0===s.length)return{};n=s[s.length-1],a=n===!0,"boolean"==typeof n&&s.pop();for(var c=0;c<s.length;c++)if(i=r.keys(s[c]),0!==i.length)for(var l in s[c])a&&!s[c].hasOwnProperty(l)||(e=e||{},r.isArray(s[c][l])&&a?"undefined"!=typeof e[l]&&r.isArray(e[l])?(o=l,r.forEach(s[c][l],t)):e[l]=s[c][l].slice():r.isObject(s[c][l])&&a?e[l]=r.isObject(e[l])?r.extend(e[l],s[c][l],a):r.extend(s[c][l],a):null!==s[c][l]&&void 0!==s[c][l]&&(e[l]=s[c][l]));return e},forEach:function(t,e,i){i=i||null;for(var n=0,o=t.length;o>n;n++)n in t&&e.call(i,t[n],n,t)},truncate:function(t,e){return e=e||30,shortened=t.substring(0,e+1),t.length>e?-1==shortened.indexOf(" ")?shortened.substring(0,shortened.length-1)+"...":shortened.substr(0,Math.min(shortened.length,shortened.lastIndexOf(" ")))+" ...":t},each:function(t,e,i){i=i||null;if(this.isObject(t))for(var n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n)},bind:function(t,e){return"function"==typeof t?t.bind?t.bind(e):function(){t.apply(e,arguments)}:void 0},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},keys:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},isObject:function(t){return"object"==typeof t&&null!==t}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/NotificationsTemplate",e):"undefined"!=typeof exports?module.exports=e():t.NotificationsTemplate=e()}(this,function(){var t=function(){function t(e,i){var n;return n=i.split("."),1===n.length?e:t(e[n[1]],n.slice(1).join("."))}function e(t){this.setHtmlContent(t)}return e.prototype={setHtmlContent:function(t){this.htmlContent=t},getHtmlContent:function(){return this.htmlContent},compile:function(e){this.data=e||this.data;for(var i,n,o=this.data,a=/{{([A-Za-z0-9_@./#&+-]+)}}/gi,s=this.getHtmlContent();null!==(match=a.exec(s));){i=match[1];try{n=t(o,"templateData."+i)}catch(r){continue}s=s.replace(new RegExp(match[0],"g"),n)}return this.compiledHtml=s,this.compiledHtml}},e}(),e=function(t,e,i){i=i||{},this.name=t,this.templateParser=e,this.templateRequireBasePath=i.templateRequireBasePath||"mybbc/templates/",i.html?(this.templateParser.setHtmlContent(i.html),this.html(i.html),this.loaded(!0)):this.loaded(!1)};return e.create=function(e,i){return new this(e,new t,i)},e.prototype={getTemplateFullRequirePath:function(){return this.templateRequireBasePath+this.name},load:function(t,e){e=e||null;var i=this;require([this.getTemplateFullRequirePath()],function(n){i.templateParser.setHtmlContent(n),i.html(n),i.loaded(!0),"function"==typeof t&&t.call(e,i)})},compile:function(t){return this.templateParser.compile(t)},html:function(t){return t&&(this.data=t),this.data},loaded:function(t){return void 0!==t&&(this.isLoaded=t),t}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/ErrorView",["mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/NotificationsTemplate"],e):"undefined"!=typeof exports?module.exports=e(require("classie"),require("eventie"),require("logger"),require("utils"),require("NotificationsTemplate")):t.ErrorView=e(classie,eventie,logger,utils,NotificationsTemplate)}(this,function(t,e,i,n,o){var a=function(a){function s(){h.innerHTML=p.compile({baseAssetUrl:u.mainApp.basePath}),g=h.querySelector(u.showErrorWithID),r(g),t.add(g,"show"),u.isInner?e.addEvent(g.querySelector(u.errorCloseEl),"click",u.closeEvent):"function"==typeof u.closeEvent&&u.errorCloseEl&&(e.removeEvent(g.querySelector(u.errorCloseEl),"click",u.closeEvent),e.addEvent(g.querySelector(u.errorCloseEl),"click",u.closeEvent)),u.stateChanged&&u.stateChanged.call(u,"shown"),u.showErrorCallback&&u.showErrorCallback("shown")}function r(t){for(var i=t.querySelectorAll("p, [aria-action=close]"),n=0;n<i.length;n++)i[n].tabIndex=n+1,i[n].getAttribute("aria-action")&&(e.removeEvent(i[n],"keydown",c),e.addEvent(i[n],"keydown",c))}function c(t){13==t.keyCode&&"function"==typeof u.closeEvent&&u.closeEvent()}function l(t,e){g||u.currentErrorView!=t.view||(t=t||{},u.showErrorCallback=e,u.showErrorWithID=t.errorElID,u.isInner=t.isInner,u.closeEvent=t.closeEvent,u.currentErrorView=t.view,u.errorCloseEl=t.closeEl,u.accesibilityInstance=t.accesibilityInstance,h=t.extContainer||document.querySelector(u.container),p.loaded()?s():p.load(s))}function d(t,e){g&&u.currentErrorView==t&&(g.parentElement.removeChild(g),e&&u.stateChanged&&u.stateChanged("hidden"),g=null)}function f(t){u.currentErrorView=t,d(t,!0)}var u,h,p,g,m=new n,v=(new i("Error view"),{container:".notification-error__container",containerForInner:"#notifications-main",templateName:"error",currentErrorView:"main"});return u=m.extend(v,a),p=o.create(u.templateName),{showError:l,hideError:d,changeView:f}};return a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/analytics",["istats-1","mybbc/notifications/logger","mybbc/notifications/eventie","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("istats-1"),require("logger"),require("eventie")):t.Analytics=e(istats,logger,eventie)}(this,function(t,e,i,n){var o=e.getLogger("Notifications Analytics"),a=new n,s={track:function(e){return a.each(e,function(e,i){t.track(i,e),o.info("Analytics track",i,e)}),this},log:function(e,i,n){t.log(e,i,n),o.info("Analytics log event",e,i,n)},serialiseTopic:function(t){var e;return e=t.slice(0,5).join("!").replace(/urn:bbc:/g,"").replace(/:/g,"-"),e=t.length>5?e.concat("!more than 5"):e},listenTo:function(t,e,n){i.addEvent(t,e,a.bind(n,this))}};return s}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/carousel",e):"undefined"!=typeof exports?module.exports=e():(t.carousel=e(),(t.jQuery||t.Zepto)&&!function(e){e.fn.Swipe=function(i){return this.each(function(){e(this).data("Swipe",new t.Swipe(e(this)[0],i))})}}(t.jQuery||t.Zepto))}(this,function(){function t(t,e){function i(){C=A.children,T=C.length,C.length<2&&(e.continuous=!1),k.transitions&&e.continuous&&C.length<3&&(A.appendChild(C[0].cloneNode(!0)),A.appendChild(A.children[1].cloneNode(!0)),C=A.children),S=new Array(C.length),x=t.getBoundingClientRect().width||t.offsetWidth,A.style.width=C.length*x+"px";for(var i=C.length;i--;){var n=C[i];n.style.width=x+"px",n.setAttribute("data-index",i),k.transitions&&(n.style.left=i*-x+"px",f(i,j>i?-x:i>j?x:0,0))}e.continuous&&k.transitions&&(f(l(j-1),-x,0),f(l(j+1),x,0)),k.transitions||(A.style.left=j*-x+"px"),b()}function n(){k.addEventListener?((k.touch||k.isWindowsPhone())&&D&&(A.addEventListener("touchstart",z,!1),A.addEventListener("pointerdown",z,!1)),k.transitions&&(A.addEventListener("webkitTransitionEnd",z,!1),A.addEventListener("msTransitionEnd",z,!1),A.addEventListener("oTransitionEnd",z,!1),A.addEventListener("otransitionend",z,!1),A.addEventListener("transitionend",z,!1)),window.addEventListener("resize",z,!1)):window.onresize=function(){i()},I.length>0&&_(Array.prototype.slice.call(I),function(t){k.addEventListener?t.addEventListener("click",a,!1):t.attachEvent("onclick",a)}),P.length>0&&_(Array.prototype.slice.call(P),function(t,e){k.addEventListener?t.addEventListener("click",s,!1):t.attachEvent("onclick",s)})}function o(){I.length>0&&_(Array.prototype.slice.call(I),function(t){k.addEventListener?t.removeEventListener("click",a,!1):t.detachEvent("onclick",a)}),P.length>0&&_(Array.prototype.slice.call(P),function(t,e){k.addEventListener?t.removeEventListener("click",s,!1):t.detachEvent("onclick",s)})}function a(t){var i=this.dataset&&this.dataset.slide?this.dataset.slide:this.getAttribute("data-slide"),n=j;"next"==i?c():r(),"function"==typeof e.onControlclicked&&e.onControlclicked.call(this,t,j,n,A)}function s(t){var i=this.dataset&&this.dataset.slideTo?parseInt(this.dataset.slideTo,10):null!==this.getAttribute("data-slide-to")?parseInt(this.getAttribute("data-slide-to"),10):[].slice.call(this.parentNode.childNodes).indexOf(this);d(i),"function"==typeof e.onIndicatorclicked&&e.onIndicatorclicked(this,j,A)}function r(){e.continuous?d(j-1):j&&d(j-1)}function c(){e.continuous?d(j+1):j<C.length-1&&d(j+1)}function l(t){return(C.length+t%C.length)%C.length}function d(t,i){if(j!=t){if(k.transitions){var n=Math.abs(j-t)/(j-t);if(e.continuous){var o=n;n=-S[l(t)]/x,n!==o&&(t=-n*C.length+t)}for(var a=Math.abs(j-t)-1;a--;)f(l((t>j?t:j)-a-1),x*n,0);t=l(t),f(j,x*n,i||L),f(t,0,i||L),e.continuous&&f(l(t-n),-(x*n),0)}else t=l(t),h(j*-x,t*-x,i||L,N);j=t,w(e.callback&&e.callback(j,C[j]))}}function f(t,e,i,n){u(t,e,i,n),S[t]=e}function u(t,e,i,n){var o=C[t],a=o&&o.style;n=n||!1,a&&(a.webkitTransitionDuration=a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=i+"ms",a.webkitTransitionTimingFunction=a.MozTransitionTimingFunction=a.msTransitionTimingFunction=a.OTransitionTimingFunction=a.transitionTimingFunction=F[n?E.easing:N].css,a.webkitTransform="translate("+e+"px,0)translateZ(0)",a.msTransform=a.MozTransform=a.OTransform="translateX("+e+"px)")}function h(t,i,n,o){if(!n)return void(A.style.left=i+"px");var a=+new Date,s=function(){var c=+new Date-a;return c>n?(A.style.left=i+"px",R&&g(),A.style.height=C[j].offsetHeight+"px",e.transitionEnd&&e.transitionEnd.call(event,j,C[j]),void(r&&clearInterval(r))):(A.style.left=F[o].js(c,t,i-t,n)+"px",void(!r&&k.animationFrame&&window.requestAnimationFrame(s)))};if(k.animationFrame)window.requestAnimationFrame(s);else var r=setInterval(s,parseInt(1e3/60,10))}function p(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function g(){q=setTimeout(c,R)}function m(){R=0,clearTimeout(q)}function v(){t.style.visibility="hidden"}function b(){t.style.visibility="visible"}var y=function(){},w=function(t){setTimeout(t||y,0)},_=function(t,e,i){if(i=i||null,Array.prototype.forEach)return Array.prototype.forEach.call(t,e,i);for(var n=0,o=t.length;o>n;n++)n in t&&e.call(i,t[n],n,t)},k={addEventListener:!!window.addEventListener,animationFrame:!!window.requestAnimationFrame,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,isWindowsPhone:function(){return-1!==navigator.appVersion.indexOf("Win")&&"undefined"!=typeof window.navigator.pointerEnabled&&null!==navigator.userAgent.match(/.+windows.+(touch|phone).+/i)},transitions:function(t){var e=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var i in e)if(void 0!==t.style[e[i]])return!0;return!1}(document.createElement("swipe"))},E={startSlide:0,speed:300,continuous:!0,easing:"ease",draggable:!0,touchEvents:!0};if(t){e=e||{};var C,S,x,T,A=t.children[0],I=t.querySelectorAll(e.controlsSelector||'[data-slide][data-target-carousel="#'+t.id+'"]'),P=t.querySelectorAll(e.indicatorSelector||'[data-slide-to][data-target-carousel="#'+t.id+'"]'),j=parseInt(e.startSlide,10)||E.startSlide,L="undefined"!=typeof e.speed?e.speed:E.speed,N=e.easing||E.easing,M="undefined"!=typeof e.draggable?e.draggable:E.draggable,D="undefined"!=typeof e.touchEvents?e.touchEvents:E.touchEvents;e.continuous=void 0!==e.continuous?e.continuous:E.continuous;var q,O,F={easeInOutExpo:{css:"cubic-bezier(1, 0, 0, 1)",js:function(t,e,i,n){return 0===t?e:t>=n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e}},linear:{css:"linear",js:function(t,e,i,n){return 0===t?e:t>=n?e+i:i*(Math.floor(t/n*100)/100)+e}},ease:{css:"ease",js:function(t,e,i,n){var o;return 0===t?e:t>=n?e+i:(o=1.0042954579734844*Math.exp(-6.404173895841566*Math.exp(-7.290824133098134*(t/n))),i*o+e)}}},R=e.auto||0,U={},H={},B={},z={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"pointerdown":this.start(t);break;case"touchmove":this.move(t);break;case"pointermove":this.move(t);break;case"touchend":w(this.end(t));break;case"pointerup":w(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":w(this.transitionEnd(t));break;case"resize":w(i)}e.stopPropagation&&t.stopPropagation()},start:function(t){if(t.touches)var e=t.touches[0];var i=k.isWindowsPhone()?t.clientX:e.pageX,n=k.isWindowsPhone()?t.clientY:e.pageY;i&&n&&(U={x:i,y:n,time:+new Date},H={x:i,y:n},O=void 0,B={},A.addEventListener("touchmove",this,!1),A.addEventListener("touchend",this,!1),A.addEventListener("pointermove",this,!1),A.addEventListener("pointerup",this,!1))},move:function(t){if(window.navigator.pointerEnabled||!(t.touches.length>1||t.scale&&1!==t.scale)){if(e.disableScroll&&p(t),t.touches){var i=t.touches[0];H.x=i.pageX,H.y=i.pageY}else k.isWindowsPhone()&&(H.x=t.clientX?t.clientX:H.x,H.y=t.clientY?t.clientY:H.y);B={x:H.x-U.x,y:H.y-U.y},"undefined"==typeof O&&(O=!!(O||Math.abs(B.x)<Math.abs(B.y))),O||(p(t),m(),M&&(e.continuous?(u(l(j-1),B.x+S[l(j-1)],0),u(j,B.x+S[j],0),u(l(j+1),B.x+S[l(j+1)],0)):(B.x=B.x/(!j&&B.x>0||j==C.length-1&&B.x<0?Math.abs(B.x)/x+1:1),u(j-1,B.x+S[j-1],0),u(j,B.x+S[j],0),u(j+1,B.x+S[j+1],0))))}},end:function(t){var i=500,n=10,o=30,a=+new Date-U.time,s=Number(a)<i&&Math.abs(B.x)>n||Math.abs(B.x)>x*(o/100),r=Math.abs(L-Math.floor(Math.abs(B.x)/x*1.2*L));r=.5>r/L?.5*L:r/L>.75?.75*L:r;var c=!j&&B.x>0||j==C.length-1&&B.x<0,d=j;e.continuous&&(c=!1);var u=B.x<0;O||(s&&!c?(u?(e.continuous?(f(l(j-1),-x,0),f(l(j+2),x,0)):f(j-1,-x,0),f(j,S[j]-x,r),f(l(j+1),S[l(j+1)]-x,r),j=l(j+1)):(e.continuous?(f(l(j+1),x,0),f(l(j-2),-x,0)):f(j+1,x,0),f(j,S[j]+x,r),f(l(j-1),S[l(j-1)]+x,r),j=l(j-1)),e.callback&&e.callback(j,C[j])):e.continuous?(f(l(j-1),-x,L),f(j,0,L),f(l(j+1),x,L)):(f(j-1,-x,L),f(j,0,L),f(j+1,x,L)),e.onSwipe&&e.onSwipe(j,d,u?"right":"left")),A.removeEventListener("touchmove",z,!1),A.removeEventListener("touchend",z,!1),A.removeEventListener("pointermove",z,!1),A.removeEventListener("pointerup",z,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==j&&(R&&g(),A.style.height=C[j].offsetHeight+"px",e.transitionEnd&&e.transitionEnd.call(t,j,C[j]))}};return i(),R&&g(),n(),{setup:function(){i()},slide:function(t,e){m(),d(t,e)},prev:function(){m(),r()},next:function(){m(),c()},stop:function(){m()},getPos:function(){return j},getNumSlides:function(){return T},getActiveSlideEl:function(){return C[j]},hide:function(){v()},show:function(){b()},kill:function(){m(),A.style.width="",A.style.left="";for(var t=C.length;t--;){var e=C[t];e.style.width="",e.style.left="",k.transitions&&u(t,0,0)}k.addEventListener?(A.removeEventListener("touchstart",z,!1),A.removeEventListener("pointerdown",z,!1),A.removeEventListener("webkitTransitionEnd",z,!1),A.removeEventListener("msTransitionEnd",z,!1),A.removeEventListener("oTransitionEnd",z,!1),A.removeEventListener("otransitionend",z,!1),A.removeEventListener("transitionend",z,!1),A.removeEventListener("click",z,!1),window.removeEventListener("resize",z,!1)):window.onresize=null,o()}}}}return t}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/onboarding",["mybbc/notifications/analytics","mybbc/notifications/eventie","mybbc/notifications/utils","mybbc/notifications/carousel","mybbc/notifications/classie","mybbc/notifications/logger"],e):"undefined"!=typeof exports?module.exports=e(require("eventie"),require("utils"),require("carousel"),require("Logger")):t.onboarding=e(eventie,utils,carousel,classie,Logger)}(this,function(t,e,i,n,o,a){function s(t){t=t||{},B=W.extend(ct,t),H=B.carousels,h(),t.app&&(U=t.app),B.errorView&&(z=B.errorView,z.changeView("onboarding")),l(B.mainElSelector),x(),!NotificationsModernizr.cssanimations&&c()&&H.onboardingParent.carousel.hide(),d(),J=!0,B.resizeEvent(h),r()}function r(){Y=!1}function c(){return Y}function l(t){V=document.querySelector(t),V.style.display="block"}function d(){var t=document.querySelector(".notifications-opt-in__link--js"),i=document.querySelector(".notifications-start-onboarding__link--js"),n=Array.prototype.slice.call(document.querySelectorAll(".on-boarding-close")),o=Array.prototype.slice.call(document.querySelectorAll(".notifications-carousel__controls--button.control--prev")),a=Array.prototype.slice.call(document.querySelectorAll(".notifications-carousel__controls--button.control--next"));e.addEvent(t,"click",u),e.addEvent(i,"click",E),W.forEach(n,function(t){e.addEvent(t,"click",w)}),W.forEach(o,function(t){e.addEvent(t,"click",_)}),W.forEach(a,function(t){e.addEvent(t,"click",k)}),ft.startListeners()}function f(){var t=document.querySelector(".notifications-opt-in__link--js"),i=document.querySelector(".notifications-start-onboarding__link--js"),n=Array.prototype.slice.call(document.querySelectorAll(".on-boarding-close")),o=Array.prototype.slice.call(document.querySelectorAll(".notifications-carousel__controls--button.control--prev")),a=Array.prototype.slice.call(document.querySelectorAll(".notifications-carousel__controls--button.control--next"));e.removeEvent(t,"click",u),e.removeEvent(i,"click",E),W.forEach(n,function(t){e.removeEvent(t,"click",w)}),W.forEach(o,function(t){e.removeEvent(t,"click",_)}),W.forEach(a,function(t){e.removeEvent(t,"click",k)}),ft.stopListeners()}function u(){U.getUserPreferencesModel().updateUserOnBoarding(function(e,i){return e?(z.showError({view:"onboarding",isInner:!1,errorElID:"#onboarding-error-main"}),void K.error("Error updating user onboarding",e)):(t.log("finish","notifications-onboard"),void C())})}function h(){var t,e=document.querySelector(".orb-nav-pri-container"),i=document.querySelector(".notifications-carousel__wrap"),n=document.documentElement.clientWidth,o=document.documentElement.clientHeight,a=m(n,o,e.offsetHeight),s=400,r=p(/Mobile.*Firefox/g),c=p(/SamsungBrowser.*Mobile/g);n>o&&768>n?b(Q,Math.max(n,a-e.offsetHeight)+"px"):(t=r?-48:c?-96:0,b(Q,a-e.offsetHeight+t+"px")),b(i,"100%"),O(Q),NotificationsModernizr.cssanimations?A():setTimeout(v,s)}function p(t){return navigator.userAgent.match(t)&&navigator.userAgent.match(t).length>0}function g(){Z.style.top="",Z.setAttribute("style",""),Z.setAttribute("style","top: 0px"),O(Z);var t,e=getComputedStyle(Z),i=Q.clientWidth,n=Q.clientHeight,o=1008,a=800,s=750,r=1173,c=o/a,l=s/r,d=parseFloat(e.width,10),f=0,u=.15;768>i?(f=d/l,t=-(f-n)+(f*u-n/2)):(f=d/c,t=-(f-n/2)),Z.setAttribute("style","top: "+t+"px; height: "+f+"px")}function m(t,e,i){var n=419,o=1008,a=460+i;return e=e||Math.max(document.documentElement.clientHeight,window.innerHeight||0),n>=t?Math.max(e,a):o>t?Math.max(.7*e,a):a}function v(){H.onboardingParent.carousel.show(),A()}function b(t,e){t&&(t.setAttribute("data-orig-height",t.style.height),t.style.minHeight=e,t.style.height=e,t.style.maxHeight=e)}function y(){b(Q,Q.getAttribute("data-orig-height"))}function w(){"hidden"!==U.getDrawerState()&&U.navNotificationElement.click()}function _(){var e=X+1;1>=e||t.log("back"+e,"notifications-onboard")}function k(){var e=X+1;t.log("fwd"+e,"notifications-onboard")}function E(){rt||(U.isUserOnBoarded()?C():(D("onboardingParent").next(),rt=!0),t.log("start","notifications-onboard"))}function C(){NotificationsModernizr.cssanimations?(e.addEvent(V,S(),function(t){"hidden"!==U.getDrawerState()&&U.navNotificationElement.click(),U.prepareAndLaunchNotificationApp()}),o.add(V,"notifications-on-boarding--fadeout")):("hidden"!==U.getDrawerState()&&U.navNotificationElement.click(),U.prepareAndLaunchNotificationApp())}function S(){var t=document.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in e)if("undefined"!=typeof t.style[i])return e[i]}function x(){var t=H.onboardingParent.config;t.callback=dt.onboardingParentCasouselSlideChanged,t.transitionEnd=dt.onboardingParentCasouselSlideChangeFinished,M("onboardingParent",t),A(),T(),ft.checkInitialFocus()}function T(){for(var t=document.querySelectorAll(".notifications-wide-spread .enter-animation"),e=0;e<t.length;e++)O(t[e])}function A(){var t=document.querySelector("#notifications-main"),e=t.offsetHeight;document.querySelector("#orb-panels").style.height=e+"px"}function I(t){var e=H.onboarding.config;e.callback=t||dt.onboardingCasouselSlideChanged,e.onControlclicked=dt.onBoardingCarouselControlClicked,e.onSwipe=dt.onBoardingCarouselSwiped,M("onboarding",e);for(var i=0;i<st.length;i++)o.add(st[i],"first-time"),O(st[i])}function P(){return X}function j(t){X=t}function L(t){t.target.querySelector(et).innerHTML=lt[P()].title.replace(/'/g,"&#146;"),t.target.querySelector(it).innerHTML=lt[P()].body.replace(/'/g,"&#146;"),o.remove(Z,"enter-animation"),1===X&&(o.add(Z,"enter-animation"),g(),N()),2===X?(o.add(tt,"swing onboarding"),o.add(ot,"new-notifications onboarding")):(o.remove(tt,"swing onboarding"),1===X&&o.remove(ot,"new-notifications onboarding")),ft.setCarouselSlideFocus("onboarding",et)}function N(){var t,e=getComputedStyle(Z),i=e.backgroundImage,n=i.split(".gif").shift(),o=Z.style.top,a=Z.style.height;t="background-image: "+n.replace(/\"|\'/g,"")+".gif?_"+Date.now()+") !important;top: "+o+";height: "+a+";",Z.setAttribute("style",t)}function M(t,e){var i=document.querySelector(H[t].selector);return o.remove(i,"hidden"),H[t].carousel=n(i,e),H[t].carousel}function D(t){return H[t].carousel}function q(t){var e=document.querySelectorAll(".notifications-carousel__slide--slide-"+t+" .enter-animation");if(NotificationsModernizr.cssanimations){for(var i=0;i<e.length;i++)o.remove(e[i],"first-time");2===t&&(G=ut(e).animate(["fade-in-animation","move-down-animation"]));for(var n=0;n<at.length;n++)o.remove(at[n],"first-time swipe-left-in swipe-left-out swipe-right-out swipe-right-in");for(G=t<P()?ut(at).animate(["swipe-right-out","swipe-right-in"],L):ut(at).animate(["swipe-left-out","swipe-left-in"],L),n=-1;++n<at.length;)O(at[n])}else at[t].querySelector(et).innerHTML=lt[t].title.replace(/'/g,"&#146;"),at[t].querySelector(it).innerHTML=lt[t].body.replace(/'/g,"&#146;");j(t)}function O(t){var e=t.style.display,i=t.getAttribute("style");t.style.display="none",t.setAttribute("style","");t.offsetHeight;t.style.display=e,null!==i&&t.setAttribute("style",i)}function F(){if(H.onboarding.carousel){var t=document.querySelector(H.onboarding.selector);o.add(t,"hidden"),H.onboarding.carousel.slide(0,0),H.onboarding.config=ct.carousels.onboarding.config,H.onboarding.carousel.kill(),H.onboarding.carousel=void 0}H.onboardingParent.config=ct.carousels.onboardingParent.config,H.onboardingParent.carousel.kill(),j(0),J=!1,rt=!1,G&&G.unbindAll();for(var e=0;e<at.length;e++)at[e].className="",o.add(at[e],"notifications-carousel__content notifications-carousel__content--js"),at[e].querySelector(et).innerHTML=lt[0].title.replace(/'/g,"&#146;"),at[e].querySelector(it).innerHTML=lt[0].body.replace(/'/g,"&#146;"),O(at[e]);o.add(at[0],"first-time"),o.remove(Z,"enter-animation"),f(),N(),O(Z)}function R(t,e){var i=H.onboarding.carousel;e===i.getNumSlides()-1&&t===i.getNumSlides()-1&&(T(),H.onboardingParent.carousel.next())}var U,H,B,z,G,V,W=new i,K=new a("Onboarding"),J=!1,X=0,Y=!0,$=700,Z=document.querySelector(".notifications-favourites--preview"),Q=document.getElementById("notifications-main"),tt=document.getElementById("notification-link"),et=".notifications-carousel__header--js p",it=".notifications-carousel__description--js p",nt=".notifications-main-header__are-you-ready--js",ot=document.getElementById("not-num"),at=(document.querySelector(et),document.querySelector(it),document.querySelectorAll(".notifications-carousel__content--js")),st=document.querySelectorAll(".first-time"),rt=!1,ct={carousels:{onboardingParent:{selector:".notifications-onboarding-parent-carousel--js",config:{speed:$,easing:"easeInOutExpo",continuous:!1,draggable:!1,touchEvents:!1}},onboarding:{selector:".notifications-onboarding-carousel--js",config:{indicatorSelector:".notifications-carousel-pages__link--js",controlsSelector:".notifications-carousel__controls--js",speed:0,continuous:!1,draggable:!1}}}},lt=[{title:"Notifications appear here",body:"For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow."},{title:"You'll receive a notification...",body:"...when you add your favourite programme, a music artist, playlist, and in future much more."},{title:"Stay up to date",body:"You will get notifications whenever there's something new."},{title:"You're in charge",body:"You can manage the notifications you receive in settings."}],dt={onboardingParentCasouselSlideChangeFinished:function(t,e){var i={1:et,2:nt};ft.setCarouselSlideFocus("onboardingParent",i[t])},onboardingParentCasouselSlideChanged:function(t,e){var i=t,n=1===i&&"undefined"==typeof H.onboarding.carousel;n&&I(),2==t&&o.remove(e.querySelector(".on-boarding--js"),"hidden"),A()},onboardingCasouselSlideChanged:function(t,e){q(t)},onBoardingCarouselControlClicked:function(t,e,i){var n=this.getAttribute("data-slide");"next"===n&&R(e,i)},onBoardingCarouselSwiped:function(t,e,i){"right"==i&&R(t,e)}},ft=function(){function i(t){var e=t.which||t.keyCode;e==h?f=Date.now():e==p&&(u=Date.now())}function n(t){var e=t.which||t.keyCode;e==p&&t.shiftKey&&(t.preventDefault?t.preventDefault():t.returnValue=!1,U.navNotificationElement.click(),U.navNotificationElement.focus())}function o(t){var e=t.which||t.keyCode;e!=p||t.shiftKey||(t.preventDefault?t.preventDefault():t.returnValue=!1,d.setCarouselSlideFocus("onboarding",et,!1))}function a(e){var i=X+1;t.log("skip"+i,"notifications-onboard")}var s,r,c,l,d={},f=Date.now(),u=Date.now(),h=13,p=9,g=2e3;return d.checkInitialFocus=function(){s=document.querySelector(H.onboardingParent.selector+" .notifications-main-header__first--js"),r=document.querySelector(H.onboardingParent.selector+" "+nt),c=document.querySelector(H.onboardingParent.selector+" .notifications-description__first--js"),l=document.querySelectorAll(H.onboardingParent.selector+" .notifications-carousel__controls--skip__link--js");var t=Date.now();"undefined"!=typeof U.navNotificationElement.lastEnterPress&&t-U.navNotificationElement.lastEnterPress<g&&s.focus()},d.setCarouselSlideFocus=function(t,e,i){i=i!==!1;var n=Date.now();if(!(i&&n-f>=g))return"onboarding"==t?H[t].carousel.getActiveSlideEl().querySelector(e).focus():void document.querySelector(H[t].selector+" "+e).focus()},d.startListeners=function(){e.addEvent(document.querySelector(H.onboardingParent.selector),"keydown",i),e.addEvent(s,"keydown",n),e.addEvent(r,"keydown",n),W.forEach([].slice.call(document.querySelectorAll(et)),function(t){e.addEvent(t,"keydown",n)}),W.forEach([].slice.call(l),function(t){e.addEvent(t,"keydown",o)}),W.forEach([].slice.call(l),function(t){e.addEvent(t,"click",a)})},d.stopListeners=function(){e.removeEvent(document.querySelector(H.onboardingParent.selector),"keydown",i),e.removeEvent(s,"keydown",n),e.removeEvent(r,"keydown",n),W.forEach([].slice.call(document.querySelectorAll(et)),function(t){e.removeEvent(t,"keydown",n)}),W.forEach([].slice.call(l),function(t){e.removeEvent(t,"keydown",o)}),W.forEach([].slice.call(l),function(t){e.removeEvent(t,"click",a)})},d}(),ut=function(t){function i(){var t=document.createElement("fakeelement"),e={animation:"animationend",MozAnimation:"mozAnimationEnd",webkitAnimation:"webkitAnimationEnd",msAnimation:"msAnimationEnd"};for(var i in e)if("undefined"!=typeof t.style[i])return e[i]}function n(t,e,i){this.els=t,this.callback=i,this.classList=e}return t.length?(n.prototype={getElementNextAnimationClassInfo:function(t){for(var e=!1,i=0;i<this.classList.length;i++)if(!o.has(t,this.classList[i])){e=!0;break}return e?{index:i,className:this.classList[i]}:null},animationEndCallback:function(t){e.removeEvent(t.target,i(),this.animationEndCallbackBind);var n=this.getElementNextAnimationClassInfo(t.target);null!==n&&(n.index<this.classList.length-1&&e.addEvent(t.target,i(),this.animationEndCallbackBind),o.add(t.target,n.className)),this.callback&&this.callback.call(null,t)},start:function(){var t=-1;for(this.animationEndCallbackBind=W.bind(this.animationEndCallback,this);++t<this.els.length;)o.remove(this.els[t],this.classList.join(" ")),e.addEvent(this.els[t],i(),this.animationEndCallbackBind),o.add(this.els[t],this.classList[0])},unbindAll:function(){for(var t=-1;++t<this.els.length;)e.removeEvent(this.els[t],i(),this.animationEndCallbackBind)}},{animate:function(e,i){var o=new n(t,e,i);return o.start(),o}}):void K.error("No elements passed to sequencedAnimations");
},ht={panelOpenAnimationEnd:v,init:function(t){s(t)},getCarousel:function(t){return H[t]},initialised:J,resetOnboarding:F,removeCustomHeights:y};return ht}),function(t){function e(t){var e={val:t},i=t.split(/\s+in\s+/);return i[1]&&(e.val=x(0)+i[1],i=i[0].slice(x(0).length).trim().split(/,\s*/),e.key=i[0],e.pos=i[1]),e}function i(t,e,i){var n={};return n[t.key]=e,t.pos&&(n[t.pos]=i),n}function n(t,n,o){function a(t,e,i){h.splice(t,0,e),p.splice(t,0,i)}f(t,"each");var r,c=t.outerHTML,l=t.previousSibling,u=t.parentNode,h=[],p=[];o=e(o),n.one("update",function(){u.removeChild(t)}).one("premount",function(){u.stub&&(u=n.root)}).on("update",function(){var t=T(o.val,n);if(t){if(!Array.isArray(t)){var e=JSON.stringify(t);if(e==r)return;r=e,d(p,function(t){t.unmount()}),h=[],p=[],t=Object.keys(t).map(function(e){return i(o,e,t[e])})}d(h,function(e){if(e instanceof Object){if(t.indexOf(e)>-1)return}else{var i=y(t,e),n=y(h,e);if(i.length>=n.length)return}var o=h.indexOf(e),a=p[o];return a?(a.unmount(),h.splice(o,1),p.splice(o,1),!1):void 0});var f=[].indexOf.call(u.childNodes,l)+1;d(t,function(e,l){var d=t.indexOf(e,l),g=h.indexOf(e,l);if(0>d&&(d=t.lastIndexOf(e,l)),0>g&&(g=h.lastIndexOf(e,l)),!(e instanceof Object)){var m=y(t,e),v=y(h,e);m.length>v.length&&(g=-1)}var b=u.childNodes;if(0>g){if(!r&&o.key)var w=i(o,e,d);var _=new s({tmpl:c},{before:b[f+d],parent:n,root:u,item:w||e});return _.mount(),a(d,e,_),!0}return o.pos&&p[g][o.pos]!=d&&(p[g].one("update",function(t){t[o.pos]=d}),p[g].update()),d!=g?(u.insertBefore(b[f+g],b[f+(d>g?d+1:d)]),a(d,h.splice(g,1)[0],p.splice(g,1)[0])):void 0}),h=t.slice()}})}function o(t,e,i){m(t,function(t){if(1==t.nodeType){t.parentNode&&t.parentNode.isLoop&&(t.isLoop=1),t.getAttribute("each")&&(t.isLoop=1);var n=_(t);if(n&&!t.isLoop){for(var o,a=new s(n,{root:t,parent:e},t.innerHTML),r=n.name,c=e;!_(c.root)&&c.parent;)c=c.parent;a.parent=c,o=c.tags[r],o?(Array.isArray(o)||(c.tags[r]=[o]),c.tags[r].push(a)):c.tags[r]=a,t.innerHTML="",i.push(a)}d(t.attributes,function(i){/^(name|id)$/.test(i.name)&&(e[i.value]=t)})}})}function a(t,e,i){function o(t,e,n){if(e.indexOf(x(0))>=0){var o={dom:t,expr:e};i.push(u(o,n))}}m(t,function(t){var i=t.nodeType;if(3==i&&"STYLE"!=t.parentNode.tagName&&o(t,t.nodeValue),1==i){var a=t.getAttribute("each");return a?(n(t,e,a),!1):(d(t.attributes,function(e){var i=e.name,n=i.split("__")[1];return o(t,e.value,{attr:n||i,bool:n}),n?(f(t,i),!1):void 0}),_(t)?!1:void 0)}})}function s(t,e,i){function n(){d(Object.keys(S),function(t){f[t]=T(S[t],p||c)})}function s(t){if(d(b,function(e){e[t?"mount":"unmount"]()}),p){var e=t?"on":"off";p[e]("update",c.update)[e]("unmount",c.unmount)}}var r,c=C.observable(this),f=w(e.opts)||{},h=g(t.tmpl),p=e.parent,m=[],b=[],y=e.root,_=e.item,k=t.fn,E=y.tagName.toLowerCase(),S={};k&&y._tag&&y._tag.unmount(!0),y._tag=this,this._id=~~((new Date).getTime()*Math.random()),u(this,{parent:p,root:y,opts:f,tags:{}},_),d(y.attributes,function(t){S[t.name]=t.value}),h.innerHTML&&!/select/.test(E)&&(h.innerHTML=v(h.innerHTML,i)),this.update=function(t,e){u(c,t,_),n(),c.trigger("update",_),l(m,c,_),c.trigger("updated")},this.mount=function(){if(n(),k&&k.call(c,f),s(!0),a(h,c,m),c.parent||c.update(),c.trigger("premount"),k)for(;h.firstChild;)y.appendChild(h.firstChild);else r=h.firstChild,y.insertBefore(r,e.before||null);y.stub&&(c.root=y=p.root),c.trigger("mount")},this.unmount=function(t){var e=k?y:r,i=e.parentNode;if(i){if(p)Array.isArray(p.tags[E])?d(p.tags[E],function(t,e){t._id==c._id&&p.tags[E].splice(e,1)}):delete p.tags[E];else for(;e.firstChild;)e.removeChild(e.firstChild);t||i.removeChild(e)}c.trigger("unmount"),s(),c.off("*"),y._tag=null},o(h,this,b)}function r(e,i,n,o,a){n[e]=function(e){e=e||t.event,e.which=e.which||e.charCode||e.keyCode,e.target=e.target||e.srcElement,e.currentTarget=n,e.item=a,i.call(o,e)===!0||/radio|check/.test(n.type)||(e.preventDefault&&e.preventDefault(),e.returnValue=!1);var s=a?o.parent:o;s.update()}}function c(t,e,i){t&&(t.insertBefore(i,e),t.removeChild(e))}function l(t,e,i){d(t,function(t,n){var o=t.dom,a=t.attr,s=T(t.expr,e),l=t.dom.parentNode;if(null==s&&(s=""),l&&"TEXTAREA"==l.tagName&&(s=s.replace(/riot-/g,"")),t.value!==s){if(t.value=s,!a)return o.nodeValue=s;if(f(o,a),"function"==typeof s)r(a,s,o,e,i);else if("if"==a){var d=t.stub;s?d&&c(d.parentNode,d,o):(d=t.stub=d||document.createTextNode(""),c(o.parentNode,o,d))}else if(/^(show|hide)$/.test(a))"hide"==a&&(s=!s),o.style.display=s?"":"none";else if("value"==a)o.value=s;else if("riot-"==a.slice(0,5))a=a.slice(5),s?o.setAttribute(a,s):f(o,a);else{if(t.bool){if(o[a]=s,!s)return;s=a}"object"!=typeof s&&o.setAttribute(a,s)}}})}function d(t,e){for(var i,n=0,o=(t||[]).length;o>n;n++)i=t[n],null!=i&&e(i,n)===!1&&n--;return t}function f(t,e){t.removeAttribute(e)}function u(t,e,i){return e&&d(Object.keys(e),function(i){t[i]=e[i]}),i?u(t,i):t}function h(){if(t){var e=navigator.userAgent,i=e.indexOf("MSIE ");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):0}}function p(t,e){var i=document.createElement("option"),n=/value=[\"'](.+?)[\"']/,o=/selected=[\"'](.+?)[\"']/,a=e.match(n),s=e.match(o);i.innerHTML=e,a&&(i.value=a[1]),s&&i.setAttribute("riot-selected",s[1]),t.appendChild(i)}function g(t){var e=t.trim().slice(1,3).toLowerCase(),i=/td|th/.test(e)?"tr":"tr"==e?"tbody":"div",n=document.createElement(i);return n.stub=!0,"op"===e&&S&&10>S?p(n,t):n.innerHTML=t,n}function m(t,e){if(t)if(e(t)===!1)m(t.nextSibling,e);else for(t=t.firstChild;t;)m(t,e),t=t.nextSibling}function v(t,e){return t.replace(/<(yield)\/?>(<\/\1>)?/gim,e||"")}function b(t,e){return e=e||document,e.querySelectorAll(t)}function y(t,e){return t.filter(function(t){return t===e})}function w(t){function e(){}return e.prototype=t,new e}function _(t){return I[t.getAttribute("riot-tag")||t.tagName.toLowerCase()]}function k(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)}function E(t,e,i){var n=I[e],o=t.innerHTML;return t.innerHTML="",n&&t&&(n=new s(n,{root:t,opts:i},o)),n&&n.mount?(n.mount(),A.push(n),n.on("unmount",function(){A.splice(A.indexOf(n),1)})):void 0}var C={version:"v2.0.15",settings:{}},S=h();C.observable=function(t){t=t||{};var e={},i=0;return t.on=function(n,o){return"function"==typeof o&&(o._id="undefined"==typeof o._id?i++:o._id,n.replace(/\S+/g,function(t,i){(e[t]=e[t]||[]).push(o),o.typed=i>0})),t},t.off=function(i,n){return"*"==i?e={}:i.replace(/\S+/g,function(t){if(n)for(var i,o=e[t],a=0;i=o&&o[a];++a)i._id==n._id&&(o.splice(a,1),a--);else e[t]=[]}),t},t.one=function(e,i){function n(){t.off(e,n),i.apply(t,arguments)}return t.on(e,n)},t.trigger=function(i){for(var n,o=[].slice.call(arguments,1),a=e[i]||[],s=0;n=a[s];++s)n.busy||(n.busy=1,n.apply(t,n.typed?[i].concat(o):o),a[s]!==n&&s--,n.busy=0);return e.all&&"all"!=i&&t.trigger.apply(t,["all",i].concat(o)),t},t},function(t,e,i){function n(){return r.href.split("#")[1]||""}function o(t){return t.split("/")}function a(t){t.type&&(t=n()),t!=s&&(c.trigger.apply(null,["H"].concat(o(t))),s=t)}if(i){var s,r=i.location,c=t.observable(),l=i,d=!1,f=t.route=function(t){t[0]?(r.hash=t,a(t)):c.on("H",t)};f.exec=function(t){t.apply(null,o(n()))},f.parser=function(t){o=t},f.stop=function(){d&&(l.removeEventListener?l.removeEventListener(e,a,!1):l.detachEvent("on"+e,a),c.off("*"),d=!1)},f.start=function(){d||(l.addEventListener?l.addEventListener(e,a,!1):l.attachEvent("on"+e,a),d=!0)},f.start()}}(C,"hashchange",t);var x=function(t,e,i){return function(n){return e=C.settings.brackets||t,i!=e&&(i=e.split(" ")),n&&n.test?e==t?n:RegExp(n.source.replace(/\{/g,i[0].replace(/(?=.)/g,"\\")).replace(/\}/g,i[1].replace(/(?=.)/g,"\\")),n.global?"g":""):i[n]}}("{ }"),T=function(){function e(t,e){return t=(t||x(0)+x(1)).replace(x(/\\{/g),"ï¿°").replace(x(/\\}/g),"ï¿±"),e=o(t,a(t,x(/{/),x(/}/))),new Function("d","return "+(e[0]||e[2]||e[3]?"["+e.map(function(t,e){return e%2?i(t,!0):'"'+t.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':i(e[1])).replace(/\uFFF0/g,x(0)).replace(/\uFFF1/g,x(1))+";")}function i(t,e){return t=t.replace(/\n/g," ").replace(x(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),""),/^\s*[\w- "']+ *:/.test(t)?"["+a(t,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(t){return t.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(t,e,i){return i.replace(/[^&|=!><]+/g,n)+'?"'+e+'":"",'})}).join("")+'].join(" ").trim()':n(t,e)}function n(e,i){return e=e.trim(),e?"(function(v){try{v="+(e.replace(r,function(e,i,n){return n?"(d."+n+"===undefined?"+("undefined"==typeof t?"global.":"window.")+n+":d."+n+")":e})||"x")+"}finally{return "+(i===!0?'!v&&v!==0?"":v':"v")+"}}).call(d)":""}function o(t,e){var i=[];return e.map(function(e,n){n=t.indexOf(e),i.push(t.slice(0,n),e),t=t.slice(n+e.length)}),i.concat(t)}function a(t,e,i){var n,o=0,a=[],s=new RegExp("("+e.source+")|("+i.source+")","g");return t.replace(s,function(e,i,s,r){!o&&i&&(n=r),o+=i?1:-1,o||null==s||a.push(t.slice(n,r+s.length))}),a}var s={},r=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(t,i){return t&&(s[t]=s[t]||e(t))(i)}}(),A=[],I={};C.tag=function(t,e,i,n){return"function"==typeof i?n=i:i&&k(i),I[t]={name:t,tmpl:e,fn:n},t},C.mount=function(t,e,i){function n(t){var n=e||t.getAttribute("riot-tag")||t.tagName.toLowerCase(),o=E(t,n,i);o&&s.push(o)}var o,a=function(t){return t=Object.keys(I).join(", "),t.split(",").map(function(e){t+=', *[riot-tag="'+e.trim()+'"]'}),t},s=[];if("object"==typeof e&&(i=e,e=0),"string"==typeof t?("*"==t&&(t=a(t)),o=b(t)):o=t,"*"==e){if(e=a(t),o.tagName)o=b(e,o);else{var r=[];d(o,function(t){r=b(e,t)}),o=r}e=0}return o.tagName?n(t):d(o,n),s},C.update=function(){return d(A,function(t){t.update()})},C.mountTo=C.mount,C.util={brackets:x,tmpl:T},"object"==typeof exports?module.exports=C:"function"==typeof define&&define.amd?define("mybbc/notifications/vendor/riot.min",[],function(){return C}):t.riot=C}("undefined"!=typeof window?window:void 0),define("mybbc/notifications/config",[],function(){var t={feedBaseUrl:"//notifications.files.bbci.co.uk/",feedAggregatedInitialFeed:"latest.json",feedTopicInitialFeed:"latest.json",feedTopicMaxSubscriptions:-1,preferencesUrls:{get:"https://preferences.notifications.api.bbc.co.uk/subscriptions",postPreference:"https://preferences.notifications.api.bbc.co.uk/preference",postPreferenceRelay:"https://preferences.notifications.api.bbc.co.uk/preference/relay"},idcta:{urls:{signin:"https://ssl.bbc.co.uk/id/signin",register:"https://ssl.bbc.co.uk/id/register"}},notificationsPollingInterval:6e4,preferencesPollingInterval:6e4,lockExpiry:3e4,cacheTimeout:6e5,visibleChunkAmount:10,maxNotificationAge:5},e={env:t};return e}),function(t){function e(t,e){var i;"number"!=typeof t&&(i=t,t=32*i.length);var n=Math.ceil(t/32),o=-1;if(this.m=t=32*n,this.k=e,a){var s=1<<Math.ceil(Math.log(Math.ceil(Math.log(t)/Math.LN2/8))/Math.LN2),r=1===s?Uint8Array:2===s?Uint16Array:Uint32Array,c=new ArrayBuffer(s*e),l=this.buckets=new Int32Array(n);if(i)for(;++o<n;)l[o]=i[o];this._locations=new r(c)}else{var l=this.buckets=[];if(i)for(;++o<n;)l[o]=i[o];else for(;++o<n;)l[o]=0;this._locations=[]}}function i(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function n(t){for(var e,i,n=t.length,o=2166136261,a=-1;++a<n;)e=t.charCodeAt(a),(i=4278190080&e)&&(o^=i>>24,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),(i=16711680&e)&&(o^=i>>16,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),(i=65280&e)&&(o^=i>>8,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),o^=255&e,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return o+=o<<13,o^=o>>7,o+=o<<3,o^=o>>17,o+=o<<5,4294967295&o}function o(t){return t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24),t+=t<<13,t^=t>>7,t+=t<<3,t^=t>>17,t+=t<<5,4294967295&t}t.BloomFilter=e,t.fnv_1a=n,t.fnv_1a_b=o;var a="undefined"!=typeof ArrayBuffer;e.prototype.locations=function(t){for(var e=this.k,i=this.m,a=this._locations,s=n(t),r=o(s),c=-1,l=s%i;++c<e;)a[c]=0>l?l+i:l,l=(l+r)%i;return a},e.prototype.add=function(t){for(var e=this.locations(t+""),i=-1,n=this.k,o=this.buckets;++i<n;)o[Math.floor(e[i]/32)]|=1<<e[i]%32},e.prototype.test=function(t){for(var e,i=this.locations(t+""),n=-1,o=this.k,a=this.buckets;++n<o;)if(e=i[n],0===(a[Math.floor(e/32)]&1<<e%32))return!1;return!0},e.prototype.size=function(){for(var t=this.buckets,e=0,n=0,o=t.length;o>n;++n)e+=i(t[n]);return-this.m*Math.log(1-e/this.m)/this.k},define("mybbc/notifications/vendor/bloomfilter",[],function(){return e})}("undefined"!=typeof exports?exports:this),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/BloomFilterManager",["mybbc/notifications/vendor/bloomfilter","mybbc/notifications/logger","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("vendor/bloomfilter"),require("logger"),require("utils")):t.BloomFilterManager=e(bloomfilter,logger,utils)}(this,function(t,e,i){var n=(new e("Bloom Filter Manager"),new i),o=8192,a=function(e){this.filterName=e,this.filter=new t(o,16)};return a.prototype.override=function(e){"string"==typeof e&&""!==e&&(e=n.handledParse(e,[])),n.isArray(e)&&0===e.length&&(e=o),this.filter=new t(e,16)},a.prototype.add=function(t){t&&""!==t&&this.filter.add(t)},a.prototype.getCleanArray=function(){return[].slice.call(this.filter.buckets)},a.prototype.contains=function(t){return t&&""!==t?this.filter.test(t):!1},a.prototype.checkOrAdd=function(t){t&&""!==t&&(this.contains(t)||this.add(t))},a}),define("mybbc/notifications/AccessibilityManager",["require","mybbc/notifications/eventie","mybbc/notifications/classie"],function(t){function e(t){b=document.querySelector(".notification-title"),y=document.querySelector(".notification-header-icons a"),p=document.getElementById("notification-link")||{},g=document.querySelector("#orb-nav-links .orb-nav-news a")||{},w=t.iconHiddenTextEl,_=t.iconAriaLiveEl,k=t._getDrawerStateChecker(),d(),a()}function i(){"shown"!==k()||v||(p.click(),h(),p.tabIndex=null,v=!1)}function n(){v=!0,"hidden"!==k()&&d()}function o(t){var e=t.keyCode===C,i=t.keyCode===x;(e||i)&&document.querySelector(".notifications__settings--js").focus()}function a(){p.onclick=n,p.onfocus=i,T.addEvent(p,"keyup",o)}function s(t){"undefined"!=typeof w&&(w.textContent=t)}function r(t){"undefined"!=typeof _&&(_.textContent=t)}function c(){return m={init:e,updateIconHiddenText:s,updateIconAriaLiveText:r}}function l(){return m||c()}function d(){E||(T.addEvent(window,"keyup",f),T.addEvent(window,"keydown",u),null===g.onfocus&&(g.onfocus=function(){h()}),E=!0)}function f(t){t.preventDefault&&t.preventDefault(),t.keyCode===S&&document.activeElement===g&&h()}function u(t){var e=t.keyCode===S,i=t.keyCode===C;return e&&!t.shiftKey&&"notifications-keyboard-access--close"===document.activeElement.className?(document.querySelector(".notifications__settings--js").focus(),t.preventDefault(),!1):e&&t.shiftKey&&"notifications__settings--js"===document.activeElement.className?(document.querySelector(".notifications-keyboard-access--close").focus(),t.preventDefault(),!1):void(i&&A.has(document.activeElement,"notification-item")&&document.activeElement.click())}function h(){g.onfocus=null,T.removeEvent(window,"keyup",f),T.removeEvent(window,"keydown",u),E=!1}var p,g,m,v,b,y,w,_,k,E=!1,C=13,S=9,x=32,T=t("mybbc/notifications/eventie"),A=t("mybbc/notifications/classie");return{getInstance:l}}),function(t){function e(t){return function(t){return t.getHours()+":"+(t.getMinutes().toString().length<2?"0":"")+t.getMinutes()}(new Date(t))}function i(t){return l[new Date(t).getDay()]}function n(t){return d.toDateString()===new Date(t).toDateString()}function o(t){return 1==a(t)}function a(t){return new Date(t).getDay()-d.getDay()}function s(t){var e=new Date;return e.setDate(e.getDate()-t),e}function r(t){t instanceof Date==!1&&(t=new Date(t));var e=Math.abs(t.getTime()-d.getTime());return Math.ceil(e/864e5)}function c(t){d=new Date(t)}var l=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),d=new Date,f={getClockTime:e,getWeekday:i,isToday:n,isTomorrow:o,getDayDifference:a,howOld:r,goBackDays:s,setTime:c,serverTime:d};"undefined"!=typeof define&&define.amd?define("mybbc/notifications/DateManager",[],function(){return f}):"undefined"!=typeof f?module.exports=f:t.DateManager=f}(this),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/PreferencesClient",["require","mybbc/notifications/logger","mybbc/notifications/utils"],function(t){var i=new(t("mybbc/notifications/logger"))("Preferences Client"),n=new(t("mybbc/notifications/utils"))(i);return e(n,i)}):"undefined"!=typeof exports?module.exports=e():t.PreferencesClient=e()}(this,function(t,e){var i=function(e,n){this.requestClient=e,this.settings=t.extend(i.defaults,n),this._setRequestMap(this._getConfig()),this.setLastRequestInfo({error:!1})};return i.defaults={},i.prototype={fetch:function(t){this.callback=t,this._call(this._isCORSBrowser()?"get":"getJSONP",{},this._preferencesRequestSuccessCallback(),this._preferencesRequestErrorCallback())},updatePreferences:function(t,e){return this._preferencesDataValid(t)?(this.callback=e,void this._call(this._isCORSBrowser()?"postPreference":"postPreferenceRelay",t,this._preferencesRequestSuccessCallback(),this._preferencesRequestErrorCallback())):null},_isXHRCorsSupported:function(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest},_call:function(t,e,i,n){var o=this._getRequestParams(t);"undefined"!=typeof e&&(o.data=e),"postRelay"===o.dataType&&(o.callback=this.callback),req=this.requestClient.create(o),req.done(i).fail(n).send()},_getRequestParams:function(t){return t in this.requestMap?this.requestMap[t]:{}},_setRequestMap:function(t){this.requestMap={get:{url:t.env.preferencesUrls.get,useCookies:!0,ignoreHeaders:!0,dataType:"json"},getJSONP:{url:t.env.preferencesUrls.get,useCookies:!0,ignoreHeaders:!0,dataType:"jsonp",jsonpCallback:"preferencesCallback"+Date.now()},postPreference:{type:"POST",url:t.env.preferencesUrls.postPreference,useCookies:!0,ignoreHeaders:!0,dataType:"json",contentType:"application/json"},postPreferenceRelay:{type:"POST",url:t.env.preferencesUrls.postPreferenceRelay,useCookies:!0,ignoreHeaders:!0,dataType:"postRelay",contentType:"application/json"}}},_preferencesRequestSuccessCallback:function(){var i=this;return function(n){var o,a,s,r=arguments.length>0?Array.prototype.slice.call(arguments):[];r.unshift(null);try{o="object"==typeof n?n:t.handledParse(""===n?"{}":n),s="status"in o&&200!=o.status,s&&(a="preferences.jsonp.call.error."+o.status,e.error(a),i.setLastRequestInfo({error:!0,info:a})),"function"==typeof i.callback&&(i.callback.call(i,null,o.response||o),i.setLastRequestInfo({error:!1,info:o.response||o}))}catch(c){e.error("Error caught after fetching preferences",c),"function"==typeof i.callback&&i.callback.call(i,!0,c),i.setLastRequestInfo({error:!0,info:c})}}},_preferencesRequestErrorCallback:function(){var t=this;return function(e,i,n){var o=arguments.length>0?Array.prototype.slice.call(arguments):[];o.unshift(!0),t.setLastRequestInfo({error:!0,info:o}),"function"==typeof t.callback&&t.callback.apply(t,o)}},getLastRequestInfo:function(){return this.lastRequestInfo},setLastRequestInfo:function(t){this.lastRequestInfo=t},_isCORSBrowser:function(){return this._isXHRCorsSupported()&&-1===window.navigator.userAgent.indexOf("Automated Test UserAgent")},_preferencesDataValid:function(t){var i="undefined"!=typeof t&&"undefined"!=typeof t.readFilter&&"undefined"!=typeof t.lastReadFlag;return i||e.error("Preferences data validation failed",t),i},_getConfig:function(){return this.settings.config||{}}},i}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/LocalStorageCache",e):"undefined"!=typeof exports?module.exports=e():t.LocalStorageCache=e()}(this,function(){function t(){return!!NotificationsModernizr.localstorage}var e=function(e){var i="mybbc_notifications_";return{get:function(){return t()?localStorage.getItem(i.concat(e)):null},put:function(n){t()&&localStorage.setItem(i.concat(e),n)},clear:function(){t()&&localStorage.removeItem(i.concat(e))}}};return e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/StorageManager",["mybbc/notifications/config","mybbc/notifications/utils","mybbc/notifications/LocalStorageCache"],e):"undefined"!=typeof exports?module.exports=e():t.StorageManager=e()}(this,function(t,e,i){var n=new e,o=function(t){this.storeKey=t,this.storeKeyCache=i(this.storeKey),this.lockCache=i("lockPolling"),this.initialised=!1};return o.prototype={model:{cacheTimeout:null,preferences:null,subscriptions:null},isEnabledLocalStorage:function(){return!!NotificationsModernizr.localstorage},init:function(){this.params={cacheTimeout:t.env.cacheTimeout,cachedData:this.getCached(),preferencesPollingInterval:this.isEnabledLocalStorage()?t.env.preferencesPollingInterval:2*t.env.preferencesPollingInterval},this.initialised=!0},getCached:function(){var t=this.get();return"object"!=typeof t&&""!==t&&null!==t?n.handledParse(t,this.model):t},hasCache:function(){return this.getCached()!==this.model},checkExpired:function(){return this.hasExpired(this.params.cachedData)},lock:function(e){this.lockCache.put(JSON.stringify({locked:e,timestamp:Date.now()+t.env.lockExpiry}))},unlock:function(){this.lock(!1)},get:function(t){var e=this.storeKeyCache.get();return e=e?n.handledParse(e,this.model):this.model,t&&delete e.cacheTimeout,e},clear:function(){this.storeKeyCache.clear(),this.lockCache.clear(),this.init()},set:function(t){var e=this.clone(t);(!e||"string"==typeof e&&""===e)&&(e=this.model),e.cacheTimeout||(e.cacheTimeout=Date.now()+this.params.cacheTimeout),this.storeKeyCache.put(JSON.stringify(e)),this.unlock(),this.params.cachedData=this.getCached()},hasExpired:function(t){return this.isEnabledLocalStorage()?!t.cacheTimeout||new Date-new Date(t.cacheTimeout)>=0:!0},isLocked:function(){if(!this.isEnabledLocalStorage())return!1;var t=this.lockCache.get();return t=t?n.handledParse(t,{locked:!1,timestamp:Date.now()}):{locked:!1,timestamp:Date.now()},new Date-new Date(t.timestamp)>=0?(this.unlock(),!1):t.locked},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},o}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/UserPreferences",["require","mybbc/notifications/StorageManager","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/DateManager"],function(t){var i=t("mybbc/notifications/StorageManager"),n=new(t("mybbc/notifications/logger"))("UserPreferences"),o=new(t("mybbc/notifications/utils"))(n),a=t("mybbc/notifications/DateManager");return e(i,o,n,a)}):"undefined"!=typeof exports?module.exports=e(require("StorageManager"),require("utils"),require("logger"),require("dateManager")):t.UserPreferences=e(StorageManager,utils,logger,dateManager)}(this,function(t,e,i,n){var o=function(i){this.settings=i,this.client=i.client,this.idcta=i.idcta,this.cacheManager=i.cacheManager||new t("cachedPreferences"),this.cacheManager.initialised||this.cacheManager.init(),this.defaultAttributes={subscriptions:[],preferences:{lastRead:n.goBackDays(this.client._getConfig().env.maxNotificationAge).toISOString(),readFilter:this.settings.filter.getCleanArray(),productsEnabled:o.defaultProductsEnabled}},this.attributes=e.extend(this.defaultAttributes),this.setFetchLastCallInfo({error:!1})};return o.defaultProductsEnabled=[{product:"IPLAYER",enabled:!0},{product:"MUSIC",enabled:!0}],o.HAS_ON_BOARDED_PARAM_NAME="hasOnboarded",o.prototype={get:function(t){return NotificationsModernizr.localstorage?(this.attributes=e.extend(this.attributes,this.cacheManager.get(t),!0),this.attributes):this.attributes},set:function(t){null!==t.preferences&&"undefined"!=typeof t.preferences.productsEnabled&&this.fixProductsEnabledData(t),this.attributes=e.extend(this.attributes,t,!0),NotificationsModernizr.localstorage&&this.cacheManager.set(this.attributes),i.info("Updated localStorage/object cache with new preferences data",this.attributes)},fixProductsEnabledData:function(t){var i,n=o.defaultProductsEnabled.slice();i=null!==t.preferences.productsEnabled?t.preferences.productsEnabled:[],e.forEach(n,function(t){e.forEach(i,function(e){t.product===e.product&&(t.enabled=e.enabled)},this)}),t.preferences.productsEnabled=n},fetch:function(t){var e=this;!this.cacheManager.checkExpired()||this.cacheManager.isLocked()?(i.info("Serving user preferences from localStorage"),t(null,e.get(!0))):this.callService(t)},callService:function(t){var e=this;this.client.fetch(function(n,o){return e.setFetchLastCallInfo(e.client.getLastRequestInfo()),n?(i.log("Error reading user preferences",arguments),t(!0,e.get(!0))):(i.info("Successfully fetched user preferences from service",o),e.cacheManager.lock(!0),e._saveData(o),void t(null,o))})},isPollingEnabled:function(){return this.idcta.hasCookie()},poll:function(t){this.isPolling=!0;var e=this,n=this.cacheManager.params.preferencesPollingInterval;this.cacheManager.params.pollingFn=function(){e.isPollingEnabled()&&e.fetch(t)},e.isPollingEnabled()?(this.pollingIntervalFn=setInterval(this.cacheManager.params.pollingFn,n),i.info("Polling on user preferences started, it will happen every %s seconds, next polling is at [%s]",n/1e3,new Date(Date.now()+n))):clearInterval(this.pollingIntervalFn)},sync:function(t,n){var o=this,a=this.get(!0);return a.preferences=e.extend(a.preferences,{readFilter:this.settings.filter.getCleanArray()},{lastReadFlag:!1},t.preferences,!0),this.isPollingEnabled()?void this.client.updatePreferences(this._prepareData(a.preferences),function(t,s){"string"==typeof t&&(t=e.handledParse(t,!0)),t&&void 0===t.status?(i.error("Error syncing user preferences",arguments),"function"==typeof n&&n(!0,s)):(t=null===t?{status:200}:t,t.status>304?(i.error("Error syncing user preferences",arguments),"function"==typeof n&&n(!0,s)):(a.preferences.lastRead=(new Date).toISOString(),a.preferences.currentDateTime=(new Date).toISOString(),delete a.lastReadFlag,o.set(a),i.info("Success syncing preferences",s),"function"==typeof n&&n(null,s)))}):void i.info("Attempted to sync preferences while logged out")},updateProductEnabled:function(t,e,i){for(var n=this.get().preferences,o=!1,a={product:t.toUpperCase(),enabled:e},s=0;s<n.productsEnabled.length;s++)t.toUpperCase()==n.productsEnabled[s].product&&(o=!0,n.productsEnabled[s].enabled=e);o||n.productsEnabled.push(a),this.sync({preferences:{productsEnabled:n.productsEnabled.slice()}},i)},getProducts:function(){var t=this.get().preferences;return t.productsEnabled},getEnabledProducts:function(){for(var t=this.getProducts(),e=[],i=0;i<t.length;i++)t[i].enabled&&e.push(t[i].product);return e},updateUserOnBoarding:function(t){this.sync({preferences:{hasOnboarded:!0,lastReadFlag:!0}},t)},_prepareData:function(t){var i=e.extend({},t);return"object"==typeof t.readFilter&&t.readFilter instanceof Array&&(i.readFilter=JSON.stringify(t.readFilter)),delete i.lastRead,delete i.currentDateTime,i},_saveData:function(t){this.set(t),null!==t.preferences&&"undefined"!=typeof t.preferences.readFilter&&this.settings.filter.override(t.preferences.readFilter)},_getActiveSubscriptions:function(t){var i={};return t=t||this.get(!0).subscriptions,t&&e.forEach(t,function(t){t.enabled&&(i[t.topic]=t)},this),i},_countActiveSubscriptions:function(){var t=0,i=this.get(!0).subscriptions;return i&&e.forEach(i,function(e){e.enabled&&t++},this),t},setFetchLastCallInfo:function(t){this.fetchLastCallInfo=t},getFetchLastCallInfo:function(){return this.fetchLastCallInfo}},o}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/popup",["mybbc/notifications/classie","mybbc/notifications/eventie"],e):"undefined"!=typeof exports?module.exports=e(require("classie"),require("eventie")):t.popup=e(classie,eventie)}(this,function(t,e){var i={unseenLatestDataCount:0,state:"hidden",lastWrapperScrollPos:0,defaults:{showDuration:2},eventie:e,classie:t,init:function(t){t=t||{},this.el=t.el||null,this.containerEl=t.containerEl||null,this.notificationItemsSelector=t.notificationItemsSelector||null,this.wrapperEl=t.wrapperEl||null,this.mainApp=t.mainApp||null,this.showDuration=t.showDuration||this.defaults.showDuration||null,this.setEventListeners()},setEventListeners:function(){this.eventie.addEvent(this.el,"click",this._onNotificationPopupClicked())},html:function(t){this.el.innerHTML=t},check:function(){var t=this;if(0!==this.unseenLatestDataCount)return this.wrapperEl.scrollTop>=this._getLatestAddedItemHeights()-15&&"hidden"!=this.mainApp.getDrawerState()?(this.html(this.unseenLatestDataCount+" NEW notification(s)"),"shown"!=this.state?this.show():void(this.wrapperEl.scrollTop<this.lastWrapperScrollPos&&!this.hideTimeout&&(this.hideTimeout=setTimeout(function(){"hidden"!=t.state&&t.hide()},2e3)))):void("hidden"!=this.state&&this.hide())},_getLatestAddedItemHeights:function(){for(var t,e=0,i=document.querySelectorAll(this.notificationItemsSelector),n=-1;++n<this.unseenLatestDataCount&&(t=i[n]);)e+=t.offsetHeight;return e},_onNotificationPopupClicked:function(){var t=this;return function(e){t.wrapperEl.scrollTop=0,t.hide()}},hide:function(){this.classie.remove(this.containerEl,"has-new"),this.state="hidden",this.hideTimeout&&clearTimeout(this.hideTimeout),this.unseenLatestDataCount=0},show:function(){this.classie.add(this.containerEl,"has-new"),this.state="shown",this.lastWrapperScrollPos=this.wrapperEl.scrollTop}};return i}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/AbstractCollection",["mybbc/notifications/eventie","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("eventie"),require("mybbc/notifications/eventie")):t.AbstractCollection=e(eventie,utils)}(this,function(t,e){var i=new e,n=function(t,e){t=t||[],this.models=t,this.eventCallbacks={},this.modelIds=Array.prototype.concat.call([],Array.prototype.map.call(t,function(t){return t.id}))||[],this.initialise(e)};return n.extend=function(t){var e=function(){n.apply(this,arguments)};return t=t||{},e.prototype=i.extend(new n(t.models),t),e.prototype.constructor=e,e},n.prototype={type:"AbstractCollection",url:"",model:null,getType:function(){return this.type},initialise:function(t){return this},setUrl:function(t){this.url=t},toJSON:function(){var t=[];return this.isEmpty()?t:(this.each(function(e){t.push(e.toJSON())}),t)},toArray:function(){return this.models},fetch:function(t){return this},bind:function(t){var e=this;return"undefined"!=typeof Function.prototype.bind?t.bind(this):function(){t.apply(e,arguments)}},parse:function(t){return t},filter:function(){return this},success:function(){return this},fail:function(){return this},first:function(){return this.isEmpty()?{}:this.models.slice(0,1)[0]},last:function(){return this.isEmpty()?{}:this.models.slice(-1)[0]},at:function(t){return this.isEmpty()?{}:this.models.slice(t,t+1)[0]},indexOf:function(t){var e=-1;return this.each(function(i,n){i.id==t&&(e=n)}),e},isEmpty:function(){return 0===this.models.length},add:function(t){return this},each:function(t){if(!this.isEmpty()){var e=Array.prototype.forEach||function(t){for(var e=-1;++e<this.length;)t(this[e],e)};e.call(this.models,t)}},has:function(t){return this.modelIds.indexOf(t)>=0},on:function(e,i,n){var o;n=n||null,i=i||function(){},o=this.getEventCallbackHash(e,i),this.eventCallbacks[o]=function(t){i.call(n,t,t.data)},t.addEvent(document,e,this.eventCallbacks[o])},off:function(e,i,n){var o;o=this.getEventCallbackHash(e,i),o in this.eventCallbacks&&t.removeEvent(document,e,this.eventCallbacks[o])},trigger:function(e,i,n){t.triggerEvent(document,e,i,n)},getEventCallbackHash:function(t,e){return escape(t+e.toString().slice(0,150))},hasLoadedAllPages:function(){return!0}},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/models/AbstractModel",e):"undefined"!=typeof exports?module.exports=e():t.AbstractModel=e();
}(this,function(){function t(){var t=-1,e={};if(!arguments)return{};for(;++t<arguments.length;){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}var e=function(t,e){this.attributes=t||{},this.id=this.attributes[this.idAttribute]||void 0,this.initialise(e)};return e.extend=function(i){var n=function(){e.apply(this,arguments)};return i=i||{},n.prototype=t(new e(i.models),i),n.prototype.constructor=n,n},e.prototype={idAttribute:"id",initialise:function(t){return this},toJSON:function(){return this.attributes},get:function(t){return"undefined"!=typeof this.attributes[t]?this.attributes[t]:void 0},set:function(t,e){this.attributes[t]=e},fill:function(t){if(this.attributes=t,!(this.idAttribute in this.attributes))throw new Error("Can not fill model with no id");this.id=this.attributes[this.idAttribute]},isEmpty:function(){return 0===Object.keys(this.attributes).length}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/models/NotificationModel",["mybbc/notifications/models/AbstractModel"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractModel")):t.NotificationModel=e(AbstractModel)}(this,function(t){var e=t.extend({});return e}),define("mybbc/notifications/vendor/relay",[],function(){function t(t,e){var i,n="__iframe_"+ ++s.frameCount,o=document.createElement("iframe");o.setAttribute("name",n),o.style.cssText="visibility: hidden; position: absolute; height: 0; width: 0;",o.id=n,document.body.appendChild(o),o.attachEvent?o.attachEvent("onload",function(){t(o)}):o.onload=function(){t(o)},o.src=e,i=frames[n],i.name=n,"about:blank"===e&&(i.document.open(),i.document.write("<html></html>"),i.document.close())}function e(t){t.parentNode.removeChild(t)}function i(t,e,i,o){function a(){t.loadcount++,"function"==typeof t.handleLoad&&t.handleLoad()}var s,r,c,l;t.callback=o||function(){},r=t.document.createElement("script"),c="var eventMethod = window.addEventListener? 'addEventListener' : 'attachEvent',    eventListener = window[eventMethod],    eventName = (eventMethod === 'attachEvent')? 'onmessage' : 'message';var messageCount = 0, messageHandler = function(e) { if (messageCount++) {return}; self.callback(e.data); return false;  }; eventListener(eventName, messageHandler, false);loadcount = 0; function handleLoad(){};",r.type="text/javascript";try{r.appendChild(t.document.createTextNode(c))}catch(d){r.text=c}t.document.body.appendChild(r);try{s=t.document.createElement('<iframe name="myIframe"/>')}catch(d){s=t.document.createElement("iframe")}s.src="about:blank",s.attachEvent?s.attachEvent("onload",a):s.onload=a,s.id=s.name="myIframe",t.document.body.appendChild(s),l=t.document.createElement("form"),l.method="POST",l.id="myForm",l.setAttribute("target","myIframe"),l.target="myIframe",l.action=i,l.innerHTML=n(e),t.document.body.appendChild(l),r=t.document.createElement("script"),r.type="text/javascript",c='n = loadcount;myIframe = frames["myIframe"];handleLoad = function() {if (loadcount === n+1) {setTimeout(function(){ myIframe.location.replace("about:blank"); }, 0)} else if (loadcount === n+2) {handleLoad = function(){};setTimeout(function(){ if (!window.postMessage) { self.callback(myIframe.name=="myIframe"? null:myIframe.name); }}, 0);}};document.getElementById("myForm").submit();';try{r.appendChild(t.document.createTextNode(c))}catch(d){r.text=c}t.document.body.appendChild(r)}function n(t){var e="";if("object"==typeof t){for(var i in t)t.hasOwnProperty(i)&&(e+=o(i,t[i]));return e}return o("data",t)}function o(t,e){return'<input type="text" name="'+a(t)+'" value="'+a(e)+'" />'}function a(t){return t=""+t,t.replace(/([&<>"])/g,function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return e[t]})}var s={frameCount:0};return s.post=function(n,o,a){var s,r,c,l,d,f="about:blank",u=1e4;"object"==typeof a?(d=a.callback,"undefined"!=typeof a.referer&&(f=a.referer),"undefined"!=typeof a.timeout&&(u=a.timeout)):"function"==typeof a&&(d=a),r=function(t){s=frames[t.id],c=setTimeout(function(){t&&e(t),t=null,d&&(d(null),d=null)},u),l=function(i){clearTimeout(c),t&&e(t),d&&d(i)},i(s,n,o,l)},t(r,f)},s}),function(t){function e(t){return this._attempts=0,this._setSettings(t),this}e.defaults={type:"GET",dataType:"json",jsonpCallback:"colbertCallback",appendJsonpCallback:!0,async:!0,timeout:15e3,data:"",cache:!1,responseType:"text",retryThreshold:1,url:t.location.toString(),contentType:"application/x-www-form-urlencoded",accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"}},e.create=function(t){return new e(t)},e._setupRelay=function(t){this.prototype.relayEnabled=!0,this.prototype.relay=t},e.prototype={_prepareData:function(t){return"string"!=typeof t.data&&"application/json"==t.contentType&&(t.data=JSON.stringify(t.data)),t},isXHRCorsSupported:function(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest},isIE6to10:function(){return t.navigator.appVersion.toLowerCase().indexOf("msie")>=0},_serialize:function(t,e){if(!_isArray(t)&&"object"!=typeof t)return t;var i=[];for(var n in t)if(t.hasOwnProperty(n)){var o=e?e+"["+n+"]":n,a=t[n];i.push("object"==typeof a?serialize(a,o):encodeURIComponent(o)+"="+encodeURIComponent(a))}return i.join("&")},send:function(){var e,i,n={},o=this._settings,a=t.location.protocol,s=this,r=function(){return!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},c=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],l=function(t,e){n[t.toLowerCase()]=e},d=function(){if(o.data&&"GET"!=o.type.toUpperCase()&&l("Content-Type",o.contentType),!o.ignoreHeaders&&(o.crossDomain||l("X-Requested-With","XMLHttpRequest"),l("Accept",o.accepts[o.dataType]||"*/*"),"undefined"!=typeof o.headers))for(var t in o.headers)o.headers.hasOwnProperty(t)&&l(t,o.headers[t])},f=function(){return new XDomainRequest},u=function(){for(var t=null,e=-1;++e<c.length;){try{t=c[e]()}catch(i){continue}break}return t},h=function(){if(4==this.readyState){var i,n="function"==typeof s._failCallback?s._failCallback:function(){t.console&&console.log("Request failed: ",arguments)},r="function"==typeof s._successCallback?s._successCallback:function(){t.console&&console.log("Request successful: ",arguments)};this.onreadystatechange=null,this.status>=200&&this.status<300||304==this.status||0===this.status&&"file:"==a?(i=e.responseText,r(i,this,o)):(n(this.statusText||null,this.status?"error":"abort",this,o),++s._attempts<s._settings.retryThreshold&&s.send())}},p=function(){var e,i="function"==typeof s._successCallback?s._successCallback:function(){t.console&&console.log("Request successful: ",arguments)};e=this.responseText,i(e,this,o)},g=function(){var e="function"==typeof s._failCallback?s._failCallback:function(){t.console&&console.log("Request failed: ",arguments)};e(this.statusText||null,"error",this,o)};if(d(),"jsonp"==o.dataType)return this.sendJSONP();if("postRelay"===o.dataType)return this.sendRelay();if(o.crossDomain||(urlAnchor=document.createElement("a"),urlAnchor.href=o.url,urlAnchor.href=urlAnchor.href,o.crossDomain=window.location.protocol+"//"+window.location.host!=urlAnchor.protocol+"//"+urlAnchor.host),this.isIE6to10()&&o.crossDomain&&!this.isXHRCorsSupported())i=f(),i.onload=p,i.onerror=g,i.onprogress=function(){},i.ontimeout=function(){},i.open(o.type,o.url),o=this._prepareData(o),i.send(o.data);else{e=u(),!r()&&e.responseType&&(e.responseType=o.responseType),e.onreadystatechange=h,e.open(o.type,o.url,o.async),o.useCookies&&(e.withCredentials=!0),e.timeout=o.timeout,d();for(var m in n)n.hasOwnProperty(m)&&e.setRequestHeader(m,n[m]);o=this._prepareData(o),e.send(o.data)}return this},sendJSONP:function(){var i,n=this._settings,o=!1,a=this,s="function"==typeof a._failCallback?a._failCallback:function(){t.console&&console.log("Request failed: ",arguments)},r="function"==typeof a._successCallback?a._successCallback:function(){t.console&&console.log("Request successful: ",arguments)},c=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},l=function(){document.head&&u.parentNode&&document.head.removeChild(u),e&&e.jsonpCallbackData&&n.jsonpCallback in e.jsonpCallbackData?1==e.jsonpCallbackData[n.jsonpCallback]?(delete e.jsonpCallbackData[n.jsonpCallback],t[n.jsonpCallback]=void 0):e.jsonpCallbackData[n.jsonpCallback]--:t[n.jsonpCallback]=void 0},d=function(e){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?t.console&&t.console.log("OTHER STATES jsonp: ",this.readyState):(o=!0,u.onload=u.onerror=u.onreadystatechange=null,l(),"type"in e&&"error"==e.type&&(i&&clearTimeout(i),s(null,e.type,u,n)))},f=function(){s(null,"error",u,n),l()};!n.cache&&n.appendJsonpCallback&&(n.url=c(n.url,"_="+(new Date).getTime())),n.appendJsonpCallback&&(n.url=c(n.url,"callback="+n.jsonpCallback));var u=document.createElement("script");return u.type="text/javascript",u.onload=u.onerror=u.onreadystatechange=d,t[n.jsonpCallback]=function(){if(arguments&&1==arguments.length){var t=arguments[0];r(t,u,n)}else s(null,"error",u,n);i&&clearTimeout(i)},e&&(e.jsonpCallbackData=e.jsonpCallbackData||{},e.jsonpCallbackData[n.jsonpCallback]=n.jsonpCallback in e.jsonpCallbackData?++e.jsonpCallbackData[n.jsonpCallback]:1),u.src=n.url,i=setTimeout(f,n.timeout),document.head.appendChild(u),this},sendRelay:function(t){var e=this._settings;e.callback="function"==typeof t?t:"function"==typeof this._successCallback?this._successCallback:function(){},this._prepareData(e),this.relay.post(e.data,e.url,e.callback)},done:function(t){return"function"==typeof t?(this._successCallback=t,this):void 0},fail:function(t){return"function"==typeof t?(this._failCallback=t,this):void 0},_setSettings:function(t){this._settings=this._extend(e.defaults,t||{})},_extend:function(){var t=-1,e={};if(!arguments)return{};for(;++t<arguments.length;){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}},"undefined"!=typeof define&&"undefined"!=typeof define.amd?define("mybbc/notifications/request",["mybbc/notifications/vendor/relay"],function(t){return t&&e._setupRelay(t),e}):"undefined"!=typeof module&&"undefined"!=typeof module.exports?exports=e:t.request=e}(this),define("mybbc/notifications/NotificationLoader",["require","mybbc/notifications/config","mybbc/notifications/request"],function(t){var e=t("mybbc/notifications/config"),i=t("mybbc/notifications/request"),n=function(t){this.loaderOptions=t||{},this.pollingIntervalId=void 0,this.url=void 0,this.request=i};return n.prototype.startPolling=function(t,i,n,o){var a=this;this.pollingStarted()||(this.pollingIntervalId=setInterval(function(){o&&!o.hasCookie()||a.loadNotifications(t,i,n)},e.env.notificationsPollingInterval))},n.prototype.loadNotifications=function(t,e,i){this.url=t;var n=new this.request(this._getRequestParams(i)),o={notifications:[]},a=null,s=this;n._successCallback=function(t,i){a=t,"function"==typeof e&&s._onSuccess(e,a,o,i)},n._failCallback=function(t,i){e(!0,"notificationloader.load.error",i,s.loaderOptions)},n.send()},n.prototype._onSuccess=function(t,e,i,n){try{null!==e&&(e="object"==typeof e?e:JSON.parse(e.trim()),"undefined"==typeof e.notifications?i.notifications=e:i=e)}catch(o){return void t(!0,"notificationloader.parse.error",n.status,this.loaderOptions)}t(null,i,n.status,this.loaderOptions)},n.prototype.pollingStarted=function(){return void 0!==this.pollingIntervalId},n.prototype.setOption=function(t,e){this.loaderOptions[t]=e},n.prototype._getRequestParams=function(t){var e=this,i={contentType:"application/json",type:"GET",dataType:"jsonp",url:e.url,jsonpCallback:"colbertCallback",timeout:1e4};if("undefined"!=typeof t)for(var n in t)i[n]=t[n];return i},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/AggregatedNotificationCollection",["mybbc/notifications/collections/AbstractCollection","mybbc/notifications/models/NotificationModel","mybbc/notifications/NotificationLoader","mybbc/notifications/config","mybbc/notifications/DateManager","mybbc/notifications/logger"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractCollection"),require("NotificationModel"),require("NotificationLoader"),require("config"),require("DateManager"),require("logger")):t.AggregatedNotificationCollection=e(AbstractCollection,NotificationModel,NotificationLoader,config,DateManager,Logger)}(this,function(t,e,i,n,o,a){var s=t.extend({type:"AggregatedNotificationCollection",model:e,baseUrl:n.env.feedBaseUrl,url:n.env.feedAggregatedInitialFeed,collectionDataSource:"aggregated",maxNotificationAgeDays:n.env.maxNotificationAge,latestLoader:new i,loader:new i,logger:a.getLogger("AggregatedNotificationCollection"),dateManager:o,state:{pageSize:n.env.visibleChunkAmount,lastItemShownModelId:null,errorThrown:!1,itemsToload:n.env.visibleChunkAmount,sortKey:"creationTimestamp",newItemsAddedCount:0,newLatestItemsAddedCount:0,endOfPagesReached:!1,endOfItemsReached:!1,reachedOldNotifications:!1},initialise:function(t){return t=t||{},this.latestUrl=this.url,this.userPreferencesModel=t.userPreferencesModel||{},this.initialFetch=!1,this.fetchInprogress=!1,this.modelIds=[],this.nextPageReadyCallback=null,this.idcta=t.idcta,this},getNextPage:function(t){this.nextPageReadyCallback=t,this.hasCachedModels()?this.checkCachedModels():this.reachedLastPage()||this.prepareFetch()},checkCachedModels:function(){this.getAvailableCachedItemsCount()<this.state.pageSize?this.reachedLastPage()?this.getPageFromCache(!0):this.prepareFetch():this.getPageFromCache()},getPageFromCache:function(t){t=t||!1,this.notify(),this.state.lastItemShownModelId=t?this.last().id:this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id,t?(this.state.endOfItemsReached=!0,this.logger.info("Last page prepared from the collection cache (from previously loaded data)")):this.logger.info("Next page prepared from the collection cache (from previous calls)",this.state.lastItemShownModelId)},prepareFetch:function(){return this.fetchInprogress?void this.logger.warn("Attempt to get nextPage but previous fetch in progress"):(this.state.itemsToload=this.state.pageSize-this.getAvailableCachedItemsCount(),void this.fetch())},fetch:function(t){return this.logger.info("Fetching started, %s items to load:",this.state.itemsToload,"Fetch URL: "+this.getFullUrl()),t=t||{},this.success=t.success||this.success,this.fail=t.fail||this.fail,this.loader.loadNotifications(this.getFullUrl(),this.bind(this.onNotificationsLoaded),this.getLoadParams()),this.fetchInprogress=!0,this},getFullUrl:function(t){return this.baseUrl.replace(/\/?$/,"/")+this.collectionDataSource+"/"+(t?this.latestUrl:this.url)},hasCachedModels:function(){return this.getAvailableCachedItemsCount()>0},getAvailableCachedItemsCount:function(){var t=this.state.lastItemShownModelId,e=this.indexOf(t);return this.models.length-(e+1)},setCollectionDataSource:function(t){this.collectionDataSource=t},getLoadParams:function(){return{cache:!0,jsonpCallback:"_"+this.collectionDataSource.replace(/(:|\s)/g,"_")+"_"+this.url.replace(/(:|-|\.)/g,"_")}},onNotificationsLoaded:function(t,e){return t?this.fail(e,"pages"):void this.success(e,"pages")},success:function(t,e){var i;this.checkStartPolling(),i=this.parse(t),this.filterStartTime=Date.now(),this.logger.info("Applying filters to the loaded data [%s items]: ",i.length),i=this.applyFilters(i),this.filterEndTime=Date.now(),this.logger.info("Finished Applying filters to the loaded data [%s ms], [%s items accepted after filtering]",this.filterEndTime-this.filterStartTime,i.length),this.add(i,e).sort(),"pages"==e?this.handlePagesLoadSuccess(t):"latest"==e&&this.state.newLatestItemsAddedCount>0&&(this.logger.info("%s New notifications received (from latest.json)",this.state.newLatestItemsAddedCount),this.trigger("notification.latest.update",{content:this.toJSON().slice(0,Math.max(this.indexOf(this.state.lastItemShownModelId)+1,this.state.pageSize)),newLatestItemsCount:this.state.newLatestItemsAddedCount}))},handlePagesLoadSuccess:function(t){var e;return this.checkState(),e="undefined"!=typeof t.next&&"false"!=t.next&&!this.state.reachedOldNotifications&&this.userPreferencesModel.getEnabledProducts().length>0,this.setUrl(e?t.next:null),null===this.url?(this.fetchInprogress=!1,this.notify(),this._setEndOfPagesReached()):this.state.itemsToload>0?this.fetch():(this.logger.info("Fetching finished, %s items to load:",this.state.itemsToload,"Next URL to load: %s",this.getFullUrl()),this.fetchInprogress=!1,this.notify(),void(this.state.lastItemShownModelId=this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id))},checkStartPolling:function(){this.initialFetch||(this.setLatestNotificationPolling(),this.initialFetch=!0)},setLatestNotificationPolling:function(){this.isUserSignedIn()&&(this.logger.info("Polling started to pull latest.json"),this.latestLoader.startPolling(this.getFullUrl(!0),this.bind(this.onLatestNotificationsLoaded),this.getLoadParams(),this.idcta))},onLatestNotificationsLoaded:function(t,e){return t?this.fail(e,"latest"):void this.success(e,"latest")},parse:function(t){return t.notifications},_getActiveSubscriptions:function(){var t="undefined"!=typeof this.userPreferencesModel.get()&&"subscriptions"in this.userPreferencesModel.get()?this.userPreferencesModel.get().subscriptions:[];return this.userPreferencesModel._getActiveSubscriptions(t)},applyFilters:function(t){return t=this.filterDataByProductsEnabled(t),t=this.filterDataByCreationDate(t),t=this.filterDataBySubscriptions(t)},isUserSubscribedToTopic:function(t,e){return t.topic[e]in this._getActiveSubscriptions()},isItemTopicCreatedAfterSubscribe:function(t,e){return new Date(t.creationTimestamp).getTime()>new Date(e).getTime()},isUserSignedIn:function(){return this.idcta.hasCookie()},filterDataByProductsEnabled:function(t){var e,i=this.userPreferencesModel.getEnabledProducts(),n=[];if(0===i.length)return[];for(var o in t)t.hasOwnProperty(o)&&(e=t[o],-1!=i.indexOf(e.product.toUpperCase())&&n.push(e));return n},filterDataBySubscriptions:function(t){var e,i,n,o=[],a=this,s=this._getActiveSubscriptions();for(var r in t)if(t.hasOwnProperty(r)){e=t[r],i=!1;for(var c=0;c<e.topic.length;c++)a.isUserSubscribedToTopic(e,c)&&(n=s[e.topic[c]].lastSubscribed||void 0,("undefined"==typeof n||a.isItemTopicCreatedAfterSubscribe(e,n))&&(i=!0));i&&o.push(e)}return o},filterDataByCreationDate:function(t){var e,i=this;return t.filter(function(t){return e=i.dateManager.howOld(t.creationTimestamp)<=parseInt(i.maxNotificationAgeDays,10),e||(i.state.reachedOldNotifications=!0),e})},sort:function(){var t=this;return this.models=this.models.sort(function(e,i){var n=e.get(t.state.sortKey),o=i.get(t.state.sortKey);return"creationTimestamp"==t.state.sortKey?new Date(o)-new Date(n):o-n}),this},add:function(t,e){for(var i,n=this,o=-1,a=0;++o<t.length;)i=t[o],n.has(i.id)||(n.modelIds.push(i.id),a++,n.models.push(new n.model(i)));return"latest"===e?this.state.newLatestItemsAddedCount=a:"pages"===e&&(this.state.newItemsAddedCount=a),this},checkState:function(){var t=this.state.itemsToload,e=this.state.newItemsAddedCount;this.state.itemsToload=e>=t?0:t-e},notify:function(){var t=this.state.lastItemShownModelId;this.logger.info('Next page prepared after fetching finished, triggering the "%s" event',"notification.new.page.ready"),this.trigger("notification.new.page.ready",{content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0}),"function"==typeof this.nextPageReadyCallback&&this.nextPageReadyCallback({content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0})},fail:function(t,e){this.checkStartPolling(),this.logger.error(t),this.fetchInprogress=!1,"pages"===e&&(0!==this.toArray().length||this.state.errorThrown?this.toArray().length>0&&(this.checkState(),this.notify(),this._setEndOfPagesReached()):(this.trigger("notification.load.error"),this.state.errorThrown=!0)),this.logger.error("Error loading notifications",t)},reachedLastPage:function(){return this.state.endOfPagesReached},hasItemsToLoad:function(){return!this.state.endOfItemsReached},_setEndOfPagesReached:function(){var t=this.indexOf(this.state.lastItemShownModelId),e=this.state.pageSize-this.state.itemsToload;this.logger.info("Reached the end of the pages, no more notification files to load"),this.state.lastItemShownModelId=this.at(t+Math.min(e,this.state.pageSize)).id,0===this.getAvailableCachedItemsCount()&&(this.state.endOfItemsReached=!0),this.state.endOfPagesReached=!0},hasLoadedAllPages:function(){var t=this.models.length;if(t>0){var e=this.at(t-1);return e.id===this.state.lastItemShownModelId}return!0}});return s}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/TopicNotificationCollection",["mybbc/notifications/collections/AbstractCollection","mybbc/notifications/models/NotificationModel","mybbc/notifications/NotificationLoader","mybbc/notifications/config","mybbc/notifications/DateManager","mybbc/notifications/logger","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractCollection"),require("NotificationModel"),require("NotificationLoader"),require("config"),require("DateManager"),require("logger"),require("utils")):t.TopicNotificationCollection=e(AbstractCollection,NotificationModel,NotificationLoader,config,DateManager,Logger,Utils)}(this,function(t,e,i,n,o,a,s){var r=new s,c=t.extend({type:"TopicNotificationCollection",model:e,baseUrl:n.env.feedBaseUrl,url:n.env.feedTopicInitialFeed,notificationsPollingInterval:n.env.notificationsPollingInterval,maxNotificationAgeDays:n.env.maxNotificationAge,logger:a.getLogger("TopicNotificationCollection"),dateManager:o,state:{pageSize:n.env.visibleChunkAmount,lastItemShownModelId:null,sortKey:"creationTimestamp",newLatestItemsAddedCount:0,endOfPagesReached:!1,endOfItemsReached:!1,reachedOldNotifications:!1},initialise:function(t){return t=t||{},this.latestUrl=this.url,this.userPreferencesModel=t.userPreferencesModel||{},this.pollingStarted=!1,this.fetchInprogress=!1,this.modelIds=[],this.topics={},this.idcta=t.idcta,this},getNextPage:function(){this.isEmptyCachedModels()?this.prepareFetch():this.getPageFromCache()},getPageFromCache:function(){var t=this.getAvailableCachedItemsCount()<this.state.pageSize;this.notify(),this.state.lastItemShownModelId=t?this.last().id:this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id,t?(this.state.endOfItemsReached=!0,this.logger.info("Last page prepared from the collection cache (from previously loaded data)")):this.logger.info("Next page prepared from the collection cache (from previous calls)",this.state.lastItemShownModelId)},prepareFetch:function(){return this.fetchInprogress?void this.logger.warn("Attempt to get nextPage but previous fetch in progress"):void this.fetch()},fetch:function(){var t,e,n=r.keys(this._getActiveSubscriptions()),o=this;return this.topics={},0===n.length?void this.completeTopicsInitialLoad():(r.forEach(n,function(e){t=o.addTopic(e,{name:e,loader:new i({topic:e,loadType:"pages"}),state:{currentFile:o.latestUrl,reachedOldNotifications:!1}})}),void r.each(this.topics,function(t,i){e=o.getFullUrl(i,t.state.currentFile),t.loader.loadNotifications(e,o.bind(o.onNotificationsLoaded),o.getLoadParams(i,t.state.currentFile)),o.fetchInprogress=!0,o.logger.info("Fetching started for topic %s:",i,"Fetch URL: "+e)}))},addTopic:function(t,e){return this.topics[t]=e,this.topics[t]},getTopic:function(t){return this.topics[t]},getFullUrl:function(t,e){return this.baseUrl.replace(/\/?$/,"/")+encodeURIComponent(t)+"/"+e},isEmptyCachedModels:function(){return 0===this.getAvailableCachedItemsCount()},getAvailableCachedItemsCount:function(){var t=this.state.lastItemShownModelId,e=this.indexOf(t);return this.models.length-(e+1)},getLoadParams:function(t,e){return{cache:!0,jsonpCallback:"_"+t.replace(/(:|-|\s)/g,"_")+"_"+e.replace(/(:|-|\.)/g,"_")}},onNotificationsLoaded:function(t,e,i,n){var o=n.topic,a=n.loadType;return t?this.fail(o,e,a):void this.success(o,e,a)},success:function(t,e,i){var n,o,a;n=this.parse(e),o=Date.now(),this.logger.info("Applying filters to the loaded data for topic %s [%s items]: ",t,n.length),n=this.applyFilters(t,n),a=Date.now(),this.logger.info("Finished Applying filters to the loaded data [%s ms], [%s items accepted after filtering]",a-o,n.length),this.add(t,n,i).sort(),"pages"===i?this.handleTopicPagesLoadSuccess(t,e):"latest"===i&&this.handleTopicLatestLoadSuccess(t,e)},handleTopicPagesLoadSuccess:function(t,e){var i,n,o=this.getTopic(t),a=o.state.reachedOldNotifications||0===this.userPreferencesModel.getEnabledProducts().length;n=a?null:this.getNextTopicFile(e),o.state.currentFile=n,null===n?(o.state.endOfPagesReached=!0,this.isLoadingFinishedForAllTopics()&&this.completeTopicsInitialLoad()):(i=this.getFullUrl(t,n),o.loader.loadNotifications(i,this.bind(this.onNotificationsLoaded),this.getLoadParams(t,n)))},isLoadingFinishedForAllTopics:function(){var t=!0;return r.each(this.topics,function(e){e.state.endOfPagesReached||(t=!1)},this),t},completeTopicsInitialLoad:function(){this.fetchInprogress=!1,this.pollingStarted=!1,this.notify(),this._setEndOfPagesReached(),this.resetPolling()},getNextTopicFile:function(t){var e=t.next;return"undefined"==typeof e||"false"===e?null:e},resetPolling:function(){this.resetTopicsPollingState(),!this.pollingStarted&&this.isUserSignedIn()&&(this.pollingStarted=!0,setTimeout(this.bind(this.startPolling),this.notificationsPollingInterval))},startPolling:function(){var t;this.logger.info("Polling started to pull latest data for each of the topics",this.topics),r.each(this.topics,function(e,i){t=this.getFullUrl(i,this.latestUrl),e.loader.setOption("loadType","latest"),e.loader.loadNotifications(t,this.bind(this.onNotificationsLoaded),this.getLoadParams(i,this.latestUrl))},this)},handleTopicLatestLoadSuccess:function(t){this.getTopic(t).state.latestPollingFinished=!0,this.isPollingFinishedForAllTopics()&&this.completeTopicsPolling()},isPollingFinishedForAllTopics:function(){var t=0;return r.each(this.topics,function(e){e.state.latestPollingFinished&&t++}),r.keys(this.topics).length<=t},completeTopicsPolling:function(){var t=this.getLatestAddedItemsCount();t>0&&(this.logger.info("%s New notifications received (from latest.json)",t),this.trigger("notification.latest.update",{content:this.toJSON().slice(0,Math.max(this.indexOf(this.state.lastItemShownModelId)+1,this.state.pageSize)),newLatestItemsCount:t})),this.pollingStarted=!1,this.resetPolling()},isUserSignedIn:function(){return this.idcta.hasCookie()},getLatestAddedItemsCount:function(){var t=0;return r.each(this.topics,function(e){t+=e.state.newLatestItemsAddedCount}),t},resetTopicsPollingState:function(){r.each(this.topics,function(t){t.state.newLatestItemsAddedCount=0,t.state.latestPollingFinished=!1})},parse:function(t){return t.notifications},_getActiveSubscriptions:function(){var t=this.userPreferencesModel.get(),e="undefined"!=typeof t&&"subscriptions"in t?t.subscriptions:[];return this.userPreferencesModel._getActiveSubscriptions(e)},applyFilters:function(t,e){return e=this.filterDataByProductsEnabled(e),e=this.filterDataByCreationDate(t,e),e=this.filterDataBySubscriptions(e)},isItemTopicCreatedAfterSubscribe:function(t,e){return new Date(t.creationTimestamp).getTime()>new Date(e).getTime()},filterDataByProductsEnabled:function(t){var e,i=this.userPreferencesModel.getEnabledProducts(),n=[];if(0===i.length)return[];for(var o in t)t.hasOwnProperty(o)&&(e=t[o],-1!=i.indexOf(e.product.toUpperCase())&&n.push(e));return n},filterDataBySubscriptions:function(t){var e,i,n,o=[],a=this,s=this._getActiveSubscriptions();for(var r in t)if(t.hasOwnProperty(r)){e=t[r],i=!1;for(var c=0;c<e.topic.length;c++)s[e.topic[c]]&&(n=s[e.topic[c]].lastSubscribed||void 0,("undefined"==typeof n||a.isItemTopicCreatedAfterSubscribe(e,n))&&(i=!0));i&&o.push(e)}return o},filterDataByCreationDate:function(t,e){var i,n=this;return e.filter(function(e){return i=n.dateManager.howOld(e.creationTimestamp)<=parseInt(n.maxNotificationAgeDays,10),i||(n.getTopic(t).state.reachedOldNotifications=!0),i})},sort:function(){var t=this;return this.models=this.models.sort(function(e,i){var n=e.get(t.state.sortKey),o=i.get(t.state.sortKey);return"creationTimestamp"==t.state.sortKey?new Date(o)-new Date(n):o-n}),this},add:function(t,e,i){for(var n,o=-1,a=0;++o<e.length;)n=e[o],this.has(n.id)||(this.modelIds.push(n.id),a++,this.models.push(new this.model(n)));return"latest"===i&&(this.getTopic(t).state.newLatestItemsAddedCount=a),this},notify:function(){var t=this.state.lastItemShownModelId;this.logger.info('Next page prepared after fetching finished, triggering the "%s" event',"notification.new.page.ready"),this.trigger("notification.new.page.ready",{content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0})},fail:function(t,e,i){var n=this.getTopic(t);"pages"===i?(n.state.currentFile===this.latestUrl&&(n.state.hasLatestError=!0),n.state.endOfPagesReached=!0,this.isLoadingFinishedForAllTopics()&&this.completeTopicsInitialLoad()):"latest"===i&&(n.state.latestPollingFinished=!0,this.isPollingFinishedForAllTopics()&&this.completeTopicsPolling()),this.logger.error("Error loading notifications",e)},reachedLastPage:function(){return this.state.endOfPagesReached},hasItemsToLoad:function(){return!this.state.endOfItemsReached},_setEndOfPagesReached:function(){var t=this.indexOf(this.state.lastItemShownModelId);this.models.length>0&&(this.state.lastItemShownModelId=this.at(t+Math.min(this.models.length,this.state.pageSize)).id),this.logger.info("Reached the end of the pages, no more topic related notification files to load"),this.isEmptyCachedModels()&&(this.state.endOfItemsReached=!0),this.state.endOfPagesReached=!0},hasLoadedAllPages:function(){var t=this.models.length;if(t>0){var e=this.at(t-1);return e.id===this.state.lastItemShownModelId}return!0}});return c}),define("mybbc/notifications/collections/NotificationCollectionFactory",["require","mybbc/notifications/collections/AggregatedNotificationCollection","mybbc/notifications/collections/TopicNotificationCollection","mybbc/notifications/config"],function(t){function e(t,e){var a,s=t._countActiveSubscriptions(),r=o.env.feedTopicMaxSubscriptions;return new(a=s>r?i:n)([],e)}var i=t("mybbc/notifications/collections/AggregatedNotificationCollection"),n=t("mybbc/notifications/collections/TopicNotificationCollection"),o=t("mybbc/notifications/config");return{getCollectionInstance:e}}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/SettingsView",["mybbc/notifications/analytics","mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/NotificationsTemplate"],e):"undefined"!=typeof exports?module.exports=e():t.SettingsView=e()}(this,function(t,e,i,n,o,a){var s=function(s){function r(t){t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}function c(t){x=t}function l(){return x}function d(){i.addEvent(S.settingIconEl,"click",f),i.addEvent(S.settingIconEl,"keydown",u)}function f(t){r(t),g()}function u(t){var e="any";i.isMatchingKeyEvent(t,e,P)&&(S.settingIconEl.enterPressed=!0)}function h(t){r(t),p()}function p(t){t="undefined"==typeof t?!0:t,l()!==M&&(S.errorView.changeView("hub"),e.remove(T,"show"),c(M),"function"==typeof S.stateChanged&&S.stateChanged(M,t))}function g(){C.loaded()?y():C.load(y)}function m(t){i.isMatchingKeyEvent(t,"keypress",[P,j])&&v(t)}function v(e){var i=e.currentTarget,n=i.children[0],o=n.value,a=!n.checked;n.checked=a,i.setAttribute("aria-checked",""+a),r(e);var s=S.mainApp.getUserPreferencesModel();s.updateProductEnabled(o,a,function(t){t&&b(t,"keypress"===e.type)}),t.log(a?"opt-in":"opt-out","notifications-settings",{
nots_product:o.toLowerCase()})}function b(t,e){var i="#settings-error-inner";S.errorView.showError({view:"settings",isInner:!0,closeEvent:function(){S.errorView.hideError("settings",!1),document.querySelector(".notification-title--js").tabIndex=document.activeElement.tabIndex+1},errorElID:i,closeEl:".notifications-error--inner__close"},function(t){"shown"===t&&e&&document.querySelector(i+" .notifications-error--inner__close").focus()}),I.error("Error syncing the user product settings",t)}function y(){var t,i=S.mainApp.getUserPreferencesModel().getProducts(),n=[];if(S.errorView.changeView("settings"),T.innerHTML=C.compile({baseAssetUrl:S.mainApp.basePath}),e.add(T,"show"),i.length){for(var o=0;o<i.length;o++)t=i[o],t=A.extend(t,{isSelected:!!t.enabled,name:q[t.product]||t.product.toLowerCase()}),n.push(t);k(n)}else S.errorView.showError({extContainer:T,view:"settings",isInner:!1,closeEvent:h,errorElID:"#settings-error-main",closeEl:".notifications-error__back"}),I.error("Error getting the product info",null);"function"==typeof S.stateChanged&&S.stateChanged(N,!0),E()}function w(){var t=['<div class="notifications-settings-item notifications-settings-product--js" each="{ item in items }" tabindex="0" role="checkbox" aria-checked="{{item.isSelected}}">','<input type="checkbox" name="checkbox" id="{{item.product}}-settings-checkbox" class="notifications-settings-tickbox"','value="{{item.product}}" __checked="{{item.isSelected}}">',"</input>",'<label for="{{item.product}}-settings-checkbox" class="notifications-long-primer notifications-settings-text">{{item.name}} Notifications</label>',"</div>"];return t.join("")}function _(){S.riot.tag("notifications-settings-items",w(),function(t){this.items=t.items||[]})}function k(t){S.riot.mount("notifications-settings-items",{items:t||[]}),c(N)}function E(){var t=T.querySelector(".notifications__settings__back-btn--js"),e=T.querySelectorAll(".notifications-settings-product--js");A.forEach(Array.prototype.slice.call(e),function(t){i.addEvent(t,"click",v),i.addEvent(t,"keypress",m)}),i.addEvent(t,"click",h),O.checkInitialFocus(),O.startListeners()}var C,S,x,T,A=new o,I=new n("Settings view"),P=13,j=32,L=9,N="shown",M="hidden",D={el:".notification-settings__container--js",settingIconEl:document.querySelector(".notifications__settings--js"),templateName:"settings"},q={IPLAYER:"iPlayer",MUSIC:"Music"};S=A.extend(D,s),T=document.querySelector(S.el),C=a.create(S.templateName),c(M),_();var O=function(){function t(t){var e=t.which||t.keyCode;e==P?a=Date.now():e==L&&(s=Date.now())}function e(t){var e=t.which||t.keyCode;e==L&&t.shiftKey&&(r(t),p())}var n,o={},a=Date.now(),s=Date.now(),c=2e3;return o.hasKeyPressedRecently=function(){var t=Date.now();return"undefined"!=typeof s&&c>t-s||"undefined"!=typeof a&&c>t-a},o.checkInitialFocus=function(){var t=T.querySelector(".notifications__settings__back-btn--js");S.settingIconEl.enterPressed&&(t.focus(),S.settingIconEl.enterPressed=!1)},o.startListeners=function(){i.addEvent(T,"keydown",t)},o.stopListeners=function(){i.removeEvent(T,"keydown",t),i.removeEvent(n,"keydown",e)},o}();return{init:function(){d()},load:function(){g()},render:y,hide:p,setSettingsIconFocus:function(){O.hasKeyPressedRecently()&&S.settingIconEl.focus()}}};return s}),define("mybbc/notifications/app",["require","mybbc/notifications/vendor/riot.min","mybbc/notifications/config","mybbc/notifications/BloomFilterManager","mybbc/notifications/classie","mybbc/notifications/AccessibilityManager","mybbc/notifications/DateManager","mybbc/notifications/PreferencesClient","mybbc/notifications/UserPreferences","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/popup","mybbc/notifications/collections/NotificationCollectionFactory","mybbc/notifications/analytics","mybbc/notifications/SettingsView"],function(t){function e(){var t=function(){var t='<img class="loader-icon notifications-image <%=svg-animation-class%>" src="<%=spinnerUrl%>" alt="Spinner">';return NotificationsModernizr.svg&&NotificationsModernizr.cssanimations&&!b()?t.replace(/<%=spinnerUrl%>/g,wt.baseAssetUrl+"svg/loader.svg").replace(/<%=svg-animation-class%>/g,"spinner__img--svg"):t.replace(/<%=spinnerUrl%>/g,wt.baseAssetUrl+"img/loader/32px/34px_Icon32px_Lively_Dark.gif").replace(/<%=svg-animation-class%>/g,"")},e='<ul class="notification-items" aria-live="polite" aria-relevant="additions" aria-atomic="true"> <li class="notification-item notification__item--js { item.newItem }" each="{ item in items }"> <a onkeydown="{ parent.onLinkKeypress }" class="notification-item--link" href="{ item.notification.url }" title="{ item.notification.title }"><div class="notification-icon-and-dot notifications-1/12 notification-{item.product.toLowerCase()}"><div class="notifications-image notification-{ item.product.toLowerCase() }-icon"> </div> <span class="notification-dot { item.newItem }"> </span></div><div class="notification-text notifications-11/12 { item.newItem }"> <div class="notification-title-items"> <div class="notifications-7/12"><p class="notification-text-body notifications-long-primer"> { parent.generateDescription(item) } </p></div><div class="notifications-4/12"> <img class="notifications-image notification-clock-icon notification-type-{ item.type }" src="<%=baseAssetUrl%>svg/clock.svg" alt="{ item.notification.description  } { parent.decodeDate(item.creationTimestamp) }" onerror="this.src=\'<%=baseAssetUrl%>img/clock.png\'; this.onerror=null;"></img><span class="notification-episode-name notifications-brevier">{ parent.manageText(item) }</span><span class="notification-time notifications-brevier">{ parent.decodeDate(item.creationTimestamp) }</span> </div></div></div></a></li><div id="no-notifications" class="no-notifications visible-{ items.length > 0 }"><p tabindex="988" class="notifications-long-primer"> No notifications right now. Weâll let you know when something from your favourite programmes, artists and playlists is available for you. </p><p tabindex="989" class="notifications-long-primer">If your notifications are turned off, you can always turn them back on. Just go to settings.</p></div><div class="clearfix"></div></ul><div class="spinner">'+t()+'</div><div class="notifications-keyboard-access"><button __disabled="{ this.loadedAllPages }" class="notifications-keyboard-access--more" onclick="{ this.loadMore }">Load More</button><button class="notifications-keyboard-access--close" onclick="{ this.close }">Close</button></div>';return e.replace(/<%=baseAssetUrl%>/g,wt.baseAssetUrl)}function i(){st.tag("notificationamount","{ notificationamount }",function(t){this.notificationamount=t.amount||"no"}),st.tag("notifications",e(),function(t){this.items=t.items,this.loadedAllPages=t.loadedAllPages,this.onLinkKeypress=function(t){if(9===t.keyCode){var e=!dt.hasClass(document.activeElement.parentNode.nextSibling,"notification-item");e&&(dt.addClass(document.querySelector(".notifications-keyboard-access"),"notifications-keyboard-access--shown"),N("updateDrawerHeight"))}return!0},this.decodeDate=function(t){var e=new Date(t),i=new Date(H),n=Math.floor(Math.abs(i-e)/36e5),o=Math.floor(Math.abs(i-e)/6e4);return n>23&&48>n?"Yesterday":n>=48&&168>n?(n/24).toFixed(0)+" days ago":n>0?n+" hour{{plural}} ago ".replace("{{plural}}",1===n?"":"s"):o>0?o+" minute{{plural}} ago ".replace("{{plural}}",1===o?"":"s"):"Just now"};var e=0;this.getIndex=function(){return++e},this.generateDescription=function(t){var e="";return e="EPISODE_EXPIRY"===t.type||"episode-expiry-today"===t.type?t.notification.title+" episode "+function(e){return ut.isToday(e)?(t.type="episode-expiry-today",["expires today at ",ut.getClockTime(e),". Don't miss out!"].join(" ")):ut.isTomorrow(e)?["expires tomorrow at ",ut.getClockTime(e),". Don't miss out!"].join(" "):ut.isToday(e)||ut.isTomorrow(e)?void 0:ut.getDayDifference(e)>0?["expires on ",ut.getWeekday(e)," at ",ut.getClockTime(e),". Don't miss out!"].join(" "):0===ut.getDayDifference(e)?["expired today "," at ",ut.getClockTime(e),"."].join(" "):["expired on ",ut.getWeekday(e)," at ",ut.getClockTime(e),"."].join(" ")}(t.expires):t.notification.title},this.manageText=function(t){return t.notification.episode?gt.truncate(t.notification.episode):t.product[0].toUpperCase()+t.product.substring(1,t.product.length).toLowerCase()},this.loadMore=function(t){S(t,!0),F(!0)}.bind(this),this.close=function(){document.getElementById("notification-link").click(),document.querySelector(".orb-nav-news a").focus()}})}function n(t){c(t),0===t.length?(Et=!0,o(t)):(Et=!1,st.mount("notifications",{items:t,loadedAllPages:G.hasLoadedAllPages()})),a(t)}function o(t){_t=t,st.mount("notifications",{items:[]})}function a(t){var e=document.querySelector(".notification-items");tt=l(t),tt>kt&&(dt.remove(document.getElementById("not-num"),"new-notifications"),dt.remove(document.getElementById("notification-link"),"swing"),W.offsetWidth,dt.add(K,"new-notifications"),dt.add(document.getElementById("notification-link"),"swing"),kt=tt),Y.hide(),_t=t,Z.check(V),mt.check(),vt.track({internal:{region:document.querySelectorAll(".notification__item--js"),linkLocation:"notifications"}}),M(e,function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;for(var e=t.target||t.srcElement;e&&e.tagName&&"li"!==e.tagName.toLowerCase();)e=e.parentNode;if(e&&e.parentNode){var i=[].indexOf.call(e.parentNode.children,e),n=G.at(i);dt.hasClass(e,"notification-new")&&kt--,J.checkOrAdd(n.id),vt.log("click","notifications-item",{notifications_id:n.id,notifications_state:""===n.get("newItem")?"read":"new",notifications_priority:(n.get("priority")||"normal").toLowerCase(),notifications_product:n.get("product").toLowerCase(),notifications_type:n.get("type").toLowerCase(),notifications_title:n.get("notification").title,topic_name:vt.serialiseTopic(n.get("topic"))}),_t[i].newItem="",st.update(),"undefined"!=typeof J&&L({readFilter:"undefined"!=typeof J.filter?J.getCleanArray():null,lastReadFlag:!1},function(){"a"===e.firstElementChild.tagName.toLowerCase()&&window.location.assign(e.firstElementChild.href)})}}),st.update(),N("updateDrawerHeight"),r()}function s(){var t=document.querySelectorAll(".notification__item--js"),e=Math.ceil(_t.length/bt),i=(e-1)*bt,n=t[i];n&&n.children[0].focus()}function r(){at&&s();var t=ft.getInstance();t.updateIconHiddenText(tt>0?"New notifications":"No new notifications"),Ct>0&&("hidden"!==B.getDrawerState()?t.updateIconAriaLiveText("New Notification available."):t.updateIconAriaLiveText('New Notification. To view open the "Notification Panel" link.'))}function c(t){for(var e=0,i=t.length;i>e;e++)J.contains(t[e].id)?t[e].newItem="":new Date(ot)-new Date(t[e].creationTimestamp)<0?t[e].newItem="notification-new":t[e].newItem="notification-unread";return t}function l(t){return t.filter(function(t){return"notification-new"===t.newItem}).length}function d(t,e){e.setHubSettings(t||{}),V=document.getElementById("notifications-wrapper"),K=document.getElementById("not-num"),W=document.getElementById("notification-link"),R(),T(),i(),v(".spinner"),g(W),m({el:document.querySelector(".notifications-pop-up"),containerEl:document.querySelector(".notifications__header--js"),notificationItemsSelector:".notification__item--js",wrapperEl:V,mainApp:B}),t.resizeEvent(p),y(V),h(),f(wt.errorView),u()}function f(t){nt=t,nt.changeView("hub")}function u(){it=lt({riot:st,mainApp:B,errorView:nt,stateChanged:function(t,e){var i=document.querySelector(".notifications-main--js");i.style.display="shown"==t?"none":"block","hidden"===t&&it.setSettingsIconFocus(),"hidden"!==B.getDrawerState()&&e&&(p(),B.updateDrawerHeight())}}),it.init()}function h(){ft.getInstance().init({iconHiddenTextEl:W.querySelector(".hidden-span"),iconAriaLiveEl:W.querySelector(".notification-link__live--js"),_getDrawerStateChecker:function(){return B.getDrawerState.bind(B)}})}function p(){var t,e,i,n=420;et=window.innerWidth,Q=NotificationsModernizr.touchevents||b()?.75:.65,e=document.querySelector(".orb-nav-pri-container"),i=null!==e?e.offsetHeight:0,t=window.innerHeight*Q-i-document.querySelector(".notifications__header--js").offsetHeight,NotificationsModernizr.touchevents||b()||(t=Math.min(t,n)),V.style.maxHeight=t+"px",N("updateDrawerHeight"),Z&&Z.check(V)}function g(t){dt.add(t,"animated"),dt.add(t,"three")}function m(t){mt.init(t)}function v(t){Y={selector:t,state:"hidden",getEl:function(){return document.querySelector(this.selector)||{style:{}}},hide:function(){this.getEl().style.display="none",this.setState("hidden")},show:function(){this.getEl().style.display="block",this.setState("shown"),N("updateDrawerHeight")},setState:function(t){this.state=t},getState:function(){return this.state}}}function b(){return-1!==navigator.appVersion.indexOf("Win")&&"undefined"!=typeof window.navigator.pointerEnabled&&null!==navigator.userAgent.match(/.+windows.+(touch|phone).+/i)}function y(t){function e(e,i){for(var n in i){var o=i[n];ht.removeEvent(t,o,e),ht.addEvent(t,o,e)}}function i(e,i){for(var n in i){var o=i[n];ht.removeEvent(t,o,e)}}Z={enabled:!1,endOfScrollTimestamp:Date.now(),endOfScrollDelayMilliseconds:300,enable:function(t){e(x,["scroll"]),NotificationsModernizr.touchevents||b()?(e(w,["touchstart","pointerdown"]),e(_,["touchmove","pointermove"]),dt.add(t,"notifications--touch")):(e(k,["mousewheel","DOMMouseScroll"]),e(x,["mousewheel","DOMMouseScroll"])),dt.remove(t,"notifications-no-scroll"),this.enabled=!0},disable:function(t){NotificationsModernizr.touchevents||b()?(i(w,["touchstart","pointerdown"]),i(_,["touchmove","pointermove"]),i(x,["scroll"]),dt.remove(t,"notifications--touch")):(i(k,["mousewheel","DOMMouseScroll"]),i(x,["mousewheel","DOMMouseScroll"]),ht.removeEvent(t,"mousewheel",k)),dt.add(t,"notifications-no-scroll"),dt.remove(document.querySelector("#notifications__header"),"shadowAdded"),this.enabled=!1},check:function(t){var e=function(){return t.offsetHeight>=parseInt(t.style.maxHeight,10)},i="notification__windows-scroll";e()||G.models.length>=ct.env.visibleChunkAmount?(this.enabled||this.enable(t),(NotificationsModernizr.touchevents||b())&&(t.tabIndex="0",t.style.outline="none",t.focus()),(-1!==navigator.appVersion.indexOf("Win")&&!b()||-1!==navigator.appVersion.indexOf("Linux"))&&dt.add(t,i)):(this.enabled&&this.disable(t),(-1!==navigator.appVersion.indexOf("Win")&&!b()||-1!==navigator.appVersion.indexOf("Linux"))&&dt.remove(t,i))},_isSafari:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("safari")>-1&&-1===t.indexOf("chrome")},_checkFixSafari7Scroll:function(){var t;this._isSafari()&&(t=document.createElement("style"),t.type="text/css",t.innerHTML="#notifications-wrapper::-webkit-scrollbar {     -webkit-appearance: none;     width: 8px; }  #notifications-wrapper::-webkit-scrollbar-track {     background-color: transparent;     border-radius: 8px; }  #notifications-wrapper::-webkit-scrollbar-thumb {     border-radius: 8px;     background-color: rgba(0, 0, 0, .6); }",document.head.appendChild(t))},setEndOfScrollTimestamp:function(t){this.endOfScrollTimestamp=t},init:function(t){this._checkFixSafari7Scroll(),this.enable(t)}},Z.init(t)}function w(t){$=window.navigator.pointerEnabled?t.clientY:t.targetTouches[0].pageY}function _(t){var e=(window.navigator.pointerEnabled?t.clientY:t.changedTouches[0].pageY)-$;b()&&(this.scrollTop-=(Math.abs(e)<10?20*(0>e?-1:1):e)/20),E.call(this,t,e)}function k(t){var e=t.wheelDelta||-t.detail;dt[this.scrollTop>0?"add":"remove"](document.getElementById("notifications__header"),"shadowAdded"),E.call(this,t,e)}function E(t,e){var i=this.scrollTop+30>=this.scrollHeight-this.offsetHeight;(i||"shown"===Y.getState())&&0>=e&&(this.scrollTop=this.scrollHeight,S.call(this,t))}function C(){var t=document.activeElement.className;return"notifications-keyboard-access--more"===t||"notification-item--link"===t}function S(t,e){if(!e&&C())return t.preventDefault(),!1;if(e&&(at=!0),V.scrollTop+30>=V.scrollHeight-V.offsetHeight&&G.hasItemsToLoad()&&!G.fetchInprogress){if(Date.now()-Z.endOfScrollTimestamp<Z.endOfScrollDelayMilliseconds)return;Z.setEndOfScrollTimestamp(Date.now()),q(O),Y.show(),G.getNextPage();var i=document.querySelectorAll(".notification__item--js");if(i.length>0){var n=Array.prototype.slice.call(i,-1)[0];dt.add(n,"notification-border")}t&&"function"==typeof t.preventDefault&&t.preventDefault()}}function x(t){mt.check(),dt[this.scrollTop>0?"add":"remove"](document.getElementById("notifications__header"),"shadowAdded"),b()||S.call(this,t)}function T(){A(function(t,e){return t?pt.error("Error:",e):void 0})}function A(t){if("undefined"==typeof G){var e={userPreferencesModel:z,idcta:X};G=rt.getCollectionInstance(z,e),G.on("notification.latest.update",I),G.on("notification.new.page.ready",I),G.on("notification.load.error",P),G.getNextPage(),"function"==typeof t&&t(null,"success")}}function I(t,e){var i=300;e.newLatestItemsCount>0?(Ct=e.newLatestItemsCount,mt.unseenLatestDataCount+=Ct):Ct=0,setTimeout(function(){n(e.content||[])},i)}function P(){nt.showError({view:"hub",isInner:!1,errorElID:"#hub-error-main"})}function j(t){var e=null!==t.preferences?t.preferences.readFilter:[],i=ut.goBackDays(yt);"string"==typeof e&&(e=gt.handledParse(e,[])),J.override(e),ot=null!==t.preferences&&"undefined"!==t.preferences.lastRead?t.preferences.lastRead:i.toISOString(),H=null!==t.preferences&&"undefined"!=typeof t.preferences.currentDateTime?t.preferences.currentDateTime:(new Date).toISOString(),ut.setTime(H),st.update(c(_t))}function L(t,e){z.sync({preferences:t},function(t,i){t&&pt.log("Error syncing user preferences",arguments),"function"==typeof e&&e(t,i)})}function N(t){return"undefined"==typeof B&&"function"==typeof B[t]?null:B[t]()}function M(t,e){ht.removeEvent(t,"click",e),ht.addEvent(t,"click",e)}function D(t){var e=function(){return 0===_t.length?"none":l(_t)>0?"new":"read"};"hidden"===t?(dt.remove(document.getElementById("not-num"),"new-notifications"),q(O),st.update(_t),vt.log("close-pane","notifications-icon"),F(!0),it&&it.hide(!1),dt.removeClass(document.querySelector(".notifications-keyboard-access"),"notifications-keyboard-access--shown")):(p(),Z&&Z.check(V),vt.log("open-pane","notifications-icon",{notification_state:e()}),dt.remove(document.getElementById("notification-link"),"swing"),dt.remove(document.querySelector(".notification-panel"),"has-new"),kt=0,F(!0,function(t,e){t&&nt.showError({view:"hub",isInner:!0,closeEvent:function(){nt.hideError("hub",!1)},errorElID:"#hub-error-inner",closeEl:".notifications-error--inner__close"})}))}function q(t){if(!Et)for(var e=document.querySelectorAll(".notification-items li"),i=e.length;i--;)t(i,e)}function O(t,e){dt.hasClass(e[t],"notification-new")&&(dt.remove(e[t],"notification-new"),dt.add(e[t],"notification-unread"),_t[t].newItem="notification-unread",dt.remove(document.getElementById("notification-link"),"swing"))}function F(t,e){"undefined"!=typeof J&&L({readFilter:"undefined"!=typeof J.filter?J.getCleanArray():null,lastReadFlag:t},e)}function R(){var t=document.querySelector(".notifications__settings--js");vt.listenTo(t,"click",U)}function U(t){t.preventDefault?t.preventDefault():t.returnValue=!1,this.log("click","notifications-settings")}Array.prototype.forEach=Array.prototype.forEach||function(t){for(var e=-1;++e<this.length;)t(this[e],e)};var H,B,z,G,V,W,K,J,X,Y,$,Z,Q,tt,et,it,nt,ot,at,st=t("mybbc/notifications/vendor/riot.min"),rt=t("mybbc/notifications/collections/NotificationCollectionFactory"),ct=t("mybbc/notifications/config"),lt=(t("mybbc/notifications/BloomFilterManager"),t("mybbc/notifications/SettingsView")),dt=t("mybbc/notifications/classie"),ft=t("mybbc/notifications/AccessibilityManager"),ut=t("mybbc/notifications/DateManager"),ht=(t("mybbc/notifications/PreferencesClient"),t("mybbc/notifications/eventie")),pt=(t("mybbc/notifications/UserPreferences"),new(t("mybbc/notifications/logger"))("Main App")),gt=new(t("mybbc/notifications/utils"))(pt),mt=t("mybbc/notifications/popup"),vt=t("mybbc/notifications/analytics"),bt=ct.env.visibleChunkAmount,yt=ct.env.maxNotificationAge,wt={},_t=[],kt=0,Et=!0,Ct=0,St={init:function(t){"undefined"!=typeof this.name&&"mainApp"==this.name&&(B=this),d.call(null,t,St)},drawerStateChanged:function(t){D(t)},setHubSettings:function(t){wt=t,wt.baseAssetUrl=t.baseAssetUrl||"",X=t.idcta,z=t.userPreferencesModel,J=t.readFilter},updateVariables:j,userPreferencesModel:z};return St}),define("mybbc/notifications/NotificationsMain",["require","mybbc/notifications/config","orb/nav","mybbc/notifications/analytics","mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/utils","mybbc/notifications/PreferencesClient","mybbc/notifications/UserPreferences","mybbc/notifications/request","mybbc/notifications/BloomFilterManager","mybbc/notifications/logger","mybbc/notifications/StorageManager","mybbc/notifications/LocalStorageCache","mybbc/notifications/ErrorView","mybbc/notifications/NotificationsTemplate","mybbc/notifications/vendor/modernizr-custom"],function(t,e,i,n,o,a,s,r,c,l,d,f,u,h,p,g){var m,v,b,y,w=new f("App container"),_=new d("readFilter"),k=".notification-error__container",E=!1,C=new u("cachedPreferences"),S=new s,x={},T="preferencesUserId",A={name:"mainApp",drawerName:"notifications",errorState:!1,notificationPanelCreated:!1,orb:i,idConfig:e.env.idcta,userIdCache:h(T),run:function(t,i){this.basePath=i||"",this.setIdcta(t),this.setUserLoggedState(),this.manageLocalCache(),this.setNotificationIcon(),this.setErrorView(),"signed-in"===this.state?(this.setUserPreferencesModel(new c({client:new r(l,{config:e}),filter:_,cacheManager:C,idcta:this.idcta})),this.getUserPreferencesModel().fetch(S.bind(this.onUserPreferencesFetchFinished,this))):this.loadInitialTemplate()},manageLocalCache:function(){C.init(),"signed-out"==this.state?(C.clear(),this.userIdCache.clear()):"signed-in"==this.state&&(this.userHasChanged()&&C.clear(),this.userIdCache.put(this.idcta.getIdFromCookie()))},userHasChanged:function(){var t=this.userIdCache.get();return null!==t&&t!==this.idcta.getIdFromCookie()},onUserPreferencesFetchFinished:function(t,e){return t&&!C.hasCache()?(null===document.querySelector(k)&&this.prepareAndShowErrorView(),this.errorState=!0,w.log("Error reading user preferences and we have no cached value, so show the error message",arguments)):(this.getUserPreferencesModel().isPolling||this.getUserPreferencesModel().poll(S.bind(this.onUserPreferencesPollFinished,this)),void this.loadInitialTemplate())},_setHubResizeEvent:function(t){var e;["resize","orientationchange"].forEach(function(i){(NotificationsModernizr.touchevents||"orientationchange"!==i)&&a.addEvent(window,i,function(){e&&clearTimeout(e),e=setTimeout(t,100)})}),"function"==typeof t&&t()},prepareAndShowErrorView:function(){this.createPanel('<section class="%s"></section>'.replace("%s",k.slice(1))),y.showError({view:"main",isInner:!1,errorElID:"#hub-error-main"})},loadInitialTemplate:function(){this.loadTemplate(this.getTemplateNameByUserState(this.state),this.manageState)},onUserPreferencesPollFinished:function(t,e){return t?w.log("Error reading user preferences",arguments):void this.handleUserPreferencesResponse(e)},handleUserPreferencesResponse:function(t){"undefined"!=typeof m&&m.updateVariables(t)},setIdcta:function(t){"function"==typeof t.getInstance&&(t=t.getInstance()),this.idcta=t},setUserLoggedState:function(){this.state=this.idcta.hasCookie()?"signed-in":"signed-out"},setNotificationIcon:function(){var t=function(){var t=document.createElement("span");return t.setAttribute("aria-live","polite"),t.className="notification-link__live notification-link__live--js",t};this.navNotificationElement=document.querySelector(".js-notification-link"),this.navNotificationElement.onkeydown=function(t){var e=t.which||t.charCode;13==e&&(this.lastEnterPress=Date.now())},this.navNotificationElement.appendChild(t()),o.add(this.navNotificationElement,"notifications-shown"),this.orb.refresh(),"signed-in"===this.state||"on-boarding"===this.state?o.add(this.navNotificationElement,"notifications-black-bell"):o.add(this.navNotificationElement,"notifications-grey-bell")},getNavNotificationEl:function(){return this.navNotificationElement},prepareAndLaunchNotificationApp:function(){this.loadTemplate("signed-in",function(t){this.updateDrawerContent(t.compile(this.getTemplateData(t.name))),this.launch(function(){"hidden"===this.getDrawerState()&&this.navNotificationElement.click()})})},loadTemplate:function(t,e){"undefined"==typeof x[t]?(x[t]=g.create(t),x[t].load(e,this)):e.call(this,x[t].compile(this.getTemplateData(x[t].name)))},getTemplateData:function(t){var e,i=this;return e={"signed-in":{baseAssetUrl:i.basePath},"signed-out":{idConfig:i.idConfig,ptrt:encodeURIComponent(window.location.href.replace(window.location.hash,""))},"on-boarding":{baseAssetUrl:i.basePath}},"undefined"!=typeof t&&t in e?e[t]:e},getTemplateNameByUserState:function(){return"signed-in"!==this.state||this.isUserOnBoarded()?this.state:"on-boarding"},isUserOnBoarded:function(){var t=this.getUserPreferencesModel(),e=t.get().preferences;return null!==e&&"undefined"!=typeof e[c.HAS_ON_BOARDED_PARAM_NAME]?e[c.HAS_ON_BOARDED_PARAM_NAME]:!1},manageState:function(t){this.createPanel(t.compile(this.getTemplateData(t.name))),"signed-in"===this.state?this.isUserOnBoarded()?this.launch():this.manageBlueDotDisplay(!0):this.setUpsellAnalyticsEvents()},launchOnBoarding:function(){var e=this;t(["mybbc/notifications/onboarding"],function(t){v=t,v.init(e.getOnboardingParams()),"function"==typeof cb&&cb(v)})},getOnboardingParams:function(){return{mainElSelector:".notifications-on-boarding--js",app:this,isIE:this.isIE(),errorView:y,resizeEvent:this._setHubResizeEvent}},createPanel:function(t){this.orb.addDrawer(this.drawerName,this.getNavNotificationEl(),this.getPanelContentEl(t),this.getDrawerStateChangedCallback()),this.notificationPanelCreated=!0},getPanelContentEl:function(t){if("undefined"!=typeof this.drawerContentEl)return this.drawerContentEl;var e=document.createElement("div");return e.className="orb-panel",e.innerHTML=t,this.drawerContentEl=e,e},launch:function(e){var i=this;t(["mybbc/notifications/app"],function(t){m=t,m.init.call(i,{baseAssetUrl:i.basePath,readFilter:_,userPreferencesModel:b,errorView:y,resizeEvent:i._setHubResizeEvent,idcta:i.idcta}),m.updateVariables(i.getUserPreferencesModel().get()),"function"==typeof e&&e.call(i,m)})},getMainContainerEl:function(){return document.querySelector(".notifications-main--js")},setUpsellAnalyticsEvents:function(){n.listenTo(this.getMainContainerEl(),"click",this.onWatchedAnalyticsElementClicked)},onWatchedAnalyticsElementClicked:function(t){var e=t.target,i=this,n={"sign-in":"notifications-sign-in__link--js",register:"notifications-register__link--js"};S.each(n,function(n,a){(o.hasClass(e,n)||e.parentNode&&o.hasClass(e.parentNode,n))&&(t.preventDefault?t.preventDefault():t.returnValue=!1,i.log(a,"notifications-upsell"),window.location.href="A"==e.tagName?e.href:e.parentNode.href)})},setUserPreferencesModel:function(t){b=t},setErrorView:function(t){var e=this;y=t||p({showErrorWithID:"#hub-error-main",mainApp:e,container:k,stateChanged:function(t){var e,i;if(!this.isInner){switch(this.currentErrorView){case"hub":e=document.querySelector(".notifications-main--js"),null!==e&&(e.style.display="shown"==t?"none":"block");break;case"onboarding":i=document.querySelector(".notifications-on-boarding--js"),null!==i&&(i.style.display="shown"==t?"none":"block")}this.mainApp.updateDrawerHeight()}}})},getErrorView:function(){return y},getUserPreferencesModel:function(){return b},getReadFilter:function(){return _},getCacheManager:function(){return C},updateDrawerContent:function(t){this.getPanelContentEl().innerHTML=t},updateDrawerHeight:function(){this.orb.updateDrawerHeight(this.drawerName)},getDrawerState:function(){return this.orb.getDrawerState(this.drawerName)},manageBlueDotDisplay:function(t){o[t?"add":"remove"](document.getElementById("not-num"),"new-notifications")},resetOnboarding:function(){v.resetOnboarding(),v.init(this.getOnboardingParams())},isIE:function(){if(document.documentMode)return document.documentMode;for(var t=7;t>0;t--){var e=document.createElement("div");if(e.innerHTML="<!--[if IE "+t+"]><span></span><![endif]-->",e.getElementsByTagName("span").length)return t}},removeCustomHeights:function(){v.removeCustomHeights()},getDrawerStateChangedCallback:function(){var t=this;return function(e){if("signed-in"===t.state){if("undefined"!=typeof m)return m.drawerStateChanged(e);t.isUserOnBoarded()||v||t.errorState||(t.manageBlueDotDisplay(!1),t.launchOnBoarding()),v&&("hidden"===e?E=!0:E&&(t.resetOnboarding(),E=!1))}else"hidden"===e?n.log("close-pane","notifications-icon"):n.log("upsell","notifications-icon")}}};return A}),define("NotificationsMain",["mybbc/notifications/vendor/modernizr-custom","mybbc/templates/signed-in","mybbc/templates/signed-out","mybbc/templates/on-boarding","mybbc/templates/error","mybbc/notifications/ErrorView"],function(){});