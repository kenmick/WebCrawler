/*
Name: main.js
URL: http://qsf.is.quoracdn.net/-5c736651c3f729b9.js
Generated: 1447352434894966
Files: /json2.js, /assert.js, /log.settings.js, /log.js, /jquery.js, /jquery.securepost.js, /jquery.cookie.js, /cookies.js, /scribe.js, /keystrokes.js, /w2.keycombo.js, /Class.js, /w2.context.js, /core/component.js, /visibility.js, /webnode2.js, /jquery.dialog.js, /jquery.tooltip.js, /jquery.menu.js, /jquery.topic.js, /jquery.viewport.js, /jquery.whenIdle.js, /jquery.ajax.js, /effects.core.js, /effects.shake.js, /effects.highlight.js, /ytplayer.js, /browser.js, /lang/fun.js, /w2.errors.js, /w2.perf.js, /e2e.js, /gating.js, /interface/helpers.js, /interface/settings.js, /interface/jquery.js, /interface/rpc.js, /debounce.js, /rpc_manager.js, /window_manager.js, /w2.rpc.js, /jquery.quora.js, /atexit.js, /tchannel_up.js, /w2.livenode.js, /jquery.webnode2.js, /polyfills/requestAnimationFrame.js, /w2.dialog.js, /w2.modal.js, /w2.interaction.js, /w2.event.js, /w2.quora.js, /frame_busting.js, /init.js, /facebook.js, /oauth.js, /twitter.js, /google_.js, /mathjax.js, /siteuri.js, /login.js, /network.js, /dialog.js, /fastclick.js, /mobile.js, /view/modal.js, /view/captcha.js, /view/repeat_offender.js, /view/reauth.js, /unified_view/insertion_query.js, /unified_view/lazy_load_images.js, /lazy_load_images.js, /sticky.js, /view/spinner.js, /view/embed.js, /mathify.js, /input_validate.js, /action_log.js, /view/inline_editor.js, /view/embed_editor.js, /view/placepicker.js, /simscroll.js, /view/selector.js, /view/question_selector.js, /view/pmsg.js, /view/fixable2.js, /view/toggle.js, /app/view/home.js, /app/view/mathjax.js, /app/view/messages.js, /interface/modal.js, /interface/component.js, /unified_view/toggle.js, /interface/cookies.js, /unified_view/qtext.js, /app/view/common.js, /views.js, /view/paged_list.js, /app/view/feed.js, /app/view/feed/feedback.js, /app/view/share/connect.js, /app/view/settings.js, /app/view/tutorial.js, /qed/modifiers.js, /qed/nodestate.js, /qed/rules.js, /qed/sanitize.js, /qed/npd.js, /qed/util.js, /qed/unload.js, /qed/selection.js, /qed/snapshot.js, /qed/history.js, /qed/trie.js, /qed/snippets.js, /qed/edit.js, /linkify.js, /find.js, /qtexteditor.js, /app/view/question.js, /app/view/question/wanted_answer.js, /app/view/question/cant_answer.js, /app/view/question/merge/_merge.js, /app/view/question/merge/selector.js, /app/view/question/merge/modal.js, /app/view/board.js, /app/view/board/blog.js, /app/view/board/create_box.js, /app/view/board/follow_invite.js, /app/view/topic.js, /app/view/topic/topic_list.js, /app/view/topic/topic_redesign.js, /app/view/topic/location.js, /app/view/topic/merge.js, /app/view/signup.js, /app/view/signup/google_.js, /app/view/share/form.js, /app/view/share/modal.js, /app/view/contact_importer.js, /app/view/growl.js, /app/view/notifications/base.js, /app/view/notifications.js, /app/view/notifications/header.js, /view/hover_menu.js, /view/editable_list.js, /app/view/navigation.js, /app/view/nux.js, /app/view/nux/dialog.js, /app/view/nux/existing_user.js, /app/view/nux/find_friends.js, /app/view/activation/endorsement.js, /app/view/activation/endorsement/modal.js, /app/view/activation/endorsement/endorse_by_topic.js, /app/view/activation/endorsement/endorse_by_user.js, /app/view/activation/profile_topics.js, /app/view/activation/progress.js, /app/view/activation/topic_bios.js, /app/view/post.js, /app/view/user.js, /app/view/query/query.js, /app/view/query/selector.js, /view/filter_nav_list.js, /app/view/query/filters.js, /app/view/funnel.js, /app/view/group.js, /app/view/moderation/flag.js, /app/view/suggestions.js, /email.js, /app/view/user_stats.js, /app/view/user/content.js, /app/view/user/setup_.js, /app/view/user/subscribe.js, /view/toggle_list.js, /app/view/site_header/logged_in.js, /app/view/site_header/logged_out.js, /app/view/intro_to_quora.js, /app/view/reading_list.js, /app/view/write.js, /shared_utils.js, /view/upload.js, /app/view/bug_report.js, /app/view/primary_topic.js, /view/voter_list.js, /view/follower_list.js, /app/view/share.js, /app/view/question/question_add.js, /app/view/threaded_comments.js, /view/notif.js, /qtext.js, /swfobject.js, /flash.js, /app/view/thread.js, /app/view/survey/question_page.js, /app/view/topic/topic_ontology.js, /app/view/topic/leaderboard.js, /app/view/draft.js, /app/view/board/follow.js, /app/view/board/view_tracker.js, /app/view/board/item.js, /html.js, /async_post.js, /typeahead.js, /view/topic_selector.js, /app/view/topic/edit_topic_modal.js, /app/view/pmsg/pmsg.js, /app/view/admin.js, /app/view/suggested_photo.js, /app/view/vc.js, /app/view/widgets.js, /app/view/question/answer_tag.js, /view/photo.js, /app/view/question/add_answer.js, /app/view/question/disclaimer.js, /app/view/question/question_redirect.js, /app/view/question/lookup_bar.js, /app/view/components.js, /app/view/link.js, /app/view/static.js, /app/view/answer_wiki.js, /view/suggested_edits.js, /app/view/topic/topic_create.js, /app/view/suggested_sig.js, /app/view/announcement.js, /view/board_selector.js, /view/user.js, /app/view/layout.js, /app/view/comment.js, /view/datetime_.js, /app/view/topic/topic_editor.js, /app/view/oauth.js, /app/view/linkedin_.js, /view/invisibleinfo.js, /app/view/login.js, /app/view/question/suggested_answer.js, /app/view/photo.js, /app/view/thanks.js, /app/view/tumblr.js, /app/view/related.js, /app/view/payment/payable.js, /app/view/question/question_alias.js, /app/view/question/topics.js, /app/view/user/profile.js, /app/view/question/not_helpful.js, /view/filterable_list.js, /app/view/board/submission.js, /view/announcement.js, /app/view/board/settings.js, /app/view/zapdos/card.js, /app/view/ask.js, /app/view/user_settings/settings.js, /view/reorderable_list.js, /view/scroll_indicator.js, /third_party/truncate.js, /app/view/topic/faq.js, /app/view/quora_meets_bagel.js, /app/view/moderation/appeal.js, /app/view/embed.js, /app/view/question/answer_credibility.js, /app/view/quality/base.js, /app/view/quality/answer.js, /app/view/answer/improvement.js, /view/tooltip.js, /view/fixable_component.js, /app/view/advertising/create_ad.js, /app/view/advertising/manage_payment.js, /app/view/advertising/create_campaign.js, /app/view/advertising/manage_campaign.js, /app/view/advertising/ads_home.js, /app/view/signup/conversion_logging.js, /view/privacy.js, /app/view/manage.js, /unified_view/util.js, /unified_view/action_bar/base.js, /unified_view/action_bar/answer.js, /unified_view/action_bar/_action_bar.js, /unified_view/action_bar/shared.js, /unified_view/action_bar/blog.js, /unified_view/action_bar/question.js, /unified_view/action_bar/remove_from_feed.js, /unified_view/action_bar/user.js, /interface/dialog.js, /unified_view/modal.js, /unified_view/action_bar/overflow_menu/base.js, /unified_view/action_bar/overflow_menu/answer.js, /unified_view/action_bar/overflow_menu/profile.js, /unified_view/privacy.js, /unified_view/action_bar/overflow_menu/question.js, /unified_view/action_bar/overflow_menu/remove_from_feed.js, /unified_view/action_bar/overflow_menu/shared.js, /unified_view/button/abstract.js, /unified_view/button/downvote.js, /unified_view/button/follow.js, /unified_view/button/pin.js, /unified_view/button/reask.js, /unified_view/button/slow_connection.js, /unified_view/button/network.js, /unified_view/button/upvote.js, /unified_view/button/write_answer.js, /unified_view/button/writing_list.js, /unified_view/lazy.js, /unified_view/network/invite.js, /unified_view/network/join.js, /unified_view/payment/money.js, /unified_view/payment/_payment.js, /unified_view/settings/privacy.js, /unified_view/switch.js, /unified_view/mobile_debug.js, /unified_view/translation.js, /qtext2/util.js, /third_party/rangy-core.js, /qtext2/undo.js, /qtext2/keys.js, /qtext2/mutations.js, /qtext2/parser.js, /qtext2/base.js, /qtext2/ui.js, /unified_view/upload.js, /unified_view/qtext2/editor.js, /unified_view/qtext2/editor/mobile.js, /qtext2.js, /unified_view/qtext2/toolbar.js, /unified_view/character_counter.js, /unified_view/main.js, /unified_view/captcha.js, /app/view/ama.js, /app/view/tribes.js, /app/view/bounty/_bounty.js, /app/view/bounty/manage.js, /main.js, /main-loaded.js
*/
require.install("json2",function(require,exports,module){if(!this.JSON){this.JSON={}}(function(){function f(e){return e<10?"0"+e:e}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,o,s,r=gap,a,l=t[e];if(l&&typeof l==="object"&&typeof l.toJSON==="function"){l=l.toJSON(e)}if(typeof rep==="function"){l=rep.call(t,e,l)}switch(typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l){return"null"}gap+=indent;a=[];if(Object.prototype.toString.apply(l)==="[object Array]"){s=l.length;for(i=0;i<s;i+=1){a[i]=str(i,l)||"null"}o=a.length===0?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+r+"]":"["+a.join(",")+"]";gap=r;return o}if(rep&&typeof rep==="object"){s=rep.length;for(i=0;i<s;i+=1){n=rep[i];if(typeof n==="string"){o=str(n,l);if(o){a.push(quote(n)+(gap?": ":":")+o)}}}}else{for(n in l){if(Object.hasOwnProperty.call(l,n)){o=str(n,l);if(o){a.push(quote(n)+(gap?": ":":")+o)}}}}o=a.length===0?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+r+"}":"{"+a.join(",")+"}";gap=r;return o}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,i){var n;gap="";indent="";if(typeof i==="number"){for(n=0;n<i;n+=1){indent+=" "}}else if(typeof i==="string"){indent=i}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(e,t){var i,n,o=e[t];if(o&&typeof o==="object"){for(i in o){if(Object.hasOwnProperty.call(o,i)){n=walk(o,i);if(n!==undefined){o[i]=n}else{delete o[i]}}}}return reviver.call(e,t,o)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})()},{});require.install("assert",function(require,exports,module){var e=require("settings");function t(){}function i(){debugger}function n(t){if(e.debug){try{i()}finally{throw t}}}function o(e){this.message=e.message||this.message;this.actual=e.actual;this.expected=e.expected}o.prototype=new Error("assertion failure");o.prototype.toString=function(){return this.message+(": got "+this.actual+", expected "+this.expected)};var s={}.hasOwnProperty;function r(e,t){if(e===t){return true}if(e instanceof Date){return t instanceof Date&&+e===+t}if(typeof e!="object"||typeof t!="object"){return e==t}if(e.prototype!==t.prototype){return false}var i,n={};for(i in e){n[i]=true}for(i in t){n[i]=true}if(e instanceof Array){for(var o=Math.max(e.length,t.length)-1;o>=0;--o){if(o in n){break}else{n[o]=true}}}for(i in n){if(i in e!=i in t||s.call(e,i)!=s.call(t,i)||!r(e[i],t[i])){return false}}return true}function a(e){return function(i,s,r){(e.call(exports,i,s)?t:n)(new o({message:r,actual:i,expected:s}))}}exports.AssertionError=o;exports.equal=a(function(e,t){return e==t});exports.notEqual=a(function(e,t){return e!=t});exports.deepEqual=a(function(e,t){return r(e,t)});exports.notDeepEqual=a(function(e,t){return!r(e,t)});exports.strictEqual=a(function(e,t){return e===t});exports.notStrictEqual=a(function(e,t){return e!==t});exports.throws_error=a(function(e,t){try{e();return false}catch(i){return!t||i instanceof t}});exports.ok=window.assert=function(e,t){exports.equal(!!e,true,t)};exports.notOk=function(e,t){exports.equal(!!e,false,t)};exports.todo=function(e,t){if(e){exports.equal(!!e,false,t)}};exports.greaterThan=a(function(e,t){return e>t});exports.lessThan=a(function(e,t){return e<t});exports.matches=a(function(e,t){return t instanceof RegExp&&t.test(e)})},{settings:true});require.install("log.settings",function(require,exports,module){exports.resetSettings=function(e){var t=require("settings");e.enable(t===null?false:t.client_side_logging||false);e.scopes.resetLevel("",e.level.error);e.scopes.resetLevel("page",e.level.trace);e.scopes.resetLevel("views",e.level.trace);e.scopes.resetLevel("qtext2",e.level.trace);e.scopes.resetLevel("test",e.level.trace)}},{settings:true});require.install("log",function(require,exports,module){(function(e,t){var i=new Date;var n=function(e){return Array.prototype.join.call(e," ")};var o=function(e,t){for(var i in t){e[i]=t[i]}return e};var s=e.log=exports.log=function(){return s.log.apply(s,arguments)};var r=e.console;var a=r||{};var l=window&&window.navigator.appName=="Microsoft Internet Explorer";if(l){var u=/MSIE ([0-9]{1,}[.0-9]{0,})/;if(u.exec(navigator.userAgent)!==null&&parseFloat(RegExp.$1)>=8){a={};a.log=function(){if(r&&r.log){r.log(n(arguments))}};a.info=function(){if(r&&r.log){r.info(n(arguments))}};a.warn=function(){if(r&&r.log){r.warn(n(arguments))}};a.error=function(){if(r&&r.log){r.error(n(arguments))}}}else{a={}}}var d=["log","info","warn","error"];var c=function(){};for(var h in d){var f=d[h];if(!a[f]){a[f]=c}}var p=function(e){if(e===t){e=null}this.level=e;this.children={}};p.prototype.setLevel=function(e,i,n){var o=this.tryGetChild(e,n);if(o===null){if(i===t){i=null}this.level=i;return}if(o.child===t){this.children[o.name]=o.child=new p}o.child.setLevel(e,i,o.continueFrom);this.optimize(o.name)};p.prototype.removeChildren=function(e,i){var n=this.tryGetChild(e,i);if(n===null){this.children={};return}if(n.child===t){return}n.child.removeChildren(e,n.continueFrom);this.optimize(n.name)};p.prototype.optimize=function(e){var i=this.children[e];if(i!==t&&i.level===null&&i.childCount()===0){delete this.children[e]}};p.prototype.childCount=function(){var e=0;for(var t in this.children){if(this.children.hasOwnProperty(t)){e++}}return e};p.prototype.getLevel=function(e,i){var n=this.tryGetChild(e,i);if(n===null||n.child===t){return this.level}var o=n.child.getLevel(e,n.continueFrom);if(o!==null){return o}return this.level};p.prototype.print=function(e,t,i){var n=this.level===null?i:this.level;s.console.log(e+t+": "+s.level.toString(n)+(this.level===null?" (inherited)":""));for(t in this.children){var o=this.children[t];o.print(e+"  ",t,n)}};p.prototype.tryGetChild=function(e,t){if("string"!==typeof e){throw new Error("Scope must be string.")}t=t||0;if(t>=e.length){return null}var i=e.indexOf(".",t);var n=null;if(i<0){i=e.length;n=e.substr(t,i-t)}else{n=e.substr(t,i-t);i++}return{name:n,child:this.children[n],continueFrom:i}};var g=function(e,t,i){this.time=new Date;this.level=e;this.scope=t;this.data=i;this.message=n(i)};g.prototype.toString=function(){return s.level.toString(this.level).concat(" ",this._timeToString(),", ",this.scope,": ",this.message)};g.prototype.print=function(){var e=this.level=="trace"?"log":this.level;s.console[s.level.toString(e)].apply(s.console,[this._timeToString()+", "+this.scope+":"].concat(this.data))};g.prototype.checkScope=function(e){return this.scope==e||this.scope.startsWith(e+".")};g.prototype._timeToString=function(){return((this.time-i)/1e3).toString()+"s"};var _=function(e){this.list=e||[]};_.prototype.toString=function(){return this.list.join("\r\n")};_.prototype.print=function(){for(var e in this.list){this.list[e].print()}};_.prototype.add=function(e){return this.list.push(e)};_.prototype.count=function(){return this.list.length};_.prototype.getLast=function(){if(this.list.length===0){return null}return this.list[this.list.length-1]};_.prototype.clear=function(){this.list=[]};_.prototype.filter=function(e,i){var n,o;if(typeof e=="function"){n=Array.prototype.filter.apply(this.list,arguments);return new _(n)}if(i===t&&typeof e=="string"){i=e;e=null}var s=typeof e==="number";if(!s){var r={};for(o in e){r[e[o]]=e[o]}e=r}n=[];for(o in this.list){var a=this.list[o];if(e!==null&&e!==t&&(s?a.level<e:!(a.level in e))){continue}if(i!==null&&i!==t&&!a.checkScope(i)){continue}n.push(a)}return new _(n)};var m={enabled:null,outputEnabled:true,entries:new _,level:{none:0,trace:1,log:2,info:3,warn:4,error:5,toString:function(e){switch(e){case 0:return"none";case 1:return"trace";case 2:return"log";case 3:return"info";case 4:return"warn";case 5:return"error";default:throw new Error("Unknown log.level value.")}}},scopes:{root:new p(0),cache:{},setLevel:function(e,t){this.root.setLevel(e,t);this.cache={}},resetLevel:function(e,t){this.root.removeChildren(e);this.root.setLevel(e,t);this.cache={}},removeChildren:function(e){this.root.removeChildren(e);this.cache={}},getLevel:function(e){if(this.cache[e]===t){this.cache[e]=this.root.getLevel(e)||s.level.none}return this.cache[e]},hasLevel:function(e,t){var i=this.getLevel(e);return i<=t&&i!=s.level.none},print:function(e){s.console.log("Log scopes:");this.root.print("  ","(root)")}},enabledImpl:{console:a,trace:function(e){var t=this._tryAddLogEntry(s.level.log,e,Array.prototype.slice.call(arguments,1));if(t===null){return null}if(s.outputEnabled){if(s.console.trace){s.console.trace()}else{s.console.log.call(s.console,("Stack trace:\r\n"+s._getStackTrace()).replace("\r\n","\r\n  "))}}return t},log:function(e){return this._tryAddLogEntry(s.level.log,e,Array.prototype.slice.call(arguments,1))},info:function(e){return this._tryAddLogEntry(s.level.info,e,Array.prototype.slice.call(arguments,1))},warn:function(e){return this._tryAddLogEntry(s.level.warn,e,Array.prototype.slice.call(arguments,1))},error:function(e){return this._tryAddLogEntry(s.level.error,e,Array.prototype.slice.call(arguments,1))},_tryAddLogEntry:function(e,t,i){if(!s.scopes.hasLevel(t,e)){return null}var n=new g(e,t,i);s.entries.add(n);if(s.outputEnabled){n.print()}return n},_getStackTrace:function(){var e=[];var t=false;try{o.dont.exist+=0}catch(i){var n,o,s;if(i.stack){n=i.stack.split("\n");for(o=0,s=n.length;o<s;o++){if(n[o].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){e.push(n[o])}}e.shift();t=true}else if(window&&window.opera&&i.message){n=i.message.split("\n");for(o=0,s=n.length;o<s;o++){if(n[o].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){var r=n[o];if(n[o+1]){r+=" at "+n[o+1];o++}e.push(r)}}e.shift();t=true}}if(!t){var a=arguments.callee.caller;while(a){var l=a.toString();var u=l.substring(l.indexOf("function"),l.indexOf("{"))||"anonymous";e.push(u);a=a.caller}}return e.join("\r\n")}},disabledImpl:{console:{log:function(){},trace:function(){},info:function(){},warn:function(){}},log:function(){},trace:function(){},info:function(){},warn:function(){},error:function(){}},enable:function(e){e=e===t?true:e;if(s.enabled===e){return}s.enabled=e;var i=e?s.enabledImpl:s.disabledImpl;o(s,i)},disable:function(){s.enable(false)},enableOutput:function(e){e=e===null?true:e;s.outputEnabled=e},disableOutput:function(){s.enableOutput(false)},resetSettings:function(){require("log.settings").resetSettings(s);s("log.resetSettings","Settings are reset to default.")}};o(s,m);s.resetSettings()})(this)},{"log.settings":true});require.install("jquery",function(require,exports,module){(function(e,t){var i=e.document,n=e.navigator,o=e.location;var s=function(){var o=function(e,t){return new o.fn.init(e,t,a)},s=e.jQuery,r=e.$,a,l=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,u=/\S/,d=/^\s+/,c=/\s+$/,h=/\d/,f=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,_=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,v=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,k=/(mozilla)(?:.*? rv:([\w.]+))?/,C=/-([a-z]|[0-9])/gi,y=/^-ms-/,x=function(e,t){return(t+"").toUpperCase()},S=n.userAgent,T,L,q,E=Object.prototype.toString,I=Object.prototype.hasOwnProperty,M=Array.prototype.push,A=Array.prototype.slice,D=String.prototype.trim,N=Array.prototype.indexOf,O={};o.fn=o.prototype={constructor:o,init:function(e,n,s){var r,a,u,d;if(!e){return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(e==="body"&&!n&&i.body){this.context=i;this[0]=i.body;this.selector=e;this.length=1;return this}if(typeof e==="string"){if(e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3){r=[null,e,null]}else{r=l.exec(e)}if(r&&(r[1]||!n)){if(r[1]){n=n instanceof o?n[0]:n;d=n?n.ownerDocument||n:i;u=f.exec(e);if(u){if(o.isPlainObject(n)){e=[i.createElement(u[1])];o.fn.attr.call(e,n,true)}else{e=[d.createElement(u[1])]}}else{u=o.buildFragment([r[1]],[d]);e=(u.cacheable?o.clone(u.fragment):u.fragment).childNodes}return o.merge(this,e)}else{a=i.getElementById(r[2]);if(a&&a.parentNode){if(a.id!==r[2]){return s.find(e)}this.length=1;this[0]=a}this.context=i;this.selector=e;return this}}else if(!n||n.jquery){return(n||s).find(e)}else{return this.constructor(n).find(e)}}else if(o.isFunction(e)){return s.ready(e)}if(e.selector!==t){this.selector=e.selector;this.context=e.context}return o.makeArray(e,this)},selector:"",jquery:"1.7",length:0,size:function(){return this.length},toArray:function(){return A.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,i){var n=this.constructor();if(o.isArray(e)){M.apply(n,e)}else{o.merge(n,e)}n.prevObject=this;n.context=this.context;if(t==="find"){n.selector=this.selector+(this.selector?" ":"")+i}else if(t){n.selector=this.selector+"."+t+"("+i+")"}return n},each:function(e,t){return o.each(this,e,t)},ready:function(e){o.bindReady();L.add(e);return this},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(A.apply(this,arguments),"slice",A.call(arguments).join(","))},map:function(e){return this.pushStack(o.map(this,function(t,i){return e.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:M,sort:[].sort,splice:[].splice};o.fn.init.prototype=o.fn;o.extend=o.fn.extend=function(){var e,i,n,s,r,a,l=arguments[0]||{},u=1,d=arguments.length,c=false;if(typeof l==="boolean"){c=l;l=arguments[1]||{};u=2}if(typeof l!=="object"&&!o.isFunction(l)){l={}}if(d===u){l=this;--u}for(;u<d;u++){if((e=arguments[u])!=null){for(i in e){n=l[i];s=e[i];if(l===s){continue}if(c&&s&&(o.isPlainObject(s)||(r=o.isArray(s)))){if(r){r=false;a=n&&o.isArray(n)?n:[]}else{a=n&&o.isPlainObject(n)?n:{}}l[i]=o.extend(c,a,s)}else if(s!==t){l[i]=s}}}}return l};o.extend({noConflict:function(t){if(e.$===o){e.$=r}if(t&&e.jQuery===o){e.jQuery=s}return o},isReady:false,readyWait:1,holdReady:function(e){if(e){o.readyWait++}else{o.ready(true)}},ready:function(e){if(e===true&&!--o.readyWait||e!==true&&!o.isReady){if(!i.body){return setTimeout(o.ready,1)}o.isReady=true;if(e!==true&&--o.readyWait>0){return}L.fireWith(i,[o]);if(o.fn.trigger){o(i).trigger("ready").unbind("ready")}}},bindReady:function(){if(L){return}L=o.Callbacks("once memory");if(i.readyState==="complete"){return setTimeout(o.ready,1)}if(i.addEventListener){i.addEventListener("DOMContentLoaded",q,false);e.addEventListener("load",o.ready,false)}else if(i.attachEvent){i.attachEvent("onreadystatechange",q);e.attachEvent("onload",o.ready);var t=false;try{t=e.frameElement==null}catch(n){}if(i.documentElement.doScroll&&t){F()}}},isFunction:function(e){return o.type(e)==="function"},isArray:Array.isArray||function(e){return o.type(e)==="array"},isWindow:function(e){return e&&typeof e==="object"&&"setInterval"in e},isNumeric:function(e){return e!=null&&h.test(e)&&!isNaN(e)},type:function(e){return e==null?String(e):O[E.call(e)]||"object"},isPlainObject:function(e){if(!e||o.type(e)!=="object"||e.nodeType||o.isWindow(e)){return false}try{if(e.constructor&&!I.call(e,"constructor")&&!I.call(e.constructor.prototype,"isPrototypeOf")){return false}}catch(i){return false}var n;for(n in e){}return n===t||I.call(e,n)},isEmptyObject:function(e){for(var t in e){return false}return true},error:function(e){throw e},parseJSON:function(t){if(typeof t!=="string"||!t){return null}t=o.trim(t);if(e.JSON&&e.JSON.parse){return e.JSON.parse(t)}if(p.test(t.replace(g,"@").replace(_,"]").replace(m,""))){return new Function("return "+t)()}o.error("Invalid JSON: "+t)},parseXML:function(i){var n,s;try{if(e.DOMParser){s=new DOMParser;n=s.parseFromString(i,"text/xml")}else{n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(i)}}catch(r){n=t}if(!n||!n.documentElement||n.getElementsByTagName("parsererror").length){o.error("Invalid XML: "+i)}return n},noop:function(){},globalEval:function(t){if(t&&u.test(t)){(e.execScript||function(t){e["eval"].call(e,t)})(t)}},camelCase:function(e){return e.replace(y,"ms-").replace(C,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,i,n){var s,r=0,a=e.length,l=a===t||o.isFunction(e);if(n){if(l){for(s in e){if(i.apply(e[s],n)===false){break}}}else{for(;r<a;){if(i.apply(e[r++],n)===false){break}}}}else{if(l){for(s in e){if(i.call(e[s],s,e[s])===false){break}}}else{for(;r<a;){if(i.call(e[r],r,e[r++])===false){break}}}}return e},trim:D?function(e){return e==null?"":D.call(e)}:function(e){return e==null?"":e.toString().replace(d,"").replace(c,"")},makeArray:function(e,t){var i=t||[];if(e!=null){var n=o.type(e);if(e.length==null||n==="string"||n==="function"||n==="regexp"||o.isWindow(e)){M.call(i,e)}else{o.merge(i,e)}}return i},inArray:function(e,t,i){var n;if(t){if(N){return N.call(t,e,i)}n=t.length;i=i?i<0?Math.max(0,n+i):i:0;for(;i<n;i++){if(i in t&&t[i]===e){return i}}}return-1},merge:function(e,i){var n=e.length,o=0;if(typeof i.length==="number"){for(var s=i.length;o<s;o++){e[n++]=i[o]}}else{while(i[o]!==t){e[n++]=i[o++]}}e.length=n;return e},grep:function(e,t,i){var n=[],o;i=!!i;for(var s=0,r=e.length;s<r;s++){o=!!t(e[s],s);if(i!==o){n.push(e[s])}}return n},map:function(e,i,n){var s,r,a=[],l=0,u=e.length,d=e instanceof o||u!==t&&typeof u==="number"&&(u>0&&e[0]&&e[u-1]||u===0||o.isArray(e));if(d){for(;l<u;l++){s=i(e[l],l,n);if(s!=null){a[a.length]=s}}}else{for(r in e){s=i(e[r],r,n);if(s!=null){a[a.length]=s}}}return a.concat.apply([],a)},guid:1,proxy:function(e,i){if(typeof i==="string"){var n=e[i];i=e;e=n}if(!o.isFunction(e)){return t}var s=A.call(arguments,2),r=function(){return e.apply(i,s.concat(A.call(arguments)))};r.guid=e.guid=e.guid||r.guid||o.guid++;return r},access:function(e,i,n,s,r,a){var l=e.length;if(typeof i==="object"){for(var u in i){o.access(e,u,i[u],s,r,n)}return e}if(n!==t){s=!a&&s&&o.isFunction(n);for(var d=0;d<l;d++){r(e[d],i,s?n.call(e[d],d,r(e[d],i)):n,a)}return e}return l?r(e[0],i):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=v.exec(e)||w.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&k.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,i){return new e.fn.init(t,i)}o.extend(true,e,this);e.superclass=this;e.fn=e.prototype=this();e.fn.constructor=e;e.sub=this.sub;e.fn.init=function n(i,s){if(s&&s instanceof o&&!(s instanceof e)){s=e(s)}return o.fn.init.call(this,i,s,t)};e.fn.init.prototype=e.fn;var t=e(i);return e},browser:{}});o.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()});T=o.uaMatch(S);if(T.browser){o.browser[T.browser]=true;o.browser.version=T.version}if(o.browser.webkit){o.browser.safari=true}if(u.test("Â ")){d=/^[\s\xA0]+/;c=/[\s\xA0]+$/}a=o(i);if(i.addEventListener){q=function(){i.removeEventListener("DOMContentLoaded",q,false);o.ready()}}else if(i.attachEvent){q=function(){if(i.readyState==="complete"){i.detachEvent("onreadystatechange",q);o.ready()}}}function F(){if(o.isReady){return}try{i.documentElement.doScroll("left")}catch(e){setTimeout(F,1);return}o.ready()}if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return o})}return o}();var r={};function a(e){var t=r[e]={},i,n;e=e.split(/\s+/);for(i=0,n=e.length;i<n;i++){t[e[i]]=true}return t}s.Callbacks=function(e){e=e?r[e]||a(e):{};var i=[],n=[],o,l,u,d,c,h=function(t){var n,o,r,a,l;for(n=0,o=t.length;n<o;n++){r=t[n];a=s.type(r);if(a==="array"){h(r)}else if(a==="function"){if(!e.unique||!p.has(r)){i.push(r)}}}},f=function(t,s){s=s||[];o=!e.memory||[t,s];l=true;c=u||0;u=0;d=i.length;for(;i&&c<d;c++){if(i[c].apply(t,s)===false&&e.stopOnFalse){o=true;break}}l=false;if(i){if(!e.once){if(n&&n.length){o=n.shift();p.fireWith(o[0],o[1])}}else if(o===true){p.disable()}else{i=[]}}},p={add:function(){if(i){var e=i.length;h(arguments);if(l){d=i.length}else if(o&&o!==true){u=e;f(o[0],o[1])}}return this},remove:function(){if(i){var t=arguments,n=0,o=t.length;for(;n<o;n++){for(var s=0;s<i.length;s++){if(t[n]===i[s]){if(l){if(s<=d){d--;if(s<=c){c--}}}i.splice(s--,1);if(e.unique){break}}}}}return this},has:function(e){if(i){var t=0,n=i.length;for(;t<n;t++){if(e===i[t]){return true}}}return false},empty:function(){i=[];return this},disable:function(){i=n=o=t;return this},disabled:function(){return!i},lock:function(){n=t;if(!o||o===true){p.disable()}return this},locked:function(){return!n},fireWith:function(t,i){if(n){if(l){if(!e.once){n.push([t,i])}}else if(!(e.once&&o)){f(t,i)}}return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!o}};return p};var l=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),i=s.Callbacks("once memory"),n=s.Callbacks("memory"),o="pending",r={resolve:t,reject:i,notify:n},a={done:t.add,fail:i.add,progress:n.add,state:function(){return o},isResolved:t.fired,isRejected:i.fired,then:function(e,t,i){l.done(e).fail(t).progress(i);return this},always:function(){return l.done.apply(l,arguments).fail.apply(l,arguments)},pipe:function(e,t,i){return s.Deferred(function(n){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[i,"notify"]},function(e,t){var i=t[0],o=t[1],r;if(s.isFunction(i)){l[e](function(){r=i.apply(this,arguments);if(r&&s.isFunction(r.promise)){r.promise().then(n.resolve,n.reject,n.notify)}else{n[o+"With"](this===l?n:this,[r])}})}else{l[e](n[o])}})}).promise()},promise:function(e){if(e==null){e=a}else{for(var t in a){e[t]=a[t]}}return e}},l=a.promise({}),u;for(u in r){l[u]=r[u].fire;l[u+"With"]=r[u].fireWith}l.done(function(){o="resolved"},i.disable,n.lock).fail(function(){o="rejected"},t.disable,n.lock);if(e){e.call(l,l)}return l},when:function(e){var t=l.call(arguments,0),i=0,n=t.length,o=new Array(n),r=n,a=n,u=n<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),d=u.promise();function c(e){return function(i){t[e]=arguments.length>1?l.call(arguments,0):i;if(!--r){u.resolveWith(u,t)}}}function h(e){return function(t){o[e]=arguments.length>1?l.call(arguments,0):t;u.notifyWith(d,o)}}if(n>1){for(;i<n;i++){if(t[i]&&t[i].promise&&s.isFunction(t[i].promise)){t[i].promise().then(c(i),u.reject,h(i))}else{--r}}if(!r){u.resolveWith(u,t)}}else if(u!==e){u.resolveWith(u,n?[e]:[])}return d}});s.support=function(){var e=i.createElement("div"),t=i.documentElement,n,o,r,a,l,u,d,c,h,f,p,g,_,m,v,w,b;e.setAttribute("className","t");e.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/><nav></nav>";n=e.getElementsByTagName("*");o=e.getElementsByTagName("a")[0];if(!n||!n.length||!o){return{}}r=i.createElement("select");a=r.appendChild(i.createElement("option"));l=e.getElementsByTagName("input")[0];d={leadingWhitespace:e.firstChild.nodeType===3,tbody:!e.getElementsByTagName("tbody").length,htmlSerialize:!!e.getElementsByTagName("link").length,style:/top/.test(o.getAttribute("style")),hrefNormalized:o.getAttribute("href")==="/a",opacity:/^0.55/.test(o.style.opacity),cssFloat:!!o.style.cssFloat,unknownElems:!!e.getElementsByTagName("nav").length,checkOn:l.value==="on",optSelected:a.selected,getSetAttribute:e.className!=="t",enctype:!!i.createElement("form").enctype,submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};l.checked=true;d.noCloneChecked=l.cloneNode(true).checked;r.disabled=true;d.optDisabled=!a.disabled;try{delete e.test}catch(k){d.deleteExpando=false}if(!e.addEventListener&&e.attachEvent&&e.fireEvent){e.attachEvent("onclick",function(){d.noCloneEvent=false});e.cloneNode(true).fireEvent("onclick")}l=i.createElement("input");l.value="t";l.setAttribute("type","radio");d.radioValue=l.value==="t";l.setAttribute("checked","checked");e.appendChild(l);c=i.createDocumentFragment();c.appendChild(e.lastChild);d.checkClone=c.cloneNode(true).cloneNode(true).lastChild.checked;e.innerHTML="";e.style.width=e.style.paddingLeft="1px";h=i.getElementsByTagName("body")[0];p=i.createElement(h?"div":"body");g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(h){s.extend(g,{position:"absolute",left:"-999px",top:"-999px"})}for(w in g){p.style[w]=g[w]}p.appendChild(e);f=h||t;f.insertBefore(p,f.firstChild);d.appendChecked=l.checked;d.boxModel=e.offsetWidth===2;if("zoom"in e.style){e.style.display="inline";e.style.zoom=1;d.inlineBlockNeedsLayout=e.offsetWidth===2;e.style.display="";e.innerHTML="<div style='width:4px;'></div>";d.shrinkWrapBlocks=e.offsetWidth!==2}e.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";_=e.getElementsByTagName("td");b=_[0].offsetHeight===0;_[0].style.display="";_[1].style.display="none";d.reliableHiddenOffsets=b&&_[0].offsetHeight===0;e.innerHTML="";if(i.defaultView&&i.defaultView.getComputedStyle){u=i.createElement("div");u.style.width="0";u.style.marginRight="0";e.appendChild(u);d.reliableMarginRight=(parseInt((i.defaultView.getComputedStyle(u,null)||{marginRight:0}).marginRight,10)||0)===0}if(e.attachEvent){for(w in{submit:1,change:1,focusin:1}){v="on"+w;b=v in e;if(!b){e.setAttribute(v,"return;");b=typeof e[v]==="function"}d[w+"Bubbles"]=b}}s(function(){var e,t,n,o,r,a,l=1,u="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",c="visibility:hidden;border:0;",f="style='"+u+"border:5px solid #000;padding:0;'",g="<div "+f+"><div></div></div>"+"<table "+f+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";h=i.getElementsByTagName("body")[0];if(!h){return}e=i.createElement("div");e.style.cssText=c+"width:0;height:0;position:static;top:0;margin-top:"+l+"px";h.insertBefore(e,h.firstChild);p=i.createElement("div");p.style.cssText=u+c;p.innerHTML=g;e.appendChild(p);t=p.firstChild;n=t.firstChild;r=t.nextSibling.firstChild.firstChild;a={doesNotAddBorder:n.offsetTop!==5,doesAddBorderForTableAndCells:r.offsetTop===5};n.style.position="fixed";n.style.top="20px";a.fixedPosition=n.offsetTop===20||n.offsetTop===15;n.style.position=n.style.top="";t.style.overflow="hidden";t.style.position="relative";a.subtractsBorderForOverflowNotVisible=n.offsetTop===-5;a.doesNotIncludeMarginInBodyOffset=h.offsetTop!==l;h.removeChild(e);p=e=null;s.extend(d,a)});p.innerHTML="";f.removeChild(p);p=c=r=a=h=u=e=l=null;return d}();s.boxModel=s.support.boxModel;var u=/^(?:\{.*\}|\[.*\])$/,d=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(e){e=e.nodeType?s.cache[e[s.expando]]:e[s.expando];return!!e&&!h(e)},data:function(e,i,n,o){if(!s.acceptData(e)){return}var r,a,l,u=s.expando,d=typeof i==="string",c=e.nodeType,h=c?s.cache:e,f=c?e[s.expando]:e[s.expando]&&s.expando,p=i==="events";if((!f||!h[f]||!p&&!o&&!h[f].data)&&d&&n===t){return}if(!f){if(c){e[s.expando]=f=++s.uuid}else{f=s.expando}}if(!h[f]){h[f]={};if(!c){h[f].toJSON=s.noop}}if(typeof i==="object"||typeof i==="function"){if(o){h[f]=s.extend(h[f],i)}else{h[f].data=s.extend(h[f].data,i)}}r=a=h[f];if(!o){if(!a.data){a.data={}}a=a.data}if(n!==t){a[s.camelCase(i)]=n}if(p&&!a[i]){return r.events}if(d){l=a[i];if(l==null){l=a[s.camelCase(i)]}}else{l=a}return l},removeData:function(e,t,i){if(!s.acceptData(e)){return}var n,o,r,a=s.expando,l=e.nodeType,u=l?s.cache:e,d=l?e[s.expando]:s.expando;if(!u[d]){return}if(t){n=i?u[d]:u[d].data;if(n){if(s.isArray(t)){t=t}else if(t in n){t=[t]}else{t=s.camelCase(t);if(t in n){t=[t]}else{t=t.split(" ")}}for(o=0,r=t.length;o<r;o++){delete n[t[o]]}if(!(i?h:s.isEmptyObject)(n)){return}}}if(!i){delete u[d].data;if(!h(u[d])){return}}if(s.support.deleteExpando||!u.setInterval){delete u[d]}else{u[d]=null}if(l){if(s.support.deleteExpando){delete e[s.expando]}else if(e.removeAttribute){e.removeAttribute(s.expando)}else{e[s.expando]=null}}},_data:function(e,t,i){return s.data(e,t,i,true)},acceptData:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t){return!(t===true||e.getAttribute("classid")!==t)}}return true}});s.fn.extend({data:function(e,i){var n,o,r,a=null;if(typeof e==="undefined"){if(this.length){a=s.data(this[0]);if(this[0].nodeType===1&&!s._data(this[0],"parsedAttrs")){o=this[0].attributes;for(var l=0,u=o.length;l<u;l++){r=o[l].name;if(r.indexOf("data-")===0){r=s.camelCase(r.substring(5));c(this[0],r,a[r])}}s._data(this[0],"parsedAttrs",true)}}return a}else if(typeof e==="object"){return this.each(function(){s.data(this,e)})}n=e.split(".");n[1]=n[1]?"."+n[1]:"";if(i===t){a=this.triggerHandler("getData"+n[1]+"!",[n[0]]);if(a===t&&this.length){a=s.data(this[0],e);a=c(this[0],e,a)}return a===t&&n[1]?this.data(n[0]):a}else{return this.each(function(){var t=s(this),o=[n[0],i];t.triggerHandler("setData"+n[1]+"!",o);s.data(this,e,i);t.triggerHandler("changeData"+n[1]+"!",o)})}},removeData:function(e){return this.each(function(){s.removeData(this,e)})}});function c(e,i,n){if(n===t&&e.nodeType===1){var o="data-"+i.replace(d,"-$1").toLowerCase();n=e.getAttribute(o);if(typeof n==="string"){try{n=n==="true"?true:n==="false"?false:n==="null"?null:s.isNumeric(n)?parseFloat(n):u.test(n)?s.parseJSON(n):n}catch(r){}s.data(e,i,n)}else{n=t}}return n}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t])){continue}if(t!=="toJSON"){return false}}return true}function f(e,t,i){var n=t+"defer",o=t+"queue",r=t+"mark",a=s._data(e,n);if(a&&(i==="queue"||!s._data(e,o))&&(i==="mark"||!s._data(e,r))){setTimeout(function(){if(!s._data(e,o)&&!s._data(e,r)){s.removeData(e,n,true);a.fire()}},0)}}s.extend({_mark:function(e,t){if(e){t=(t||"fx")+"mark";s._data(e,t,(s._data(e,t)||0)+1)}},_unmark:function(e,t,i){if(e!==true){i=t;t=e;e=false}if(t){i=i||"fx";var n=i+"mark",o=e?0:(s._data(t,n)||1)-1;if(o){s._data(t,n,o)}else{s.removeData(t,n,true);f(t,i,"mark")}}},queue:function(e,t,i){var n;if(e){t=(t||"fx")+"queue";n=s._data(e,t);if(i){if(!n||s.isArray(i)){n=s._data(e,t,s.makeArray(i))}else{n.push(i)}}return n||[]}},dequeue:function(e,t){t=t||"fx";var i=s.queue(e,t),n=i.shift(),o={};if(n==="inprogress"){n=i.shift()}if(n){if(t==="fx"){i.unshift("inprogress")}s._data(e,t+".run",o);n.call(e,function(){s.dequeue(e,t)},o)}if(!i.length){s.removeData(e,t+"queue "+t+".run",true);f(e,t,"queue")}}});s.fn.extend({queue:function(e,i){if(typeof e!=="string"){i=e;e="fx"}if(i===t){return s.queue(this[0],e)}return this.each(function(){var t=s.queue(this,e,i);if(e==="fx"&&t[0]!=="inprogress"){s.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){
e=s.fx?s.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){if(typeof e!=="string"){i=e;e=t}e=e||"fx";var n=s.Deferred(),o=this,r=o.length,a=1,l=e+"defer",u=e+"queue",d=e+"mark",c;function h(){if(!--a){n.resolveWith(o,[o])}}while(r--){if(c=s.data(o[r],l,t,true)||(s.data(o[r],u,t,true)||s.data(o[r],d,t,true))&&s.data(o[r],l,s.Callbacks("once memory"),true)){a++;c.add(h)}}h();return n.promise()}});var p=/[\n\t\r]/g,g=/\s+/,_=/\r/g,m=/^(?:button|input)$/i,v=/^(?:button|input|object|select|textarea)$/i,w=/^a(?:rea)?$/i,b=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,k=s.support.getSetAttribute,C,y,x;s.fn.extend({attr:function(e,t){return s.access(this,e,t,true,s.attr)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,e,t,true,s.prop)},removeProp:function(e){e=s.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e]}catch(i){}})},addClass:function(e){var t,i,n,o,r,a,l;if(s.isFunction(e)){return this.each(function(t){s(this).addClass(e.call(this,t,this.className))})}if(e&&typeof e==="string"){t=e.split(g);for(i=0,n=this.length;i<n;i++){o=this[i];if(o.nodeType===1){if(!o.className&&t.length===1){o.className=e}else{r=" "+o.className+" ";for(a=0,l=t.length;a<l;a++){if(!~r.indexOf(" "+t[a]+" ")){r+=t[a]+" "}}o.className=s.trim(r)}}}}return this},removeClass:function(e){var i,n,o,r,a,l,u;if(s.isFunction(e)){return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))})}if(e&&typeof e==="string"||e===t){i=(e||"").split(g);for(n=0,o=this.length;n<o;n++){r=this[n];if(r.nodeType===1&&r.className){if(e){a=(" "+r.className+" ").replace(p," ");for(l=0,u=i.length;l<u;l++){a=a.replace(" "+i[l]+" "," ")}r.className=s.trim(a)}else{r.className=""}}}}return this},toggleClass:function(e,t){var i=typeof e,n=typeof t==="boolean";if(s.isFunction(e)){return this.each(function(i){s(this).toggleClass(e.call(this,i,this.className,t),t)})}return this.each(function(){if(i==="string"){var o,r=0,a=s(this),l=t,u=e.split(g);while(o=u[r++]){l=n?l:!a.hasClass(o);a[l?"addClass":"removeClass"](o)}}else if(i==="undefined"||i==="boolean"){if(this.className){s._data(this,"__className__",this.className)}this.className=this.className||e===false?"":s._data(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ",i=0,n=this.length;for(;i<n;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(p," ").indexOf(t)>-1){return true}}return false},val:function(e){var i,n,o,r=this[0];if(!arguments.length){if(r){i=s.valHooks[r.nodeName.toLowerCase()]||s.valHooks[r.type];if(i&&"get"in i&&(n=i.get(r,"value"))!==t){return n}n=r.value;return typeof n==="string"?n.replace(_,""):n==null?"":n}return t}o=s.isFunction(e);return this.each(function(n){var r=s(this),a;if(this.nodeType!==1){return}if(o){a=e.call(this,n,r.val())}else{a=e}if(a==null){a=""}else if(typeof a==="number"){a+=""}else if(s.isArray(a)){a=s.map(a,function(e){return e==null?"":e+""})}i=s.valHooks[this.nodeName.toLowerCase()]||s.valHooks[this.type];if(!i||!("set"in i)||i.set(this,a,"value")===t){this.value=a}})}});s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,i,n,o,r=e.selectedIndex,a=[],l=e.options,u=e.type==="select-one";if(r<0){return null}i=u?r:0;n=u?r+1:l.length;for(;i<n;i++){o=l[i];if(o.selected&&(s.support.optDisabled?!o.disabled:o.getAttribute("disabled")===null)&&(!o.parentNode.disabled||!s.nodeName(o.parentNode,"optgroup"))){t=s(o).val();if(u){return t}a.push(t)}}if(u&&!a.length&&l.length){return s(l[r]).val()}return a},set:function(e,t){var i=s.makeArray(t);s(e).find("option").each(function(){this.selected=s.inArray(s(this).val(),i)>=0});if(!i.length){e.selectedIndex=-1}return i}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(e,i,n,o){var r,a,l,u=e.nodeType;if(!e||u===3||u===8||u===2){return t}if(o&&i in s.attrFn){return s(e)[i](n)}if(!("getAttribute"in e)){return s.prop(e,i,n)}l=u!==1||!s.isXMLDoc(e);if(l){i=i.toLowerCase();a=s.attrHooks[i]||(b.test(i)?y:C)}if(n!==t){if(n===null){s.removeAttr(e,i);return t}else if(a&&"set"in a&&l&&(r=a.set(e,n,i))!==t){return r}else{e.setAttribute(i,""+n);return n}}else if(a&&"get"in a&&l&&(r=a.get(e,i))!==null){return r}else{r=e.getAttribute(i);return r===null?t:r}},removeAttr:function(e,t){var i,n,o,r,a=0;if(e.nodeType===1){n=(t||"").split(g);r=n.length;for(;a<r;a++){o=n[a].toLowerCase();i=s.propFix[o]||o;s.attr(e,o,"");e.removeAttribute(k?o:i);if(b.test(o)&&i in e){e[i]=false}}}},attrHooks:{type:{set:function(e,t){if(m.test(e.nodeName)&&e.parentNode){s.error("type property can't be changed")}else if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var i=e.value;e.setAttribute("type",t);if(i){e.value=i}return t}}},value:{get:function(e,t){if(C&&s.nodeName(e,"button")){return C.get(e,t)}return t in e?e.value:null},set:function(e,t,i){if(C&&s.nodeName(e,"button")){return C.set(e,t,i)}e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,i,n){var o,r,a,l=e.nodeType;if(!e||l===3||l===8||l===2){return t}a=l!==1||!s.isXMLDoc(e);if(a){i=s.propFix[i]||i;r=s.propHooks[i]}if(n!==t){if(r&&"set"in r&&(o=r.set(e,n,i))!==t){return o}else{return e[i]=n}}else{if(r&&"get"in r&&(o=r.get(e,i))!==null){return o}else{return e[i]}}},propHooks:{tabIndex:{get:function(e){var i=e.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):v.test(e.nodeName)||w.test(e.nodeName)&&e.href?0:t}}}});s.attrHooks.tabindex=s.propHooks.tabIndex;y={get:function(e,i){var n,o=s.prop(e,i);return o===true||typeof o!=="boolean"&&(n=e.getAttributeNode(i))&&n.nodeValue!==false?i.toLowerCase():t},set:function(e,t,i){var n;if(t===false){s.removeAttr(e,i)}else{n=s.propFix[i]||i;if(n in e){e[n]=true}e.setAttribute(i,i.toLowerCase())}return i}};if(!k){x={name:true,id:true};C=s.valHooks.button={get:function(e,i){var n;n=e.getAttributeNode(i);return n&&(x[i]?n.nodeValue!=="":n.specified)?n.nodeValue:t},set:function(e,t,n){var o=e.getAttributeNode(n);if(!o){o=i.createAttribute(n);e.setAttributeNode(o)}return o.nodeValue=t+""}};s.attrHooks.tabindex.set=C.set;s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,i){if(i===""){e.setAttribute(t,"auto");return i}}})});s.attrHooks.contenteditable={get:C.get,set:function(e,t,i){if(t===""){t="false"}C.set(e,t,i)}}}if(!s.support.hrefNormalized){s.each(["href","src","width","height"],function(e,i){s.attrHooks[i]=s.extend(s.attrHooks[i],{get:function(e){var n=e.getAttribute(i,2);return n===null?t:n}})})}if(!s.support.style){s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}}if(!s.support.optSelected){s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(e){var t=e.parentNode;if(t){t.selectedIndex;if(t.parentNode){t.parentNode.selectedIndex}}return null}})}if(!s.support.enctype){s.propFix.enctype="encoding"}if(!s.support.checkOn){s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}})}s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t)){return e.checked=s.inArray(s(e).val(),t)>=0}}})});var S=/\.(.*)$/,T=/^(?:textarea|input|select)$/i,L=/\./g,q=/ /g,E=/[^\w\s.|`]/g,I=/^([^\.]*)?(?:\.(.+))?$/,M=/\bhover(\.\S+)?/,A=/^key/,D=/^(?:mouse|contextmenu)|click/,N=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,O=function(e){var t=N.exec(e);if(t){t[1]=(t[1]||"").toLowerCase();t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")}return t},F=function(e,t){return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||e.id===t[2])&&(!t[3]||t[3].test(e.className))},R=function(e){return s.event.special.hover?e:e.replace(M,"mouseenter$1 mouseleave$1")};s.event={add:function(e,i,n,o,r){var a,l,u,d,c,h,f,p,g,_,m,v;if(e.nodeType===3||e.nodeType===8||!i||!n||!(a=s._data(e))){return}if(n.handler){g=n;n=g.handler}if(!n.guid){n.guid=s.guid++}u=a.events;if(!u){a.events=u={}}l=a.handle;if(!l){a.handle=l=function(e){return typeof s!=="undefined"&&(!e||s.event.triggered!==e.type)?s.event.dispatch.apply(l.elem,arguments):t};l.elem=e}i=R(i).split(" ");for(d=0;d<i.length;d++){c=I.exec(i[d])||[];h=c[1];f=(c[2]||"").split(".").sort();v=s.event.special[h]||{};h=(r?v.delegateType:v.bindType)||h;v=s.event.special[h]||{};p=s.extend({type:h,origType:c[1],data:o,handler:n,guid:n.guid,selector:r,namespace:f.join(".")},g);if(r){p.quick=O(r);if(!p.quick&&s.expr.match.POS.test(r)){p.isPositional=true}}m=u[h];if(!m){m=u[h]=[];m.delegateCount=0;if(!v.setup||v.setup.call(e,o,f,l)===false){if(e.addEventListener){e.addEventListener(h,l,false)}else if(e.attachEvent){e.attachEvent("on"+h,l)}}}if(v.add){v.add.call(e,p);if(!p.handler.guid){p.handler.guid=n.guid}}if(r){m.splice(m.delegateCount++,0,p)}else{m.push(p)}s.event.global[h]=true}e=null},global:{},remove:function(e,t,i,n){var o=s.hasData(e)&&s._data(e),r,a,l,u,d,c,h,f,p,g,_;if(!o||!(h=o.events)){return}t=R(t||"").split(" ");for(r=0;r<t.length;r++){a=I.exec(t[r])||[];l=a[1];u=a[2];if(!l){u=u?"."+u:"";for(c in h){s.event.remove(e,c+u,i,n)}return}f=s.event.special[l]||{};l=(n?f.delegateType:f.bindType)||l;g=h[l]||[];d=g.length;u=u?new RegExp("(^|\\.)"+u.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;if(i||u||n||f.remove){for(c=0;c<g.length;c++){_=g[c];if(!i||i.guid===_.guid){if(!u||u.test(_.namespace)){if(!n||n===_.selector||n==="**"&&_.selector){g.splice(c--,1);if(_.selector){g.delegateCount--}if(f.remove){f.remove.call(e,_)}}}}}}else{g.length=0}if(g.length===0&&d!==g.length){if(!f.teardown||f.teardown.call(e,u)===false){s.removeEvent(e,l,o.handle)}delete h[l]}}if(s.isEmptyObject(h)){p=o.handle;if(p){p.elem=null}s.removeData(e,["events","handle"],true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(i,n,o,r){if(o&&(o.nodeType===3||o.nodeType===8)){return}var a=i.type||i,l=[],u,d,c,h,f,p,g,_,m,v;if(a.indexOf("!")>=0){a=a.slice(0,-1);d=true}if(a.indexOf(".")>=0){l=a.split(".");a=l.shift();l.sort()}if((!o||s.event.customEvent[a])&&!s.event.global[a]){return}i=typeof i==="object"?i[s.expando]?i:new s.Event(a,i):new s.Event(a);i.type=a;i.isTrigger=true;i.exclusive=d;i.namespace=l.join(".");i.namespace_re=i.namespace?new RegExp("(^|\\.)"+l.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;p=a.indexOf(":")<0?"on"+a:"";if(r||!o){i.preventDefault()}if(!o){u=s.cache;for(c in u){if(u[c].events&&u[c].events[a]){s.event.trigger(i,n,u[c].handle.elem,true)}}return}i.result=t;if(!i.target){i.target=o}n=n!=null?s.makeArray(n):[];n.unshift(i);g=s.event.special[a]||{};if(g.trigger&&g.trigger.apply(o,n)===false){return}m=[[o,g.bindType||a]];if(!r&&!g.noBubble&&!s.isWindow(o)){v=g.delegateType||a;f=null;for(h=o.parentNode;h;h=h.parentNode){m.push([h,v]);f=h}if(f&&f===o.ownerDocument){m.push([f.defaultView||f.parentWindow||e,v])}}for(c=0;c<m.length;c++){h=m[c][0];i.type=m[c][1];_=(s._data(h,"events")||{})[i.type]&&s._data(h,"handle");if(_){_.apply(h,n)}_=p&&h[p];if(_&&s.acceptData(h)){_.apply(h,n)}if(i.isPropagationStopped()){break}}i.type=a;if(!i.isDefaultPrevented()){if((!g._default||g._default.apply(o.ownerDocument,n)===false)&&!(a==="click"&&s.nodeName(o,"a"))&&s.acceptData(o)){if(p&&o[a]&&(a!=="focus"&&a!=="blur"||i.target.offsetWidth!==0)&&!s.isWindow(o)){f=o[p];if(f){o[p]=null}s.event.triggered=a;o[a]();s.event.triggered=t;if(f){o[p]=f}}}}return i.result},dispatch:function(i){i=s.event.fix(i||e.event);var n=(s._data(this,"events")||{})[i.type]||[],o=n.delegateCount,r=[].slice.call(arguments,0),a=!i.exclusive&&!i.namespace,l=(s.event.special[i.type]||{}).handle,u=[],d,c,h,f,p,g,_,m,v,w,b;r[0]=i;i.delegateTarget=this;if(o&&!i.target.disabled&&!(i.button&&i.type==="click")){for(h=i.target;h!=this;h=h.parentNode||this){p={};_=[];for(d=0;d<o;d++){m=n[d];v=m.selector;w=p[v];if(m.isPositional){w=(w||(p[v]=s(v))).index(h)>=0}else if(w===t){w=p[v]=m.quick?F(h,m.quick):s(h).is(v)}if(w){_.push(m)}}if(_.length){u.push({elem:h,matches:_})}}}if(n.length>o){u.push({elem:this,matches:n.slice(o)})}for(d=0;d<u.length&&!i.isPropagationStopped();d++){g=u[d];i.currentTarget=g.elem;for(c=0;c<g.matches.length&&!i.isImmediatePropagationStopped();c++){m=g.matches[c];if(a||!i.namespace&&!m.namespace||i.namespace_re&&i.namespace_re.test(m.namespace)){i.data=m.data;i.handleObj=m;func=l||m.handler;if(e.log&&e.log.enabled)e.log("jquery.dispatch","On "+i.type+", invoking",func);f=func.apply(g.elem,r);if(f!==t){i.result=f;if(f===false){i.preventDefault();i.stopPropagation()}}}}}return i.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){if(e.which==null){e.which=t.charCode!=null?t.charCode:t.keyCode}return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement wheelDelta".split(" "),filter:function(e,n){var o,s,r,a=n.button,l=n.fromElement;if(e.pageX==null&&n.clientX!=null){o=e.target.ownerDocument||i;s=o.documentElement;r=o.body;e.pageX=n.clientX+(s&&s.scrollLeft||r&&r.scrollLeft||0)-(s&&s.clientLeft||r&&r.clientLeft||0);e.pageY=n.clientY+(s&&s.scrollTop||r&&r.scrollTop||0)-(s&&s.clientTop||r&&r.clientTop||0)}if(!e.relatedTarget&&l){e.relatedTarget=l===e.target?n.toElement:l}if(!e.which&&a!==t){e.which=a&1?1:a&2?3:a&4?2:0}return e}},fix:function(e){if(e[s.expando]){return e}var n,o,r=e,a=s.event.fixHooks[e.type]||{},l=a.props?this.props.concat(a.props):this.props;e=s.Event(r);for(n=l.length;n;){o=l[--n];e[o]=r[o]}if(!e.target){e.target=r.srcElement||i}if(e.target.nodeType===3){e.target=e.target.parentNode}if(e.metaKey===t){e.metaKey=e.ctrlKey}return a.filter?a.filter(e,r):e},special:{ready:{setup:s.bindReady},focus:{delegateType:"focusin",noBubble:true},blur:{delegateType:"focusout",noBubble:true},beforeunload:{setup:function(e,t,i){if(s.isWindow(this)){this.onbeforeunload=i}},teardown:function(e,t){if(this.onbeforeunload===t){this.onbeforeunload=null}}}},simulate:function(e,t,i,n){var o=s.extend(new s.Event,i,{type:e,isSimulated:true,originalEvent:{}});if(n){s.event.trigger(o,null,t)}else{s.event.dispatch.call(t,o)}if(o.isDefaultPrevented()){i.preventDefault()}}};s.event.handle=s.event.dispatch;s.removeEvent=i.removeEventListener?function(e,t,i){if(e.removeEventListener){e.removeEventListener(t,i,false)}}:function(e,t,i){if(e.detachEvent){e.detachEvent("on"+t,i)}};s.Event=function(t,i){if(!(this instanceof s.Event)){return new s.Event(t,i)}if(t&&t.type){this.originalEvent=t;this.type=t.type;this.isDefaultPrevented=t.defaultPrevented||t.returnValue===false||t.getPreventDefault&&t.getPreventDefault()?B:P}else{this.type=t}if(i){s.extend(this,i)}this.timeStamp=t&&t.timeStamp||s.now();if(e.log&&e.log.enabled)e.log("jquery.Event","New event object: "+this.type,this);this[s.expando]=true};function P(){return false}function B(){return true}s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B;this.stopPropagation()},isDefaultPrevented:P,isPropagationStopped:P,isImmediatePropagationStopped:P};s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,i){s.event.special[t]=s.event.special[i]={delegateType:i,bindType:i,handle:function(t){var i=this,n=t.relatedTarget,o=t.handleObj,r=o.selector,a,l;if(!n||o.origType===t.type||n!==i&&!s.contains(i,n)){a=t.type;t.type=o.origType;func=o.handler;if(e.log&&e.log.enabled)e.log("jquery.mouse*","On "+t.type+", invoking",func);l=func.apply(this,arguments);t.type=a}return l}}});if(!s.support.submitBubbles){s.event.special.submit={setup:function(){if(s.nodeName(this,"form")){return false}s.event.add(this,"click._submit keypress._submit",function(e){var i=e.target,n=s.nodeName(i,"input")||s.nodeName(i,"button")?i.form:t;if(n&&!n._submit_attached){s.event.add(n,"submit._submit",function(e){if(this.parentNode){s.event.simulate("submit",this.parentNode,e,true)}});n._submit_attached=true}})},teardown:function(){if(s.nodeName(this,"form")){return false}s.event.remove(this,"._submit")}}}if(!s.support.changeBubbles){s.event.special.change={setup:function(){if(T.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){s.event.add(this,"propertychange._change",function(e){if(e.originalEvent.propertyName==="checked"){this._just_changed=true}});s.event.add(this,"click._change",function(e){if(this._just_changed){this._just_changed=false;s.event.simulate("change",this,e,true)}})}return false}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(T.test(t.nodeName)&&!t._change_attached){s.event.add(t,"change._change",function(e){if(this.parentNode&&!e.isSimulated){s.event.simulate("change",this.parentNode,e,true)}});t._change_attached=true}})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox"){return e.handleObj.handler.apply(this,arguments)}},teardown:function(){s.event.remove(this,"._change");return T.test(this.nodeName)}}}if(!s.support.focusinBubbles){s.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,o=function(e){s.event.simulate(t,e.target,s.event.fix(e),true)};s.event.special[t]={setup:function(){if(n++===0){i.addEventListener(e,o,true)}},teardown:function(){if(--n===0){i.removeEventListener(e,o,true)}}}})}s.fn.extend({on:function(e,i,n,o,r){var a,l;if(typeof e==="object"){if(typeof i!=="string"){n=i;i=t}for(l in e){this.on(l,i,n,e[l],r)}return this}if(n==null&&o==null){o=i;n=i=t}else if(o==null){if(typeof i==="string"){o=n;n=t}else{o=n;n=i;i=t}}if(o===false){o=P}else if(!o){return this}if(r===1){a=o;o=function(e){s().off(e);return a.apply(this,arguments)};o.guid=a.guid||(a.guid=s.guid++)}return this.each(function(){s.event.add(this,e,o,n,i)})},one:function(e,t,i,n){return this.on.call(this,e,t,i,n,1)},off:function(e,i,n){if(e&&e.preventDefault&&e.handleObj){var o=e.handleObj;s(e.delegateTarget).off(o.namespace?o.type+"."+o.namespace:o.type,o.selector,o.handler);return this}if(typeof e==="object"){for(var r in e){this.off(r,i,e[r])}return this}if(i===false||typeof i==="function"){n=i;i=t}if(n===false){n=P}return this.each(function(){s.event.remove(this,e,n,i)})},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,i){s(this.context).on(e,this.selector,t,i);return this},die:function(e,t){s(this.context).off(e,this.selector||"**",t);return this},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return arguments.length==1?this.off(e,"**"):this.off(t,e,i)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){return s.event.trigger(e,t,this[0],true)}},toggle:function(e){var t=arguments,i=e.guid||s.guid++,n=0,o=function(i){var o=(s._data(this,"lastToggle"+e.guid)||0)%n;s._data(this,"lastToggle"+e.guid,o+1);i.preventDefault();return t[o].apply(this,arguments)||false};o.guid=i;while(n<t.length){t[n++].guid=i}return this.click(o)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});s.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(e,t){s.fn[t]=function(e,i){if(i==null){i=e;e=null}return arguments.length>0?this.bind(t,e,i):this.trigger(t)};if(s.attrFn){s.attrFn[t]=true}if(A.test(t)){s.event.fixHooks[t]=s.event.keyHooks}if(D.test(t)){s.event.fixHooks[t]=s.event.mouseHooks}});(function(){var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,n="sizcache"+(Math.random()+"").replace(".",""),o=0,r=Object.prototype.toString,a=false,l=true,u=/\\/g,d=/\r\n/g,c=/\W/;[0,0].sort(function(){l=false;return 0});var h=function(t,n,o,s){o=o||[];n=n||i;var a=n;if(n.nodeType!==1&&n.nodeType!==9){return[]}if(!t||typeof t!=="string"){return o}var l,u,d,c,f,_,m,w,b=true,k=h.isXML(n),C=[],y=t;do{e.exec("");l=e.exec(y);if(l){y=l[3];C.push(l[1]);if(l[2]){c=l[3];break}}}while(l);if(C.length>1&&g.exec(t)){if(C.length===2&&p.relative[C[0]]){u=x(C[0]+C[1],n,s)}else{u=p.relative[C[0]]?[n]:h(C.shift(),n);while(C.length){t=C.shift();if(p.relative[t]){t+=C.shift()}u=x(t,u,s)}}}else{if(!s&&C.length>1&&n.nodeType===9&&!k&&p.match.ID.test(C[0])&&!p.match.ID.test(C[C.length-1])){f=h.find(C.shift(),n,k);n=f.expr?h.filter(f.expr,f.set)[0]:f.set[0]}if(n){f=s?{expr:C.pop(),set:v(s)}:h.find(C.pop(),C.length===1&&(C[0]==="~"||C[0]==="+")&&n.parentNode?n.parentNode:n,k);u=f.expr?h.filter(f.expr,f.set):f.set;if(C.length>0){d=v(u)}else{b=false}while(C.length){_=C.pop();m=_;if(!p.relative[_]){_=""}else{m=C.pop()}if(m==null){m=n}p.relative[_](d,m,k)}}else{d=C=[]}}if(!d){d=u}if(!d){h.error(_||t)}if(r.call(d)==="[object Array]"){if(!b){o.push.apply(o,d)}else if(n&&n.nodeType===1){for(w=0;d[w]!=null;w++){if(d[w]&&(d[w]===true||d[w].nodeType===1&&h.contains(n,d[w]))){o.push(u[w])}}}else{for(w=0;d[w]!=null;w++){if(d[w]&&d[w].nodeType===1){o.push(u[w])}}}}else{v(d,o)}if(c){h(c,a,o,s);h.uniqueSort(o)}return o};h.uniqueSort=function(e){if(b){a=l;e.sort(b);if(a){for(var t=1;t<e.length;t++){if(e[t]===e[t-1]){e.splice(t--,1)}}}}return e};h.matches=function(e,t){return h(e,null,null,t)};h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0};h.find=function(e,t,i){var n,o,s,r,a,l;if(!e){return[]}for(o=0,s=p.order.length;o<s;o++){a=p.order[o];if(r=p.leftMatch[a].exec(e)){l=r[1];r.splice(1,1);if(l.substr(l.length-1)!=="\\"){r[1]=(r[1]||"").replace(u,"");n=p.find[a](r,t,i);if(n!=null){e=e.replace(p.match[a],"");break}}}}if(!n){n=typeof t.getElementsByTagName!=="undefined"?t.getElementsByTagName("*"):[]}return{set:n,expr:e}};h.filter=function(e,i,n,o){var s,r,a,l,u,d,c,f,g,_=e,m=[],v=i,w=i&&i[0]&&h.isXML(i[0]);while(e&&i.length){for(a in p.filter){if((s=p.leftMatch[a].exec(e))!=null&&s[2]){d=p.filter[a];c=s[1];r=false;s.splice(1,1);if(c.substr(c.length-1)==="\\"){continue}if(v===m){m=[]}if(p.preFilter[a]){s=p.preFilter[a](s,v,n,m,o,w);if(!s){r=l=true}else if(s===true){continue}}if(s){for(f=0;(u=v[f])!=null;f++){if(u){l=d(u,s,f,v);g=o^l;if(n&&l!=null){if(g){r=true}else{v[f]=false}}else if(g){m.push(u);r=true}}}}if(l!==t){if(!n){v=m}e=e.replace(p.match[a],"");if(!r){return[]}break}}}if(e===_){if(r==null){h.error(e)}else{break}}_=e}return v};h.error=function(e){throw"Syntax error, unrecognized expression: "+e};var f=h.getText=function(e){var t,i,n=e.nodeType,o="";if(n){if(n===1){if(typeof e.textContent==="string"){return e.textContent}else if(typeof e.innerText==="string"){return e.innerText.replace(d,"")}else{for(e=e.firstChild;e;e=e.nextSibling){o+=f(e)}}}else if(n===3||n===4){return e.nodeValue}}else{for(t=0;i=e[t];t++){if(i.nodeType!==8){o+=f(i)}}}return o};var p=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var i=typeof t==="string",n=i&&!c.test(t),o=i&&!n;if(n){t=t.toLowerCase()}for(var s=0,r=e.length,a;s<r;s++){if(a=e[s]){while((a=a.previousSibling)&&a.nodeType!==1){}e[s]=o||a&&a.nodeName.toLowerCase()===t?a||false:a===t}}if(o){h.filter(t,e,true)}},">":function(e,t){var i,n=typeof t==="string",o=0,s=e.length;if(n&&!c.test(t)){t=t.toLowerCase();for(;o<s;o++){i=e[o];if(i){var r=i.parentNode;e[o]=r.nodeName.toLowerCase()===t?r:false}}}else{for(;o<s;o++){i=e[o];if(i){e[o]=n?i.parentNode:i.parentNode===t}}if(n){h.filter(t,e,true)}}},"":function(e,t,i){var n,s=o++,r=y;if(typeof t==="string"&&!c.test(t)){t=t.toLowerCase();n=t;r=C}r("parentNode",t,s,e,n,i)},"~":function(e,t,i){var n,s=o++,r=y;if(typeof t==="string"&&!c.test(t)){t=t.toLowerCase();n=t;r=C}r("previousSibling",t,s,e,n,i)}},find:{ID:function(e,t,i){if(typeof t.getElementById!=="undefined"&&!i){var n=t.getElementById(e[1]);return n&&n.parentNode?[n]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!=="undefined"){var i=[],n=t.getElementsByName(e[1]);for(var o=0,s=n.length;o<s;o++){if(n[o].getAttribute("name")===e[1]){i.push(n[o])}}return i.length===0?null:i}},TAG:function(e,t){if(typeof t.getElementsByTagName!=="undefined"){return t.getElementsByTagName(e[1])}}},preFilter:{CLASS:function(e,t,i,n,o,s){e=" "+e[1].replace(u,"")+" ";if(s){return e}for(var r=0,a;(a=t[r])!=null;r++){if(a){if(o^(a.className&&(" "+a.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)){if(!i){n.push(a)}}else if(i){t[r]=false}}}return false},ID:function(e){return e[1].replace(u,"")},TAG:function(e,t){return e[1].replace(u,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){if(!e[2]){h.error(e[0])}e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0;e[3]=t[3]-0}else if(e[2]){h.error(e[0])}e[0]=o++;return e},ATTR:function(e,t,i,n,o,s){var r=e[1]=e[1].replace(u,"");if(!s&&p.attrMap[r]){e[1]=p.attrMap[r]}e[4]=(e[4]||e[5]||"").replace(u,"");if(e[2]==="~="){e[4]=" "+e[4]+" "}return e},PSEUDO:function(t,i,n,o,s){if(t[1]==="not"){if((e.exec(t[3])||"").length>1||/^\w/.test(t[3])){t[3]=h(t[3],null,null,i)}else{var r=h.filter(t[3],i,n,true^s);if(!n){o.push.apply(o,r)}return false}}else if(p.match.POS.test(t[0])||p.match.CHILD.test(t[0])){return true}return t},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,i){return!!h(i[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),i=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===i&&(t===i||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,i,n){return t===n.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,i){return t<i[3]-0},gt:function(e,t,i){return t>i[3]-0},nth:function(e,t,i){return i[3]-0===t},eq:function(e,t,i){return i[3]-0===t}},filter:{PSEUDO:function(e,t,i,n){var o=t[1],s=p.filters[o];if(s){return s(e,i,t,n)}else if(o==="contains"){return(e.textContent||e.innerText||f([e])||"").indexOf(t[3])>=0}else if(o==="not"){var r=t[3];for(var a=0,l=r.length;a<l;a++){if(r[a]===e){return false}}return true}else{h.error(o)}},CHILD:function(e,t){var i,o,s,r,a,l,u,d=t[1],c=e;switch(d){case"only":case"first":while(c=c.previousSibling){if(c.nodeType===1){return false}}if(d==="first"){return true}c=e;case"last":while(c=c.nextSibling){if(c.nodeType===1){return false}}return true;case"nth":i=t[2];o=t[3];if(i===1&&o===0){return true}s=t[0];r=e.parentNode;if(r&&(r[n]!==s||!e.nodeIndex)){l=0;for(c=r.firstChild;c;c=c.nextSibling){if(c.nodeType===1){c.nodeIndex=++l}}r[n]=s}u=e.nodeIndex-o;if(i===0){return u===0}else{return u%i===0&&u/i>=0}}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var i=t[1],n=h.attr?h.attr(e,i):p.attrHandle[i]?p.attrHandle[i](e):e[i]!=null?e[i]:e.getAttribute(i),o=n+"",s=t[2],r=t[4];return n==null?s==="!=":!s&&h.attr?n!=null:s==="="?o===r:s==="*="?o.indexOf(r)>=0:s==="~="?(" "+o+" ").indexOf(r)>=0:!r?o&&n!==false:s==="!="?o!==r:s==="^="?o.indexOf(r)===0:s==="$="?o.substr(o.length-r.length)===r:s==="|="?o===r||o.substr(0,r.length+1)===r+"-":false},POS:function(e,t,i,n){var o=t[2],s=p.setFilters[o];if(s){return s(e,i,t,n)}}}};var g=p.match.POS,_=function(e,t){return"\\"+(t-0+1)};for(var m in p.match){p.match[m]=new RegExp(p.match[m].source+/(?![^\[]*\])(?![^\(]*\))/.source);p.leftMatch[m]=new RegExp(/(^(?:.|\r|\n)*?)/.source+p.match[m].source.replace(/\\(\d+)/g,_))}var v=function(e,t){e=Array.prototype.slice.call(e,0);if(t){t.push.apply(t,e);return t}return e};try{Array.prototype.slice.call(i.documentElement.childNodes,0)[0].nodeType}catch(w){v=function(e,t){var i=0,n=t||[];if(r.call(e)==="[object Array]"){Array.prototype.push.apply(n,e)}else{if(typeof e.length==="number"){for(var o=e.length;i<o;i++){n.push(e[i])}}else{for(;e[i];i++){n.push(e[i])}}}return n}}var b,k;if(i.documentElement.compareDocumentPosition){b=function(e,t){if(e===t){a=true;return 0}if(!e.compareDocumentPosition||!t.compareDocumentPosition){return e.compareDocumentPosition?-1:1}return e.compareDocumentPosition(t)&4?-1:1}}else{b=function(e,t){if(e===t){a=true;return 0}else if(e.sourceIndex&&t.sourceIndex){return e.sourceIndex-t.sourceIndex}var i,n,o=[],s=[],r=e.parentNode,l=t.parentNode,u=r;if(r===l){return k(e,t)}else if(!r){return-1}else if(!l){return 1}while(u){o.unshift(u);u=u.parentNode}u=l;while(u){s.unshift(u);u=u.parentNode}i=o.length;n=s.length;for(var d=0;d<i&&d<n;d++){if(o[d]!==s[d]){return k(o[d],s[d])}}return d===i?k(e,s[d],-1):k(o[d],t,1)};k=function(e,t,i){if(e===t){return i}var n=e.nextSibling;while(n){if(n===t){return-1}n=n.nextSibling}return 1}}(function(){var e=i.createElement("div"),n="script"+(new Date).getTime(),o=i.documentElement;e.innerHTML="<a name='"+n+"'/>";o.insertBefore(e,o.firstChild);if(i.getElementById(n)){p.find.ID=function(e,i,n){if(typeof i.getElementById!=="undefined"&&!n){var o=i.getElementById(e[1]);return o?o.id===e[1]||typeof o.getAttributeNode!=="undefined"&&o.getAttributeNode("id").nodeValue===e[1]?[o]:t:[];
}};p.filter.ID=function(e,t){var i=typeof e.getAttributeNode!=="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&i&&i.nodeValue===t}}o.removeChild(e);o=e=null})();(function(){var e=i.createElement("div");e.appendChild(i.createComment(""));if(e.getElementsByTagName("*").length>0){p.find.TAG=function(e,t){var i=t.getElementsByTagName(e[1]);if(e[1]==="*"){var n=[];for(var o=0;i[o];o++){if(i[o].nodeType===1){n.push(i[o])}}i=n}return i}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){p.attrHandle.href=function(e){return e.getAttribute("href",2)}}e=null})();if(i.querySelectorAll){(function(){var e=h,t=i.createElement("div"),n="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}h=function(t,o,s,r){o=o||i;if(!r&&!h.isXML(o)){var a=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(a&&(o.nodeType===1||o.nodeType===9)){if(a[1]){return v(o.getElementsByTagName(t),s)}else if(a[2]&&p.find.CLASS&&o.getElementsByClassName){return v(o.getElementsByClassName(a[2]),s)}}if(o.nodeType===9){if(t==="body"&&o.body){return v([o.body],s)}else if(a&&a[3]){var l=o.getElementById(a[3]);if(l&&l.parentNode){if(l.id===a[3]){return v([l],s)}}else{return v([],s)}}try{return v(o.querySelectorAll(t),s)}catch(u){}}else if(o.nodeType===1&&o.nodeName.toLowerCase()!=="object"){var d=o,c=o.getAttribute("id"),f=c||n,g=o.parentNode,_=/^\s*[+~]/.test(t);if(!c){o.setAttribute("id",f)}else{f=f.replace(/'/g,"\\$&")}if(_&&g){o=o.parentNode}try{if(!_||g){return v(o.querySelectorAll("[id='"+f+"'] "+t),s)}}catch(m){}finally{if(!c){d.removeAttribute("id")}}}}return e(t,o,s,r)};for(var o in e){h[o]=e[o]}t=null})()}(function(){var e=i.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var n=!t.call(i.createElement("div"),"div"),o=false;try{t.call(i.documentElement,"[test!='']:sizzle")}catch(s){o=true}h.matchesSelector=function(e,i){i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e)){try{if(o||!p.match.PSEUDO.test(i)&&!/!=/.test(i)){var s=t.call(e,i);if(s||!n||e.document&&e.document.nodeType!==11){return s}}}catch(r){}}return h(i,null,null,[e]).length>0}}})();(function(){var e=i.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}p.order.splice(1,0,"CLASS");p.find.CLASS=function(e,t,i){if(typeof t.getElementsByClassName!=="undefined"&&!i){return t.getElementsByClassName(e[1])}};e=null})();function C(e,t,i,o,s,r){for(var a=0,l=o.length;a<l;a++){var u=o[a];if(u){var d=false;u=u[e];while(u){if(u[n]===i){d=o[u.sizset];break}if(u.nodeType===1&&!r){u[n]=i;u.sizset=a}if(u.nodeName.toLowerCase()===t){d=u;break}u=u[e]}o[a]=d}}}function y(e,t,i,o,s,r){for(var a=0,l=o.length;a<l;a++){var u=o[a];if(u){var d=false;u=u[e];while(u){if(u[n]===i){d=o[u.sizset];break}if(u.nodeType===1){if(!r){u[n]=i;u.sizset=a}if(typeof t!=="string"){if(u===t){d=true;break}}else if(h.filter(t,[u]).length>0){d=u;break}}u=u[e]}o[a]=d}}}if(i.documentElement.contains){h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):true)}}else if(i.documentElement.compareDocumentPosition){h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}}else{h.contains=function(){return false}}h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":false};var x=function(e,t,i){var n,o=[],s="",r=t.nodeType?[t]:t;while(n=p.match.PSEUDO.exec(e)){s+=n[0];e=e.replace(p.match.PSEUDO,"")}e=p.relative[e]?e+"*":e;for(var a=0,l=r.length;a<l;a++){h(e,r[a],o,i)}return h.filter(s,o)};h.attr=s.attr;h.selectors.attrMap={};s.find=h;s.expr=h.selectors;s.expr[":"]=s.expr.filters;s.unique=h.uniqueSort;s.text=h.getText;s.isXMLDoc=h.isXML;s.contains=h.contains})();var H=/Until$/,U=/^(?:parents|prevUntil|prevAll)/,Q=/,/,j=/^.[^:#\[\.,]*$/,W=Array.prototype.slice,V=s.expr.match.POS,z={children:true,contents:true,next:true,prev:true};s.fn.extend({find:function(e){var t=this,i,n;if(typeof e!=="string"){return s(e).filter(function(){for(i=0,n=t.length;i<n;i++){if(s.contains(t[i],this)){return true}}})}var o=this.pushStack("","find",e),r,a,l;for(i=0,n=this.length;i<n;i++){r=o.length;s.find(e,this[i],o);if(i>0){for(a=r;a<o.length;a++){for(l=0;l<r;l++){if(o[l]===o[a]){o.splice(a--,1);break}}}}}return o},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,i=t.length;e<i;e++){if(s.contains(this,t[e])){return true}}})},not:function(e){return this.pushStack(G(this,e,false),"not",e)},filter:function(e){return this.pushStack(G(this,e,true),"filter",e)},is:function(e){return!!e&&(typeof e==="string"?V.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var i=[],n,o,r=this[0];if(s.isArray(e)){var a=1;while(r&&r.ownerDocument&&r!==t){for(n=0;n<e.length;n++){if(s(r).is(e[n])){i.push({selector:e[n],elem:r,level:a})}}r=r.parentNode;a++}return i}var l=V.test(e)||typeof e!=="string"?s(e,t||this.context):0;for(n=0,o=this.length;n<o;n++){r=this[n];while(r){if(l?l.index(r)>-1:s.find.matchesSelector(r,e)){i.push(r);break}else{r=r.parentNode;if(!r||!r.ownerDocument||r===t||r.nodeType===11){break}}}}i=i.length>1?s.unique(i):i;return this.pushStack(i,"closest",e)},index:function(e){if(!e){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof e==="string"){return s.inArray(this[0],s(e))}return s.inArray(e.jquery?e[0]:e,this)},add:function(e,t){var i=typeof e==="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),n=s.merge(this.get(),i);return this.pushStack(K(i[0])||K(n[0])?n:s.unique(n))},andSelf:function(){return this.add(this.prevObject)}});function K(e){return!e||!e.parentNode||e.parentNode.nodeType===11}s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,i){return s.dir(e,"parentNode",i)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,i){return s.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return s.dir(e,"previousSibling",i)},siblings:function(e){return s.sibling(e.parentNode.firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(i,n){var o=s.map(this,t,i),r=W.call(arguments);if(!H.test(e)){n=i}if(n&&typeof n==="string"){o=s.filter(n,o)}o=this.length>1&&!z[e]?s.unique(o):o;if((this.length>1||Q.test(n))&&U.test(e)){o=o.reverse()}return this.pushStack(o,e,r.join(","))}});s.extend({filter:function(e,t,i){if(i){e=":not("+e+")"}return t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,i,n){var o=[],r=e[i];while(r&&r.nodeType!==9&&(n===t||r.nodeType!==1||!s(r).is(n))){if(r.nodeType===1){o.push(r)}r=r[i]}return o},nth:function(e,t,i,n){t=t||1;var o=0;for(;e;e=e[i]){if(e.nodeType===1&&++o===t){break}}return e},sibling:function(e,t){var i=[];for(;e;e=e.nextSibling){if(e.nodeType===1&&e!==t){i.push(e)}}return i}});function G(e,t,i){t=t||0;if(s.isFunction(t)){return s.grep(e,function(e,n){var o=!!t.call(e,n,e);return o===i})}else if(t.nodeType){return s.grep(e,function(e,n){return e===t===i})}else if(typeof t==="string"){var n=s.grep(e,function(e){return e.nodeType===1});if(j.test(t)){return s.filter(t,n,!i)}else{t=s.filter(t,n)}}return s.grep(e,function(e,n){return s.inArray(e,t)>=0===i})}function J(e){var t=Y.split(" "),i=e.createDocumentFragment();if(i.createElement){while(t.length){i.createElement(t.pop())}}return i}var Y="abbr article aside audio canvas datalist details figcaption figure footer "+"header hgroup mark meter nav output progress section summary time video",X=/ jQuery\d+="(?:\d+|null)"/g,Z=/^\s+/,ee=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,te=/<([\w:]+)/,ie=/<tbody/i,ne=/<|&#?\w+;/,oe=/<(?:script|style)/i,se=/<(?:script|object|embed|option|style)/i,re=new RegExp("<(?:"+Y.replace(" ","|")+")","i"),ae=/checked\s*(?:[^=]|=\s*.checked.)/i,le=/\/(java|ecma)script/i,ue=/^\s*<!(?:\[CDATA\[|\-\-)/,de={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ce=J(i);de.optgroup=de.option;de.tbody=de.tfoot=de.colgroup=de.caption=de.thead;de.th=de.td;if(!s.support.htmlSerialize){de._default=[1,"div<div>","</div>"]}s.fn.extend({text:function(e){if(s.isFunction(e)){return this.each(function(t){var i=s(this);i.text(e.call(this,t,i.text()))})}if(typeof e!=="object"&&e!==t){return this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))}return s.text(this)},wrapAll:function(e){if(s.isFunction(e)){return this.each(function(t){s(this).wrapAll(e.call(this,t))})}if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){if(s.isFunction(e)){return this.each(function(t){s(this).wrapInner(e.call(this,t))})}return this.each(function(){var t=s(this),i=t.contents();if(i.length){i.wrapAll(e)}else{t.append(e)}})},wrap:function(e){return this.each(function(){s(this).wrapAll(e)})},unwrap:function(){return this.parent().each(function(){if(!s.nodeName(this,"body")){s(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.insertBefore(e,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this)})}else if(arguments.length){var e=s(arguments[0]);e.push.apply(e,this.toArray());return this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this.nextSibling)})}else if(arguments.length){var e=this.pushStack(this,"after",arguments);e.push.apply(e,s(arguments[0]).toArray());return e}},remove:function(e,t){for(var i=0,n;(n=this[i])!=null;i++){if(!e||s.filter(e,[n]).length){if(!t&&n.nodeType===1){s.cleanData(n.getElementsByTagName("*"));s.cleanData([n])}if(n.parentNode){n.parentNode.removeChild(n)}}}return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){if(t.nodeType===1){s.cleanData(t.getElementsByTagName("*"))}while(t.firstChild){t.removeChild(t.firstChild)}}return this},clone:function(e,t){e=e==null?false:e;t=t==null?e:t;return this.map(function(){return s.clone(this,e,t)})},html:function(e){if(e===t){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(X,""):null}else if(typeof e==="string"&&!oe.test(e)&&(s.support.leadingWhitespace||!Z.test(e))&&!de[(te.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ee,"<$1></$2>");try{for(var i=0,n=this.length;i<n;i++){if(this[i].nodeType===1){s.cleanData(this[i].getElementsByTagName("*"));this[i].innerHTML=e}}}catch(o){this.empty().append(e)}}else if(s.isFunction(e)){this.each(function(t){var i=s(this);i.html(e.call(this,t,i.html()))})}else{this.empty().append(e)}return this},replaceWith:function(e){if(this[0]&&this[0].parentNode){if(s.isFunction(e)){return this.each(function(t){var i=s(this),n=i.html();i.replaceWith(e.call(this,t,n))})}if(typeof e!=="string"){e=s(e).detach()}return this.each(function(){var t=this.nextSibling,i=this.parentNode;s(this).remove();if(t){s(t).before(e)}else{s(i).append(e)}})}else{return this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this}},detach:function(e){return this.remove(e,true)},domManip:function(e,i,n){var o,r,a,l,u=e[0],d=[];if(!s.support.checkClone&&arguments.length===3&&typeof u==="string"&&ae.test(u)){return this.each(function(){s(this).domManip(e,i,n,true)})}if(s.isFunction(u)){return this.each(function(o){var r=s(this);e[0]=u.call(this,o,i?r.html():t);r.domManip(e,i,n)})}if(this[0]){l=u&&u.parentNode;if(s.support.parentNode&&l&&l.nodeType===11&&l.childNodes.length===this.length){o={fragment:l}}else{o=s.buildFragment(e,this,d)}a=o.fragment;if(a.childNodes.length===1){r=a=a.firstChild}else{r=a.firstChild}if(r){i=i&&s.nodeName(r,"tr");for(var c=0,h=this.length,f=h-1;c<h;c++){n.call(i?he(this[c],r):this[c],o.cacheable||h>1&&c<f?s.clone(a,true,true):a)}}if(d.length){s.each(d,ve)}}return this}});function he(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function fe(e,t){if(t.nodeType!==1||!s.hasData(e)){return}var i,n,o,r=s._data(e),a=s._data(t,r),l=r.events;if(l){delete a.handle;a.events={};for(i in l){for(n=0,o=l[i].length;n<o;n++){s.event.add(t,i+(l[i][n].namespace?".":"")+l[i][n].namespace,l[i][n],l[i][n].data)}}}if(a.data){a.data=s.extend({},a.data)}}function pe(e,t){var i;if(t.nodeType!==1){return}if(t.clearAttributes){t.clearAttributes()}if(t.mergeAttributes){t.mergeAttributes(e)}i=t.nodeName.toLowerCase();if(i==="object"){t.outerHTML=e.outerHTML}else if(i==="input"&&(e.type==="checkbox"||e.type==="radio")){if(e.checked){t.defaultChecked=t.checked=e.checked}if(t.value!==e.value){t.value=e.value}}else if(i==="option"){t.selected=e.defaultSelected}else if(i==="input"||i==="textarea"){t.defaultValue=e.defaultValue}t.removeAttribute(s.expando)}s.buildFragment=function(e,t,n){var o,r,a,l,u=e[0];if(t&&t[0]){l=t[0].ownerDocument||t[0]}if(!l.createDocumentFragment){l=i}if(e.length===1&&typeof u==="string"&&u.length<512&&l===i&&u.charAt(0)==="<"&&!se.test(u)&&(s.support.checkClone||!ae.test(u))&&(!s.support.unknownElems&&re.test(u))){r=true;a=s.fragments[u];if(a&&a!==1){o=a}}if(!o){o=l.createDocumentFragment();s.clean(e,l,o,n)}if(r){s.fragments[u]=a?o:1}return{fragment:o,cacheable:r}};s.fragments={};s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(i){var n=[],o=s(i),r=this.length===1&&this[0].parentNode;if(r&&r.nodeType===11&&r.childNodes.length===1&&o.length===1){o[t](this[0]);return this}else{for(var a=0,l=o.length;a<l;a++){var u=(a>0?this.clone(true):this).get();s(o[a])[t](u);n=n.concat(u)}return this.pushStack(n,e,o.selector)}}});function ge(e){if(typeof e.getElementsByTagName!=="undefined"){return e.getElementsByTagName("*")}else if(typeof e.querySelectorAll!=="undefined"){return e.querySelectorAll("*")}else{return[]}}function _e(e){if(e.type==="checkbox"||e.type==="radio"){e.defaultChecked=e.checked}}function me(e){var t=(e.nodeName||"").toLowerCase();if(t==="input"){_e(e)}else if(t!=="script"&&typeof e.getElementsByTagName!=="undefined"){s.grep(e.getElementsByTagName("input"),_e)}}s.extend({clone:function(e,t,i){var n=e.cloneNode(true),o,r,a;if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){pe(e,n);o=ge(e);r=ge(n);for(a=0;o[a];++a){if(r[a]){pe(o[a],r[a])}}}if(t){fe(e,n);if(i){o=ge(e);r=ge(n);for(a=0;o[a];++a){fe(o[a],r[a])}}}o=r=null;return n},clean:function(e,t,n,o){var r;t=t||i;if(typeof t.createElement==="undefined"){t=t.ownerDocument||t[0]&&t[0].ownerDocument||i}var a=[],l;for(var u=0,d;(d=e[u])!=null;u++){if(typeof d==="number"){d+=""}if(!d){continue}if(typeof d==="string"){if(!ne.test(d)){d=t.createTextNode(d)}else{d=d.replace(ee,"<$1></$2>");var c=(te.exec(d)||["",""])[1].toLowerCase(),h=de[c]||de._default,f=h[0],p=t.createElement("div");if(t===i){ce.appendChild(p)}else{J(t).appendChild(p)}p.innerHTML=h[1]+d+h[2];while(f--){p=p.lastChild}if(!s.support.tbody){var g=ie.test(d),_=c==="table"&&!g?p.firstChild&&p.firstChild.childNodes:h[1]==="<table>"&&!g?p.childNodes:[];for(l=_.length-1;l>=0;--l){if(s.nodeName(_[l],"tbody")&&!_[l].childNodes.length){_[l].parentNode.removeChild(_[l])}}}if(!s.support.leadingWhitespace&&Z.test(d)){p.insertBefore(t.createTextNode(Z.exec(d)[0]),p.firstChild)}d=p.childNodes}}var m;if(!s.support.appendChecked){if(d[0]&&typeof(m=d.length)==="number"){for(l=0;l<m;l++){me(d[l])}}else{me(d)}}if(d.nodeType){a.push(d)}else{a=s.merge(a,d)}}if(n){r=function(e){return!e.type||le.test(e.type)};for(u=0;a[u];u++){if(o&&s.nodeName(a[u],"script")&&(!a[u].type||a[u].type.toLowerCase()==="text/javascript")){o.push(a[u].parentNode?a[u].parentNode.removeChild(a[u]):a[u])}else{if(a[u].nodeType===1){var v=s.grep(a[u].getElementsByTagName("script"),r);a.splice.apply(a,[u+1,0].concat(v))}n.appendChild(a[u])}}}return a},cleanData:function(e){var t,i,n=s.cache,o=s.event.special,r=s.support.deleteExpando;for(var a=0,l;(l=e[a])!=null;a++){if(l.nodeName&&s.noData[l.nodeName.toLowerCase()]){continue}i=l[s.expando];if(i){t=n[i];if(t&&t.events){for(var u in t.events){if(o[u]){s.event.remove(l,u)}else{s.removeEvent(l,u,t.handle)}}if(t.handle){t.handle.elem=null}}if(r){delete l[s.expando]}else if(l.removeAttribute){l.removeAttribute(s.expando)}delete n[i]}}}});function ve(e,t){if(t.src){s.ajax({url:t.src,async:false,dataType:"script"})}else{s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(ue,"/*$0*/"))}if(t.parentNode){t.parentNode.removeChild(t)}}var we=/alpha\([^)]*\)/i,be=/opacity=([^)]*)/,ke=/([A-Z]|^ms)/g,Ce=/^-?\d+(?:px)?$/i,ye=/^-?\d/,xe=/^([\-+])=([\-+.\de]+)/,$e={position:"absolute",visibility:"hidden",display:"block"},Se=["Left","Right"],Te=["Top","Bottom"],Le,qe,Ee;s.fn.css=function(e,i){if(arguments.length===2&&i===t){return this}return s.access(this,e,i,true,function(e,i,n){return n!==t?s.style(e,i,n):s.css(e,i)})};s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=Le(e,"opacity","opacity");return i===""?"1":i}else{return e.style.opacity}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,i,n,o){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var r,a,l=s.camelCase(i),u=e.style,d=s.cssHooks[l];i=s.cssProps[l]||l;if(n!==t){a=typeof n;if(a==="string"&&(r=xe.exec(n))){n=+(r[1]+1)*+r[2]+parseFloat(s.css(e,i));a="number"}if(n==null||a==="number"&&isNaN(n)){return}if(a==="number"&&!s.cssNumber[l]){n+="px"}if(!d||!("set"in d)||(n=d.set(e,n))!==t){try{u[i]=n}catch(c){}}}else{if(d&&"get"in d&&(r=d.get(e,false,o))!==t){return r}return u[i]}},css:function(e,i,n){var o,r;i=s.camelCase(i);r=s.cssHooks[i];i=s.cssProps[i]||i;if(i==="cssFloat"){i="float"}if(r&&"get"in r&&(o=r.get(e,true,n))!==t){return o}else if(Le){return Le(e,i)}},swap:function(e,t,i){var n={};for(var o in t){n[o]=e.style[o];e.style[o]=t[o]}i.call(e);for(o in t){e.style[o]=n[o]}}});s.curCSS=s.css;s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,i,n){var o;if(i){if(e.offsetWidth!==0){return Ie(e,t,n)}else{s.swap(e,$e,function(){o=Ie(e,t,n)})}return o}},set:function(e,t){if(Ce.test(t)){t=parseFloat(t);if(t>=0){return t+"px"}}else{return t}}}});if(!s.support.opacity){s.cssHooks.opacity={get:function(e,t){return be.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,o=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",r=n&&n.filter||i.filter||"";i.zoom=1;if(t>=1&&s.trim(r.replace(we,""))===""){i.removeAttribute("filter");if(n&&!n.filter){return}}i.filter=we.test(r)?r.replace(we,o):r+" "+o}}}s(function(){if(!s.support.reliableMarginRight){s.cssHooks.marginRight={get:function(e,t){var i;s.swap(e,{display:"inline-block"},function(){if(t){i=Le(e,"margin-right","marginRight")}else{i=e.style.marginRight}});return i}}}});if(i.defaultView&&i.defaultView.getComputedStyle){qe=function(e,i){var n,o,r;i=i.replace(ke,"-$1").toLowerCase();if(!(o=e.ownerDocument.defaultView)){return t}if(r=o.getComputedStyle(e,null)){n=r.getPropertyValue(i);if(n===""&&!s.contains(e.ownerDocument.documentElement,e)){n=s.style(e,i)}}return n}}if(i.documentElement.currentStyle){Ee=function(e,t){var i,n,o,s=e.currentStyle&&e.currentStyle[t],r=e.style;if(s===null&&r&&(o=r[t])){s=o}if(!Ce.test(s)&&ye.test(s)){i=r.left;n=e.runtimeStyle&&e.runtimeStyle.left;if(n){e.runtimeStyle.left=e.currentStyle.left}r.left=t==="fontSize"?"1em":s||0;s=r.pixelLeft+"px";r.left=i;if(n){e.runtimeStyle.left=n}}return s===""?"auto":s}}Le=qe||Ee;function Ie(e,t,i){var n=t==="width"?e.offsetWidth:e.offsetHeight,o=t==="width"?Se:Te;if(n>0){if(i!=="border"){s.each(o,function(){if(!i){n-=parseFloat(s.css(e,"padding"+this))||0}if(i==="margin"){n+=parseFloat(s.css(e,i+this))||0}else{n-=parseFloat(s.css(e,"border"+this+"Width"))||0}})}return n+"px"}n=Le(e,t,t);if(n<0||n==null){n=e.style[t]||0}n=parseFloat(n)||0;if(i){s.each(o,function(){n+=parseFloat(s.css(e,"padding"+this))||0;if(i!=="padding"){n+=parseFloat(s.css(e,"border"+this+"Width"))||0}if(i==="margin"){n+=parseFloat(s.css(e,i+this))||0}})}return n+"px"}if(s.expr&&s.expr.filters){s.expr.filters.hidden=function(e){var t=e.offsetWidth,i=e.offsetHeight;return t===0&&i===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"};s.expr.filters.visible=function(e){return!s.expr.filters.hidden(e)}}var Me=/%20/g,Ae=/\[\]$/,De=/\r?\n/g,Ne=/#.*$/,Oe=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Fe=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Re=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Pe=/^(?:GET|HEAD)$/,Be=/^\/\//,He=/\?/,Ue=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Qe=/^(?:select|textarea)/i,je=/\s+/,We=/([?&])_=[^&]*/,Ve=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,ze=s.fn.load,Ke={},Ge={},Je,Ye,Xe=["*/"]+["*"];try{Je=o.href}catch(Ze){Je=i.createElement("a");Je.href="";Je=Je.href}Ye=Ve.exec(Je.toLowerCase())||[];function et(e){return function(t,i){if(typeof t!=="string"){i=t;t="*"}if(s.isFunction(i)){var n=t.toLowerCase().split(je),o=0,r=n.length,a,l,u;for(;o<r;o++){a=n[o];u=/^\+/.test(a);if(u){a=a.substr(1)||"*"}l=e[a]=e[a]||[];l[u?"unshift":"push"](i)}}}}function tt(e,i,n,o,s,r){s=s||i.dataTypes[0];r=r||{};r[s]=true;var a=e[s],l=0,u=a?a.length:0,d=e===Ke,c;for(;l<u&&(d||!c);l++){c=a[l](i,n,o);if(typeof c==="string"){if(!d||r[c]){c=t}else{i.dataTypes.unshift(c);c=tt(e,i,n,o,c,r)}}}if((d||!c)&&!r["*"]){c=tt(e,i,n,o,"*",r)}return c}function it(e,i){var n,o,r=s.ajaxSettings.flatOptions||{};for(n in i){if(i[n]!==t){(r[n]?e:o||(o={}))[n]=i[n]}}if(o){s.extend(true,e,o)}}s.fn.extend({load:function(e,i,n){if(typeof e!=="string"&&ze){return ze.apply(this,arguments)}else if(!this.length){return this}var o=e.indexOf(" ");if(o>=0){var r=e.slice(o,e.length);e=e.slice(0,o)}var a="GET";if(i){if(s.isFunction(i)){n=i;i=t}else if(typeof i==="object"){i=s.param(i,s.ajaxSettings.traditional);a="POST"}}var l=this;s.ajax({url:e,type:a,dataType:"html",data:i,complete:function(e,t,i){i=e.responseText;if(e.isResolved()){e.done(function(e){i=e});l.html(r?s("<div>").append(i.replace(Ue,"")).find(r):i)}if(n){l.each(n,[i,t,e])}}});return this},serialize:function(){return s.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?s.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Qe.test(this.nodeName)||Fe.test(this.type))}).map(function(e,t){var i=s(this).val();return i==null?null:s.isArray(i)?s.map(i,function(e,i){return{name:t.name,value:e.replace(De,"\r\n")}}):{name:t.name,value:i.replace(De,"\r\n")}}).get()}});s.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){s.fn[t]=function(e){return this.bind(t,e)}});s.each(["get","post"],function(e,i){s[i]=function(e,n,o,r){if(s.isFunction(n)){r=r||o;o=n;n=t}return s.ajax({type:i,url:e,data:n,success:o,dataType:r})}});s.extend({getScript:function(e,i){return s.get(e,t,i,"script")},getJSON:function(e,t,i){return s.get(e,t,i,"json")},ajaxSetup:function(e,t){if(t){it(e,s.ajaxSettings)}else{t=e;e=s.ajaxSettings}it(e,t);return e},ajaxSettings:{url:Je,isLocal:Re.test(Ye[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Xe},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":true,"text json":s.parseJSON,"text xml":s.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:et(Ke),ajaxTransport:et(Ge),ajax:function(e,i){if(typeof e==="object"){i=e;e=t}i=i||{};var n=s.ajaxSetup({},i),o=n.context||n,r=o!==n&&(o.nodeType||o instanceof s)?s(o):s.event,a=s.Deferred(),l=s.Callbacks("once memory"),u=n.statusCode||{},d,c={},h={},f,p,g,_,m,v=0,w,b,k={readyState:0,setRequestHeader:function(e,t){if(!v){var i=e.toLowerCase();e=h[i]=h[i]||e;c[e]=t}return this},getAllResponseHeaders:function(){return v===2?f:null},getResponseHeader:function(e){var i;if(v===2){if(!p){p={};while(i=Oe.exec(f)){p[i[1].toLowerCase()]=i[2]}}i=p[e.toLowerCase()]}return i===t?null:i},overrideMimeType:function(e){if(!v){n.mimeType=e}return this},abort:function(e){e=e||"abort";if(g){g.abort(e)}C(0,e);return this}};function C(e,i,c,h){if(v===2){return}v=2;if(_){clearTimeout(_)}g=t;f=h||"";k.readyState=e>0?4:0;var p,m,b,C=i,y=c?ot(n,k,c):t,x,S;if(e>=200&&e<300||e===304){if(n.ifModified){if(x=k.getResponseHeader("Last-Modified")){s.lastModified[d]=x}if(S=k.getResponseHeader("Etag")){s.etag[d]=S}}if(e===304){C="notmodified";p=true}else{try{m=st(n,y);C="success";p=true}catch(T){C="parsererror";b=T}}}else{b=C;if(!C||e){C="error";if(e<0){e=0}}}k.status=e;k.statusText=""+(i||C);if(p){a.resolveWith(o,[m,C,k])}else{a.rejectWith(o,[k,C,b])}k.statusCode(u);u=t;if(w){r.trigger("ajax"+(p?"Success":"Error"),[k,n,p?m:b])}l.fireWith(o,[k,C]);if(w){r.trigger("ajaxComplete",[k,n]);if(!--s.active){s.event.trigger("ajaxStop")}}}a.promise(k);k.success=k.done;k.error=k.fail;k.complete=l.add;k.statusCode=function(e){if(e){var t;if(v<2){for(t in e){u[t]=[u[t],e[t]]}}else{t=e[k.status];k.then(t,t)}}return this};n.url=((e||n.url)+"").replace(Ne,"").replace(Be,Ye[1]+"//");n.dataTypes=s.trim(n.dataType||"*").toLowerCase().split(je);if(n.crossDomain==null){m=Ve.exec(n.url.toLowerCase());n.crossDomain=!!(m&&(m[1]!=Ye[1]||m[2]!=Ye[2]||(m[3]||(m[1]==="http:"?80:443))!=(Ye[3]||(Ye[1]==="http:"?80:443))))}if(n.data&&n.processData&&typeof n.data!=="string"){n.data=s.param(n.data,n.traditional)}tt(Ke,n,i,k);if(v===2){return false}w=n.global;n.type=n.type.toUpperCase();n.hasContent=!Pe.test(n.type);if(w&&s.active++===0){s.event.trigger("ajaxStart")}if(!n.hasContent){if(n.data){n.url+=(He.test(n.url)?"&":"?")+n.data;delete n.data}d=n.url;if(n.cache===false){var y=s.now(),x=n.url.replace(We,"$1_="+y);n.url=x+(x===n.url?(He.test(n.url)?"&":"?")+"_="+y:"")}}if(n.data&&n.hasContent&&n.contentType!==false||i.contentType){k.setRequestHeader("Content-Type",n.contentType)}if(n.ifModified){d=d||n.url;if(s.lastModified[d]){k.setRequestHeader("If-Modified-Since",s.lastModified[d])}if(s.etag[d]){k.setRequestHeader("If-None-Match",s.etag[d])}}k.setRequestHeader("Accept",n.dataTypes[0]&&n.accepts[n.dataTypes[0]]?n.accepts[n.dataTypes[0]]+(n.dataTypes[0]!=="*"?", "+Xe+"; q=0.01":""):n.accepts["*"]);for(b in n.headers){k.setRequestHeader(b,n.headers[b])}if(n.beforeSend&&(n.beforeSend.call(o,k,n)===false||v===2)){k.abort();return false}for(b in{success:1,error:1,complete:1}){k[b](n[b])}g=tt(Ge,n,i,k);if(!g){C(-1,"No Transport")}else{k.readyState=1;if(w){r.trigger("ajaxSend",[k,n])}if(n.async&&n.timeout>0){_=setTimeout(function(){k.abort("timeout")},n.timeout)}try{v=1;g.send(c,C)}catch(S){if(v<2){C(-1,S)}else{s.error(S)}}}return k},param:function(e,i){var n=[],o=function(e,t){t=s.isFunction(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(i===t){i=s.ajaxSettings.traditional}if(s.isArray(e)||e.jquery&&!s.isPlainObject(e)){s.each(e,function(){o(this.name,this.value)})}else{for(var r in e){nt(r,e[r],i,o)}}return n.join("&").replace(Me,"+")}});function nt(e,t,i,n){if(s.isArray(t)){s.each(t,function(t,o){if(i||Ae.test(e)){n(e,o)}else{nt(e+"["+(typeof o==="object"||s.isArray(o)?t:"")+"]",o,i,n)}})}else if(!i&&t!=null&&typeof t==="object"){for(var o in t){nt(e+"["+o+"]",t[o],i,n)}}else{n(e,t)}}s.extend({active:0,lastModified:{},etag:{}});function ot(e,i,n){var o=e.contents,s=e.dataTypes,r=e.responseFields,a,l,u,d;for(l in r){if(l in n){i[r[l]]=n[l]}}while(s[0]==="*"){s.shift();if(a===t){a=e.mimeType||i.getResponseHeader("content-type")}}if(a){for(l in o){if(o[l]&&o[l].test(a)){s.unshift(l);break}}}if(s[0]in n){u=s[0]}else{for(l in n){if(!s[0]||e.converters[l+" "+s[0]]){u=l;break}if(!d){d=l}}u=u||d}if(u){if(u!==s[0]){s.unshift(u)}return n[u]}}function st(e,i){if(e.dataFilter){i=e.dataFilter(i,e.dataType)}var n=e.dataTypes,o={},r,a,l=n.length,u,d=n[0],c,h,f,p,g;for(r=1;r<l;r++){if(r===1){for(a in e.converters){if(typeof a==="string"){o[a.toLowerCase()]=e.converters[a]}}}c=d;d=n[r];if(d==="*"){d=c}else if(c!=="*"&&c!==d){h=c+" "+d;f=o[h]||o["* "+d];if(!f){g=t;for(p in o){u=p.split(" ");if(u[0]===c||u[0]==="*"){g=o[u[1]+" "+d];if(g){p=o[p];if(p===true){f=g}else if(g===true){f=p}break}}}}if(!(f||g)){s.error("No conversion from "+h.replace(" "," to "))}if(f!==true){i=f?f(i):g(p(i))}}}return i}var rt=s.now(),at=/(\=)\?(&|$)|\?\?/i;s.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return s.expando+"_"+rt++}});s.ajaxPrefilter("json jsonp",function(t,i,n){var o=t.contentType==="application/x-www-form-urlencoded"&&typeof t.data==="string";if(t.dataTypes[0]==="jsonp"||t.jsonp!==false&&(at.test(t.url)||o&&at.test(t.data))){var r,a=t.jsonpCallback=s.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,l=e[a],u=t.url,d=t.data,c="$1"+a+"$2";if(t.jsonp!==false){u=u.replace(at,c);if(t.url===u){if(o){d=d.replace(at,c)}if(t.data===d){u+=(/\?/.test(u)?"&":"?")+t.jsonp+"="+a}}}t.url=u;t.data=d;e[a]=function(e){r=[e]};n.always(function(){e[a]=l;if(r&&s.isFunction(l)){e[a](r[0])}});t.converters["script json"]=function(){if(!r){s.error(a+" was not called")}return r[0]};t.dataTypes[0]="json";return"script"}});s.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){s.globalEval(e);return e}}});s.ajaxPrefilter("script",function(e){if(e.cache===t){e.cache=false}if(e.crossDomain){e.type="GET";e.global=false}});s.ajaxTransport("script",function(e){if(e.crossDomain){var n,o=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,r){n=i.createElement("script");n.async="async";if(e.scriptCharset){n.charset=e.scriptCharset}n.src=e.url;n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState)){n.onload=n.onreadystatechange=null;if(o&&n.parentNode){o.removeChild(n)}n=t;if(!i){r(200,"success")}}};o.insertBefore(n,o.firstChild)},abort:function(){if(n){n.onload(0,1)}}}}});var lt=e.ActiveXObject?function(){for(var e in dt){dt[e](0,1)}}:false,ut=0,dt;function ct(){try{return new e.XMLHttpRequest}catch(t){}}function ht(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}s.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&ct()||ht()}:ct;(function(e){s.extend(s.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})})(s.ajaxSettings.xhr());if(s.support.ajax){
s.ajaxTransport(function(i){if(!i.crossDomain||s.support.cors){var n;return{send:function(o,r){var a=i.xhr(),l,u;if(i.username){a.open(i.type,i.url,i.async,i.username,i.password)}else{a.open(i.type,i.url,i.async)}if(i.xhrFields){for(u in i.xhrFields){a[u]=i.xhrFields[u]}}if(i.mimeType&&a.overrideMimeType){a.overrideMimeType(i.mimeType)}if(!i.crossDomain&&!o["X-Requested-With"]){o["X-Requested-With"]="XMLHttpRequest"}try{for(u in o){a.setRequestHeader(u,o[u])}}catch(d){}a.send(i.hasContent&&i.data||null);n=function(e,o){var u,d,c,h,f;try{if(n&&(o||a.readyState===4)){n=t;if(l){a.onreadystatechange=s.noop;if(lt){delete dt[l]}}if(o){if(a.readyState!==4){a.abort()}}else{u=a.status;c=a.getAllResponseHeaders();h={};f=a.responseXML;if(f&&f.documentElement){h.xml=f}h.text=a.responseText;try{d=a.statusText}catch(p){d=""}if(!u&&i.isLocal&&!i.crossDomain){u=h.text?200:404}else if(u===1223){u=204}}}}catch(g){if(!o){r(-1,g)}}if(h){r(u,d,h,c)}};if(!i.async||a.readyState===4){n()}else{l=++ut;if(lt){if(!dt){dt={};s(e).unload(lt)}dt[l]=n}a.onreadystatechange=n}},abort:function(){if(n){n(0,1)}}}}})}var ft={},pt,gt,_t=/^(?:toggle|show|hide)$/,mt=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,vt,wt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],bt;s.fn.extend({show:function(e,t,i){var n,o;if(e||e===0){return this.animate(yt("show",3),e,t,i)}else{for(var r=0,a=this.length;r<a;r++){n=this[r];if(n.style){o=n.style.display;if(!s._data(n,"olddisplay")&&o==="none"){o=n.style.display=""}if(o===""&&s.css(n,"display")==="none"){s._data(n,"olddisplay",xt(n.nodeName))}}}for(r=0;r<a;r++){n=this[r];if(n.style){o=n.style.display;if(o===""||o==="none"){n.style.display=s._data(n,"olddisplay")||""}}}return this}},hide:function(e,t,i){if(e||e===0){return this.animate(yt("hide",3),e,t,i)}else{var n,o,r=0,a=this.length;for(;r<a;r++){n=this[r];if(n.style){o=s.css(n,"display");if(o!=="none"&&!s._data(n,"olddisplay")){s._data(n,"olddisplay",o)}}}for(r=0;r<a;r++){if(this[r].style){this[r].style.display="none"}}return this}},_toggle:s.fn.toggle,toggle:function(e,t,i){var n=typeof e==="boolean";if(s.isFunction(e)&&s.isFunction(t)){this._toggle.apply(this,arguments)}else if(e==null||n){this.each(function(){var t=n?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()})}else{this.animate(yt("toggle",3),e,t,i)}return this},fadeTo:function(e,t,i,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var o=s.speed(t,i,n);if(s.isEmptyObject(e)){return this.each(o.complete,[false])}e=s.extend({},e);function r(){if(o.queue===false){s._mark(this)}var t=s.extend({},o),i=this.nodeType===1,n=i&&s(this).is(":hidden"),r,a,l,u,d,c,h,f,p;t.animatedProperties={};for(l in e){r=s.camelCase(l);if(l!==r){e[r]=e[l];delete e[l]}a=e[r];if(s.isArray(a)){t.animatedProperties[r]=a[1];a=e[r]=a[0]}else{t.animatedProperties[r]=t.specialEasing&&t.specialEasing[r]||t.easing||"swing"}if(a==="hide"&&n||a==="show"&&!n){return t.complete.call(this)}if(i&&(r==="height"||r==="width")){t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(s.css(this,"display")==="inline"&&s.css(this,"float")==="none"){if(!s.support.inlineBlockNeedsLayout||xt(this.nodeName)==="inline"){this.style.display="inline-block"}else{this.style.zoom=1}}}}if(t.overflow!=null){this.style.overflow="hidden"}for(l in e){u=new s.fx(this,t,l);a=e[l];if(_t.test(a)){p=s._data(this,"toggle"+l)||(a==="toggle"?n?"show":"hide":0);if(p){s._data(this,"toggle"+l,p==="show"?"hide":"show");u[p]()}else{u[a]()}}else{d=mt.exec(a);c=u.cur();if(d){h=parseFloat(d[2]);f=d[3]||(s.cssNumber[l]?"":"px");if(f!=="px"){s.style(this,l,(h||1)+f);c=(h||1)/u.cur()*c;s.style(this,l,c+f)}if(d[1]){h=(d[1]==="-="?-1:1)*h+c}u.custom(c,h,f)}else{u.custom(c,a,"")}}}return true}return o.queue===false?this.each(r):this.queue(o.queue,r)},stop:function(e,i,n){if(typeof e!=="string"){n=i;i=e;e=t}if(i&&e!==false){this.queue(e||"fx",[])}return this.each(function(){var t,i=false,o=s.timers,r=s._data(this);if(!n){s._unmark(true,this)}function a(e,t,i){var o=t[i];s.removeData(e,i,true);o.stop(n)}if(e==null){for(t in r){if(r[t].stop&&t.indexOf(".run")===t.length-4){a(this,r,t)}}}else if(r[t=e+".run"]&&r[t].stop){a(this,r,t)}for(t=o.length;t--;){if(o[t].elem===this&&(e==null||o[t].queue===e)){if(n){o[t](true)}else{o[t].saveState()}i=true;o.splice(t,1)}}if(!(n&&i)){s.dequeue(this,e)}})}});function kt(){setTimeout(Ct,0);return bt=s.now()}function Ct(){bt=t}function yt(e,t){var i={};s.each(wt.concat.apply([],wt.slice(0,t)),function(){i[this]=e});return i}s.each({slideDown:yt("show",1),slideUp:yt("hide",1),slideToggle:yt("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}});s.extend({speed:function(e,t,i){var n=e&&typeof e==="object"?s.extend({},e):{complete:i||!i&&t||s.isFunction(e)&&e,duration:e,easing:i&&t||t&&!s.isFunction(t)&&t};n.duration=s.fx.off?0:typeof n.duration==="number"?n.duration:n.duration in s.fx.speeds?s.fx.speeds[n.duration]:s.fx.speeds._default;if(n.queue==null||n.queue===true){n.queue="fx"}n.old=n.complete;n.complete=function(e){if(s.isFunction(n.old)){n.old.call(this)}if(n.queue){s.dequeue(this,n.queue)}else if(e!==false){s._unmark(this)}};return n},easing:{linear:function(e,t,i,n){return i+n*e},swing:function(e,t,i,n){return(-Math.cos(e*Math.PI)/2+.5)*n+i}},timers:[],fx:function(e,t,i){this.options=t;this.elem=e;this.prop=i;t.orig=t.orig||{}}});s.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e},custom:function(e,i,n){var o=this,r=s.fx;this.startTime=bt||kt();this.end=i;this.now=this.start=e;this.pos=this.state=0;this.unit=n||this.unit||(s.cssNumber[this.prop]?"":"px");function a(e){return o.step(e)}a.queue=this.options.queue;a.elem=this.elem;a.saveState=function(){if(o.options.hide&&s._data(o.elem,"fxshow"+o.prop)===t){s._data(o.elem,"fxshow"+o.prop,o.start)}};if(a()&&s.timers.push(a)&&!vt){vt=setInterval(r.tick,r.interval)}},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop);this.options.show=true;if(e!==t){this.custom(this.cur(),e)}else{this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur())}s(this.elem).show()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(e){var t,i,n,o=bt||kt(),r=true,a=this.elem,l=this.options;if(e||o>=l.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();l.animatedProperties[this.prop]=true;for(t in l.animatedProperties){if(l.animatedProperties[t]!==true){r=false}}if(r){if(l.overflow!=null&&!s.support.shrinkWrapBlocks){s.each(["","X","Y"],function(e,t){a.style["overflow"+t]=l.overflow[e]})}if(l.hide){s(a).hide()}if(l.hide||l.show){for(t in l.animatedProperties){s.style(a,t,l.orig[t]);s.removeData(a,"fxshow"+t,true);s.removeData(a,"toggle"+t,true)}}n=l.complete;if(n){l.complete=false;n.call(a)}}return false}else{if(l.duration==Infinity){this.now=o}else{i=o-this.startTime;this.state=i/l.duration;this.pos=s.easing[l.animatedProperties[this.prop]](this.state,i,0,1,l.duration);this.now=this.start+(this.end-this.start)*this.pos}this.update()}return true}};s.extend(s.fx,{tick:function(){var e,t=s.timers,i=0;for(;i<t.length;i++){e=t[i];if(!e()&&t[i]===e){t.splice(i--,1)}}if(!t.length){s.fx.stop()}},interval:13,stop:function(){clearInterval(vt);vt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){if(e.elem.style&&e.elem.style[e.prop]!=null){e.elem.style[e.prop]=e.now+e.unit}else{e.elem[e.prop]=e.now}}}});s.each(["width","height"],function(e,t){s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now))}});if(s.expr&&s.expr.filters){s.expr.filters.animated=function(e){return s.grep(s.timers,function(t){return e===t.elem}).length}}function xt(e){if(!ft[e]){var t=i.body,n=s("<"+e+">").appendTo(t),o=n.css("display");n.remove();if(o==="none"||o===""){if(!pt){pt=i.createElement("iframe");pt.frameBorder=pt.width=pt.height=0}t.appendChild(pt);if(!gt||!pt.createElement){gt=(pt.contentWindow||pt.contentDocument).document;gt.write((i.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");gt.close()}n=gt.createElement(e);gt.body.appendChild(n);o=s.css(n,"display");t.removeChild(pt)}ft[e]=o}return ft[e]}var $t=/^t(?:able|d|h)$/i,St=/^(?:body|html)$/i;if("getBoundingClientRect"in i.documentElement){s.fn.offset=function(e){var t=this[0],i;if(e){return this.each(function(t){s.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return s.offset.bodyOffset(t)}try{i=t.getBoundingClientRect()}catch(n){}var o=t.ownerDocument,r=o.documentElement;if(!i||!s.contains(r,t)){return i?{top:i.top,left:i.left}:{top:0,left:0}}var a=o.body,l=Tt(o),u=r.clientTop||a.clientTop||0,d=r.clientLeft||a.clientLeft||0,c=l.pageYOffset||s.support.boxModel&&r.scrollTop||a.scrollTop,h=l.pageXOffset||s.support.boxModel&&r.scrollLeft||a.scrollLeft,f=i.top+c-u,p=i.left+h-d;return{top:f,left:p}}}else{s.fn.offset=function(e){var t=this[0];if(e){return this.each(function(t){s.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return s.offset.bodyOffset(t)}var i,n=t.offsetParent,o=t,r=t.ownerDocument,a=r.documentElement,l=r.body,u=r.defaultView,d=u?u.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,h=t.offsetLeft;while((t=t.parentNode)&&t!==l&&t!==a){if(s.support.fixedPosition&&d.position==="fixed"){break}i=u?u.getComputedStyle(t,null):t.currentStyle;c-=t.scrollTop;h-=t.scrollLeft;if(t===n){c+=t.offsetTop;h+=t.offsetLeft;if(s.support.doesNotAddBorder&&!(s.support.doesAddBorderForTableAndCells&&$t.test(t.nodeName))){c+=parseFloat(i.borderTopWidth)||0;h+=parseFloat(i.borderLeftWidth)||0}o=n;n=t.offsetParent}if(s.support.subtractsBorderForOverflowNotVisible&&i.overflow!=="visible"){c+=parseFloat(i.borderTopWidth)||0;h+=parseFloat(i.borderLeftWidth)||0}d=i}if(d.position==="relative"||d.position==="static"){c+=l.offsetTop;h+=l.offsetLeft}if(s.support.fixedPosition&&d.position==="fixed"){c+=Math.max(a.scrollTop,l.scrollTop);h+=Math.max(a.scrollLeft,l.scrollLeft)}return{top:c,left:h}}}s.offset={bodyOffset:function(e){var t=e.offsetTop,i=e.offsetLeft;if(s.support.doesNotIncludeMarginInBodyOffset){t+=parseFloat(s.css(e,"marginTop"))||0;i+=parseFloat(s.css(e,"marginLeft"))||0}return{top:t,left:i}},setOffset:function(e,t,i){var n=s.css(e,"position");if(n==="static"){e.style.position="relative"}var o=s(e),r=o.offset(),a=s.css(e,"top"),l=s.css(e,"left"),u=(n==="absolute"||n==="fixed")&&s.inArray("auto",[a,l])>-1,d={},c={},h,f;if(u){c=o.position();h=c.top;f=c.left}else{h=parseFloat(a)||0;f=parseFloat(l)||0}if(s.isFunction(t)){t=t.call(e,i,r)}if(t.top!=null){d.top=t.top-r.top+h}if(t.left!=null){d.left=t.left-r.left+f}if("using"in t){t.using.call(e,d)}else{o.css(d)}}};s.fn.extend({position:function(){if(!this[0]){return null}var e=this[0],t=this.offsetParent(),i=this.offset(),n=St.test(t[0].nodeName)?{top:0,left:0}:t.offset();i.top-=parseFloat(s.css(e,"marginTop"))||0;i.left-=parseFloat(s.css(e,"marginLeft"))||0;n.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0;n.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0;return{top:i.top-n.top,left:i.left-n.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&(!St.test(e.nodeName)&&s.css(e,"position")==="static")){e=e.offsetParent}return e})}});s.each(["Left","Top"],function(e,i){var n="scroll"+i;s.fn[n]=function(i){var o,r;if(i===t){o=this[0];if(!o){return null}r=Tt(o);return r?"pageXOffset"in r?r[e?"pageYOffset":"pageXOffset"]:s.support.boxModel&&r.document.documentElement[n]||r.document.body[n]:o[n]}return this.each(function(){r=Tt(this);if(r){r.scrollTo(!e?i:s(r).scrollLeft(),e?i:s(r).scrollTop())}else{this[n]=i}})}});function Tt(e){return s.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:false}s.each(["Height","Width"],function(e,i){var n=i.toLowerCase();s.fn["inner"+i]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,n,"padding")):this[n]():null};s.fn["outer"+i]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,n,e?"margin":"border")):this[n]():null};s.fn[n]=function(e){var o=this[0];if(!o){return e==null?null:this}if(s.isFunction(e)){return this.each(function(t){var i=s(this);i[n](e.call(this,t,i[n]()))})}if(s.isWindow(o)){var r=o.document.documentElement["client"+i],a=o.document.body;return o.document.compatMode==="CSS1Compat"&&r||a&&a["client"+i]||r}else if(o.nodeType===9){return Math.max(o.documentElement["client"+i],o.body["scroll"+i],o.documentElement["scroll"+i],o.body["offset"+i],o.documentElement["offset"+i])}else if(e===t){var l=s.css(o,n),u=parseFloat(l);return s.isNumeric(u)?u:l}else{return this.css(n,typeof e==="string"?e:e+"px")}}});e.jQuery=e.$=s})(window);exports=module.exports=window.jQuery},{});require.install("jquery.securepost",function(require,exports,module){(function($){var e=require("settings").formkey;$.securepost=function(t,i,n,o){i=i||{};if(!e){throw new Error("No formkey set; can't securepost")}i.formkey=e;return $.post(t,i,n,o)};$.secureData=function(i,n,o,s,r){if(typeof arguments[0]=="object"){i=arguments[0];n=arguments[1];o=arguments[2];s=arguments[3];r=arguments[4]}else{n=arguments[0];o=arguments[1];s=arguments[2];r=arguments[3];i=arguments[4]||{}}if(!e){throw new Error("No formkey set; can't send data securely")}i.type=i.type||"POST";i.dataType=i.dataType||"json";i.url=n;var a=i.secureDataError;i.success=function(e){if(e.___ERROR___){var i=e.___ERROR___[0];var o=e.___ERROR___[1];var r=new t("Got an error from the URL '"+n+"'",i,o);if(a){return a(i,o,r)}else{throw r}}else{if(s){return s(e)}}};i.error=r;var l=i.data||o;i.data={formkey:e,data:JSON.stringify(l)};return $.ajax(i)};var t=function(e,t,i){this.message=i+": "+e+" <"+JSON.stringify(t)+">"};t.prototype=new Error;t.prototype.constructor=t;$.secureData.SecureDataError=t})(jQuery)},{settings:true});require.install("jquery.cookie",function(require,exports,module){var e=require("jquery"),$=e;e.cookie=function(t,i,n){n=n||{};var o=n.document||document;assert(o.nodeType===9);if(typeof i!="undefined"){n=n||{};if(i===null){i="";n=$.extend({},n);n.expires=-1}var s="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){var r;if(typeof n.expires=="number"){r=new Date;r.setTime(r.getTime()+n.expires*24*60*60*1e3)}else{r=n.expires}s="; expires="+r.toUTCString()}var a=n.path?"; path="+n.path:"";var l=n.domain?"; domain="+n.domain:"";var u=n.secure?"; secure":"";o.cookie=[t,"=",encodeURIComponent(i),s,a,l,u].join("")}else{var d=null;if(o.cookie&&o.cookie!=""){var c=o.cookie.split(";");for(var h=0;h<c.length;h++){var f=e.trim(c[h]);if(f.substring(0,t.length+1)==t+"="){d=decodeURIComponent(f.substring(t.length+1));break}}}return d}}},{jquery:true});require.install("cookies",function(require,exports,module){require("jquery.cookie");var e=require("settings"),t=".quora.com";function i(i,n,o){o=o||{};o=$.extend({expires:999999,path:"/",domain:t},o);return $.cookie(e.cookiePrefix+"-"+i,n,o)}exports.cookie=i;function n(e,t){var n=document.cookie.length;var o=document.cookie.split(";").length;if(n>2400||o>24){return}var s={key:e,args:t},r=Math.floor(Math.random()*4294967296);i("qm-"+r,JSON.stringify(s),{expires:1})}exports.setMessage=n;exports.setSingleUse=function(e,t,n){i("qsu-"+e,t,n)};exports.setQfeedLog=function(e,t){var i=e.getDvar("feed_story_hash");if(!i){return}var o=e.getDvar("feed_story_position");if(o===null){o=0}var s=e.getDvar("feed_story_inner_position");if(s===null){s=0}var r=e.getDvar("feed_story_initial");if(!r){r=false}var a=e.getDvar("feed_ty");if(a===null){a=0}var l=e.getDvar("feed_page");var u=e.getDvar("page_data");var d=e.getDvar("focus_ty");n("qfl",[8,i,o,r,t,a,l,u,d,s])};exports.setQueryLog=function(e,t){var i=e.getDvar("query_id");if(i===null){return}var o=e.getDvar("index");if(o===null){o=0}n("qlch",[i,{type:t,index:o}])};exports.setTlog=function(t){var i=e.trail;if(i===null||i===undefined||t===undefined){return}n("tlog",[i,t])};exports.setAnon=function(){i("anon",JSON.stringify(true))};exports.setPublic=function(){i("anon",null)};exports.setAgeGate=function(){var e=new Date;e.setMinutes(e.getMinutes()+30);i("age_gate",+new Date,{expires:e})}},{"jquery.cookie":true,settings:true});require.install("scribe",function(require,exports,module){var e=require("webnode2"),t=require("assert").ok,i=[],n=[],o=false,s=false,r=50,a=5e3;exports.log=function(e,n){if(n===null||n===undefined){n=1}var o=false;if(n){t(0<=n&&n<=1);o=Math.random()<=n}if(o){i.push(e);l()}};function l(){if(i.length>=r){h()}else{u()}}function u(){if(!s){s=setTimeout(h,a)}}function d(){t(o);o=false}function c(){n=[];s=false;d()}function h(){if(o){u();return}n=n.concat(i);i=[];o=true;if(n.length>0){e.rpc("/ajax/scribe_log_POST").kwargs({messages:n}).success(c).except(d).send()}}},{webnode2:true,assert:true});require.install("keystrokes",function(require,exports,module){var e=[];require("event").add(document,"keydown",function(e){if(e.target&&!e.target.getAttribute("contenteditable")&&e.target.nodeName!=="INPUT"){t(e.keyCode||e.charCode,e)}});function t(t,i){for(var n=0,o=e.length;n<o;++n){e[n].trigger(t,i)}}var i=function(e,t){this.codes=e;this.matchHandler=t;this.position=0};i.prototype.trigger=function(e,t){if(e===this.codes[this.position]){this.position+=1}else{this.position=0}if(this.position===this.codes.length){this.matchHandler(t);this.position=0}};exports.on=function(t,n){if(typeof t==="number"){t=[t]}else{t=t.slice(0)}e.push(new i(t,n))}},{event:true});require.install("w2.keycombo",function(require,exports,module){var e=require("cookies"),t=require("scribe"),i="keyboard_used";var n=true;var o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",13:"ENTER",27:"ESCAPE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};var s=exports.hasCmdKey=/Mac/.test(navigator.platform);var r=function(){$("body").addClass("show_focus");if(!e.cookie(i)){e.cookie(i,true);t.log({category:"keyboard_shortcuts",time:(new Date).getTime()})}};var a=function(e){return e.toUpperCase().split(" ").map(function(e){return{alt:/ALT-/.test(e),ctrl:/CTRL-/.test(e)||!s&&/CMD-/.test(e),meta:/META-/.test(e)||s&&/CMD-/.test(e),shift:/SHIFT-/.test(e),character:e.split("-").pop()}})};var l=function(e){return e.map(function(e){var t="";if(e.alt){t+="ALT-"}if(e.ctrl){t+="CTRL-"}if(e.meta){t+="META-"}if(e.shift){t+="SHIFT-"}t+=e.character;return t}).join(" ")};exports.bindKeyComboHandler=function(e,t,i,s){var u=a(t);t=l(u);var d=$(e).data("kchandlers")||{};if(t in d){return false}var c=0,h,f=function(){c=0;clearTimeout(h)};var p=function(e){clearTimeout(h);if(!n){return}var t=e.target.nodeName.toLowerCase();if(!s&&(e.target.isContentEditable||t=="input"||t=="textarea")){return}var a=u[c],l=o[e.which]||String.fromCharCode(e.which).toUpperCase();if(l===a.character&&e.altKey==a.alt&&e.ctrlKey==a.ctrl&&e.metaKey==a.meta&&e.shiftKey==a.shift){c+=1;if(c==u.length){c=0;r();return i(e)}h=setTimeout(f,1e3);return false}f()};d[t]=p;$(e).data("kchandlers",d);$(e).on("keydown",p);return true};exports.unbindKeyComboHandler=function(e,t){e=e.toUpperCase();var i=$(t).data("kchandlers")||{};if(!(e in i)){return false}$(t).unbind("keydown",i[e]);delete i[e];return true};var u=192;require("keystrokes").on(u,function(){n=!n;console.log("Keyboard shortcuts "+(n?"enabled":"disabled"))})},{cookies:true,scribe:true,keystrokes:true});require.install("Class",function(require,exports,module){var e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,t=function(){},i={};function n(e,n){var s=t.prototype=e.prototype,a=new t,l;function u(){if(!l){e.call(i);o(a,n,s);l=true;n=null}if(this===i){return}var t=this.__init__;if(t){t.apply(this,arguments)}}u.prototype=a;u.extend=r;a.constructor=u;return u}function o(e,t,i){for(var n in t){if(t.hasOwnProperty(n)){e[n]=i?s(n,t,i):t[n]}}}function s(t,i,n){var o=i[t],s=n[t];if(typeof o==="function"&&typeof s==="function"&&o!==s&&e.test(o)){return function(){var e=this._super;this._super=n[t];try{return o.apply(this,arguments)}finally{this._super=e}}}return o}function r(e){return n(this,e)}exports.Class=r.call(function(){},{fnbind:function(e){var t=[];if(arguments.length>1){t=[this||null].concat(Array.prototype.slice.call(arguments,1));return e.bind.apply(e,t)}else{return e.bind(this)}}});exports.testExtendSpeed=function(e){var t=e=e||1e4,i=+new Date,n=[];while(e-->0){n.push(exports.Class.extend({__init__:function(e){this.val=e},method:function(e){this.val+=e}}).extend({method:function(e){this._super(e);this.val+=e},foo:function(){},bar:function(){this.foo()}}).extend({__init__:function(){this._super.apply(this,arguments)},foo:function(){}}))}console.log(t,"class definitions took",new Date-i,"ms");n.length=0}},{});require.install("w2.context",function(require,exports,module){var e=require("assert").ok,t=require("Class").Class;var i=t.extend({__init__:function(e){this.value=e;this.handlers={}},bind:function(e,t){if(!this.handlers.hasOwnProperty(t)){this.handlers[t]=[]}this.handlers[t].push(e)},unbind:function(e){delete this.handlers[e]},trigger:function(){var e=Array.prototype.slice.call(arguments);for(var t in this.handlers){if(this.handlers.hasOwnProperty(t)){var i=this.handlers[t];for(var n=0;n<i.length;n++){i[n].apply(this,e)}}}},set:function(e){var t=this.value;this.value=e;this.trigger(t,e)},get:function(){return this.value}});var n=exports.Context=t.extend({__init__:function(){var t=this.initialProperties();e(t,"Override initialProperties() in your"+"subclasses to define a list of properties that this Context should"+"listen to");this.properties={};for(var n in t){this.properties[n]=new i(t[n])}},initialProperties:function(){},on:function(e,t,i){this.assertPropertyName(e);this.properties[e].bind(t,i)},off:function(e){for(var t in this.properties){this.properties[t].unbind(e)}},set:function(e,t){this.assertPropertyName(e);this.properties[e].set(t)},get:function(e){this.assertPropertyName(e);return this.properties[e].get()},assertPropertyName:function(t){e(this.properties.hasOwnProperty(t),"Hey, you are trying to access a context property with an invalid"+"property name. You can only retrieve property names that are defined"+"in Context initialProperties definition in w2.context.js")}});var o=t.extend({__init__:function(e,t){this._context=e;this._cid=t},on:function(e,t){this._context.on(e,t,this._cid)},off:function(){this._context.off(this._cid)},get:function(e){return this._context.get(e)},set:function(e,t){this._context.set(e,t)}});var s=t.extend({__init__:function(e){this.component=e;var t=this.component.contextConstructor();this._context=t?new t(this.component):null;this._contextProxies=[]},get:function(e){for(var t=0;t<this._contextProxies.length;t++){if(this._contextProxies[t]._context instanceof e){return this._contextProxies[t]}}var i=null;var n=this.component;while(n.cid!="*ROOT*"){var s=n.contextManager._context;if(s instanceof e){i=s;break}var r=n.parent();if(n===r){throw new Error(n+"is its own parent()")}n=r}if(!i){return null}var a=new o(i,this.component.cid);this._contextProxies.push(a);return a},unload:function(){for(var e=0;e<this._contextProxies.length;e++){this._contextProxies[e].off()}}});exports.initComponent=function(e){var t=new s(e);e.contextManager=t;e.getContext=t.get.bind(t)};exports.unloadComponent=function(e){if(e.contextManager){e.contextManager.unload()}};exports.ContextDemoInParent=n.extend({initialProperties:function(){return{alpha_state:"none",beta_state:"none"}}});exports.ContextDemoInChild=n.extend({initialProperties:function(){return{delta_state:"none",theta_state:"none"}}});exports.RecentReviewsContext=n.extend({initialProperties:function(){return{label:null,vendor:null,uid:null}}});exports.MobileNuxMain=n.extend({initialProperties:function(){return{stage:null,step:0}}});exports.UserLeaderboardsMain=n.extend({initialProperties:function(){return{is_editing:false}}});exports.ActionBar=n.extend({initialProperties:function(){return{commentsElem:null,loadComments:false,showComments:false,updateSticky:false,toggleEditor:false,selectedOverflowItem:null,overflowItems:[],showOverflowMenu:false,overflowMenuTargetElement:null}}});exports.FeedStoryItem=n.extend({initialProperties:function(){return{showQuestionDownvoteFeedback:false,showAnswerDownvoteFeedback:false,feedbackShown:false,showRemoveFromFeedMenu:null,hideItem:false}}});exports.AnswerVoteContext=n.extend({initialProperties:function(){return{voteState:"no"}}});exports.UniversalPageFeedContext=n.extend({initialProperties:function(){return{feedStories:[],impressionLogger:null,readingTimeLogger:null}}});exports.QTextEditor=n.extend({initialProperties:function(){return{focusInput:false}}});exports.EditQuestionOverflow=n.extend({initialProperties:function(){return{showMenu:false}}});exports.QuestionAnswerVerbose=n.extend({initialProperties:function(){return{expand:false}}});exports.CaptchaInput=n.extend({initialProperties:function(){return{sync:null,isCaptchaFilled:true,captchaResponse:"random string"}}});exports.TribeChat=n.extend({initialProperties:function(){return{minimized:false,messageBoxFocused:false,unreadMessageCount:0}}});exports.QuestionArea=n.extend({initialProperties:function(){return{showActionBar:true,editClicked:null,cancelClicked:null,triggerRequest:null,triggerCancel:null}}});exports.Editor=n.extend({initialProperties:function(){return{shareToTwitter:false,shareToFacebook:false}}})},{assert:true,Class:true});require.install("core/component",function(require,exports,module){exports.parseVcon=function(e){var t=e.__vcon;if(t){if(t.length===1){return t}switch(t[0]){case"cls":case"hmac":return t;case"live":return t.slice(2)}}return null}},{});require.install("visibility",function(require,exports,module){function e(){try{var e=window.frameElement;e.getAttribute("className");return e}catch(t){return null}}exports.getFrameElement=e;function t(e,t){return(" "+(e.className||"")+" ").indexOf(" "+t+" ")!=-1}function i(e,i){if(!t(e,i)){e.className=(e.className||"")+" "+i}}function n(e){var t=/^\s+/,i=/\s+$/;return e.trim?e.trim():e.replace(t,"").replace(i,"")}function o(e,t){e.className=n((" "+(e.className||"")+" ").replace(" "+t+" "," "))}exports.setVisible=function(t){var n=e();if(t){window.focus();if(n){i(n,"maximized")}else{o(document.body,"minimized")}}else{if(n){o(n,"maximized")}else{i(document.body,"minimized")}}};exports.isVisible=function(){var i=e();if(i){return t(i,"maximized")}else{return!t(document.body,"minimized")}};exports.addClass=i;exports.hasClass=t;exports.removeClass=o},{});require.install("webnode2",function(require,exports,module){(function(){var W2=exports,log=require("log").log,settings=require("settings"),keycombo=require("w2.keycombo"),context=require("w2.context"),coreComponent=require("core/component"),Component,VirtualComponent,setContent,setContentHTML,setContentJS;W2._parents={};W2._components={};W2._onVisibleComponents={};W2._children={};W2._knowsAbout={};W2._allChildren={};W2._domids={};W2._domidToCid={};W2._debugInfo={};W2._liveDepInfo={};W2._depKeysBreakpointTokens={};W2._ignoreDomids={};W2._ignoreCids={};W2._groups={};W2._componentGroups={};W2._GROUP_RE=/%([0-9a-zA-Z_]+)/;W2._keyComboHandlers={};W2._unloaded={};W2._hmacs={};function addParents(e){var t,i;var n=Object.keys(e);var o=n.length;for(var s=0;s<o;++s){t=n[s];i=e[t];W2._parents[t]=i;if(typeof W2._allChildren[i]=="undefined"){W2._allChildren[i]=[]}W2._allChildren[i].push(t);if(typeof W2._children[t]=="undefined"){W2._children[t]={}}if(typeof W2._knowsAbout[t]=="undefined"){W2._knowsAbout[t]={}}}}function addHmacs(e){var t=Object.keys(e);var i=t.length;for(var n=0;n<i;++n){var o=t[n];W2._hmacs[o]=e[o]}}function addGroups(e){var t,i,n,o,s;var r=Object.keys(e);var a=r.length;for(var l=0;l<a;++l){n=r[l];t=e[n];s=t.length;for(o=0;o<s;o++){i=t[o];if(!W2._groups[n]){W2._groups[n]=[]}W2._groups[n].push(i);if(!W2._componentGroups[i]){W2._componentGroups[i]=[]}W2._componentGroups[i].push(n)}}}function addChildren(e){var t;var i=Object.keys(e);var n=i.length;for(var o=0;o<n;++o){t=i[o];jQuery.extend(W2._children[t],e[t])}}function addLookups(e){var t;var i=Object.keys(e);var n=i.length;for(var o=0;o<n;++o){t=i[o];jQuery.extend(W2._knowsAbout[t],e[t])}}function addDomids(e){var t,i;var n=Object.keys(e);var o=n.length;for(var s=0;s<o;++s){t=n[s];W2._domidToCid[W2._domids[t]=e[t]]=t}}function addDebugInfo(e){var t,i=require("w2.timing").timing;var n=Object.keys(e);var o=n.length;for(var s=0;s<o;++s){t=n[s];W2._debugInfo[t]=e[t];if(i._components){if(!i._components[t]){i._components[t]={}}i._components[t].addDebugInfo=+new Date}}}function addComponentMetadata(e){var t=e.parents,i=e.children,n=e.knowsAbout,o=e.groups,s=e.debugInfo,r=e.domids,a=e.hmacs;W2.addParents(t);W2.addChildren(i);W2.addLookups(n);W2.addGroups(o);W2.addDomids(r);W2.addHmacs(a);if(s){W2.addDebugInfo(s)}$(document).trigger("w2addcomponents",e);$(document).trigger("webnode_add_component_metadata",e)}function addLiveDepInfo(e,t){var i=Object.keys(e);var n=i.length;for(var o=0;o<n;++o){var s=i[o];W2._liveDepInfo[s]=e[s]}i=Object.keys(t);n=i.length;for(o=0;o<n;++o){var r=i[o];W2._depKeysBreakpointTokens[r]=t[r]}}function _removeComponentMetadata(e){if(log.enabled){log("webnode2._removeComponentMetadata","Removing",e)}var t,i,n,o,s,r,a;$(document).trigger("webnode_before_remove_component_metadata",e);t=W2._parents[e];o=W2._components[e];if(o){s=o.cname;if(s){var l=W2._children[t];if(l&&l[s]==e){delete l[s]}}removeEntry(o)}i=W2._componentGroups[e];if(i){for(r=0;r<i.length;r++){n=i[r];for(a=0;a<W2._groups[n];a++){if(W2._groups[n][a]==e){W2._groups[n].splice(a,1);break}}}}delete W2._componentGroups[e];delete W2._components[e];delete W2._parents[e];delete W2._allChildren[e];delete W2._children[e];delete W2._knowsAbout[e];delete W2._domidToCid[W2._domids[e]];delete W2._domids[e];delete W2._debugInfo[e];delete W2._onVisibleComponents[e];delete onLoadStatus[e];delete onLoadCallbacks[e];$(document).trigger("webnode_after_remove_component_metadata",e)}function getLiveDomId(e){return W2._domids[e]}function getLiveDomElement(e){return document.getElementById(getLiveDomId(e))}function getComponentFromElement(e){while(e&&!(e.id in W2._domidToCid)){e=e.parentNode}return e&&W2._components[W2._domidToCid[e.id]]}function getLiveParent(e){if(W2._domids[e]){return W2._domids[e]}else if(W2._parents[e]){return getLiveParent(W2._parents[e])}else{return""}}function getLiveChildren(e){var t=W2._allChildren[e];var i=[];if(t){for(var n=0;n<t.length;++n){if(t[n]in W2._domids){i.push(W2._domids[t[n]])}}}return i}function registerComponents(e){var t=[],i,n,o=require("w2.timing").timing;for(i=0;i<e.length;i++){n=e[i];if(log.enabled){log("webnode2.registerComponents","Registering",n.cid)}W2._components[n.cid]=n;if(n.onVisible){W2._onVisibleComponents[n.cid]=n;t.push(n)}}if(require("visibility").isVisible()){for(i=0;i<t.length;i++){n=t[i];var s=+new Date;try{n.onVisible()}catch(r){assert(false)}if(o.components){if(!o.components[n.cid]){o.components[n.cid]={}}o.components[n.cid].v=+new Date-s}}}return e}var stateEntries={};function hasEntry(e){return e.__js_key in stateEntries}function getEntry(e){var t=e.__js_key;return stateEntries[t]||(stateEntries[t]={ownerCid:e.cid,state:{}})}function removeEntry(e){var t=e.cid;if(!e.__js_key||e.__js_key===t){var i=stateEntries[t];if(i&&i.ownerCid===t){delete stateEntries[t]}}}Component=require("Class").Class.extend({__init__:function(e,t,i,n){
this.cid=e;this.cname=t;var o=W2._hmacs[this.cid];if(o){this.__vcon=o.split(":")}else{this.__vcon=null}this.__js_init=i;this.__js_key=n.js_key||e;if(t!==null&&hasEntry(this)){var s=getEntry(this);assert(s.ownerCid!==this.cid);s.ownerCid=this.cid}this.init(i);return this},contextConstructor:function(){},init:function(e){var t;if(typeof e=="object"){for(t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}}return this},whenOnLoaded:function(e){var t=this.cid;if(onLoadStatus[t]===ONLOAD_DONE){e()}else{var i=onLoadCallbacks[t]||[];i.push(e);onLoadCallbacks[t]=i}},state:function(e,t){var i=getEntry(this),n=i.state,o=W2._components[i.ownerCid]||this,s=o.stateHandlers[e],r;if(s){r=n[e]=s.call(o)}else{r=n[e]}if(arguments.length>1){n[e]=t;if(s){s.call(o,t)}}return r},stateHandlers:{},initState:function(e,t){var i=getEntry(this),n=i.state,o=W2._components[i.ownerCid]||this;return o.state(e,e in n?n[e]:t)},child:function(e){var t,i;i=W2._children[this.cid];if(i){t=i[e]}return _safeGetComponentByCID(t)},children:function(){var e=W2._allChildren[this.cid],t=[],i;if(!e){return t}for(i=0;i<e.length;i++){t.push(_safeGetComponentByCID(e[i]))}return t},parent:function(){var e;e=W2._parents[this.cid];return _safeGetComponentByCID(e)},getJQueryObject:function(){return $("#"+W2.getLiveParent(this.cid))},installScrollHandlers:function(e){this._scrollHandler=this.fnbind(e);$(window).scroll(this._scrollHandler)},uninstallScrollHandlers:function(){if(this._scrollHandler){$(window).unbind("scroll",this._scrollHandler)}},clickHandlers:{},mouseDownHandlers:{},mouseUpHandlers:{},mouseOverHandlers:{},mouseOutHandlers:{},installMouseHandlers:function(){var e=this,t={clickHandlers:"click",mouseDownHandlers:"mousedown",mouseUpHandlers:"mouseup",mouseOverHandlers:"mouseover",mouseOutHandlers:"mouseout"},i=function(t){var i=s[t];e.$("#@"+t).bind(o,function(t){t.preventDefault();return i.call(e,t)})};for(var n in t){var o=t[n];var s=this[n];for(var r in s){i(r)}}},onKeyCombination:function(e,t,i,n,o){if(!settings.keyboardShortcuts||!$(e).length){return}if(!n){var s=$(e);while(s.length&&!s.hasClass("kbfocusable")){s=s.parent()}n=s.get(0)||document.body}if(keycombo.bindKeyComboHandler(n,t,i,o)){W2._keyComboHandlers[this.cid]=W2._keyComboHandlers[this.cid]||[];W2._keyComboHandlers[this.cid].push([t,n])}else{if(log.enabled){log.trace("webnode2.onKeyCombination","Duplicate handler ignored",this.cid,t,n)}}},uninstallKeyComboHandlers:function(){var e=W2._keyComboHandlers[this.cid]||[];for(var t=e.pop();t;t=e.pop()){keycombo.unbindKeyComboHandler(t[0],t[1])}},lookup:function(e,t){try{var i=_CIDLookup(this.cid,e);return _safeGetComponentByCID(i)}catch(n){if(!t){throw n}}},cQuery:function(e){var t;t=_cQueryByCID(this.cid,e);return _safeGetComponentByCID(t)},$:function(e){var t=this._my();if(typeof e==="string"){e=e.replace(/@/g,t);while(e.indexOf("%")!=-1){var i=W2._GROUP_RE.exec(e);if(i){var n=W2._groups[i[1]];if(typeof n==="undefined"){return $([])}e=e.replace(i[0],"#"+n.join(",#"))}}}return $(e)},_my:function(){return"__w2_"+this.cid+"_"},__children:function(){return W2._children[this.cid]},__allChildren:function(){return W2._allChildren[this.cid]},__parent:function(){return W2._parents[this.cid]},__knowsAbout:function(){return W2._knowsAbout[this.cid]},ge:function(e){return document.getElementById(e.replace("@",this._my()))},onLoad:function(e){},bindEvents:function(){var e=this.events;if(!e){return}for(var t in e){var i=t.indexOf(" ");if(i>-1){this.bindEvent(t.slice(0,i),t.slice(i+1),e[t])}}},bindEvent:function(e,t,i){var n=this;if(typeof i==="string"){i=n[i]}assert(typeof e==="string");assert(typeof t==="string");assert(typeof i==="function");n.$(t)[e](function(){if(log.enabled){log("webnode2.Component.bindEvent","On "+e+", invoking",i)}return i.apply(n,arguments)})},onUnload:function(){},onInsertNode:function(e,t){return true},onDeleteNode:function(e,t){return true},onUpdate:function(e){return true},serverCall:function(e){var t=coreComponent.parseVcon(this);if(t){if(log.enabled){log.trace("webnode2.Component.serverCall",e,t)}return new W2._ServerCall(t,e,this)}throw new W2Error("No vcon info for Component <cid="+this.cid+">")},bind:function(e,t){if("length"in this){throw new W2Error("Cannot bind an event for Component with length property",this)}$(this).bind(e,t)},trigger:function(e){$(this).trigger(e,Array.prototype.slice.call(arguments,1))}});var onLoadStatus={},ONLOAD_BEGUN=1,ONLOAD_DONE=2,onLoadCallbacks={},_my_exp=/^__w2_((?:[^_]+_)?[^_]+)/;function flushOnLoadCallbacks(e){var t,i=e.cid,n=onLoadCallbacks[i];if(n){n.reverse();while(t=n.pop()){t()}}}function cidFromMyId(e){var t=_my_exp.exec(e),i=t&&t[1];assert(!i||i in W2._components);return i}function onLoad(e,t){var i,n,o,s=[],r=require("w2.timing").timing;rec("webnode2","onLoad","start");for(i=0;i<e.length;i++){context.initComponent(e[i])}for(i=0;i<e.length;i++){o=e[i];onLoadStatus[o.cid]=ONLOAD_BEGUN;var a=+new Date;try{if(o.bindEvents){o.bindEvents()}o.onLoad(t);onLoadStatus[o.cid]=ONLOAD_DONE;flushOnLoadCallbacks(o)}catch(l){s.push({component:o,exception:l})}if(r.components){if(!r.components[o.cid]){r.components[o.cid]={}}r.components[o.cid].l=+new Date-a}}if(window.clearHandlers){window.clearHandlers()}rec("webnode2","onLoad","finish");if(s.length){var u=[];for(i=0;i<s.length;++i){var d=s[i].exception;n="hmac,"+s[i].component.__vcon+" : "+(d.stack?d.stack:d);u.push(n);log.error("webnode2.loadComponent",d)}$.serverLog(s.length+" component(s) threw during onLoad","ERROR",u.join("\n\n"));throw s[0].exception}return e}function onVisible(){var e,t,i=[],n,o=require("w2.timing").timing;for(e in W2._onVisibleComponents){t=W2._onVisibleComponents[e];if(t!=W2._components[e]){continue}var s=+new Date;try{t.onVisible()}catch(r){i.push({component:t,exception:r})}if(o.components){if(!o.components[e]){o.components[e]={}}o.components[e].v=+new Date-s}}if(n=i.length){$.serverLog(n+" component(s) threw during onVisible","ERROR",i);throw i}}function _CIDLookup(e,t){var i;if(e&&e!="*ROOT*"){require("assert").ok(W2._knowsAbout[e]);i=W2._knowsAbout[e][t];if(typeof i!="undefined"){return _cQueryByCID(e,i)}else{return _CIDLookup(W2._parents[e],t)}}else{return null}}VirtualComponent=Component.extend({__init__:function(e){this._super(e,null,{},{});this.isVirtual=true;context.initComponent(this)}});function _safeGetComponentByCID(e){var t;if(e){t=W2._components[e];if(!t){return new VirtualComponent(e)}else{return t}}else{return null}}function _cQueryByCID(e,t){var i,n,o,s,r,a,l,u,d,c;if(t=="."){return e}i=[];n="";o="first";for(s=0;s<t.length;s++){r=t.charAt(s);if(r=="."){i.push([o,n]);n="";o="child"}else if(r==":"){i.push([o,n]);n="";o="lookup"}else if(r=="<"){i.push([o,n]);n="";o="parent"}else{n+=r}}i.push([o,n]);a=e;for(s=0;s<i.length;s++){u=i[s];l=u[0];d=u[1];if(l=="first"){if(d){c=W2._children[a];if(!c){return null}a=c[d];if(!a){throw new W2Error("Couldn't find child '"+d+"' in cQuery '"+t+"'",e)}}if(!a){throw new W2Error("Started from an invalid node '"+a+"' in cQuery '"+t+"'",e)}}else if(l=="child"){c=W2._children[a];if(!c){return null}a=c[d];if(!a){throw new W2Error("Couldn't find child '"+d+"' in cQuery '"+t+"'",e)}}else if(l=="lookup"){a=_CIDLookup(a,d);if(!a){throw new W2Error("Lookup failed for '"+d+"' in cQuery '"+t+"'",e)}}else if(l=="parent"){a=W2._parents[a];if(!a||a=="*ROOT*"){throw new W2Error("No parent found in cQuery '"+t+"'",e)}}else{throw new W2Error("Bad token in Component query. '"+l+"'",e)}if(!a){throw new W2Error("Unknown Error in cQuery: '"+t+"'",e)}}return a}function W2Error(e,t){this.message=this.errorType+": "+e;if(t){this.message+=" <cid="+t+">"}}W2Error.prototype=new Error;W2Error.prototype.errorType="W2Error";W2Error.prototype.contstructor=W2Error;setContent=function(e,t){setContentHTML(e,t);setContentJS(e,t);return e};setContentHTML=function(e,t){e.innerHTML=t.html;return e};setContentJS=function(node,content){eval(content.js);return node};var unloadComponent=function(e){if(log.enabled){log("webnode2.unloadComponent","Unloading:",e)}var t;try{var i=W2._components[e];if(i!==undefined){try{i.onUnload();context.unloadComponent(i);if(i.uninstallKeyComboHandlers){i.uninstallKeyComboHandlers()}}catch(n){if(t===undefined){t=n}}}var o=W2._allChildren[e];while(o!==undefined&&o.length!==0){var s=o.pop();try{W2.unloadComponent(s)}catch(n){if(t===undefined){t=n}}}_removeComponentMetadata(e)}finally{W2._unloaded[e]=true;if(log.enabled){log("webnode2.unloadComponent","Unloaded:",e);validateUnload(e)}if(t!==undefined){throw t}}};W2.assertUnloaded=function(e){assert(e in W2._unloaded)};var validateUnload=function(e){var t=e in W2._componentGroups||e in W2._components||e in W2._parents||e in W2._allChildren||e in W2._children||e in W2._knowsAbout||e in W2._domids||e in W2._debugInfo||e in W2._onVisibleComponents||e in onLoadStatus||e in onLoadCallbacks;if(t&&log.enabled){log.error("webnode2.unloadComponent","Component unload checker has detected an error:",e,"wasn't cleaned up properly.")}};var newComponent=function(e,t,i,n,o,s,r){if(!e){throw Error("JS class specified by js_init not found: "+t)}else{return new e(i,n,o,s,r)}};W2.addParents=addParents;W2.addChildren=addChildren;W2.addLookups=addLookups;W2.addDebugInfo=addDebugInfo;W2.addLiveDepInfo=addLiveDepInfo;W2.addGroups=addGroups;W2.addDomids=addDomids;W2.addHmacs=addHmacs;W2.registerComponents=registerComponents;W2.getComponentFromElement=getComponentFromElement;W2.getLiveDomId=getLiveDomId;W2.getLiveDomElement=getLiveDomElement;W2.getLiveParent=getLiveParent;W2.getLiveChildren=getLiveChildren;W2.Component=Component;W2.VirtualComponent=VirtualComponent;W2.onLoad=onLoad;W2.onVisible=onVisible;W2.addComponentMetadata=addComponentMetadata;W2._safeGetComponentByCID=_safeGetComponentByCID;W2.W2Error=W2Error;W2.setContent=setContent;W2.setContentHTML=setContentHTML;W2.setContentJS=setContentJS;W2._removeComponentMetadata=_removeComponentMetadata;W2.unloadComponent=unloadComponent;W2.newComponent=newComponent;W2.C=W2._components;W2._stateEntries=stateEntries;W2._onLoadStatus=onLoadStatus;W2._onLoadCallbacks=onLoadCallbacks;function _assertIDs(e,t){if(e.nodeType!=3){if(e.id){if(e.id in t){assert(e===t[e.id])}t[e.id]=e}for(var i=e.firstChild;i;i=i.nextSibling){_assertIDs(i,t)}}return t}W2.assertAllIDsUnique=function(e){return _assertIDs(e||document.body,{})}})();exports.__W2_ExampleJSComponent=exports.Component.extend({init:function(e){this.dataFromPython=e},onLoad:function(){a1ert("Hello webnode2!")}})},{"w2.context":true,log:true,settings:true,"w2.timing":true,"core/component":true,visibility:true,assert:true,"w2.keycombo":true,Class:true});require.install("jquery.dialog",function(require,exports,module){var e=require("jquery");(function($){$.fn.dialog=function(e){return this.each(function(){new t(this,e)})};var e={id:"generic_dialog",title:"Title",contents:"",comment_form:"",mobile:null,buttons:{Ok:null,Cancel:null},class_:"",w:"w4"};$.dialog=function(t,i){var n=this;this.o=$(t);this.opts=$.extend({},e,i||{});this.mobile=this.opts.mobile!=null?this.opts.mobile:false;if($("#"+this.opts.id).length>0){$("#"+this.opts.id).show();return}if(this.opts.buttons!=null){if(this.opts.buttons["Ok"]===null){this.opts.buttons["Ok"]=function(){n.btnOk()}}if(this.opts.buttons["Cancel"]===null){this.opts.buttons["Cancel"]=function(){n.btnCancel()}}}if(this.opts.url){var o=this.opts.id+"_loading";var s=this.opts.contents||'<div style="overflow:hidden;"><span class="__wn2_loading"><span class="__wn2_loading_spinner"></span><span class="__wn2_loading_text">Loading...</span></span></div>';this.opts.contents='<div id="'+o+'"><div class="__wn2_loading_wrapper">'+s+"</div></div>";var r=this.opts.urlData||{},a=require("webnode2");r.___W2_scope="__dialog__";r.___W2_windowId=a.windowId;$.get(this.opts.url,r,function(e){var t=document.getElementById(o);a.setContent(t,e);setTimeout(function(){if(!n.mobile&&$(window).height()<600){$(".dialog .dialog_wrapper").css("position","static")}},10)},"json")}if(this.mobile){this.opts.w=""}this.render();return this};var t=$.dialog;t.fn=t.prototype={dialog:"0.0.1"};t.fn.extend=t.extend=$.extend;t.fn.extend({btnOk:function(){this.close()},btnCancel:function(){this.close()},close:function(){$("#"+this.opts.id).remove()},hide:function(){$("#"+this.opts.id).hide()},render:function(){var e="";if(this.opts.title){e=$("<div/>").addClass("dialog_wrapper").append($("<h2/>").addClass("dialog_frame").addClass("dialog_header").text(this.opts.title));if(this.opts.contents){e.append($("<div/>").addClass("dialog_frame").addClass("dialog_contents").html(this.opts.contents))}if(this.opts.comment_form!=""){e.append($("<div/>").addClass("dialog_frame").addClass("dialog_contents").append(this.renderCommentForm(this.opts.comment_form)))}}else{e=$("<div/>").addClass("dialog_component").html(this.opts.contents)}this.o.append($("<div/>").addClass("dialog").addClass(this.opts.w).addClass(this.opts.class_).attr("id",this.opts.id).append(e));if(this.opts.buttons!=null){$(".dialog_wrapper").append($("<div/>").addClass("dialog_frame").addClass("dialog_buttons").append($("<div/>").addClass("dialog_buttons_contents").html(this.renderButtons())))}if(this.mobile){var t=$(window).width();window.scrollTo(0,1);$(".dialog").css("top","0px");$(".dialog").css("left","10px");$(".dialog").css("width",parseInt(t)-25+"px")}else{var i=150;var n=$(window).width()/2-$(".dialog").width()/2;$(".dialog").css("top",i+"px");$(".dialog").css("left",n+"px")}if(this.opts.comment_form!=""){$("#dialog_comment").focus()}var o=this;$(document).keydown(function(e){return o.keydown(e)});return false},keydown:function(e){var t=e||window.event;if(t.keyCode==27){this.close();$(document).unbind();return false}},renderCommentForm:function(e){if(!e||e==""){e="Add a Comment"}return $("<div/>").append($("<h3/>").text(e+":")).append($("<textarea/>").attr("id","dialog_comment"))},renderButtons:function(){var e=this,t=$("<div/>");$.each(this.opts.buttons,function(i,n){var o="submit_button";if(i=="Cancel"){o="cancel"}else if(i=="Close"){o="action_button"}var s=$("<a/>").addClass("dialog_button").addClass(o).attr("id",i).html(i).click(n);if(e.opts.buttons_hide_on_close){s=s.click(function(){e.hide()})}else{s=s.click(function(){e.close()})}t.append(s)});return t}})})(e)},{jquery:true,webnode2:true});require.install("jquery.tooltip",function(require,exports,module){var e=require("jquery"),t=require("settings");(function($){$.fn.tooltip=function(e){return this.each(function(){new t(this,e)})};var e={id:"tooltip",contents:"",delay:75,class_:"tooltip",parent_class:"tooltip_parent",direction:"top",prepend:false,align_center:true};$.tooltip=function(t,i){if($("body").hasClass("mobile")){return}var n=this;this.o=$(t);this.opts=$.extend({},e,i||{});var n=this;this.o.hover(function(){n.render()},function(){n.close()})};var t=$.tooltip;t.fn=t.prototype={tooltip:"0.0.1"};t.fn.extend=t.extend=$.extend;t.fn.extend({to:null,btnOk:function(){this.close()},btnCancel:function(){this.close()},close:function(){clearTimeout(this.to);this.to=null;this.tt=null;this.o.removeClass(this.opts.parent_class);$("."+this.opts.class_).remove()},render:function(){var e=this.opts.parent_class;$("."+e).removeClass(e);$("."+this.opts.class_).remove();var t=50;var i=this.o.offset().top<t||this.opts.direction=="bottom";if(i)this.set_tooltip_bottom();else this.set_tooltip();this.o.addClass(e);if(this.opts.prepend){this.o.prepend(this.tt)}else{this.o.append(this.tt)}this.tt.hide();var n=this.tt.height()+5;var o=this.o.height()+5;this.tt.css("display","block");var s=this.tt.find(".tooltip_contents").outerWidth();this.tt.css("display","none");var r=this.o.outerWidth();if(i)this.tt.css("top",o+"px");else this.tt.css("top","-"+n+"px");if(this.opts.align_center){this.tt.css("left",(r-s)/2+"px")}else{this.tt.css("left","-16px")}var a=this;var l=function(){a.tt.show()};this.to=setTimeout(l,this.opts.delay)},set_tooltip:function(){this.tt=$("<div/>").addClass(this.opts.class_).append($("<div/>").addClass("tooltip_contents nub_bottom").append($("<span/>").text(this.opts.contents)))},set_tooltip_bottom:function(){this.tt=$("<div/>").addClass(this.opts.class_).append($("<div/>").addClass("tooltip_contents nub_top").append($("<span/>").text(this.opts.contents)))}})})(e)},{jquery:true,settings:true});require.install("jquery.menu",function(require,exports,module){var e=require("settings"),t=require("jquery");(function($){$.fn.menu=function(e,t){return this.each(function(){new $.menu(this,e,t)})};var e={id:"generic_menu",open:false,url:null,list_items:{},position_adjust:null,align_right:false,close_on_click:true,close_other_menus_on_click:false};$.menu=function(t,i,n){this.o=$(t);this.handle=i;this.opts=$.extend({},e,n||{});this.render();var o=this;$(document).click(function(e){if($(e.target).parents(".menu").length===0){o.close(e)}});if(this.opts.close_on_click){$(".menu_list_item a").click(function(e){o.close(e)})}$(".menu_list_item a.close_on_click").click(function(e){o.close(e)});return false};$.menu.fn=$.menu.prototype={menu:"0.0.1"};$.menu.fn.extend=$.menu.extend=$.extend;$.menu.fn.extend({close:function(e){var t=this;t.o.addClass("animate_out");setTimeout(function(){t.o.addClass("hidden");t.o.removeClass("animate_out");if(e!==undefined){$(e.target).parent().siblings().removeClass("selected");$(e.target).parent().addClass("selected")}},150)},render:function(){if($("#"+this.opts.id).length>0){return false}if(!this.o.hasClass("hidden")){this.close()}if(this.opts.close_other_menus_on_click){var e=this.o.attr("id");$(".menu:not(#"+e+")").addClass("hidden")}if(this.opts.url){var t=this;this.o.append($("<div/>").addClass("menu").attr("id",this.opts.id).setContentFromAJAXComponent(this.opts.url,this.opts.pars))}else{this.position();this.o.removeClass("hidden")}},position:function(){var e=this.handle.position();e.top-=1;e.left-=3;var t=this.handle.innerHeight();var i=$(window).height();var n=180;var o=this.handle.offset().top-$(window).scrollTop();var s=i-o<n;if(s){e.top-=this.o.height();e.top-=t*2;e.top+=16}if(this.opts.position_adjust){e.top+=this.opts.position_adjust.top;e.left+=this.opts.position_adjust.left}if(this.opts.align_right){e.left-=this.o.width()-this.handle.innerWidth()}this.o.css("top",e.top+t+"px");this.o.css("left",e.left+"px")}})})(t)},{jquery:true,settings:true});require.install("jquery.topic",function(require,exports,module){jQuery.addTempTopic=function(e){this.id=e;this.topic_name=$("#"+e).val();$(".topic_placeholder").addClass("hidden");$(".topics_list").append($("<li/>").append($("<a/>").attr("href","#").attr("class","topic_name").text(this.topic_name)).append($("<a/>").attr("href","#").attr("class","topic_remove").text("").click(function(){$(this).parent().remove();return false})).attr("class","topic_list_item"));$("#"+e).val("");return false}},{});require.install("jquery.viewport",function(require,exports,module){(function($){$.belowthefold=function(e,t){var i=$(t.container).height()+$(t.container).scrollTop();return i<=$(e).offset().top-t.threshold};$.abovethetop=function(e,t){var i=$(t.container).scrollTop();return i>=$(e).offset().top+$(e).height()-t.threshold};$.rightofscreen=function(e,t){var i=$(t.container).width()+$(t.container).scrollLeft();return i<=$(e).offset().left-t.threshold};$.leftofscreen=function(e,t){var i=$(t.container).scrollLeft();return i>=$(e).offset().left+$(e).width()-t.threshold};$.inviewport=function(e,t){return!$.rightofscreen(e,t)&&!$.leftofscreen(e,t)&&!$.belowthefold(e,t)&&!$.abovethetop(e,t)};$.extend($.expr[":"],{"below-the-fold":function(e,t,i){return $.belowthefold(e,{threshold:0,container:window})},"above-the-top":function(e,t,i){return $.abovethetop(e,{threshold:0,container:window})},"left-of-screen":function(e,t,i){return $.leftofscreen(e,{threshold:0,container:window})},"right-of-screen":function(e,t,i){return $.rightofscreen(e,{threshold:0,container:window})},"in-viewport":function(e,t,i){return $.inviewport(e,{threshold:0,container:window})}})})(require("jquery"))},{jquery:true});require.install("jquery.whenIdle",function(require,exports,module){var e=require("jquery");(function(e,$,t){var i=e.log,n=2e3,o=false,s=false,r=false,a=[],l=[];var u=function(e){for(var t=0;t<e.length;t++)setTimeout(e[t],0);e.length=0};$(document).ready(function(){if(i&&i.enabled)i("jquery.whenIdle","Ready event fired.");o=true;setTimeout(function(){if(i&&i.enabled)i("jquery.whenIdle","Idle event fired, flushing queue.");s=true;u(a)},n)});if(document.readyState=="complete")setTimeout(function(){if(i&&i.enabled)i("jquery.whenIdle","Load event has already fired, flushing queue.");r=true;u(a);u(l)},0);else $(window).load(function(){if(i&&i.enabled)i("jquery.whenIdle","Load event fired, flushing queue.");r=true;u(a);u(l)});$.whenIdle=function(e,t,n,l){if(e==null||e<0)e=0;if($.isFunction(t)){l=n;n=t;t=null}if(t!=null&&e>t)throw"minDelay > maxDelay.";if(i&&i.enabled&&l)i("jquery.whenIdle.whenIdle","Scheduling",l,"; delays: min =",e,"max =",t);var u=false,d=function(){if(u)return;u=true;if(i&&i.enabled&&l)i("jquery.whenIdle.whenIdle","Executing",l);n()};if(s||r){setTimeout(d,0);return}if(o){setTimeout(d,e);return}a.push(d);$(document).ready(function(){setTimeout(d,e)});if(t!=null)setTimeout(d,t)};$.whenLoaded=function(e,t,n,o){if(e==null||e<0)e=0;if($.isFunction(t)){o=n;n=t;t=null}if(t!=null&&e>t)throw"minDelay > maxDelay.";if(i&&i.enabled&&o)i("jquery.whenIdle.whenLoaded","Scheduling",o,"; delays: min =",e,"max =",t);var s=false,a=function(){if(s)return;s=true;if(i&&i.enabled&&o)i("jquery.whenIdle.whenLoaded","Executing",o);n()};if(r){setTimeout(a,0);return}l.push(a);$(window).load(function(){setTimeout(a,e)});if(t!=null)setTimeout(a,t)}})(this,e)},{jquery:true});require.install("jquery.ajax",function(require,exports,module){var e=require("jquery");(function($){var e=["async","beforeSend","beforeComplete","beforeSuccess","beforeError","cache","complete","contentType","data","dataFilter","dataType","error","global","ifModified","jsonp","password","processData","scriptCharset","success","timeout","type","url","username","xhr"];var t={};$.each(e,function(e,i){t[i]=function(e){this.__options[i]=e;return this};t["_"+i]=function(){return this.__options[i]}});t._options=function(){var t={},i=this;$.each(e,function(e,n){t[n]=i["_"+n]()});return t};t.options=function(e){if(e){var t=this;$.each(e,function(e,i){t[e](i)})}return this};t.__init__=function(e){this.__options={data:null};this.options(e);return this};t.send=function(e){return this._send(e)};t._send=function(e){this.options(e);var t=this._options();var i=t.complete;var n=t.error;var o=t.success;t.complete=function(){try{if(t.beforeComplete!=null)t.beforeComplete.apply(this,arguments)}finally{if(i!=null)i.apply(this,arguments)}};t.error=function(){try{if(t.beforeError!=null)t.beforeError.apply(this,arguments)}finally{if(n!=null)n.apply(this,arguments)}};t.success=function(){try{if(t.beforeSuccess!=null)t.beforeSuccess.apply(this,arguments)}finally{if(o!=null)o.apply(this,arguments)}};return $.ajax(t)};$.Ajax=require("Class").Class.extend(t)})(e)},{jquery:true,Class:true});require.install("effects.core",function(require,exports,module){var e=require("jquery");e.effects||function($){$.effects={version:"1.7.2",save:function(e,t){for(var i=0;i<t.length;i++){if(t[i]!==null)e.data("ec.storage."+t[i],e[0].style[t[i]])}},restore:function(e,t){for(var i=0;i<t.length;i++){if(t[i]!==null)e.css(t[i],e.data("ec.storage."+t[i]))}},setMode:function(e,t){if(t=="toggle")t=e.is(":hidden")?"show":"hide";return t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var t={width:e.outerWidth(true),height:e.outerHeight(true),"float":e.css("float")};e.wrap('<div class="ui-effects-wrapper" style="font-size:100%;background:transparent;border:none;margin:0;padding:0"></div>');var i=e.parent();if(e.css("position")=="static"){i.css({position:"relative"});e.css({position:"relative"})}else{var n=e.css("top");if(isNaN(parseInt(n,10)))n="auto";var o=e.css("left");if(isNaN(parseInt(o,10)))o="auto";i.css({position:e.css("position"),top:n,left:o,zIndex:e.css("z-index")}).show();e.css({position:"relative",top:0,left:0})}i.css(t);return i},removeWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent().replaceWith(e);return e},setTransition:function(e,t,i,n){n=n||{};$.each(t,function(t,o){var s=e.cssUnit(o);if(s[0]>0)n[o]=s[0]*i+s[1]});return n},animateClass:function(e,t,i,n){var o=typeof i=="function"?i:n?n:null;var s=typeof i=="string"?i:null;return this.each(function(){var i={};var n=$(this);var r=n.attr("style")||"";if(typeof r=="object")r=r["cssText"];if(e.toggle){n.hasClass(e.toggle)?e.remove=e.toggle:e.add=e.toggle}var a=$.extend({},document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle);if(e.add)n.addClass(e.add);if(e.remove)n.removeClass(e.remove);var l=$.extend({},document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle);if(e.add)n.removeClass(e.add);if(e.remove)n.addClass(e.remove);for(var u in l){if(typeof l[u]!="function"&&l[u]&&u.indexOf("Moz")==-1&&u.indexOf("length")==-1&&l[u]!=a[u]&&(u.match(/color/i)||!u.match(/color/i)&&!isNaN(parseInt(l[u],10)))&&(a.position!="static"||a.position=="static"&&!u.match(/left|top|bottom|right/)))i[u]=l[u]}n.animate(i,t,s,function(){if(typeof $(this).attr("style")=="object"){$(this).attr("style")["cssText"]="";$(this).attr("style")["cssText"]=r}else $(this).attr("style",r);if(e.add)$(this).addClass(e.add);if(e.remove)$(this).removeClass(e.remove);if(o)o.apply(this,arguments)})})}};function e(e,t){var i=e[1]&&e[1].constructor==Object?e[1]:{};if(t)i.mode=t;var n=e[1]&&e[1].constructor!=Object?e[1]:i.duration?i.duration:e[2];n=$.fx.off?0:typeof n==="number"?n:$.fx.speeds[n]||$.fx.speeds._default;var o=i.callback||$.isFunction(e[1])&&e[1]||$.isFunction(e[2])&&e[2]||$.isFunction(e[3])&&e[3];return[e[0],i,n,o]}$.fn.extend({_show:$.fn.show,_hide:$.fn.hide,__toggle:$.fn.toggle,_addClass:$.fn.addClass,_removeClass:$.fn.removeClass,_toggleClass:$.fn.toggleClass,effect:function(e,t,i,n){return $.effects[e]?$.effects[e].call(this,{method:e,options:t||{},duration:i,callback:n}):null},show:function(){if(!arguments[0]||(arguments[0].constructor==Number||/(slow|normal|fast)/.test(arguments[0])))return this._show.apply(this,arguments);else{return this.effect.apply(this,e(arguments,"show"))}},hide:function(){if(!arguments[0]||(arguments[0].constructor==Number||/(slow|normal|fast)/.test(arguments[0])))return this._hide.apply(this,arguments);else{return this.effect.apply(this,e(arguments,"hide"))}},toggle:function(){if(!arguments[0]||(arguments[0].constructor==Number||/(slow|normal|fast)/.test(arguments[0]))||($.isFunction(arguments[0])||typeof arguments[0]=="boolean")){return this.__toggle.apply(this,arguments)}else{return this.effect.apply(this,e(arguments,"toggle"))}},addClass:function(e,t,i,n){return t?$.effects.animateClass.apply(this,[{add:e},t,i,n]):this._addClass(e)},removeClass:function(e,t,i,n){return t?$.effects.animateClass.apply(this,[{remove:e},t,i,n]):this._removeClass(e)},toggleClass:function(e,t,i,n){return typeof t!=="boolean"&&t?$.effects.animateClass.apply(this,[{toggle:e},t,i,n]):this._toggleClass(e,t)},morph:function(e,t,i,n,o){return $.effects.animateClass.apply(this,[{add:t,remove:e},i,n,o])},switchClass:function(){return this.morph.apply(this,arguments)},cssUnit:function(e){var t=this.css(e),i=[];$.each(["em","px","%","pt"],function(e,n){if(t.indexOf(n)>0)i=[parseFloat(t),n]});return i}});$.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(e,n){$.fx.step[n]=function(e){if(e.state==0){e.start=i(e.elem,n);e.end=t(e.end)}else{if(typeof e.start=="number")e.start=[e.start,e.start,e.start];if(typeof e.end=="number")e.end=[e.end,e.end,e.end]}e.elem.style[n]="rgb("+[Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0],10),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1],10),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2],10),255),0)].join(",")+")"}});function t(e){var t;if(e&&e.constructor==Array&&e.length==3)return e;if(t=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)];if(t=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))return[parseFloat(t[1])*2.55,parseFloat(t[2])*2.55,parseFloat(t[3])*2.55];if(t=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)];if(t=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];if(t=/rgba\(0, 0, 0, 0\)/.exec(e))return n["transparent"];return n[$.trim(e).toLowerCase()]}function i(e,i){var n;do{n=$.curCSS(e,i);if(n!=""&&n!="transparent"||$.nodeName(e,"body"))break;i="backgroundColor"}while(e=e.parentNode);return t(n)}var n={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};$.easing.jswing=$.easing.swing;$.extend($.easing,{def:"easeOutQuad",swing:function(e,t,i,n,o){return $.easing[$.easing.def](e,t,i,n,o)},easeInQuad:function(e,t,i,n,o){return n*(t/=o)*t+i},easeOutQuad:function(e,t,i,n,o){return-n*(t/=o)*(t-2)+i},easeInOutQuad:function(e,t,i,n,o){if((t/=o/2)<1)return n/2*t*t+i;return-n/2*(--t*(t-2)-1)+i},easeInCubic:function(e,t,i,n,o){return n*(t/=o)*t*t+i},easeOutCubic:function(e,t,i,n,o){return n*((t=t/o-1)*t*t+1)+i},easeInOutCubic:function(e,t,i,n,o){if((t/=o/2)<1)return n/2*t*t*t+i;return n/2*((t-=2)*t*t+2)+i},easeInQuart:function(e,t,i,n,o){return n*(t/=o)*t*t*t+i},easeOutQuart:function(e,t,i,n,o){return-n*((t=t/o-1)*t*t*t-1)+i},easeInOutQuart:function(e,t,i,n,o){if((t/=o/2)<1)return n/2*t*t*t*t+i;return-n/2*((t-=2)*t*t*t-2)+i},easeInQuint:function(e,t,i,n,o){return n*(t/=o)*t*t*t*t+i},easeOutQuint:function(e,t,i,n,o){return n*((t=t/o-1)*t*t*t*t+1)+i},easeInOutQuint:function(e,t,i,n,o){if((t/=o/2)<1)return n/2*t*t*t*t*t+i;return n/2*((t-=2)*t*t*t*t+2)+i},easeInSine:function(e,t,i,n,o){return-n*Math.cos(t/o*(Math.PI/2))+n+i},easeOutSine:function(e,t,i,n,o){return n*Math.sin(t/o*(Math.PI/2))+i},easeInOutSine:function(e,t,i,n,o){return-n/2*(Math.cos(Math.PI*t/o)-1)+i},easeInExpo:function(e,t,i,n,o){return t==0?i:n*Math.pow(2,10*(t/o-1))+i},easeOutExpo:function(e,t,i,n,o){return t==o?i+n:n*(-Math.pow(2,-10*t/o)+1)+i},easeInOutExpo:function(e,t,i,n,o){if(t==0)return i;if(t==o)return i+n;if((t/=o/2)<1)return n/2*Math.pow(2,10*(t-1))+i;return n/2*(-Math.pow(2,-10*--t)+2)+i},easeInCirc:function(e,t,i,n,o){return-n*(Math.sqrt(1-(t/=o)*t)-1)+i},easeOutCirc:function(e,t,i,n,o){return n*Math.sqrt(1-(t=t/o-1)*t)+i},easeInOutCirc:function(e,t,i,n,o){if((t/=o/2)<1)return-n/2*(Math.sqrt(1-t*t)-1)+i;return n/2*(Math.sqrt(1-(t-=2)*t)+1)+i},easeInElastic:function(e,t,i,n,o){var s=1.70158;var r=0;var a=n;if(t==0)return i;
if((t/=o)==1)return i+n;if(!r)r=o*.3;if(a<Math.abs(n)){a=n;var s=r/4}else var s=r/(2*Math.PI)*Math.asin(n/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*o-s)*(2*Math.PI)/r))+i},easeOutElastic:function(e,t,i,n,o){var s=1.70158;var r=0;var a=n;if(t==0)return i;if((t/=o)==1)return i+n;if(!r)r=o*.3;if(a<Math.abs(n)){a=n;var s=r/4}else var s=r/(2*Math.PI)*Math.asin(n/a);return a*Math.pow(2,-10*t)*Math.sin((t*o-s)*(2*Math.PI)/r)+n+i},easeInOutElastic:function(e,t,i,n,o){var s=1.70158;var r=0;var a=n;if(t==0)return i;if((t/=o/2)==2)return i+n;if(!r)r=o*(.3*1.5);if(a<Math.abs(n)){a=n;var s=r/4}else var s=r/(2*Math.PI)*Math.asin(n/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*o-s)*(2*Math.PI)/r))+i;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*o-s)*(2*Math.PI)/r)*.5+n+i},easeInBack:function(e,t,i,n,o,s){if(s==undefined)s=1.70158;return n*(t/=o)*t*((s+1)*t-s)+i},easeOutBack:function(e,t,i,n,o,s){if(s==undefined)s=1.70158;return n*((t=t/o-1)*t*((s+1)*t+s)+1)+i},easeInOutBack:function(e,t,i,n,o,s){if(s==undefined)s=1.70158;if((t/=o/2)<1)return n/2*(t*t*(((s*=1.525)+1)*t-s))+i;return n/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+i},easeInBounce:function(e,t,i,n,o){return n-$.easing.easeOutBounce(e,o-t,0,n,o)+i},easeOutBounce:function(e,t,i,n,o){if((t/=o)<1/2.75){return n*(7.5625*t*t)+i}else if(t<2/2.75){return n*(7.5625*(t-=1.5/2.75)*t+.75)+i}else if(t<2.5/2.75){return n*(7.5625*(t-=2.25/2.75)*t+.9375)+i}else{return n*(7.5625*(t-=2.625/2.75)*t+.984375)+i}},easeInOutBounce:function(e,t,i,n,o){if(t<o/2)return $.easing.easeInBounce(e,t*2,0,n,o)*.5+i;return $.easing.easeOutBounce(e,t*2-o,0,n,o)*.5+n*.5+i}})}(e)},{jquery:true});require.install("effects.shake",function(require,exports,module){(function($){$.effects.shake=function(e){return this.queue(function(){var t=$(this),i=["position","top","left"];var n=$.effects.setMode(t,e.options.mode||"effect");var o=e.options.direction||"left";var s=e.options.distance||20;var r=e.options.times||3;var a=e.duration||e.options.duration||140;$.effects.save(t,i);t.show();$.effects.createWrapper(t);var l=o=="up"||o=="down"?"top":"left";var u=o=="up"||o=="left"?"pos":"neg";var d={},c={},h={};d[l]=(u=="pos"?"-=":"+=")+s;c[l]=(u=="pos"?"+=":"-=")+s*2;h[l]=(u=="pos"?"-=":"+=")+s*2;t.animate(d,a,e.options.easing);for(var f=1;f<r;f++){t.animate(c,a,e.options.easing).animate(h,a,e.options.easing)}t.animate(c,a,e.options.easing).animate(d,a/2,e.options.easing,function(){$.effects.restore(t,i);$.effects.removeWrapper(t);if(e.callback)e.callback.apply(this,arguments)});t.queue("fx",function(){t.dequeue()});t.dequeue()})}})(jQuery)},{});require.install("effects.highlight",function(require,exports,module){(function($){$.effects.highlight=function(e){return this.queue(function(){var t=$(this),i=["backgroundImage","backgroundColor","opacity"];var n=$.effects.setMode(t,e.options.mode||"show");var o=e.options.color||"#ffff99";var s=t.css("backgroundColor");$.effects.save(t,i);t.show();t.css({backgroundImage:"none",backgroundColor:o});var r={backgroundColor:s};if(n=="hide")r["opacity"]=0;t.animate(r,{queue:false,duration:e.duration,easing:e.options.easing,complete:function(){if(n=="hide")t.hide();$.effects.restore(t,i);if(n=="show"&&$.browser.msie)this.style.removeAttribute("filter");if(e.callback)e.callback.apply(this,arguments);t.dequeue()}})})}})(jQuery)},{});require.install("ytplayer",function(require,exports,module){exports.getYTPlayerStatuses=function(e,t){var i=[];e.find(".qtext_embed iframe").each(function(e,n){var o=$(n).attr("id");var s=$(n).parent().attr("data-yt-id");$.each(window.YT.players,function(e,t){if(t.playerId==o){var n=t.player.getCurrentTime();i.push({ytId:s,time:n,state:t.state})}});if(t){t(n)}});return i};exports.restoreYTPlayerStatuses=function(e,t){$.each(t,function(t,i){var n=e.find('.qtext_embed[data-yt-id="'+i.ytId+'"]');if(!n.size()){return}n=n.get(0);$(n).click();$.each(window.YT.players,function(e,t){if(t.playerId==$(n).find("iframe").attr("id")){t.onReady=function(e){e.player.seekTo(i.time);if(i.state==window.YT.PlayerState.PAUSED||i.state==window.YT.PlayerState.ENDED){e.player.pauseVideo()}}}})})}},{});require.install("browser",function(require,exports,module){(function(e,t){if(typeof module!="undefined"&&module.exports)module.exports["browser"]=t()})("bowser",function(){var e=true;function t(t){function i(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}var n=i(/(ipod|iphone|ipad)/i).toLowerCase(),o=/like android/i.test(t),s=!o&&/android/i.test(t),r=i(/version\/(\d+(\.\d+)?)/i),a=/tablet/i.test(t),l=!a&&/[^-]mobi/i.test(t),u;if(/opera|opr/i.test(t)){u={name:"Opera",opera:e,version:r||i(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}}else if(/windows phone/i.test(t)){u={name:"Windows Phone",windowsphone:e,msie:e,version:i(/iemobile\/(\d+(\.\d+)?)/i)}}else if(/msie|trident/i.test(t)){u={name:"Internet Explorer",msie:e,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}}else if(/chrome|crios|crmo/i.test(t)){u={name:"Chrome",chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(n){u={name:n=="iphone"?"iPhone":n=="ipad"?"iPad":"iPod"};if(r){u.version=r}}else if(/sailfish/i.test(t)){u={name:"Sailfish",sailfish:e,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}}else if(/seamonkey\//i.test(t)){u={name:"SeaMonkey",seamonkey:e,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}}else if(/firefox|iceweasel/i.test(t)){u={name:"Firefox",firefox:e,version:i(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)};if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)){u.firefoxos=e}}else if(/silk/i.test(t)){u={name:"Amazon Silk",silk:e,version:i(/silk\/(\d+(\.\d+)?)/i)}}else if(s){u={name:"Android",version:r}}else if(/phantom/i.test(t)){u={name:"PhantomJS",phantom:e,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}}else if(/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)){u={name:"BlackBerry",blackberry:e,version:r||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}}else if(/(web|hpw)os/i.test(t)){u={name:"WebOS",webos:e,version:r||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(t)&&(u.touchpad=e)}else if(/bada/i.test(t)){u={name:"Bada",bada:e,version:i(/dolfin\/(\d+(\.\d+)?)/i)}}else if(/tizen/i.test(t)){u={name:"Tizen",tizen:e,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||r}}else if(/safari/i.test(t)){u={name:"Safari",safari:e,version:r}}else u={};if(/(apple)?webkit/i.test(t)){u.name=u.name||"Webkit";u.webkit=e;if(!u.version&&r){u.version=r}}else if(!u.opera&&/gecko\//i.test(t)){u.name=u.name||"Gecko";u.gecko=e;u.version=u.version||i(/gecko\/(\d+(\.\d+)?)/i)}if(s||u.silk){u.android=e}else if(n){u[n]=e;u.ios=e}var d="";if(n){d=i(/os (\d+([_\s]\d+)*) like mac os x/i);d=d.replace(/[_\s]/g,".")}else if(s){d=i(/android[ \/-](\d+(\.\d+)*)/i)}else if(u.windowsphone){d=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i)}else if(u.webos){d=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i)}else if(u.blackberry){d=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i)}else if(u.bada){d=i(/bada\/(\d+(\.\d+)*)/i)}else if(u.tizen){d=i(/tizen[\/\s](\d+(\.\d+)*)/i)}if(d){u.osversion=d}var c=d.split(".")[0];if(a||n=="ipad"||s&&(c==3||c==4&&!l)||u.silk){u.tablet=e}else if(l||n=="iphone"||n=="ipod"||s||u.blackberry||u.webos||u.bada){u.mobile=e}if(u.msie&&u.version>=10||u.chrome&&u.version>=20||u.firefox&&u.version>=20||u.safari&&u.version>=6||u.opera&&u.version>=10||u.ios&&u.osversion&&u.osversion.split(".")[0]>=6||u.blackberry&&u.version>=10.1){u.a=e}else if(u.msie&&u.version<10||u.chrome&&u.version<20||u.firefox&&u.version<20||u.safari&&u.version<6||u.opera&&u.version<10||u.ios&&u.osversion&&u.osversion.split(".")[0]<6){u.c=e}else u.x=e;u.version=parseFloat(u.version);return u}var i=t(typeof navigator!=="undefined"?navigator.userAgent:"");i._detect=t;return i})},{browser:true});require.install("lang/fun",function(require,exports,module){var slice=Array.prototype.slice,mustOverrideToString=window.log&&window.log.enabled;exports.bind=function(e,t){var i=slice.call(arguments,2),n=i.length>0?function(){return o.apply(e||this,i.concat(slice.call(arguments,0)))}:function(){return o.apply(e||this,arguments)},o=t;n.name=t.name;if(mustOverrideToString){n.toString=function(){return"["+t+" bound with "+e+" and with args "+i+" partially applied]"}}if(typeof t.apply=="undefined"){o=wrapDumbFunction(t)}return n};function wrapDumbFunction(f){return function(){switch(arguments.length){case 0:return f();case 1:return f(arguments[0]);case 2:return f(arguments[0],arguments[1]);case 3:return f(arguments[0],arguments[1],arguments[2]);case 4:return f(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}for(var i=0,args=[];i<arguments.length;i++){args.push("arguments["+i+"]")}return eval("(f("+args.join(",")+"))")}}function expect(e,t){var i=[];function n(e,t){if(typeof e==="number"&&e>=0&&!(e in i)){i[e]=t}}function o(){--e;if(e===0){t.apply(this,i)}}o.args=function(){var e=this,t=arguments;return function(){n(e.valueOf(),this);for(var i=0,s=t.length;i<s;++i){n(t[i],arguments[i])}o()}};return o}exports.expect=expect},{});require.install("w2.errors",function(require,exports,module){(function(e,t){var i=1e3*60*10;var n=2e3;var o=50;var s=5e3;var r=require("log").log,a=require("webnode2"),$=require("jquery"),l=require("settings"),u=new Date(0),d=0,c=0;function h(e,n,s,a,d){var c=e.status===0;if(c){setTimeout(function(){if(!g()){f("Internet connection problem. ")}},1e3);return}if(r.enabled){r("w2.errors.reportAjaxError","Error:",e.status,s,", XHR: ",e)}if(Math.random()*100<l.client_side_server_call_error_logging_percentage){if(new Date-u>=i){u=new Date;if(r.enabled){r("w2.errors.reportAjaxError","Forwarding error log entry to server.")}var h=e.responseText||"";if(h.length>2048){h=h.substr(0,2048)+"... (TRUNCATED)"}$.serverLog("AJAX request failed: "+e.status.toString()+", "+s+"; response: "+h)}}if(d!==t){var p=(new Date).getTime()-d;if(p>o){a=false}}if(a){f()}}function f(e){if(!a.Error){return}a.Error.show(e)}function p(e){d++;setTimeout(function(){d--},e)}function g(){return d!==0}function _(e){c++;setTimeout(function(){c--},e)}function m(){return c!==0}$(window).on("unload.w2errors beforeunload.w2errors",function(){if(r.enabled){r("w2.errors.unload","window.beforeunload event is raised.")}p(n)});$(document).on("mouseup.w2errors mousedown.w2errors keyup.w2errors "+"keydown.w2errors keypress.w2errors",function(){_(o)});exports.reportAjaxError=h;exports.showError=f;exports.canBeRelatedToUserAction=m;exports.canBeRelatedToPageUnload=g;exports.beginCanBeRelatedToUserActionBlock=_})(this)},{webnode2:true,jquery:true,log:true,settings:true});require.install("w2.perf",function(require,exports,module){var e=require("webnode2"),t=require("settings");var i={},n=5e3,o=3e4;function s(i){if(Math.random()>t.e2e_sample_rate){return}if(t.instart_cchannel_setting){i.instart_cchannel_setting=true}$.whenLoaded(500,function(){e.rpc("/e2e/perf_POST").args(i).send()},"w2.perf_post.report")}exports.startPOST=function(e){if(e===null||typeof e==="undefined"){throw"This method expects an object describing the action."}e.startTime=(new Date).getTime();i[e.id]=e;return e};exports.finishPOST=function(e){var t=i[e];if(t===undefined){return null}t.endTime=(new Date).getTime();delete i[e];s(t);return t};function r(){var e=(new Date).getTime();for(var t in i){var n=i[t];if(e-n.startTime>=o){delete i[t];n.endTime=e;n.timeout=true;s(n)}}}setInterval(r,n)},{webnode2:true,settings:true});require.install("e2e",function(require,exports,module){require("jquery.whenIdle");var e=require("log").log,t=require("webnode2"),i=require("settings"),n=require;exports.SAMPLE_RATE=i.e2e_sample_rate;function o(e,t,i){e=e||rec.dump();for(var n=0,o=e.length;n<o;++n){if(t.call(i,e[n],n)==="break"){return}}}function s(e,t){return function(i){var n={},s={};o(i,function(i){var o=i.tags,r=o[0],a=o[1],l=o[2];if(r==="window.performance"&&a==="loadEventEnd"){return"break"}if(r===e&&(!t||a===t)){if(l==="start"){n[a]=i.time}else if(l==="finish"){s[a]=(s[a]||0)+i.time-n[a]}}});return s}}var r=s("package"),a=s("webnode2","onLoad"),l=s("loader","flushQueue");exports.reportPageData=function(i,o){if(i===null){return}if(!i.mustReport){return}delete i.mustReport;var s=require("w2.timing"),u=s.timing,d=window.performance;var c=$.extend(i,{win_perf:{path:location.pathname,revision:require("settings").revision,controller:require("settings").controller,action:require("settings").action,server_time:u.server_time,window_id:u.window_id},w2_timing:u});if(d&&d.timing&&d.timing.responseStart){c.win_perf.timing=d.timing}function h(){if(d&&d.timing){var i=d.timing;if(i.loadEventEnd===0){setTimeout(h,250);return}var o=c.win_perf.timing={};for(var f in i){var p=i[f];if(typeof p==="number"){o[f]=p}}}var g=rec.dump();c.win_perf.quora={packages:r(g),onLoads:a(g).onLoad,flushQueues:l(g).flushQueue,referrer:document.referrer};if(u._component_inspector_enabled){var _=n("w2.inspector");if(_.isRequestTimeSlowerThanStandard()){c.slow_load={platform:"desktop",user_agent:navigator.userAgent,path:location.pathname,controller:require("settings").controller,action:require("settings").action,window_id:u.window_id,page_time:u.page,request_time:u.request,load_time:d.timing.loadEventStart-d.timing.navigationStart}}}s.stop();$.whenIdle(100,function(){if(e.enabled){var i=c.win_perf.timing,n=i.loadEventStart-i.navigationStart,o=c.win_perf.server_time;e("e2e.reportPageData","Metric:",n,"Server time:",o,"Details:",c)}t.rpc("/e2e/page_data_POST").args(c).send()},"e2e.reportPageData");if(!u._component_inspector_enabled){delete u.components;delete u._components}}h()};var u={},d=0,c=100,h=1e3*60*10;function f(){if(d>=c){p();d=0}}function p(){if(e.enabled){e("e2e.gc","GC started.")}var t=(new Date).getTime();var i=[];for(var n in u){var o=u[n];if(t-o.startTime>h){i.push(o);delete u[n]}}if(e.enabled){e("e2e.gc","Collected actions:",i)}}function g(n){if(!n.mustReport){return}delete n.mustReport;if(i.instart_cchannel_setting){n.instart_cchannel_setting=true}$.whenLoaded(500,function(){if(e.enabled){var i=n.endTime-n.startTime,o=n.serverTime/1e3;e("e2e.reportActionData","Metric:",i,"Server time:",o,"Details:",n)}t.rpc("/e2e/action_data_POST").args(n).send()},"e2e.reportActionData")}exports.startAction=function(t){if(t===null||typeof t==="undefined"){throw"This method expects an object describing the action."}t.startTime=(new Date).getTime();t.id=(t.startTime*1e3+Math.floor(Math.random()*1e3)).toString(36);u[t.id]=t;if(e.enabled){e("e2e.startAction",t)}d++;f();return t};exports.startOrUpdateAction=function(e,t){if(!e||!u[e]){return exports.startAction(t)}else{return exports.updateAction(e,t)}};exports.getAction=function(e){return u[e]};exports.updateAction=function(e,t){if(t===undefined){throw"This method expects an object describing the update."}var i=u[e];if(i===undefined){return null}return $.extend(i,t)};exports.finishAction=function(t,i){var n=u[t];if(n===undefined){return null}if(i){$.extend(n,i)}n.endTime=(new Date).getTime();delete u[t];if(e.enabled){e("e2e.finishAction",n)}g(n);return n}},{webnode2:true,"w2.timing":true,settings:true,"jquery.whenIdle":true,log:true});require.whenReady("settings",function(){});require.install("interface/helpers",function(require,exports,module){function e(e,t,i,n){var o;var s=function(t){if(n&&n(t)){return e}return t};var r=function(i){var n=e[i],o=t[i];if(n!==undefined){if(typeof n==="function"){e[i]=function(){var e=this._super,i;if(typeof o==="function"){this._super=o.bind(t)}try{i=n.apply(this,arguments)}finally{this._super=e}return s(i)}}else{throw new TypeError("You can't override members that aren't functions.")}}else{if(typeof o==="function"){var r=function(){return s(o.apply(this,arguments))};var a=r.bind(t);a.bind=function(e){return r.bind(e)};e[i]=a}else{Object.defineProperty(e,i,{get:function(){return s(t[i])},set:function(){throw"You cannot set a wrapped property on an outer object. "+"Please talk to Platform team if you feel you need this."},enumerable:true})}}};for(o=0;i&&o<i.length;o++){r(i[o])}return e}function t(e){throw new Error("Sorry, "+e+" is not implemented yet. Please yell at Platform team.")}exports.wrap=e;exports.notImplemented=t},{});require.install("interface/settings",function(require,exports,module){var e=require("interface/helpers").wrap,t=require("settings");var i=["pageIsMobile","isLoggedIn","serverCallUrl","batchedServerCallUrl","interface_strings"];e(exports,t,i)},{"interface/helpers":true,settings:true});require.install("interface/jquery",function(require,exports,module){var e=require("interface/settings"),t=require("interface/helpers").wrap,i=require("interface/helpers").notImplemented,n=require,o,s;if(e.pageIsMobile){n("zepto");o=window.Zepto;window.$=undefined;s=function(e){return o.zepto.isZ(e)}}else{o=n("jquery");s=function(e){return e instanceof o}}var r=["get","on","off","text","hasClass","addClass","removeClass","toggleClass","val","attr","focus","html","is","map","css"];function a(t,o,s,r){if(typeof s!=="string"){throw new TypeError("events must be a string. event/handler maps not supported.")}if(e.pageIsMobile){var a=s.split(" ");var l=a.reduce(function(e,t){return e||t=="click"},false);if(l){if(!t){i("removing click events on mobile")}var u=n("mobile_app2/util");u.safeClickHandlerForElements(o,r)}return a.filter(function(e){return e!=="click"}).join(" ")}return s}var l=function(){var e={on:function(e,t){e=a(true,this.get(),e,t);return this._super.call(this,e,t)},off:function(e,t){e=a(false,this.get(),e,t);return this._super.call(this,e,t)}};var i=o.apply(this,arguments);return t(e,i,r,s)};exports._jQuery=o;exports.jQuery=l;exports.extend=o.extend},{"interface/settings":true,"interface/helpers":true});require.install("interface/rpc",function(require,exports,module){var e=require("interface/settings"),t=require("Class").Class,i=require("interface/helpers").wrap,n=require("interface/jquery").extend,o=require,s,r;var a=function(e){return e instanceof r};var l=function(e){return e instanceof s};var u=["_data","args","xargs","kwargs","contentFor","error","except","send","success","sendJsData","_url"];if(e.pageIsMobile){var d=o("mobile_app2/server_call");r=d._ServerCall;s=d.RPC;Array.prototype.push.apply(u,["callback"])}else{var c=o("webnode2");r=c._ServerCall;s=c.RPC;Array.prototype.push.apply(u,["_success","_error","url"])}var h=u;var f=u.concat("liveMutate");var p={contentFor:function(t,i){if(!i.parentCID){throw new Error("must explicitly specify parentCID.")}if(e.pageIsMobile){i=i.parentCID}return this._super(t,i)}};var g=exports.RPC=t.extend(n({__init__:function(e){var t=new s(e);return i(this,t,h,l)}},p));exports.rpc=function(t){if(e.pageIsMobile){return new g(t)}else{return(new g).url(t)}};var _=require("rpc_manager").enqueueRequest;exports.ServerCall=t.extend(n({__init__:function(e,t,n){var o=new r(e,t,n);return i(this,o,f,a)}},p))},{"interface/settings":true,"interface/jquery":true,rpc_manager:true,Class:true,"interface/helpers":true});require.install("debounce",function(require,exports,module){exports.debounce=function(e,t,i){var n,o,s,r,a,l,u,d=0,c=false,h=true;if(typeof e!="function"){throw"Only able to debounce functions."}function f(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}t=t<0?0:+t||0;var p;if(i===true){p=true;h=false}else if(f(i)){p=!!i.leading;c="maxWait"in i&&Math.max(+i.maxWait||0,t);h="trailing"in i?!!i.trailing:h}function g(){if(l){clearTimeout(l)}if(o){clearTimeout(o)}d=0;o=l=u=undefined}function _(){return Date.now()}function m(t,i){if(i){clearTimeout(i)}o=l=u=undefined;if(t){d=_();s=e.apply(a,n);if(!l&&!o){n=a=undefined}}}function v(){var e=t-(_()-r);if(e<=0||e>t){m(u,o)}else{l=setTimeout(v,e)}}function w(){m(h,l)}function b(){var i,f;n=arguments;r=_();a=this;u=h&&(l||!p);if(c===false){i=p&&!l}else{if(!o&&!p){d=r}var g=c-(r-d);f=g<=0||g>c;if(f){if(o){o=clearTimeout(o)}d=r;s=e.apply(a,n)}else if(!o){o=setTimeout(w,g)}}if(f&&l){l=clearTimeout(l)}else if(!l&&t!==c){l=setTimeout(v,t)}if(i){f=true;s=e.apply(a,n)}if(f&&!l&&!o){n=a=undefined}return s}b.cancel=g;return b}},{});require.install("rpc_manager",function(require,exports,module){var e=require("interface/rpc").rpc,t=require("interface/settings"),i=require("debounce").debounce;var n=require("Class").Class.extend({__init__:function(){this._urlToBatchedUrl={};this._pendingRequests={};this._makeBatchRequests={};this._debounceWait=10;this._registerUrlToBatchedUrl(t.serverCallUrl,t.batchedServerCallUrl);this._registerUrlToBatchedUrl("/api/rerender_component_POST","/api/batched_rerender_component_POST")},_registerUrlToBatchedUrl:function(e,t){this._urlToBatchedUrl[e]=t;this._pendingRequests[e]=[];this._makeBatchRequests[e]=this._getBatchRequestFunction(e)},_shouldBatchRequest:function(e){return e._url()in this._urlToBatchedUrl},enqueue:function(e){if(!this._shouldBatchRequest(e)){return e.send()}this._pendingRequests[e._url()].push({request:e,data:this._getDataObject(e),success:this._getSuccessCallback(e),error:this._getErrorCallback(e)});this._makeBatchRequests[e._url()]()},_getDataObject:function(e){var t=e._data();delete t.formkey;delete t.window_id;delete t.referring_controller;delete t.referring_action;return t},_getSuccessCallback:function(e){if(t.pageIsMobile){return function(t){t={success:true,response:{value:t}};e.callback.call(e,t)}}else{return function(t){e._success().call(e,{value:t})}}},_getErrorCallback:function(e){if(t.pageIsMobile){return function(t){t=t||{success:false,response:{}};e.callback.call(e,t)}}else{return function(t){e._error().call(e,t)}}},_getBatchRequestFunction:function(n){var o=this;return i(function(){var i=o._pendingRequests[n];o._pendingRequests[n]=[];if(i.length===1){i[0].request.send();return}var s=i.map(function(e){return e.data});var r=function(e){i.forEach(function(t){t.error(e)})};var a=function(e){var n=t.pageIsMobile?e.value:e;i.forEach(function(e,t){e.success(n[t])})};e(o._urlToBatchedUrl[n]).kwargs({requestsData:s}).success(a).error(r).send()},o._debounceWait)}});var o=new n;exports.enqueueRequest=function(e){o.enqueue(e)}},{"interface/rpc":true,"interface/settings":true,Class:true,debounce:true});require.install("window_manager",function(require,exports,module){exports.catchRedirectCallback=null;var e=function(e){return/https?:\/\/[a-z.0-9_\.\-]*quora\.com/i.test(e)};var t=exports.getDomain=function(){return window.location.protocol+"//"+window.location.host+"/"};exports.getPathName=function(){return decodeURI(window.location.pathname)};var i=exports.getURL=function(){return decodeURI(window.location.href)};var n=exports.getHash=function(){return window.location.hash};var o=exports.replaceURL=function(e){if(window.history&&history.replaceState){history.replaceState(history.state,null,e)}};exports.parseHashParams=function(e){var t=n();var i={};e=e||";";if(t.substr(0,1)=="#"){var o=t.substring(1).split(e);for(var s=0;s<o.length;s++){var r=o[s].split("=");i[r[0]]=r[1]}}return i};exports.isInHash=function(e){var t=n();if(t.substr(0,1)=="#"){t=t.replace("%23","-");var i=t.substring(1).split("-");for(var o=0;o<i.length;o++){if(i[o]==e){return true}}}return false};var s=function(e){var t={};var i=e.split("&");for(var n in i){var o=i[n];var s=o.split("=");t[s[0]]=decodeURIComponent(s[1])}return t};var r=exports.parseURLParams=function(e){if(!e){e=location.search.substring(1)}if(e.length===0){return{}}return s(e)};exports.parseParams=function(e){var t={};if(e){var i=e.split("?");if(i.length==2){t=s(i[1])}}return t};exports.isParamInURL=function(e,t){return e in r(t)};exports.addParamToURL=function(e,t,i){var n=encodeURIComponent(t)+"="+encodeURIComponent(i);if(e.indexOf("?")==-1){n="?"+n}else{n="&"+n}var o=e.indexOf("#");if(o==-1){return e+n}else{return e.substring(0,o)+n+e.substring(o)}};exports.getURLParam=function(e){return r()[e]};var a=exports.makeURL=function(e,t,i,n){var o=[];if(i){for(var s in i){if(i.hasOwnProperty(s)&&i[s]!==null){o.push(s+"="+encodeURIComponent(i[s]))}}}var r=o.join("&");var a=e+t;if(r.length>0){a+="?"+r}a+=n;return a};exports.updateURLParams=function(e){var t=r();for(var i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}var n=a(location.origin,location.pathname,t,location.hash);o(n);return n};exports.removeURLParam=function(e){var t=r();t[e]=null;return exports.updateURLParams(t)};exports.getTitle=function(){return document.title};exports.setTitle=function(e){document.title=e};exports.reload=function(){window.location.reload()};var l=function(e){return e.indexOf("quora://")!==-1};exports.handleClick=function(e,t){if(t.which==2||t.metaKey){window.open(e)}else{u(e)}};exports.sameDomainURL=function(e){return e&&(e.charAt(0)=="/"||new RegExp("^https?://"+window.location.hostname+"/","i").test(t(e)))};var u=exports.navigateTo=function(n){if(n==i()+"#"){return}if(n.indexOf("/")===0){n=t()+n.substring(1)}if(n===""||n==="#"){return}if(!e(n)&&!l(n)){window.open(n)}else{var o=true;if(exports.catchRedirectCallback){o=exports.catchRedirectCallback(n)}if(o){window.location=n}}};exports.openCenteredPopupWindow=function(e,t,i){var n=window.screenX+window.innerWidth/2-t/2;var o=window.screenY+window.innerHeight/2-i/2;window.open(e,"_blank","width="+t+",height="+i+",left="+n+",top="+o)};exports.headerOffset=45;exports.actionBarHeight=52;exports.scrollContext=60;exports.scrollAndFocus=function(e,t){e-=exports.headerOffset;e=Math.max(0,Math.min($(document).height()-$(window).height(),e));var i=Math.min(500,Math.abs(e-$(document).scrollTop())*.5),n=false;$("html,body").animate({scrollTop:e},i,"swing",function(){if(!n&&$(t).length){var e=window.scrollX,i=window.scrollY;$(t).focus();window.scrollTo(e,i);n=true}})};exports.scrollIntoView=function(e){var t=$(e).offset().top,i=t-$(document).scrollTop();if(i<exports.headerOffset||i>$(window).height()){exports.scrollAndFocus(t)}}},{});require.install("w2.rpc",function(require,exports,module){var e=require("webnode2"),t=require("w2.errors"),i=require("w2.perf"),n=require("settings"),o=n.formkey,s=n.postkey,r=require("w2.timing"),a=require("e2e"),l=0,u=require("spin"),d=require("scribe"),c=require("assert").ok,$=require("jquery");require("jquery.ajax");e.postPerfInfoCallback=null;e.atLeastOneServerCallIsSent=false;e.RPC=$.Ajax.extend({__init__:function(i){this._super(e.RPC.defaults);this.options(i);this.__data={args:[],kwargs:{}};this.__success=null;this.beforeComplete(this.fnbind(this._implicitCompleteHandler));this.beforeError(this.fnbind(this._implicitErrorHandler));this.error(this.fnbind(this._defaultErrorHandler));this.__exceptionPatterns={state_expired:function(e){require("w2.livenode").reportPageNeedsReload("state_expired")}};this.__exceptionCatchAll=null;this.__liveMutation=false;this.__contentFor=false;this.__persistMutation=false;this.__creationTime=(new Date).getTime();this.__isRelatedToUserAction=t.canBeRelatedToUserAction();this.__reportError=true},name:function(e){if(e===undefined){return this.__name}this.__name=e;return this},relatedToUserAction:function(e){this.__isRelatedToUserAction=e;return this},reportError:function(e){this.__reportError=e;return this},persistMutation:function(){this.__persistMutation=true;return this},finishMutation:function(){if(this.__persistMutation){if(this.__persistMutationInfo){var e=this.__persistMutationInfo.transactionId;require("w2.livenode").mutationDoneAfterVersion(e,0)}this.__persistMutation=false}},discardMutation:function(){if(this.__liveMutation){if(this.__liveMutationInfo){var e=this.__liveMutationInfo.transactionId;if(e){require("w2.livenode").mutationDoneAfterVersion(e,0)}}this.__liveMutation=false}this.finishMutation()},liveMutate:function(){this.__liveMutation=true;return this},contentFor:function(e,t,i){if(e.jquery){e=e.get(0)}this.__contentFor=true;var n=$.extend(t,{domNode:e});if(!n.useLoadingSpinner&&n.useLoadingSpinner!==false){n.useLoadingSpinner=true}if(!n.parentCID){throw new Error("must explicitly specify parentCID.")}n.domNode=e;n.dont_check_for_live_parent=i;this.__contentForOpts=n;return this},_send:function(){if(this.__liveMutation){this.__liveMutationInfo=require("w2.livenode").startMutation()}if(this.__contentFor){this._contentForStartLoading()}if(this.__persistMutation){this.__persistMutationInfo=require("w2.livenode").startMutation()}this.__startTime=r.getTime();if(this.name()===undefined){this.name(this.__options.url)}return this._super()},send:function(e){var t=e&&e.batched;if(!require("gating").batched_server_calls||!t){return this._super()}require("rpc_manager").enqueueRequest(this)},_contentForStartLoading:function(){if(this.__contentForOpts.useLoadingSpinner){this.__contentForLoadingTimeout=setTimeout(this.fnbind(function(){$(this.__contentForOpts.domNode).forgetContents();var e=$("<div class='__contentfor_loading_spinner'/>");$(this.__contentForOpts.domNode).append(e);this.spinner=u.createSpinnerElement();e.append(this.spinner.el)}),150)}},_contentForDoneLoading:function(){if(this.spinner){this.spinner.stop();this.spinner=null}clearTimeout(this.__contentForLoadingTimeout)},_implicitCompleteHandler:function(e,t){r.logRequestTime(this.name(),this.__startTime)},_implicitErrorHandler:function(e,i,n){this.discardMutation();if(this.__reportError){t.reportAjaxError(e,i,n,this.__isRelatedToUserAction,this.__creationTime)}},_defaultErrorHandler:function(){this.discardMutation();var e="Unhandled error response from server: "+JSON.stringify(arguments),t=this.name();if(t===undefined){t=this.__options.url}e+="; Function name: "+t;this._throwError(e)},except:function(e,t){switch(arguments.length){case 1:this.__exceptionCatchAll=e;break;case 2:if(typeof e=="string"){this.__exceptionPatterns[e]=t}else{$.each(e,this.fnbind(function(e,i){this.__exceptionPatterns[i]=t}))}break;default:this._throwError("The except method takes either (<pattern>, <callback>) or (<default-callback>) as arguments.")}return this},args:function(){var e=[],t;for(t=0;t<arguments.length;t++){e.push(arguments[t])}this.__data.args=e;return this},xargs:function(e){this.__data.args=e;return this},kwargs:function(e){this.__data.kwargs=e;return this},data:function(){throw new Error("Don't use the .data() method with RPC; use .kwargs() or .args() instead.")},_data:function(){if(!o){throw new Error("require('settings').formkey not set -- can't send request securely.")}if(!s){throw new Error("require('settings').postkey not set -- can't send request securely.")}if(!e.windowId&&n.serverCallUrl.indexOf(this.__name)===0){if(console&&console.warn){console.warn("No W2.windowId set; any content coming back from the server may not be live updated correctly")}}var t;try{t=JSON.stringify(this.__data)}catch(i){console.log("W2.RPC Error: Can't encode an object with circular references",i,this.__data);c(false);t=JSON.stringify({error:"Can't encode an object with circular references"})}var r={json:t,formkey:o,postkey:s,window_id:e.windowId,referring_controller:n.controller,referring_action:n.action};if(this.__liveMutation){$.extend(r,this.__liveMutationInfo.data)}if(this.__contentFor){r.parent_cid=this.__contentForOpts.parentCID;r.parent_domid=e.getLiveParent(r.parent_cid);var a=this.__contentForOpts.domNode;var l=e.getLiveChildren(r.parent_cid);var u=l.filter(function(e){return a.contains(document.getElementById(e))});if(!this.__contentForOpts.dont_check_for_live_parent&&!e.getLiveDomId(r.parent_cid)){r.non_live_parent=true}r.domids_to_remove=JSON.stringify(u)}return r},success:function(e){this.__success=e;return this},_successWrapper:function(t){this.finishMutation();if(t.pmsg){if(e.pmsgContainer){e.pmsgContainer.setContent(t.pmsg,true)}else{if(console&&console.warn){console.warn("Received a piggybacking pmsg but there's no pmsgContainer present on this page; dropping the pmsg.")}}}if(this.__contentFor){this._contentForDoneLoading()}if(this.__actionId){i.finishPOST(this.__actionId)}if(t.exception){return this._handleException(t)}else{if(this.__contentFor){if(this.__contentForOpts.parentCID in e._unloaded){$.serverLog("component_content: parent component already unloaded.");d.log({category:"component_content2",http_referer:require("window_manager").getDomain(),url:this._url(),window_id:e.windowId,parent_cid:this.__contentForOpts.parentCID,cid:this._component.cid,
vcon:JSON.stringify(this.__vcon),method:this.__vcon_method,msg:"parent component already unloaded"})}$(this.__contentForOpts.domNode).forgetContents();$(this.__contentForOpts.domNode).removeEditors().setContent(t.value);$(document).trigger("rpc_content_for_done",{opts:this.__contentForOpts,value:t.value})}var n;if(typeof this.__success==="function"){n=this.__success(t.value)}if(this.__liveMutation&&require("settings").pageMode=="post_reload"){if(l>0){l-=1}else{require("window_manager").reload()}}else{if(t.post_perf_html&&e.postPerfInfoCallback){e.postPerfInfoCallback(t.post_perf_html)}}return n}},disableNextPostReload:function(){++l;return this},_success:function(e){return this.fnbind(this._successWrapper)},_throwError:function(e){if(console&&console.error){console.error(e)}throw new Error(e)},_handleException:function(e){this.discardMutation();var t=this.__exceptionPatterns[e.exception.type];var i=true;if(t){i=this._invokeExceptionCallback(t,e)}else if(this.__exceptionCatchAll){i=this._invokeExceptionCallback(this.__exceptionCatchAll,e)}if(i){var n={response:e,rpc:this};$(document).trigger("w2rpcexception-"+e.exception.type,n);$(document).trigger("w2rpcexception",n)}},_invokeExceptionCallback:function(e,t){return e(t.exception,t,this)}});e.RPC.defaults={type:"POST",dataType:"json"};e.rpc=function(t){return(new e.RPC).url(t)};e._Controller=e.RPC.extend({__init__:function(e,t){this._super();this.__vcon=e;this.__vcon_method=t;this.__first_server_call=false;var i=require("settings").serverCallUrl;if(i){this.url(i)}else{throw new Error("require('settings').serverCallUrl not set")}},_data:function(){var e=this._super();if(this.__vcon){e.__vcon_json=JSON.stringify(this.__vcon);e.__vcon_method=this.__vcon_method}else{throw new Error("vcon not set; can't call a view controller.")}var t=a.startOrUpdateAction(e.__e2e_action_id,{url:this.__options.url,vcon:this.__vcon,method:this.__vcon_method,args:e.args,kwargs:e.kwargs});e.__e2e_action_id=t.id;var n=i.startPOST({vcon:this.__vcon,method:this.__vcon_method,id:e.__e2e_action_id});this.__actionId=e.__e2e_action_id;if(this.__first_server_call){e.__first_server_call=true}return e},_send:function(){if(!e.atLeastOneServerCallIsSent){this.__first_server_call=true;e.atLeastOneServerCallIsSent=true}if(this.name()===undefined){this.name(this.__vcon+"."+this.__vcon_method)}return this._super()}});e._ServerCall=e._Controller.extend({__init__:function(e,t,i){this._super(e,t);this._component=i;this._makeOnlyOnce=false;this._sendJsData=true},sendJsData:function(e){this._sendJsData=!!e;return this},_data:function(){var e=this._super();if(this._sendJsData){e.js_init=JSON.stringify(this._component.__js_init)}return e},onlyOnce:function(){if(!this._component.activeServerCalls){this._component.activeServerCalls={}}this._onlyOnce=true;return this},_send:function(){if(this._onlyOnce){if(this._isSimilarServerCallActive()){return this}this._component.activeServerCalls[this.__vcon_method]=1}return this._super.apply(this,arguments)},sendOnlyOnce:function(){this.onlyOnce();return this.send()},_implicitCompleteHandler:function(e,t){if(this._onlyOnce){this._markServerCallInactive()}return this._super.apply(this,arguments)},_isSimilarServerCallActive:function(){if(!this._component.activeServerCalls){return false}return this.__vcon_method in this._component.activeServerCalls},_markServerCallInactive:function(){if(this._isSimilarServerCallActive()){delete this._component.activeServerCalls[this.__vcon_method]}}});e.fallbackToPostReloadMode=function(){require("settings").pageMode="post_reload"}},{jquery:true,"w2.timing":true,window_manager:true,settings:true,webnode2:true,scribe:true,"w2.livenode":true,rpc_manager:true,assert:true,"w2.perf":true,e2e:true,gating:true,"jquery.ajax":true,spin:true,"w2.errors":true});require.install("jquery.quora",function(require,exports,module){(function($){var e=require("webnode2"),t=require("log").log;require("w2.rpc");$.serverLog=function(i,n,o,s){try{e.rpc("/ajax/server_log_POST").reportError(false).kwargs({message:i,level:n,other:o}).error(function(){console.log("Couldn't log error message: '"+i+"' to server.")}).send()}catch(r){}if(s!==false){var a;switch(n){case"DEBUG":a=t.trace.bind(t);break;case"INFO":a=t.info.bind(t);break;case"WARNING":a=t.warn.bind(t);break;case"ERROR":case"CRITICAL":a=t.error.bind(t);break;default:a=t.log.bind(t)}if(typeof a!="function"){a=t.log.bind(t);if(typeof a!="function"){return}}try{a("[$.serverLog]",i,o)}catch(r){}}}})(jQuery);(function(e,t){e.a1ert=t;e.alert=function(e){var i=new Error;$.serverLog("Raw alert -- could mean a security vulnerability","WARNING",{alertArgValue:e,stack:i.stack},false);t(e)};e.alert.toString=function(){return""+t}})(this,this.alert)},{webnode2:true,log:true,"w2.rpc":true});require.install("atexit",function(require,exports,module){var e=[],t=[];function i(e){var t;while(t=e.pop()){try{t()}catch(i){}}}function n(){i(e)}exports.register=function(i,o){if(t.length>0){t[o?t.length-1:0].push(i)}else{if(!e.length){setTimeout(n,10)}e.push(i)}};exports.hook=function(e){return function(){t.push([]);try{return e.apply(this,arguments)}finally{i(t.pop())}}}},{atexit:true});require.install("tchannel_up",function(require,exports,module){function e(e){new Function(e).call(window)}var t=false;exports.stop=function(){t=true};exports.start=function(i,n,o,s,r){var a=500,l=true,u,d=false,c=2e3,h=0,f=require("w2.livenode"),p=require("settings").instart_cchannel_setting;var g;if(!r){var _=".tch.";if(p){_=".tch1."}var m="tch"+(Math.floor(Math.random()*1e6)+1)+_+s;g=window.location.protocol+"//"+m+"/up/"+o+"/updates?"}else{g=window.location.protocol+"//"+r}function v(){return(+new Date).toString(16)+Math.random().toString(16).split(".").pop()}function w(e){var t=document.createElement("script"),i=e.callback="jsonp"+v(),n=a(C),o=setTimeout(n,7e4),s="onreadystatechange",r=document.body;function a(e,n){return function(s){if(n){window[i]=null;try{delete window[i]}catch(r){}}if(o!==-1){clearTimeout(o);o=-1;e(s);if(t.parentNode){t.parentNode.removeChild(t)}}}}window[i]=a(k,true);t.charset="utf-8";t.src=g+$.param(e);if(t.addEventListener){t.addEventListener("load",n,false);t.addEventListener("error",n,false)}else if(t.attachEvent){t.attachEvent(s,function(){if(/loaded|complete/.test(t.readyState)){n()}t.detachEvent(s,arguments.callee)})}r.insertBefore(t,r.firstChild)}function b(e){clearTimeout(u);var t={min_seq:i,channel:n};if(c>0){t.timeout=c}u=setTimeout(function(){w(t)},e||10)}function k(e){if(!l){f.reportPageRegainedConnection();l=true}try{x(e)}catch(t){f.reportPageNeedsReload("tchannel_error");return}a=500;b()}function C(e){if(d){return}a=Math.min(a*2,30*1e3);if(a>=10*1e3){if(l){f.reportPageLostConnection();l=false}}b(a)}var y=function(){var i={},n=i;function o(){if(t){return}var n=i.next;if(n){if(window.log&&window.log.enabled){window.log("tchannel_up.enqueue","Evaluating:",n.js)}e(n.js);delete i.next;delete n.js;i=n}return n}function s(){setTimeout(function(){var e=+new Date;while(o()){if(new Date-e>100){return s()}}},10)}return function(e){n=n.next={js:e};if(i.next===n){s()}}}();function x(e){if(window.log&&window.log.enabled){window.log("tchannel_up.newMessages","Response:",e)}if(e.error){throw e.error}var t=e.messages;if(!t){return}i=e.min_seq;for(var n=0;n<t.length;++n){y(t[n])}}$(window).bind("beforeunload",function(){d=true});$(window).bind("load",function(){setTimeout(function(){c=0},h);b(20)})}},{"w2.livenode":true,settings:true});require.install("w2.livenode",function(require,exports,module){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}var $=require("jquery"),e=require("webnode2"),t=require("log").log,i=require("spin"),n=require("browser").browser,o=require("settings"),s=require("assert").ok,r=o.interface_strings;require("jquery.quora");var a=null,l={interactionDelayedLivedepOperations:[],pendingMutationCount:0,currentVersion:0,requiredVersion:0,lazyComplete:false},u=1e3,d=false,c=false;function h(e,t,i){if(t in e&&!(i in e)){e[i]=e[t];delete e[t];return true}}function f(e){var t={},i;$("#"+e+" [w2cid]").each(function(e,n){i=n.getAttribute("w2cid");t[i]=n});return t}function p(e,t){var i=$("#"+e)[0];var n=t;while(n&&n.parentNode!==i){n=n.parentNode}for(var o=0;o<i.childNodes.length;o++){if(i.childNodes[o]===n){return o}}}function g(e){var t={};$.each(e,function(e,i){if(i.domid in t){return}var n=f(i.domid);t[i.domid]=n});return t}function _(t){var i=e.interactionMode._changedComponents[t];return i&&i!=e.interactionMode._states.OFF}function m(e){var t={};for(var i in e){var n=e[i];for(var o in n){if(_(o)){if(!t[i]){t[i]={}}t[i][o]=n[o]}}}return t}function v(e,t){var i=m(t);for(var n=0;n<e.length;n++){var o=e[n];var s=i[o.domid];if(!s){continue}if(o.type==="set_node"){return false}}return true}function w(t,i,n){var o=g(t);if(!i&&v(t,o)){return true}try{$.each(t,function(e,t){h(t,"ty","type");if(h(t,"animation","transition")){h(t.transition,"ty","type")}h(t,"parentCid","parent_cid");h(t,"childCid","child_cid");h(t,"childDomid","child_domid");var n,s=o[t.domid];$.each(s,function(e,n){if(_(e)){if(i){console.log("forcing override on live update conflict with cid="+e+" on optype = "+t.type)}else{console.log("throwing blocking_interaction_mode cid="+e+" on optype = "+t.type);console.log("affected node:");console.log(s[e]);throw"blocking_interaction_mode"}}})})}catch(s){if(typeof s=="string"&&s=="blocking_interaction_mode"){console.log("Calling startBlocking from checkForConflicts");e.interactionMode.startBlocking();l.interactionDelayedLivedepOperations.push({data:t,textStatus:n});return false}else{throw s}}return true}var b=require("atexit").hook(function(i,o,r){r=r||false;if(i=="error"){console.log("LiveNode error");A("error_response2");return}if(!e.interactionMode||e.interactionMode.isBlocking()){l.interactionDelayedLivedepOperations.push({data:i,textStatus:o});return false}if(!w(i,r,o)){return false}var a=!n.msie&&$(window).scrollTop()>0;if(a){$("div.feed_item_inner:in-viewport").anchor()}$.each(i,function(i,n){var o,r,l;if(window.log&&t.enabled){t("w2.livenode.onLivedepOperations","Applying",n)}$(document).trigger("livenode_op_start",n);switch(n.type){case"set_node":if(n.domid in e._ignoreDomids){break}var u=$("#"+n.domid);if(!u.length){A("set_node_missing, op.domid = "+n.domid+", op.cid = "+n.cid);return}var d=n.transition;l=e.getComponentFromElement(u.get(0));if(l&&l.force_transition){d=l.force_transition}s("cid"in n);e.unloadComponent(n.cid);u.setContent(n.content);switch(d.type){case"none":break;case"fade_in":u.effect("fade",{},2e3);break;case"highlight":u.effect("highlight",{},2e3);break;default:break}break;case"insert_node":if(n.domid in e._ignoreDomids){break}o=document.getElementById(n.domid);if(!o){A("insert_node_missing, op.domid = "+n.domid+", op.parent_cid = "+n.parent_cid);return}var c=document.createElement("DIV");e.setContentHTML(c,n.content);if(c.childNodes.length!=1){console.log("error: append must give a single node");A("append");return}var h=c.childNodes[0];var f=h.id;h.style.display="none";if(o.childNodes.length==n.position){o.appendChild(h)}else{o.insertBefore(h,o.childNodes[n.position])}e.setContentJS(h,n.content);r=e._components[n.parent_cid];if(r){r.onInsertNode(n,f)}if(n.transition.type=="none"){break}else if(n.transition.type=="scroll"){h.style.display="";h.scrollIntoView(false);break}if(a||n.transition.type=="fade_in"){$("#"+f).fadeIn(500);break}h.style.display="none";$("#"+f).fadeIn(1e3);break;case"delete_node":if(n.domid in e._ignoreDomids){break}o=document.getElementById(n.domid);if(!o){A("delete_node_missing, op.domid = "+n.domid+", op.parent_cid = "+n.parent_cid);return}if(!e._parents[n.parent_cid]){A("delete_node_missing_component "+n.parent_cid);return}var p=o.childNodes[n.position];if(p.id!=n.child_domid){A("delete_node_wrong_child, node.id = "+p.id+", op.child_domid = "+n.child_domid);return}r=e._components[n.parent_cid];if(r){r.onDeleteNode(n,p.id)}e.unloadComponent(n.child_cid);$("#"+p.id).removeEditors().remove();break;case"update_data":if(n.cid in e._ignoreCids){break}if(!e._parents[n.cid]){A("update_data_missing_component, op.cid = "+n.cid+", op.parent_cid = "+n.parent_cid);return}l=e._components[n.cid];if(l){l.onUpdate(n.data)}break;case"error":console.log("livedep error: "+n.error);A("error_response");return;default:console.log("bad op type: "+n.type);A("bad_type")}});$(document).trigger("livenode_finish_operations")});function k(e,t,i){$.serverLog("on check livedep error: "+e+" / status: "+t+" / error: "+i);if(u<32e3){a=setTimeout(C,u);u*=2}else{clearTimeout(a);a=null;A("failed to sync livedeps")}}function C(){if(a){clearTimeout(a);a=null}var e=require("webnode2");(new $.Ajax).url(window.location.protocol+"//"+location.hostname+"/check_livedeps/index?window_id="+e.windowId+"&random="+Math.random()).type("GET").error(k).send()}function y(e){l.lazyComplete=e}function x(){return l.lazyComplete}var S={};function T(){var e=require("webnode2");e.interactionMode.resumeUpdates();var t=Math.random(),i={};i._lm_transaction_id=t;i._lm_window_id=e.windowId;S[t]=1;E();return{transactionId:t,data:i}}function L(e,t){delete S[e];l.requiredVersion=Math.max(t,l.requiredVersion);E()}function q(e){l.currentVersion=e;M()}function E(){var e=0,t;for(t in S){e++}l.pendingMutationCount=e;M()}function I(){require("tchannel_up").stop()}function M(){if(window.log&&t.enabled){t("w2.livenode.checkLoadingStatus","Pending mutation count:",l.pendingMutationCount,", current version",l.currentVersion,", required version",l.requiredVersion)}var e=require("webnode2");if(l.pendingMutationCount>0||l.currentVersion<l.requiredVersion){e.Loading.show()}else if(e.Loading){e.Loading.hide()}}function A(e){c=true;console.log("Page requires reload "+e);if(!d){$.serverLog("reportPageNeedsReload: "+e);d=true}if(!o.uid){return}var t=require("webnode2");if(t.Error){t.Error.hide()}t.fallbackToPostReloadMode(e);t.interactionMode.$("#@message").html("<a href='javascript:window"+".location.reload();'>"+r.please_refresh+"</a>");console.log("Calling startBlocking from reportPageNeedsReload");t.interactionMode.startBlocking()}function D(){require("webnode2").Error.hide()}function N(){c=true;require("webnode2").Error.show(r.trying_to_regain)}exports.isConnectionLostLogged=function(){return c};var e=require("webnode2"),O=e.Component;exports.LiveSpinner=O.extend({init:function(){this._super.apply(this,arguments);e.Loading=this;this.t=null;this.showing=false;this.setDefaultSpinnerColor()},setSpinnerColor:function(e){this._spinnerColor=e},setDefaultSpinnerColor:function(){this.setSpinnerColor("#fff")},addCSSToWrapper:function(e){this.$("#@loading").addClass(e)},removeCSSFromWrapper:function(e){this.$("#@loading").removeClass(e)},show:function(){if(this.showing){return}this.showing=true;var e=this.fnbind(function(){if(!this.spinner){this.spinner=i.createSpinnerElement({color:this._spinnerColor});this.$("#@spinner").append(this.spinner.el)}this.$("#@loading").removeClass("fade_out").removeClass("hidden")});this.t=setTimeout(e,250)},hide:function(){if(!this.showing){return}this.showing=false;clearTimeout(this.t);this.t=null;this.$("#@loading").addClass("fade_out");setTimeout(this.fnbind(function(){if(this.$("#@loading").hasClass("fade_out")){this.$("#@loading").removeClass("fade_out").addClass("hidden");if(this.spinner){this.spinner.stop();this.spinner=null}}}),150)}});exports.LoadingBanner=O.extend({init:function(){this._super.apply(this,arguments);e.Loading=this;this.t=null;this.showing=false},show:function(){if(this.showing){return}this.showing=true;var e=this.fnbind(function(){var e=$(".main_content").first();if(e.length===0){return}var t=e.offset().left;this.$("#@loading").css("left",t+"px").show()});this.t=setTimeout(e,750)},hide:function(){if(!this.showing){return}this.showing=false;clearTimeout(this.t);this.t=null;this.$("#@loading").hide()}});exports.ErrorBanner=O.extend({init:function(){this._super.apply(this,arguments);require("webnode2").Error=this;this.shown=false;this.$("#@hide").click(this.fnbind(function(){this.hide();return false}))},show:function(e){e=e||this.default_text;this.$("#@text").text(e);if(this.shown){return}this.shown=true;$(document).trigger("bannerShown");this.$("#@banner").show().addClass("fade_in");F()},hide:function(){if(!this.shown){return}this.shown=false;$(document).trigger("bannerHidden");var e=this;e.$("#@banner").removeClass("fade_in").addClass("fade_out");setTimeout(function(){e.$("#@banner").hide()},150);R()}});var F=function(){$(".ContentWrapper").addClass("extra_padding");$(".NotifHeaderBar").addClass("extra_padding")};var R=function(){$(".ContentWrapper").removeClass("extra_padding");$(".NotifHeaderBar").removeClass("extra_padding")};$.fn.aboveViewport=function(e){return $(window).scrollTop()>=this.offset().top+this.height()-(e||0)};exports.syncLivedeps=C;exports.startMutation=T;exports.onLivedepOperations=b;exports.reportPageNeedsReload=A;exports.reportPageRegainedConnection=D;exports.reportPageLostConnection=N;exports.setCurrentVersion=q;exports.mutationDoneAfterVersion=L;exports.checkLazyComplete=x;exports.setLazyComplete=y;exports.stopLiveUpdates=I;exports.addContentPadding=F;exports.removeContentPadding=R;exports.state=l},{jquery:true,tchannel_up:true,log:true,settings:true,webnode2:true,assert:true,atexit:true,spin:true,"jquery.quora":true,browser:true});require.install("jquery.webnode2",function(require,exports,module){var e=require("ytplayer"),t=require("browser").browser,i=require("jquery");(function($){var i=require("lang/fun").bind;$.fn.forgetContents=function(){var e=require("webnode2");this.find("*").map(function(){var t=e._domidToCid[this.id];if(!t){return}e._ignoreDomids[this.id]=1;e._ignoreCids[t]=1});return this};$.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%";e.style.height="200px";var t=document.createElement("div");t.style.position="absolute";t.style.top="0px";t.style.left="0px";t.style.visibility="hidden";t.style.width="200px";t.style.height="150px";t.style.overflow="hidden";t.appendChild(e);document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;if(i==n)n=t.clientWidth;document.body.removeChild(t);return i-n};$.fn.addAnimationClass=function(e,i){var n=this;if(t.msie&&t.version<=9){i();return this}var o="W2_css_animation";var s=["-webkit-animation-name","-moz-animation-name","-o-animation-name","-ms-animation-name"];this.addClass(e);this.bind("oanimationend animationend webkitAnimationEnd MSAnimationEnd",function(e){n.trigger(a(e))});function r(){for(var e=0;e<s.length;e++){var t=n.css(s[e]);if(t){return t}}}function a(e){if(!e)return false;var t=e.originalEvent.animationName;return t+o}var l=r()+o;this.on(l,function(){n.unbind(l);n.removeClass(e);i()});return this};$.fn.removeEditors=function(){this.find(".qed_content").remove();return this};$.fn.setContent=function(t){this.removeEditors();var i=e.getYTPlayerStatuses($(this));if(typeof t=="string"){this.html(t)}else{this.setContentHTML(t);this.setContentJS(t)}e.restoreYTPlayerStatuses(this,i);return this};$.fn.setContentHTML=function(e){return this.html(e.html)};$.fn.setContentJS=function(e){window.require.enqueue(new Function("require","var W2 = require('webnode2'),"+"LiveNode = require('w2.livenode');"+e.js))};$.fn.setContentFromAJAXComponent=function(e,t,n,o,s,r,a){var l=require("webnode2");t=t||{};t.___W2_parentId=n;t.___W2_windowId=l.windowId;t.___parent_domid=l.getLiveParent(n);o=o||'<span class="__wn2_loading"><span class="__wn2_loading_spinner"></span><span class="__wn2_loading_text">Loading...</span></span>';r=r||'<span style="color: red; font-weight: bold;">ERROR</span>';$.securepost(e,t,i(this,function(e){if(e.___ERROR___){this.setContent(r);if(typeof a=="function"){a(e,e.___ERROR___)}}this.setContent(e);if(typeof s=="function"){s(e)}}),"json");this.setContent(o);return this};var n=(+new Date).toString(16);function o(e){if(!e||!e.parentNode)return false;var t=e.getAttribute("id"),i;e.setAttribute("id",n);i=!!document.getElementById(n);if(t)e.setAttribute("id",t);else e.removeAttribute("id");return i}$.inDom=o;var s=false;$.fn.anchor=function(e){if(s||this.length<1)return this;s=true;var t=[],i=$(window).scrollTop();t.length=this.length;for(var n=0,r;r=this[n];++n)t[n]=[r,$(r).offset().top-i];function a(){var e={},i,n=0,r,a,l=[,-1];while(r=t[n++]){if(!o(r[0]))continue;i=$(r[0]).offset().top-r[1];a=e[i]=(e[i]||0)+1;if(l[1]<a)l=[i,a]}if(l[1]!=-1)window.scrollTo(0,Math.round(l[0],0));s=false}if(e)return a;require("atexit").register(a);return this}})(i)},{jquery:true,webnode2:true,"w2.livenode":true,"lang/fun":true,ytplayer:true,atexit:true,browser:true});require.install("polyfills/requestAnimationFrame",function(require,exports,module){(function(){var e=0;var t=["webkit","moz"];for(var i=0;i<t.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,i){var n=(new Date).getTime();var o=Math.max(0,16-(n-e));var s=window.setTimeout(function(){t(n+o)},o);e=n+o;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){clearTimeout(e)}}})()},{});require.install("w2.dialog",function(require,exports,module){(function(){var e=require("lang/fun").bind,t=require("webnode2"),i=require("Class").Class,n=require("settings").interface_strings;t.Dialog=i.extend({__init__:function(e,i){if(this.opener){this.opener(e)}t.Dialog._dialogCounter+=1;this._dialogId=t.Dialog._dialogCounter;this._dialogOuter="#__w2_dialog_outer_"+this._dialogId;this._dialogContainerId="#__w2_dialog_container_"+this._dialogId;this._cid="*dialog*_"+this._dialogId;t.Dialog._instance=this;this._title=null;this._buttons=[];this._ok=null;this._cancel=null;this.opts=$.extend({closeOnEscape:true,closeOnClickOut:false,sortButtons:true,focusOK:false,dialogClass:"",verticalOffset:150,showXButton:false,hideDialog:false},i);this._opened=false;this._containsComponent=false;this._content=null;if(this.opts.html){this._content=this.opts.html}},opt:function(e,t){this.opts[e]=t;return this},ok:function(e,i){if(typeof e=="string"){i=e;e=null}this._ok=e;if(i!==false){this.addButton(new t.OKButton(this,i,null))}return this},cancel:function(e,i,n){if(typeof e=="string"){i=e;e=null}this._cancel=e;if(i!==false){if(n){this.addButton(new t.CancelActionButton(this,i,null))}else{this.addButton(new t.CancelButton(this,i,null))}}return this},button:function(e,i,n){return this.addButton(new t.Button(this,i,e,n))},title:function(e){if(this._opened){throw new Error("Can't set the title for a dialog once it has been opened.")}this._title=e;return this},setTitle:function(e){if(e){$("#__w2_dialog_title_"+this._dialogId).text(e)}},addButton:function(e){if(this._opened){throw new Error("Can't add a button to a dialog once it has been opened")}this._buttons.push(e);return this},opener:function(e){this._opener=e;return this},open_:function(){if(this._opened){return this}this._createDOMElements();var i=t._safeGetComponentByCID(this._cid);t._components[this._cid]=i;var n={};n[this._cid]="*ROOT*";t.addParents(n);$(document).bind("keydown.__w2_dialog_"+this._dialogId,e(this,function(e){if(this.opts.closeOnEscape){if(e.keyCode==27){this.cancel_();e.stopPropagation()}}}));if(this.opts.closeOnClickOut){var o=this._dialogOuter;$(document).on("click",o,e(this,function(e){e.stopPropagation()}));$(document).on("click",":not("+o+","+o+" *)",e(this,function(e){this.cancel_();e.stopPropagation()}))}this._opened=true;if(typeof this._open=="function"){this._open.apply(this,arguments)}return this},cancel_:function(e){var t=true;if(typeof this._cancel=="function"){if(this._cancel(this._callbackArg(e))===false){t=false}}if(t){this.close_()}},_callbackArg:function(e){var i={dialog:this,dialogWrapper:t._safeGetComponentByCID(this._cid),button:e};if(this._containsComponent){i.dialogComponent=t._safeGetComponentByCID(this._cid).lookup("__dialog__")}return i},ok_:function(e){var t=true;if(typeof this._ok=="function"){if(this._ok(this._callbackArg(e))===false){t=false}}if(t){this.close_()}return t},close_:function(){if(!this._opened){return this}$(document).unbind(".__w2_dialog_"+this._dialogId);$(this._dialogOuter).forgetContents();t.unloadComponent(this._cid);$(this._dialogOuter).removeEditors().remove();this._opened=false;if(typeof this._close=="function"){this._close.apply(this,arguments)}var e=this._dialogOuter;$(document).off("click",e);$(document).off("click",":not("+e+","+e+" *)");return this},open:function(e){this._open=e;return this},close:function(e){this._close=e;return this},html:function(e){this._content=e;return this.open_()},text:function(e){return this.html(e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))},_createDOMElements:function(){var t=this.opts.width||470;var i="dialog";if(this.opts.hideDialog){i=""}var n,o=$("<div />").attr("id","__w2_dialog_outer_"+this._dialogId).addClass(i).addClass("w4").addClass(this.opts.dialogClass);if(this._title){n=$("<div />").addClass("dialog_wrapper").append($("<h2 />").attr("id","__w2_dialog_title_"+this._dialogId).addClass("dialog_header").addClass("dialog_frame").text(this._title));if(this._content){n.append($("<div />").addClass("dialog_frame").addClass("dialog_contents").addClass("dialog_body").html(this._content))}}else{n=$("<div />").addClass("dialog_component").addClass("dialog_wrapper").addClass("dialog_body").html(this._content)}if(this.opts.showXButton){n.append($("<a />").attr("href","#").addClass("remove").click(e(this,this.cancel_)).click(function(){return false}))}if(this._buttons.length){n.append($("<div />").addClass("dialog_frame").addClass("dialog_buttons").append(this._buttonsDOM()))}var s=$(window).width(),r=$(window).scrollTop(),a=t,l=s-a,u=l/2;r=this.opts.verticalOffset;if($(window).height()<600){r=$(window).scrollTop();n.css("position","static")}n.css("width",t-10+"px");o.append(n).css("top",r+"px").css("left",this.opts.left||u-15+"px").css("width",t+10+"px").appendTo($(document.body));if(this.opts.focusOK){for(var d=this._buttons.length-1;d;d--){var c=this._buttons[d];if(c._type=="submit"){$("#__w2_dialog_button_"+this._dialogId+"_"+d).focus();break}}}return},checkDialogPosition:function(){var e=$(this._dialogOuter);var t=e.offset().top;var i=t+e.outerHeight(true);var n=$(window);var o=n.scrollTop()+n.height();if(i>o){var s=this.opts.verticalOffset;var r=n.scrollTop()+s+e.outerHeight(true);if(r>o){s=10}e.css("top",s+"px")}this._checkContentOverflow()},_checkContentOverflow:function(){var e=this;var t=$(window);var i=t.scrollTop()+t.height();var n=$(e._dialogContainerId);var o=n.offset().top;var s=n.outerHeight(true);var r=o+s;if(r>i){var a=r-i;var l=s-a;n.css({"overflow-y":"scroll",height:l})}},_buttonDOM:function(t,i){t._index=i;var n=$("<a />").addClass("dialog_button").text(t._text).click(e(t,t.click_)).click(function(){return false}).attr("href","#").attr("id","__w2_dialog_button_"+this._dialogId+"_"+i);switch(t._type){case"submit":n.addClass("submit_button");break;case"link":case"cancel":n.addClass("cancel");break;default:n.addClass("action_button");break}return n},_buttonsDOM:function(){var e=$("<div />");if(this.opts.sortButtons){this._buttons.sort(function(e,t){return e._priority-t._priority})}for(var t=this._buttons.length-1;t>=0;t--){var i=this._buttons[t];e.append(this._buttonDOM(i,t))}return e.addClass("dialog_buttons_contents")},_loadingHTML:function(){return'<div id="__w2_dialog_container_'+this._dialogId+'"></div>'},load:function(i,n){n=$.extend({args:[],kwargs:{},showImmediately:true,showOnLoad:true},n);this._content=this._loadingHTML();this.open_();var o=this._opener.serverCall(i).xargs(n.args).kwargs(n.kwargs).success(e(this,function(e){this._opener.__dialog__=this;var i=t._safeGetComponentByCID(this._cid);i.__opener__=this._opener;i.__dialog__=this;t._knowsAbout[this._cid].__dialog__="__dialog__";t._knowsAbout[this._cid].__dialog_wrapper__=".";t._children[this._cid].__dialog__=t._allChildren[this._cid][0];this._containsComponent=true;this.checkDialogPosition()})).contentFor($(this._dialogContainerId),{parentCID:this._cid},true);if(this.opts.error){o.error.apply(this,this.opts.error)}if(this.opts.except){o.except.apply(this,this.opts.except)}o.send();return this}});t.Dialog.openerFor=function(e){return e.lookup("__dialog_wrapper__").__opener__};t.Dialog.dialogFor=function(e){return e.lookup("__dialog_wrapper__").__dialog__};if(!t.Dialog._dialogCounter){t.Dialog._dialogCounter=0}if(!t.Dialog._instance){t.Dialog._instance=null}t.Button=i.extend({__init__:function(e,t,i,n){this._dialog=e;this._text=t;this._callback=i;this._opts=n||{};this._priority=50;this._type="action"},text:function(e){this._text=e},callback:function(e){this._callback=e},click_:function(){var e=true;if(typeof this._callback=="function"){if(this._callback.call(this._dialog,this._dialog._callbackArg(this))===false){e=false}}if(e){this._dialog.close_()}}});t.OKButton=t.Button.extend({__init__:function(t,i,n,o){o=$.extend({style:"ok_button"},o);this._super(t,i||"OK",e(this,function(){var e=true;if(typeof n=="function"){if(n.call(this,this._dialog._callbackArg(this))===false){e=false}}if(e){return this._dialog.ok_.call(this._dialog,this)}else{return e}}),o);this._priority=75;this._type="submit"}});t.CancelButton=t.Button.extend({__init__:function(t,i,o,s){s=$.extend({style:"cancel_button"},s);this._super(t,i||n.cancel,e(this,function(){var e=true;if(typeof o=="function"){if(o.call(this,this._dialog._callbackArg(this))===false){e=false}}if(e){this._dialog.cancel_.call(this._dialog,this)}}),s);this._priority=25;this._type="link"}});t.CancelActionButton=t.CancelButton.extend({__init__:function(e,t,i,n){this._super(e,t,i,n);this._type="action"}})})()},{webnode2:true,Class:true,"lang/fun":true,settings:true});require.install("w2.modal",function(require,exports,module){(function(){require("jquery.webnode2");var e=require("webnode2"),t=require("Class").Class;e.Modal=t.extend({__init__:function(t,i){this.opts=$.extend({args:[],kwargs:{},closeOnEscape:true,errorCallback:null,closeOnBackgroundClick:true},i);if(this._setOpener){this._setOpener(t)}e.Modal._modalCounter+=1;this._modalId=e.Modal._modalCounter;this.overlay=$("#__w2_modal_overlay_");this.contentBody=$("#__w2_modal_frame_placeholder_");this._initCid();this._tearDownContent()},setLiveSpinnerVisualOptions:function(){e.Loading.setSpinnerColor("#000");e.Loading.addCSSToWrapper("modal_shown")},revertLiveSpinnerVisualOptions:function(){e.Loading.setDefaultSpinnerColor();e.Loading.removeCSSFromWrapper("modal_shown")},_initCid:function(){this._cid="*modal*_"+this._modalId},_setOpener:function(e){this._opener=e},close:function(){var e=this;this.overlay.addAnimationClass("closing",function(){if(!e.overlay.hasClass("hidden")){e.overlay.addClass("hidden")}e.revertLiveSpinnerVisualOptions();e._pageScroll(true)})},_tearDownContent:function(){if(this._modalId==1){return}this.contentBody.forgetContents();var t="*modal*_"+(this._modalId-1);e.unloadComponent(t);this.contentBody.removeEditors();this.overlay.off()},_open:function(){this.setLiveSpinnerVisualOptions();this._pageScroll(false);this.contentBody.html("");this.bindKeyboardHotkeys();this.bindBackgroundClickDismissHandler();if(this.overlay.hasClass("hidden")){this.overlay.removeClass("hidden")}var t=e._safeGetComponentByCID(this._cid);e._components[this._cid]=t;var i={};i[this._cid]="*ROOT*";e.addParents(i)},_pageScroll:function(e){var t=$.getScrollbarWidth();if(e){$("body").removeClass("modal_prevent_scroll");this._addPaddingForScrollBar(false,t)}else{$("body").addClass("modal_prevent_scroll");this._addPaddingForScrollBar(true,t)}},_addPaddingForScrollBar:function(e,t){if(t===0){return}if(e){$(".SiteHeader").css("padding-right",t+"px");$("body").css("padding-right",t+"px")}else{$(".SiteHeader").css("padding-right","0px");$("body").css("padding-right","0px")}},_isScrollBarClicked:function(e){
var t=$.getScrollbarWidth();if(window.innerWidth-e.clientX<t){return true}else{return false}},bindKeyboardHotkeys:function(){var e=this;$(document).bind("keydown.__w2_modal_",function(t){if(e.opts.closeOnEscape){if(t.keyCode==27){e.close();t.stopPropagation()}}})},bindBackgroundClickDismissHandler:function(){if(!this.opts.closeOnBackgroundClick){return}var e=this;this.overlay.on("mousedown",function(t){if(t.target==this&&!e._isScrollBarClicked(t)){e.close()}})},load:function(t){this._open();var i=this;var n=this._opener.serverCall(t).xargs(i.opts.args).kwargs(i.opts.kwargs).error(function(t){e.unloadComponent(i._cid)}).success(function(t){i._opener.__modal__=i;var n=e._safeGetComponentByCID(i._cid);n.__opener__=i._opener;n.__modal__=i;e._knowsAbout[i._cid].__modal__="__modal__";e._knowsAbout[i._cid].__modal_wrapper__=".";e._children[i._cid].__modal__=e._allChildren[i._cid][0];e.Modal.currentModal=i}).contentFor(this.contentBody,{parentCID:this._cid},true);if(this.opts.errorCallback){n.error(this.opts.errorCallback)}n.send();return this}});var i={_onCloseCallBack:null,_onSubmitCallBack:null,onCloseCallBack:function(e){this._onCloseCallBack=e;return this},executeOnCloseCallBack:function(){if(this._onCloseCallBack){this._onCloseCallBack()}},onSubmitCallBack:function(e){this._onSubmitCallBack=e;return this},executeOnSubmitCallBack:function(){if(this._onSubmitCallBack){this._onSubmitCallBack.apply(null,arguments)}}};e.ModalWithCallBacks=e.Modal.extend(i);if(!e.Modal._modalCounter){e.Modal._modalCounter=0}e.Modal.openerFor=function(e){return e.lookup("__modal_wrapper__").__opener__};e.Modal.modalFor=function(t){var i;try{i=t.lookup("__modal_wrapper__").__modal__}catch(n){i=e.Modal.currentModal}return i}})()},{webnode2:true,"jquery.webnode2":true,Class:true});require.install("w2.interaction",function(require,exports,module){var e=require("log").log,t=require("w2.livenode"),i=require("webnode2");exports.InteractionModeBanner=i.Component.extend({init:function(){this._super.apply(this,arguments);i.interactionMode=this;this._changedComponents={};this._cidToDomId={};this._otherInteractions={};this._states={OFF:0,PENDING:1,ON:2,BLOCKING:3}},onLoad:function(){if(e&&e.enabled){e("w2.interaction.InteractionModeBanner.onLoad","onLoad is called on",this)}this.resumeUpdates();this._state=this._states.OFF;this._lastVal=null;this._lastDOMNode=null;this.bindInteractionMode($(":input,div[contenteditable=true]"));$(document).bind("w2addcomponents",this.fnbind(function(t,n){var o=n.parents;if(e&&e.enabled){e("w2.interaction.InteractionModeBanner.onLoad","w2addcomponents is triggered, metadata: ",n)}$.each(o,this.fnbind(function(e,t){var n=new i.VirtualComponent(e).$("%@interaction");this.bindInteractionMode(n)}))}))},updateStateForLastFocusedDOMElement:function(e){var t;if(!e){return false}if(this._state==this._states.PENDING){t=e.getAttribute("w2cid");if(this._lastVal==this._val(e)){this._changedComponents[t]=this._states.OFF;return false}else{this._changedComponents[t]=this._states.ON;this._cidToDomId[t]=this._getLiveDOMIdForElement(e);return true}}else if(this._state==this._states.ON){t=e.getAttribute("w2cid");var i=this._changedComponents[t];if(this._lastVal==this._val(e)&&i==this._states.PENDING){this._changedComponents[t]=this._states.OFF;return false}else{this._changedComponents[t]=this._states.ON;this._cidToDomId[t]=this._getLiveDOMIdForElement(e);return true}}return false},_getLiveDOMIdForElement:function(e){if(e.id){if(e.id.substr(0,3)=="ld_"){return e.id}}if(e.parentNode){return this._getLiveDOMIdForElement(e.parentNode)}else{return null}},isBlocking:function(){return this._state==this._states.BLOCKING},startBlocking:function(){console.log("startBlocking called");var e=[];$.each(this._changedComponents,this.fnbind(function(t,i){if(i==this._states.ON){var n=require("webnode2")._components[t];if(!!n.meaningfulChangeCallback&&!n.draft_space){e.push(n)}}}));this.showBanner(e);t.addContentPadding();this._setBlockingState()},_setBlockingState:function(){this._state=this._states.BLOCKING},bindInteractionMode:function(e){e.not(".ignore_interaction").bind("focus.w2interactionmode",this.fnbind(function(e){var i=e.target.getAttribute("w2cid");this._lastVal=this._val(e.target);this._lastDOMNode=e.target;if(t.state.pendingMutationCount===0){if(this._state==this._states.OFF){this._changedComponents[i]=this._states.PENDING;this._state=this._states.PENDING}else{var n=this._changedComponents[i];if(!n||n==this._states.OFF){this._changedComponents[i]=this._states.PENDING}}}})).bind("blur.w2interactionmode",this.fnbind(function(e){var t=e.target.getAttribute("w2cid");switch(this._state){case this._states.PENDING:this.updateStateForLastFocusedDOMElement(e.target);if(this._lastVal==this._val(e.target)){this._state=this._states.OFF}else{this._state=this._states.ON}break;case this._states.ON:this.updateStateForLastFocusedDOMElement(e.target);break;case this._states.OFF:case this._states.BLOCKING:break;default:console.error("Unknown state of InteractionMode at blur time... weird")}}))},_val:function(e){var t=$(e);if(t.is(":input")){return t.val()}else{return t.html()}},_setVal:function(e,t){var i=$(e);if(i.is(":input")){i.val(t)}else{i.html(t)}},showBanner:function(e){$(document).trigger("bannerShown");if(e.length>0){this.$("#@draftable").removeClass("hidden");this.$("#@not_draftable").addClass("hidden");this.$("#@resume").click(this.fnbind(function(t){$.each(e,this.fnbind(function(e,t){t.meaningfulChangeCallback()}));require("window_manager").reload();return false}))}return this.$("#@banner").show().removeClass("fade_out").addClass("fade_in")},hideBanner:function(){$(document).trigger("bannerHidden");var e=this;e.$("#@banner").removeClass("fade_in").addClass("fade_out");setTimeout(function(){e.$("#@banner").hide()},150);return},resumeUpdates:function(){this._state=this._states.OFF;this._changedComponents={};this.hideBanner();t.removeContentPadding();var e=t.state.interactionDelayedLivedepOperations;while(e.length>0&&this._state==this._states.OFF){var i=e.shift();t.onLivedepOperations(i.data,i.textStatus,true)}}})},{webnode2:true,"w2.livenode":true,log:true,window_manager:true});require.install("w2.event",function(require,exports,module){var e=require("webnode2");e.Event=t;function t(e){this.owner=e===null?this:e;this.handers=[];this.onceHanders=[]}t.prototype.bind=function(e){this.handers.push(e)};t.prototype.bindOnce=function(e){this.onceHanders.push(e)};t.prototype.unbind=function(e){var t=this.handlers.indexOf(e);if(t>=0){this.handlers.splice(t,1)}};t.prototype.trigger=function(){var e=Array.prototype.slice.call(arguments);var t=this.onceHanders.concat(this.handers);this.onceHanders=[];for(var i in t){t[i].apply(this.owner,e)}}},{webnode2:true});require.install("w2.quora",function(require,exports,module){require("w2.dialog");require("jquery.quora");require("w2.modal");var e=require("webnode2"),t=e.Dialog.extend(),i=e.ModalWithCallBacks;exports.Component=e.Component.extend({dialog:function(e){return new t(this,e)},modal:function(e,t){var n=new i(this,t||{});n.load(e);return n},setDvar:function(e,t){if(this.__dvars__===undefined){this.__dvars__={}}this.__dvars__[e]=t},getDvar:function(t){if(this.__dvars__!==undefined&&this.__dvars__[t]!==undefined){return this.__dvars__[t]}var i=this.cid;while(i){i=e._parents[i];var n=e._components[i];if(n&&n.getDvar){return n.getDvar(t)}}return null}});require("errors").setCallback(function(e){$.serverLog((e.message||"").slice(0,1e3),"ERROR",e.stack||null,false)})},{"w2.modal":true,webnode2:true,errors:true,"jquery.quora":true,"w2.dialog":true});require.install("frame_busting",function(require,exports,module){exports.check=function(){if(require("settings").enableFrameBusting){var e=false;try{e=!/\.quora\.com$/i.test(window.top.location.host)}catch(t){e=true}if(e){if(""+window.top.location!=""+window.location){window.top.location=window.location;var i=require("log");if(i&&i.enabled){i("frame_busting","Updating window.location.")}}}}}},{log:true,settings:true});require.install("init",function(require,exports,module){(function(){var e="1.02"})();require("frame_busting").check();var e=require("event").add,t=require("log").log,$=require("jquery");window.console=window.console||t.console;function i(){var e=require("visibility").getFrameElement();if(e&&e.getAttribute("autoresize")==="true"){var t=$(document),i=t.width(),n=t.height();$(e).width(i).height(n)}}e(window,"resize",i);$(document).ready(i)},{jquery:true,frame_busting:true,event:true,visibility:true,log:true});require.install("facebook",function(require,exports,module){require("jquery.whenIdle");var e=require("settings"),t=require("w2.quora").Component,i=require("cookies"),n=false,o={},s=null;window.loginInProgress=false;window.fbAsyncInit=function(){var e=require("settings").fbAppId;FB.init({appId:e,oauth:true,version:"v2.1"});FB.getLoginStatus(function(t){n=!!e;$(o).trigger("initialized")})};var r=false;function a(e){if(e===undefined){e=0}var t=function(){if(!r){r=true;var e=document,t=e.createElement("div"),i=e.createElement("script");t.setAttribute("id","fb-root");i.async=true;i.src="//connect.facebook.net/en_US/all.js";t.appendChild(i);e.body.appendChild(t)}};$.whenIdle(e,t,"facebook.requestAllJs")}function l(e,t){for(var i=0;i<e.length;i++){if(e[i].permission==t){return e[i].status=="granted"}}return false}exports.hasSpecificPermission=l;var u=t.extend({init:function(){this._super.apply(this,arguments);a(350)}});exports.isInitialized=function(){return n};function d(e){if(n){e()}else{a(350);$(o).bind("initialized",e)}}exports.onInit=d;function c(e){d(function(){FB.getLoginStatus(function(t){e(t)})})}exports.getLoginStatus=c;exports.getAuthResponse=function(){return n?FB.getAuthResponse():null};exports.getAccessToken=function(){var e=exports.getAuthResponse();return e?e.accessToken:null};exports.getExpiresIn=function(){var e=exports.getAuthResponse();return e?e.expiresIn:null};exports.getFbUid=function(){var e=exports.getAuthResponse();return e?e.userID:null};exports.FacebookAccessTokenRefresher=t.extend({onLoad:function(){var e=this;c(function(t){if(t.status=="connected"){if(window.loginInProgress===true){return}window.loginInProgress=true;var i=t.authResponse;e.serverCall("update_access_token").kwargs({fb_uid:i.userID,access_token:i.accessToken,expires:i.expiresIn}).success(function(e){if(e&&require("settings").pageMode=="post_reload"){require("window_manager").reload()}window.loginInProgress=false}).error(function(){window.loginInProgress=false}).except(function(){window.loginInProgress=false}).send()}})}});function h(e){if(s===null||e){c(function(e){if(e.status=="connected"){f()}})}}function f(e){FB.api("/me/permissions",function(t){if(t.data&&t.data.length>0){s=t.data;if(e){e(true,s)}}else{s=null;if(e){e(false)}}})}exports.asyncUpdatePermissions=h;exports.updatePermissions=f;function p(e){return s&&s[e]==1}exports.hasPermission=p;function g(e,t){for(var i=0;i<e.length;++i){if(!t(e[i])){return false}}return true}exports.requestPermissions=function(e,t){if(!g(e.split(","),p)){FB.login(function(i){if(i.status==="connected"){f(function(i,n){t(i&&g(e.split(","),p))})}else{t(false)}},{scope:e})}else{t(true)}};exports.FacebookConnectedToDifferentAccount=u.extend({show:function(){FB.api("/me",this.fnbind(function(e){if(e.name){this.$("#@fb_unknown_login").hide();this.$("#@fb_logged_in_name").text(e.name);this.$("#@fb_logged_in_link").show();this.$("#@fb_logged_in_link").attr("href",e.link)}}));this.$("#@fb_different_account").show()},events:{"click #@fb_logout":"onClickFbLogout","click #@settings":"onClickSettings"},onClickFbLogout:function(){FB.logout(this.fnbind(function(e){this.$("#@fb_different_account").hide();this.trigger("hide")}));return false},onClickSettings:function(){this.trigger("hide");this.$("#@fb_different_account").hide()}});function _(e,t,i){if(!n){h();return false}var o=null;if(FB.getAuthResponse()){o=FB.getAuthResponse().userID}if(o&&e){if(o==e){if(p("publish_stream")){t()}else{m(e,t)}}else{i(o)}}else{m(e,t,i)}return false}exports.maybePromptToPublish=_;function m(e,t,i){FB.login(function(n){if(n.status=="connected"){var o=n.authResponse;if(!e||o.userID==e){t(o.userID,o.accessToken,o.expiresIn)}else{i(o.userID)}}},{scope:"publish_stream"})}exports._disconnect=function(){FB.getLoginStatus(function(e){if(e.authReponse){FB.api({method:"auth.revokeAuthorization"},function(e){if(e){console.log("Successfully disconnected")}else{console.error("Disconnection failed")}},console.error)}else{console.warn("Already not connected")}})};exports.FacebookNetworkShare=u.extend({events:{"click #@share":"onClick"},onClick:function(){var e=this;if(e.is_debugging_mode){console.log(e.share_url);console.log(e.target)}FB.ui({method:"feed",display:"popup",link:e.share_url},function(t){if(t&&t.post_id){i.setQfeedLog(e,"ShareFacebook");i.setTlog({type:"ShareFacebook"});e.serverCall("record_facebook_share").send()}else{}});return false}});var v=exports.FacebookConnectButtonBase=u.extend({connect:function(){FB.login(this.fnbind(function(e){if(e&&e.status=="connected"){this.onLogin(e.authResponse);this.trigger("fb_login",e.authResponse)}else{this.onLoginFailed();this.trigger("fb_login_failed")}}),{scope:this.perms})},onClick:function(){},onLogin:function(e){},onLoginFailed:function(){},events:{"click #@facebook_connect_button":"onClickFacebookConnectButton"},onClickFacebookConnectButton:function(){if(n){this.connect();this.onClick();this.trigger("click")}return false}});exports.FacebookConnectButton=v.extend({onLogin:function(e){this._onLogin(e)},_onLogin:function(e){var t=e.accessToken;var i=this.serverCall("connect_facebook").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn}).success(this.fnbind(function(){this.trigger("fb_connected")}));if(this.live_mutate){i.liveMutate().send()}else{i.send()}}});exports.FacebookConnectAddToTimelineButton=exports.FacebookConnectButton.extend({onLogin:function(e){f(this.fnbind(function(t,i){if(t&&l(i,"publish_actions")){this._onLogin(e)}else{this.onLoginFailed()}}))}});exports.FacebookAccountConnectedTo=u.extend({events:{"click #@facebook_disconnect_button":"onClickFacebookDisconnectButton"},onClickFacebookDisconnectButton:function(){this.serverCall("disconnect_facebook").liveMutate().success(function(){FB.getLoginStatus(function(){},true)}).send();return false}});exports.FacebookOptionLink=u.extend({onLoad:function(){this.bindOptionEnable();this.bindOptionDisable();this.bindHideClick()},bindOptionEnable:function(){},bindOptionDisable:function(){},bindHideClick:function(){},events:{"click #@enable":"onClickEnable","click #@disable":"onClickDisable","click #@hide":"onClickHide"},onClickEnable:function(){this.serverCall("toggle_option").kwargs({enabled:true}).liveMutate().send();return false},onClickDisable:function(){this.serverCall("toggle_option").kwargs({enabled:false}).liveMutate().send();return false},onClickHide:function(){this.serverCall("hide").liveMutate().send();return false}});exports.FacebookToggleTimelineLink=u.extend({onEnable:function(e){this.serverCall("enable_timeline").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn}).liveMutate().send()},onDisable:function(){this.serverCall("disable_timeline").liveMutate().send()},onLoginFailed:function(){this.$("#@option").attr("checked",false)},events:{"click #@enable":"onClickEnable","click #@disable":"onClickDisable"},onClickEnable:function(){FB.login(this.fnbind(function(e){if(e&&e.status=="connected"){var t=e.authResponse;this.trigger("fb_login",e.authResponse);f(this.fnbind(function(e,i){if(e&&l(i,"publish_actions")){this.onEnable(t)}else{this.onLoginFailed()}}))}else{this.onLoginFailed();this.trigger("fb_login_failed")}}),{scope:"publish_actions"});return false},onClickDisable:function(){this.onDisable();return false}});var w=exports.SignupFacebookConnectButtonBase=v.extend({onClick:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_facebook"}).send()},onLogin:function(e){this.serverCall("on_facebook_connected").kwargs({fb_uid:e.userID,access_token:e.accessToken,expires:e.expiresIn}).send();this._onLogin(e)},onLoginFailed:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_connect_failed"}).send()},_onLogin:function(e){}});exports.SignupFacebookConnectButton=exports.SignupFacebookConnectButtonBase.extend({_onLogin:function(e){this.queryFacebookProfile(e)},queryFacebookProfile:function(e){FB.api({method:"fql.query",query:"SELECT name, pic_big, contact_email FROM user WHERE uid = "+e.userID},this.fnbind(function(t){this.trigger("fb_connected",e,t);if(t&&t[0]){this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_connected"}).send()}}))}});exports.SignupFacebookConnectButtonWithoutLoginHandler=exports.SignupFacebookConnectButtonBase;exports.SignupFacebookConnectButtonLoggedinWall=w.extend({onClick:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_facebook"}).send();this.serverCall("fb_connect_click").send()}});function b(e,t,i){d(function(){FB.ui({method:"apprequests",message:e,to:t.join(",")},i)})}function k(e,t){d(function(){FB.ui({method:"apprequests",message:e},t)})}function C(e,t){d(function(){FB.api(e,"delete",t)})}function y(e,t){d(function(){e.method="send";FB.ui(e,t)})}exports.InviteViaFacebookMessageButton=u.extend({onLoad:function(){if(this.auto_click){this.$("#@invite_button").click()}},invite:function(){var e=exports.getFbUid();if(this.from_fb_uid!=e&&e){this.serverCall("facebook_connected_to_different_account").send()}else{this.sendMessage()}},sendMessage:function(){var e={to:this.to_fb_uid,link:this.link_url,name:this.link_title,description:this.description,picture:this.picture,display:"popup"};y(e,this.fnbind(function(e){if(e&&!("error_code"in e)){this.serverCall("record_facebook_invite_message").kwargs({uid:this.uid,to_fb_uid:this.to_fb_uid,code:this.code,location:this.location}).send()}}))},events:{"click #@invite_button":"onClickInviteButton"},onClickInviteButton:function(){this.serverCall("record_facebook_invite_click").kwargs({uid:this.uid,to_fb_uid:this.to_fb_uid,code:this.code,location:this.location}).send();this.invite();return false}});require("win.load").add(function(){$(document).bind("fire_facebook_conversion_pixel",function(e,t){var i=new Image(1,1);i.src="https://www.facebook.com/offsite_event.php?id="+t+"&amp;value=0.01&amp;currency=USD"})})},{cookies:true,window_manager:true,settings:true,"jquery.whenIdle":true,"win.load":true,"w2.quora":true});require.install("oauth",function(require,exports,module){exports.generateOAuthConnectFunction=function e(t,i,n,o){n=n||400;o=o||800;return function(e,s){var r=null;$(document).one(t+"."+Math.random(),function(t,i){var n=i.accessToken,o=i.userData;if(r){clearInterval(r);r=null}e(n,o)});var a=screen.width/2-o/2;var l=screen.height/2-n/2;var u="width="+o+", height="+n+"location=no,toolbar=no,status=no,top="+l+",left="+a;var d=window.open(i,"_BLANK",u);if(s){r=setInterval(function(){if(r&&d.closed){clearInterval(r);s()}},200)}}}},{});require.install("twitter",function(require,exports,module){var e=require("w2.quora").Component,t=require("oauth").generateOAuthConnectFunction,i=require("cookies"),n=false,o={};exports.asyncInit=function(){require("win.load").add(function(){if(window.twttr){return}var e=document.createElement("script");var t={_e:[],ready:function(e){t._e.push(e)}};window.twttr=t;e.async=true;e.src="//platform.twitter.com/widgets.js";document.getElementById("tw-root").appendChild(e);window.twttr.ready(function(e){n=true;$(o).trigger("initialized")})})};function s(e){if(n){e()}else{$(o).bind("initialized",e)}}var r=t("twitter_oauth_approved","/twitter/oauth_window",400,800);exports.connectToTwitter=r;var a=exports.TwitterConnectButton=e.extend({oauthWindowOpen:false,loginInterval:null,connect:function(){var e=this;if(e.oauthWindowOpen){return}e.oauthWindowOpen=true;if(typeof localStorage!=="undefined"){this.loginInterval=setInterval(function(){var t=localStorage.getItem("twloginresult");if(t!==null){t=JSON.parse(t);clearInterval(e.loginInterval);localStorage.removeItem("twloginresult");e.oauthWindowOpen=false;e.onLogin(t.accessToken,t.userData);e.trigger("tw_login",t.accessToken,t.userData)}},300)}r(function(t,i){e.oauthWindowOpen=false;clearInterval(e.loginInterval);e.onLogin(t,i);e.trigger("tw_login",t,i)},function(){e.oauthWindowOpen=false;clearInterval(e.loginInterval);e.onLoginFailed();e.trigger("tw_login_failed")})},onLogin:function(e,t){},onLoginFailed:function(){}});exports.SignupTwitterConnectButton=a.extend({events:{"click #@twitter_connect_button":"onClick"},onClick:function(){this.connect();this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_twitter"}).send();return false},onLogin:function(e,t){this.serverCall("on_twitter_connected").kwargs({tw_uid:t.twitter_uid,access_token:e.key,screen_name:t.twitter_screen_name,"protected":t["protected"]}).send()},onLoginFailed:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_twitter_connect_failed"}).send()}});var l=exports.TwitterEventComponent=e.extend({isTweeted:function(e){var t=this;var i=String(e.target.id);var n=String(t.cid);return i.indexOf(n)>-1}});var u=exports.TwitterNetworkShare=l.extend({events:{"click #@share":"onClick"},onClick:function(){return true},onLoad:function(){var e=this;s(function(){window.twttr.events.bind("tweet",function(t){if(e.isTweeted(t)){i.setQfeedLog(e,"ShareTwitter");i.setTlog({type:"ShareTwitter"});e.serverCall("record_tweet").send()}})})}});exports.TwitterConnectCallbackPage=e.extend({onLoad:function(){i.cookie("twitter_oauth_access_key",this.access_token.key,{path:"/twitter/"});if(window.opener&&window.opener.document){window.opener.$(window.opener.document).trigger("twitter_oauth_approved",{accessToken:this.access_token,userData:this.user_data});window.close()}else{if(typeof localStorage!=="undefined"){localStorage.setItem("twloginresult",JSON.stringify({accessToken:this.access_token,userData:this.user_data}))}window.close()}}})},{oauth:true,cookies:true,"win.load":true,"w2.quora":true});require.install("google_",function(require,exports,module){require("jquery.whenIdle");var e=require("settings"),t=require("w2.quora").Component,i=false,n={};exports.GoogleConnectCallbackPage=t.extend({onLoad:function(){if(window.opener&&window.opener.document){if(this.access_token&&this.user_data){window.opener.$(window.opener.document).trigger("google_oauth_approved",{accessToken:this.access_token,userData:this.user_data})}window.close()}else{if(typeof localStorage!=="undefined"){localStorage.setItem("googloginresult",JSON.stringify({accessToken:this.access_token,userData:this.user_data}))}window.close()}}});exports.GooglePlusNetworkShare=t.extend({events:{"click #@share":"onClick"},onClick:function(){window.open(this.share_url,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");return false}});var o=!!e.google_api_html_5_async_loading;function s(e){if(e===null){e=0}var t=function(){if(!o){o=true;var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//apis.google.com/js/client:plusone.js?onload=gapiAsyncInit";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}};$.whenIdle(e,t,"google_.requestGapiJs")}window.gapiAsyncInit=function(){$(n).trigger("initialized")};exports.getUserProfile=function(e,t){var i=function(e){var i=e.emails.filter(function(e){return e.type==="account"})[0].value;var n={name:e.displayName,email:i,verfied_email:e.verified,photo_url:e.image.url};t(n)};window.gapi.client.load("plus","v1",function(){window.gapi.auth.setToken(e);var t=window.gapi.client.plus.people.get({userId:"me"});t.execute(i)})};exports.onInit=function(e){if(!o){require("win.load").add(function(){s()})}if(typeof gapi!=="undefined"){e()}else{$(n).bind("initialized",e)}}},{"w2.quora":true,"win.load":true,"jquery.whenIdle":true,settings:true});require.install("mathjax",function(require,exports,module){var e=require("settings");function t(t){var i=function(){this.processClass="render_latex";var t="https://cdn.mathjax.org/mathjax/2.5-latest/MathJax.js?config=TeX-AMS_HTML.js";if("shouldShowSlowConnectionMode"in e&&e.shouldShowSlowConnectionMode&&!document.getElementsByClassName(this.processClass).length){return}var i=n();var o=document.createElement("script");o.type="text/x-mathjax-config";o.src=t;o.appendChild(document.createTextNode(i));var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(o,r);r.parentNode.insertBefore(s,r)};var n=function(){var e={showMathMenu:false,messageStyle:"none",errorSettings:o(),"HTML-CSS":s(),tex2jax:r(),TeX:a()};return"MathJax.Hub.Config("+JSON.stringify(e)+");"};var o=function(){return{style:{color:"#000000","font-style":"normal"}}};var s=function(){return{linebreaks:{automatic:true,width:"container"},EqnChunk:t?10:150,EqnChunkDelay:t?100:20}};var r=function(){return{inlineMath:[["[math]","[/math]"]],displayMath:[],ignoreClass:"edit_latex|qtext_editor_content",processClass:this.processClass}};var a=function(){return{noUndefined:{attributes:{mathcolor:"red"}},Macros:{C:"{\\mathbb{C}}",N:"{\\mathbb{N}}",O:"{\\emptyset}",Q:"{\\mathbb{Q}}",R:"{\\mathbb{R}}",Z:"{\\mathbb{Z}}"}}};i()}exports.onInit=function(e){require("win.load").add(function(){t(e)})}},{"win.load":true,settings:true});require.install("siteuri",function(require,exports,module){function e(e){this.message=this.errorType+": "+e}e.prototype=new Error;e.prototype.errorType="SiteURIError";e.prototype.constructor="SiteURIError";var t=function(e,t){var i=require("settings");var n;if(t){n="quora.com"}else{n=i.subdomain_suffix||"quora.com"}if(e){return e+"."+n}else{return"www."+n}};exports.netlocForSubdomainName=t;var i=function(e,i){return"http://"+t(e,i)+"/"};exports.baseUrlForSubdomainName=i;var n=/https?:\/\/(?:([^.\/]+)\.)?((?:[^.\/]+\.)*quora\.com)(\/.*)?/;function o(e){if(e.substring(0,5)=="http:"){return"https:"+e.substring(5)}else{return e}}function s(e){var i=e.match(n);if(!i){return false}var o=i[1],s=i[2],r=t();if("www."+s!=r){var a=require("settings"),l=a.subdomain_name,u=a.subdomain_suffix,d="http://www."+u+"/";if(o!="www"&&o&&"www."+o+"."+s==r){var c=e.replace("://","://www.").match(n);if(c){return c}}return false}return i}var r=function(e){return s(e)!==false};exports.isSiteAbsoluteUrl=r;var a=function(e){return r(e)||e[0]=="/"};exports.isSiteUrl=a;var l=function(e,t){return new u(e,t)};exports.URI=l;var u=require("Class").Class.extend({__init__:function(t,i){if(t instanceof u){t=t.unicode()}var n=s(t),o=i&&i.subdomainName||null,r=i&&i.secure||false,a;if(n){if(o){throw e("subdomain context should not be set for absolute url, url = "+t+", subdomain = "+o)}o=n[1];if(o=="www"){o=null}a=n[3]||"";if(a===""){a="/"}if(t.substring(0,5)=="https"){r=true}}else{a=t}if(a[0]!="/"){throw e("invalid site uri input "+t)}this.relativeUrl=a;this.subdomainName=o;this.isSecure=r;return this},unicode:function(e){if(require("settings").force_use_absolute_links){return this.absolute(e)}var t=this.relativeUrl;if(this.subdomainName||require("settings").subdomain_name){var n=this.subdomainName||require("settings").default_uri_subdomain_name;t=i(n,e)+t.substring(1);if(t.charAt(t.length-1)=="/"){t=t.substring(0,t.length-1)}}if(this.isSecure){t=o(t)}return t},absolute:function(e){var t=i(this.subdomainName,e),n=t+this.relativeUrl.substring(1);if(this.isSecure){n=o(n)}return n},secure:function(e){return o(this.absolute(e))}});exports.SiteURI=u},{Class:true,settings:true});require.install("login",function(require,exports,module){var $=require("jquery"),e=require("w2.quora").Component,t=require("window_manager"),i=require("siteuri").URI,n,o;$(document).bind("w2rpcexception-login_required.default",function(e,i){if(i.rpc.__liveMutation){require("w2.livenode").mutationDoneAfterVersion(i.rpc.__liveMutationInfo.transactionId,0)}n.login(function(){var e=i.rpc;if(i.response.exception.args[1]===true){e=e.liveMutate()}var n=e.__success;e.__success=function(){if(typeof n=="function"){n.apply(this,arguments)}t.reload()};e.send()},function(){$(document).trigger("login_cancelled")},{qid:i.rpc._component.__js_init.qid,aid:i.rpc._component.__js_init.aid,page_type:i.rpc._component.__js_init.vote_source})});$(document).bind("w2rpcexception-logged_out_writing_exp.default",function(e,i){if(i.rpc.__liveMutation){require("w2.livenode").mutationDoneAfterVersion(i.rpc.__liveMutationInfo.transactionId,0)}o.login(function(){var e=i.rpc;if(i.response.exception.args[1]===true){e=e.liveMutate()}var n=e.__success;e.__success=function(){if(typeof n=="function"){n.apply(this,arguments)}t.reload()};e.send()},function(){$(document).trigger("login_cancelled")})});$(document).bind("quora_logout",function(e){t.reload()});exports.LiveLogin=e.extend({init:function(){this._super.apply(this,arguments);this._dialog=null;n=this},login:function(e,t,i){var n=this;n._dialog=n._dialog||n.dialog({closeOnClickOut:true,hideDialog:true}).cancel(t,false).open(function(){n._loginListener=n.$(document).bind("quora_login",function(t){n._dialog.ok_();if(typeof e=="function"){e()}})}).close(function(){n._dialog=null}).load("login_signup_combo_dialog",{kwargs:$.extend({default_tab:"signup"},i)})},_logout:function(){this.serverCall("_logout").send()}});exports.LiveLoginWritingExp=e.extend({init:function(){this._super.apply(this,arguments);this._dialog=null;o=this},login:function(e,t){var i=this;i._dialog=i._dialog||i.dialog({closeOnClickOut:true,hideDialog:true}).cancel(t).open(function(){i._loginListener=i.$(document).bind("quora_login",function(t){i._dialog.ok_();if(typeof e=="function"){e()}})}).close(function(){i._dialog=null}).load("login_signup_combo_dialog",{kwargs:{default_tab:"signup",source:"logged_out_writing"}})}});exports.LiveLoginDialog=e.extend({onLoad:function(){var e=this;e.$("#@view").click(function(){e.$("#view_live_login_dialog_login").addClass("hidden");e.$("#live_login_dialog_login").removeClass("hidden");return false});e.$("#@show_login_link").click(function(){e.$("#@inline_login").removeClass("hidden");e.$("#@show_login_link").hide();return false});e.$("%@tabs").click(function(t){e.select($(this).attr("show"));return false});this.select(this.default_tab)},select:function(e){this.$("%@contents").hide();this.$("#@"+e).show();this.$("%@tabs").removeClass("selected");this.$("#@"+e+"_select").addClass("selected")}});exports.LoginButton=e.extend({onLoad:function(){this.$("#@login_link").click(function(e){var n=i("/?next="+encodeURIComponent(t.getURL()));t.navigateTo(n.unicode());return false})}});var s=exports.InlineLogin=e.extend({onLoad:function(){var e=this;var t=function(t){var i=t.keyCode||t.which;if(i==13){e.$("#@submit_button").click()}};var i=e.fnbind(t);e.$("#@password").keydown(i);e.$("#@email").keydown(i);e.$("#@resend_confirmation").click(function(t){e.serverCall("resend_confirmation_link").kwargs({email:e._email()}).success(function(){e.hideAllErrors()}).send();return false});e.$("#@reset_password_link").click(this.fnbind(e.resetPasswordHandler));e.$("#@email").blur(function(){setTimeout(function(){e.updatePreview()},10)});e.$("#@submit_button").click(function(){e.checkPassword();return false});e.$("#@submit_button").bind("touchend",function(){e.checkPassword();return false});e.$("#@login_link").click(function(){e.$("#@associated").addClass("hidden");e.$("#@alt_login_row").addClass("hidden");e.$("#@login_form").removeClass("hidden");e.$("#@email").focus();return false});$(document).ready(function(){e.updatePreview()})},resetPasswordHandler:function(){var e=this;e.serverCall("reset_password").kwargs({email:e._email()}).success(function(){e.hideAllErrors()}).send();return false},updatePreview:function(){this._updatePreviewMemCache=this._updatePreviewMemCache||{};var e=this,t=e._email(),i=e._updatePreviewMemCache,n=function(n){i[t]=n;if(e.customSuccessUpdatePreviewCallback){
e.customSuccessUpdatePreviewCallback(n);e.removeButtonDisabled()}else{e.$(".usercard_big").fadeTo(1,1);e.$("#@preview").hide();var o=false,s=n.name.split(" ")[0];e.$("%passwordless_users").find(".name_span:visible").each(function(e){if($(this).text()!=s){$(this).parents(".usercard_big").fadeTo(1,.3)}else{o=true}});if(!o){e.$("#@associated").addClass("hidden");e.$("#@alt_login_row").addClass("hidden");e.$("#@login_form").removeClass("hidden");e.$("#@password").focus();e.$("#@name").text(n.name);e.$("#@pic").attr("src",n.photo_url);e.$("#@preview").show();e.removeButtonDisabled()}e.hideAllErrors()}};if(i[t]){n(i[t]);return}e.serverCall("preview_info").kwargs({email:t}).success(n).except("email_not_found",function(t){e.hideAllErrors();e.showErrorOnComponent("#@email_not_found_error","#@email");e.$("#@preview").hide();e.addButtonDisabled();return false}).except("no_email",function(t){e.hideAllErrors();e.$("#@preview").hide();e.addButtonDisabled()}).except("email_unconfirmed",function(t){e.$("#@preview").hide();e.hideAllErrors();e.showErrorOnComponent("#@email_not_confirmed_error","#@email");e.removeButtonDisabled()}).except("refused",function(t){e.hideAllErrors();e.$("#@preview").hide();e.removeButtonDisabled()}).send()},removeButtonDisabled:function(){this.$("#@submit_button").removeClass("submit_button_disabled")},addButtonDisabled:function(){this.$("#@submit_button").addClass("submit_button_disabled")},loginKwargs:function(){var e=this.$("#@email").val(),t=this.$("#@password").val(),i=+this.$("#@allow_passwordless").is(":checked");return{email:e,password:t,passwordless:i}},loginSuccessCallback:function(e){if(this.customSuccessLoginCallback){this.customSuccessLoginCallback(e)}else{var t=e;this.hideAllErrors();if(require("settings").uid==t||require("settings").pageMode=="post_reload"){$(document).trigger("quora_login")}}},checkPassword:function(){this.hideAllErrors();var e=this;e.serverCall("do_login").kwargs(e.loginKwargs()).success(e.fnbind(e.loginSuccessCallback)).except("email_not_found",function(){e.hideAllErrors();e.showErrorOnComponent("#@email_not_found_error","#@email")}).except("incorrect_password",function(){e.hideAllErrors();e.showErrorOnComponent("#@incorrect_password_error","#@password")}).except("email_unconfirmed",function(){e.hideAllErrors();e.showErrorOnComponent("#@email_not_confirmed_error","#@email")}).except("banned_user",function(){e.hideAllErrors();e.serverCall("login_user_is_banned").kwargs(e.loginKwargs()).send()}).except("too_many_attempts",function(){e.hideAllErrors();e.serverCall("login_user_rate_limited").kwargs(e.loginKwargs()).send()}).liveMutate().send()},_email:function(){return this.$("#@email").val()},hideAllErrors:function(){this.$("#@email_not_found_error").hide();this.$("#@email_not_confirmed_error").hide();this.$("#@incorrect_password_error").hide();this.$("#@email_menu","#@password_menu").hide();this.$("#@email, #@password").removeClass("input_validation_error")},showErrorOnComponent:function(e,t){this.$(e).show();this.$(t+"_menu").show();this.$(t).addClass("input_validation_error")}});exports.FacebookConnectInlineLogin=s.extend({loginKwargs:function(){var e=this._super.apply(this,arguments),t=require("facebook");e.fb_uid=t.getFbUid();e.fb_access_token=t.getAccessToken();e.fb_expires=t.getExpiresIn();return e},loginSuccessCallback:function(e){var t=e[0],i=e[1];this.hideAllErrors();if(require("settings").uid==t||require("settings").pageMode=="post_reload"){if(i){$(document).trigger("quora_login",{__pmsg__:i})}else{$(document).trigger("quora_login")}}}});var r=exports.InlineLoginProfile=e.extend({loginKwargs:function(){return{}},loginSuccessCallback:function(e){if(require("settings").pageMode=="post_reload"){$(document).trigger("quora_login")}},onLoad:function(){var e=this;e.$("#@container").click(function(){if(require("settings").uid==e.uid){$(document).trigger("quora_login");return false}if(e.passwordless){e.serverCall("do_login").kwargs(e.loginKwargs()).success(e.fnbind(e.loginSuccessCallback)).liveMutate().send()}else{var t=e.lookup("inline_login");t.$("#@email").val(e.email);t.$("#@allow_passwordless").removeAttr("checked");t.updatePreview();t.$("#@password").focus()}return false});e.$("#@x_person").click(function(){e.serverCall("x_person").liveMutate().send();return false})}});exports.FacebookConnectInlineLoginProfile=r.extend({loginKwargs:function(){var e=require("facebook");return{fb_uid:e.getFbUid(),fb_access_token:e.getAccessToken(),fb_expires:e.getExpiresIn()}},loginSuccessCallback:function(e){var t=e[0],i=e[1];if(require("settings").pageMode=="post_reload"){if(i){$(document).trigger("quora_login",{__pmsg__:i})}else{$(document).trigger("quora_login")}}}});exports.LoginSignal=e.extend({onLoad:function(e){if(!e){var t=this.uid,i=require("settings");if(i.uid==t){$.serverLog("Strange... got a login signal for uid="+t+" but that uid was already logged in")}i.uid=t;$(document).trigger(t?"quora_login":"quora_logout")}}});function a(){if(window.opener&&window.opener.showFollowingButton){window.opener.showFollowingButton()}}function l(){setTimeout(function(){window.close()},1e3)}exports.LoggedOutHomeHeaderInlineLogin=s.extend({onLoad:function(){this._super.apply(this,arguments);if(this.$("#@associated").find(".inline_login_profile_box").is(":visible")){this.showTOS()}this.$("#@email").focus();this.$("#@forgot_password_link").click(this.fnbind(this.resetPasswordHandler));this.$("#@password").focus(this.fnbind(function(){this.$("#@remember_me_option").removeClass("hidden")}));this.$("#@password").keyup(this.fnbind(function(){this.showTOS()}))},hideAllErrors:function(){this._super.apply(this,arguments);this.$("%@login_options").show()},showTOS:function(){this.$("#@login_tos").removeClass("hidden");this.$("#@logged_out_header_login").removeClass("top_10")},showErrorOnComponent:function(e,t){this._super.apply(this,arguments);this.$("%@login_options").hide()},toggleLoginOptions:function(){if(this.$("#@connect_options").is(":visible")){this.$("#@connect_options").hide();this.$("#@login_form").show()}else{this.$("#@connect_options").show();this.$("#@login_form").hide()}return true},events:{"click #@cancel_link":"toggleLoginOptions"}});exports.LoginPageLoginListener=e.extend({init:function(){this._super.apply(this,arguments);this._enabled=true},onLoad:function(){var e=this;e.$(document).bind("quora_login.LoginPageLoginListener",function(i,n){if(e._enabled){var o=e.next,s=[],r;for(r in n){s.push(r+"="+encodeURIComponent(n[r]))}if(s.length>0){o+=o.indexOf("?")==-1?"?":"&";o+=s.join("&")}t.navigateTo(o)}})}})},{jquery:true,window_manager:true,siteuri:true,settings:true,"w2.livenode":true,facebook:true,"w2.quora":true});require.install("network",function(require,exports,module){var $=require("jquery");$(document).bind("w2rpcexception-network_membership_required.default",function(){window.location="/join"})},{jquery:true});require.install("dialog",function(require,exports,module){var e=require("w2.quora").Component,t=require("w2.keycombo");exports.Dialog=e.extend({onLoad:function(){this.successCallback=null;this.ok2Submit=true;this.submitted=false;this.$("#@submit").click(this.fnbind(this.submit));this.$("#@cancel").click(this.fnbind(function(){this.close();return false}))},submit:function(){this.request();return false},request:function(){var e=this.getPars();if(this.submitted||!e||!this.ok2Submit){return false}this.submitted=true;this.submitServerCall(e)},getPars:function(){return{}},setSetup:function(e){e.each(this.fnbind(function(e,t){this.options[e]=t}))},setSuccessCallback:function(e){this.successCallback=e},setFocusCallback:function(e){this.lookup("editor").setFocusCallback(e)},setBlurCallback:function(e){this.lookup("editor").setBlurCallback(e)},close:function(){if($("#generic_dialog").length){$("#generic_dialog").remove()}else{require("webnode2").Dialog.dialogFor(this).close_()}},submitServerCall:function(e){this.serverCall("dialog_submit_controller").liveMutate().kwargs(e).success(this.fnbind(function(e){if(this.successCallback){this.successCallback(e)}this.close()})).send()}});exports.AddCommentDialog=exports.Dialog.extend({onLoad:function(){this._super.apply(this,arguments);this.lookup("editor").focus()},getPars:function(){if(this.comment_required&&this.lookup("editor").isEmpty()){return false}return{comment:this.lookup("editor").serialize()}}});exports.BanUserDialog=exports.AddCommentDialog.extend({getPars:function(){var e=this._super.apply(this,arguments);if(e){e.removeMessages=this.$("#@checkbox").attr("checked")=="checked"}return e}});function i(e){return/[^\u0000-\u00ff]/.test(e)}exports.DialogLink=e.extend({onLoad:function(){if(this.tooltip){this.$("#@link").tooltip({contents:this.tooltip})}this.$("#@link").click(this.fnbind(function(){this.click();return false}))},addOption:function(e,t){if(t&&i(JSON.stringify(t))){t=window.unescape(encodeURIComponent(t))}this.options[e]=t},click:function(){var e=encodeURIComponent(JSON.stringify(this.options));$(".ContentWrapper").dialog({title:null,url:"/dialog/ajax_get_dialog_GET?type="+this.type+"&object_id="+this.object_id+"&options="+e,buttons_hide_on_close:this.buttons_hide_on_close,buttons:null})},triggerClick:function(e){$.each(e,this.fnbind(function(e,t){this.addOption(e,t)}));this.click()}});exports.AdminMessageDialog=exports.Dialog.extend({onLoad:function(){this._super.apply(this,arguments);this.lookup("editor").focus()},getPars:function(){if(this.lookup("editor").isEmpty()){return false}var e=this.lookup("editor").serialize();return{msg:e}}});exports.KeyboardShortcutsDialog=e.extend({onLoad:function(){this.onKeyCombination(document.body,"Shift-/",this.fnbind(this.toggle))},toggle:function(){if(this._dialog&&this._dialog._opened){this.hideDialog()}else{this.showDialog()}},hideDialog:function(){this._dialog.close_()},showDialog:function(){this._dialog=this.dialog({buttons:{},closeOnClickOut:true,dialogClass:"keyboard_shortcuts_dialog",width:"660",showXButton:true}).title(this.dialog_title).html(this.renderContents()).close(this.fnbind(function(){this._dialog=null}))},renderContents:function(){var e=function(e){if(e.toLowerCase()=="meta"){e=t.hasCmdKey?"â":"Ctrl"}return'<div class="key">'+e+"</div>"};var i=function(t,i){var n='<div class="row">',o=t.split("-");n+='<div class="col shortcut">';for(var s=0;s<o.length;++s){n+=e(o[s])}n+="</div>";n+='<div class="col shortcut_description">'+i+"</div>";n+="</div>";return n};var n=function(e,t){var n='<div class="category">';n+='<div class="category_name">'+e+"</div>";for(var o in t){n+=i(o,t[o])}n+="</div>";return n};var o="";for(var s in this.descriptions){o+=n(s,this.descriptions[s])}return o}});exports.EnableFAQFlagOverflowDialog=exports.AddCommentDialog.extend({submitServerCall:function(e){this.serverCall("dialog_submit_controller").kwargs(e).success(this.fnbind(function(e){window.location.href=e;this.close()})).send()}})},{webnode2:true,"w2.keycombo":true,"w2.quora":true});require.install("fastclick",function(require,exports,module){function e(t){"use strict";var i,n=this;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=t;if(!t||!t.nodeType){throw new TypeError("Layer must be a document node")}this.onClick=function(){return e.prototype.onClick.apply(n,arguments)};this.onMouse=function(){return e.prototype.onMouse.apply(n,arguments)};this.onTouchStart=function(){return e.prototype.onTouchStart.apply(n,arguments)};this.onTouchMove=function(){return e.prototype.onTouchMove.apply(n,arguments)};this.onTouchEnd=function(){return e.prototype.onTouchEnd.apply(n,arguments)};this.onTouchCancel=function(){return e.prototype.onTouchCancel.apply(n,arguments)};if(e.notNeeded(t)){return}if(this.deviceIsAndroid){t.addEventListener("mouseover",this.onMouse,true);t.addEventListener("mousedown",this.onMouse,true);t.addEventListener("mouseup",this.onMouse,true)}t.addEventListener("click",this.onClick,true);t.addEventListener("touchstart",this.onTouchStart,false);t.addEventListener("touchmove",this.onTouchMove,false);t.addEventListener("touchend",this.onTouchEnd,false);t.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){t.removeEventListener=function(e,i,n){var o=Node.prototype.removeEventListener;if(e==="click"){o.call(t,e,i.hijacked||i,n)}else{o.call(t,e,i,n)}};t.addEventListener=function(e,i,n){var o=Node.prototype.addEventListener;if(e==="click"){o.call(t,e,i.hijacked||(i.hijacked=function(e){if(!e.propagationStopped){i(e)}}),n)}else{o.call(t,e,i,n)}}}if(typeof t.onclick==="function"){i=t.onclick;t.addEventListener("click",function(e){i(e)},false);t.onclick=null}}e.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0;e.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);e.prototype.deviceIsIOS4=e.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent);e.prototype.deviceIsIOSWithBadTarget=e.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);e.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled){return true}break;case"input":if(this.deviceIsIOS&&e.type==="file"||e.disabled){return true}break;case"label":case"video":return true}return/\bneedsclick\b/.test(e.className)};e.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return true;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}};e.prototype.sendClick=function(e,t){"use strict";var i,n;if(document.activeElement&&document.activeElement!==e){document.activeElement.blur()}n=t.changedTouches[0];i=document.createEvent("MouseEvents");i.initMouseEvent(this.determineEventType(e),true,true,window,1,n.screenX,n.screenY,n.clientX,n.clientY,false,false,false,false,0,null);i.forwardedTouchEvent=true;e.dispatchEvent(i)};e.prototype.determineEventType=function(e){"use strict";if(this.deviceIsAndroid&&e.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};e.prototype.focus=function(e){"use strict";var t;if(this.deviceIsIOS&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"){t=e.value.length;e.setSelectionRange(t,t)}else{e.focus()}};e.prototype.updateScrollParent=function(e){"use strict";var t,i;t=e.fastClickScrollParent;if(!t||!t.contains(e)){i=e;do{if(i.scrollHeight>i.offsetHeight){t=i;e.fastClickScrollParent=i;break}i=i.parentElement}while(i)}if(t){t.fastClickLastScrollTop=t.scrollTop}};e.prototype.getTargetElementFromEventTarget=function(e){"use strict";if(e.nodeType===Node.TEXT_NODE){return e.parentNode}return e};e.prototype.onTouchStart=function(e){"use strict";var t,i,n;if(e.targetTouches.length>1){return true}t=this.getTargetElementFromEventTarget(e.target);i=e.targetTouches[0];if(this.deviceIsIOS){n=window.getSelection();if(n.rangeCount&&!n.isCollapsed){return true}if(!this.deviceIsIOS4){if(i.identifier===this.lastTouchIdentifier){e.preventDefault();return false}this.lastTouchIdentifier=i.identifier;this.updateScrollParent(t)}}this.trackingClick=true;this.trackingClickStart=e.timeStamp;this.targetElement=t;this.touchStartX=i.pageX;this.touchStartY=i.pageY;if(e.timeStamp-this.lastClickTime<200){e.preventDefault()}return true};e.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],i=this.touchBoundary;if(Math.abs(t.pageX-this.touchStartX)>i||Math.abs(t.pageY-this.touchStartY)>i){return true}return false};e.prototype.onTouchMove=function(e){"use strict";if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e)){this.trackingClick=false;this.targetElement=null}return true};e.prototype.findControl=function(e){"use strict";if(e.control!==undefined){return e.control}if(e.htmlFor){return document.getElementById(e.htmlFor)}return e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};e.prototype.onTouchEnd=function(e){"use strict";var t,i,n,o,s,r=this.targetElement;if(!this.trackingClick){return true}if(e.timeStamp-this.lastClickTime<200){this.cancelNextClick=true;return true}var a=e.timeStamp-this.trackingClickStart;if(a>100){return false}this.cancelNextClick=false;this.lastClickTime=e.timeStamp;i=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){s=e.changedTouches[0];r=document.elementFromPoint(s.pageX-window.pageXOffset,s.pageY-window.pageYOffset)||r;r.fastClickScrollParent=this.targetElement.fastClickScrollParent}n=r.tagName.toLowerCase();if(n==="label"){t=this.findControl(r);if(t){this.focus(r);if(this.deviceIsAndroid){return false}r=t}}else if(this.needsFocus(r)){if(e.timeStamp-i>100||this.deviceIsIOS&&window.top!==window&&n==="input"){this.targetElement=null;return false}this.focus(r);if(!this.deviceIsIOS4||n!=="select"){this.targetElement=null;e.preventDefault()}return false}if(this.deviceIsIOS&&!this.deviceIsIOS4){o=r.fastClickScrollParent;if(o&&o.fastClickLastScrollTop!==o.scrollTop){return true}}if(!this.needsClick(r)){e.preventDefault();this.sendClick(r,e)}return false};e.prototype.onTouchCancel=function(){"use strict";this.trackingClick=false;this.targetElement=null};e.prototype.onMouse=function(e){"use strict";if(!this.targetElement){return true}if(e.forwardedTouchEvent){return true}if(!e.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}else{e.propagationStopped=true}e.stopPropagation();e.preventDefault();return false}return true};e.prototype.onClick=function(e){"use strict";var t;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(e.target.type==="submit"&&e.detail===0){return true}t=this.onMouse(e);if(!t){this.targetElement=null}return t};e.prototype.destroy=function(){"use strict";var e=this.layer;if(this.deviceIsAndroid){e.removeEventListener("mouseover",this.onMouse,true);e.removeEventListener("mousedown",this.onMouse,true);e.removeEventListener("mouseup",this.onMouse,true)}e.removeEventListener("click",this.onClick,true);e.removeEventListener("touchstart",this.onTouchStart,false);e.removeEventListener("touchmove",this.onTouchMove,false);e.removeEventListener("touchend",this.onTouchEnd,false);e.removeEventListener("touchcancel",this.onTouchCancel,false)};e.notNeeded=function(t){"use strict";var i;var n;if(typeof window.ontouchstart==="undefined"){return true}n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(n){if(e.prototype.deviceIsAndroid){i=document.querySelector("meta[name=viewport]");if(i){if(i.content.indexOf("user-scalable=no")!==-1){return true}if(n>31&&window.innerWidth<=window.screen.width){return true}}}else{return true}}if(t.style.msTouchAction==="none"){return true}return false};e.attach=function(t){"use strict";return new e(t)};if(typeof define!=="undefined"&&define.amd){define(function(){"use strict";return e})}else if(typeof module!=="undefined"&&module.exports){module.exports=e.attach;module.exports.FastClick=e}else{window.FastClick=e}},{});require.install("mobile",function(require,exports,module){var $=require("jquery");var e=exports.isAndroid=function(){return navigator.userAgent.match(/Android/i)};var t=exports.isIOS=function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)};$.ready(function(){if(e()||t()){require("fastclick")(document.body)}})},{jquery:true,fastclick:true});require.install("view/modal",function(require,exports,module){var e=require("w2.quora").Component,t=require("assert").ok,i=require("webnode2");var n=exports.Base=e.extend({onLoad:function(){var e=this;e.close_button=this.$("#@close_button");e.cancel_button=this.$("#@cancel_button");e.submit_button=this.$("#@submit_button");e.close_button.on("click",function(t){e.onClose();t.preventDefault()});e.cancel_button.on("click",function(t){e.onCancel();t.preventDefault()});e.submit_button.on("click",function(t){e.onSubmit();t.preventDefault()})},_closeModal:function(){i.Modal.modalFor(this).close()},onClose:function(){this._closeModal()},onCancel:function(){this._closeModal()},onSubmit:function(){if(this.submitDisabled){return}this._closeModal()},disableSubmit:function(){this.submitDisabled=true;this.submit_button.addClass("action_disabled")},enableSubmit:function(){this.submitDisabled=false;this.submit_button.removeClass("action_disabled")}});exports.MultiStep=n.extend({onLoad:function(){this.stepCallbacks=this.getCallBacks();this.onLoadInit();this._super.apply(this,arguments);this._bindEventHandlers();t(this.key,"Please set a data key in python js_init. "+"Perhaps you have overridden some values in js_init that is causing this error?");t(this.stepCallbacks,"Sub classes should override getCallBacks() and "+"have it return a list of methods supported by each modal steps");t(this.data_cache,"Please define a data storage variable in python js_init. "+"Perhaps you have overridden some values in js_init that is causing this error?")},onLoadInit:function(){var e=this.m("init");if(typeof e==="function"){e()}},getCallBacks:function(){},_bindEventHandlers:function(){var e=this.m("eventHandlers");if(typeof e==="function"){e()}var t=this;this.$("#@back_button").on("click",function(){t.onBack()})},m:function(e){return this.stepCallbacks[this.key][e]},onSubmit:function(){var e=this.m("onSubmit");if(typeof e==="function"){e();return}if(this.submitDisabled){return}this._loadNext()},onBack:function(){var e=this.m("onBack");if(typeof e==="function"){e();return}this.loadPrev()},isLastStep:function(){var e=this.m("isLastStep");if(e){return e}return false},_loadNext:function(){var e=this;if(e.isLastStep()){e.serverCall("last_step").kwargs({data_set:{data_cache:this.persistData()}}).success(function(t){e._closeModal()}).send()}else{e.modal("load_next_modal",{kwargs:{data_set:{data_cache:this.persistData()}}})}},loadPrev:function(){this.modal("load_previous_modal",{kwargs:{data_set:{data_cache:this.persistData()}}})},_getStepData:function(){var e=this.m("getStepData");if(typeof e==="function"){var i=e();t(i,"Hey! we noticed that you defined a getStepData() method in your code, "+"but its not returning any value that is to be "+"persisted for this modal step: "+this.key+"To fix this error, either delete getStepData() definition, "+"or return a data that you want to be persisted for "+this.key);var n=this.data_cache[this.key];return $.extend(n,i)}return null},persistData:function(){this.data_cache[this.key]=this._getStepData();return this.data_cache}})},{assert:true,webnode2:true,"w2.quora":true});require.install("view/captcha",function(require,exports,module){var $=require("jquery"),e=require("w2.quora").Component,t=require("view/modal").Base,i;$(document).bind("w2rpcexception-captcha_required",function(e,t){if(t.rpc.__liveMutation){require("w2.livenode").mutationDoneAfterVersion(t.rpc.__liveMutationInfo.transactionId,0)}i.load_captcha()});exports.Captcha=e.extend({init:function(){this._super.apply(this,arguments);i=this},load_captcha:function(){var e=this;e.modal("load_captcha_modal");return false}});exports.CaptchaModal=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;var t=function(){e.serverCall("on_captcha_verified").liveMutate().success(function(){e._closeModal()}).send()};var i=grecaptcha.render(e.$("#@captcha")[0],{sitekey:e.recaptcha_key,theme:"light",callback:t})}})},{jquery:true,"w2.livenode":true,"view/modal":true,"w2.quora":true});require.install("view/repeat_offender",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.RepeatOffender=e.extend({onLoad:function(){this.modal("load_repeat_offender_modal",{closeOnBackgroundClick:false,closeOnEscape:false})}});exports.RepeatOffenderModal=t.extend({onLoad:function(){this._super.apply(this,arguments)},onSubmit:function(){var e=this;this.serverCall("mark_modal_as_read").liveMutate().success(function(){e._closeModal()}).send()}})},{"view/modal":true,"w2.quora":true});require.install("view/reauth",function(require,exports,module){var $=require("jquery"),e=require("w2.quora").Component,t=require("view/modal").Base,i,n;$(document).bind("w2rpcexception-reauth_required",function(e,t){if(t.rpc.__liveMutation){require("w2.livenode").mutationDoneAfterVersion(t.rpc.__liveMutationInfo.transactionId,0)}n=t.rpc;if(t.response.exception.args[1]===true){n=n.liveMutate()}i.load_reauth()});exports.ReauthWrapper=e.extend({init:function(){this._super.apply(this,arguments);i=this},load_reauth:function(){this.modal("load_reauth_modal");return false}});exports.ReauthModal=t.extend({onSubmit:function(){var e=this;var t=function(t){if(t.login_success){e.previous_call.send();e._closeModal()}else{e.$("#@password").val("")}};var i={password:this.$("#@password").val()};this.serverCall("verify").kwargs(i).success(t).send()},onLoad:function(){this._super.apply(this,arguments);this.previous_call=n;var e=this;this.$("#@password").focus();this.$("#@password").keypress(function(t){if(t.keyCode==13){e.$("#@submit_button").click()}});this.$("#@forgot_password_link").on("click",function(){e.serverCall("send_reset_password_email").send()})}})},{jquery:true,"w2.livenode":true,"view/modal":true,"w2.quora":true});require.install("unified_view/insertion_query",function(require,exports,module){exports.insertionQ=function(){"use strict";var e=100,t=false,i="animationName",n="",o="Webkit Moz O ms Khtml".split(" "),s="",r=document.createElement("div"),a={strictlyNew:true,timeout:20};if(r.style.animationName){t=true}if(t===false){for(var l=0;l<o.length;l++){if(r.style[o[l]+"AnimationName"]!==undefined){s=o[l];i=s+"AnimationName";n="-"+s.toLowerCase()+"-";t=true;break}}}function u(t,o){var s,r="insQ_"+e++;var l=function(e){if(e.animationName===r||e[i]===r){if(!c(e.target)){o(e.target)}}};s=document.createElement("style");s.innerHTML="@"+n+"keyframes "+r+" {  from {  outline: 1px solid transparent  } to {  outline: 0px solid transparent }  }"+"\n"+t+" { animation-duration: 0.001s; animation-name: "+r+"; "+n+"animation-duration: 0.001s; "+n+"animation-name: "+r+"; "+" } ";document.head.appendChild(s);var u=setTimeout(function(){document.addEventListener("animationstart",l,false);document.addEventListener("MSAnimationStart",l,false);document.addEventListener("webkitAnimationStart",l,false)},a.timeout);return{destroy:function(){clearTimeout(u);if(s){document.head.removeChild(s);s=null}document.removeEventListener("animationstart",l);document.removeEventListener("MSAnimationStart",l);document.removeEventListener("webkitAnimationStart",l)}}}function d(e){e.QinsQ=true}function c(e){return a.strictlyNew&&e.QinsQ===true}function h(e){if(c(e.parentNode)){return e}else{return h(e.parentNode)}}function f(e){d(e);e=e.firstChild;for(;e;e=e.nextSibling){if(e!==undefined&&e.nodeType===1){f(e)}}}function p(e,t){var i=[];var n=function(){var e;return function(){clearTimeout(e);e=setTimeout(function(){i.forEach(f);t(i);i=[]},10)}}();return u(e,function(e){if(c(e)){return}d(e);var t=h(e);if(i.indexOf(t)<0){i.push(t)}n()})}var exports=function(e){if(t&&e.match(/[^{}]/)){if(a.strictlyNew){f(document.body)}return{every:function(t){return u(e,t)},summary:function(t){return p(e,t)}}}else{return false}};exports.config=function(e){for(var t in e){if(e.hasOwnProperty(t)){a[t]=e[t]}}};return exports}()},{});require.install("unified_view/lazy_load_images",function(require,exports,module){var e=require("unified_view/insertion_query"),t=2e3;function i(e){if(e.getAttribute("data-src")){e.setAttribute("src",e.getAttribute("data-src"));e.removeAttribute("data-src")}}function n(){var e=document.querySelectorAll("img[data-src]");for(var t=0;t<e.length;t++){i(e[t])}}exports.loadDeferredImages=function(){n();e.insertionQ("img").every(function(e){i(e)});setInterval(n,t)}},{"unified_view/insertion_query":true});require.install("lazy_load_images",function(require,exports,module){var e=require("settings"),t=require("unified_view/lazy_load_images");function i(){if(e.lazyLoadImages){$(window).load(function(){t.loadDeferredImages()})}}i()},{"unified_view/lazy_load_images":true,settings:true});require.install("sticky",function(require,exports,module){var e="sticky",t=[],i=false;exports.add=function(n){if(!n.elem||!n.container){return}var s=$(n.elem),r=$(n.container),a=$.extend({top:0,bottom:0},n.offsets),l=s.css("position");s.addClass(e);var u=s.outerHeight(true);s.removeClass(e);var d=$("<div>").css({height:0,margin:0,padding:0,clear:"both",display:"block"});s.before(d);t.push({elem:s,sentinelElem:d,container:r,origPadding:parseInt(r.css("padding-bottom")),origPos:l,curPos:l,offsets:a,height:u});if(!i){i=true;o()}};exports.remove=function(e){for(var i=0;i<t.length;++i){var o=t[i];if(o.elem[0]===$(e)[0]){t.splice(i,1);n(o,o.origPos);break}}};var n=function(t,i){if(i!=t.curPos){t.curPos=i;t.elem.css("position",i);if(i=="fixed"){t.sentinelElem.css("height",t.elem.outerHeight(true));t.elem.addClass(e)}else{t.sentinelElem.css("height",0);t.elem.removeClass(e)}}};var o=function(){var e=$(window),i=e.scrollTop()+e.height();for(var s=0;s<t.length;++s){var r=t[s];if(!r.elem.is(":visible")){continue}var a=r.container.offset().top+r.height+r.offsets.top,l=r.sentinelElem.offset().top+r.height-r.offsets.bottom;if(i>=a&&i<=l){n(r,"fixed")}else{n(r,r.origPos)}}window.requestAnimationFrame(o)}},{sticky:true});require.install("view/spinner",function(require,exports,module){var e=require("w2.quora").Component,t=require("spin");exports.Spinner=e.extend({onLoad:function(){this.spinner=t.createSpinnerDom({},"__w2_Spinner_Component");var e=this.$("#@display_area");e.append(this.spinner)}})},{spin:true,"w2.quora":true});require.install("view/embed",function(require,exports,module){var e=require("w2.quora").Component;exports.ExternalEmbed=e.extend({onLoad:function(e){this.$("#@embed_logo").mouseover(this.fnbind(function(){this.$("#@embed_logo").css({"background-position":"0 -20px"}).animate({right:"0px"},80)}));this.$("#@external_embed_wrapper").on("mousedown",'a[href!="#"]',function(e){var t=$(e.currentTarget);t.attr("target","_blank")})}});exports.QuoteEmbed=exports.ExternalEmbed.extend({onLoad:function(e){this._super.apply(this,arguments);var t=this.lookup("quote_dialog_content");if(t){t.getSize()}}})},{"w2.quora":true});require.install("mathify",function(require,exports,module){exports.iterMaths=function(e,t){return i(e,function(e,i){if(i){t(i,e)}return""})};var e=function(e,t){return e?"<b>"+e+"</b>":t};var t=exports.getParts=function(e){var t="\\s\\S",i=new RegExp("\\[math\\](["+t+"]+?)\\[\\/math\\]","g");var n,o,s,r=[],a=0,l,u;while(n=i.exec(e)){o=n[0];s=n[1];l=i.lastIndex;u=l-o.length;if(a!=u){r.push([e.slice(a,u)])}a=l;r.push([o,s])}if(a!=e.length){r.push([e.substr(a)])}return r};var i=exports.mathify=function(i,n){n=n||e;var o=t(i);var s="";for(var r=0;r<o.length;r++){s+=n.apply(window,o[r])}return s||i};exports.renderMath=function(e){if(typeof MathJax!=="undefined"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,e])}}},{});require.install("input_validate",function(require,exports,module){var e=require("w2.quora").Component;exports.InputValidator=e.extend({init:function(){this._super.apply(this,arguments);this.isValid=null},onLoad:function(){var e=this.input(),t;e.bind("change blur",this.fnbind(function(){var i=e.val();if(i!==t){t=i;this.validate()}}));this._managerComponent().__validators=this._managerComponent().__validators||[];this._managerComponent().__validators.push(this)},input:function(){return this.parent().$("#"+this.id)},_managerComponent:function(){return this.parent()},validate:function(e){e=e||{};var t=this.input().val();if(!t){this.showErrorOnComponent(".@incomplete");this.hideAllErrors();this.isValid=null}else{this.hideAllErrors();var i=setTimeout(this.fnbind(function(){this.$(".@asking_server").show()}),150);
this.serverCall("validate").kwargs({value:this.input().val()}).success(this.fnbind(function(t){clearTimeout(i);this.hideAllErrors();if(t.valid){this.isValid=true;if(t.message){this.setWidth(this.$("#@valid_message"));this.$("#@valid_message").text(t.message)}if(this.$(".@valid").text()){this.showErrorOnComponent(".@valid")}this.hideAllErrors();this.input().removeClass("error");if(typeof e.valid=="function"){e.valid(t.message)}}else{this.isValid=false;if(t.message){this.setWidth(this.$("#@invalid_message"));this.$("#@invalid_message").text(t.message);this.invalidMessage=t.message}this.hideAllErrors();this.showErrorOnComponent(".@invalid");if(typeof e.invalid=="function"){e.invalid(t.message)}}})).send()}},populate_if_valid:function(e,t){this.serverCall("validate").kwargs({value:e}).success(this.fnbind(function(i){if(i.valid){this.isValid=true;t.val(e)}})).send()},setWidth:function(e){var t=parseInt(this.input().width())-4;if(t>0){e.css("width",t+"px")}},hideAllErrors:function(){this.$(".@invalid").hide();this.$(".@valid").hide();this.$(".@incomplete").hide();this.$(".@asking_server").hide();this.input().removeClass("input_validation_error");this.$("textarea").removeClass("input_validation_error")},showErrorOnComponent:function(e){this.$(e).show();this.input().addClass("input_validation_error");this.$("textarea").addClass("input_validation_error")}});exports.InputValidator.validate=function(e,t){t=t||{};if(e.__validators&&e.__validators.length){e.__validators[0].validate(t)}else{if(typeof t.valid=="function"){t.valid()}}}},{"w2.quora":true});require.install("action_log",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("cookies"),n=require("settings"),o=require("event").add,s={},r=500,a=0,l=null,u=false,d=[],c=null,h=500,f=false,p=[];function g(){if(c){clearTimeout(c)}c=setTimeout(_,h)}function _(){if(d.length===0){return}if(f){g();return}f=true;p=d;d=[];t.rpc("/ajax/action_log_POST").kwargs({messages:p}).success(m).error(v).send()}function m(){p.length=0;f=false}function v(){d=d.concat(p);p.length=0;f=false}function w(e){d.push(e);g()}function b(e){if(!s[e.cid]){return}if(e.impression_target){w(e.impression_target)}delete s[e.cid]}function k(e,t,n,o){i.setMessage("alog",[e,t,n,o])}function C(e,t){if(!t){t=null}k(e,t,null,null)}exports.logPrimaryAction=C;function y(e,t){var i=n.actionTrail;k(e,null,t,i)}exports.logSecondaryAction=y;function x(e){s[e.cid]=e;if(!u){o(document,"scroll",L);u=true}T()}function S(e){delete s[e.cid]}function T(){if(l){clearTimeout(l)}l=setTimeout(L,r)}function L(){var e=+new Date;if(e<a+r){return}a=e;for(var t in s){var i=s[t];if(i.$("#@actionable").is(":in-viewport")){b(i)}}}exports.ActionableComponent=e.extend({onLoad:function(){this._super.apply(this,arguments);x(this);var e=this;this.$("#@actionable").on("mousedown","[action_mousedown]",function(t){e.processAction($(t.currentTarget).attr("action_mousedown"),$(t.currentTarget).attr("action_target"))});this.$("#@actionable").on("click","[action_click]",function(t){e.processAction($(t.currentTarget).attr("action_click"),$(t.currentTarget).attr("action_target"))})},sendActions:function(){this.serverCall("send_actions").send()},processAction:function(e,t){if(!e){return}b(this);C(e,this.impression_target);this.actionCallback(e)},actionCallback:function(e){},onUnload:function(){S(this)}});$(document).on("mousedown","[action_mousedown]",function(e){q($(e.currentTarget).attr("action_mousedown"),$(e.currentTarget).attr("action_target"))});$(document).on("click","[action_click]",function(e){q($(e.currentTarget).attr("action_click"),$(e.currentTarget).attr("action_target"))});function q(e,t){if(!e){return}y(e,t)}},{webnode2:true,cookies:true,settings:true,event:true,"w2.quora":true});require.install("view/inline_editor",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("cookies"),n=require("settings"),o=require("view/modal").Base,s=require("mathify").renderMath,r=require("input_validate").InputValidator,a=n.interface_strings;exports.InlineEditor=e.extend({onLoad:function(){var e=this;e.editor=e.lookup("editor");e.input_obj=e.$("#@"+e.input);e.input_button="inline_editor_submit";e.input_button_obj=e.$("#@"+e.input_button);e.save_logged_out_answer_method="save_logged_out_answer";e.editorShown=e.show_editor;if(e.draft_space){e.draft_button="inline_editor_save_draft";e.draft_button_obj=e.$("#@"+e.draft_button)}e.toggle_callback=null;e.locked=false;e.$("#@inline_editor_link").click(function(){e.onEditLinkClick();return false});e.$("#@inline_editor_cancel").click(function(){if(e.content_type){c("cancel",e.content_type,e.id)}else{e.cancelEditor()}return false});e.registerEditorCallbacks();e.$("#@inline_editor_create_link").click(function(){if(e.content_type){c("edit",e.content_type,e.id)}else{e.toggle_editor()}return false});e.submitHandler();e.initDraftHandlers();if(e.focus_onload){e.focusInput()}if(e.typing_area){e.editor.setTypingStateCallback(function(t){e.serverCall("typing").kwargs({area:e.typing_area,state:t}).send();e.input_button_obj.text(e.submit_text)})}if(e.input_obj.is("[maxlength]")){e.input_obj.on("keyup",function(){var e=$(this).attr("maxlength");var t=$(this).val();if(t.length>e){$(this).val(t.slice(0,e))}})}s("@inline_editor_content");if(e.content_type){e.whenOnLoaded(function(){c("load",e.content_type,e.id)})}},onUnload:function(){this.unregisterEditorCallbacks()},registerEditorCallbacks:function(){var e=this;e.registerEditorCallback("cancel",e.cid,function(){e.cancelEditor();return false});e.registerEditorCallback("edit",e.cid,function(){e.onEditLinkClick();return false})},unregisterEditorCallbacks:function(){if(!this.content_type){return}d("cancel",this.content_type,this.id,this.cid);d("edit",this.content_type,this.id,this.cid)},onEditLinkClick:function(){if(!this.editorShown){this.toggle_editor()}},initDraftHandlers:function(){if(this.draft_space){this.initEditorFocusCallback();this.initDraftButtonClickCallback();this.initMeaningfulChangeCallback()}},initEditorFocusCallback:function(){this.editor.setFocusCallback(this.fnbind(function(){this.$("#@inline_editor_save_draft").removeClass("hidden")}))},initDraftButtonClickCallback:function(){this.draft_button_obj.click(this.fnbind(function(e){this.save_draft(true);return false}))},initMeaningfulChangeCallback:function(){this.editor.setMeaningfulChangeCallback(this.fnbind(function(){this.save_draft(false)}))},cancelEditor:function(){this.toggle_editor();var e=this.lookup("name_validator");if(e){e.hideAllErrors()}},isEditorEmpty:function(){var e=this.getEditor();if(e){return e.isEmpty()}return false},getEditor:function(){return this.editor},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){r.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}});return false}))},get_value:function(){if(this.is_qtext){return this.editor.serialize()}else{return this.input_obj.val()}},saveLoggedOutAnswer:function(){var e=this.save_logged_out_answer_method,t=this.serverCall(e).kwargs(this.getSaveLoggedOutAnswerKwargs());t.send()},save_draft:function(e){var i=this.getSaveDraftMethod(e),n=this.serverCall(i).kwargs(this.getSaveDraftKwargs());if(e){n.liveMutate();if(t.interactionMode.isBlocking()){t.fallbackToPostReloadMode("interaction")}}this.logSaveDraft();n.send()},logSaveDraft:function(){return},getSaveDraftMethod:function(e){return e?"save_draft":"save_draft_auto"},getSaveDraftKwargs:function(){return{content:this.get_value(),window_id:t.windowId,draft_space:this.draft_space}},getSaveLoggedOutAnswerKwargs:function(){return{qid:this.id,content:this.get_value()}},server_call_method:"edit",_get_kwargs:function(){return{id:this.id,input:this.get_value()}},trigger_request:function(){if(this.typing_area){this.editor.stopTyping()}if(this.locked){return false}this.locked=true;if(!this.require_comment){if(this.logged_out_writing){this.saveLoggedOutAnswer()}if(this.okToSubmitRequest()){this.invokeEditServerCall(this._get_kwargs())}else{this.editor.focus();this.locked=false}}else{this.showConfirmationDialog()}},trigger_cancel:function(){this.$("#@inline_editor_cancel").click()},okToSubmitRequest:function(){return!this.require_value||this.require_value&&!this.editor.isEmpty()},invokeEditServerCall:function(e){var t=this;var n=function(){t.locked=false};$(document).bind("login_cancelled",n);t.triggerCallback("submit");i.setTlog(t.tlog_data());var o=t.getLoggedAction();if(o){require("action_log").logSecondaryAction(o,null)}t.input_button_obj.addClass("disabled");var s=t.serverCall(t.server_call_method).kwargs(e).success(function(e){$(document).unbind("login_cancelled",n);t.ajax_callback(e);t.locked=false;t.input_button_obj.removeClass("disabled")}).error(function(){t.input_button_obj.removeClass("disabled");$(document).unbind("login_cancelled",n)}).liveMutate();if(t.edit_call_should_persist){s.persistMutation()}s.send()},tlog_data:function(){return null},getLoggedAction:function(){return null},ajax_callback:function(e){this.triggerCallback("submitted");this.toggle_editor()},focusInput:function(){if(this.is_qtext){$(".qtext_editor_content").focus()}else{this.input_obj.focus()}},setToggleCallback:function(e){if(!this.toggle_callback){this.toggle_callback=e}else{var t=this.toggle_callback;this.toggle_callback=function(){t();e()}}},toggle_editor:function(){this.editorShown=!this.editorShown;this.$("#@inline_editor_content").find(".qtext_embed").each(function(e,t){$(t).addClass("thumbnail").empty()});this.$("#@inline_editor_content").toggleClass("hidden");this.$("#@inline_editor_form").toggleClass("hidden");if(this.is_qtext&&this.$("#@inline_editor_form").is(":visible")){try{this.cQuery(":editor").focus()}catch(e){}}if(this.toggle_callback){this.toggle_callback()}},showConfirmationDialog:function(){var e=this.input_button_obj.text();this._dialog=this.dialog().title(this.confirm_text).cancel(this.fnbind(function(){this.locked=false}),a.cancel).ok(this.fnbind(function(){var e=arguments[0].dialogComponent;var t=e.lookup("editor");if(!t.isEmpty()){var i=this._get_kwargs();i.comment=t.serialize();this.invokeEditServerCall(i);this._dialog.close_()}else{return false}}),e).load("comment_dialog")},getReviewData:function(){var e=this.editor.child("review_rating");if(e){var t=e.$("#@ratings").attr("class").slice(-1);if(t){return{base:t}}}return null},registerEditorCallback:function(e,t,i){if(!this.content_type){return}u(e,this.content_type,this.id,t,i)},triggerCallback:function(e){if(!this.content_type){return}c(e,this.content_type,this.id)}});exports.InlineEditCommentDialog=e.extend({onLoad:function(){this.lookup("editor").focus()}});exports.DraftStatus=e.extend({onLoad:function(){var e=this;e.$("#@draft_status_clear").click(function(){e.modal("load_clear_draft_confirmation").onSubmitCallBack(function(){e.getClearDraftCallback()});return false})},getClearDraftCallback:function(){return function(){}}});exports.ClearDraftConfirmationModal=o.extend({onSubmit:function(){var e=this;t.rpc("/ajax/ajax_clear_draft_POST").kwargs({draft_space:e.draft_space}).liveMutate().success(function(){t.Modal.modalFor(e).executeOnSubmitCallBack();e._closeModal()}).send()}});exports.BoardDraftStatus=exports.DraftStatus.extend({onLoad:function(){this._super.apply(this,arguments)},updateWithDraftId:function(e){this.child("toggled").toggle(false,e)},getClearDraftCallback:function(){var e=this.parent();return function(){e.onClearDraft();window.location.reload()}}});exports.MessageDraftStatus=exports.DraftStatus.extend({getClearDraftCallback:function(){this.cQuery(":message_inline_editor.editor").resetThreadDetailHeight()}});var l=function(e,t,i,n){var o="editor_"+e+"_"+t+"_"+i;if(n){o+="."+n}return o};var u=function(e,t,i,n,o){var s=l(e,t,i,n);$(document).on(s,function(){return o()})};exports.registerEditorCallback=u;var d=function(e,t,i,n){var o=l(e,t,i,n);$(document).off(o)};exports.unregisterEditorCallback=d;var c=function(e,t,i){var n=l(e,t,i);$(document).trigger(n);var o=t+"_"+i;if(!h[o]){h[o]=[]}h[o].push(e)};exports.triggerEditorCallback=c;var h={};function f(e,t){var i=e+"_"+t;return h[i]}var p=function(e,t){var i=f(e,t);if(i){var n=i.length;if(i[n-1]=="edit"){return true}if(n>1&&i[n-2]=="edit"&&i[n-1]=="load"){return true}}return false};exports.isInEditMode=p},{cookies:true,"view/modal":true,settings:true,webnode2:true,mathify:true,input_validate:true,action_log:true,"w2.quora":true});require.install("view/embed_editor",function(require,exports,module){var e=require("view/inline_editor").InlineEditor,t=require("input_validate").InputValidator;exports.EmbedInlineEditor=e.extend({onLoad:function(){this._super.apply(this,arguments);this.initial_positioning=false;var e=this.editor=this.lookup("editor");this.setToggleCallback(this.fnbind(function(){if(!this.initial_positioning){this.initial_positioning=true;e.updateEmbedComponentPositions();e.getEmbedComponents(function(t,i){e.updatePlaceholderImageSize(t)});e.updateEmbedComponentPositions()}}))},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){this.editor.notifySubmit();t.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}});return false}))}})},{"view/inline_editor":true,input_validate:true});require.install("view/placepicker",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=false,n=[],o=require("settings").interface_strings;exports.mapsLoaded=function(){i=true;for(var e=0;e<n.length;++e){n[e].call()}};function s(e){if(i){e()}else{n.push(e)}}exports.PlacePicker=e.extend({onLoad:function(){s(this.fnbind(this.onLoadBase))},onLoadBase:function(){this.address=this.default_location;this.initializeGoogleMaps();if(this.mutable===true){this.$("#@edit_map").click(this.fnbind(function(){this.toggleEditor();return false}));this.$("#@change_location").click(this.fnbind(function(){if(this.place||this.marker){this.$("#@search_text_field").blur();var e,t;if(this.map.getBounds().contains(this.marker.getPosition())){e=this.marker.getPosition().lat();t=this.marker.getPosition().lng()}else{e=this.map.getCenter().lat();t=this.map.getCenter().lng()}if(!this.place){var i=new google.maps.LatLng(e,t);var n=new google.maps.Geocoder;n.geocode({location:i},this.fnbind(function(e,t){if(t==google.maps.GeocoderStatus.OK&&e.length){var i=e[0];this.radius=this.computeRadius(i.geometry.viewport);this.setAddress(i.address_components)}}))}var o=$.trim(this.$("#@search_text_field").val());this.serverCall("place_changed").kwargs({radius:this.radius,reference:this.place&&this.place.reference||this.reference,lat:e,lng:t,viewport:{zoom:this.map.getZoom(),mapTypeId:this.map.getMapTypeId(),icon:this.place&&this.place.icon,tilt:this.map.getTilt(),heading:this.map.getHeading()},address:o.length?o:this.address}).success(this.fnbind(function(){this.default_location.hasLocation=true})).send()}else{this.$("#@search_text_field").focus()}}));this.$("#@edit").click(this.fnbind(function(){this.toggleEditor();return false}));this.$("#@add").click(this.fnbind(function(){this.reinitializeMap();return false}));this.$("#@clear").click(this.fnbind(function(){this.dialog().title(this.dialog_title).cancel(null,o.cancel).ok(this.fnbind(function(){this.serverCall("place_cleared").success(this.fnbind(function(){this.toggleEditor()})).send()}),this.dialog_title).html(this.dialog_message);return false}));this.$("#@close").click(this.fnbind(function(){this.toggleEditor();this.initializeGoogleMaps();if(this.default_location.hasLocation===false){this.$("#@map_wrapper").hide()}return false}));if(t.getHash().substr(0,13)=="#editlocation"){this.reinitializeMap()}}},initializeGoogleMaps:function(){s(this.fnbind(this.initializeGoogleMapsBase))},initializeGoogleMapsBase:function(){this.mapOptions={center:window.google&&google.maps&&new google.maps.LatLng(this.default_location.latitude,this.default_location.longitude),zoom:this.viewport&&this.viewport.zoom||7,mapTypeId:this.viewport&&this.viewport.mapTypeId||window.google&&google.maps&&google.maps.MapTypeId.ROADMAP||"roadmap",tilt:this.viewport&&this.viewport.tilt!==undefined&&this.viewport.zoom>=18?this.viewport.tilt:45,heading:this.viewport&&this.viewport.heading,streetViewControl:!this.mutable};var e=this.viewport&&this.viewport.icon;if(this.static_map===true){var t="//maps.googleapis.com/maps/api/staticmap?center="+encodeURIComponent(this.default_location.latitude+","+this.default_location.longitude)+"&zoom="+encodeURIComponent(this.mapOptions.zoom)+"&size="+encodeURIComponent(this.size.width+"x"+this.size.height)+"&maptype="+encodeURIComponent(this.mapOptions.mapTypeId)+"&markers="+encodeURIComponent("icon:"+e+"shadow:false|"+this.default_location.latitude+","+this.default_location.longitude)+"&sensor=false";var i=$('<img src="'+t+'" />');this.$("#@map_canvas").replaceWith(i);return}this.map=new google.maps.Map(this.$("#@map_canvas").get(0),this.mapOptions);if(this.simple_view===true||this.mutable===true){this.toggleControls(false)}if(this.default_location.hasLocation!==false){this.updateMarker(e,this.mapOptions.center,this.default_text)}if(this.mutable===true){this.toggleDraggable(false)}if(this.mutable===true){var n=this.$("#@search_text_field").get(0);var o=new google.maps.places.Autocomplete(n);o.bindTo("bounds",this.map);google.maps.event.addListener(o,"place_changed",this.fnbind(function(){if(this.infowindow){this.infowindow.close()}this.place=o.getPlace();if(this.place.geometry.viewport){this.map.fitBounds(this.place.geometry.viewport);this.radius=this.computeRadius(this.place.geometry.viewport)}else{this.map.setCenter(this.place.geometry.location);this.map.setZoom(17);this.radius=30}this.setAddress(this.place.address_components);this.updateMarker(this.place.icon,this.place.geometry.location)}));google.maps.event.addListener(this.map,"click",this.fnbind(function(e){if(!this.getControlState()){return}var t=e.latLng;this.radius=this.computeRadius(this.map.getBounds());this.handleMarkerReposition(t);this.updateMarker(null,t)}))}},setAddress:function(e){this.address="";if(e){this.address=[e[0]&&e[0].short_name||"",e[1]&&e[1].short_name||"",e[2]&&e[2].short_name||""];if(this.address[1]==this.address[2]){this.address.splice(2,1)}if(this.address[0]==this.address[1]){this.address.splice(1,1)}var t="";$.each(this.address,this.fnbind(function(e,i){t+=i;if(/^[0-9]+$/.test(i)){t+=" "}else if(e!=this.address.length-1){t+=", "}}));this.address=t}},reinitializeMap:function(){this.$("#@map_wrapper").show(0,this.fnbind(function(){this.initializeGoogleMaps();this.toggleEditor();this.$("#@search_text_field").focus()}))},toggleEditor:function(){this.$("#@view").toggle();this.$("#@editor").toggle();this.$("#@edit_map").toggle();this.toggleDraggable();this.toggleControls()},getControlState:function(){return!!this.mapOptions.mapTypeControl},toggleControls:function(e){s(this.fnbind(this.toggleControlsBase,e))},toggleControlsBase:function(e){var t=e!==undefined?e:!this.getControlState();this.mapOptions.mapTypeControl=t;this.mapOptions.panControl=t;this.mapOptions.zoomControl=t;this.mapOptions.scaleControl=t;this.mapOptions.rotateControl=t;this.mapOptions.overviewMapControl=t;this.map.setOptions(this.mapOptions)},toggleDraggable:function(e){s(this.fnbind(this.toggleDraggableBase,e))},toggleDraggableBase:function(e){this.mapOptions.draggable=e!==undefined?e:!this.mapOptions.draggable;if(this.mapOptions.draggable){this.mapOptions.minZoom=undefined;this.mapOptions.maxZoom=undefined;if(this.marker){this.marker.setDraggable(true)}}else{this.mapOptions.minZoom=this.map.getZoom();this.mapOptions.maxZoom=this.map.getZoom();if(this.marker){this.marker.setDraggable(false)}}this.map.setOptions(this.mapOptions)},updateMarker:function(e,t){s(this.fnbind(this.updateMarkerBase,e,t))},updateMarkerBase:function(e,t){if(this.marker){this.marker.setMap(null)}var i=new google.maps.MarkerImage(e||"//maps.gstatic.com/mapfiles/place_api/icons/geocode-71.png",new google.maps.Size(40,40),new google.maps.Point(0,0),new google.maps.Point(20,40),new google.maps.Size(40,40));this.marker=new google.maps.Marker({clickable:true,draggable:this.mapOptions&&this.mapOptions.draggable,icon:i,map:this.map,position:t});google.maps.event.addListener(this.marker,"dragend",this.fnbind(function(e){var t=e.latLng;this.handleMarkerReposition(t)}));this.updateInfoWindow(t)},handleMarkerReposition:function(e){s(this.fnbind(this.handleMarkerRepositionBase,e))},handleMarkerRepositionBase:function(e){this.place=null;window.setTimeout(this.fnbind(function(){this.map.panTo(e)}),1e4);var t=new google.maps.Geocoder;t.geocode({location:e},this.fnbind(function(t,i){if(i==google.maps.GeocoderStatus.OK&&t.length){var n=t[0];this.radius=this.computeRadius(n.geometry.viewport);this.setAddress(n.address_components);this.updateInfoWindow(e)}}))},updateInfoWindow:function(e){s(this.fnbind(this.updateInfoWindowBase,e))},updateInfoWindowBase:function(e){if(this.infowindow){this.infowindow.close()}if(this.address&&this.address.length){this.infowindow=new google.maps.InfoWindow({content:this.address,position:e});google.maps.event.addListener(this.marker,"click",this.fnbind(function(){this.infowindow.open(this.map,this.marker)}))}},computeRadius:function(e){var t=e.getNorthEast();var i=e.getSouthWest();var n=t.lat();var o=i.lat();var s=t.lng();var r=i.lng();return Math.floor(Math.abs(n-o)*111045/2)}})},{settings:true,window_manager:true,"w2.quora":true});require.install("simscroll",function(require,exports,module){var e,t=50,i=document.documentElement;function n(e,t,i,n,o){return[e,!!t,!!i,!!n,!!o].join(" ")}var o=n(38),s=n(40),r=n(33),a=n(32,true),l=n(32),u=n(34);function d(d){var c=d.keyCode||d.charCode,h=Math.round(.9*i.clientHeight);switch(n(c,d.shiftKey,d.ctrlKey,d.altKey,d.metaKey)){case o:window.scrollBy(0,-t);break;case s:window.scrollBy(0,t);break;case r:case a:window.scrollBy(0,-h);break;case l:case u:window.scrollBy(0,h);break;default:return false}e=true;return true}if(document.addEventListener){document.addEventListener("keypress",function(t){var n=t.originalTarget;if(!e&&(n===i||n===document.body)&&d(t)){t.preventDefault();t.stopPropagation()}e=false},false)}exports.maybeSimulateScroll=d;exports.cancelSimulatedScroll=function(){e=true}},{});require.install("view/selector",function(require,exports,module){var e=require("w2.quora").Component,t=require("spin"),i=require("simscroll");exports.Selector=e.extend({onLoad:function(){var e=this;e._busy=false;e.$input=e.$("#@input");e.$results=e.$("#@results");e.$spinner=e.$("#@spinner");e.busySpinnerConfig={length:3,width:1,radius:3};e.shouldSimScroll=false;e.shouldShowLengthCounter=false;e.query=e.$input.val();function t(t){if(t.type==="keydown"){var i=e.child("results");if(i){var n=i.getSelectedResult();if(n===null&&e.allowNoSelection){e.submit()}else if(n){e.resultWasSelected(n)}}else{e.submit()}}}function n(){e.showResults(false);e.$input.blur()}function o(t,i){t.preventDefault();if(t.type==="keydown"){var n=e.child("results");if(n){n.moveSelection(i)}}}function s(s){if(e.shouldSimScroll){if(!e.query&&i.maybeSimulateScroll(s)){return false}if(!e.query&&s.which==39){e.$input.blur();return}}switch(s.which){case 13:t(s);break;case 27:n();break;case 38:o(s,-1);break;case 40:o(s,1);break;default:var r=e.$input.val();if(r!==e.query){e._setQuery(r)}}}e.$input.change(s).keydown(s).keyup(s).focus(e.fnbind(e.inputFocusHandler)).blur(e.fnbind(e.inputBlurHandler))},showLengthCounter:function(e){if(this.length_limit){if(!this.shouldShowLengthCounter){this.$("#@counter_wrapper").addClass("hidden")}else{if(e){this.$("#@counter_wrapper").removeClass("hidden")}else{this.$("#@counter_wrapper").addClass("hidden")}}}},inputFocusHandler:function(){if(this.length_limit){this.lookup("counter").show()}},inputBlurHandler:function(){if(this.length_limit){this.lookup("counter").hide()}},setQuery:function(e){var t=this.$input[0].selectionStart,i=this.$input[0].selectionEnd;this.$input.val(e);this.$input[0].setSelectionRange(t,i);this._setQuery(e)},queryDidChange:function(){},resultsDidChange:function(){},resultWasSelected:function(e,t){},submit:function(){},showResults:function(e){if(e){this.$results.removeClass("hidden")}else{this.$results.addClass("hidden")}},getExtraKwargs:function(){return{}},updateResults:function(){var e=this;if(e.query.trim().length===0){e.showResults(false)}else if(!e._busy){var t={query:e.query};var i=e.getExtraKwargs();for(var n in i){t[n]=i[n]}e.setBusy(true);e.serverCall("results_content_for").contentFor(e.$results,{parentCID:e.cid}).kwargs(t).success(e.fnbind(e.resultsServerCallHandler)).except(e.fnbind(e.resultsServerCallHandler)).error(e.fnbind(e.resultsServerCallHandler)).send()}},resultsServerCallHandler:function(){this.setBusy(false);this.showResults(true);if(this.child("results").query!==this.$input.val()){this.updateResults()}},isBusy:function(){return this._busy},setBusy:function(e){var i=this;i._busy=e;function n(){return!i._busy&&i._spinner}if(i._busy&&!i._spinner){i._spinner=t.createSpinnerElement(this.busySpinnerConfig);i.$spinner.append(i._spinner.el)}else if(n()){setTimeout(function(){if(n()){i._spinner.stop();i._spinner=null}},100)}},_setQuery:function(e){this.query=e;if(this.length_limit){this.lookup("counter").updateCounter(e.length)}this.queryDidChange();this.updateResults()}});exports.SelectorResults=e.extend({onLoad:function(){var e=this;if(!e.allowNoSelection){e.setSelection(0)}else{e.setSelection(-1)}e.$(".@result").hover(function(t){var i=e.getIndexFromResultElementID(this.id);e.setSelection(i)}).mousedown(function(e){e.preventDefault()}).click(function(t){var i=t.metaKey||t.ctrlKey;var n=e.getIndexFromResultElementID(this.id),o=e.results[n];e.parent().resultWasSelected(o,i)});if(e.allowNoSelection){e.$("#@wrapper").mouseleave(function(t){e.setSelection(-1)})}e.parent().resultsDidChange()},getSelectedResult:function(){if(this.selectedIndex===-1){return null}if(!this.numResults&&this.allowNoSelection){return null}return this.results[this.selectedIndex]},setSelection:function(e){if(!this.numResults){return}if(!isNaN(parseInt(e))){if(this.selectedIndex!==-1&&!isNaN(parseInt(this.selectedIndex))){this.$("#@result_"+this.selectedIndex).removeClass("selector_highlighted")}if(this.allowNoSelection&&e<-1||!this.allowNoSelection&&e<0){e=this.numResults-1}if(e>this.numResults-1){e=this.allowNoSelection?-1:0}if(e===-1){this.selectedIndex=e}else{var t=this.$("#@result_"+e);if(t){t.addClass("selector_highlighted");this.selectedIndex=e}}}},moveSelection:function(e){var t=this.selectedIndex+e;this.setSelection(t)},getIndexFromResultElementID:function(e){var t=e.split("_");return parseInt(t[t.length-1])}});exports.ServerCallSelector=exports.Selector.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.$serverMessage=e.$("#@server_message");e.pendingServerCallRequest=null;e.serverCallBusy=false;e.hideResultsOnServerCall=true},queryDidChange:function(){this._super.apply(this,arguments);this.showServerMessage(false)},makeServerCall:function(e){this.pendingServerCallRequest=e;if(!this.isBusy()){this.doServerCall()}},hasPendingServerCall:function(){return this.pendingServerCallRequest!==null||this.serverCallBusy},resultsServerCallHandler:function(){var e=this;if(e.pendingServerCallRequest!==null){e.doServerCall()}else{e._super.apply(e,arguments);e.showServerMessage(false)}},doServerCall:function(){var e=this;e.setBusy(true);e.serverCallBusy=true;if(e.hideResultsOnServerCall){e.showResults(false)}e.showServerMessage(false);e.pendingServerCallRequest.contentFor(e.$serverMessage,{parentCID:e.cid}).success(e.fnbind(function(){e.serverCallHandler(true)})).except(e.fnbind(function(t){e.serverCallHandler(false,t)})).error(e.fnbind(function(){e.serverCallHandler(false)})).send();e.pendingServerCallRequest=null},serverCallHandler:function(e,t){this.serverCallBusy=false;this.setBusy(false);if(e){if(this.hideResultsOnServerCall){this.showResults(false)}this.showServerMessage(true)}},showServerMessage:function(e){if(e){this.$serverMessage.removeClass("hidden")}else{this.$serverMessage.addClass("hidden")}}})},{simscroll:true,spin:true,"w2.quora":true});require.install("view/question_selector",function(require,exports,module){var e=require("view/selector").ServerCallSelector;exports.RedirectQuestionESSelector=e.extend({onLoad:function(e){var t=this;t._super.apply(t,arguments)},resultWasSelected:function(e){var t=this;t.setQuery("");t.parent().$("#@to_qid").val(e.data.qid);t.serverCall("question_redirect_preview").kwargs({to_qid:e.data.qid}).contentFor(t.parent().$("#@question_redirect_preview"),{parentCID:t.cid}).send();t.$("#@input").blur()}})},{"view/selector":true});require.install("view/pmsg",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2");exports.PMsg=e.extend({onLoad:function(){this.$("#@x").click(this.fnbind(function(){this.close();return false}))},close:function(){this.$("#@container").hide();$(".pmsg_container").hide()}});exports.PMsgContainer=e.extend({onLoad:function(e){t.pmsgContainer=this;var i=$("#layout_header");if(i.length!==0){this.headerHeight=i.outerHeight();if(!this.mobile){this.$("#@pmsg_container").css("top",this.headerHeight+10)}}if(this.$("#@pmsg_container").html()&&!this.mobile){this.$("#@pmsg_container").fadeIn(350);this.setFadeTimeout(5e3)}},setFadeTimeout:function(e){var t=this;this.t=setTimeout(function(){t.$("#@pmsg_container").fadeOut(350)},e)},setContent:function(e,t){var i=this;i.$("#@pmsg_container").hover(function(){clearTimeout(i.t);i.$("#@pmsg_container").stop();i.$("#@pmsg_container").css("opacity",100)},function(){i.setFadeTimeout(1e3)});var n=function(e){i.$("#@pmsg_container").setContent(e);i.$("#@pmsg_container").fadeIn(350);i.setFadeTimeout(5e3)};if(this.$("#@pmsg_container").is(":visible")){clearTimeout(this.t);this.$("#@pmsg_container").fadeOut(350,this.fnbind(function(){n(e)}))}else{n(e)}return this}})},{webnode2:true,"w2.quora":true});require.install("view/fixable2",function(require,exports,module){var e=require("browser");function t(){return e.mobile||e.tablet}var i=[],n=window,o=document,s=["resize","scroll","w2.fixable.trigger"],r=false,a={height:function(e,t){return t.winHeight>=e.min_height},width:function(e,t){return t.winWidth>=e.min_width},scroll:function(e,t){if(e.min_scroll>=0&&(e.min_scroll_callback||e.max_scroll_callback)){var i=e.min_scroll;if(e.min_scroll_callback){i=e.min_scroll_callback()}var n=e.max_scroll;if(e.max_scroll_callback){n=e.max_scroll_callback()}return t.winScroll<=n&&i<=t.winScroll}else if(e.min_scroll>=0&&e.max_scroll>=0){return e.min_scroll<=t.winScroll&&t.winScroll<=e.max_scroll}else if(e.min_scroll>=0){return t.winScroll>=e.min_scroll}else if(e.max_scroll>=0){return t.winScroll<=e.max_scroll}else{return false}}};var l=function(e,t){e=y(e);if(!e){throw"No element given for makeFixable"}if(C(e)!==-1){return}h(e,t);s.forEach(function(e){if(e==="resize"){n.removeEventListener(e,_);n.addEventListener(e,_)}o.removeEventListener(e,_);o.addEventListener(e,_)});return e};var u=function(e){e=y(e);if(!e){throw"No element given for removeFixable"}var t=C(e),r;if(t>-1){r=i.splice(t,1)[0];r.el.style.top=r.state.elTop+"px";r.el.style.position=r.state.elPosition;r.el.classList.remove("fixable_fixed")}if(i.length<=0){s.forEach(function(e){o.removeEventListener(e,_);n.removeEventListener(e,_)})}return e};var d=function(e,t,i){e=y(e);t=y(t);i=i||{};i.top=i.top||0;i.bottom=i.bottom||0;l(e,{scroll_dep:true,custom_trigger:n});function n(){if(!e||!t){return false}var n=e.offsetHeight,o=document.body.scrollTop+window.innerHeight,s=q(t).top+n+i.top,r=e.parentNode,a;if(r.classList.contains("fixable_clone")){a=q(r).top+n-i.bottom}else{a=q(e).top+n-i.bottom}return o>=s&&o<=a}e.addEventListener("w2.fixable.fixed",function(){this.style.top="auto";this.style.bottom=0})};var c=function(e,t){var i=e.length,n;for(n=0;n<i-1;n++){l(e[n],L(t,{scroll_dep:true,footer:e[n+1]}))}l(e[n],L(t,{scroll_dep:true,footer:t&&t.footer||null}))};function h(e,o){if(typeof o!=="object"||o===null){o={};
}if(t()&&!o.enable_mobile){return}var s=y(o.header)||document.querySelector(".SiteHeader"),r=y(o.footer)||null,a=s&&s.offsetHeight||0,l=s&&q(s).top||0,u={winHeight:n.innerHeight,winWidth:n.innerWidth,winScroll:document.body.scrollTop,scrollingDown:true,elPosition:getComputedStyle(e).position,elTop:parseInt(getComputedStyle(e).top),elWidth:e.offsetWidth,topSpacing:0};o=L({scroll_dep:false,height_dep:true,width_dep:true,header:s,footer:r,extra_top_spacing:o.extra_top_spacing||0,extra_bottom_spacing:o.extra_bottom_spacing||0,min_scroll:p(e,s,u.winScroll),max_scroll:g(e,s,r,u.winScroll),min_height:e.offsetHeight+a+l-u.winScroll,min_width:u.elWidth,sticky_release:true,custom_trigger:null,enable_mobile:false,min_scroll_callback:null,max_scroll_callback:null},o);o.min_scroll-=o.extra_top_spacing;o.max_scroll-=o.extra_top_spacing+o.extra_bottom_spacing;u.topSpacing=q(e).top-o.min_scroll-parseInt(getComputedStyle(e)["margin-top"]);v(e,o,u);i.push(new f(e,o,u))}function f(e,t,i){this.el=e||null;this.options=t||{};this.state=i||{}}f.prototype.getDependencies=function(){return{resize:this.options.height_dep||this.options.width_dep,scroll:this.options.scroll_dep,custom:this.options.custom_trigger!==null}};function p(e,t,i){var n=q(e).top,o=t&&t.offsetHeight||0,s=(t&&q(t).top||0)-i,r=parseInt(getComputedStyle(e)["margin-top"]);return n-o-s-r}function g(e,t,i,n){var o=i&&q(i).top||0,s=q(e).top,r=e.offsetHeight,a=parseInt(getComputedStyle(e)["margin-bottom"]);return p(e,t,n)+o-s-r-a}function _(e){var t={scrollTop:document.body.scrollTop,height:n.innerHeight,width:n.innerWidth};if(!r){requestAnimationFrame(m.bind(null,e,t))}r=true}function m(e,t){var n=e.type;i.filter(function(e){if(n==="w2.fixable.trigger"){return e.getDependencies().custom}return e.getDependencies()[n]}).forEach(function(i){var n=i.state.winScroll;L(i.state,{winScroll:t.scrollTop,winHeight:t.height,winWidth:t.width,customTop:e.top||i.state.customTop||null});i.state.scrollingDown=i.state.winScroll>n;v(i.el,i.options,i.state)});r=false}function v(e,t,i){if(w(e,t,i)){b(e,t,i)}else{k(e,t,i)}}function w(e,t,i){if(getComputedStyle(e).display==="none"){return false}var n=true;if(t.custom_trigger!==null){n=t.custom_trigger(t,i)}else if(t.scroll_dep){n=a.scroll(t,i)}if(n){if(t.height_dep){n=a.height(t,i)}if(t.width_dep){n=n&&a.width(t,i)}}return n}function b(e,t,i){if(!e.classList.contains("fixable_fixed")){var n=i.topSpacing,o;i.elWidth=e.offsetWidth;S(e);if(t.custom_trigger!==null&&i.customTop!==null){n=i.customTop;i.customTop=null}else if(!t.scroll_dep){n=q(e).top+parseInt(getComputedStyle(e)["margin-top"])}e.style.top=n+"px";e.style.position="fixed";e.style.width=i.elWidth+"px";e.classList.add("fixable_fixed");try{o=new Event("w2.fixable.fixed")}catch(s){o=document.createEvent("Event");o.initEvent("w2.fixable.fixed",true,true)}e.dispatchEvent(o)}}function k(e,t,i){var n;if(e.classList.contains("fixable_fixed")){if(t.custom_trigger!==null){i.customTop=parseInt(getComputedStyle(e).top)}if(i.scrollingDown&&t.custom_trigger===null&&t.sticky_release){e.style.top=t.max_scroll-t.min_scroll+"px";e.style.position="relative"}else{e.style.top=i.elTop+"px";e.style.position=i.elPosition;T(e)}e.classList.remove("fixable_fixed");try{n=new Event("w2.fixable.unfixed")}catch(o){n=document.createEvent("Event");n.initEvent("w2.fixable.unfixed",true,true)}e.dispatchEvent(n)}}exports.makeFixable=l;exports.removeFixable=u;exports.makeBottomFixable=d;exports.makeStackedFixables=c;function C(e){for(var t=0,n=i.length;t<n;t++){if(e===i[t].el){return t}}return-1}function y(e){if(jQuery&&e instanceof jQuery){if(e.length>=2){throw"Error in makeFixable(): getDomNode must only have a single element. "+"(check the fixable element, header, and footer, are not collections)"}return e[0]}return e}function x(e){var t=document.createElement("div"),i=getComputedStyle(e);t.classList.add("fixable_clone");t.style.height=e.offsetHeight+"px";t.style.width=e.offsetWidth+"px";t.style["margin-top"]=i["margin-top"];t.style["margin-right"]=i["margin-right"];t.style["margin-bottom"]=i["margin-bottom"];t.style["margin-left"]=i["margin-left"];return t}function S(e){var t=x(e),i=e.parentNode;i.replaceChild(t,e);t.appendChild(e);return t}function T(e){var t=e.parentNode.parentNode;t.replaceChild(e,e.parentNode);return e}function L(e,t){e=e||{};for(var i in t){if(t.hasOwnProperty(i)){e[i]=t[i]}}return e}function q(e){var t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}},{browser:true});require.install("view/toggle",function(require,exports,module){var e=require("log").log,t=require("w2.quora").Component,i={},n=require("browser").browser;var o=true;var s=window&&window.navigator.appName=="Microsoft Internet Explorer";if(s){if(n.msie&&n.version<=9){o=false}}exports.ToggledComponent=t.extend({onLoad:function(){this._super.apply(this,arguments);if(!this.toggleCallback){this.toggleCallback=null}},onUnload:function(){delete this.toggleCallback;delete this.errorCallback;delete this.toggleIndicator;delete this.toggleSpinner},setCallback:function(e){if(!this.toggleCallback){this.toggleCallback=e}else{var t=this.toggleCallback;this.toggleCallback=function(){t();e()}}},setErrorCallback:function(e){if(!this.errorCallback){this.errorCallback=e}else{var t=this.errorCallback;this.errorCallback=function(){t();e()}}},setIndicator:function(e){this.toggleIndicator=e},setSpinner:function(e){this.toggleSpinner=e},toggle:function(t,i){if(e.enabled){e("toggle.ToggleComponent.toggle","Key:",this.toggle_key,"prev. toggled:",this.toggled,"toggle_state:",i)}if(this.toggled){return}this.toggled=true;var n,o;if(this.toggleIndicator){n=this.toggleIndicator.$("#@toggle_indicator");n.removeClass("hidden")}if(this.toggleSpinner){o=this.toggleSpinner;if(!o.preload_spinner){setTimeout(function(){o.loadSpinner()},150)}}this.force_transition={type:"none"};var s={toggle_key:this.toggle_key};if(i!==undefined){s.toggle_state=i}this.serverCall("toggle").kwargs(s).success(this.toggleCallback).send()}});exports.ToggledIndicator=t.extend({onLoad:function(){this.lookup("toggled").setIndicator(this)}});exports.ToggledSpinner=t.extend({onLoad:function(){this.lookup("toggled").setSpinner(this);if(this.preload_spinner){this.loadSpinner()}},loadSpinner:function(){this.clearSpinner();var e=require("spin").createSpinnerElement({color:"#000"});this.$("#@toggle_spinner").append(e.el)},clearSpinner:function(){this.$("#@toggle_spinner").html("")}});exports.TogglerComponent=t.extend({toggle:function(){if(this.toggle_link){if(this.toggle_link_hide){this.$("#@toggle_link").hide()}}if(this.toggled){this.toggled.toggle(this.toggle_active,this.toggle_state)}},onLoad:function(){this.toggled=this.lookup("toggled",true);if(this.toggle_link){if(this.toggle_link_hide){this.toggled.setErrorCallback(this.fnbind(function(){this.$("#@toggle_link").show()}))}}if(this.toggle_trigger==="click"&&this.toggle_link){this.$("#@toggle_link").click(this.fnbind(function(e){this.toggle();return false}))}else if(this.toggle_trigger==="mouseover"&&this.toggle_link){var e=this.fnbind(function(e){if(!this.mouseover_toggled){this.mouseover_toggled=true;this.toggle()}});if(o){this.$("#@toggle_link").mouseover(e)}else{this.$("#@toggle_link").bind("mousedown keydown",e)}if(this.toggled){this.toggled.setErrorCallback(this.fnbind(function(){this.mouseover_toggled=false}))}}else if(this.toggle_trigger==="load"){this.toggle()}else if(this.toggle_trigger==="timeout"){this.timeout=setTimeout(this.fnbind(this.toggle),this.toggle_timeout)}else if(this.toggle_trigger==="viewport"){var t=this.$("#@toggle_link")[0];var i=this.$(t).offset().top-this.toggle_offset;if(window.innerHeight>this.ypos){this.toggle()}else{var n=function(){var e=this.$(window).scrollTop()+window.innerHeight;if(e>i){this.toggle()}else{requestAnimationFrame(this.fnbind(n))}};requestAnimationFrame(this.fnbind(n))}}},onUnload:function(){if(this.timeout){clearTimeout(this.timeout)}}})},{browser:true,spin:true,log:true,"w2.quora":true});require.install("app/view/home",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("view/toggle"),n=require("window_manager");exports.HomeMain=e.extend({onLoad:function(){var e=this.$("#@left_col_inner");var i=this.$("#@left_col");if(i.length>0&&e.length>0){t.makeFixable(e,{min_height:i.outerHeight()+i.offset().top,min_width:990})}},removeQpUrlParam:function(e){var t=n.getURL();var i=t.indexOf("?qp_story=");if(i!=-1){n.replaceURL(t.substring(0,i));this.lookup(e).$("#@topic_feed").removeClass("invisible")}}});exports.ContentPageFeed=i.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments);setTimeout(this.fnbind(this.recordImpression),0);this.$(".feed_item_wrapper").hide();this.$(".feed_item_wrapper").fadeIn(500)},show:function(){this.$("#@wrapper").show()},recordImpression:function(){if(this.$("#@wrapper").is(":in-viewport")){this.serverCall("record_impression").send()}else{setTimeout(this.fnbind(this.recordImpression),200)}}});exports.HomePageTopicFeedsPopover=e.extend({hide:function(){this.$("#@popover").addClass("hidden")}});exports.DismissHomePageTopicFeedsPopoverLink=e.extend({onLoad:function(){var e=this;this.$("#@dismiss_link").on("click",function(){e.parent().hide();e.serverCall("dismiss_popover").send()})}})},{"view/fixable2":true,"view/toggle":true,window_manager:true,"w2.quora":true});require.install("app/view/mathjax",function(require,exports,module){var e=require("w2.quora").Component,t=require("mathjax");exports.MathJaxLoader=e.extend({onLoad:function(){if(typeof MathJax==="undefined"){var e=false;t.onInit(e)}}})},{mathjax:true,"w2.quora":true});require.install("app/view/messages",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.MessagesMain=e.extend({onLoad:function(){this.resizeMessages();$(window).resize(this.fnbind(function(){this.resizeMessages()}));this.$("#@admin_menu_link").click(this.fnbind(function(){this.$("#@admin_menu_items").menu(this.$("#@admin_menu_link"));return false}))},resizeMessages:function(){var e=$(window).height()-$(".SiteHeader").height();this.$(".MessagesMain").height(e-25);this.$(".MessagesMain").show()}});exports.MessagesThreadDetail=exports.MessagesMain.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.scrollMessageThread();e.isShowingMoreMessages=false;e.$("#@show").click(function(){e.showMoreClicked()})},showMoreClicked:function(){this.isShowingMoreMessages=true;this.serverCall("get_message_count").kwargs({thread_id:this.threadId}).success(this.fnbind(function(e){this.messageCount=e;this.showMoreMessages()})).send()},showMoreMessages:function(){var e=this.$("#@thread")[0].scrollHeight;var t=45;this.shownCount*=2;if(this.shownCount>this.messageCount){this.reachedLastMessage=true;this.shownCount=this.messageCount}this.serverCall("show_messages").kwargs({thread_id:this.threadId,count:this.shownCount}).contentFor(this.$("#@thread"),{parentCID:this.cid}).success(this.fnbind(function(){if(this.reachedLastMessage){this.$("#@more").hide();e+=t}this.scrollMessageThreadToHeight(e);this.isShowingMoreMessages=false})).send()},scrollMessageThread:function(){var e=this.$(".thread_list")[0].scrollHeight;this.$(".thread_list").scrollTop(e);this.$(".thread_list").addClass("is_shown")},scrollMessageThreadToHeight:function(e){var t=this.$("#@thread")[0].scrollHeight-e;this.$(".thread_list").scrollTop(t)}});exports.ComposeMessageModalLink=e.extend({onLoad:function(){var e=this;this.$("#@create_modal_link").on("click",function(t){e.modal("load_inner",{closeOnBackgroundClick:false});t.preventDefault()})}});exports.ComposeMessageModal=t.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@change_person").click(this.fnbind(function(e){this.change();e.preventDefault()}));this.lookup("people_selector").inputFocus();this.load()},load:function(){if(this.object_id){this.setTo(this.object_id)}},getData:function(){if(this.$("#@compose_message_to_uid").val()){this.object_id=this.$("#@compose_message_to_uid").val()}if(!this.object_id||this.lookup("editor").isEmpty()){return false}return{to_uid:this.object_id,msg:this.lookup("editor").serialize()}},onSubmit:function(){if(this.submitDisabled){return}var e=this;var t=e.getData();if(t===false){return}this.serverCall("submit_message").kwargs(t).success(function(){e._closeModal()}).send()},change:function(){this.lookup("people_selector").reset();this.$("#@pick_people").removeClass("hidden");this.$("#@picked_person").addClass("hidden");this.$("#@to_name").html("");this.lookup("people_selector").focus();this.disableSubmit()},setTo:function(e){if(isNaN(parseInt(e))){return}this.lookup("people_selector").reset();this.$("#@pick_people").addClass("hidden");this.$("#@picked_person").removeClass("hidden");this.$("#@compose_message_to_uid").val(e);this.getName(e);this.enableSubmit()},getName:function(e){this.serverCall("get_name").kwargs({to_uid:e}).contentFor(this.$("#@to_name"),{parentCID:this.cid}).success(this.fnbind(function(){this.lookup("editor").focus()})).send()}});exports.HideMessagesModalLink=e.extend({onLoad:function(){var e=this;this.$("#@create_dialog_link").on("click",function(t){e.modal("load_inner");t.preventDefault()})}});exports.HideMessagesModal=t.extend({onSubmit:function(){if(this.submitDisabled){return}var e=this;this.serverCall("hide_thread").liveMutate().success(function(){e._closeModal();window.location="/messages"}).send()}})},{"view/modal":true,"w2.quora":true});require.install("interface/modal",function(require,exports,module){var e=require("interface/settings").pageIsMobile,t=require("Class").Class,i=require;if(e){var n=i("mobile_app2/client");var o=i("mobile_app2/component");var s=i("mobile_app2/util");if(n.isMobileWeb()){var r=i("mobile_app2/web_app_shim/modal")}}else{var a=i("webnode2")}var l="/modal?";var u={};var d=function(t){var i;if(!e){i=a.Modal.openerFor(t).cid}else if(n.isMobileWeb()){i=t.parent().cid}return u[i]};exports.handleClose=function(t){var i;if(!e||n.isMobileWeb()){i=d(t);i.handleClose()}if(!e){a.unloadComponent(t.cid);i.__modal.close()}else{o.unloadComponent(t);if(n.isNativeApp()){n.sendMessageToClient("dismissModal");n.broadcastMessageToWebViews("handleModalClose")}else{r.dismissCurrentlyActiveModal()}}};exports.handleSubmit=function(t,i){if(!e||n.isMobileWeb()){var o=d(t);o.handleSubmit(i);return}n.broadcastMessageToWebViews("handleModalSubmit",i)};exports.createModal=function(e,t,i){return new c(e,t,i)};var c=t.extend({__init__:function(e,t,i){this.vcon=e;this.component=i;this.method=t;this.__kwargs={};this.__modal=null;this.__submitCallback=null;this.__closeCallback=null;this.__unloadCallback=null;u[this.component.cid]=this;this.initMobile()},initMobile:function(){if(!e||n.isMobileWeb()){return}var t=this.handleSubmit.bind(this);var i=this.handleClose.bind(this);n.registerOneTimeMessageHandler("handleModalSubmit",t);n.registerOneTimeMessageHandler("handleModalClose",i);this.onUnload(function(){n.removeOneTimeMessageHandler("handleModalSubmit",t);n.removeOneTimeMessageHandler("handleModalClose",i)})},onUnload:function(e){this.__unloadCallback=e},unload:function(){if(this.__unloadCallback){this.__unloadCallback()}u[this.component.cid]=null},kwargs:function(e){this.__kwargs=e;return this},show:function(){if(!e){this._showWeb()}else if(n.isNativeApp()){this._showNativeApp()}else{this._showMobileWeb()}return this},_showWeb:function(){this.__modal=new a.ModalWithCallBacks(this.component,{kwargs:this.__kwargs});this.__modal.load(this.method)},_showNativeApp:function(){var e=l;var t={method:this.method,vcon:JSON.stringify(this.vcon),kwargs:JSON.stringify(this.__kwargs)};e+=s.encodeMap({params:btoa(JSON.stringify(t))});n.sendMessageToClient("openURL",{target:"modal",url:e})},_showMobileWeb:function(){this.__modal=new r.Modal(this.component,{kwargs:this.__kwargs});this.__modal.load(this.method)},onSubmit:function(e){this.__submitCallback=e;return this},onClose:function(e){this.__closeCallback=e;return this},handleClose:function(){if(this.__closeCallback){this.__closeCallback()}this.unload()},handleSubmit:function(e){if(this.__submitCallback){this.__submitCallback(e)}}})},{"interface/settings":true,Class:true});require.install("interface/component",function(require,exports,module){var e=require("interface/settings"),t=require("interface/helpers").wrap,i=require,n=require("interface/jquery").jQuery,o=require("interface/jquery")._jQuery,s=require("interface/rpc").ServerCall,r=require("core/component"),a=require("interface/modal"),l;var u=["cid","_my","whenOnLoaded","onLoad","onUnload","parent","children","child","getDvar","lookup","onKeyCombination","uninstallKeyComboHandlers","cQuery","contextConstructor","__vcon","__js_init","state","stateHandlers"];if(e.pageIsMobile){l=i("mobile_app2/server_call").MobileComponent;Array.prototype.push.apply(u,["registerNewBroadcastDependencies","rerender","_onUnloaded"])}else{l=i("w2.quora").Component}exports.Component=require("Class").Class.extend({__init__:function(e,i,n,o,s){var r=new l(e,i,n,o,s);r.init.call(this,n);return t(this,r,u)},$id:function(e){if(e[0]!="@"){throw new Error("Expect id to begin with @. Got: "+e)}e=e.replace("@",this._my());return n("#"+e)},unsafe$id:function(e){if(e[0]!="@"){throw new Error("Expect id to begin with @. Got: "+e)}e=e.replace("@",this._my());return o("#"+e)},serverCall:function(e){var t=r.parseVcon(this);if(t){return new s(t,e,this)}},createModal:function(e){var t=r.parseVcon(this);if(t){return a.createModal(t,e,this)}throw new Error("Invalid vcon for component: "+this.cid)}})},{"interface/settings":true,"interface/jquery":true,"interface/rpc":true,"core/component":true,"interface/modal":true,Class:true,"interface/helpers":true});require.install("unified_view/toggle",function(require,exports,module){var e=require("interface/component").Component,t=require("assert").ok,i=require,n=require("debounce").debounce,o=require("interface/settings").pageIsMobile,s;if(o){var r=i("mobile_app2/util");s=r.isElementInViewport}else{s=function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}}exports.ToggleBase=e.extend({__init__:function(){this._super.apply(this,arguments);this._init_toggle()},_init_toggle:function(){this.fetchCalled=false;this.fetchCompleted=false;this.switchCompleted=false;this.switchPending=false;this.$fetchInto=this.$id(this.fetch_into);this.$switchShow=this.optional$id(this.switch_show);this.$switchHide=this.optional$id(this.switch_hide);this.$loadingShow=this.optional$id(this.loading_show);this.$loadingHide=this.optional$id(this.loading_hide);this.$fetchOnElem=this.fetch_on.length>1?this.$id(this.fetch_on[1]):this.$switchHide;this.$switchOnElem=this.switch_on.length>1?this.$id(this.switch_on[1]):this.$switchHide;this.bindFetch();this.handleSwitch();this.bindKeys();t(this.fetchCompleted||this.$fetchInto,"$fetchInto undefined but fetch is not completed.")},optional$id:function(e){return e?this.$id(e):null},bindFetch:function(){switch(this.fetch_on[0]){case"request":this.fetchCalled=true;this.fetchCompleted=true;break;case"load":this.fetch();break;case"view":case"hover":case"click":var e=this.fetch_on[0];t(this.$fetchOnElem,"$fetchOnElem undefined for view/hover/click triggers.");if(e=="hover"){this.bindHover(this.$fetchOnElem,this.fetch.bind(this))}else if(e=="view"){this.bindInViewPort(this.$fetchOnElem,this.fetch.bind(this))}else{this.bindClick(this.$fetchOnElem,this.fetch.bind(this))}break;default:throw new Error("Invalid fetch trigger specified "+this.fetch_on)}},bindKeys:function(){if(!this.key_combination){return}this.onKeyCombination(this.$fetchOnElem.get(0),"Enter",this.triggerSwitch.bind(this))},handleSwitch:function(){switch(this.switch_on[0]){case"request":this.fetchCalled=true;this.fetchCompleted=true;this.switchCompleted=true;break;case"load":this.triggerSwitch();break;case"view":case"hover":case"click":var e=this.switch_on[0];t(this.$switchOnElem,"$switchOnElem undefined for hover/click triggers.");if(e=="hover"){this.bindHover(this.$switchOnElem,this.triggerSwitch.bind(this))}else if(e=="view"){this.bindInViewPort(this.$switchOnElem,this.triggerSwitch.bind(this))}else{this.bindClick(this.$switchOnElem,this.triggerSwitch.bind(this))}break;default:throw new Error("Invalid show trigger specified "+this.switch_on)}},fetch:function(){if(this.fetchCalled){return}this.fetchCalled=true;this.serverCall("fetch_toggled_component").kwargs({serialized_args:this.serialized_args}).sendJsData(false).contentFor(this.$fetchInto.get(0),{parentCID:this.cid}).success(this.onFetched.bind(this)).send({batched:true})},onFetched:function(){this.fetchCompleted=true;if(this.switchPending){this.switchPending=false;this.triggerSwitch()}},enterLoadingState:function(){if(this.$loadingShow){this.$loadingShow.removeClass("hidden")}if(this.$loadingHide){this.$loadingHide.addClass("hidden")}},exitLoadingState:function(){if(this.$loadingShow){this.$loadingShow.addClass("hidden")}},actualSwitch:function(){if(!this.two_way_switch&&this.switchCompleted){return}this.switchCompleted=true;if(this.$switchShow){this.$switchShow.toggleClass("hidden")}if(this.$switchHide){this.$switchHide.toggleClass("hidden")}},triggerSwitch:function(){this.fetch();if(!this.fetchCompleted){this.switchPending=true;this.enterLoadingState()}else{this.exitLoadingState();this.actualSwitch()}},bindClick:function(e,t){e.on("click",function(e){e.preventDefault();t()})},bindHover:function(e,t){if(!o){e.on("hover",t)}else{this.bindInViewPort(e,t)}},bindInViewPort:function(e,t){if(s(e.get(0))){t()}else{var i={leading:true};var o=n(function(){if(s(e.get(0))){t();window.removeEventListener("scroll",o)}},50,i);window.addEventListener("scroll",o)}}})},{assert:true,debounce:true,"interface/component":true,"interface/settings":true});require.install("interface/cookies",function(require,exports,module){var e=require("interface/settings"),t=require("interface/helpers").wrap,i=require,n,o;var s=["setQfeedLog","setTlog"];if(e.pageIsMobile){n=i("mobile_app2/cookies");o=function(e,t,i){if(t===null){t=""}else{t=""+t}return n.setCookie(e,t,i)}}else{n=i("cookies");o=function(e,t,i){return n.cookie(e,t,i)}}t(exports,n,s);exports.setCookie=o},{"interface/settings":true,"interface/helpers":true});require.install("unified_view/qtext",function(require,exports,module){var e=require("interface/settings"),t=require,i=require("unified_view/toggle"),n=require("interface/cookies"),o=require("interface/jquery")._jQuery,s=require("w2.context");if(e.pageIsMobile){var r=t("mobile_app2/action_log")}else{var r=t("action_log")}var a=exports.ExpandableContext=s.Context.extend({initialProperties:function(){return{loading:false,forceSwitch:true}}});exports.Expandable=i.ToggleBase.extend({contextConstructor:function(){return a},onLoad:function(){this.expandableContext=this.getContext(a);this.expandableContext.on("forceSwitch",this.triggerSwitch.bind(this))},enterLoadingState:function(){this.expandableContext.set("loading",true)},actualSwitch:function(){if(!this.switchCompleted){if(this.obj_type){n.setQfeedLog(this,this.obj_type+"Expand")}r.logSecondaryAction("ContentExpand",null);if(!e.pageIsMobile&&window.YT&&window.YT.players){var i=t("ytplayer");var s=o(this.$switchHide.get(0));var a=o(this.$switchShow.get(0));var l=i.getYTPlayerStatuses(s,function(e){o(e).parent().addClass("thumbnail").empty()});i.restoreYTPlayerStatuses(a,l)}}this._super()}})},{"interface/cookies":true,"interface/settings":true,"unified_view/toggle":true,"interface/jquery":true,"w2.context":true});require.install("app/view/common",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor"),i=t.InlineEditor,n=require("input_validate").InputValidator,o=t.registerEditorCallback,s=t.unregisterEditorCallback,r=t.triggerEditorCallback,a=require("unified_view/qtext").ExpandableContext;exports.SuggestedEditSaveButton=e.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(function(e){this.serverCall("publish_edit").liveMutate().send();return false}))}});exports.Content=e.extend({onLoad:function(){this.expandableContext=this.getContext(a);this.$content=this.$("#@content");this.$editor=this.$("#@editor");if(this.suggestion_exists){this.bindContentCallbacks()}else{this.bindEditorCallbacks()}this.editorFetched=this.editor_loaded;this.editorLoaded=this.editor_loaded},toggle:function(e){if(this.expandableContext){this.expandableContext.set("forceSwitch",true)}if(e||this.$content.hasClass("hidden")){this.showContent()}else{this.showEditor()}},showContent:function(){this.$content.removeClass("hidden");this.$editor.addClass("hidden")},showEditor:function(){if(!this.editorLoaded){this.$("#@loading").removeClass("hidden");this.fetchEditor();return}this.$content.addClass("hidden");this.$editor.removeClass("hidden")},fetchEditor:function(){if(this.editorFetched){return}this.editorFetched=true;this.serverCall("editor_component").contentFor(this.$editor.get(0),{parentCID:this.cid}).success(this.fnbind(function(){this.$("#@loading").addClass("hidden");this.editorLoaded=true;r("edit",this.content_type,this.oid);this.showEditor()})).send()},bindEditorCallbacks:function(){o("edit",this.content_type,this.oid,this.cid,this.toggle.bind(this));o("submitted",this.content_type,this.oid,this.cid,this.toggle.bind(this,true));o("cancel",this.content_type,this.oid,this.cid,this.toggle.bind(this,true))},unbindEditorCallbacks:function(){s("edit",this.content_type,this.oid,this.cid);s("cancel",this.content_type,this.oid,this.cid);s("submitted",this.content_type,this.oid,this.cid)},bindContentCallbacks:function(){u(this.content_type,this.oid,this.cid,this.toggle.bind(this))},unbindContentCallbacks:function(){d(this.content_type,this.oid,this.cid)},onUnload:function(){if(this.suggestion_exists){this.unbindContentCallbacks()}else{this.unbindEditorCallbacks()}}});var l=function(e,t,i){var n="content_toggle_"+e+"_"+t;if(i){n+="."+i}return n};var u=function(e,t,i,n){var o=l(e,t,i);$(document).on(o,function(){return n()})};exports.registerContentToggleCallback=u;var d=function(e,t,i){var n=l(e,t,i);$(document).off(n)};exports.unregisterContentToggleCallback=d;var c=function(e,t){$(document).trigger(l(e,t))};exports.triggerContentToggleCallback=c;exports.SuggestedEditsEditor=i.extend({onLoad:function(){this._super.apply(this,arguments);this.disclaimer_update="";this.answer_attribution_update="";this.answer_resistance=false;this.setToggleCallback(this.fnbind(function(){if(this.parent()){if(this.parent().toggleButtons){this.parent().toggleButtons()}this.parent().$("#@disclaimer, #@nfr, #@answer_attribution").toggle()}if(this.editorShown){this.editor.fixEditorButtons()}}));var e=this;e.lookup("editor").whenOnLoaded(function(){e.original_input=e.get_value();e.originalReviewData=e.getReviewData()})},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(e){var t={};if(this.lookup("editor_share",true)){t=this.lookup("editor_share").getValues()}n.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}});e.preventDefault()}))},reviewDataUnchanged:function(){var e=this.getReviewData();var t=this.originalReviewData;return e===t||e!==null&&t!==null&&e.base===t.base},okToSubmitRequest:function(){if(!this.editor.hasChanged(this.original_input)&&this.disclaimer_update===""&&this.answer_attribution_update===""&&this.reviewDataUnchanged()){return false}return this._super.apply(this,arguments)},_get_kwargs:function(){var e="";if(this.has_comment&&!this.lookup("comment_editor").isEmpty()){e=this.lookup("comment_editor").serialize()}var t={};if(this.lookup("editor_share",true)){t=this.lookup("editor_share").getValues()}return{object_id:this.id,input:this.get_value(),sugg_exists:this.sugg_exists,notif:this.$("#@notif").attr("checked")?1:0,comment:e,disclaimer_update:this.disclaimer_update,answer_attribution_update:this.answer_attribution_update,review_data:this.getReviewData(),should_collapse:this.shouldCollapse(),share_values:t,answer_resistance:this.answer_resistance}},ajax_callback:function(e){if(e&&e.answer_resistance){this.showAnswerResistance();this.locked=false;return}if(e&&e.show_collapse_modal){this.showAnswerCollapseModal(e.aid)}return this._super.apply(this,arguments)},shouldCollapse:function(){if(this.$("#@collapse").length>0){return this.$("#@collapse").is(":checked")}else{return false}},showAnswerResistance:function(){this.answer_resistance=true;this.lookup("answer_resistance").show();this.input_button_obj.removeClass("disabled").text(this.resistance_text);this.focusInput()},showAnswerCollapseModal:function(e){this.modal("show_collapse_modal",{kwargs:{aid:e,is_answer_page:this.is_answer_page}})}});exports.FeedStoryItem=e.extend({onLoad:function(){var e=this;this.$("#@item").hover(function(t){e.$("#@item").addClass("hover")},function(t){e.$("#@item").removeClass("hover")})},getHash:function(){return this.hash}})},{"unified_view/qtext":true,"view/inline_editor":true,input_validate:true,"w2.quora":true});require.install("views",function(require,exports,module){var e=require("webnode2"),t=require("event"),i=t.add,n=require("log").log;var o=require("Class").Class.extend({__init__:function(){this.trackedKey={};this.trackedComponents=[];this.lastCheckTime=0;this.rateLimitMs=400;i(document,"scroll",this.fnbind(this.logViews))},addComponentToTrack:function(e){var t=e.view_tracking_key;if(!t){if(n&&n.enabled){n("views",'"view_tracking_key" not found for the component.'+"This should be specified in js_init")}}if(this.trackedKey[t]){return}this.trackedKey[t]=true;this.trackedComponents.push(e)},logViews:function(){var t=+new Date;var i=[];var n;var o;var s;var r;var a;if(t<this.lastCheckTime+this.rateLimitMs){return}for(n=0;n<this.trackedComponents.length;n++){o=this.trackedComponents[n];if(!o){continue}s=o.getJQueryObject();r=s.is(":visible")&&s.is(":in-viewport");if(!r){continue}i.push(o.view_tracking_key);this.trackedComponents[n]=undefined}a={keys:i};if(i.length){e.rpc("/ajax/log_views_POST").kwargs({messages:a}).send()}this.trackedComponents=this.trackedComponents.filter(function(e){return e!==undefined})}});exports.viewsLogger=new o},{webnode2:true,Class:true,event:true,log:true});require.install("view/paged_list",function(require,exports,module){require("jquery.whenIdle");var e=require("log").log,t=require("w2.quora").Component,i=require("webnode2"),n=require("w2.errors"),o=require("event"),s=o.add,r=o.remove,a=require("window_manager"),l=".pagedlist_item:not(.pagedlist_hidden):not(.pagedlist_invisible)",u=require("spin");var d=function(e){return e.is(":visible")&&!e.hasClass("pagedlist_invisible")&&e.height()!==0};exports.PagedList=t.extend({init:function(e){this._super.apply(this,arguments);this.model_count=e.initial_count;this.container=window;this.first_hidden_index=0;this.visible_count=0;this.invisible_count=0;this.total_count=0;this.initializeCounts();this.max_should_show=this.buffer_count;this.hidden_count=0;this.currently_fetching=false;this.waiting_for_updates=false;this.waiting_for_updates_from_preload=false;this.show_hidden_when_done_updating=false;this.lastGetMoreSucceeded=true;this.onShowHidden=new i.Event(this);this.onGetMoreDone=new i.Event(this);this.onGetMoreDone.bind(this.maybeUpdateOptimizedPaged);if(this.retarget_links){this.retarget()}},onLoad:function(){var e=this,t=$(i.getLiveDomElement(this.cid)),n=this.capture_global_keyevents?document.body:t;this.onKeyCombination(t,"j",e.focusNextItem.bind(e,false),n);this.onKeyCombination(t,"k",e.focusNextItem.bind(e,true),n)},getFocusedItem:function(){var e=i.getLiveDomId(this.cid),t=$("#"+e+" .pagedlist_item:focus").first();if(t.length){return t}return null},maybeScrollToItem:function(e,t,i){var n=e.height(),o=e.position().top,s=o+n,r=$(document).scrollTop()+a.headerOffset,l=Math.max(0,$(window).height()-(a.headerOffset+a.actionBarHeight+a.scrollContext)),u=r+l;if(!t.length){
if(i&&o>=r){a.scrollAndFocus(0);return}else if(!i&&s<=u){a.scrollAndFocus($(document).height());return}t=e}if(s<r||o>u){a.scrollAndFocus(o);return}else{var d=i&&o>=r-5||!i&&s<=u+5;if(d){n=t.height();o=t.position().top;s=o+n}var c=r;if(i){if(d&&n>l){c=s-l}else if(o<r){c=o}}else{var h=$(window).height()*.25;if(o>r+h){c=o-h+5}else if(!d){c=r+l}}c=r+Math.max(Math.min(c-r,l),-l);a.scrollAndFocus(c,d&&t)}},focusNextItem:function(e){$("html,body").stop(true,true);var t=this.getFocusedItem();if(t){var n=t;do{n=e?n.prev():n.next()}while(n.length&&!d(n));this.maybeScrollToItem(t,n,e)}else{var o=i.getLiveDomId(this.cid),s=$(document).scrollTop()+a.headerOffset,r=$("#"+o+" "+l);r.each(function(e,t){if($(t).offset().top>s){$(t).focus();return false}})}},onMoreButtonClick:function(t){if(!t){n.beginCanBeRelatedToUserActionBlock(100)}if(e&&e.enabled){e("paged_list.PagedList.onMoreButtonClick",this.cid,"'More...' button clicked",t?"(auto)":"")}var i=this.showHiddenAndMaybeGetMore();if(!i){this.show_hidden_when_done_updating=true}if(this.currently_fetching){this.showLoading()}return false},loadMoreButton:function(){this.child("more_button").$("#@more").click(this.fnbind(function(){return this.onMoreButtonClick()}));if(!this.crawler&&this.has_more){$.whenIdle(500,2e3,this.fnbind(function(){setTimeout(this.fnbind(function(){this.maybeGetMore()}),50)}))}},initializeCounts:function(){var e=i.getLiveDomId(this.cid);if(!e){return}var t=document.getElementById(e);if(!t){return}var n=t.childNodes;for(var o=0;o<n.length;o++){var s=$(n[o]);var r=s.attr("id");if(r&&s.hasClass("pagedlist_item")){this.first_hidden_index+=1;this.total_count+=1;if(!s.hasClass("pagedlist_invisible")){this.visible_count+=1}else{this.invisible_count+=1}}}},showHiddenAndMaybeGetMore:function(){this.showHidden(this.buffer_count);return this.maybeGetMore()},showHidden:function(e){var t=0;var n=0;var o=i.getLiveDomElement(this.cid);if(!o){return}var s=o.childNodes;var r=false;for(var a=0;a<s.length;a++){var l=$(s[a]);if(l.hasClass("pagedlist_item")&&l.hasClass("pagedlist_hidden")){if(!l.hasClass("pagedlist_invisible")){t+=1}if(!r){r=true}l.removeClass("pagedlist_hidden");s[a].style.display="";n+=1;if(t>=e){break}}}this.visible_count+=t;this.hidden_count-=t;this.first_hidden_index+=n;if(this.visible_count>this.max_should_show){this.max_should_show=this.visible_count}this.onShowHidden.trigger()},hideLoading:function(){if(e&&e.enabled){e("paged_list.PagedList.hideLoading","Hide loading...")}var t=this.child("more_button");t.$("#@loading").hide();if(this.lastGetMoreSucceeded){t.updateAutoClickCapable()}else{t.auto_click_capable=false}t.maybeEnableOrDisableAutoClick()},showLoading:function(){if(e&&e.enabled){e("paged_list.PagedList.showLoading","Show loading...")}if(this.auto_paged&&!this.crawler){if(!this.spinner){this.spinner=u.createSpinnerDom({},"__contentfor_paged_list_loading_spinner")}var t=this.child("more_button").$("#@loading");t.append(this.spinner);t.show()}else{this.child("more_button").$("#@loading").show()}},hideMoreButton:function(){var e=this.child("more_button");if(!e.isVirtual){e.maybeHideButton()}},showMoreButton:function(){var e=this.child("more_button");if(!e.isVirtual){e.maybeShowButton()}},maybeGetMore:function(e){if(this.currently_fetching||this.waiting_for_updates||this.waiting_for_updates_from_preload){if(e!==undefined&&this.total_count<e){this.onGetMoreDone.bindOnce(function(){this.maybeGetMore(e)});return true}else{return false}}if(e!==undefined&&this.total_count<e){this.getMore(e)}else if(this.visible_count+this.hidden_count>=this.model_count&&this.hidden_count<=this.buffer_count/4){this.getMore()}else if(this.hidden_count<=0){this.hideMoreButton()}return true},maybeUpdateOptimizedPaged:function(){if(!this.optimize_for_seo){return}if(this.model_count>this.offset_count){this.model_count-=this.offset_count}if(this.child("html_nav")){this.html_nav_item=i.getLiveDomElement(this.child("html_nav").cid);this.html_nav_item.style.display="block"}},getMore:function(e){this.currently_fetching=true;this.waiting_for_updates=true;this.serverCall("increase_count").kwargs({cid:this.cid,num:e!==undefined?e-this.total_count:this.buffer_count,current:this.model_count}).success(this.fnbind(this._onGetMoreSuccess)).error(this.fnbind(this._onGetMoreError)).send();return false},_onGetMoreSuccess:function(){this.lastGetMoreSucceeded=true;this.currently_fetching=false;if(!this.waiting_for_updates){this.hideLoading();if(this.show_hidden_when_done_updating){this.show_hidden_when_done_updating=false;this.showHiddenAndMaybeGetMore()}}this.onGetMoreDone.trigger()},_onGetMoreError:function(){this.lastGetMoreSucceeded=false;this.currently_fetching=false;setTimeout(this.fnbind(function(){this.waiting_for_updates=false;this.hideLoading()}),2e3)},getDebugStr:function(e,t){var i="hidden_count: "+this.hidden_count;i+=" visible_count: "+this.visible_count;i+=" model_count: "+this.model_count;i+=" buffer_count: "+this.buffer_count;i+=" first hidden index: "+this.first_hidden_index;i+=" op position: "+e.position;i+=" invisible_count: "+this.invisible_count;i+=" total_count: "+this.total_count;i+=" hidden per JS?: "+t;return i},checkState:function(e){var t=i._domids[this.cid];var n=document.getElementById(t);var o=n.childNodes;var s=0;var r=0;var a=0;var l=0;for(var u=0;u<o.length;u++){var d=$(o[u]);if(d.hasClass("pagedlist_item")){s+=1;if(d.hasClass("pagedlist_hidden")){a+=1}else{if(d.hasClass("pagedlist_invisible")){l+=1}else{r+=1}}}}var c="total_count: "+this.total_count;c+=", dom_total_count: "+s;c+=" || visible_count: "+this.visible_count;c+=", dom_visible_count: "+r;c+=" || hidden_count: "+this.hidden_count;c+=", dom_hidden_count: "+a;c+=" || invisible_count: "+this.invisible_count;c+=", dom_invisible_count: "+l;c+=" || model_count: "+this.model_count;c+=" || first hidden index: "+this.first_hidden_index;if(this.total_count!=s||this.visible_count!=r||this.hidden_count!=a||this.invisible_count!=l){$.serverLog("qfeed_check_state_fail: "+e+" "+c,"DEBUG")}else{}},onInsertNode:function(e,t){var n=this.$("#"+t);if(!n.hasClass("pagedlist_item")){return}if(this.retarget_links){n.find("a:not([href^=#])").attr("target","_blank")}var o=n.hasClass("pagedlist_invisible");this.total_count+=1;if(e.position>0&&e.position>=this.first_hidden_index){n.addClass("pagedlist_hidden");e.transition.type="none";if(!o){this.hidden_count+=1;if(this.fixed_size_paged_list&&this.first_hidden_index<this.max_should_show){this.showHidden(1)}else{this.showMoreButton()}}}else{n.removeClass("pagedlist_hidden");n[0].style.display="";var s=true;if(!o){this.visible_count+=1;if(this.fixed_size_paged_list&&this.visible_count>=this.first_hidden_index&&this.first_hidden_index>=this.max_should_show){s=true;var r=i._domids[this.cid];var a=document.getElementById(r);var l=a.childNodes;var u=0;for(var d=0;d<l.length;d++){var c=$(l[d]);if(c.hasClass("pagedlist_item")&&!c.hasClass("pagedlist_hidden")&&!c.hasClass("pagedlist_invisible")){u+=1;if(u>this.first_hidden_index){c.addClass("pagedlist_hidden");l[d].style.display="none";this.hidden_count+=1;this.visible_count-=1;this.showMoreButton();break}}}}}else{this.invisible_count+=1}if(!this.fixed_size_paged_list||!s){this.first_hidden_index+=1}}},onDeleteNode:function(e,t){var i=this.$("#"+t);if(!i.hasClass("pagedlist_item")){return}var n=i.hasClass("pagedlist_invisible");var o=i.hasClass("pagedlist_hidden");this.total_count-=1;if(e.position>=this.first_hidden_index){if(!n){this.hidden_count-=1;if(this.hidden_count<0||!o){$.serverLog("qfeed_hidden_count_broken delete hidden: "+this.getDebugStr(e,o),"DEBUG")}}}else{this.first_hidden_index-=1;if(!n){this.visible_count-=1;if(this.fixed_size_paged_list){this.showHidden(1)}}else{this.invisible_count-=1}if(o){$.serverLog("qfeed_hidden_count_broken delete shown: "+this.getDebugStr(e,o),"DEBUG")}}},onUpdate:function(e){this.model_count=e.count;var t=this.child("more_button");if(!t.isVirtual){t.maybeEnableOrDisableAutoClick();if(this.hidden_count<=0){this.hideMoreButton()}else{this.showMoreButton()}}this.waiting_for_updates=false;this.waiting_for_updates_from_preload=false;if(this.visible_count<this.buffer_count&&this.hidden_count>0){this.show_hidden_when_done_updating=true}var i=true;if(!this.currently_fetching){this.hideLoading();if(this.show_hidden_when_done_updating){this.show_hidden_when_done_updating=false;this.showHiddenAndMaybeGetMore();i=false}}this.onGetMoreDone.trigger();if(i){this.maybeGetMore()}},orderedVisibleChildren:function(){var e=i.getLiveDomElement(this.cid);var t=e.childNodes;var n=[],o;for(o=0;o<t.length;o++){var s=$(t[o]);var r=s.attr("id");if(r&&s.hasClass("pagedlist_item")&&!s.hasClass("pagedlist_invisible")){n.push(r)}}return n},allOrderedChildren:function(){var e=i.getLiveDomElement(this.cid);var t=e.childNodes;var n=false;var o=[];for(var s=0;s<t.length;s++){var r=$(t[s]);var a=r.attr("id");if(a&&r.hasClass("pagedlist_item")){if(n||!r.hasClass("pagedlist_invisible")){n=true;o.push(a)}}}return o},retarget:function(){this.$("#"+i.getLiveDomId(this.cid)+" .pagedlist_item").find('a:not([href^="#"])').attr("target","_blank")}});exports.PagedListMoreButton=t.extend({init:function(){this._super.apply(this,arguments);this.last_check_time=0;this.rate_limiter_ms=245;this.auto_click_enabled=false;this.updateAutoClickCapable()},updateAutoClickCapable:function(){this.auto_click_capable=this.auto_click_period!==null&&this.auto_click_period>0},checkButtonPosition:function(e){if(!this.auto_click_capable){return}if(!this.parent()){return}var t=+new Date;if(!e&&t<this.last_check_time+this.rate_limiter_ms){return}var i=this.parent().model_count;if(this.parent().waiting_for_updates){i+=this.parent().buffer_count}var n=this.shouldEnableAutoClickFromModelCount(i);this.last_check_time=t;var o=this.$("#@more");if(o.length===0){return}var s=this.$("#@sentinel");var r=this.parent().container;var a=Math.ceil($(r).height());var l=false;if(s.is(":in-viewport")){l=true}else if(!$.belowthefold(s,{threshold:a,container:r})){l=true}if(!l){return}if(this.parent().currently_fetching||this.parent().waiting_for_updates){this.parent().showLoading();if(n){this.parent().show_hidden_when_done_updating=true}return}if(!n){return}this.parent().onMoreButtonClick()},onLoad:function(){this.parent().loadMoreButton();this.parent().onShowHidden.bind(this.fnbind(function(){if(!this.auto_click_capable){return}if(!this.auto_click_enabled&&this.shouldEnableAutoClickFromModelCount(this.parent().model_count+this.parent().buffer_count)&&this.$("#@more").is(":visible")){this.maybeHideButton()}}));if(this.auto_click_capable){var e=this.fnbind(function(){setTimeout(this.fnbind(this.checkButtonPosition,false),125)});this._mousemove_handler=s(document,"mousemove",e);this._keypress_handler=s(document,"keypress",e);this._scroll_handler=s(document,"scroll",e)}this.maybeEnableOrDisableAutoClick();if(this.auto_click_enabled){$.whenIdle(500,2e3,this.fnbind(function(){setTimeout(this.fnbind(function(){this.checkButtonPosition(true)}),125)}))}},onUnload:function(){if(this._mousemove_handler!==undefined){r(document,"mousemove",this._mousemove_handler)}if(this._keypress_handler!==undefined){r(document,"keypress",this._keypress_handler)}if(this._scroll_handler!==undefined){r(document,"scroll",this._scroll_handler)}},maybeShowButton:function(){if(!this.auto_click_enabled){this.$("#@more").show()}},maybeHideButton:function(){this.$("#@more").hide()},shouldEnableAutoClickFromModelCount:function(e){return e%this.auto_click_period!==0},maybeEnableOrDisableAutoClick:function(){if(!this.auto_click_capable){this.auto_click_enabled=false;return}var e=this.shouldEnableAutoClickFromModelCount(this.parent().model_count);if(e&&!this.auto_click_enabled){this.auto_click_enabled=true;this.parent().hideMoreButton()}else if(!e&&this.auto_click_enabled){this.auto_click_enabled=false}},counterStr:function(){return"PagedList counters: "+"total_count "+this.total_count+", visible_count "+this.visible_count+", invisible_count "+this.invisible_count+", hidden_count "+this.hidden_count+", first_hidden_index "+this.first_hidden_index}})},{log:true,window_manager:true,webnode2:true,"jquery.whenIdle":true,"w2.quora":true,spin:true,event:true,"w2.errors":true});require.install("app/view/feed",function(require,exports,module){var e=require("webnode2"),t=require("event"),i=require("w2.quora").Component,n=t.add,o=t.remove,s=require("view/fixable2"),r=require("window_manager"),a=require("settings"),l=require("cookies"),u=require("log").log,d=require("views").viewsLogger,c=require("w2.context");exports.UniversalPageFeed=require("view/paged_list").PagedList.extend({init:function(e){this._super.apply(this,arguments);this.pageLoadTime=+new Date;this.viewerUid=e.uid;this.hashPosition={};this.initiallyVisible={};this.firstQueryID=0;this.offset=0;this.firstElement=0;this.needsRefresh=false;this.num_prefeed_stories=e.num_prefeed_stories;this.hashImpressions={};this.lastCheckTime=0;this.lastRevealTime=0;this.visibleStorySelectors=[];this.impressionData=[];this.dontLogImpressions=e.dont_log_imp;this.maxImpPos=-1;this.hashReadingTime={};this.loggedReadingTime={};this.hashPreviousVisibleTime={};this.lastVisibilityUpdate=0;this.shouldLogReadingTime=require("gating").enable_reading_time_logging;this.nextThreshold={};this.readingTimeUpdates=[];this.usePersistentFeed=e.use_persistent_feed;this.pfInitialMoreStoriesPos=e.pf_initial_morestories_pos;this.moreStoriesShown=false;this.pfPrefetchStarted=false;this.numConsecutivePreloadFails=0;this.bannerShown=false;this.setDvar("feed_story_hash",null);this.setDvar("feed_story_position",null);this.setDvar("feed_story_inner_position",null);this.setDvar("feed_story_initial",null);this.setDvar("feed_ty",e.feed_ty);this.setDvar("feed_page",e.feed_page);this.setDvar("page_data",e.page_data);this.setDvar("focus_ty",e.focus_ty)},onLoad:function(e){u("feed.UniversalPageFeed.onLoad","start");this._super.apply(this,arguments);var t=this;if(this.debug){return}this.recordImpressions(true);setInterval(this.fnbind(this.recordImpressions,false),t.rate_limiter_ms+500);if(this.shouldLogReadingTime){this.updateVisibility(true);setInterval(this.fnbind(this.updateVisibility,false),this.reading_time_rate)}var i=this.fnbind(this.recordImpressions,false,false);this._mousemove_handler=n(document,"mousemove",i);this._keypress_handler=n(document,"keypress",i);this._scroll_handler=n(document,"scroll",i);if(this.usePersistentFeed){this._pfPrefetchScrollHandler=n(document,"scroll",function(){if(!t.pfPrefetchStarted){t.pfPrefetchStarted=true;setInterval(t.fnbind(t.prefetchPersistentFeed),2500)}})}var o=this.child("more_stories");o.$("#@more_stories").click(function(){var e=+new Date;if(e-t.pageLoadTime>=2.5*3600*1e3){location.reload()}else{t.revealPreloadedPersistentFeed(true,true)}t.hideMoreStoriesButton()});$(document).bind("bannerShown",function(){t.bannerShown=true;t.hideMoreStoriesButton()});$(document).bind("bannerHidden",function(){t.bannerShown=false})},onFeedBottomIndicatorClicked:function(){if(!this.hasHiddenPrefetchedStories()){location.reload()}else{this.revealPreloadedPersistentFeed(true,true)}},onUnload:function(){o(document,"mousemove",this._mousemove_handler);o(document,"keypress",this._keypress_handler);o(document,"scroll",this._scroll_handler);o(document,"scroll",this._pfPrefetchScrollHandler)},getPrefetchedItems:function(){return $(".UniversalPageFeed").find(".preloaded_pf")},hasHiddenPrefetchedStories:function(){return this.getPrefetchedItems().length>0},prefetchPersistentFeed:function(){var e=this;if(!this.usePersistentFeed){return}if(this.currently_fetching||this.waiting_for_updates||this.waiting_for_updates_from_preload){u("feed.UniversalPageFeed.prefetchPersistentFeed","end early","    currently_fetching:",this.currently_fetching,"    waiting_for_updates:",this.waiting_for_updates,"    waiting_for_updates_from_preload:",this.waiting_for_updates_from_preload);return}if(this.hasHiddenPrefetchedStories()){u("feed.UniversalPageFeed.prefetchPersistentFeed","already prefetched");return}if(this.numConsecutivePreloadFails>2){u("feed.UniveresalPageFEed.prefetchPersistentFeed","rate limit due to consecutive fails");return}u("feed.UniversalPageFeed.prefetchPersistentFeed","start");e.waiting_for_updates_from_preload=true;this.serverCall("prefetch_stories").kwargs({cid:this.cid,current:this.model_count}).success(function(t){if(!t){e.waiting_for_updates_from_preload=false;e.numConsecutivePreloadFails+=1;u("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return empty. number of consecutive failures:",e.numConsecutivePreloadFails)}else{u("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return success",e.waiting_for_updates_from_preload);e.numConsecutivePreloadFails=0}}).error(function(){e.waiting_for_updates_from_preload=false;e.numConsecutivePreloadFails+=1;u("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return error. number of consecutive failures:",e.numConsecutivePreloadFails)}).send();u("feed.UniversalPageFeed.prefetchPersistentFeed","fetched")},revealStories:function(){setTimeout(function(){$(".reveal_story").removeClass("reveal_story")},1500)},revealPreloadedPersistentFeed:function(t,i){var n=this;if(!this.usePersistentFeed){return}u("feed.UniversalPageFeed.revealPreloadedPersistentFeed","start");if(!this.hasHiddenPrefetchedStories()){u("feed.UniversalPageFeed.revealPreloadedPersistentFeed","no stories to reveal");return}if(t){var o=+new Date;this.lastRevealTime=o}var s=this.children();var r=0;var a=false;for(var l=0;l<s.length;l++){var d=s[l];var c=d.$("#@item");if(c.hasClass("preloaded_pf")){c.removeClass("preloaded_pf");c.removeClass("hidden");if(t&&i){c.addClass("reveal_story");this.revealStories()}++r;if(!a){this.firstElement=d.getHash();a=true}}else if(c.hasClass("hidden_timestamp")){c.removeClass("hidden_timestamp");c.removeClass("hidden")}}u("feed.UniversalPageFeed.revealPreloadedPersistentFeed",r,"stories revealed");this.hideMoreStoriesButton();if(t){var h=n.$(".SiteHeader").height();var f=e.getLiveDomElement(n.cid).offsetTop;var p=20;var g=Math.max(f*2,window.innerHeight*2);window.scrollTo(0,g);$("html, body").animate({scrollTop:f-h-p},700)}u("feed.UniversalPageFeed.revealPreloadedPersistentFeed","server call");this.serverCall("reveal_stories").send();u("feed.UniversalPageFeed.revealPreloadedPersistentFeed","end")},showMoreStoriesButton:function(){if(!this.usePersistentFeed||!this.hasHiddenPrefetchedStories()||this.bannerShown){return}u("feed.UniversalPageFeed.showMoreStoriesButton","show more stories button");var e=this.child("more_stories");var t=e.$("#@more_stories");t.removeClass("hidden");this.moreStoriesShown=true},hideMoreStoriesButton:function(){if(!this.usePersistentFeed){return}u("feed.UniversalPageFeed.hideMoreStoriesButton","hide more stories button");var e=this.child("more_stories");var t=e.$("#@more_stories");t.addClass("hidden")},bottomIndicatorIsVisible:function(){var e=$(".FeedBottomIndicator");return e&&e.is(":in-viewport")},updatePositions:function(t){var i=this.children();var n=false;var o,s,r,a;if(!t){a=this.offset;for(o=0;o<i.length;o++){r=i[o];if(!r.getDvar){continue}if(r.getDvar("feed_story_hash")==this.firstElement){var l=this.orderedVisibleChildren();for(s=0;s<l.length;s++){if(l[s]==e.getLiveDomId(r.cid)){this.offset=s}}}}if(this.offset!=a){n=true}}var u=this.orderedVisibleChildren();var d,c;this.firstQueryID=0;for(s=0;s<u.length;s++){d=document.getElementById(u[s]);r=e.getComponentFromElement(d);c=r.$("#@item");if(this.firstQueryID<=0&&!c.hasClass("preloaded_pf")){this.firstQueryID=r.query_id}var h=s-this.offset+this.num_prefeed_stories;var f=r.getHash();this.hashPosition[f]=h}if(t){for(s=0;s<i.length;s++){if(e.getLiveDomId(i[s].cid)==u[0]){this.firstElement=i[s].getDvar("feed_story_hash")}}}return n},addReadingTimeEntry:function(e){this.readingTimeUpdates.push({hash:e,position:this.hashPosition[e],initially_visible:this.initiallyVisible.hasOwnProperty(e),reading_time:this.hashReadingTime[e]});this.loggedReadingTime[e]=this.hashReadingTime[e]},updateVisibility:function(e){var t=this;var i=+new Date;if(!document.hasFocus()||this.dontLogImpressions){this.lastVisibilityUpdate=i;return}var n=this.children();var o,s,r;for(r=0;r<n.length;r++){o=n[r];if(!o.getHash||!o.validForLoggingImpression(false)){continue}s=o.getHash();if(o.isVisible()){if(this.hashPreviousVisibleTime[s]===this.lastVisibilityUpdate&&this.lastVisibilityUpdate>i-2*this.reading_time_rate){this.hashReadingTime[s]=(this.hashReadingTime[s]||0)+(i-this.lastVisibilityUpdate)}this.hashPreviousVisibleTime[s]=i}else if(this.hashReadingTime[s]&&this.hashReadingTime[s]>this.loggedReadingTime[s]){this.addReadingTimeEntry(s)}}var a;for(s in this.hashReadingTime){a=this.nextThreshold[s]||0;if(this.hashPosition.hasOwnProperty(s)&&this.reading_time_thresholds[a]&&this.hashReadingTime[s]>=this.reading_time_thresholds[a]){this.addReadingTimeEntry(s);this.nextThreshold[s]=a+1}}if(this.readingTimeUpdates.length>0&&this.viewerUid&&i-this.pageLoadTime>=this.wait_until_log_impression_ms){var l=this.readingTimeUpdates;var d=this.serverCall("log_reading_times");d.kwargs({data:l});d.error(function(){for(var e in l){var i=l[e].hash;if(l[e].reading_time===t.loggedReadingTime[i]){t.nextThreshold[i]--}}});u("feed.UniversalPageFeed.updateVisibility","server call");d.send();u("feed.UniversalPageFeed.updateVisibility","server call sent");this.readingTimeUpdates=[]}u("feed.UniversalPageFeed.updateVisibility","end");this.lastVisibilityUpdate=i},addImpression:function(t,i){var n=t.getHash();this.hashImpressions[n]=true;this.impressionData.push({hash:n,initially_visible:this.initiallyVisible.hasOwnProperty(n),position:i});if(require("gating").feed_impression_feedback){var o=e._domids[t.cid];var s=$(document.getElementById(o));this.visibleStorySelectors.push(s)}},recordImpressions:function(t){var i=this;if(this.debug){return}var n=+new Date;var o=t||this.needsRefresh;this.needsRefresh=false;if(!o&&n<this.lastCheckTime+this.rate_limiter_ms||n<this.lastRevealTime+3e3){return}this.lastCheckTime=n;u("feed.UniversalPageFeed.recordImpressions","started, called with",t);var s=this.children();var r,a;o=this.updatePositions(t)||o;var l=false;for(a=0;a<s.length;a++){r=s[a];if(!r.getHash||!r.validForLoggingImpression(o)){continue}var d=r.isVisible();var c=r.getHash();var h=this.hashPosition[c];u("feed.UniversalPageFeed.recordImpressions","    firstQueryID:",this.firstQueryID,"    comp.query_id:",r.query_id,"    domid:",e._domids[r.cid],"    inViewport:",d,"    position:",h,"    hash:",c);if(this.usePersistentFeed&&d){this.maxImpPos=Math.max(this.maxImpPos,h);if(r.query_id!=this.firstQueryID&&r.query_id>0){u("feed.UniversalPageFeed.recordImpressions","diff",r.query_id,this.firstQueryID);l=true}else if(!this.moreStoriesShown&&(this.pfInitialMoreStoriesPos>=0&&h>=this.pfInitialMoreStoriesPos)){u("feed.UniversalPageFeed.recordImpressions","initial morestories button shown: pos",h);l=true}}if(this.hashImpressions[c]||!o&&!d){continue}u("feed.UniversalPageFeed.recordImpressions","check to see if should reset dvars/record impression");if(o){r.setDvar("feed_story_position",h);r.setDvar("feed_story_initial",true)}if(d){u("feed.UniversalPageFeed.recordImpressions","impression recorded");if(t){i.initiallyVisible[r.getHash()]=true}this.addImpression(r,h)}}if(l||this.bottomIndicatorIsVisible()){if(this.hasHiddenPrefetchedStories()){this.showMoreStoriesButton()}}if(this.impressionData.length>0&&this.viewerUid&&n-this.pageLoadTime>=this.wait_until_log_impression_ms){var f=this.serverCall("log_impressions");var p=this.impressionData;f.kwargs({data:p});f.error(function(){for(var e in p){var t=true;for(var n in i.impressionData){if(i.impressionData[n].hash==p[e].hash){t=false;break}}if(t){i.impressionData.push(p[e])}}});if(!this.dontLogImpressions){u("feed.UniversalPageFeed.recordImpressions","server call");f.send();u("feed.UniversalPageFeed.recordImpressions","server call sent")}for(var g=0;g<this.visibleStorySelectors.length;g++){this.visibleStorySelectors[g].addClass("seen")}this.visibleStorySelectors=[];this.impressionData=[]}u("feed.UniversalPageFeed.recordImpressions","end")}});exports.FeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);var e=r.getURL();if(e.indexOf("?qp_story=")!=-1||e.indexOf("?digest_story=")!=-1){r.replaceURL("/");this.lookup("home_feed").$("#feed_visibility_wrapper").removeClass("invisible")}}});exports.PinnedFeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);this.removeQpUrlParam("pinned_feed")}});exports.TopicMainFeed=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);this.removeQpUrlParam("topic_feed")}});exports.FeedMuteItem=i.extend({onLoad:function(){this.$("#@mute_item").tooltip({contents:this.tooltip_text}).click(this.fnbind(function(){this.lookup("item").showMuteControls()}))}});exports.FeedMuteItemOverlay=i.extend({onLoad:function(){this.feed_item=this.cQuery(":item").$("#@feed_item");this.cancel=this.$("#@cancel_mute_item_wrapper");this.overlay=this.$("#@mute_item_overlay")},hide:function(){var e=this;e.overlay.removeClass("is_shown");setTimeout(function(){e.overlay.hide()},333)},show:function(){var e=this;e.overlay.css({width:e.feed_item.outerWidth(),height:e.feed_item.outerHeight()});e.overlay.show();setTimeout(function(){e.overlay.addClass("is_shown")},1)}});exports.FeedMuteItemControls=i.extend({onLoad:function(){this.item=this.cQuery(":item").$("#@item");this.controls=this.$("#@mute_item_controls");this.shown=false},hide:function(){var e=this;e.controls.removeClass("is_shown");setTimeout(function(){e.controls.hide()},333);this.shown=false},show:function(){var e=this;e.controls.show();e._centerPage();setTimeout(function(){e.controls.addClass("is_shown")},1);this.shown=true},_centerPage:function(){var e=this.controls.offset().top;var t=e-$(window).height()/2;$("html, body").animate({scrollTop:t},1e3)}});exports.FeedMuteButton=i.extend({onLoad:function(){var e=this.lookup("mute_item_controls").lookup("item");this.item=e.$("#@item");this.feed_item=e.$("#@feed_item");this.mute_item_overlay=e.lookup("mute_item_overlay").$("#@mute_item_overlay");this.mute_item_controls=e.lookup("mute_item_controls").$("#@mute_item_controls");this.$("#@mute_button").click(this.fnbind(function(){this.hideFeedItem();var e=this.qfeed_log_action;if(e){l.setQfeedLog(this,e)}this.serverCall("mute").kwargs({oid:this.oid,qid:this.qid,bid:this.bid}).liveMutate().send()}));this.$("#@mute_button").tooltip({contents:this.tooltip_text})},hideFeedItem:function(){this.mute_item_controls.hide();this.mute_item_overlay.hide();this.feed_item.parent(".feed_item").animate({opacity:0},this.fnbind(function(){this.feed_item.parent(".feed_item").slideUp(300)}))}});exports.FeedUnfollowButton=i.extend({onLoad:function(){var e=this.lookup("mute_item_controls").lookup("item");this.item=e.$("#@item");this.feed_item=e.$("#@feed_item");this.mute_item_overlay=e.lookup("mute_item_overlay").$("#@mute_item_overlay");this.mute_item_controls=this.lookup("mute_item_controls").$("#@mute_item_controls");var t={user:"UserUnfollow",question:"QuestionUnfollow",blog:"BoardUnfollow",topic:"TopicUnfollow"};this.$("#@unfollow_button").click(this.fnbind(function(){this.hideFeedItem();this.serverCall("unfollow").kwargs({oid:this.oid,qid:this.qid,bid:this.bid}).liveMutate().send()}))},hideFeedItem:function(){this.mute_item_controls.hide();this.mute_item_overlay.hide();this.feed_item.parent(".feed_item").animate({opacity:0},this.fnbind(function(){this.feed_item.parent(".feed_item").slideUp(300)}))}});exports.ExpandableLink=i.extend({onLoad:function(){this.$("#@show").click(this.fnbind(function(){this.$("#@inner_tree").show();this.$("#@show").hide();return false}));this.$("#@hide").click(this.fnbind(function(){this.$("#@inner_tree").hide();this.$("#@show").show();return false}))}});exports.ContentPageFeedStoryItemBase=i.extend({onLoad:function(){var e="";this.$("#@item .credibility_facts").truncate({lines:2});this.$("#@item .truncated_q_text a.more_link").html(e).removeClass("more_link").removeAttr("id").addClass("read_more").attr("href",this.target_url);this.$("#@item a.lil_button.rate_up").removeAttr("id").attr("href",this.target_url);this.$("#@item .answer_content").css({cursor:"pointer"});this.$("#@item_overlay").mousedown(this.fnbind(function(){this.serverCall("on_item_click").send();return false}))}});exports.QuestionNumberAnswers=i.extend({onLoad:function(e){this.$("#@link").mousedown(this.fnbind(function(){l.setQfeedLog(this,"QuestionClickthrough");l.setQueryLog(this,"QuestionClickthrough")}))}});exports.HomepageFeedStoryItem=i.extend({contextConstructor:function(){return c.FeedStoryItem},init:function(){this._super.apply(this,arguments);this.setDvar("feed_story_hash",this.hash);var e=this;e.allowServerCall=true;e.alreadySent=false;function t(){if(e.alreadySent){return}e.alreadySent=true;l.setMessage("vtc",[e.hash,e.view_tracking_key]);if(e.allowServerCall){e.serverCall("dummy_call_nonlivedepped").send()}}this.parent().needsRefresh=true;this.$("#@item").mousedown(t);$("a",this.$("#@item")).mousedown(function(i){e.allowServerCall=i.target.pathname==window.location.pathname;t()})},onLoad:function(){var e=this;this.feedStoryItemContext=this.getContext(c.FeedStoryItem);this.feed_item=this.$("#@feed_item");if(this.show_mute_item){this.controls=this.cQuery(":mute_item_controls");this.overlay=this.cQuery(":mute_item_overlay");this.close=this.cQuery(":mute_item_overlay").$("#@cancel_mute_item_wrapper");this.close.click(function(){e.hideMuteControls()});this._closeOnEsc()}this._save_feed_debug_handler();d.addComponentToTrack(this);this.feedStoryItemContext.on("showRemoveFromFeedMenu",function(t,i){if(i===true){e.showMuteControls()}});this.feedStoryItemContext.on("showQuestionDownvoteFeedback",function(t,i){if(i===true){e.showQuestionDownvoteFeedback()}});this.feedStoryItemContext.on("showAnswerDownvoteFeedback",function(t,i){if(i===true){e.showAnswerDownvoteFeedback()}})},getHash:function(){return this.hash},isVisible:function(){var t=$("#"+e.getLiveParent(this.cid));if(!t.is(":visible")){return false}var i=this.$("#@item");return!i.hasClass("hidden")&&t.is(":in-viewport")},validForLoggingImpression:function(t){var i=e.getLiveParent(this.cid);if(!i){return false}var n=$("#"+i);if(!t&&!n.is(":visible")){return false}return true},showMuteControls:function(){if(this.controls.shown){return}this.feed_item.addClass("is_blurred");this.overlay.show();this.controls.show()},hideMuteControls:function(){if(!this.controls.shown){return}this.feed_item.removeClass("is_blurred");this.overlay.hide();this.controls.hide()},showQuestionDownvoteFeedback:function(){this.showFeedback("load_question_downvote_feedback")},showAnswerDownvoteFeedback:function(){this.showFeedback("load_answer_downvote_feedback")},showFeedback:function(e){var t=this;var i=t.feed_item.offset().top;t.feedback=t.$("#@feedback");t.feed_item.fadeOut(0,function(){t.feedback.fadeIn(333);if($(window).scrollTop()>i){$("html, body").animate({scrollTop:i-80},1e3)}});if(t.show_mute_item&&t.controls.shown){t.hideMuteControls()}t.serverCall(e).contentFor(t.$("#@feedback"),{parentCID:t.cid}).send()},_closeOnEsc:function(){var e=this;$(document).bind("keydown.mute_item_exit",function(t){if(t.keyCode==27){e.hideMuteControls()}})},_save_feed_debug_handler:function(){if(a.save_feed_story_debug){var e=this;this.$("#@save_feed_story").on("click",function(t){t.preventDefault();if(e.save_feed_clicked){return}e.serverCall("save_feed_story").send();$(this).html("Saved").addClass("clicked");e.save_feed_clicked=true})}}});exports.QuestionTopics=i.extend({onLoad:function(){this.$("#@view_all_link").tooltip({contents:this.tooltip_text});this.$("#@view_all_link").click(this.fnbind(function(){this.$("#@view_all").addClass("hidden");this.$("#@view_all_link").addClass("hidden");this.$("#@all_topics").removeClass("hidden");return false}))}});exports.EventView=i.extend({contextConstructor:function(){
return c.AnswerVoteContext},onLoad:function(){this._super.apply(this,arguments);var e=this;if(this.scroll_to_top){var t=this.lookup("item").$("#@item");if(t){var i=20;window.scroll(0,$(t).offset().top-r.headerOffset-i);$(t).effect("highlight",{},2e3)}}}});exports.FeedBottomIndicator=i.extend({onLoad:function(){var e=this;this.$("#@feed_bottom").click(function(){e.parent().onFeedBottomIndicatorClicked()})}});exports.InlineFollowSuggestionCard=require("action_log").ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);this.setDvar("feed_story_inner_position",this.inner_position)}});exports.PinnedTopicHeader=i.extend({onLoad:function(){var e=this;var t=e.$("#@topic_header");var i=t.height();s.makeFixable(t,{scroll_dep:true,min_height:i,min_scroll:i+20});t[0].addEventListener("w2.fixable.fixed",function(){t.css({top:$(".SiteHeader").outerHeight()})})}})},{"view/fixable2":true,log:true,window_manager:true,settings:true,webnode2:true,views:true,"app/view/home":true,cookies:true,gating:true,"view/paged_list":true,"w2.context":true,action_log:true,event:true,"w2.quora":true});require.install("app/view/feed/feedback",function(require,exports,module){var e=require("w2.quora").Component,t=require("w2.context").FeedStoryItem;exports.Feedback=e.extend({onLoad:function(){var e=this;this.feedback=this.lookup("item").$("#@feedback");this.feed_item=this.lookup("item").$("#@feed_item");this.feedStoryItemContext=this.getContext(t);this.$("#@undo").click(function(t){t.preventDefault();e.hideFeedback();e.serverCall("undo").liveMutate().send()});if(this.feedStoryItemContext){this.feedStoryItemContext.on("showAnswerDownvoteFeedback",function(t,i){if(i===false){e.hideFeedback()}})}},showFeedback:function(){var e=this;if(this.feedStoryItemContext!==null){this.feedStoryItemContext.set("feedbackShown",true)}e.feed_item.fadeOut(0,function(){e.feedback.fadeIn(333)})},hideFeedback:function(){var e=this;if(this.feedStoryItemContext!==null){this.feedStoryItemContext.set("feedbackShown",false)}e.feedback.fadeOut(0,function(){e.feed_item.fadeIn(333)})}});exports.UnfollowOrMuteTopic=e.extend({onLoad:function(){var e=this;e.feedback=e.lookup("item").$("#@feedback");e.setHandler("unfollow_topic");e.setHandler("mute_topic")},setHandler:function(e){var t=this;t.$("#@"+e).click(function(i){i.preventDefault();t.serverCall(e).contentFor(t.feedback,{parentCID:t.cid}).send()})}})},{"w2.context":true,"w2.quora":true});require.install("app/view/share/connect",function(require,exports,module){var e=require("w2.quora").Component,t=require("siteuri").URI;var i=exports.socialConnectorBase={connectLinkedin:function(e){var i=this;$(document).one("linkedin_oauth_approved."+i.cid,function(t,n){i.serverCall("connect_linkedin").kwargs({li_uid:n}).success(function(){i.trigger("linkedin_connected")}).liveMutate().send();if(e){e()}});var n=t("/linkedin_/oauth_window");var o=window.open(n.unicode(),"_BLANK","height=365,width=600")},connectTwitter:function(e){var i=this;$(document).one("twitter_oauth_approved."+i.cid,function(t,n){var o=n.accessToken,s=n.userData;i.serverCall("connect_twitter").kwargs({access_token_key:o.key,screen_name:s.twitter_screen_name,tw_uid:s.twitter_uid,"protected":s["protected"]}).liveMutate().send();if(e){e()}});var n=t("/twitter/oauth_window");var o=window.open(n.unicode(),"_BLANK","height=558,width=800")},connectTumblr:function(e){var t=this;$(document).one("tumblr_oauth_approved."+t.cid,function(i,n){t.serverCall("connect_tumblr").kwargs({url:n}).liveMutate().success(function(i){if(i!="OK"){alert(t.tumlbr_failure_message)}else if(e){e()}}).send()});window.open("/tumblr_/oauth_window","_BLANK","height=500,width=600")}};exports.SocialConnector=e.extend(i)},{siteuri:true,"w2.quora":true});require.install("app/view/settings",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor").InlineEditor,i=require("app/view/share/connect").SocialConnector,n=require("window_manager"),o=require("webnode2"),s=require("view/modal").Base,r=require("settings").interface_strings;exports.CallbackModal=s.extend({onSubmit:function(){this._super.apply(this,arguments);o.Modal.modalFor(this).executeOnSubmitCallBack()}});exports.SettingsAccountEmailOption=e.extend({onLoad:function(){this.$("#@add_another_email_link").click(this.fnbind(function(e){this.$("#@add_another_email_row").toggleClass("hidden");this.$("#@add_email_input_row").toggleClass("hidden");this.$("#@new_email").focus();return false}));this.$("#@add_another_email").click(this.fnbind(function(){var e=this.$("#@new_email").val();if(!e){return false}this.serverCall("add_email").kwargs({email:e}).liveMutate().send();return false}))}});exports.SettingsAccountPhoneOption=e.extend({onLoad:function(){this.$("#@add_another_phone_number_link").click(this.fnbind(function(e){this.$("#@add_another_phone_number_row").toggleClass("hidden");this.$("#@add_number_input_row").toggleClass("hidden");this.$("#@new_number").focus()}));this.$("#@add_another_phone_number").click(this.fnbind(function(){var e=this.$("#@new_number").val();if(!e){return false}this.serverCall("add_number").kwargs({number:e}).liveMutate().success(this.fnbind(function(t){if(t!==null){this.modal("load_inner_confirm_phone_number",{kwargs:{number:e,code:t}})}})).send();return false}))},showConfirmationDialog:function(e,t){this.dialog().title(this.confirm_dialog_title).ok(null).html(this.confirm_dialog_text.replace("{phone_number}",e)+' <p class="confirmation_code">'+t+"</p>");return false}});var a=exports.SettingsOption=e.extend({onLoad:function(e){var t=this;this.$("#@view_option_link").click(function(){t.serverCall("check_reauth").success(function(){t.expandOption()}).send();return false});if(this.auto_open_url_hash&&e){if(n.getHash().substr(0,30)=="#"+this.auto_open_url_hash){this.expandOption();this.$("#@option_content").css("background-color","#E0E0E0").effect("highlight",{},1500)}}},expandOption:function(){this.$("#@view_option").toggleClass("hidden");this.$("#@option_content").toggleClass("hidden")}});exports.AdultSettingsOptionToggle=e.extend({onLoad:function(){this.$("#@no_adult_content").click(this.fnbind(function(){this.serverCall("no_adult_content").liveMutate().send();return false}));this.$("#@allow_adult_content").click(this.fnbind(function(){this.serverCall("allow_adult_content").liveMutate().send();return false}))}});exports.FeatureSettingsOptionToggle=e.extend({onLoad:function(){this.$("#@disable").click(this.fnbind(function(){this.serverCall("disable").liveMutate().send();return false}));this.$("#@enable").click(this.fnbind(function(){this.serverCall("enable").liveMutate().send();return false}))}});exports.UserDisclaimerDialogEditor=t.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@inline_editor_cancel").click(this.fnbind(function(){o.Dialog.dialogFor(this).close_();return false}));this.$("#@inline_editor_submit").click(this.fnbind(function(){var e=o.Dialog.openerFor(this);if(e.attachDisclaimer==="function"){o.Dialog.openerFor(this).user_has_set_disclaimer=true;o.Dialog.openerFor(this).attachDisclaimer()}o.Dialog.dialogFor(this).close_();return false}))}});exports.ChangePasswordOption=a.extend({onLoad:function(){this._super.apply(this,arguments);this.clear_passwords=function(){this.$("#@new_password").val("");this.$("#@confirm_password").val("")};var e=this;this.$("#@change_password_submit").click(function(){if(e.$("#@new_password").val()!==e.$("#@confirm_password").val()){e.$("#@password_and_confirmation_mismatch").removeClass("hidden");e.$("#@password_changed").addClass("hidden");return false}e.$("#@password_and_confirmation_mismatch").addClass("hidden");o.rpc("/settings/reauth_change_password_POST").kwargs({new_password:e.$("#@new_password").val()}).success(function(t){e.clear_passwords();if(t[0]){e.$("#@old_password_no_match").addClass("hidden");e.$("#@password_changed").removeClass("hidden")}else{e.$("#@old_password_no_match").text(t[1]).removeClass("hidden");e.$("#@password_changed").addClass("hidden")}}).send();return false})}});exports.RemoveDisclaimerOption=a.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@remove_disclaimer_submit").click(this.fnbind(function(){this.serverCall("remove_disclaimer").send();return false}))}});exports.TumblrBlogList=e.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(){this.$("#@menu_items").menu(this.$("#@menu_link"));return false}));this.$("%@blogs").click(this.fnbind(function(e){this.connectBlog($(e.target).attr("name"));return false}))},connectBlog:function(e){var t=this;t.serverCall("connect_tumblr").kwargs({url:e}).liveMutate().success(function(e){if(e!="OK"){alert(t.failure_message)}}).send()}});exports.BlogConnectDialogContents=e.extend({onLoad:function(){this.$("#@url, #@uname, #@pwd").focus(this.fnbind(function(){this.$("#@blog_not_supported").hide()}));this.$("#@url, #@uname, #@pwd").keydown(this.fnbind(function(e){if(e.keyCode==13){this.submitForm()}}));this.$("#@url").blur(this.fnbind(function(){this.$("#@wordpress_login_help").hide();var e=this.$("#@url").val();if(e.match("wordpress")){this.$("#@wordpress_login_help").show()}}));this.$("#@close").click(this.fnbind(function(){o.Dialog.dialogFor(this).close_();return false}));this.$("#@connect").click(this.fnbind(function(){this.submitForm()}))},submitForm:function(){var e=this.$("#@url").val(),t=this.$("#@uname").val(),i=this.$("#@pwd").val();if(e&&t&&i){this.serverCall("validate_blog").kwargs({url:e,name:t,pwd:i}).liveMutate().success(this.fnbind(function(e){var t=e[0],i=e[1];if(!t){this.$("#@blog_not_supported").show().text(i)}else{$(document).trigger("wordpress_connect_success");o.Dialog.dialogFor(this).close_()}})).send()}}});exports.TumblrConnect=require("app/view/share/connect").SocialConnector.extend({events:{"click #@tumblr_connect_button":"connectTumblr","click #@tumblr_disconnect_button":"disconnectTumblr"},disconnectTumblr:function(){this.serverCall("tumblr_disconnect").liveMutate().send();return false}});exports.WordpressConnect=e.extend({events:{"click #@wordpress_connect_button":"connectWordpress","click #@wordpress_disconnect_button":"disconnectWordpress"},connectWordpress:function(){this._dialog=this.dialog().title(this.dialog_title).close(null).load("set_dialog_contents")},disconnectWordpress:function(){this.serverCall("wordpress_disconnect").liveMutate().send()}});exports.TwitterConnect=e.extend({onLoad:function(){this.$("#@twitter_disconnect_button").click(this.fnbind(function(){this.serverCall("twitter_disconnect").liveMutate().send();return false}))}});exports.LinkedinConnect=e.extend({onLoad:function(){this.$("#@linkedin_disconnect_button").click(this.fnbind(function(){this.serverCall("disconnect_linkedin").liveMutate().send();return false}))}});exports.LinkedinConnectButton=i.extend({onLoad:function(){var e=this;e.$("#@linkedin_connect_button").click(e.fnbind(function(){this.connectLinkedin()}))}});exports.LinkedinPublicProfileLink=e.extend({onLoad:function(){this.serverCall("get_profile_info").kwargs({li_uid:this.liUid}).success(this.fnbind(function(e){if(e===null){this.$("#@linkedin_link").text("").attr("href","#")}else{this.$("#@linkedin_link").text(e.first_name+" "+e.last_name).attr("href",e.url)}})).send()}});exports.ConfirmEmailModal=s.extend({onSubmit:function(){var e=this;e.serverCall("resend_email_confirmation").success(function(){e._closeModal()}).liveMutate().send()}});exports.RemoveEmailModal=s.extend({onSubmit:function(){var e=this;e.serverCall("remove_email").success(function(){e._closeModal()}).liveMutate().send()}});exports.EmailAddressRow=e.extend({onLoad:function(){var e=this;this.$("#@confirm_email").click(this.fnbind(function(){var e=this;e.modal("load_inner_confirm_email");return false}));this.$("#@make_primary").click(function(){return e._serverCallHelper("set_primary_email")});this.$("#@delete_email_icon").click(this.fnbind(function(){var e=this;e.modal("load_inner_remove_email");return false}))},_serverCallHelper:function(e){this.serverCall(e).kwargs({email:this.email}).liveMutate().send();return false}});exports.ConfirmPhoneNumberModal=s.extend({onSubmit:function(){this._closeModal()}});exports.RemovePhoneNumberModal=s.extend({onSubmit:function(){var e=this;e.serverCall("remove_number").success(function(){e._closeModal()}).liveMutate().send()}});exports.PhoneNumberRow=e.extend({onLoad:function(){var e=this;this.$("#@confirm_number").click(this.fnbind(function(e){this.modal("load_inner_confirm_phone_number");e.preventDefault()}));this.$("#@make_primary").click(function(){return e._serverCallHelper("set_primary_number")});this.$("#@delete_number").click(this.fnbind(function(e){this.modal("load_inner_remove_phone_number");e.preventDefault()}))},_serverCallHelper:function(e){this.serverCall(e).kwargs({number:this.number}).liveMutate().send();return false}});exports.ResetPassword=e.extend({onLoad:function(){this.$("#@reset_email_submit").click(this.fnbind(function(e){var t=this.$("#@email_input").val();if(!t){return false}this.emailRequest("/settings/send_reset_password_email_POST",t);return false}));this.$("#@reset_password_form_tag").submit(this.fnbind(function(e){var t=this.$("#@reset_password_code").val();var i=this.$("#@new_password").val();var n=this.$("#@confirm_password").val();var o=this.$("#@password_confirmation_mismatch");if(i!==n){o.removeClass("hidden");return false}else{o.addClass("hidden")}if(!i){return false}this.passwordRequest("/settings/reset_password_POST",t,i);return false}))},emailRequest:function(e,t){o.rpc(e).kwargs({email:t}).success(this.fnbind(function(e){this.$("#@email_input").val("");this.$("#@reset_email_conf").removeClass("hidden");this.$("#@reset_email_form").addClass("hidden")})).send();return false},passwordRequest:function(e,t,i){o.rpc(e).kwargs({code:t,new_password:i}).success(this.fnbind(function(e){if(e){n.navigateTo("/?__pmsg__=password_changed")}else{n.navigateTo("/settings/reset_password?__pmsg__=password_change_error")}})).send();return false}});var l={};exports.onTwitterConnect=function(){$(l).trigger("connect")};exports.TwitterConnectButton=i.extend({onLoad:function(){this.$("#@twitter_connect_button").click(this.fnbind(function(){this.connectTwitter()}));$(l).bind("connect",this.fnbind(function(){this.connectTwitter()}))}});exports.MutedRowToggle=e.extend({onLoad:function(){this.$("#@unmute").click(this.fnbind(function(){this.serverCall("unmute").kwargs({oid:this.oid}).liveMutate().send()}));this.$("#@mute").click(this.fnbind(function(){this.serverCall("mute").kwargs({oid:this.oid}).liveMutate().send()}))}});exports.SettingsToggleEditor=e.extend({onLoad:function(){this.$("#@edit_toggle").click(this.fnbind(function(){this.$("#@current_view").addClass("hidden");this.$("#@editor_view").removeClass("hidden").find(this.editor).focus()}))}})},{"app/view/share/connect":true,window_manager:true,settings:true,webnode2:true,"view/modal":true,"view/inline_editor":true,"w2.quora":true});require.install("app/view/tutorial",function(require,exports,module){var e=require("w2.quora").Component;exports.GoToWritepageNotif=e.extend({onLoad:function(){var e=this;window.setTimeout(function(){e.serverCall("send_notif").send()},e.delay*1e3)}})},{"w2.quora":true});require.install("qed/modifiers",function(require,exports,module){var e=require("qed/util"),t=require("assert").ok;function i(t,i,n){i=i.toLowerCase();return function(o,s){var r={},a=e.getDocument(o).documentElement,l=o;r[t]=i;while(l&&l!==a){l=e.convertToStyleSpan(l);var u=l.style[t].toLowerCase();if(u===i){r[t]=n;break}else if(u===n){r[t]=i;break}l=l.parentNode}e.applyStyle(o,s,r)}}exports.bold=i("fontWeight","bold","inherit");exports.italic=i("fontStyle","italic","normal");exports.underline=i("textDecoration","underline","none");exports.blockquote=function(t,i){return e.formatBlock(t,i,"blockquote")};function n(t){if(e.hasTag(t.nextSibling,"br")){e.remove(t.nextSibling)}}var o="h1";exports.heading=function(t,i){var n=e.getEditorRoot(t);if(!n){return}var a=[];function l(t){if(e.hasTag(t,o)){a.push(t)}}function u(e){e=e.parentNode;while(e&&e!==n){l(e);e=e.parentNode}}if(t.nextSibling===i){u(t)}else{e.traverseAllNodesBetween(t,i,n,function(e){l(e)});if(t.parent===i.parent&&a.length===0){u(t)}}if(a.length>0){s(a)}else{r(t,i)}};function s(t){for(var i=0;i<t.length;i++){e.replaceWithChildren(t[i])}}function r(t,i){var s=e.getEditorRoot(t),r=e.getDocument(s),a=t;while(a){var l=e.findPrevLine(a),u=e.findNextLine(a),d=e.nextLeaf(u);e.makeSiblings(l,u);n(l);var c=e.extractSiblings(r.createElement(o),l.nextSibling,u);e.insertBefore(l.parentNode,c,u);var h=e.nextLeaf(l),f;while(h&&h!==u){if(h===i||e.contains(h,i)){f=true;break}h=e.nextLeaf(h)}e.remove(l,u);var p=c.parentNode;if(p!==s&&e.hasTag(p,"div")&&p.childNodes.length===1){e.replaceWithChildren(p)}if(f){n(c);break}a=d}if(e.isWebKit&&!t.previousSibling&&t.nextSibling==i&&!i.nextSibling){var g=r.createElement("br");e.insertBefore(t.parentNode,g,t)}}function a(t){var i=e.getEditorRoot(t);var n=0;while(t&&t!==i){if(t.nodeType!==3){var o=t.nodeName.toLowerCase();if(o==="ol"||o==="ul"){n++}}t=t.parentNode}return n}function l(i,n,o){var s=a(i);if(s>=10){return}var r=o?"ol":"ul";var l=e.formatBlock(i,n,r);var u=function(t){if(e.hasTag(t,"li")&&t.childNodes.length===1){var o=t.childNodes[0];if(e.hasTag(o,"span")){var s=o.childNodes;if(s.length===0||s.length===2&&s[0]===i&&s[1]===n){o.appendChild(document.createElement("br"))}}}return t};var d=e.wrapLines(l,"li",u);t(e.contains(d,i));t(e.contains(d,n));return d}exports.orderedList=function(e,t){return l(e,t,true)};exports.unorderedList=function(e,t){return l(e,t,false)};exports.insertHR=function(t,i,n){var o=e.getEditorRoot(t),s=document.createElement("img"),r=document.createElement("div");s.setAttribute("class","hr_img");s.setAttribute("type","hr");s.setAttribute("src",n);r.appendChild(s);var a=e.findAncestor(t,e.causesLineBreak);if(a&&o!==a){if(e.isHeading(a)||e.hasTag(a,"div")){while(t.parentNode!==a){e.splitParent(t)}e.splitParent(t)}}e.insertBefore(t.parentNode,r,t);if(e.isGecko){var l=document.createElement("br");e.insertBefore(t.parentNode,i,r.nextSibling);e.insertBefore(t.parentNode,t,i);e.insertBefore(t.parentNode,l,t)}return s};var u=/^blockquote|address$/i;function d(e){return u.test(e.nodeName)}var c=/^br|span|b|i|u|em|strong|h\d$/i;function h(e){if(e.nodeType===3){return/\S/.test(e.nodeValue)}if(c.test(e.nodeName)){return false}return true}function f(i,n){var o=e.findAncestor(i,d);if(o){var s=n?e.findNextLine(i):e.findPrevLine(i);var r=function(t){e.remove(s);return t};if(!e.contains(o,s)){return r(false)}for(var a=n?e.prevLeaf:e.nextLeaf,l=s;l;l=a(l,o)){if(h(l)){return r(false)}}while(s.parentNode!==o){e.splitParent(s)}e.splitParent(s);var u=e.replaceWithChildren(n?s.previousSibling:s.nextSibling);t(u.nodeName===o.nodeName);return r(true)}}exports.maybeEscape=function(e,t){return e.nextSibling===t&&(f(e,false)||f(t,true))};exports.sanitizeBeforeRepair=function(e,t){var i=require("qed/sanitize");if(e.nextSibling===t){i.flush(e)}i.add(e.parentNode);i.add(t.parentNode)};function p(t,i){if(e.isWebKit){return g(t,i)}if(e.isIE){return _(t,i)}return false}exports.handleEnterForHeadingInList=p;function g(t,i){var n=e.getDocument(t),o,s,r=e.findHeadingInLi(t),a=e.findHeadingInLi(i);if(!r&&!a){return false}var l=t.parentNode===i.parentNode;e.removeEmptyTextNodes(t,false);e.removeEmptyTextNodes(i,true);if(e.firstLeaf(r)===t){e.insertBefore(r,t,r.firstChild);o=n.createElement("br");e.insertBefore(t.parentNode,o,t)}if(!i.nextSibling&&a){a.appendChild(i)}s=n.createElement("br");e.insertBefore(i.parentNode,s,i.nextSibling);e.makeSiblings(t,i);var u,d=t.nextSibling;while(d&&d!==i){u=d.nextSibling;e.remove(d);d=u}if(l){e.splitParentsUntil(t,i,r.parentNode)}if(s){e.insertBefore(s.parentNode,t,s.nextSibling);e.insertBefore(s.parentNode,i,s.nextSibling)}e.remove(o);e.remove(s);return true}function _(t,i){var n=e.findHeadingInLi(i);if(!n){return}var o=i.nextSibling;while(o&&o.nodeType===3){e.cleanTextNode(o);o=o.nextSibling}e.removeEmptyTextNodes(i,true);if(!i.nextSibling){var s=document.createTextNode("\ufeff");e.insertBefore(i.parentNode,s,i.nextSibling)}return false}},{assert:true,"qed/util":true,"qed/sanitize":true});require.install("qed/nodestate",function(require,exports,module){var e=require("qed/util"),t=e.assert,i=e.arraysEqual,n=require("qed/npd"),o={"class":true,style:true},s={};function r(e,i,n){t(e&&i&&n);this.restore=function(){f(e,i);m(e,n)};this.diffAttrs=function(n){t(n===e);return h(e,i)};this.diffChildren=function(i){t(i===e);return _(e,n)}}function a(e,i){t(typeof i==="string");var o=e.createElement(i||"span"),r=n.key(o);s[r]=true;return o}exports.createMeaninglessElement=a;function l(e){if(!e){return false}if(typeof e==="string"){return/[^\ufeff]/.test(e)}if(!n.ok(e)){return false}return!s[n.key(e)]}exports.isMeaningful=l;function u(e,i){var n=i?i.diffAttrs(e):h(e),o=i?i.diffChildren(e):_(e),s={meaningful:n.meaningful||o.meaningful,identical:n.identical&&o.identical};t(!s.meaningful||!s.identical);if(!i){t(n.meaningful&&!n.identical);t(o.meaningful&&!o.identical);s.state=new r(e,n.attrs,o.children)}else if(n.identical&&o.identical){t(!n.meaningful&&!o.meaningful);s.state=i}else{t(n.attrs||o.children);s.state=new r(e,n.attrs,o.children)}if(!l(e)){s.meaningful=false}return s}exports.diff=u;function d(e,t){return e.name===t.name&&e.value===t.value}function c(e,t){var n=0,s={},r=[],a,l;if(e.getAttribute){for(l in o){if((a=e.getAttribute(l))!==null){s[r[r.length]=l]=a}}r.sort();for(n=0;n<r.length;++n){l=r[n];r[n]={name:l,value:s[l]}}}if(!i(r,t,d)){return r}}function h(e,t){var i=c(e,t);return{meaningful:!!i,identical:!i,attrs:i||t}}function f(e,i){if(e.setAttribute){for(var n in o){e.removeAttribute(n)}for(var s=0,r;s<i.length;++s){r=i[s];e.setAttribute(r.name,r.value)}}else{t(i.length<1)}}function p(e,t){for(var n,o=[],s=e.firstChild;s;s=s.nextSibling){o.push(n=s.nodeType==3?typeof n==="string"?o.pop()+s.nodeValue:s.nodeValue:s)}if(!i(o,t)){return o}}function g(e){for(var t,i=[],n,o=0;o<e.length;++o){if(l(n=e[o])){t=typeof n==="string"&&typeof t==="string"?i.pop()+n:n;if(typeof t==="string"){t=t.replace("\ufeff","")}i.push(t)}}return i}function _(e,n){var o=p(e,n),s;if(!o){t(n);s=false}else if(!n){s=true}else{s=!i(g(o),g(n))}return{meaningful:s,identical:!o,children:o||n}}function m(i,n){i.normalize();for(var o=0,s=n.length,r=i.firstChild;r&&o<s;r=r.nextSibling,++o){if(n[o]!==(r.nodeType===3?r.nodeValue:r)){break}}if(r){while(i.lastChild!==r){i.removeChild(i.lastChild)}i.removeChild(r)}for(var a,l=e.getDocument(i);o<s;++o){a=n[o];i.appendChild(typeof a==="string"?l.createTextNode(a):a)}t(i.childNodes.length===n.length)}},{"qed/util":true,"qed/npd":true});require.install("qed/rules",function(require,exports,module){var e=require("qed/util"),t=e.assert,i=e.cleanFEFFs,n=require("qed/modifiers"),o=require("qed/npd"),s=require("qed/nodestate").isMeaningful,r=/^\s+|\s+$/g;function a(){t(this instanceof a);var e=new l,i=this;i.addOkTag=function(t,n){e.addOkTag(t,n);return i};i.addOkStyle=function(t,n){e.addOkStyle(t,n);return i};i.addKeyHandler=function(t,n){e.addKeyHandler(t,n);return i};i.getKeyHandler=function(t){return e.keyHandlers[t.keyCode||t.charCode]};i.apply=function(t){return e.apply(t)}}exports.Ruleset=a;function l(){var e=this,i={};t(e instanceof l);e.rules={br:"br",div:"div"};e.okStyles={};e.keyHandlers=i;i[8]=c;i[13]=d;i[37]=h;i[39]=f}function u(e){return(e||"").replace(r,"").toLowerCase()}function d(e,t,i){if(!i.shiftKey){if(n.maybeEscape(e,t)){return false}if(n.handleEnterForHeadingInList(e,t)){return false}}}function c(e,t){if(e.nextSibling===t){i(e,true)}}function h(e,t){if(e.nextSibling===t){i(e,true)}}function f(e,t){if(e.nextSibling===t){i(t,false)}}var p=l.prototype;p.addOkTag=function(e,i){e=e.toLowerCase();if(i){var n=typeof i;if(n==="string"){i=i.toLowerCase()}else if(n=="function"){}else{t(false)}}else{i=e}this.rules[e]=i};p.getSynonym=function(e){var t=e.nodeName.toLowerCase(),i=this.rules[t];if(typeof i==="function"){i=i(e)}return i};p.addOkStyle=function(e,t){e=u(e);var i=this.okStyles;(i.hasOwnProperty(e)?i[e]:i[e]={})[u(t)]=true};p.isOkStyle=function(e,t){var i=this.okStyles[u(e)];return i&&i.hasOwnProperty(u(t))};p.addKeyHandler=function(e,t){this.keyHandlers[e]=t};p.apply=function(t){if(!o.ok(t)||o.get(t,"isEditorRoot")||!s(t)){return t}var i=t.nodeName.toLowerCase(),n=t,r=this.getSynonym(t);if(r){if(r!==i){n=e.getDocument(t).createElement(r);e.replaceNode(n,t)}return this.copySafeStyles(t,n)}else{e.replaceWithChildren(t)}};p.copySafeStyles=function(e,t){var i=e.getAttribute("style");t=t||e;if(i){for(var n=[],o=false,s=i.split(";"),r=0,a=s.length;r<a;r+=1){var l=s[r],u=l.split(":");if(u.length===2){if(this.isOkStyle(u[0],u[1])){n.push(l)}else{o=true}}}if(n.length<1){t.removeAttribute("style")}else{t.setAttribute("style",o?n.join(";"):i)}}else{t.removeAttribute("style")}return t}},{"qed/modifiers":true,"qed/util":true,"qed/npd":true,"qed/nodestate":true});require.install("qed/sanitize",function(require,exports,module){var e=require("qed/npd"),t=require("qed/util"),i=t.assert,n=t.cleanTextNode,o=0,s=require("qed/rules").Ruleset,r="sanitizer";function a(i){while(!e.ok(i)){i=i.parentNode}for(var n=t.getDocument(i).documentElement,o;i&&i!==n&&!o;i=i.parentNode){o=e.get(i,r);if(!o&&e.get(i,"isEditorRoot")){o=e.fix(i,r,new l(i,e.get(i,"editorRuleset")))}}return o}exports.add=function(e){var t=a(e);if(t){t.add(e)}};exports.flush=function(e){var t=a(e);if(t){t.flush()}else{i(false)}};function l(n,r){i(r instanceof s);var a={},l=[],d="qedSanitizerPos"+o++;function c(e){var t=e[d];if(typeof t!=="number"||l[t]!==e){try{e[d]=l.push(e)-1}catch(i){}}}this.add=function(t){if(t&&t.nodeType===3){t=t.parentNode}if(t){if(e.ok(t)){a[e.key(t)]=t}else{c(t)}}};this.flush=function(){var e,o=a;a={};for(e in o){n.normalize(true);break}t.remove.apply(t,l);l.length=0;for(e in o){try{var s=o[e],d=s.parentNode;s=r.apply(s);if(s){u(s)}else if(d){u(d)}}catch(c){i(false)}}}}function u(e){for(var t=e.firstChild,i,o;t;t=o){o=t.nextSibling;if(t.nodeType===3){var s=t.nodeValue;if(i){if(s.length>0){i.nodeValue+=s}e.removeChild(t)}else if(s.length>0){i=t}else{e.removeChild(t)}}else if(i){n(i);i=null}}if(i){n(i)}}exports.normalize=u},{"qed/util":true,"qed/npd":true,"qed/rules":true});require.install("qed/npd",function(require,exports,module){var e=require("qed/util"),t=e.assert,i=e.guid,n={},o={},s="npdkey";function r(e){return!!(e&&e.nodeType!==3&&e.getAttribute)}exports.ok=r;function a(e,t){return d(e)&&t in c(e).data}exports.has=a;function l(e,t,i){if(a(e,t)){return c(e).data[t]}return i}exports.get=l;function u(e,t,i){var n=c(e),o=n.data;if(!n.fixed[t]){o[t]=i}return o[t]}exports.set=u;exports.fix=function(e,t,i){var n=c(e),o=n.fixed,s=n.data;if(arguments.length>2&&!o[t]){s[t]=i}o[t]=true;return s[t]};exports.setdefault=function(e,t,i){if(a(e,t)){return l(e,t)}return u(e,t,i)};exports.del=function(e,t,i){if(a(e,t)){var n=c(e),o=n.data;i=o[t];if(!n.fixed){delete o[t]}}return i};exports.key=function(e){return c(e).key};exports.clean=function(e){return f(e,true)};function d(e){if(e.getAttribute){var t=e.getAttribute(s);if(t in n){return n[t].node===e}}return false}function c(e){var a;t(r(e));if(e.getAttribute){var l=e.getAttribute(s);a=l&&n[l];t(a!==o);if(a&&a.node===e){return a}e.setAttribute(s,l=i());a=n[l]={node:e,key:l,fixed:{},data:{}}}require("qed/sanitize").add(e);return a}function h(e){t(r(e));if(d(e)){var i=e.getAttribute(s);n[i]=o}}function f(e,t){if(e.nodeType==3){return}if(e.removeAttribute){if(t){h(e)}e.removeAttribute(s);for(var i=e.firstChild;i;i=i.nextSibling){f(i)}}return e}exports.cleanInnerHTML=function(e){return f(e.cloneNode(true)).innerHTML.replace(/\ufeff/gm,"")}},{"qed/util":true,"qed/sanitize":true});require.install("qed/util",function(require,exports,module){var e=exports.assert=require("assert").ok;exports.guid=function(){return((+new Date).toString(36)+Math.random().toString(36)).toLowerCase()};function t(t,i,n){e(t);if(i.parentNode===t){t.removeChild(i)}return n?t.insertBefore(i,n):t.appendChild(i)}exports.insertBefore=t;function i(t,i){var n=t.parentNode,o=t,s=0;e(n);if(typeof i==="number"&&n.childNodes[i]===t){return i}while(o=o.previousSibling){++s}e(n.childNodes[s]===t);return s}exports.indexOfChild=i;function n(e){while(e&&e.firstChild){e=e.firstChild}return e}exports.firstLeaf=n;function o(e){while(e&&e.lastChild){e=e.lastChild}return e}exports.lastLeaf=o;function s(e){return e.ownerDocument||e}exports.getDocument=s;function r(e){if(e.nodeType===3){e=e.parentNode}for(var t=s(e).documentElement;e&&e!==t;e=e.parentNode){if(k.get(e,"isEditorRoot")){return e}}}exports.getEditorRoot=r;function a(e,t){t=t||r(e);return e&&e!==t&&n(e.nextSibling||a(e.parentNode,t))}exports.nextLeaf=a;function l(e,t){t=t||r(e);return e&&e!==t&&o(e.previousSibling||l(e.parentNode,t))}exports.prevLeaf=l;exports.cloneObject=function(e,t){var i=function(){for(var e in t){this[e]=t[e]}};i.prototype=e;return new i};function u(e,t){if(e.nodeType==3){e=e.parentNode}var i=s(e),n=i.defaultView,o=e.style[t],r;if(!o||o==="auto"){if(n&&n.getComputedStyle){r=n.getComputedStyle(e,null)}else{r=e.currentStyle}o=r&&r[t]}return o==="auto"?null:o}exports.getStyle=u;exports.isVisible=function(e){require("jquery");return $(e).is(":visible")};var d=navigator.platform.match("Mac");function c(e){return!!(d?e.metaKey:e.ctrlKey)}exports.hasCtrlOrCmd=c;function h(e){return!!e.shiftKey}exports.hasShift=h;var f=window&&window.navigator&&window.navigator.userAgent||"",p=f.indexOf("AppleWebKit/")>-1,g=f.indexOf("MSIE")>-1,_=f.indexOf("Chrome")>-1,m=f.indexOf("Gecko/")>-1&&f.indexOf("Chrome")<0;function v(){var e=f.toLowerCase();return e.indexOf("rv:11.")>-1||e.indexOf("trident/7")>-1}exports.isIE=g;exports.isIE11=v();exports.isWebKit=p;exports.isChrome=_;exports.isGecko=m;exports.addClass=function(e,t){for(var i=0,n=(e.getAttribute("class")||"").split(" ");i<n.length;++i){if(n[i]===t){break}}if(i==n.length){n.push(t);e.setAttribute("class",n.join(" "))}};exports.arraysEqual=function(e,t,i){if(e&&t){var n,o=e.length;if(o!=t.length){return false}for(n=0;n<o;++n){if(i?!i(e[n],t[n]):e[n]!==t[n]){return false}}return true}else if(e||t){return false}return true};function w(e,t){for(var i=s(t).documentElement;t&&t!==i;t=t.parentNode){if(t===e){return true}}return false}exports.contains=w;function b(i){var n=i.parentNode,o=n&&n.parentNode;e(!k.get(n,"isEditorRoot"));e(o);if(!i.nextSibling){t(o,i,n.nextSibling)}else if(!i.previousSibling){t(o,i,n)}else{var s=K(n.cloneNode(false),i.nextSibling);t(o,s,n.nextSibling);t(o,i,s);e(n.nextSibling===i)}e(i.previousSibling===n||i.nextSibling===n);return true}exports.splitParent=b;var k=require("qed/npd");function C(e,t){var i={},n;if(e===t){return e}if(e.nodeType===3){e=e.parentNode}if(t.nodeType===3){t=t.parentNode}while(e||t){if(e){n=k.key(e);if(n in i){return e}i[n]=e;e=e.parentNode}if(t){n=k.key(t);if(n in i){return t}i[n]=t;t=t.parentNode}}}exports.nearestCommonAncestor=C;function y(e,t){var i=C(e,t);return x(e,t,i)}exports.makeSiblings=y;function x(t,i,n){e(n);e(t!==n);e(i!==n);e(r(n));while(t.parentNode!==n){b(t)}while(i.parentNode!==n){b(i)}return n}exports.splitParentsUntil=x;exports.deleteContents=function(e,t){y(e,t);while(e.nextSibling!==t){e.parentNode.removeChild(e.nextSibling)}};function S(e){var t=e.parentNode;if(t){while(e.firstChild){t.insertBefore(e.firstChild,e)}t.removeChild(e)}return e}exports.replaceWithChildren=S;function T(e){var t=0,i,n,o=[],s;while(n=e[t++]){if(n.parentNode===i){s.push(n)}else{i=n.parentNode;o.push(s=[n])}}return o}function L(e,t){var i=t.parentNode;if(i){i.replaceChild(e,t)}while(t.firstChild){e.appendChild(t.firstChild)}return e}exports.replaceNode=L;function q(i,n){var o=0,s=n[0],r=s&&s.parentNode;if(r&&r.nodeType===1){t(r,i,s)}else{r=null}while(s=n[o++]){if(r){e(s.parentNode===r)}i.appendChild(s)}return i}exports.wrapChildren=q;function E(e){var t=e.cloneNode(false);k.set(t,"isStyleSpan",true);return t}function I(e){
var t={},i=e.nodeName.toLowerCase();if(i==="b"||i==="strong"){t.fontWeight="bold"}else if(i==="i"||i==="em"){t.fontStyle="italic"}else if(i==="u"){t.textDecoration="underline"}else{t=null}if(t){var n=s(e).createElement("span");k.set(n,"isStyleSpan",true);for(var o in t){n.style[o]=t[o]}return L(n,e)}var r=e.style;if(!k.get(e,"isStyleSpan")&&r){if(r.fontWeight||r.fontStyle||r.textDecoration){k.set(e,"isStyleSpan",true)}}return e}exports.convertToStyleSpan=I;function M(t){e(k.get(t,"isStyleSpan"));if(!t.firstChild){t.parentNode.removeChild(t);return}var i,s=n(t),r=o(t),l=[];function u(e){if(e.parentNode!==t){i=true}l.push(e)}while(s&&s!==r){u(s);s=a(s)}u(r);if(!i){return}S(t);var d=0,c,h=T(l),f;function p(e){var i=e[0].parentNode;if(f){q(E(t),e)}else{f=true;q(t,e)}}while(c=h[d++]){p(c)}}function A(e,i){return t(e.parentNode,i,e.nextSibling)}function D(e,i){return t(e.parentNode,i,e)}function N(e,t){for(var i=e,n=[];i&&i!==t;i=a(i)){n.push(i)}if(t){n.push(t)}var o=s(e).documentElement,r=0;while(i=n[r++]){for(var l=i.parentNode;l&&l!==o;l=l.parentNode){l=I(l);if(k.get(l,"isStyleSpan")){M(l);break}}}return n}exports.hugLeavesBetween=N;exports.applyStyle=function(t,i,n){var o=s(t),r,a=T(N(t,i)),l=0;while(r=a[l++]){if(!k.get(r[0].parentNode,"isStyleSpan")){k.set(q(o.createElement("span"),r),"isStyleSpan",true)}}var u=t.parentNode,d=i.parentNode;e(k.get(u,"isStyleSpan"));e(k.get(d,"isStyleSpan"));if(t.previousSibling){D(u,K(E(u),u.firstChild,t))}if(i.nextSibling){A(d,K(E(d),i.nextSibling))}R(t,i);l=0;while(r=a[l++]){var c=r[0].parentNode;e(k.get(c,"isStyleSpan"));for(var h in n){c.style[h]=n[h]}}};function O(e){return e.createTextNode("\ufeff")}function F(){}function R(e,i){var n=e.previousSibling,o;if(!n||n.nodeType!==3){o=t(e.parentNode,O(s(e)),e);return function(){G(o)}}return F}exports.addExtraSupport=R;var P=/(\S)(\u00a0+)(\S)/g;function B(e,t,i,n){return t+new Array(i.length).join("Â ")+" "+n}function H(t,i){e(t.nodeType===3);var n=t.nodeValue,o;if(n==="\ufeff"&&!i){return}o=n.replace(/\ufeff/g,"");o=o.replace(P,B);if(o!==n){if(o===""){t.parentNode.removeChild(t)}else{t.nodeValue=o}return true}}exports.cleanTextNode=H;exports.cleanFEFFs=function(e,t){for(var i=t?l:a,n=r(e),o=i(e,n);o;o=i(o,n)){if(o.nodeType===3&&H(o,true)){break}}};exports.getText=function(e,t){var i=e.innerText;if(!i){i=e.innerHTML.replace(/<[^>]*>/g," ");i=i.replace(/&amp;/g,"&")}if(i){i=i.replace(/\ufeff/g,"");if(!t){i=i.replace(/^\s+|\s+$/g,"")}}return i};function U(e){return e.nodeType===3&&e.nodeValue===""}function Q(e,t){var i=t?"nextSibling":"previousSibling",n=e[i],o;while(n&&U(n)){o=n[i];G(n);n=o}}exports.removeEmptyTextNodes=Q;function j(e){if(e.nodeType===3){return false}var t=e.nodeName.toLowerCase();if(t=="img"){if(e.className&&e.className.indexOf("hr_img")>-1){return true}}switch(t){case"div":case"p":case"br":case"ol":case"ul":case"li":case"blockquote":case"address":case"h1":return true;default:return false}}exports.causesLineBreak=j;function W(e,t,i,n,o,r){var a=s(e),l,u;t=t||a.documentElement;while(e&&e!==t){l=e[i];if(l){e=l;if(j(e)){return o(e,a.createElement("span"))}while(u=e[n]){e=u;if(j(e)){return o(e,a.createElement("span"))}}}else{e=e.parentNode;if(e&&j(e)){return r(e,a.createElement("span"))}}}}function V(e,t){return W(e,t,"nextSibling","firstChild",D,function(e,t){return e.appendChild(t)})}exports.findNextLine=V;function z(e,i){return W(e,i,"previousSibling","lastChild",A,function(e,i){return t(e,i,e.firstChild)})}exports.findPrevLine=z;function K(e,t,i){while(t&&t!==i){var n=t.nextSibling;e.appendChild(t);t=n}return e}exports.extractSiblings=K;function G(e){for(var t,i=0,n=arguments.length;i<n;i+=1){if((e=arguments[i])&&(t=e.parentNode)){t.removeChild(e)}}}exports.remove=G;function J(e){return ee(e,"ul")||ee(e,"ol")}exports.isList=J;function Y(e){return ee(e,"li")}exports.isListItem=Y;function X(e){var t=e&&e.nodeName;return/h\d/i.test(t)}exports.isHeading=X;function Z(e,t,i){return e&&e.firstChild==t&&e.lastChild==i}exports.spansChildren=Z;function ee(e,t){if(!e||e.nodeType===3){return false}return e.nodeName.toLowerCase()===t}exports.hasTag=ee;function te(e,t,i){if(X(e)){var n=i.nextSibling;if(Z(e,t,i)){return true}if(n&&ee(n,"br")&&Z(e,t,n)){return true}}return false}exports.formatBlock=function(e,i,n){N(e,i);var o=s(e),r=o.createElement(n),a=z(e),l=V(i);y(a,l);var u=a.parentNode;var d=r;var c=r;if(u&&J(u)){if(!Y(r)){var h=o.createElement("li");h.appendChild(r);d=h;if(Y(a.nextSibling)&&!J(r)){var f=o.createElement(u.nodeName);r.appendChild(f);c=f}}}if(te(u,a,l)){t(u.parentNode,r,u);r.appendChild(u);G(a,l);return r}t(a.parentNode,d,a);K(c,a,l);G(a,l);return r};function ie(e){e.innerHTML="";while(e.firstChild){e.removeChild(e.firstChild)}return e}exports.removeAllChildren=ie;function ne(t,i,r){e(j(t));var l=s(t),u=n(t),d=[];N(u,o(t));while(u){e(w(t,u));var c=z(u),h=V(u),f=a(h,t),p=l.createElement(i);e(w(t,c));e(w(t,h));y(c,h);var g=c.parentNode;if(te(g,c,h)){p.appendChild(g)}else{K(p,c.nextSibling,h)}if(r){p=r(p)}d.push(p);G(c,h);u=f;while(u&&j(u)){u=a(u,t)}}return q(ie(t),d)}exports.wrapLines=ne;function oe(e,t,i){if(!c(i)){return true}return se(e,t)}exports.handleSelectAll=oe;function se(e,i){var n=r(e);if(!n){return true}var o=n.firstChild;if(o&&ee(o,"a")){t(n,e,n.firstChild);n.appendChild(i);R(e,i)}return true}exports.fixSelectAll=se;function re(e,t){t=t||e.ownerDocument.documentElement;for(var i;e;e=e.parentNode){i={node:e,next:i};if(e===t){break}}return i}exports.getAncestors=re;function ae(e,t,i){for(var n=re(e,i),o=re(t,i),s;n&&o&&n.node===o.node;n=n.next,o=o.next){s=n.node}if(n&&o){e=n.node;t=o.node;while(e&&e!==t){e=e.nextSibling}if(!e){var r=n;n=o;o=r}}return[s,n,o]}exports.getPathsFromNCA=ae;function le(e,t,i,n){var o=ae(e,t,i);var s=o[0],r=o[1],a=o[2];var l=[];if(r&&a){ue(s,r,a,n)}return l}exports.traverseAllNodesBetween=le;function ue(e,t,i,n){if(n(e)){return true}if(t&&t.next){if(ue(t.node,t.next,null,n)){return true}}for(var o=t?t.node.nextSibling:e.firstChild,s=i?i.node:null;o&&o!==s;o=o.nextSibling){if(de(o,n)){return true}}if(i&&i.next){if(ue(i.node,null,i.next,n)){return true}}}function de(e,t){if(t(e)){return true}var i=e.firstChild;for(;i;i=i.nextSibling){if(de(i,t)){return true}}}function ce(e,t){for(var i=s(e).documentElement;e&&e!==i;e=e.parentNode){if(t(e)){return e}}}exports.findAncestor=ce;function he(e){var t=ce(e,X);return t&&ce(t,Y)}exports.findHeadingInLi=he;function fe(e){Q(e,false);var t=e.previousSibling;if(!t){return true}if(j(t)){return true}return false}exports.checkBeginningOfLine=fe},{assert:true,jquery:true,"qed/npd":true});require.install("qed/unload",function(require,exports,module){var e=[],t=0,i,n=window;function o(){var o=n.onbeforeunload;if(o===i){return}i=n.onbeforeunload=function(){var i,n=0,s;if(!t){while(i=e[n++]){if(s=i()){return s}}}if(o){try{++t;return o.apply(this,arguments)}finally{--t}}}}exports.checkBeforeUnload=function(t){o();if(t){e.push(t)}};exports.removeCheck=function(t){var i;for(i=0;i<e.length;i++){if(e[i]===t){e.splice(i,1);break}}}},{});require.install("qed/selection",function(require,exports,module){var e=require("log").log,t=require("qed/util"),i=t.assert,n=t.insertBefore,o=t.getDocument;function s(e,t,n,s){var r=this,a=r.doc=o(t),l=r.isW3C=!!(e.getSelection&&e.getSelection().extend);i(e.document===a);i(n.nodeType===1);i(s.nodeType===1);r.scope=t;r.start=n;r.end=s;r.getNativeSelection=l?function(){return e.getSelection()}:function(){return a.selection}}s.prototype={createRange:function(){var e=this.doc;return this.isW3C?e.createRange():e.body.createTextRange()},getSelection:function(){var e=this,t=e.getNativeSelection(),i;if(e.isW3C){if(t&&t.rangeCount>0&&(i=t.getRangeAt(0))&&e.isRangeInScope(i)){return{rng:i,rev:this.isSelectionReversed(t,i)}}}else if(t&&(i=t.createRange())&&e.isRangeInScope(i)){return{rng:i,rev:false}}},isRangeInScope:function(e){var t=this,i=t.scope,n=t.createRange();try{if(t.isW3C){n.selectNode(i);return n.compareBoundaryPoints(e.START_TO_START,e)<1&&e.compareBoundaryPoints(e.END_TO_END,n)<1}n.moveToElementText(i);return n.compareEndPoints("StartToStart",e)<1&&e.compareEndPoints("EndToEnd",n)<1}catch(o){return false}},getDefaultSelection:function(){var e=this,t=e.createRange();if(e.isW3C){t.selectNodeContents(e.scope)}else{t.moveToElementText(e.scope)}t.collapse(true);if(!e.isW3C){t.move("Character",1);t.move("Character",-1)}return{rng:t,rev:false}},isSelectionReversed:function(e,t){if(this.isW3C&&(t=t||e.rangeCount>0&&e.getRangeAt(0))){var i=t.startContainer,n=t.startOffset;return(e.anchorNode!==i||e.anchorOffset!==n)&&(e.focusNode===i&&e.focusOffset===n)}return false},copyAndCollapse:function(e,t){var i;if(this.isW3C){i=this.createRange();i.setStart(e.startContainer,e.startOffset);i.setEnd(e.endContainer,e.endOffset)}else{i=e.duplicate()}i.collapse(!!t);return i},replaceWith:function(e,t){if(this.isW3C){if(!e.collapsed){e.deleteContents()}e.insertNode(t)}else{var i="rangespan"+Math.random().toString(36);e.pasteHTML("<span id='"+i+"'></span>");var n=this.doc.getElementById(i);n.parentNode.replaceChild(t,n)}return t},replaceCollapsedCopyWith:function(e,t,i){this.replaceWith(this.copyAndCollapse(e,t),i)},insertDelimiters:function(e){var t=this;if(!t.isRangeInScope(e)){e=t.getDefaultSelection().rng}if(e.compareEndPoints?e.compareEndPoints("StartToEnd",e)===0:e.collapsed){if(t.isW3C){t.replaceWith(e,t.end)}else{t.replaceCollapsedCopyWith(e,false,t.end)}n(t.end.parentNode,t.start,t.end)}else{t.replaceCollapsedCopyWith(e,false,t.end);t.replaceCollapsedCopyWith(e,true,t.start)}},removeDelimiters:function(e){var i=this,n=i.createRange(),o,s=i.start,r=i.end;if(typeof e==="function"){e(s,r)}var a=s.parentNode,l=r.parentNode,u=t.addExtraSupport(s,r);if(i.isW3C){n.setStart(s,0);n.setEnd(r,0)}else{n.moveToElementText(s);o=i.createRange();o.moveToElementText(r);n.setEndPoint("EndToStart",o)}a.removeChild(s);l.removeChild(r);u();return n},_maxSelectRangeTime:20,selectRange:function(t,i){var n=this,o=n.getNativeSelection(),s=window.console&&+new Date,r,a;if(!n.isRangeInScope(t)){t=n.getDefaultSelection().rng}if(n.isW3C){if(t.collapsed){var l=t.endContainer,u=t.endOffset;o.collapse(l,u)}else if(i){o.collapse(t.endContainer,t.endOffset);o.extend(t.startContainer,t.startOffset)}else{o.collapse(t.startContainer,t.startOffset);o.extend(t.endContainer,t.endOffset)}}else{a=true;if(o&&o.createRange){r=o.createRange();try{if(r&&r.compareEndPoints("StartToStart",t)===0&&r.compareEndPoints("EndToEnd",t)===0){a=false}}catch(d){}if(a){t.select()}}}if(s){var c=new Date-s;if(c>n._maxSelectRangeTime&&e.enabled){e.warning("selection.SelImpl.selectRange","selectRange took too long:",c,"ms")}}}};exports.Selection=function(e,t,n,o){var r=e.document,a=new s(e,t,n||r.createElement("span"),o||r.createElement("span")),l=this,u,d=a.getDefaultSelection(),c,h=0;function f(){i(!h);if(!u){var e=a.getSelection();d=e||d;return!!e}}function p(e){if(!u){u=true;a.insertDelimiters(d.rng)}var t=++h;try{return e(a.start,a.end)}finally{i(u);i(t===h);if(!--h){g()}}}function g(){i(!h);if(u){u=false;d.rng=a.removeDelimiters(c)}}function _(){i(!h);if(u){g()}a.selectRange(d.rng,d.rev)}function m(){if(f()){var e=a.getNativeSelection();if(e.removeAllRanges){e.removeAllRanges()}else{e.empty()}}}l.record=f;l.modify=p;l.modifying=function(){return h>0};l.select=_;l.remove=m;l.onBeforeRepair=function(e){i(typeof e==="function");c=e}}},{"qed/util":true,log:true});require.install("qed/snapshot",function(require,exports,module){var e=require("qed/util").assert,t=require("qed/sanitize"),i=require("qed/npd"),n=require("qed/nodestate");function o(t,n){e(t);this.lookup=function(e){if(i.ok(e)){var o=i.key(e);if(o in t){return t[o]}else{t[o]=n;if(!n){return n}else{return n.lookup(e)}}}}}function s(e,t){var n=e?[e]:[];while(n.length){t(e=n.pop());for(var o=e.firstChild;o;o=o.nextSibling){if(i.ok(o)){n.push(o)}}}}o.prototype.restore=function(e){var i=this;s(e,function(e){var n=i.lookup(e);if(n){n.restore()}t.add(e)});t.flush(e)};exports.diff=function(e,t){var r={},a=false,l=true;s(e,function(e){var o=t&&t.lookup(e),s=n.diff(e,o);a=a||s.meaningful;l=l&&s.identical;r[i.key(e)]=s.state});return{meaningful:a,identical:l,snapshot:l?t:new o(r,t)}};exports.test=function(){}},{"qed/util":true,"qed/npd":true,"qed/sanitize":true,"qed/nodestate":true});require.install("qed/history",function(require,exports,module){var e=require("qed/snapshot"),t=require("qed/util"),i=t.assert;exports.observe=function(t){var o=[],s={},r;function a(n,s,a){i(n==="begin"||n==="end"||n==="redo");var l=(a||0).scope||t,u=e.diff(l,r&&r.snapshot),d={type:n,key:s,data:a,snapshot:u.snapshot,prev:r};if(d.changed=u.meaningful){o.length=0}return d}return{beginOperation:function(e,t){s[e]=true;r=a("begin",e,t)},endOperation:function(e,t){if(e in s){delete s[e];r=a("end",e,t)}},undo:function(){var e=a("redo","redo",r&&r.data),i=n(r);if(i){o.push(e);s={};r=e.prev=i;r.snapshot.restore(t);return r.data}},redo:function(){if(o.length>0){r=o.pop();r.snapshot.restore(t);return r.data}}}};function n(e){for(var t;e&&e.type!="end";e=e.prev){if(e.type=="redo"){return e.prev}else{t=t||e.changed}}if(t){return e}for(var o={count:0};e;e=e.prev){if(e.type=="redo"){return e.prev}if(e.type=="end"){o[e.key]=true;++o.count}else if(o[e.key]){i(e.type=="begin");delete o[e.key];if(--o.count===0){return t?e:n(e)}}t=t||e.changed}}},{"qed/snapshot":true,"qed/util":true});require.install("qed/trie",function(require,exports,module){exports.makeTrieMap=function(){return new e};function e(){var e=this,n=0,o={c:{}};e.size=function(){return n};function s(e,i){var n=t(o,e);if(n&&"val"in n){i=n.val}return i}e.get=s;e.has=function(e){return s(e,o)!==o};e.prefix=function(e){return!!i(o,e)};e.put=function(e,i){var s=t(o,e,true);n+="val"in s?0:1;s.val=i;return i};e.clear=function(){n=0;o={c:{}}};e.del=function(e){r(o,e)};function r(e,t){if(!e){return false}var i=e.c,o=t.charAt(0);if(o){if(!r(i[o],t.slice(1))){delete i[o]}if("val"in e){return true}}else if("val"in e){n-=1;delete e.val}for(o in i){return true}}}function t(e,i,n){if(e){if(!i){return e}var o=e.c,s=i.charAt(0);if(s in o||n&&(o[s]={c:{}})){return t(o[s],i.slice(1),n)}}}function i(e,i){var n=t(e,i);if(n){if("val"in n){return true}for(var o in n.c){return true}}}},{});require.install("qed/snippets",function(require,exports,module){var e,t=/\$(\d+|\{\d+:[^}]+\})/gm,i=/\\$/gm,n=require("qed/npd"),o="tabStopInfo",s=require("qed/util"),r=require("assert").ok;exports.enabled=function(){return!!(e&&e.size()>0)};if(!"".reverse){String.prototype.reverse=function(){for(var e=this.length,t=new Array(e),i=e-1;i>=0;--i){t[t.length]=this.charAt(i)}return t.join("")}}var a=document.createElement("div");exports.addTabTrigger=function(t,i){a.innerHTML=i;i=a.innerHTML;if(!e){e=require("qed/trie").makeTrieMap()}e.put(t.reverse(),i)};exports.removeTabTrigger=function(t){if(e){e.del(t.reverse())}};exports.clear=function(){if(e){e.clear()}};exports.check=function(t,i){if(e){var n=l(t,i);_(t,i);return n}};function l(e,t){var i=d(e);if(i){u(i.leaf,i.pos,e);var n=s.getDocument(e).createElement("div"),o=s.getEditorRoot(e),r,a=h(e);while(a.length>0){if(r=a.pop()){s.replaceWithChildren(r)}}n.innerHTML=i.tmpl;f(n,a);while(n.firstChild){s.insertBefore(e.parentNode,n.firstChild,e)}return true}}function u(e,t,i){r(e.nodeType===3);var n=s.insertBefore(e.parentNode,s.getDocument(e).createElement("span"),e.nextSibling),o=e.nodeValue.slice(0,t);if(o){e.nodeValue=o}else{s.remove(e)}var a=s.makeSiblings(n,i);while(n.nextSibling!==i){a.removeChild(n.nextSibling)}a.removeChild(n)}function d(e){var t=s.findPrevLine(e);try{return c(e)}finally{s.remove(t)}}function c(t){for(var i,n="",o=s.prevLeaf(t);o&&o.nodeType===3;o=s.prevLeaf(o)){for(var r=o.nodeValue,a=r.length;a>=0;a-=1){n+=r.charAt(a);if(!e.prefix(n)){return i}if(e.has(n)){i={leaf:o,pos:a,tmpl:e.get(n)}}}}return i}function h(e){var t=s.getEditorRoot(e),i=n.get(t,o);if(!i){i=n.fix(t,o,{})}return i.stops||(i.stops=[])}function f(e,t){var i=0,n=[],o,r=s.getDocument(e);g(r,e,n);t.length=0;while(i<n.length){if(o=n[i++]){t.push(o)}}o=t[t.length-1];if(!o||s.nextLeaf(o,e)){o=r.createElement("span");o.appendChild(r.createTextNode("\ufeff"));e.appendChild(o);t.push(o)}}function p(e,n,o){var s=e.split(t);if(s.length>1){for(var a=1,l,u;a<s.length;a+=2){l=s[a-1];u=s[a];if(i.test(l)){n(l+"$"+u)}else{if(l){n(l)}if(u.charAt(0)==="{"){var d=u.length,c=u.slice(1,d-1).split(":");r(u.charAt(d-1)==="}");o(+c[0],c[1]||"\ufeff")}else{o(+u,"\ufeff")}}}}n(s.pop(),true)}function g(e,t,i){if(t.nodeType===3){p(t.nodeValue,function(i,n){if(!n){s.insertBefore(t.parentNode,e.createTextNode(i),t)}else if(i){t.nodeValue=i}else{s.remove(t)}},function(n,o){r(typeof n==="number");r(!isNaN(n));var a=e.createElement("span");a.appendChild(e.createTextNode(o));s.insertBefore(t.parentNode,i[n]=a,t)})}else{for(var n=t.firstChild,o;n;n=o){o=n.nextSibling;g(e,n,i)}}}function _(e,t){for(var i,n=h(e),o=0;n&&o<n.length;++o){i=n[o];delete n[o];if(i){if(i.innerHTML==="\ufeff"){i.appendChild(e);i.appendChild(t)}else{s.insertBefore(i,e,i.firstChild);i.appendChild(t)}s.replaceWithChildren(i);break}}}},{assert:true,"qed/util":true,"qed/npd":true,"qed/trie":true});require.install("qed/edit",function(require,exports,module){var e=require("qed/util"),t=e.assert,i=e.addClass,n=e.getDocument,o=e.hasCtrlOrCmd,s=e.getText,r=e.isVisible,a=require("event").add,l=require("qed/unload"),u=new(require("qed/rules").Ruleset),d=require("qed/selection").Selection,c=require("qed/history").observe,h=require("qed/modifiers"),f=require("qed/snippets"),p=require("qed/nodestate").createMeaninglessElement,g=require("qed/npd"),_=require("settings").interface_strings;exports.edit=function(f,m){if(!f||/^textarea|input$/i.test(f.nodeName)||f.isContentEditable){return}i(f,"qed_content");f.setAttribute("contentEditable","true");g.fix(f,"isEditorRoot",true);m=m||u;g.fix(f,"editorRuleset",m);var v=n(f),w=new d(window,f,p(v,"span"),p(v,"span")),b=false,k=c(f),C=s(f),y=0,x=e,S,T,L=e.isGecko,q={38:"up arrow",40:"down arrow"},E=false,I=false,M=false;function A(t){if(e.isIE11&&s(f).indexOf("-")>-1){return true}return e.isIE&&t in q}function D(t){var i=t.keyCode||t.charCode;var n=16;var o=13;if(!e.isChrome){return false}var s=t.type=="keyup";var r=t.type=="keydown";var a=i==n;var l=t.shiftKey&&i==o;var u=a||l;if(a){if(s){E=false}else if(r){E=true}}if(l){if(s){I=false}else if(r){I=true}}if(u){M=true}else{if(M){u=true}if(!E&&!I){M=false}}return u}w.onBeforeRepair(h.sanitizeBeforeRepair);function N(){S=false;v.body.removeAttribute("spellcheck")}function O(e){if(!S){S=true;v.body.setAttribute("spellcheck","false")}clearTimeout(T);T=setTimeout(N,e||1e3)}a(f,"keydown",function(e){if(D(e)){return}if(L){O(1e3)}try{w.record();var t=e.keyCode||e.charCode;if(A(t)){return}return w.modify(function(i,n){if(t==90&&o(e)){if(e.shiftKey){k.redo()}else{k.undo()}return false}k.beginOperation("key"+t);var s=m.getKeyHandler(e);if(s){return s.call(x,i,n,e)}})}finally{R()}});var F;function R(){if(F){return}F=true;try{if(L&&v.activeElement!==f){f.focus()}w.select();if(v.activeElement!==f){f.focus()}}finally{t(F);F=false}t(v.activeElement===f)}a(f,"keyup",function(e){if(D(e)){return}try{w.record();var t=e.keyCode||e.charCode;if(A(t)){return}w.modify(function(e,i){k.endOperation("key"+t)})}finally{R()}});function P(){if(v.activeElement===f){w.record()}}a(f,"keypress",P);a(f,"mouseup",P);a(f,"mouseout",P);a(f,"focus",R);a(f,"blur",w.remove);function B(e){if(v.activeElement!==f){return false}}a(f,"keydown",B);a(f,"keypress",B);a(f,"keyup",B);function H(){if(r(f)&&s(f)!==C){return _.in_progress_warning}}l.checkBeforeUnload(H);return{modify:function(e,t){var i="modify"+y++;try{return w.modify(function(t,n){k.beginOperation(i);try{return e.call(x,t,n)}finally{k.endOperation(i)}})}finally{if((t||b)&&!(b=w.modifying())){R()}}},clear:function(t){this.modify(function(t,i){var o=e.getEditorRoot(t),s=n(o).createElement("br");e.removeAllChildren(o);o.appendChild(s);e.insertBefore(o,t,s);e.insertBefore(o,i,s)},t);this.html(true)},focus:R,select:R,html:function(e){if(e){C=s(f)}return g.cleanInnerHTML(f)},text:function(e){return s(f,e)},stop:function(){g.clean(f);l.removeCheck(H)}}};function m(e,t){if(f.enabled()){f.check(e,t);return false}}function v(e){return function(t,i,n){if(o(n)){e(t,i);return false}}}u.addOkTag("div").addOkTag("p","div").addOkTag("br").addOkTag("img").addOkTag("ol").addOkTag("ul").addOkTag("li").addOkTag("blockquote").addOkTag("address","blockquote").addOkTag("b").addOkTag("strong","b").addOkTag("i").addOkTag("em","i").addOkTag("u").addOkTag("span").addOkTag("a").addOkTag("h1").addOkStyle("font-weight","bold").addOkStyle("font-weight","normal").addOkStyle("font-style","italic").addOkStyle("font-style","normal").addOkStyle("text-decoration","underline").addOkStyle("text-decoration","none").addKeyHandler(9,m).addKeyHandler(65,e.handleSelectAll).addKeyHandler(66,v(h.bold)).addKeyHandler(73,v(h.italic)).addKeyHandler(85,v(h.underline))},{"qed/nodestate":true,"qed/unload":true,settings:true,"qed/history":true,"qed/modifiers":true,"qed/npd":true,"qed/rules":true,"qed/snippets":true,"qed/util":true,"qed/selection":true,event:true});require.install("linkify",function(require,exports,module){exports.iterLinks=function(t,i){e(t,{callback:function(e,t){if(t)i(t,e);return""}})};var e=exports.linkify=function(){var e="[a-z\\d.-]+://",t="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",i="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",n="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",o="(?:"+i+n+")",s="(?:[;/][^#?<>\\s\\[\\]]*)?",r="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",a="\\b"+e+"[^<>\\s]+",l="\\b"+o+s+r+"(?!\\w)",u="mailto:",d="(?:"+u+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+o+r+"(?!\\w)",c=new RegExp("(?:"+a+"|"+l+"|"+d+")","ig"),h=new RegExp("^"+e,"i"),f={"'":"`",">":"<",")":"(","]":"[","}":"{","Â»":"Â«","âº":"â¹"},p={callback:function(e,t){return t?'<a href="'+t+'" title="'+t+'">'+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(e,t){t=t||{};var i,n,o,s,r="",a=[],l,d,g,_,m,v,w,b;for(n in p){if(t[n]===undefined){t[n]=p[n]}}while(i=c.exec(e)){o=i[0];d=c.lastIndex;g=d-o.length;if(/[\/:]/.test(e.charAt(g-1))){continue}do{_=o;b=o.substr(-1);w=f[b];if(w){m=o.match(new RegExp("\\"+w+"(?!$)","g"));v=o.match(new RegExp("\\"+b,"g"));if((m?m.length:0)<(v?v.length:0)){o=o.substr(0,o.length-1);d--}}if(t.punct_regexp){o=o.replace(t.punct_regexp,function(e){d-=e.length;return""})}}while(o.length&&o!==_);s=o;if(!h.test(s)){s=(s.indexOf("@")!==-1?!s.indexOf(u)?"":u:!s.indexOf("irc.")?"irc://":!s.indexOf("ftp.")?"ftp://":"http://")+s}if(l!=g){a.push([e.slice(l,g)]);l=d}a.push([o,s])}a.push([e.substr(l)]);for(n=0;n<a.length;n++){r+=t.callback.apply(window,a[n])}return r||e}}()},{});require.install("find",function(require,exports,module){var e=require("qed/util"),t=e.insertBefore,i=e.getDocument,n=require("assert").ok;function o(e,t){if(e.nodeType===3){return t(e)}else{for(var i=e.firstChild,n;i;i=n){n=i.nextSibling;if(o(i,t)){return true}}}}function s(o,s,r,a){n(o.nodeType===3);var l=o.nodeValue,u=o.parentNode,d=i(o),c=l.slice(0,s),h=l.slice(s,r),f=o.nodeValue=l.slice(r),p=d.createElement("span"),g=p.cloneNode(false);if(c){t(u,d.createTextNode(c),o)}t(u,p,o);if(h){t(u,d.createTextNode(h),o)}t(u,g,o);try{return a(p,g)}finally{e.remove(p,g,!f&&o)}}function r(e,t,i){return t&&o(e,function(e){while(true){var n=e.nodeValue.indexOf(t);if(n<0){return}var o=s(e,n,n+t.length,i);if(o){return o}}})}exports.findText=r;function a(e,t,i){return t&&o(e,function(e){while(true){t.lastIndex=0;var n=t.exec(e.nodeValue);if(n===null){return}var o=s(e,n.index,n.index+n[0].length,i);if(o){return o}}})}exports.findExp=a;exports.find=function(e,t,i){if(typeof t==="string"){return r(e,t,i)}if(t instanceof RegExp){return a(e,t,i)}}},{assert:true,"qed/util":true});require.install("qtexteditor",function(require,exports,module){var e=require("w2.quora").Component,t=require("qed/edit").edit,i=require("qed/util"),n=i.hasCtrlOrCmd,o=i.deleteContents,s=require("view/fixable2"),r=require("qed/npd"),a=require("browser").browser,l=require("qed/modifiers");function u(){return(new Date).getTime()*1e3}function d(e){var t=parseInt(e,10);if(!isNaN(t)){return t>400}else{return e!="normal"&&e!="lighter"}}var c=exports.QTextEditorBase=e.extend({onUnload:function(){if(this.typingTimeout){clearTimeout(this.typingTimeout);this.typingTimeout=null}if(this.meaningfulChangeTimeout){clearTimeout(this.meaningfulChangeTimeout);this.meaningfulChangeTimeout=null}this.uninstallScrollHandlers();if(this._qed){this._qed.stop();delete this._qed}},onLoad:function(){this.linkSelectorLoaded=false;this.editor=this.$("#@editor");if(this.editor.length===0){return}var e=this._qed=t(this.editor[0]);if(!e){return}var i=require("webnode2");if(i.interactionMode){i.interactionMode.bindInteractionMode(this.editor)}if(!this.enterCallback){this.enterCallback=null}if(!this.focusCallback){this.focusCallback=null}if(!this.blurCallback){this.blurCallback=null}if(!this.typingStateCallback){this.typingStateCallback=function(){}}this.typingTimeout=null;this.lastInputTime=0;this.lastTypingReportTime=0;this.lastReportedTypingState="empty";this.typingStopped=false;if(!this.meaningfulChangeCallback){this.meaningfulChangeCallback=function(){}}this.meaningfulChangeTimeout=null;this.resetMeaningfulChange();this.$("#@cmd_heading").tooltip({contents:this.interface_strings.heading});this.$("#@cmd_blockquote").tooltip({contents:this.interface_strings.blockquote});this.$("#@cmd_insertorderedlist").tooltip({contents:this.interface_strings.ordered_list});this.$("#@cmd_insertunorderedlist").tooltip({contents:this.interface_strings.unordered_list});this.$("#@cmd_inserthr").tooltip({contents:this.interface_strings.horizontal_separator});this.$("#@add_qlink").tooltip({contents:this.interface_strings.link_things});this.$("#@cmd_qimg").tooltip({contents:this.interface_strings.insert_image});this.$("#@cmd_code").tooltip({contents:this.interface_strings.code_block});this.$("#@cmd_latex").tooltip({contents:this.interface_strings.latex});this.$("#@cmd_tips").tooltip({contents:this.interface_strings.writing_tips});this.$("#@add_qlink").click(this.fnbind(function(){this.addLink();return false}));function n(t){return function(){e.modify(function(e,i){$(e).before("["+t+"]");$(i).after("[/"+t+"]")},true);return false}}this.$("#@cmd_code").click(n("code"));this.$("#@cmd_latex").click(n("math"));this.$("#@cmd_qimg").click(this.fnbind(function(){this.openImageDialog();return false}));this.$("#@cmd_tips").click(this.fnbind(function(e){e.preventDefault();this.cQuery("writing_tips").toggle()}));var o=this;function s(t,i){o.$("#@cmd_"+t).click(function(){e.modify(i,true);o.inputEntered();return false})}s("bold",l.bold);s("italic",l.italic);s("underline",l.underline);s("blockquote",l.blockquote);s("insertorderedlist",l.orderedList);s("insertunorderedlist",l.unorderedList);s("inserthr",function(e,t){var i=l.insertHR(e,t,o.hr_img);o.markImageAsDetected(i);o.setImageAsUnselectable(i)});s("heading",l.heading);this.$("#@save").click(this.fnbind(function(){this.save()}));this.editor.on("input",this.fnbind(function(e){this.editorInputChange(e)}));this.isIE=navigator.userAgent.match(/(Trident)|(.NET)/i);if(!this.isIE){this.isIE=window&&window.navigator.appName=="Microsoft Internet Explorer"}this.isIE=a.msie;this.editor.keydown(this.fnbind(function(e){if(this.isIE){this.editorInputChange(e);this.handlePlaceholder(true)}return this.editorKeyDown(e)}));this.editor.keyup(this.fnbind(function(e){return this.editorKeyUp(e)}));this.editor.keypress(this.fnbind(function(e){return this.editorKeyPress(e)}));var r=this.fnbind(function(){this.editor.anchor()});this.editor.focus(this.fnbind(function(){this.editor.attr("focused",true);this.handlePlaceholder(false);$(document).on("livenode_op_start",r);this.loadLinkSelector();if(this.length_limit){this.lookup("counter").show()}if(this.focusCallback){this.focusCallback()}if(this.focusEditLinkCallback){this.focusEditLinkCallback()}}));this.editor.blur(this.fnbind(function(){this.editor.removeAttr("focused");this.handlePlaceholder(false);if(this.length_limit){this.lookup("counter").hide()}$(document).off("livenode_op_start",r);if(this.blurCallback){this.blurCallback()}this.detectLinks()}));this.editor.click(this.fnbind(function(e){this.setFormattingButtons(e.target)}));var u=this.fnbind(function(){this.qlinkSync()});this.$("#@qlink_text").keydown(u);this.$("#@qlink_text").keyup(u);this.$("#@qlink_text").keypress(u);this.$("#@qlink_text").change(u);this.$(".@qlink_close").click(this.fnbind(function(){this.replaceLinkWithText(this.$("#@qlink_key").val(),"@"+this.getLinkSelector().getValue());this.editor.focus();return false}));this.$("#@qlink_update").click(this.fnbind(function(){this.qlinkUpdate();return false}));this.$("#@editor img").each(function(e,t){o.markImageAsDetected(t)});this._enableImageDetection=true;this.registerLinkHandlers();this.$("#@fake_editor").click(this.fnbind(function(){this.hideFakeEditor()}));if(this.hideFakeEditorByDefault){this.hideFakeEditor();if(this.blurOnLoad){this.editor.blur()}}if(o.support_drag_and_drop_upload&&!o.prevent_load_drop_zone){o.loadDragAndDropForm()}this.updateLengthCounter()},uploadSuccess:function(e){for(var t=0;t<e.qimg_urls.length;t++){this.addImage(e.qimg_urls[t])}this.inputEntered();this.editor.focus()},isDragAndDropEvent:function(e){var t=false;var i=false;var n=e.dataTransfer||e.originalEvent.dataTransfer;if(!n.types){return false}$.each(n.types,function(e,n){if(n==="text/uri-list"){i=true}if(n.match(/image/i)||n.match(/file/i)){t=true}});return!i&&t},loadDragAndDropForm:function(){this.$("#@drop_zone").removeClass("hidden");var e=this.child("drag_and_drop_wrapper");var t=e.child("drag_and_drop_form");var i=this;this.addBodyDragoverListener();if(this.$("#@drop_zone")&&t){var n=function(e){if(i.isDragAndDropEvent(e)){e.stopPropagation();e.preventDefault();e.originalEvent.dataTransfer.dropEffect="copy";i.$("#@target_box").addClass("drag_and_hover")}};var o=function(e){if(i.isDragAndDropEvent(e)){e.stopPropagation();e.preventDefault();i.$("#@target_box").removeClass("drag_and_hover")}};t.setDropZone(this.$("#@drop_zone"),n,o);t.success(this.fnbind(this.uploadSuccess))}this.editor.on("paste",function(e){var n=e.clipboardData||e.originalEvent.clipboardData,o=[];if(!n||!n.items){return}for(var s=0;s<n.items.length;++s){var r=n.items[s].type;if(r.match(/image/i)||r.match(/file/i)){o.push(n.items[s].getAsFile())}}if(o.length){i.$("#@spinner").show();t._uploadFiles(o)}})},disableBrowserFileDragDefault:function(e){e.stopPropagation();e.preventDefault();var t=e.originalEvent.dataTransfer;t.effectAllowed=t.dropEffect="none"},addBodyDragoverListener:function(){var e=this;$("document, body").bind({dragenter:function(t){if(e.isDragAndDropEvent(t)){t.stopPropagation();t.preventDefault();e.disableBrowserFileDragDefault(t);e.$("#@drop_zone").addClass("drag_and_hover");e.$("#@target_box").removeClass("hidden");
var i=e.$("#@editor").height()-10;e.$("#@target_box").height(i).css({"line-height":i+"px"})}},dragover:function(t){if(e.isDragAndDropEvent(t)){e.disableBrowserFileDragDefault(t);t.stopPropagation();t.preventDefault();e.$("#@drop_zone").removeClass("drag_and_hover");e.$("#@target_box").addClass("hidden")}}})},fixEditorButtons:function(){if(this.buttonsVisible&&this.shouldFixButtons){var e=this.$("#@qtext_editor_buttons_wrapper"),t=this.$("#@editor_outer");s.makeFixable(e,{scroll_dep:true,sticky_release:false,min_scroll_callback:function(){return t.offset().top-$(".SiteHeader").outerHeight()},max_scroll_callback:function(){return t.offset().top+t.outerHeight()-$(".SiteHeader").outerHeight()}})}},setImageAsUnselectable:function(e){e.setAttribute("unselectable","on")},handlePlaceholder:function(e){if(!this.isEmpty()||e){this.editor.removeClass("needs_placeholder")}else{this.editor.addClass("needs_placeholder")}},hideFakeEditor:function(){this.$("#@fake_editor").hide();this.editor.show();this.editor.focus();this.fixEditorButtons()},registerLinkHandlers:function(){this._linkHandlers={};var e=this;var t=e.supported_link_handlers;function i(i,n){if(t&&t.indexOf(i)>=0){e.addLinkHandlerForType(i,e.fnbind(n))}}i("youtube",e.handleYoutubeLink);i("image",e.handleImageLink);i("email",e.handleEmailLink);i("invalid",e.handleInvalidLink)},addLinkHandlerForType:function(e,t){if(this._linkHandlers){this._linkHandlers[e]=t}},getLinkHandler:function(e){return this._linkHandlers&&this._linkHandlers[e]},loadLinkSelector:function(e){if(!this.linkSelectorLoaded){this.serverCall("get_link_selector").contentFor(this.$("#@link_selector"),{parentCID:this.cid}).success(this.fnbind(function(){if(!this.plaintext){var t=this.getLinkSelector();if(t){t.setCallback(this.fnbind(function(){this.onLinkSelection()}))}}this.linkSelectorLoaded=true;if(e&&$.isFunction(e)){e()}})).sendOnlyOnce()}},makeKey:function(){var e="";var t="abcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<10;i++){e+=t[Math.floor(Math.random()*t.length)]}return e},syncTypingState:function(){var e=10*1e3*1e3,t;if(this.isEmpty()||this.typingStopped){t="empty"}else{if(this.lastInputTime<u()-e){t="paused"}else{t="typing"}}var i=false;if(t!=this.lastReportedTypingState){i=true}if(t!="empty"){if(this.lastTypingReportTime<u()-55*1e3*1e3){i=true}}if(i){this.typingStateCallback(t);this.lastReportedTypingState=t;this.lastTypingReportTime=u()}if(this.typingTimeout){clearTimeout(this.typingTimeout);this.typingTimeout=null}if(t=="typing"||t=="paused"){this.typingTimeout=setTimeout(this.fnbind(function(){this.syncTypingState()}),e/1e3)}},checkMeaningfulChange:function(){var e=this.checkMeaningfulTimeoutPeriod*1e3;if(this.meaningfulChangeTimeout){return}this.meaningfulChangeTimeout=setTimeout(this.fnbind(function(){var e=this.serialize(true);if(!this.meaningfulChangeBase||e.html!=this.meaningfulChangeBase.html||e.data!=this.meaningfulChangeBase.data){this.meaningfulChangeCallback()}this.meaningfulChangeBase=e;this.meaningfulChangeTimeout=null}),e)},reportMeaningfulChange:function(){this.meaningfulChangeBase=null;this.checkMeaningfulChange()},resetMeaningfulChange:function(){this.meaningfulChangeBase=this.serialize(true);if(this.meaningfulChangeTimeout){clearTimeout(this.meaningfulChangeTimeout);this.meaningfulChangeTimeout=null}},editorKeyUp:function(){this.detectNewImages();this.inputEntered();if(this._detectLinksOnNextKeyUp){this._detectLinksOnNextKeyUp=false;this.detectLinks()}},inputEntered:function(){this.updateLengthCounter();this.typingStopped=false;this.lastInputTime=u();this.syncTypingState();this.checkMeaningfulChange();this.dirtyText()},updateLengthCounter:function(){if(this.length_limit){this.lookup("counter").updateCounter(this.valLength());var e=this.valLength()>this.length_limit;this.updateButton(e)}},updateButton:function(e){},text:function(e){var t=this._cachedText;if(e||!t){t=this._qed.text()}return(this._cachedText=t)||""},dirtyText:function(){this._cachedText=null},_cachedUrlInfo:{},getUrlInfo:function(e,t){var i=this,n=i._cachedUrlInfo[e];if(n===false){}else if(n){t(n)}else{$(i).trigger("link-fetch-start",[e]);i.serverCall("get_url_info").kwargs({url:e}).success(function(n){t(i._cachedUrlInfo[e]=n);$(i).trigger("link-fetch-end",[e])}).error(function(){i._cachedUrlInfo[e]=false;$(i).trigger("link-fetch-end",[e])}).send()}},detectLinks:function(){var e=this,t=require("linkify").iterLinks;t(e.text(),function(t,i){e.detectLink(t,i)})},detectLink:function(e,t){var i=this;if(e&&e.indexOf("mailto:")===0){var n={type:"email",title:t,url:e};i.handleDetectedLink(n,e,t)}else{i.getUrlInfo(e,function(n){i.handleDetectedLink(n,e,t)})}},handleDetectedLink:function(e,t,i){var n=e&&e.type,o=n&&this.getLinkHandler(n);if(o){return o(e,t,i)}return $(this).trigger("link-added-to-editor",[e,t,i])},handleImageLink:function(e,t,i){var n=this;n.findTextAndModify(i,function(t){var i=n.replaceLinkWithImage(t,e.url);n.detectNewImage(i)})},handleYoutubeLink:function(e,t,i){var n=this;n.findTextAndModify(i,function(t){var i="http://img.youtube.com/vi/"+e.video_id+"/hqdefault.jpg";var o=n.replaceLinkWithImage(t,i);n.markImageAsDetected(o);for(var s in e){o.setAttribute(s,e[s])}})},handleInvalidLink:function(){},handleEmailLink:function(){},replaceLinkWithImage:function(e,t){var n=e;$(n.foundStart).replaceWith(n.start);$(n.foundEnd).replaceWith(n.end);i.deleteContents(n.start,n.end);this.handleImageWithinLink(n);var o=t&&this.addImage(t,true);return o},handleImageWithinLink:function(e){var t=e.start.parentElement;if(!i.hasTag(t,"a")||t!==e.end.parentElement){return}var n=t.firstChild;while(n){var o=n.nextSibling;if(n.nodeType===3){if(!n.nodeValue||n.nodeValue.length===0){$(n).remove()}}else if(i.hasTag(n,"span")){if(n!==e.start&&n!==e.end&&(!n.childNodes||n.childNodes.length===0)){$(t).after(n)}}n=o}if(t.firstChild==e.start&&t.lastChild==e.end){$(t).before(e.start).after(e.end);i.deleteContents(e.start,e.end)}},findTextAndModify:function(e,t,i){var n=this,o=require("find");n._qed.modify(function(i,s){o.findText(n.editor.get(0),e,function(e,n){var o={start:i,end:s,foundStart:e,foundEnd:n};return t(o)})},i)},onLinkAdded:function(e){var t=this;$(t).bind("link-added-to-editor",function(i,n,o,s){return e.call(t,n,o,s)})},onLinkFetchStart:function(e){var t=this;$(t).bind("link-fetch-start",function(i,n){return e.call(t,n)})},onLinkFetchEnd:function(e){var t=this;$(t).bind("link-fetch-end",function(i,n){return e.call(t,n)})},detectNewImages:function(){if(!this._enableImageDetection){return}var e=this;this.$("#@editor img").each(function(t,i){e.detectNewImage(i)})},detectNewImage:function(e){var t=this;if(!t.markImageAsDetected(e)){return}function i(e,t,i){if(!/^webkit-fake-url:/.test(e)){var n=new Image;n.onload=t;if(i){n.onerror=i}n.src=e}else if(i){i()}}$(e).addClass("qtext_image");var n=function(){$(e).remove()};i(e.src,function(){t.serverCall("upload_image_by_url").kwargs({url:e.src}).success(function(t){if(t&&t.failed){n();return}if(t){i(t.url,function(){e.src=t.url})}}).send()},function(){n()})},markImageAsDetected:function(e){if(!e.hasAttribute("detected")){e.setAttribute("detected",e.src.slice(0,100));return true}},editorInputChange:function(){this.handlePlaceholder(false)},editorKeyPress:function(e){if(String.fromCharCode(e.which)=="@"){this.addLink();return false}},setEscapeKeyCallback:function(e){this.escapeKeyCallback=e},editorKeyDown:function(e){if(this.enterCallback&&!e.shiftKey&&e.keyCode==13){this.enterCallback();return false}switch(e.which){case 27:if(this.escapeKeyCallback){this.escapeKeyCallback()}break;case 86:if(!n(e)){break}case 32:case 13:this._detectLinksOnNextKeyUp=true}return true},addDummySpan:function(){var e;this._qed.modify(function(t,i){o(t,i);e=document.createElement("span");i.parentNode.insertBefore(e,i)});return e},openImageDialog:function(){var e=this;e._dialog=e._dialog||e.dialog({showXButton:true,closeOnClickOut:true,width:550}).title(e.interface_strings.insert_image).close(function(){e._dialog=null}).load("image_dialog_contents")},addImage:function(e,t,i){var n=this;return n._qed.modify(function(o){var s=o.parentNode;if(s){var r=document,a=r.createElement("img"),l,u;a.src=e;n.setImageAsUnselectable(a);if(i){u=a}else{l=r.createElement("div");l.appendChild(a);u=l}s.insertBefore(u,o);if(!t){n.detectNewImages()}return a}},true)},addLink:function(){if(!this.linkSelectorLoaded){return this.loadLinkSelector(this.fnbind(this.addLink))}var e=this.makeKey(),t=document.createElement("a");t.id="qlink_"+e;t.innerHTML="â¦";t.className="qlink";t.href="#";this._qed.modify(function(e,i){function n(e){$(e).closest("a.qlink").map(function(){$(this).after(e)})}n(e);n(i);o(e,i);$(e).before(t)},true);this.qlink_data[e]={target:{},text:""};setTimeout(this.fnbind(function(){this.editLink(e,"")}),0)},setSelectionlessCallback:function(e){if(!this.selectionlessCallback){var t=this.getLinkSelector();var i=this;t.setSelectionlessCallback(function(){i.callSelectionlessCallback()})}this.selectionlessCallback=e},callSelectionlessCallback:function(){var e=this.selectionlessCallback;if(e){e()}},editLink:function(e,t){this.closeEditLink();this.editingLink=true;var i=this;var n=this.qlink_data[e].text?this.qlink_data[e].text:t;var o=this.qlink_data[e].target;if(o.type){this.$("#@qlink_selector").hide()}this.$("#@qlink_key").val(e);if(n){this.$("#@qlink_text").val(n)}var s=this.$("#@editor_wrapper").offset();var r=this.$("#@editor #qlink_"+e).offset();var a=r.left-s.left;var l=r.top-s.top;this.$("#@qlink_editor").css("left",a-10);this.$("#@qlink_editor").css("top",l+20);this.$("#@qlink_editor").removeClass("hidden");var u=this.getLinkSelector();u.clear();u.setText(n);u.focus(true);u.setEscKeyDown(this.fnbind(function(t){var i=u.getValue();var n=t.keyCode==27;var o=!i&&t.keyCode==13;var s=!i&&t.keyCode==8;var r="@";if(n&&i){r="@"+i}if(o||n||s){this.replaceLinkWithText(e,r);setTimeout(this.fnbind(function(){this.editor.focus()}),0);return false}}));var d=function(){i.replaceLinkWithText(e,"@"+u.getValue())};this.setSelectionlessCallback(this.fnbind(function(){d();setTimeout(this.fnbind(function(){this.editor.focus()}),0)}));u.setKeyUp(function(){i.editLinkText(e,u.getValue())});if(o.type){this.$("#@qlink_text").focus()}else{this.focusEditLinkCallback=this.fnbind(function(){if(this.editingLink){d()}else{this.closeEditLink()}});this.$("#@editor #qlink_"+e).addClass("qlink_active")}},getLinkSelector:function(){return this.child("link_selector")},replaceLinkWithText:function(e,t){this.closeEditLink();if(!e){return}var i=this.$("#@editor #qlink_"+e);var n=$("<div>");t=n.text(t).html();if(i.length){this._qed.modify(function(e,n){i.after(n).after(e).replaceWith(t||"")})}delete this.qlink_data[e]},editLinkText:function(e,t){if(!this.editingLink){return}this.qlink_data[e].text=t;this.$("#@editor #qlink_"+e).text("@"+t)},closeEditLink:function(){this.editingLink=false;var e=this.$("#@qlink_key").val();if(!e){return}this.$("#@qlink_editor").addClass("hidden");this.$("#@editor #qlink_"+e).removeClass("qlink_active");this.$("#@qlink_selector").show()},qlinkSync:function(){var e=this.$("#@qlink_key").val(),t=this.$("#@qlink_text").val(),i=this.$("#@editor #qlink_"+e);i.text(t||"â¦");var n=this.getLinkSelector().result;if(t){i.attr("title",this.qlink_data[e].text=t)}if(n){this.qlink_data[e].target=n}},qlinkUpdate:function(){this.qlinkSync();this.closeEditLink()},onLinkSelection:function(){var e=this.getLinkSelector().qValue;this.$("#@qlink_text").val(e);this.qlinkUpdate();setTimeout(this.fnbind(function(){this.editor.focus()}),0);this.inputEntered()},setFormattingButtons:function(e){var t=$(e),n={bold:d(t.css("font-weight")),italic:t.css("font-style")=="italic",underline:t.css("text-decoration")=="underline"};if(i.isHeading(e)){delete n.bold}for(var o in n){if(n[o]){this.$("#@cmd_"+o).addClass("qtext_editor_button_active")}else{this.$("#@cmd_"+o).removeClass("qtext_editor_button_active")}}},setEnterCallback:function(e){this.enterCallback=e},setTypingStateCallback:function(e){if(this.plaintext){this.typingStateCallback=null}else{this.typingStateCallback=e}},setMeaningfulChangeCallback:function(e){if(this.plaintext){this.meaningfulChangeCallback=null}else{this.meaningfulChangeCallback=e}},setFocusCallback:function(e){this.focusCallback=e},setBlurCallback:function(e){this.blurCallback=e},serialize:function(e){var t={html:this.html(e)};if(this.plaintext){t.data={}}else{t.data=this.qlink_data}return t},html:function(e){if(this.plaintext){var t=this.editor.val();if(!t){t=""}return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}else if(this._qed){return this._qed.html(!e)}else{return this.editor.html()}},setHtml:function(e,t){if(t){this.qlink_data=t}return this.editor.html(e)},isEmpty:function(){if(this.plaintext){return this.editor.val()===""}if(this.editor.length===0){return true}var e=this.editor[0];if(!e){return true}if(e.childNodes.length==1){if(e.childNodes[0].tagName=="BR"){return true}}var t=this.html(true);return t===""},valLength:function(){if(this.plaintext){var e=this.editor.val();return e?e.replace(/\n/g,"<br>").length:0}else{return this.text().length}},clear:function(e){if(this.plaintext){this.editor.val("")}else{if(this._qed){this._qed.clear(e)}this.qlink_data={};this.lastInputTime=u();this.syncTypingState();this.dirtyText()}},stopTyping:function(){if(!this.plaintext){this.typingStopped=true;this.syncTypingState()}},selectAll:function(){var e=this.editor;this._qed.modify(function(t,i){$(t).prependTo(e);$(i).appendTo(e)},true)},focus:require("atexit").hook(function(){var e=this;e.whenOnLoaded(function(){var t=e.editor;t.anchor().focus();var n=e.plaintext?t.val().length>0:t.text().length>0;if(n){var o=t.get(0);if(e.plaintext){if(o.setSelectionRange){o.setSelectionRange(0,t.val().length)}else{t.select()}}else{e._qed.modify(function(e,t){i.insertBefore(o,e,o.lastChild);i.insertBefore(o,t,o.lastChild)},true)}}t.attr("focused",true)})}),blur:function(){this.editor.blur().removeAttr("focused")},isInteractive:function(){return this.$("#@editor").attr("interactive")},hasChanged:function(e){return e.html!=this.html()}});var h=exports.QTextEditor=c.extend({onLoad:function(){this._super.apply(this,arguments);if(a.msie&&a.version>=9){document.execCommand("AutoUrlDetect",false,false)}var e=this;this.link_class_to_option={};this.options=["href","text","preview","delete"];$.each(this.options,function(t,i){var n=e.getClassName(i);e.link_class_to_option[n]=i});e.linkEditorDiv=e.$("#@editor_wrapper");e.initLinkOptions();e.onLinkAdded(function(t,i,n){e.handleLinkAdded(t,i,n)});e.editor.mouseover(function(t){return e.linkEditorMouseOver(t)});e.editor.keydown(function(t){return e.linkEditorKeyDown(t)});e._retrievingUrlInfo={};e._retrievingUrlInfoCount=0;e.onLinkFetchStart(function(t){e.$("#@spinner").show();e._retrievingUrlInfo[t]=true;e._retrievingUrlInfoCount++});e.onLinkFetchEnd(function(t){e._retrievingUrlInfoCount--;delete e._retrievingUrlInfo[t];if(e._retrievingUrlInfoCount===0){e.$("#@spinner").hide()}});this.initSpinner()},initSpinner:function(){var e=require("spin").createSpinnerElement({color:"#000"});this.$("#@spinner").append(e.el)},onUnload:function(){this._super.apply(this,arguments);this.editor=$();delete this.linkEditorDiv;delete this.linkOptions},getUrlInfo:function(e,t){if(this._retrievingUrlInfo&&this._retrievingUrlInfo[e]){return}this._retrievingUrlInfo[e]=true;var i=this;this._super.apply(this,[e,function(n){delete i._retrievingUrlInfo[e];t(n)}])},getClassName:function(e){return"qtext_editor_link_"+e},getAttrName:function(e){if(e==="href"){return e}return"data-link-"+e},getButton:function(e){return this.$("#@link_option_"+e)},initLinkOptions:function(){var e=this;e.linkOptions=e.$("#@qtext_editor_link_options");var t=[["href",e.interface_strings.show_linked_url],["text",e.interface_strings.show_linked_title],["delete",e.interface_strings.show_unlinked]];var i=0;$.each(t,function(t,n){e.getButton(n[0]).click(function(){return e.handleLinkOption(n[0])}).tooltip({contents:n[1]});i+=e.getButton(n[0]).outerWidth(true)});e.linkOptions.css("width",i)},positionLinkOptions:function(e){var t=$("<span>\ufeff</span>").prependTo(e);var i=t.offset();var n=t.height();t.remove();var o=this.linkEditorDiv.offset();var s=i.left-o.left-2;var r=i.top-o.top;this.linkOptionsHeight=this.linkOptionsHeight||this.linkOptions.outerHeight();r=r-this.linkOptionsHeight;if(this._positionIntersectsHeader(i.top+r)){r=r+this.linkOptionsHeight+n}this.linkOptions.css("top",r);this.linkOptions.css("left",s)},_positionIntersectsHeader:function(e){var t=$(".SiteHeader");if(t.length===0){require("assert").ok(t.length===0,"var siteHeader does not exist in qTextEditor positionLinkOption");return false}var i=t.offset().top+t.outerHeight();return i>e},linkEditorMouseOver:function(e){var t=e.target;var n=(t&&t.nodeName||"").toLowerCase();var o=this.linkOptions;t=$(t);var s;if(n==="a"){s=t[0]}else{var r=t.parents("a");if(r.length>0){s=r[0]}}this.unhighlightLinkTarget();if(s){this.linkTarget=s;this.positionLinkOptions(s)}if(s||i.contains(o[0],t)){var a=this.detectNewLinkElement(s);if(a){this.highlightActiveButton(s);this.highlightLinkTarget();o.show()}}else{o.hide()}},highlightActiveButton:function(e){var t=this;var i=t.getOption(e);$.each(t.options,function(e,n){var o=t.getButton(n);if(n===i){o.addClass("active")}else{o.removeClass("active")}})},highlightLinkTarget:function(){if(this.linkTarget){$(this.linkTarget).addClass("qtext_editor_link_hover")}},unhighlightLinkTarget:function(){if(this.linkTarget){$(this.linkTarget).removeClass("qtext_editor_link_hover")}},linkAlreadyDetected:function(e,t){var i=this,n=this.getLinkParent(t);var o=n?i.getQlinkKey(n):null;if(o){return true}if(n){var s=n;if($(s).text()!==e){i.moveSelectionOut(s,t.start,t.end);i.moveSelectionOut(s,t.foundStart,t.foundEnd);i.detectNewLinkElement(n);return true}}return false},getLinkParent:function(e){var t=$(e.foundStart).parents("a");var i=t.length>0?t[0]:null;return i},detectLinks:function(){var e=this,t=require("linkify").iterLinks,i,n,o=function(t){if(!e.linkAlreadyDetected(n,t)){e.detectLink(i,n)}};var s=[];t(e.text(),function(e,t){s.push({href:e,text:t})});s.sort(function(e,t){return t.text.length-e.text.length});for(var r=0;r<s.length;r++){i=s[r].href;n=s[r].text;e.findTextAndModify(n,o)}this.detectNewLinkElements()},detectLink:function(e){if(this.has_excluded_tld(e)){return}this._super.apply(this,arguments)},has_excluded_tld:function(e){var t=this.tlds_to_exclude;if(!t){return false}for(var i=0;i<t.length;i++){var n=t[i];if(e&&e.toLowerCase().indexOf(n,e.length-n.length)!==-1){return true}}return false},linkEditorKeyDown:function(){this.linkOptions.hide();this.unhighlightLinkTarget()},getQlinkKey:function(e){if(i.hasTag(e,"a")){var t=$(e).attr("id");if(t&&t.indexOf("qlink_")===0){return t.substring(6)}}return null},handleInvalidLink:function(e,t,i){this.handleLinkAdded(e,t,i,"href")},handleEmailLink:function(e,t,i){var n=this.interface_strings.send_email.replace("{}",e.title);this.handleLinkAdded(e,t,i,"href",n)},handleLinkAdded:function(e,t,n,o,s){var r=this,a=document.activeElement==r.editor.get(0);var l=e.title||n;if(l===t){o=o||"text";if(o==="text"){s=s||this.getDefaultText(t);l=s}}s=s||l;r.findTextAndModify(n,function(e){if(r.linkAlreadyDetected(n,e)){return false}var u=r.getLinkParent(e);i.deleteContents(e.foundStart,e.foundEnd);r._qed.modify(function(i,a){var d=r.makeKey();var c="qlink_"+d;if(u){r.moveSelectionOut(u,e.start,e.end);r.moveSelectionOut(u,e.foundStart,e.foundEnd);r.moveSelectionOut(u,i,a)}else{u="<a>"}u=$(u);u.attr("id",c);u.text(l);u.addClass("qlink");u.attr(r.getAttrName("text"),s);u.attr(r.getAttrName("href"),t);u.attr(r.getAttrName("delete"),n);r.setOption(u,o||"text");$(e.foundStart).after(u)},a);return true})},getDefaultText:function(e){var t=this.getHostName(e.toLowerCase());if(!t){return e}var i=t.split(".");var n=i.slice(-1)[0].match(/com|net|org|edu|gov/i)?2:3;i=i.slice(-n);var o=i.join(".");return this.interface_strings.page_on_domain.replace("{}",o)},getHostName:function(e){var t=e.match(/^https?:\/\/([^/]+)/i);return t?t[1]:null},removeLinkClasses:function(e){var t=this;$.each(this.options,function(i,n){var o=t.getClassName(n);$(e).removeClass(o)})},getOption:function(e){var t,i=this;$.each(this.options,function(n,o){if($(e).hasClass(i.getClassName(o))){t=o}});return t},setOption:function(e,t){this.removeLinkClasses(e);$(e).addClass(this.getClassName(t))},getValue:function(e,t){return $(e).attr(this.getAttrName(t))},setValue:function(e,t,i){return $(e).attr(this.getAttrName(t),i)},getLinkHtml:function(e){return r.cleanInnerHTML(e)},initNonDetectedLink:function(e){var t=this.makeKey();var i="qlink_"+t;e=$(e);var n=e.attr("href");if(!n||$.trim(n).length===0||n==="#"){var o=e.attr(this.getAttrName("href"));n=o||"http://..."}var s=this.getLinkHtml(e[0]);if(!s||$.trim(s).length===0){s=n}if(this._retrievingUrlInfo[n]||this._retrievingUrlInfo[s]){return false}e.attr("id",i);e.attr(this.getAttrName("text"),s);e.attr(this.getAttrName("href"),n);e.html(s);e.addClass("qlink");var r=this.getOption(e);if(!r){this.setOption(e,"text")}return true},initLinkSelectorLink:function(e){e=$(e);if(e.attr(this.getAttrName("text"))||this.getOption(e)){return true}var t=this.getQlinkKey(e[0]);if(!this.qlink_data[t]){return true}if(this.editingLink&&t===this.$("#@qlink_key").val()){return false}var i=this.getValue(e,"href");if(!i||i==="#"||i.length===0){i=this.qlink_data[t].target.url}var n=this.getLinkHtml(e[0]);this.setValue(e,"href",i);this.setValue(e,"text",n);this.setValue(e,"delete",n);this.setOption(e,"text");return true},qlinkSync:function(){this._super.apply(this,arguments);var e=this.$("#@qlink_key").val(),t=this.$("#@qlink_text").val(),i=this.$("#@editor #qlink_"+e);if(!t||!e||!i){return}var n=this.getLinkSelector().result;if(!n){return}this.initLinkSelectorLink(i)},detectNewLinkElement:function(e){e=$(e);var t=this.getQlinkKey(e[0]);if(t&&e.attr(this.getAttrName("text"))){return true}if(this.qlink_data[t]){return this.initLinkSelectorLink(e)}else{return this.initNonDetectedLink(e)}},detectNewLinkElements:function(){var e=this;this.$("#@editor a").each(function(t,i){e.detectNewLinkElement(i)})},handleLinkOption:function(e){var t=this;var i=t.linkTarget;var n=t.getQlinkKey(i);if(!n){t.editor.focus();return false}if(t.getOption(i)===e){t.editor.focus();return false}var o=t.getValue(i,e);t.unhighlightLinkTarget(i);t._qed.modify(function(){t.updateLinkText(i,n,o,e);t.setOption(i,e);if(e==="delete"){$(i).removeClass("qlink")}else{$(i).addClass("qlink")}},true);t.highlightLinkTarget(i);t.highlightActiveButton(i);return false},updateLinkText:function(e,t,i,n){var o=this.getOption(e);var s=this,r;this._qed.modify(function(t,o){s.moveSelectionOut(e,t,o);r=s.getPreviousValue(e);if(n!=="href"){$(e).html(i)}else{$(e).text(i)}},true);this.setValue(e,o,r)},getPreviousValue:function(e){var t;var i=this.getOption(e);if(i!=="href"){t=this.getLinkHtml(e)}else{t=$(e).text()}return t},containsSelection:function(e,t,i){return $.contains(e,t)||$.contains(e,i)},moveSelectionOut:function(e,t,i){if(this.containsSelection(e,t,i)){$(e).after(t).after(i)}},disable:function(){this.is_disabled=true;this.editor.addClass("qtext_editor_content_disabled")},enable:function(){this.is_disabled=false;this.editor.removeClass("qtext_editor_content_disabled")}});exports.ThreadMessageQTextEditor=h.extend({onLoad:function(){this.is_disabled=false;this._super.apply(this,arguments);this.setTypingStateCallback(this.fnbind(function(e){this.serverCall("typing").kwargs({thread_id:this.thread_id,state:e}).send()}));if(this.focusOnload){this.focus()}this.adjustThreadDetailHeight()},request:function(){if(this.is_disabled||this.isEmpty()&&!this.plaintext){return false}var e={};e.thread_id=this.thread_id;e.object_id=this.object_id;if(this.isEmpty()&&this.plaintext){e.msg={html:this.editor.val()}}else{e.msg=this.serialize()}require("w2.rpc");require("webnode2").rpc("/thread/"+this.ajax_POST).kwargs(e).liveMutate().success(this.fnbind(function(){this.cleanUp()})).send();this.disable()},cleanUp:function(){this.enable();this.clear();this.blur();this.focus()},editorInputChange:function(){this._super.apply(this,arguments);this.adjustThreadDetailHeight()},adjustThreadDetailHeight:function(){this.lookup("messages_main_base").$("#@thread_detail").css("padding-bottom",this.lookup("compose_box").$("#@compose_box_container").outerHeight())},resetThreadDetailHeight:function(){this.lookup("messages_main_base").$("#@thread_detail").removeAttr("style")}});exports.TCommentQTextEditor=h.extend({onLoad:function(){var e=this,t;e._super.apply(e,arguments);function i(i){if(i||!t){e.$("#@qtext_editor_buttons_wrapper").toggle(i)}else if(t){t=false;e.focus()}}e.editor.focus(function(){i(true)}).blur(function(){i(false)});e.$("#@qtext_editor_buttons_wrapper").mousedown(function(){t=true});e.setMeaningfulChangeCallback(e.fnbind(function(){e.save_draft(false)}))},save_draft:function(){this.serverCall("save_draft_auto").kwargs({content:this.serialize(),window_id:require("webnode2").windowId,draft_space:this.draft_space}).send()}});exports.EmbedQtextEditor=h.extend({onUnload:function(){delete this.embedEditorDiv},onLoad:function(){this._super.apply(this,arguments);var e=this;e.url_attr_name="data-url";e.embed_data_attr_name="data-embed";e.embedEditorDiv=e.$("#@embed_editor");e.last_embed_update=+new Date;e.embedComponents={};e.placeholderImages={};e.overlays={};e.retrieveExistingEmbeds();e.onLinkAdded(function(t){e.handleLinkAdded(t)});e.onLinkFetchStart(function(){e.$("#@spinner").show()});e.onLinkFetchEnd(function(){e.$("#@spinner").hide()});e.editor.keydown(function(t){return e.embedEditorKeyDown(t)});e.editor.bind("paste",function(){e.updateEmbedDetectedAttr();e.detectEmbeds()});e.editor.bind("cut",function(){e.detectEmbeds()})},clear:function(){var e=this,t;for(t in e.embedComponents){e.deleteComponent(t,true)}this._super.apply(this,arguments)},retrieveExistingEmbeds:function(){var e=this;$.each(this.idsToUrls,function(t){var i=e.editor.find("#"+e.imageId(t));e.placeholderImages[t]=i;e.markEmbedAsDetected(i);var n=e.embedEditorDiv.find("#"+e.overlayId(t));e.overlays[t]=n})},embedEditorKeyDown:function(){var e=this;e.detectEmbeds();return true},detectEmbeds:function(){var e=this;if(e.detectEmbedCallback){return}e.detectEmbedCallback=setTimeout(function(){e.detectAndRemoveDeletedComponents();e.detectNewPlaceholderImages();delete e.detectEmbedCallback},0)},imageId:function(e){return"embed_image_"+e},getImageInEditor:function(e){return this.editor.find("#"+this.imageId(e))},getImage:function(e){var t=this.getImageInEditor();if(t.length){this.placeholderImages[e]=t}return this.placeholderImages[e]},overlayId:function(e){return"embed_overlay_"+e},getOverlay:function(e){return this.overlays[e]},detectAndRemoveDeletedComponents:function(){var e=this;e.getEmbedComponents(function(t){var i=e.editor.find("#"+e.imageId(t));if(!e.isInEditor(i)){e.deleteComponent(t,true)}});e.updateEmbedComponentPositions()},isInEditor:function(e){e=$(e);e=e&&e.length?e[0]:null;if(e){if(this.editor.length===0){return false}return i.contains(this.editor[0],e)}return false},deleteComponent:function(e,t){var i=this;var n=this.embedComponents[e];var o=this.getOverlay(e);var s=this.getImage(e);delete this.embedComponents[e];delete this.idsToUrls[e];delete this.overlays[e];delete this.placeholderImages[e];require("webnode2").unloadComponent(n.cid);o.forgetContents();o.remove();if(s){s.attr("height",0);s.attr("width",0);s.attr("embed_detected",0);i._qed.modify(function(){s.remove()});i.updateEmbedComponentPositions()}if(t){n.handleDeleted()}this.editor.focus()},getEmbedComponents:function(e){$.each(this.embedComponents,e)},getGuid:function(){var e=i.guid();return e.replace(/\./g,"")},handleLinkAdded:function(e){var t=this;var i=e.url;if(i in t.seenUrls){return}var n=t.getGuid();t.seenUrls[i]=n;t.idsToUrls[n]=i;var o="embed_component_from_preview";var s={preview:e};t.createAndPopulateOverlay(n,o,s)},createAndPopulateOverlay:function(e,t,i,n){var o=this;var s=o.createOverlay(e);o.$("#@spinner").show();o.serverCall(t).success(function(){o.$("#@spinner").hide()}).error(function(){o.$("#@spinner").hide();if(n){n.remove()}}).contentFor(s,{parentCID:o.cid,useLoadingSpinner:false}).kwargs(i).send()},markEmbedAsDetected:function(e){e.attr("embed_detected",this.last_embed_update)},updateEmbedDetectedAttr:function(){var e=this;var t=this.last_embed_update;this.last_embed_update=+new Date;this.$("#@editor img").each(function(i,n){n=$(n);if(n.attr("type")!=="embed"){return}if(n.attr("embed_detected")==t){e.markEmbedAsDetected(n)}})},detectNewPlaceholderImages:function(){var e=this;this.$("#@editor img").each(function(t,i){i=$(i);if(i.attr("type")!=="embed"){return}if(i.attr("embed_detected")==e.last_embed_update){return}var n=i.attr(e.url_attr_name);var o;var s=e.seenUrls[n];if(s){o=e.idsToUrls[s];if(o){i.remove();setTimeout(function(){e.updateEmbedComponentPositions()},0);return}}else{s=e.getGuid()}i.attr("id",e.imageId(s));e.markEmbedAsDetected(i);e.placeholderImages[s]=i;var r=JSON.parse(i.attr(e.embed_data_attr_name));if(n){o=n}else{o=r.url}e.seenUrls[o]=s;e.idsToUrls[s]=o;var a="embed_component_from_client_embed_data";var l={url:o,embed_data:r};e.createAndPopulateOverlay(s,a,l,i)})},updateEmbedComponentPositions:function(){var e=this;e.getEmbedComponents(function(t,i){e.updateEmbedComponentPosition(t,i)})},updateEmbedComponentPosition:function(e,t){if(t.positionUpdated){var i=this.getImage(e);var n=$(i).offset();var o=this.embedEditorDiv.offset();var s=n.left-o.left;var r=n.top-o.top;var a=this.getOverlay(e);var l=this.editor.width();t.positionUpdated(a,s,r,l)}},registerEmbedComponent:function(e,t,i){var n=this;var o=n.seenUrls[t];n.embedComponents[o]=e;var s=this.placeholderImages[o];if(s&&!n.isInEditor(s)){this.getOverlay(o).hide();setTimeout(function(){n.deleteComponent(o,true)},0);return}if(!s){n.createPlaceholderImage(o,t)}n.setImageEmbedDataAttr(o,i);n.updatePlaceholderImageSize(o);if(!s){n.insertPlaceholderImage(o)}n.updateEmbedComponentPosition(o,e);e.initializeEmbedComponent(o,n.getImage(o),n.getOverlay(o));n.updateEmbedComponentPositions()},createOverlay:function(e){var t=$("<div>",{id:this.overlayId(e)});t.addClass("embed_overlay");this.embedEditorDiv.append(t);this.overlays[e]=t;return t},createPlaceholderImage:function(e,t,i){var n=this;var o={src:n.spacerUrl,id:n.imageId(e),type:"embed"};o[n.url_attr_name]=t;var s=$("<img>",o);s.css("margin","0").css("padding","0").css("border","none");n.markEmbedAsDetected(s);n.markImageAsDetected(s[0]);if(i){i(s)}this.placeholderImages[e]=s},insertPlaceholderImage:function(e){var t=this.getImage(e);var i=$("<div>");i.append(t);this._qed.modify(function(e){var t=e.parentNode;if(t){t.insertBefore(i[0],e)}})},addImage:function(e){var t=this;var i=new Image;i.onload=function(){t.updateEmbedComponentPositions();$(i).remove()};i.src=e;var n=this._super.apply(this,arguments);return n},updatePlaceholderImageSize:function(e,t,i){var n=this.getOverlay(e);var o=this.getImage(e);t=t?t:n.height();i=i?i:n.width();o.attr("height",t);o.attr("width",i)},setImageEmbedDataAttr:function(e,t){var i=this.getImage(e);i.attr(this.embed_data_attr_name,t)},notifySubmit:function(){}});exports.EmbedComponentBase=e.extend({registerWithParent:function(e,t){this.parent().registerEmbedComponent(this,e,t)},initializeEmbedComponent:function(e,t,i){this.id=e;this.img=t;this.overlay=i},dataChanged:function(e){this.setImageEmbedDataAttr(e);this.updatePlaceholderImageSize();this.parent().updateEmbedComponentPositions()},setImageEmbedDataAttr:function(e){this.parent().setImageEmbedDataAttr(this.id,e)},componentDeleted:function(){this.parent().deleteComponent(this.id,false)},updatePlaceholderImageSize:function(){var e=this.overlay.height();var t=this.overlay.width();if(this.previous_height!==e||this.previous_width!==t){this.parent().updatePlaceholderImageSize(this.id,e,t);this.previous_height=e;this.previous_width=t;
}},positionUpdated:function(e,t,i,n){e.css("position","absolute").css("left",t).css("top",i).css("width",n)},handleDeleted:function(){}});exports.QuestionWizardQTextEditor=h.extend({onLoad:function(){this._super.apply(this,arguments)},editorInputChange:function(){this._super.apply(this,arguments);if(this.parent().onEditorInputChange){this.parent().onEditorInputChange()}}})},{"qed/edit":true,"view/fixable2":true,webnode2:true,assert:true,"qed/modifiers":true,atexit:true,"qed/npd":true,linkify:true,"qed/util":true,"w2.quora":true,spin:true,find:true,"w2.rpc":true,browser:true});require.install("app/view/question",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("cookies"),n=require("window_manager"),o=require("view/modal").Base,s=require("views").viewsLogger,r=require("mathify").renderMath,a=require("view/inline_editor").InlineEditor,l=require("qtexteditor").QTextEditor,u=require("w2.context");exports.QuestionMain=e.extend({onLoad:function(e){if(e&&this.record_impression){setTimeout(this.fnbind(function(){this.serverCall("record_impression").send()}),1e3)}},onUnload:function(){this.uninstallScrollHandlers()}});exports.QuestionLink=e.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){i.setQfeedLog(this,"QuestionClickthrough");i.setQueryLog(this,"QuestionClickthrough")}));this.onKeyCombination(this.$("#@link"),"o",this.fnbind(function(){n.navigateTo(this.$("#@link").attr("href"));return false}));r("@link")}});exports.NewUserSendNotif=e.extend({init:function(){this._super.apply(this,arguments);this.seen=false;this.notif_bottom=false;this.idleTime=1;this.noActivity=false;var e=$(document).find(".answer_wrapper").get();this.answersLocation=[];for(var t=0;t<e.length;t++){var i=$(e[t]);this.answersLocation.push(i.offset().top+i.height())}var n=this;$(document).bind("nux_dialog_close",function(){n.installScrollHandlers(n.fnbind(n.scrollHandler));if(n.delay===true){n.delay=false;n.maybeSendNotif()}if(n.delay){window.setTimeout(function(){n.maybeSendNotif()},n.delay*1e3)}if(n.no_activity){window.setInterval(function(){n.idleTime=n.idleTime+1;if(n.idleTime>n.no_activity){n.noActivity=true}},1e3);$(this).mousemove(function(e){n.onUserActivity()});$(this).keypress(function(e){n.onUserActivity()})}})},onUserActivity:function(){if(this.noActivity){this.maybeSendNotif();this.noActivity=false}this.idleTime=0},maybeSendNotif:function(){if(!this.seen){this.seen=true;this.serverCall("send_go_home_notif").kwargs({}).send()}},maybeSendNotifBottom:function(){if(!this.notif_bottom){this.notif_bottom=true;this.serverCall("send_go_home_notif_double").kwargs({}).send()}},hitBottomHandler:function(){var e=$(window).scrollTop();var t=$(document).height();var i=$(window).height();if(e+i==t){if(this.double_notif){this.maybeSendNotifBottom()}else{this.maybeSendNotif()}}},answerReadHandler:function(){var e=$(window).scrollTop();var t=0;for(var i=0;i<this.answersLocation.length;i++){if(e>this.answersLocation[i]){t=t+1}}if(t>=this.answer_read){this.maybeSendNotif()}},scrollHandler:function(){var e=$(window).scrollTop();if(this.hit_bottom||this.double_notif){this.hitBottomHandler()}if(this.answer_read){this.answerReadHandler()}if(this.on_scroll){if(e>200){this.maybeSendNotif()}}},onUnload:function(){this.uninstallScrollHandlers()}});exports.RelatedQuestionsList=e.extend({onLoad:function(){this.recordStep(["rq_impression","rq_impression_repeated"])},recordStep:function(e){this.serverCall("record_step").kwargs({steps:e}).send()}});exports.RelatedQuestionLink=require("action_log").ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$("#@actionable").mousedown(e.fnbind(function(){e.recordStep("related_question_click")}))},recordStep:function(e){this.serverCall("record_step").kwargs({step_name:e}).send()}});exports.QuestionArea=e.extend({contextConstructor:function(){return u.QuestionArea},onLoad:function(){var e=this;this._super.apply(this,arguments);e.questionIsOverLimit=false;e.detailIsOverLimit=false;e.questionAreaContext=e.getContext(u.QuestionArea);e.questionAreaContext.on("editClicked",e.editLinkClicked.bind(e));e.questionAreaContext.on("cancelClicked",e.cancelLinkClicked.bind(e));e.$("#@question_update").click(function(t){t.preventDefault();e.questionAreaContext.set("triggerRequest");e.$("#@details_container").addClass("hidden");e.questionAreaContext.set("showActionBar",true)});e.$("#@question_cancel").click(function(t){t.preventDefault();e.questionAreaContext.set("triggerCancel");e.$("#@details_container").addClass("hidden");e.questionAreaContext.set("showActionBar",true)})},editLinkClicked:function(){this.$("#@details_container").removeClass("hidden");this.questionAreaContext.set("showActionBar",false)},cancelLinkClicked:function(){this.$("#@details_container").addClass("hidden");this.questionAreaContext.set("showActionBar",true)},enableSubmitButton:function(e){var t=this.$("#@question_update");if(this.questionIsOverLimit||this.detailIsOverLimit){t.addClass("disabled")}else{if(e){t.removeClass("disabled")}else{t.addClass("disabled")}}}});exports.QuestionTextInlineEditor=a.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);e.questionAreaContext=e.getContext(u.QuestionArea);if(e.questionAreaContext){e.questionAreaContext.on("triggerRequest",e.trigger_request.bind(e));e.questionAreaContext.on("triggerCancel",e.trigger_cancel.bind(e));e.questionAreaContext.on("editClicked",e.toggle_editor.bind(e));e.questionAreaContext.on("cancelClicked",e.toggle_editor.bind(e))}},onEditLinkClick:function(){this.questionAreaContext.set("editClicked")},cancelEditor:function(){this._super.apply(this,arguments);this.questionAreaContext.set("cancelClicked")}});exports.QuestionTextAndDetailsEditor=e.extend({onLoad:function(){var e=this;e.questionIsOverLimit=false;e.detailIsOverLimit=false;e.$("#@question_update").click(function(t){t.preventDefault();e.lookup("edit_title").trigger_request();e.lookup("edit_details").trigger_request();e.$("#@details_container").addClass("hidden");e.$("#@answer_container").removeClass("hidden")});e.$("#@question_cancel").click(function(t){t.preventDefault();e.lookup("edit_title").trigger_cancel();e.lookup("edit_details").trigger_cancel();if(e.lookup("question_details",true)){e.lookup("question_details").trigger_cancel()}e.$("#@details_container").addClass("hidden");e.$("#@answer_container").removeClass("hidden")})},editLinkClicked:function(){this.$("#@details_container").removeClass("hidden");this.$("#@answer_container").addClass("hidden");this.lookup("edit_details").startEditing();this.lookup("edit_title").startEditing()},cancelLinkClicked:function(){this.$("#@details_container").addClass("hidden");this.$("#@answer_container").removeClass("hidden");this.lookup("edit_details").toggle_editor()},enableSubmitButton:function(e){var t=this.$("#@question_update");if(this.questionIsOverLimit||this.detailIsOverLimit){t.addClass("disabled")}else{if(e){t.removeClass("disabled")}else{t.addClass("disabled")}}}});exports.QuestionDetailsQTextEditor=l.extend({updateButton:function(e){var t=this.lookup("question_main_editor");if(e){t.detailIsOverLimit=true;t.enableSubmitButton(false)}else{t.detailIsOverLimit=false;t.enableSubmitButton(true)}}});exports.QuestionQTextEditor=l.extend({updateButton:function(e){var t=this.lookup("question_main_editor");if(e){t.questionIsOverLimit=true;t.enableSubmitButton(false)}else{t.questionIsOverLimit=false;t.enableSubmitButton(true)}}});exports.QuestionDeleteLink=e.extend({onLoad:function(){var e=this;this.$("#@delete_question_link").click(function(){$(".ContentWrapper").dialog({title:e.delete_title,contents:e.delete_content,buttons:{Ok:function(){e._request("delete_question")},Cancel:null}});return false});this.$("#@undelete_question_link").click(function(){$(".ContentWrapper").dialog({title:e.undelete_title,contents:e.undelete_content,buttons:{Ok:function(){e._request("undelete_question")},Cancel:null}});return false})},_request:function(e){this.serverCall(e).kwargs({qid:this.qid}).liveMutate().send()}});exports.QuestionDeleteDialog=require("dialog").AddCommentDialog.extend({getPars:function(){if(this.comment_required&&this.lookup("editor").isEmpty()){return false}return{comment:this.lookup("editor").serialize(),review:this.review}}});function d(e){var t=$(window).scrollTop();var i=$(".header").outerHeight();e=e.top-i;if(e<t||t===0){$(window).scrollTop(e)}return}exports.AnswerActions=e.extend({contextConstructor:function(){return u.AnswerVoteContext}});exports.AnswerPermaLink=e.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){i.setQfeedLog(this,"AnswerClickthrough");i.setQueryLog(this,"AnswerClickthrough")}));if(this.tooltip){this.$("#@link").tooltip({contents:this.tooltip})}}});exports.AnswerUndeleteBanner=e.extend({onLoad:function(){var e=this;e.$("#@answer_undelete").click(function(t){e.modal("load_answer_delete_modal").onSubmitCallBack(function(){e.serverCall("unremove_answer").kwargs({aid:e.aid}).liveMutate().send()})})}});exports.AnswerUndeleteModal=o.extend({onSubmit:function(){this._super.apply(this,arguments);t.Modal.modalFor(this).executeOnSubmitCallBack()}});exports.AnswerAddInstructions=e.extend({onLoad:function(){this.$("#@view_deleted_answer").click(this.fnbind(function(){this.$("#@deleted_answer").toggleClass("hidden");return false}))}});exports.CreateAnswerWikiLink=e.extend({onLoad:function(){this.$("#@create_answer_wiki").click(this.fnbind(function(e){$("#answer_wiki").toggleClass("hidden");e.preventDefault()}))}});exports.AnswerListDiv=e.extend({onLoad:function(){this.header_height=$(".SiteHeader").outerHeight();this.offset=15;this.$("#@answers_anchor").css("top","-"+this.header_height+"px");if(window.location.hash=="#answers"){$(window).scrollTop(this.$("#@answers_anchor").offset().top)}},onUnload:function(){this.uninstallScrollHandlers()},show:function(){this.$("#@collapsed").show()}});exports.QuestionAnswerMain=e.extend({onLoad:function(e){if(e){setTimeout(this.fnbind(function(){this.serverCall("record_impression").send()}),1e3)}this.recordStep("share_impression")},recordStep:function(e){this.serverCall("record_step").kwargs({step_name:e}).send()}});exports.ReviewPageEditTopicLink=e.extend({onLoad:function(){this.$("#@edit_topic").click(this.fnbind(function(){this.openDialog();return false}))},openDialog:function(){this._dialog=this.dialog().title(this.edit_text).load("content")},closeDialog:function(){this._dialog.close_()}});exports.ReviewPageEditTopicDialog=e.extend({onLoad:function(){this.submitted=false;this.$("#@cancel").click(this.fnbind(function(){this.closeDialog();return false}));this.$("#@edit").click(this.fnbind(function(){var e=this.getContextName();if(e&&!this.submitted){this.submitted=true;this.editTopic(e)}return false}))},editTopic:function(e){this.closeDialog();this.serverCall("edit_topic").kwargs({topic_name:e}).liveMutate().send()},getContextName:function(){var e=this.cQuery(":context.topic_add").getTempTopicNamesAsArray();if(e.length>0){return e[0]}else{return null}},closeDialog:function(){t.Dialog.openerFor(this).closeDialog()}});var c=exports.StarRatingButtons=e.extend({onLoad:function(){var e=this;var t=this.$("#@ratings").attr("class");$.each(this.$("%@rating"),function(i,n){$(this).attr("title","");$(this).hover(function(){t=e.$("#@ratings").attr("class");e.$("#@ratings").removeClass();var i=$(this).attr("rating");e.$("#@ratings").addClass("current_rating_"+i)},function(){e.$("#@ratings").attr("class",t)});$(this).click(function(){e.$("#@ratings").removeClass();var i=$(this).attr("rating");e.$("#@ratings").addClass("current_rating_"+i);t="current_rating_"+i;return false})})}});exports.ReviewQuestionTextMain=e.extend({onLoad:function(){var e=this;this.$("#@edit").click(this.fnbind(function(){e.$("#@name").hide();e.$("#@selector").show()}))}});exports.TopicReviewRatingLabel=e.extend({onLoad:function(e){this.$("#@request").click(this.fnbind(function(){this.requestReviews();return false}))},requestReviews:function(){if(!this.submitted){this.submitted=true;this.serverCall("request_reviews").success(this.fnbind(function(e){if(e[0]=="/"){document.location=e}})).liveMutate().send()}}});exports.AnswerPagingCompleteIndicator=e.extend({onLoad:function(){if(this.show_content_page_feed){setTimeout(this.fnbind(this.showContentPageFeed),0)}},showContentPageFeed:function(){var e=this.lookup("content_page_feed");if(e){e.show()}else{setTimeout(this.fnbind(this.showContentPageFeed),250)}}});exports.AttachDisclaimerLink2=e.extend({onLoad:function(){this.$("#@add_disclaimer_link").click(this.fnbind(function(){this._dialog=this.dialog().title(this.create_disclaimer_title).load("set_disclaimer_dialog");return false}))}});exports.AnswerPagedListItem=e.extend({onLoad:function(){s.addComponentToTrack(this)}})},{cookies:true,window_manager:true,views:true,webnode2:true,"view/modal":true,"w2.context":true,qtexteditor:true,dialog:true,"view/inline_editor":true,mathify:true,action_log:true,"w2.quora":true});require.install("app/view/question/wanted_answer",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base,i=require("cookies");exports.AskToAnswerButton=e.extend({onLoad:function(){this.$("#@spend").click(this.fnbind(function(){i.setQfeedLog(this,"AskToAnswer");i.setTlog({type:"AskToAnswer",qid:this.qid});this.serverCall("spend").liveMutate().send();require("action_log").logPrimaryAction("AskToAnswer",{type:this.impression_type,hash:this.impression_hash});return false}));this.$("#@undo").click(this.fnbind(function(){this.serverCall("undo").liveMutate().send();require("action_log").logPrimaryAction("UndoAskToAnswer",{type:this.impression_type,hash:this.impression_hash});return false}))}});exports.WantedAnswerDecline=e.extend({onLoad:function(){this.$("#@ignore").click(this.fnbind(function(){if(this.allow_reason){this.showIgnoreReasonDialog()}else{this.serverCall("decline").liveMutate().send()}return false}))},showIgnoreReasonDialog:function(){this._dialog=this.dialog().title("Decline Request").load("decline_dialog")}});exports.DeclineRequestDialog=e.extend({onLoad:function(){this.lookup("editor").focus();this.$("#@give").click(this.fnbind(function(){var e="";if(!this.lookup("editor").isEmpty()){e=this.lookup("editor").serialize()}this.serverCall("decline").kwargs({reason:e}).liveMutate().success(this.fnbind(function(){require("webnode2").Dialog.dialogFor(this).close_()})).send();return false}));this.$("#@close").click(this.fnbind(function(){require("webnode2").Dialog.dialogFor(this).close_();return false}))}});exports.QuestionPageA2APreview=e.extend({onLoad:function(){var e=this;var t=e.$("#@a2a_facepile");e.serverCall("facepile").kwargs({}).contentFor(t,{parentCID:e.cid}).send()}});exports.A2AFiltersListContentItem=e.extend({onLoad:function(){var e=this;e.$("#@filter_item").click(function(t){var i=t.currentTarget;e.parent().$(".A2AFiltersListContentItem").removeClass("nav_item_selected");$(i).addClass("nav_item_selected");var n=e.parent().parent().parent().ge("@suggestions_list");var o=e.parent().parent();if(o.is_editing){return}$(n).addClass("working");e.serverCall("filtered_list").kwargs({tid:e.tid}).contentFor($(n),{parentCID:e.cid}).success(function(){$(n).removeClass("working")}).send()})}});exports.WantedAnswerSuggestions=e.extend({onLoad:function(){this.$("#@search_link").click(this.fnbind(function(e){this.showSearch();return false}))},showSearch:function(){this.$("#@search_link_container, #@people_selector").toggle();this.lookup("selector").focus(true)},setTo:function(e,t){var n=this;i.setQfeedLog(this,"AskToAnswer");i.setTlog({type:"AskToAnswer",qid:this.qid});this.serverCall("ask_to_answer").liveMutate().kwargs({to_uid:e}).success(function(e){if(n.show_outstanding_requests_after_request_made){n.lookup("header").countClicked()}if(e.result==="error"){n.revertSelectedRow(t)}}).error(function(){n.revertSelectedRow(t)}).send()},revertSelectedRow:function(e){e.children(".text_col.hidden").removeClass("hidden");e.children(".text_col.asked").addClass("hidden");e.children(".ask_button_column").removeClass("hidden")},a2aHeaderCountClicked:function(){this.$("#@a2a_suggestions").hide();this.$("#@outstanding_requests").show()},a2aHeaderTitleClicked:function(){this.$("#@a2a_suggestions").show();this.$("#@outstanding_requests").hide()}});exports.AskToAnswerModal=t.extend({a2aHeaderCountClicked:function(){var e=this.child("wanted_answer_suggestions");e.$("#@a2a_suggestions").hide();e.$("#@outstanding_requests").show()},a2aHeaderTitleClicked:function(){var e=this.child("wanted_answer_suggestions");e.$("#@a2a_suggestions").show();e.$("#@outstanding_requests").hide()}});exports.AskToAnswerHeader=e.extend({onLoad:function(){this.$("#@title_link").click(this.fnbind(function(e){this.titleClicked();return false}));this.$("#@count_link").click(this.fnbind(function(e){this.countClicked();return false}))},countClicked:function(){this.$("#@count, #@count_link, #@title, #@title_link").toggle();this.parent().a2aHeaderCountClicked()},titleClicked:function(){this.$("#@count, #@count_link, #@title, #@title_link").toggle();this.parent().a2aHeaderTitleClicked()}});exports.AskToAnswerModalLink=e.extend({onLoad:function(){var e=this;this.$("#@create_modal_link").click(this.fnbind(function(){e.modal("load_inner");return false}))}});exports.AskedBy=e.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.$("#@modal_link").click(this.fnbind(function(){e.modal("load_inner");return false}))}});exports.WantedAnswersSuggestionsPagedList=require("view/paged_list").PagedList.extend({onLoad:function(){this._super.apply(this,arguments);this.container=$(".modal_wrapper")}})},{cookies:true,webnode2:true,"view/modal":true,"view/paged_list":true,"w2.quora":true,action_log:true});require.install("app/view/question/cant_answer",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies");exports.CantAnswerLink=e.extend({onLoad:function(){var e=this;var i;var n;var o=false;if(this.lookup("item")){o=true;i=this.lookup("item");n=i.$("#@item")}this.$("#@cant_answer").on("click",function(){if(o){var i=n.find($(".WantedAnswerWithCreditQuestionListItem")).length;if(!i){t.setQfeedLog(e,"QuestionPass")}var s;if(i){s=".PagedListItem"}else{s=".feed_item_inner"}var r=n.find($(s));var a=r.children(".ShowOnPass");var l;if(i){l=r.find(".question_link").parent().parent()}else{if(require("gating").feed_edit_question){l=r.find(".ActionableWrapperQuestionText").parent().parent()}else{l=r.find(".ActionableWrapperQuestionText").parent()}}var u=$.merge(a,l);var d=r.find(".question_details");var c=$.merge(r.children().not(u),d);n.find(".reason_detail").animate({height:0,opacity:0});n.addClass("cant_answer");c.animate({opacity:0});var h=n.find(".MarkedAsCantAnswerMessage").height();var f=n.find(".question_link").height();var p=n.find(".CantAnswerActionBar").height();var g=h+f+p;n.animate({height:g});c.promise().done(function(){c.addClass("hidden")})}e.cantAnswer();return false})},cantAnswer:function(){this.serverCall("mark_as_cant_answer").liveMutate().send();return false}});exports.AMACantAnswerLink=exports.CantAnswerLink.extend({onLoad:function(){var e=this;this.$("#@cant_answer").on("click",function(){e.cantAnswer();return false})}});exports.A2ACantAnswerLink=e.extend({onLoad:function(){var e=this;var t;var i;var n=false;if(this.lookup("item")){n=true;t=this.lookup("item");i=t.$("#@item")}this.$("#@cant_answer").on("click",function(){if(n){var t=i.find($(".PagedListItem"));var o=t.children(".ShowOnPass");var s=t.find(".question_link").parent().parent();var r=$.merge(o,s);var a=t.children().not(r);i.find(".reason_detail").animate({height:0,opacity:0});i.addClass("cant_answer");a.animate({opacity:0});var l=i.find(".MarkedAsCantAnswerMessage").height();var u=i.find(".question_link").height();var d=i.find(".CantAnswerActionBar").height();var c=l+u+d;i.animate({height:c});a.promise().done(function(){a.addClass("hidden")})}e.decline();return false})},decline:function(){this.serverCall("decline").liveMutate().send();return false}});exports.A2ACantAnswerReasonLink=e.extend({onLoad:function(){var e=this;this.$("#@a2a_cant_answer").click(function(){if(e.allow_reason){e.showIgnoreReasonDialog()}return false})},showIgnoreReasonDialog:function(){this._dialog=this.dialog().title(this.pass_text).load("decline_dialog")}});exports.A2ACantAnswerReasonDialog=e.extend({onLoad:function(){this.lookup("editor").focus();var e=this;this.$("#@give").click(function(){var t="";if(!e.lookup("editor").isEmpty()){t=e.lookup("editor").serialize()}e.serverCall("attach_decline_reason").kwargs({reason:t}).liveMutate().success(function(){require("webnode2").Dialog.dialogFor(e).close_()}).send();return false});this.$("#@close").click(function(){require("webnode2").Dialog.dialogFor(e).close_();return false})}});exports.UndoCantAnswerLink=e.extend({onLoad:function(){var e=this;var t;var i;var n=false;if(this.lookup("item")){n=true;t=this.lookup("item");i=t.$("#@item")}this.$("#@undo_cant_answer").on("click",function(){if(n){var t=i.find($(".WantedAnswerWithCreditQuestionListItem")).length;var o;if(t){o=".PagedListItem"}else{o=".feed_item_inner"}i.removeClass("cant_answer");var s=i.find($(o));var r=s.children(".ShowOnPass, .edit_area");var a;if(t){a=s.find(".question_link").parent().parent()}else{a=s.find(".ActionableWrapperQuestionText").parent()}var l=s.find(".question_details");var u=$.merge(s.children().not(r),l);i.find(".EventHeader, .reason_detail").height("auto");i.height("auto");u.removeClass("hidden");i.find(".EventHeader, .reason_detail, .edit_area").animate({opacity:100});u.animate({opacity:100})}e.undoCantAnswer();return false})},undoCantAnswer:function(){this.serverCall("undo_mark_as_cant_answer").liveMutate().send();return false}})},{webnode2:true,cookies:true,gating:true,"w2.quora":true});require.install("app/view/question/merge/_merge",function(require,exports,module){var e=require("w2.quora").Component;exports.QuestionMergeCandidates=e.extend({onLoad:function(){var e=this;e.$insertionEl=e.$("#@insert_candidate");e.$showAllLinkEl=e.$("#@show_all_link");e.$showAllLinkEl.click(function(t){t.preventDefault();e.$("#@candidates .candidate").removeClass("hidden");e.$showAllLinkEl.addClass("hidden")})},selectQID:function(e){var t=this,i=t.$("#@candidates input[type=checkbox][value="+e+"]");if(i.length){i.map(function(){var e=$(this),i=$("label[for='"+e.attr("id")+"']");e.attr("checked",true);e.change();i.insertAfter(t.$insertionEl);i.removeClass("hidden")})}else{t.serverCall("get_checkbox_content").kwargs({qid:e}).contentFor(t.$insertionEl,{parentCID:t.cid}).success(function(){t.$insertionEl.children().map(function(){$(this).insertAfter(t.$insertionEl)})}).send()}},getSelectedQIDs:function(){var e=[];this.$("#@candidates input[type=checkbox]:checked:not(:disabled)").map(function(){e.push(parseInt(this.value))});return e}});exports.QuestionMergeCanonicalPicker=e.extend({onLoad:function(){var e=this;e.$radios=e.$("#@picker input[type=radio]");e.$radios.change(function(t){e.$radios.map(function(){var e=$(this),t=$("label[for='"+e.attr("id")+"']");t.toggleClass("selected",e.is(":checked"));t.toggleClass("not_selected",!e.is(":checked"))})})},getSelectedQID:function(){var e=this.$("#@picker input[type=radio]:checked");if(e){return parseInt(e.val())}}});exports.OriginallyAnsweredBanner=e.extend({onLoad:function(){var e=this;e.$("#@remove").click(function(t){t.preventDefault();e.serverCall("remove_banner").liveMutate().send()})}})},{"w2.quora":true});require.install("app/view/question/merge/selector",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/selector").Selector;exports.QuestionMergeESSelector=t.extend({resultWasSelected:function(e){var t=this;t.parent().child("candidates").selectQID(e.data.qid);t.setQuery("")},getExtraKwargs:function(){return{ignore_qids:this.parent().child("candidates").getSelectedQIDs()}}})},{"view/selector":true,"w2.quora":true});require.install("app/view/question/merge/modal",function(require,exports,module){var e=require("window_manager"),t=require("view/modal");exports._QuestionMergeModal=t.MultiStep.extend({onSubmitSuccess:function(t,i,n,o){var s=this;var r=25e3;var a=1e3;if(o<r){setTimeout(s.fnbind(function(){s.serverCall("answer_has_moved").kwargs({qids:i,canonical_qid:n,time_so_far:o+a}).success(function(o){if(o){s.onSubmitSuccess(t,i,n,o)}else{e.navigateTo(t)}}).send()}),a)}else{s.serverCall("log_timeout_before_answers_moved").kwargs({time_taken:o+a}).send();e.navigateTo(t)}},getCallBacks:function(){var e=this;return{QuestionMergeModalSelectorStep:{getStepData:function(){var t=e.data_cache[e.key];var i=e.child("candidates").getSelectedQIDs();i.push(t.qid);return $.extend(t,{selectedQIDs:i})},onSubmit:function(){if(e.child("candidates").getSelectedQIDs().length){e._loadNext()}}},QuestionMergeModalCanonicalStep:{isLastStep:true,onSubmit:function(){var t=e.child("picker").getSelectedQID(),i=e.data_cache.QuestionMergeModalSelectorStep;if(t){e.disableSubmit();var n=i.selectedQIDs;e.serverCall("submit").kwargs({qids:n,canonical_qid:t}).success(function(i){e.onSubmitSuccess(i,n,t,0)}).liveMutate().send()}}}}}})},{"view/modal":true,window_manager:true});require.install("app/view/board",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies");exports.BoardMuteLink=e.extend({onLoad:function(){this.$("#@board_mute_link").click(this.fnbind(function(){this.serverCall("mute").kwargs({bid:this.bid}).liveMutate().send()}))}});exports.BoardUnmuteLink=e.extend({onLoad:function(){this.$("#@board_unmute_link").click(this.fnbind(function(){this.serverCall("unmute").kwargs({bid:this.bid}).liveMutate().send()}))}});exports.BoardNameLink=e.extend({onLoad:function(e){this.$("#@link").mousedown(this.fnbind(function(){t.setQfeedLog(this,"BoardClickthrough");t.setQueryLog(this,"BoardClickthrough")}))}});exports.BoardSelectorWrapper=e.extend({onLoad:function(){this.cQuery(":selector").$("#@input").bind("focus",this.fnbind(function(e){this.removeBoardMissingError()}))},addMissingBoardError:function(){this.cQuery(":selector").$("#@input").addClass("input_validation_error");this.$("#@no_board_error").show()},removeBoardMissingError:function(){this.cQuery(":selector").$("#@input").removeClass("input_validation_error");this.$("#@no_board_error").hide()}})},{cookies:true,"w2.quora":true});require.install("app/view/board/blog",function(require,exports,module){var e=require("w2.quora").Component;exports.CreateBlog=e.extend({onLoad:function(){this.submitted=false;this.$("#@name").focus();this.$("#@fake_editor").click(this.fnbind(function(){this.$("#@fake_editor_row").hide();this.$("#@editor_row").show();this.lookup("editor").focus();return false}));this.$("#@create").click(this.fnbind(function(){var e=this.$("#@name").val();var t=this.lookup("subdomain").getInput().val();if(!e){this.$("#@name").addClass("input_validation_error");this.$("#@name").focus()}else{this.$("#@name").removeClass("input_validation_error")}if(!t){this.lookup("subdomain").getInput().addClass("input_validation_error");if(e){this.lookup("subdomain").getInput().focus()}}else{this.lookup("subdomain").getInput().removeClass("input_validation_error")}if(t&&e&&this.lookup("subdomain").urlIsOK&&!this.submitted){this.$("#@create").addClass("submit_button_disabled");this.submitted=true;var i=this.lookup("editor").serialize();this.disable();this.serverCall("create").kwargs({name:e,description:i,url:t,topics:""}).success(this.fnbind(function(e){if(e){document.location=e}})).liveMutate().send()}return false}))},disable:function(){this.$("#@name").addClass("qtext_editor_content_disabled");this.lookup("subdomain").getInput().addClass("qtext_editor_content_disabled");this.lookup("editor").disable()}})},{"w2.quora":true});require.install("app/view/board/create_box",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("view/inline_editor").InlineEditor,n=require("input_validate").InputValidator,o=require("w2.context");exports.BoardCreatePostBox=e.extend({onLoad:function(){if(this.$("#@twitter_label")){this.$("#@twitter_label").tooltip({contents:this.twitter_share_text})}this.$("#@add_topics").click(this.fnbind(function(){this.$("#@edit_topics").show();this.$("#@add_topics").hide();if(this.lookup("topic_selector")){this.lookup("topic_selector").focus(true)}return false}));this.$("#@twitter_icon").click(this.fnbind(function(){if(this.$("#@twitter").is(":checked")){this.uncheckTwitter()}else{this.checkTwitter()}return false}));if(this.set_tabindex){var e=this.lookup("title_box",true);if(e){this.cQuery(":title_box.title_editor").$("#@editor").attr("tabindex",2)}this.cQuery(":editor.editor").$("#@editor").attr("tabindex",3);if(this.lookup("topic_selector")){this.lookup("topic_selector").$("#@input").attr("tabindex",4)}}},hideDistroOptions:function(){this.uncheckTwitter();this.$("#@distro_options").hide();this.$("#@add_topics_link").hide()},showDistroOptions:function(){this.$("#@distro_options").show();this.$("#@add_topics_link").show()},reset:function(){this.uncheckTwitter();this.$("#@edit_topics").hide();this.$("#@add_topics").show();if(this.lookup("topic_selector")){this.lookup("topic_selector").reset()}},uncheckTwitter:function(){this.$("#@twitter").attr("checked",false)},checkTwitter:function(){this.$("#@twitter").attr("checked",true)}});exports.BoardCreatePostTitleBox=e.extend({onLoad:function(){this.$("#@fake_editor").click(this.fnbind(function(){this.toggle_editor();return false}));this.lookup("title_editor").focus()},toggle_editor:function(){this.$("#@fake_editor_row").hide();this.$("#@editor_row").show();this.$("#@editor_row .qtext_editor_content").focus()},titleRequired:function(){this.$("#@title_required").show()},titleRequiredReset:function(){this.$("#@title_required").hide()}});exports.CreateBoardPostEditor=i.extend({contextConstructor:function(){return o.Editor},onLoad:function(){var e=this;this._super.apply(this,arguments);this.editorContext=this.getContext(o.Editor);this.$("#@remove_via").click(this.fnbind(function(){this.$("#@via_text").hide();this.$("#@via").remove();return false}));this.fetchingUrl=false;this.seenUrls={};this.link_editor_location=":link_editor.preview";this.boardSelectorObj=null;if(!this.bid){this.boardSelectorObj=this.parent().cQuery(":selector.selector");this.boardSelectorObj.setCallback(function(){e.editor.reportMeaningfulChange()})}this.$("#@fake_editor").click(this.fnbind(function(){this.showEditor()}));var t=this.lookup("title_box",true);if(t){var i=t.child("title_editor");i.setMeaningfulChangeCallback(this.fnbind(function(){this.save_draft(false)}));if(this.saved_title){i.setHtml(this.saved_title,this.saved_title_qlink_data);i.html(false);t.toggle_editor()}}if(this.saved_seen_urls){for(var n=0;n<this.saved_seen_urls.length;n++){this.seenUrls[this.saved_seen_urls[n]]=true}}if(this.saved_topics){var s=this.cQuery(":topic_suggestions_selector.topic_add");s.whenOnLoaded(function(){for(var t=0;t<e.saved_topics.length;t++){s.saveTempTopic(e.saved_topics[t])}})}},showEditor:function(){this.$("#@fake_editor_wrapper").hide();this.$("#@content").show();this.editor.focus()},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){if(!this.editor.isEmpty()||(this.preview!==null||this.id)){if(this.parent().lookup("title_box",true)){this.parent().cQuery(":title_box").titleRequiredReset();if(this.parent().cQuery(":title_box.title_editor").isEmpty()){this.parent().cQuery(":title_box").toggle_editor();this.parent().cQuery(":title_box").titleRequired();return false}this.parent().cQuery(":title_box.title_editor").$("#@editor").addClass("qtext_editor_content_disabled")}this.editor.disable();this.$("#@preview_url").addClass("qtext_editor_content_disabled");n.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}})}return false}))},removeUrl:function(){this.$("#@preview_url").html("");this.$("#@preview_url_section, #@link_editor_buttons").hide();
this.$("#@remove_url").hide();this.preview=null;this.editor.focus()},reset:function(){var e;if(this.parent().lookup("title_box",true)){e=this.cQuery(":title_box.title_editor");e.$("#@editor").removeClass("qtext_editor_content_disabled");e.clear(false)}this.editor.enable();this.editor.clear(true);this.$("#@preview_url").removeClass("qtext_editor_content_disabled").hide();this.$("#@preview_url_section, #@link_editor_buttons").hide();this.$("#@remove_url").hide();this.seenUrls={};this.removeUrl();if(this.draft_space){this.draft_space.draft_id=null;this.editor.resetMeaningfulChange();if(e){e.resetMeaningfulChange()}}if(!this.is_submission){this.parent().reset()}if(!this.bid){this.boardSelectorObj.resetFakeInput()}},cancelEditor:function(){if(this.canSaveDraft()&&this.draft_space.draft_id!==null){this.save_draft(false)}this.closeDialog()},reportSuccess:function(){},ajax_callback:function(e){if(this.redirect_on_post&&e){document.location=e}else if(this.is_dialog){this.reportSuccess();this.closeDialog();return}else{this.reset()}},closeDialog:function(){t.Dialog.dialogFor(this).close_()},getBid:function(){return this.bid?this.bid:this.boardSelectorObj.getBid()||null},getBoardName:function(){return this.bid?null:this.boardSelectorObj.getText()},getVia:function(){return this.$("#@via")?this.$("#@via").val():null},getIsSubmission:function(){return this.is_submission},setIsSubmission:function(e){this.is_submission=e},getLinkURL:function(){var e=this.getLinkPreview();if(e){return e.url}return null},getLinkPreview:function(){if(this.preview){return this.cQuery(this.link_editor_location).getLinkInfo()}return null},getTopics:function(){if(this.lookup("topic_suggestions_selector",true)){return this.cQuery(":topic_suggestions_selector.topic_add").getTempTopicNamesAsArray()}return null},getTitle:function(){if(this.parent().lookup("title_box",true)){return this.parent().cQuery(":title_box.title_editor").serialize()}return null},getSeenUrlsAsArray:function(){var e=[];for(var t in this.seenUrls){e.push(t)}return e},getFacebookCheckbox:function(){return this.editorContext.get("shareToFacebook")},getTwitterCheckbox:function(){return this.editorContext.get("shareToTwitter")},getLoggedAction:function(){return"PostAdd"},invokeEditServerCall:function(e){if(this.getFacebookCheckbox()&&!require("facebook").hasPermission("publish_actions")){var t=arguments,i=this._super;require("facebook").requestPermissions("publish_stream",this.fnbind(function(e){i.apply(this,t)}))}else{this._super.apply(this,arguments)}},canSaveDraft:function(){return this.draft_space&&!this.save_draft_disabled},enableSaveDraft:function(){this.save_draft_disabled=false},disableSaveDraft:function(){this.save_draft_disabled=true},onClearDraft:function(){this.reset()},save_draft:function(e){if(!this.canSaveDraft()){return}this.disableSaveDraft();var i=e?"save_draft":"save_draft_auto",n=this.serverCall(i).kwargs({window_id:t.windowId,draft_space:this.draft_space,bid:this.getBid(),name:this.getBoardName(),description:this.get_value(),title:this.getTitle(),target:this.target,url:this.url,link_url:this.getLinkURL(),preview:this.getLinkPreview(),via:this.getVia(),tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),topics:this.getTopics(),seen_urls:this.getSeenUrlsAsArray(),is_submission:this.getIsSubmission()}).success(this.fnbind(function(e){this.enableSaveDraft();if(this.draft_space&&this.draft_space.draft_id!=e){this.draft_space.draft_id=e;var t=this.child("draft_status");if(t){t.updateWithDraftId(e)}}})).error(this.fnbind(function(){this.enableSaveDraft()}));if(e){n.liveMutate()}n.send()},_get_kwargs:function(){return{draft_space:this.draft_space,bid:this.getBid(),object_id:this.id,name:this.getBoardName(),description:this.get_value(),title:this.getTitle(),link_url:this.getLinkURL(),preview:this.getLinkPreview(),via:this.getVia(),tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),topics:this.getTopics(),is_submission:this.getIsSubmission(),fb_uid:require("facebook").getFbUid(),fb_access_token:require("facebook").getAccessToken(),fb_expires:require("facebook").getExpiresIn()}}})},{"w2.context":true,webnode2:true,input_validate:true,facebook:true,"view/inline_editor":true,"w2.quora":true});require.install("app/view/board/follow_invite",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings").interface_strings;var i=e.extend({setEmailTo:function(e){this._dialog=this.dialog().title(null).cancel(null,t.cancel).ok(this.fnbind(function(){var t=arguments[0].dialogComponent;var i=t.lookup("msg").serialize();var n=t.lookup("subject").serialize();var o=t.name;this.serverCall("invite_to_follow").kwargs({name:o,email:e,msg:i,subject:n}).liveMutate().success(this.fnbind(function(){this._dialog.close_();this.lookup("selector").clear()})).send()}),this.invite_text).load("invite_dialog",{kwargs:{email:e}})}});exports.FollowInviteSection=i.extend({setTo:function(e){this.setEmailTo(e)},setUserTo:function(e){}});exports.FollowInviteEmailButton=i.extend({onLoad:function(){this.$("#@invite").click(this.fnbind(function(){this.setEmailTo(this.email);return false}))}});exports.FollowInviteTwitterButton=e.extend({onLoad:function(){this.$("#@invite").click(this.fnbind(function(){this._dialog=this.dialog().title(null).cancel(null,t.cancel).ok(this.fnbind(function(){}),this.invite_text).load("invite_twitter_dialog",{kwargs:{tw_uid:this.tw_uid}});return false}))}});exports.InviteToFollowDialogContents=e.extend({onLoad:function(){this.lookup("msg").focus()}})},{settings:true,"w2.quora":true});require.install("app/view/topic",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies"),i=require("settings").interface_strings;exports.TopicAliases=e.extend({onLoad:function(){var e=this.fnbind(this.addAliasSubmit);this.$("#@topic_alias_add").click(e);this.$("#@topic_alias_add_form").submit(e);this.$("#@show_alias_link").click(this.fnbind(function(e){e.preventDefault();this.$("#@add_topic_alias").show();this.$("#@show_alias").hide();this.$("#@topic_alias_input").focus()}))},get_value:function(){return this.$("#@topic_alias_input").val()},addAliasSubmit:function(){this._request(this.get_value());return false},_request:function(e){if(!this.tid||!e){return false}this.serverCall("add_topic_alias").kwargs({tid:this.tid,alias:e}).success(this.fnbind(function(){this.$("#@topic_alias_input").val("");this.$("#@topic_alias_input").focus()})).liveMutate().send()}});exports.TopicAlias=e.extend({onLoad:function(){var e=this;var t={title:e.dialog_title,contents:e.dialog_contents,buttons:{Ok:this.fnbind(this._request),Cancel:null}};this.$("#@topic_alias_remove").click(function(){$(".ContentWrapper").dialog(t);return false})},_request:function(){if(!this.tid||!this.alias){return false}this.serverCall("remove_topic_alias").kwargs({tid:this.tid,alias:this.alias}).liveMutate().send()}});exports.TopicDelete=e.extend({onLoad:function(){var e=this;this.$("#@delete_topic_link").click(function(){e.showDialog(true);return false});this.$("#@undelete_topic_link").click(function(){e.showDialog(false);return false})},getKwargs:function(e){return{tid:this.tid,comment:e.serialize()}},showDialog:function(e){var t=this.title;var o=e?"delete_topic":"undelete_topic";var s=e?"delete_dialog":"undelete_dialog";var r=this;r.dialog().title(t).ok(function(){var e=n.lookup("editor");if(e.isEmpty()){return false}r.serverCall(o).kwargs(r.getKwargs(e)).liveMutate().send()},i.ok).cancel(null,i.cancel).load(s)}});var n;exports.TopicDialog=e.extend({onLoad:function(){this.lookup("editor").focus();n=this}});exports.getTopicDialog=function(){return n};exports.TopicFollowButton=e.extend({onLoad:function(){var e=this.fnbind(this.follow);var t=this.fnbind(this.unfollow);this.$("#@follow").click(e);this.$("#@unfollow").click(t);this.onKeyCombination(this.$("#@follow"),"f",e);this.onKeyCombination(this.$("#@unfollow"),"f",t);if(this.tooltip){this.$("#@follow").tooltip({contents:this.tooltip_text})}},follow:function(e){t.setQfeedLog(this,"TopicFollow");t.setQueryLog(this,"TopicFollow");t.setTlog({type:"TopicFollow",tid:this.tid});require("action_log").logSecondaryAction("TopicFollow",{type:"topic",tid:this.tid});this.serverCall("follow").kwargs({tid:this.tid}).liveMutate().send();e.preventDefault()},unfollow:function(e){this.serverCall("unfollow").kwargs({tid:this.tid}).liveMutate().send();e.preventDefault()}});exports.AdultTopicFollowButton=require("dialog").DialogLink.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@link").click(this.fnbind(function(){this.serverCall("follow").liveMutate().send();return false}))}});exports.TopicNameLinkBase=e.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){t.setQfeedLog(this,"TopicClickthrough");t.setQueryLog(this,"TopicClickthrough")}))}});exports.HoverTopicMenuMuteLink=e.extend({onLoad:function(){var e=this;e.$("#@hover_menu_muting_link").click(function(t){t.preventDefault();if($(this).hasClass("topic_muted")){e.serverCall("unmute").liveMutate().send()}else{e.lookup("topic_name_link").doHide();e.serverCall("mute").liveMutate().send()}return false})}});exports.TopicTrendingIndicator=e.extend({onLoad:function(){this.$("#@trending").tooltip({contents:this.tooltipText})}})},{cookies:true,settings:true,dialog:true,action_log:true,"w2.quora":true});require.install("app/view/topic/topic_list",function(require,exports,module){var e=require("w2.quora").Component;exports.TopicListItems=e.extend({onLoad:function(){this.$("#@view_more_link a").click(this.fnbind(function(e){this.$("#@view_more_link, #@additional_topics").toggleClass("hidden");e.preventDefault()}))}});exports.TopicListItem=e.extend({onLoad:function(){this.$("#@remove_topic").tooltip({contents:this.remove_tooltip_text}).click(this.fnbind(function(e){this.serverCall("remove_topic").liveMutate().send();e.preventDefault()}));this.$("#@make_primary").click(this.fnbind(function(e){this.serverCall("make_primary").liveMutate().send();e.preventDefault()}));this.$("#@clear_primary").click(this.fnbind(function(e){this.serverCall("clear_primary").liveMutate().send();e.preventDefault()}));this.$("#@remove_topic").hover(this.fnbind(function(){this.$("#@topic_list_item").addClass("hover")}),this.fnbind(function(){this.$("#@topic_list_item").removeClass("hover")}))}});exports.QuestionTopicHorizontalList=e.extend({onLoad:function(){var e=this;e.$("#@modal_link").on("click",function(t){e.modal("load_inner");t.preventDefault()})}})},{"w2.quora":true});require.install("app/view/topic/topic_redesign",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager");exports.TopicPhotoCard=e.extend({onLoad:function(){var e=this;e.$("#@card").click(e.fnbind(function(t){e.onCardClick();return false}))},onCardClick:function(){this.isSelected=!this.isSelected;if(this.isSelected){this.select()}else{this.deselect()}},select:function(){this.$("#@card").addClass(this.selectClass);this.lookup("dynamic_topic_grid").addTopic(this.tid)},deselect:function(){this.$("#@card").removeClass(this.selectClass);this.lookup("dynamic_topic_grid").removeTopic(this.tid)}});exports.TopicTopFaqQuestionsMain=e.extend({onLoad:function(){var e=this;e.$("#@checkbox_demand").change(function(){if(this.checked){e.updateDataAndReloadList("use_demand","True")}else{e.updateDataAndReloadList("use_demand","")}});e.$("#@checkbox_reask").change(function(){if(this.checked){e.updateDataAndReloadList("use_reask","True")}else{e.updateDataAndReloadList("use_reask","")}});e.$("#@checkbox_duplicates").change(function(){if(this.checked){e.updateDataAndReloadList("use_duplicates","True")}else{e.updateDataAndReloadList("use_duplicates","")}})},updateDataAndReloadList:function(e,i){var n=t.parseURLParams();n[e]=i;for(var o in n){if(n[o]==="all"||n[o]===""){delete n[o]}}var s=decodeURIComponent($.param(n));window.location=window.location.pathname+"?"+s}})},{window_manager:true,"w2.quora":true});require.install("app/view/topic/location",function(require,exports,module){var e=require("w2.quora").Component;exports.TopicLocationPreview=e.extend({onLoad:function(){var e=this;this.$("#@enlarge_map").click(this.fnbind(function(){this.$("#@enlarge_map").hide();this.$("#@wrapper").css("height","auto");this.$("#@wrapper").css("width","auto");this.$("#@wrapper").removeClass("mask");this.$("#@content").removeClass("mask_content");this.$("#@content").css("top","0px");this.lookup("picker").toggleControls(true);return false}))}})},{"w2.quora":true});require.install("app/view/topic/merge",function(require,exports,module){var e=require("w2.quora").Component;exports.TopicMergeUnmerge=e.extend({onLoad:function(){this.$("#@show_merge").click(this.fnbind(function(){this.$("#@merge").removeClass("hidden");this.$("#@show_merge").addClass("hidden");this.cQuery(":standalone.selector").focus();return false}))}});exports.TopicUnmergeLink=e.extend({onLoad:function(){var e=this;this.$("#@unmerge").click(function(){e.serverCall("unmerge_topic").kwargs({tid:e.tid}).liveMutate().send();return false})}})},{"w2.quora":true});require.install("app/view/signup",function(require,exports,module){var e=require("webnode2"),t=require("w2.quora").Component,i=require("window_manager"),n=require("login").LiveLoginDialog,o=require("cookies"),s=require("w2.context").CaptchaInput,r=require("facebook");window.loginInProgress=false;$(document).bind("w2rpcexception-signup_blocked.default",function(e,t){i.navigateTo("/signup/blocked")});exports.SignupFormFields=t.extend({onLoad:function(){this.captchaContext=this.getContext(s);var e=this;if(!this.__js_init.fb_signup_button_enabled_by_default){this.$("#@email, #@name, #@password").keyup(function(){e.maybeEnableDisableSubmitButton()});this.captchaContext.on("isCaptchaFilled",function(){e.maybeEnableDisableSubmitButton()})}},maybeEnableDisableSubmitButton:function(){var e=this;if(e.$("#@name").val()&&e.$("#@email").val()&&e.$("#@password").val()&&e.captchaContext.get("isCaptchaFilled")===true){e.trigger("enable_submit")}else{e.trigger("disable_submit")}},validate:function(){var e=this;if(!this.child("name_validator").isValid){if(!this.$("#@name")||this.child("name_validator")!==null){return false}}if(!this.child("email_validator").isValid){if(!this.$("#@email")||this.child("email_validator").isValid!==null){this.$("#@email").removeAttr("readonly");return false}}if(this.$("#@password").val().length<this.minimum_password_length){return false}if(!this.child("password_validator").isValid){if(!this.$("#@password")||this.child("password_validator").isValid!==null){a1ert(this.check_password_message);return false}}e.captchaContext.set("sync",true);if(e.captchaContext.get("isCaptchaFilled")===false){return false}return true}});exports.ModalSignupDialog=t.extend({contextConstructor:function(){return s},onLoad:function(){var e=this;e.captchaContext=e.getContext(s);this.initFormFields();if(e.logged_in_modal_dialog){this.serverCall("show_fb_modal").send()}e.log_times=[5,10,20,40];e.log_idx=0;var t=function(){e.recordStep("seconds_on_page_"+e.log_times[e.log_idx]);e.log_idx++};for(var i=0;i<e.log_times.length;i++){setTimeout(t,e.log_times[i]*1e3)}e.updateCheckboxCookie();e.recordStep("signup_dialog_begin");e.fbConnected=false;e.twConnected=false;e.googConnected=false;e.signupRpcPending=false;e.fbProfileInfo={};e.fbInfo={};e.twInfo={};e.googInfo={};if(e.show_facebook_connect){e.child("fb_connect").bind("fb_login",function(){e.updateFbLoginStatus(true)});e.child("fb_connect").bind("fb_login_failed",function(t){e.showAuthExplanation("facebook")})}if(e.show_twitter_connect){e.child("tw_connect").bind("tw_login",function(t,i,n){e.updateTwLoginStatus(i,n)});e.child("tw_connect").bind("tw_login_failed",function(t){e.showAuthExplanation("twitter")})}if(e.show_google_connect){e.child("goog_connect").bind("goog_login",function(t,i,n){e.updateGoLoginStatus(i,n)});e.child("goog_connect").bind("goog_login_failed",function(t){e.showAuthExplanation("google")})}if(e.register_submit_button){e.registerSubmitButton()}e.registerLoginLink();e.registerEmailSignupLink();e.registerCancelLinks();if(e.has_passwordless){e.recordStep("login_has_passwordless");e.$("#@login").show();e.$("#@create_account").hide()}$(window).resize(e.fnbind(function(t){e.centerComponent()}));e.centerComponent();e.$("#@form").show();e.$("%@create_account_footer_link").click(e.fnbind(function(){e.onClickCreateAccountLink()}));e.$("%@sign_in_footer_link").click(e.fnbind(function(){e.onClickSignInLink()}));e.$("%@remind_me_footer_link").click(function(){e.onClickNotNowLink()});e.$("#@close_x").click(e.fnbind(function(){e.onClickNotNowLink();return false}));e.$("#@checkbox_tos").change(e.fnbind(function(){e.clickCheckbox()}));e.$("#@connect_button_overlay").click(e.fnbind(function(){if(e.$("#@connect_button_overlay").is(":visible")){e.$("#@checkbox_error").removeClass("hidden")}}));if(window.loginIntent){e.onClickLoginLink();window.loginIntent=false}},initFormFields:function(){this.formFields=this.child("form_fields");this.submit=this.$("#@submit");this.spinner=this.$("#@spinner")},updateCheckboxCookie:function(){var e=this.$("#@checkbox_tos");if(e.hasClass("age_checkbox")){if(!e.is(":checked")){o.setAgeGate()}}},clickCheckbox:function(){var e=this;if(e.$("#@checkbox_tos").is(":checked")){e.$("#@connect_button_overlay").addClass("hidden")}else{e.$("#@connect_button_overlay").removeClass("hidden")}e.updateCheckboxCookie()},registerEmailSignupLink:function(){var e=this;e.$("%@use_email_signup").click(function(){if(e.show_facebook_connect){window.FB.getLoginStatus(e.fnbind(function(t){e.toggleConnectButtonsAndForm(true)}))}e.hidePhotoSection();e.toggleConnectButtonsAndForm(true);return false})},hidePhotoSection:function(){this.$("#@contents").addClass("no_picture_form");this.$("#@connected_photo_wrapper").hide()},registerCancelLinks:function(){var e=this;e.$("%@cancel_link").click(function(){e.close();return false});if(e.logged_in_modal_bg_close){e.$("#@background").click(function(){if(!e.logged_in_modal_bg_close){return false}e.close();e.serverCall("close_fb_modal_background").send()})}if(e.background_click_dismisses_dialog){e.$("#@background").click(function(){if(!e.background_click_dismisses_dialog){return false}if(e.signupRpcPending){return false}e.close();e.recordStep("signup_dialog_background_click_to_close")})}},toggleCancelLinks:function(e){if(e){this.$("%@cancel_link").show()}else{this.$("%@cancel_link").hide()}},disableCancelBasedOnOptions:function(){if(this.disable_background_close_on_connect){this.background_click_dismisses_dialog=false}},formTopCoord:function(){return Math.max(($(window).height()-this.$("#@form").outerHeight())/2-20,20)},centerComponent:function(){var e=this.shouldShowFbFacepile();this.toggleFbFacepileDisplay(e);if(this.$("#@top_section")){var t=this.shouldShowTopSection();this.toggleTopSectionDisplay(t)}},shouldShowTopSection:function(){return true},shouldShowFbFacepile:function(){return true},toggleFbFacepileDisplay:function(e){if(e){this.$("#@facepile_container").show()}else{this.$("#@facepile_container").hide()}},toggleTopSectionDisplay:function(e){if(e){this.$("#@top_section").show()}else{this.$("#@top_section").hide()}},toggleConnectButtonsAndForm:function(e){this.showWaitingForLogin(false);if(e){this.$("#@connect").hide();this.$("#@signup_form").show();this.updateFormFieldFocus()}else{this.$("#@connect").show();this.$("#@signup_form").hide()}this.hideFooterLinks();if(this.$("#@login").is(":visible")){this.$(".login_footer_links").show()}else if(this.$("#@signup_form").is(":visible")){this.$(".signup_footer_links").show()}else if(this.$("#@connect").is(":visible")){this.$(".regular_login_links").show()}this.centerComponent()},showWaitingForLogin:function(e){if(e){this.$("#@connect").hide();this.$("#@signup_form").hide();this.$("#@account_loading").show()}else{this.$("#@account_loading").hide()}this.centerComponent()},updateFbLoginStatus:function(e){var t=this;window.FB.getLoginStatus(function(i){if(i.status==="connected"){t.showWaitingForLogin(true)}if(!e){t.recordStep("signup_fb_initially_"+i.status)}if(i.status==="connected"){var n=i.authResponse;t.fbInfo={uid:i.authResponse.userID,accessToken:i.authResponse.accessToken,expiresIn:i.authResponse.expiresIn};t.serverCall("save_fb_token").kwargs({fb_uid:t.fbInfo.uid,access_token:t.fbInfo.accessToken,expires_in:t.fbInfo.expiresIn}).send();t.queryFacebookProfile(function(e){t.fbProfileInfo={name:e.name,email:e.email,photoUrl:e.picture};t.updateFormFields(t.fbProfileInfo)});var o=t.enable_passwordless_signup&&e;if(window.loginInProgress===true){return}window.loginInProgress=true;t.serverCall("try_login_facebook").kwargs({fb_access_token:t.fbInfo.accessToken,auto_signup:o,logged_in:t.logged_in_modal_dialog,code:t.code}).success(function(i){if(i){t.completeLogin()}else{if(t.enable_passwordless_signup){t.toggleConnectButtonsAndForm(e)}else{t.toggleConnectButtonsAndForm(true)}}window.loginInProgress=false}).except("banned_user",function(){t.serverCall("login_user_is_banned").send();window.loginInProgress=false}).except("too_many_attempts",function(){t.serverCall("login_user_rate_limited").send();window.loginInProgress=false}).error(function(){window.loginInProgress=false}).send();t.updateLoginMessage();r.updatePermissions(t.fnbind(t.updateLoginMessage));if(e){t.disableCancelBasedOnOptions()}}});t.centerComponent()},updateTwLoginStatus:function(e,t){var i=this;i.twConnected=true;i.twInfo={uid:t.twitter_uid,accessToken:e.key};i.showWaitingForLogin(true);i.updateFormFields({name:t.name,photoUrl:t.photo_url});if(window.loginInProgress===true){return}window.loginInProgress=true;i.serverCall("try_login_twitter").kwargs({tw_oauth_key:e.key}).success(function(e){if(e){i.completeLogin()}else{i.toggleConnectButtonsAndForm(true)}window.loginInProgress=false}).except("banned_user",function(){i.serverCall("login_user_is_banned").send();window.loginInProgress=false}).except("too_many_attempts",function(){i.serverCall("login_user_rate_limited").send();window.loginInProgress=false}).error(function(){window.loginInProgress=false}).send();i.disableCancelBasedOnOptions();i.centerComponent()},updateGoLoginStatus:function(e,t){var i=this;i.googConnected=true;i.googInfo={uid:t.email,accessToken:e};i.showWaitingForLogin(true);i.updateFormFields({name:t.name,email:t.email,photoUrl:t.photo_url});i.formFields.$("#@email").attr("readonly","readonly");if(window.loginInProgress===true){return}window.loginInProgress=true;i.serverCall("try_login_google").kwargs({goog_access_token:e,auto_signup:i.enable_passwordless_signup,code:i.code}).success(function(e){if(e){i.completeLogin()}else{i.toggleConnectButtonsAndForm(true)}window.loginInProgress=false}).except("banned_user",function(){i.serverCall("login_user_is_banned").send();window.loginInProgress=false}).except("too_many_attempts",function(){i.serverCall("login_user_rate_limited").send();window.loginInProgress=false}).error(function(){window.loginInProgress=false}).send();i.disableCancelBasedOnOptions();i.centerComponent()},showAuthExplanation:function(e){var t=this;if(t.show_explanation){var i=2700;t.$("#@connect_main_title").text(t.auth_explanation_title);t.$("#@connect_subtitle").text(t.auth_explanation_subtitle);t.$("#@connect_row").effect("highlight",{},i);t.$("#@connect_subtitle").addClass("subtitle_centered");var n,o;if(e=="google"){n=t.lookup("goog_connect").$("#@google_connect_button");o=t.lookup("fb_connect").$("#@facebook_connect_button")}else{n=t.lookup("fb_connect").$("#@facebook_connect_button");o=t.lookup("goog_connect").$("#@google_connect_button")}n.effect("highlight",{color:"#87ceeb"},i);var s=t.$("#@arrow_pointing_down");var r=s.find("span.arrow_down");s.show();var a=e=="google";if(a===true){r.removeClass("arrow_right");r.addClass("arrow_left")}else{r.removeClass("arrow_left");r.addClass("arrow_right")}t.$(".connect_buttons").css("padding-top","5px");t.$("#@explanation_login_links").show();t.$("#@explanation_login_links").effect("highlight",{},i)}},updateFormFields:function(e){var t=this.formFields;if(!t){return}var i=t.$("#@name");i.val(e.name);if(i.val()!==""){i.addClass("disabled_text_field").click(function(){i.removeClass("disabled_text_field")})}t.child("name_validator").validate();if(e.email){var n=t.$("#@email");n.val(e.email).addClass("disabled_text_field").click(function(){if(!n.attr("readonly")){n.removeClass("disabled_text_field")}});var o={invalid:this.fnbind(function(e){this.formFields.$("#@email").removeAttr("readonly")})};t.child("email_validator").validate(o)}this.$("#@picture_spinner").hide();if(e.photoUrl){this.$("#@connected_pic").attr("src",e.photoUrl).show()}else{this.hidePhotoSection()}this.centerComponent()},updateFormFieldFocus:function(){var e=this.formFields;if(!e){return}if(!e.$("#@name").val()){e.$("#@name").focus()}else if(!e.$("#@email").val()){e.$("#@email").focus()}else{e.$("#@password").focus()}},registerLoginLink:function(){var e=this;this.$("%@login_link").click(function(){e.onClickLoginLink();return false})},updateLoginMessage:function(){if(r.getFbUid()){if(r.hasPermission("publish_actions")){this.$("#@login_connect_and_timeline_msg").show();this.$("#@login_connect_msg").hide()}else{this.$("#@login_connect_and_timeline_msg").hide();this.$("#@login_connect_msg").show()}}else{this.$("#@login_connect_and_timeline_msg").hide();this.$("#@login_connect_msg").hide()}this.centerComponent()},registerSubmitButton:function(){this.formFields.bind("enable_submit",this.fnbind(function(){this.submit.removeAttr("disabled").removeClass("submit_button_disabled")}));this.formFields.bind("disable_submit",this.fnbind(function(){this.submit.attr("disabled","disabled").addClass("submit_button_disabled")}))},close:function(){this.recordStep("signup_dialog_close");this.$("#@background").hide();this.$("#@form").hide();this.$("#@top_section").remove();e.Dialog._instance.cancel_();return false},show:function(){this.$("#@background").show();this.$("#@form").show();this.$("#@top_section").show()},queryFacebookProfile:function(e){window.FB.api("/me?fields=id,name,email",this.fnbind(function(t){this.fbConnected=true;this.recordStep("signup_facebook_api_succeeded");e({email:t.email,name:t.name,fb_uid:t.id,picture:"https://graph.facebook.com/"+t.id+"/picture?type=normal"})}))},completeLogin:function(){if(this.logged_in_modal_dialog){this.close()}if(require("settings").pageMode=="post_reload"){$(document).trigger("quora_login")}},recordStep:function(e){this.serverCall("record_step").kwargs({step_name:e}).send()},showFbModal:function(){this.serverCall("show_fb_modal").send()},getHashParams:function(){var e={};var t=document.location.hash.substr(1).split("&");for(var i=0;i<t.length;++i){e[t[0]]=t[1]}return e},objectToString:function(e,t){t=t||"";var i=[];for(var n in e){if(typeof e[n]=="object"){i.push(t+n+"=<br>"+this.objectToString(e[n],t+"&nbsp;&nbsp;"))}else{i.push(t+n+"="+e[n])}}return i.join(",<br>")},events:{"click #@create_account_link":"onClickCreateAccountLink","click #@submit":"onClickSubmit"},onClickLoginLink:function(){this.hideDialogViews();this.hideFooterLinks();this.$("#@login").show();this.$(".login_footer_links").show();this.centerComponent();this.toggleConnectButtonsAndForm(this.fbConnected||this.twConnected);return false},onClickAskQuestionLink:function(){this.$("#@ask_question_instructions").show()},onClickCreateAccountLink:function(){this.hideDialogViews();this.hideFooterLinks();this.$("#@create_account").show();this.$("#@signup_form").show();this.$(".signup_footer_links").show();this.centerComponent();return false},onClickSignInLink:function(){this.hideDialogViews();this.hideFooterLinks();this.$("#@create_account").show();this.$("#@connect").show();this.$(".regular_login_links").show();this.$("#@google_button").show();this.centerComponent();return false},onClickNotNowLink:function(){this.close();if(this.logged_in_modal_dialog){this.serverCall("close_fb_modal").send()}},hideDialogViews:function(){this.$("#@create_account").hide();this.$("#@connect").hide();this.$("#@signup_form").hide();this.$("#@login").hide()},hideFooterLinks:function(){this.$(".regular_login_links").hide();this.$(".login_footer_links").hide();this.$(".signup_footer_links").hide()},onClickSubmit:function(){var e=this;if(e.signupRpcPending){return false}var t=e.formFields;if(t.validate()){e.signupRpcPending=true;e.spinner.show();e.submit.attr("disabled","disabled").addClass("submit_button_disabled");if(window.loginInProgress===true){return}window.loginInProgress=true;e.serverCall("signup").kwargs({name:t.$("#@name").val(),email:t.$("#@email").val(),password:t.$("#@password").val(),"g-recaptcha-response":e.captchaContext.get("captchaResponse"),fb_access_token:e.fbInfo.accessToken,fb_expires:e.fbInfo.expiresIn,tw_oauth_key:e.twInfo.accessToken,goog_access_token:e.googInfo.accessToken,code:e.code}).success(function(t){e.spinner.hide();if(!t){e.submit.removeAttr("disabled").removeClass("submit_button_disabled")}else{e.completeLogin()}e.signupRpcPending=false;window.loginInProgress=true}).error(function(){e.signupRpcPending=false;e.spinner.hide();e.submit.removeAttr("disabled").removeClass("submit_button_disabled");window.loginInProgress=true}).send()}return false}});var a=exports.SignupForm2=t.extend({contextConstructor:function(){return s},onLoad:function(){var e=this;this.captchaContext=this.getContext(s);if(this.inline_login){if(this.parent()&&this.parent()instanceof n){this.serverCall("record_signup_step").kwargs({signup_action:"signup_dialog_begin"}).send()}}this.signupRpcPending=false;this.registerKeyupCallbacks();this.useLoadingSpinnerForConnectedFriends=false;if(this.child("twitter_connect_button")){this.child("twitter_connect_button").bind("tw_login",this.fnbind(function(e,t,i){this.onTwitterOAuth(t.key,i)}))}if(this.child("google_connect_button")){this.child("google_connect_button").bind("goog_login",this.fnbind(function(e,t,i){this.onGoogleOAuth(t,i)}));this.child("google_connect_button").bind("goog_login_failed",this.fnbind(function(){this.showAuthExplanation("google")}))}if(this.child("facebook_connect_button")){this.child("facebook_connect_button").bind("fb_login",this.fnbind(function(e,t){this.tryLoginFacebook(t.accessToken,true);this.serverCall("show_connected_friends").kwargs({fb_uid:t.userID,fb_access_token:t.accessToken,fb_expires:t.expiresIn,tw_uid:this.$("#@tw_uid").val()}).contentFor(this.$("#@connected_friends_list"),{parentCID:this.cid,useLoadingSpinner:this.useLoadingSpinnerForConnectedFriends}).send();this.useLoadingSpinnerForConnectedFriends=false;this.$("#@fb_uid").val(t.userID);this.$("#@fb_access_token").val(t.accessToken);this.$("#@fb_expires").val(t.expiresIn)}));this.child("facebook_connect_button").bind("fb_login_failed",this.fnbind(function(){this.showAuthExplanation("facebook")}));this.child("facebook_connect_button").bind("fb_connected",this.fnbind(function(e,t,i){this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_succeeded"}).send();this.onFacebookAccountConnected(i)}))}this.$("#@form").submit(this.fnbind(function(t){if(this.signupRpcPending){return false}e.captchaContext.set("sync",true);if(e.captchaContext.get("isCaptchaFilled")===false){return false}if(!this.validateName()){return false}if(!this.validateEmail()){return false}if(!this.validatePassword()){return false}this.signupRpcPending=true;if(this.inline_login||this.next_url){this.$("#@spinner").removeClass("hidden");var i={name:this.$("#@name").val(),email:this.$("#@email").val(),password:this.$("#@password").val(),"g-recaptcha-response":e.captchaContext.get("captchaResponse")};var n=this.getOptionalArgs();i.optional_args=n;if(window.loginInProgress===true){return}window.loginInProgress=true;if(this.is_ios){document.activeElement.blur()}var o=this.serverCall("signup_dont_redirect").kwargs(i).success(this.fnbind(function(e){this.$("#@spinner").addClass("hidden");if(e){this.completeLogin()}else{this.$("#@submit").removeAttr("disabled")}this.signupRpcPending=false;window.loginInProgress=false;
})).error(this.fnbind(function(){this.signupRpcPending=false;this.$("#@spinner").hide();this.$("#@submit").removeAttr("disabled");window.loginInProgress=false}));if(!this.disable_live_updates){o.liveMutate()}o.send();this.$("#@submit").attr("disabled","disabled");return false}else{this.$("#@submit").attr("disabled","disabled");this.onFormSubmission();return true}}));this.$("#@email").keyup(this.fnbind(function(){this.child("email_validator").hideAllErrors()}));this.$("#@name").keyup(this.fnbind(function(){this.child("name_validator").hideAllErrors()}));this.$("#@password").keyup(this.fnbind(function(){this.child("password_validator").hideAllErrors()}))},showAuthExplanation:function(e){var t=this;if(t.show_explanation){var i=2700;t.$("#@step_1_title").hide();t.$("#@auth_explanation_container").show().effect("highlight",{},i);var n,o;if(e=="facebook"){n=this.child("facebook_connect_button").$("#@facebook_connect_button");o=this.child("google_connect_button").$("#@google_connect_button")}else{n=this.child("google_connect_button").$("#@google_connect_button");o=this.child("facebook_connect_button").$("#@facebook_connect_button")}n.effect("highlight",{color:"#87ceeb"},i);var s,r,a;if(t.show_explanation=="narrow"){s=t.$("#@arrow_pointing_right");r="area_top";a="area_bottom"}else{s=t.$("#@arrow_pointing_down");r="arrow_left";a="arrow_right"}if(e=="facebook"){s.removeClass(a);s.addClass(r)}else{s.removeClass(r);s.addClass(a)}t.$("#@bypass_connect_row").effect("highlight",{},i);t.$("#@login_link").css({"font-size":"1.3em","font-weight":"bold"});t.$("#@bypass_connect_link").css({"font-size":"1.3em","font-weight":"bold"})}},onTwitterOAuth:function(e,t){this.serverCall("record_signup_step").kwargs({signup_action:"signup_twitter_connected"}).send();if(window.loginInProgress===true){return}window.loginInProgress=true;this.serverCall("try_login_twitter").kwargs({tw_oauth_key:e}).success(this.fnbind(function(i){if(i){this.completeLogin();window.loginInProgress=false}else{window.loginInProgress=false;this.onTwitterAccountConnected(e,t)}})).except("banned_user",function(){this.serverCall("login_user_is_banned").send();window.loginInProgress=false}).except("too_many_attempts",function(){this.serverCall("login_user_rate_limited").send();window.loginInProgress=false}).error(function(){window.loginInProgress=false;this.onTwitterAccountConnected(e,t)}).send();this.serverCall("show_connected_friends").kwargs({tw_uid:t.twitter_uid,fb_uid:this.$("#@fb_uid").val(),fb_access_token:this.$("#@fb_access_token").val(),fb_expires:this.$("#@fb_expires").val()}).contentFor(this.$("#@connected_friends_list"),{parentCID:this.cid,useLoadingSpinner:this.useLoadingSpinnerForConnectedFriends}).send();this.useLoadingSpinnerForConnectedFriends=false;if(!this.$("#@connected_pic").hasClass("fb_photo")){if(t.photo_url){this.$("#@connected_pic").attr("src",t.photo_url)}else{this.$("#@connected_pic").hide()}}},onGoogleOAuth:function(e,t){this.serverCall("record_signup_step").kwargs({signup_action:"signup_google_connected"}).send();this.tryLoginGoogle(e,this.onGoogleAccountConnected.bind(this,e,t));if(!this.$("#@connected_pic").hasClass("fb_photo")){if(t.photo_url){this.$("#@connected_pic").attr("src",t.photo_url)}else{this.$("#@connected_pic").hide()}}},tryLoginFacebook:function(e,t){var i=this;if(window.loginInProgress===true){return}window.loginInProgress=true;i.serverCall("try_login_facebook").kwargs({fb_access_token:e,code:i.code,auto_signup:true}).success(function(e){if(e){i.completeLogin()}window.loginInProgress=false}).except("banned_user",function(){i.serverCall("login_user_is_banned").send();window.loginInProgress=false}).except("too_many_attempts",function(){i.serverCall("login_user_rate_limited").send();window.loginInProgress=false}).error(function(){window.loginInProgress=false}).send()},tryLoginGoogle:function(e,t){var i=this;if(window.loginInProgress===true){return}window.loginInProgress=true;i.serverCall("try_login_google").kwargs({goog_access_token:e,code:i.code}).success(function(e){if(e){i.completeLogin();window.loginInProgress=false}else{window.loginInProgress=false;t()}}).except("banned_user",function(){i.serverCall("login_user_is_banned").send();window.loginInProgress=false}).except("too_many_attempts",function(){i.serverCall("login_user_rate_limited").send();window.loginInProgress=false}).error(function(){window.loginInProgress=false;t()}).send()},onFormSubmission:function(){},onTwitterAccountConnected:function(e,t){this.accountConnected();this.child("twitter_connect_button").$("#@twitter_connect_button").hide();this.$("#@twitter_connected").show();this.$("#@connect_option").hide();this.$("#@connect_explanation").hide();this.$("#@step_2").removeClass("hidden");this.$("#@email").focus();this.showConnectedFriends();this.showTwitterConnectedInfo(t);this.$("#@tw_oauth_key").val(e);this.$("#@tw_uid").val(t.twitter_uid);this.$("#@tw_screen_name").val(t.twitter_screen_name);this.$("#@name").val(t.name);this.child("name_validator").validate();this.onShowStepTwo()},onGoogleAccountConnected:function(e,t){this.accountConnected();this.child("google_connect_button").$("#@google_connect_button").hide();this.$("#@google_connected").show();this.$("#@connect_option").hide();this.$("#@connect_explanation").hide();this.$("#@step_2").removeClass("hidden");this.$("#@password").focus();this.showConnectedFriends();this.showGoogleConnectedInfo(t);this.$("#@goog_access_token").val(e);this.$("#@goog_email").val(t.email);this.$("#@goog_name").val(t.name);this.$("#@name").val(t.name);this.$("#@email").val(t.email);this.child("name_validator").validate();this.$("#@email").attr("readonly","readonly");this.$("#@email").addClass("disabled_text_field");var i={invalid:this.fnbind(function(e){this.$("#@email").removeAttr("readonly");this.$("#@email").removeClass("disabled_text_field")})};this.child("email_validator").validate(i);this.onShowStepTwo()},showConnectedFriends:function(){this.$("#@connected_friends_list").show()},onFacebookAccountConnected:function(e){this.accountConnected();if(this.hide_welcome_on_connect){this.$("#@signup_welcome").hide()}if(e&&e[0]){window.RESULTS=e;if(e[0].pic_big){this.$("#@connected_pic").attr("src",e[0].pic_big);this.$("#@connected_pic").addClass("fb_photo")}else{this.$("#@connected_pic").hide()}if(e[0].contact_email){this.$("#@email").val(e[0].contact_email)}this.child("facebook_connect_button").$("#@facebook_connect_button").hide();this.$("#@facebook_connected").show();this.$("#@connect_option").hide();this.$("#@connect_explanation").hide();this.$("#@password").focus();this.$("#@step_2").removeClass("hidden");this.showConnectedFriends();this.showFbConnectedInfo(e);this.$("#@name").val(e[0].name);this.child("name_validator").validate();this.onShowStepTwo()}else{var t=window.console;if(t&&t.error){t.error("Error retrieving data from Facebook.")}this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_failed"}).send()}},validateName:function(){if(!this.child("name_validator").isValid){if(!(this.$("#@name")&&this.child("name_validator")===null)){if(this.child("name_validator").invalidMessage){a1ert(this.child("name_validator").invalidMessage)}else{a1ert(this.check_name_message)}return false}}return true},validateEmail:function(){if(!this.child("email_validator").isValid){if(!(this.$("#@email")&&this.child("email_validator").isValid===null)){if(this.child("email_validator").invalidMessage){a1ert(this.child("email_validator").invalidMessage)}else{a1ert(this.check_email_message)}return false}}return true},validatePassword:function(){var e=this.$("#@password").val();if(e.length<this.minimum_password_length||e.length>this.maximum_password_length){return false}if(e.toLowerCase()=="password"){return false}if(!this.child("password_validator").isValid){if(!(this.$("#@password")&&this.child("password_validator").isValid===null)){if(this.child("password_validator").invalidMessage){a1ert(this.child("password_validator").invalidMessage)}else{a1ert(this.check_password_message)}return false}}else{window.console.log("validator hasn't responded yet, allowing through")}return true},registerKeyupCallbacks:function(){this.$("#@email, #@name, #@password").keyup(this.fnbind(function(){if(this.$("#@name").val()&&this.$("#@email").val()&&this.$("#@password").val()){this.$("#@submit").removeAttr("disabled");this.$("#@submit").removeClass("submit_button_disabled")}else{this.$("#@submit").attr("disabled","disabled");this.$("#@submit").addClass("submit_button_disabled")}}))},showFbConnectedInfo:function(e){this.$("#@connected_info").show();this.$("#@fb_name").text(e[0].name);this.$("#@fb_info").show()},showTwitterConnectedInfo:function(e){this.$("#@connected_info").show();this.$("#@tw_name").text("@"+e.twitter_screen_name);this.$("#@twitter_info").show()},showGoogleConnectedInfo:function(e){this.$("#@connected_info").show();this.$("#@goog_name").text(e.name);this.$("#@goog_email").text(e.email);this.$("#@goog_info").show()},getOptionalArgs:function(){var e=this.$("#@fb_access_token").val();var t=this.$("#@tw_oauth_key").val();var i=this.$("#@goog_access_token").val();return{code:this.$("#@code").val(),group:this.$("#@group").val(),source_user_name:this.$("#@source_user_name").val(),source_url:this.$("#@source_url").val(),tid:this.tid,fb_access_token:e,fb_expires:this.$("#@fb_expires").val(),tw_oauth_key:t,google_access_token:i}},completeLogin:function(){if(!this.inline_login){i.navigateTo(this.next_url||"/")}if(require("settings").pageMode=="post_reload"){$(document).trigger("quora_login")}},accountConnected:function(){},cancelClicked:function(){this.toggleStep1Header(true);if(this.lookup("home_logged_out")){this.lookup("home_logged_out").$("#@contents").show();this.lookup("home_logged_out").$("#@signup_form").hide()}},onShowStepTwo:function(){this.toggleStep1Header(false);this.serverCall("record_signup_step").kwargs({signup_action:"signup_show_step_two"}).send()},bypassConnectLink:function(){this.$("#@connect_option").hide();this.$("#@connect_explanation").hide();this.$("#@step_2").removeClass("hidden");this.onShowStepTwo();this.$("#@name").focus()},toggleStep1Header:function(e){if(this.hide_step1_header_on_step2){if(e){this.$("#@step_1_title").show();this.$("#@connect_buttons").show()}else{this.$("#@step_1_title").hide();this.$("#@connect_buttons").hide()}}},events:{"click #@bypass_connect_link":"onClickBypassConnectLink","click #@twitter_signup_link":"onClickTwitterSignupLink","click #@google_signup_link":"onClickGoogleSignupLink","click #@login_link":"onClickLoginLink","click #@create_account_link":"onClickCreateAccountLink","click #@cancel":"onClickCancel"},onClickBypassConnectLink:function(e){this.bypassConnectLink();return false},onClickTwitterSignupLink:function(e){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_twitter"}).send();var t=window.open("/twitter/oauth_window","_BLANK","height=400,width=800");return false},onClickGoogleSignupLink:function(e){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_google"}).send();var t=window.open("/google_/oauth_window","_BLANK","height=550,width=700");return false},onClickLoginLink:function(e){this.$("#@step_1").addClass("hidden");this.$("#@step_2").addClass("hidden");this.$("#@login_form").removeClass("hidden")},onClickCreateAccountLink:function(e){this.$("#@step_1").removeClass("hidden");this.$("#@login_form").addClass("hidden")},onClickCancel:function(e){this.cancelClicked();return false},onHomePageSignupFormLoad:function(){var e=i.getPathName();var t={};if(e=="/"||e=="/signup"){t={path:e}}this.serverCall("record_signup_step").kwargs({signup_action:"signup_homepage_visit",funnel_args:t}).send();if(this.no_associated_users){this.serverCall("record_signup_step").kwargs({signup_action:"signup_homepage_visit_no_account",funnel_args:t}).send()}}});var l=exports.SignupFormExpanded=a.extend({cancelClicked:function(){this.toggleStep1Header(true);if(this.lookup("home_logged_out")){this.lookup("home_logged_out").$("#@contents").show();this.lookup("home_logged_out").$("#@signup_form_expanded").addClass("w3").removeClass("row")}this.child("facebook_connect_button").$("#@facebook_connect_button").show();this.$("#@facebook_connected, #@google_connected, #@twitter_connected, #@connected_friends_list, #@connected_info, #@twitter_info, #@connected_photo_wrapper").hide();this.$("#@step_2").addClass("hidden");this.$("#@connect_option, #@connect_explanation, #@connect_option").show();this.$("#@twitter_signup_link").show()},bypassConnectLink:function(){this.serverCall("record_signup_step").kwargs({signup_action:"bypass_connect_link"}).send();this.$("#@connect_option").hide();this.$("#@connect_explanation").hide();this.$("#@step_2").removeClass("hidden");this.onShowStepTwo();this.accountConnected();this.$("#@name").focus()}});var u=exports.SignupFormBigButtons=l.extend({onLoad:function(){this._super.apply(this,arguments);this.onHomePageSignupFormLoad();this.doingPasswordlessSignup=false},accountConnected:function(){if(this.lookup("home_logged_out")){this.lookup("home_logged_out").$("#@quora_explanation").fadeTo(1,.15)}},onShowStepTwo:function(){this._super.apply(this,arguments);this.$("#@step_1").hide();this.setStepTwoTitle()},setStepTwoTitle:function(){var e=this.$("#@step_2_header_prefix").text();var t=this.$("#@name").val()==="";var i=this.$("#@email").val()==="";var n=this.$("#@password").val()==="";if(!t){this.$("#@name").addClass("prefilled")}if(!i){this.$("#@email").addClass("prefilled")}if(t&&i&&n){}else if(i&&n){e=this.blank_email_and_password_text;this.$("#@email").focus()}else if(n){e=this.blank_password_text;this.$("#@password").focus()}this.$("#@step_2_header_prefix").text(e)},cancelClicked:function(){this._super.apply(this,arguments);this.$("#@step_1").show();if(this.lookup("home_logged_out")){this.lookup("home_logged_out").$("#@quora_explanation").fadeTo(1,1)}},showFbConnectedInfo:function(e){this.$("#@connected_info").show()},showTwitterConnectedInfo:function(e){this.$("#@connected_info").show()},showGoogleConnectedInfo:function(e){this.$("#@connected_info").show()},registerKeyupCallbacks:function(){},showConnectedFriends:function(){},validateName:function(){if(this.doingPasswordlessSignup){return true}else{if(this.$("#@name").val()===""){this.child("name_validator").$("#@invalid_message").text(this.name_validation_text);this.child("name_validator").showErrorOnComponent("#@invalid_message");return false}else{return this._super.apply(this,arguments)}}},validateEmail:function(){if(this.doingPasswordlessSignup){return true}else{if(this.$("#@email").val()===""){this.child("email_validator").$("#@invalid_message").text(this.email_validation_text);this.child("email_validator").showErrorOnComponent("#@invalid_message");return false}else{return this._super.apply(this,arguments)}}},validatePassword:function(){if(this.doingPasswordlessSignup){return true}else{if(this.$("#@password").val()===""){this.child("password_validator").$("#@invalid_message").text(this.password_validation_text);this.child("password_validator").showErrorOnComponent("#@invalid_message");return false}else{return this._super.apply(this,arguments)}}},events:{"click #@bypass_connect_link":"onClickBypassConnectLink","click #@twitter_signup_link":"onClickTwitterSignupLink","click #@google_signup_link":"onClickGoogleSignupLink","click #@cancel":"onClickCancel","click #@name":"onClickName","click #@email":"onClickEmail"},onClickName:function(e){var t=this;t.$("#@name").removeClass("prefilled")},onClickEmail:function(e){var t=this;if(!t.$("#@email").attr("readonly")){t.$("#@email").removeClass("prefilled")}},onFacebookAccountConnected:function(e){this.doingPasswordlessSignup=true;if(e&&e[0]){if(window.loginInProgress===true){return}window.loginInProgress=true;window.RESULTS=e;if(e[0].pic_big){this.$("#@connected_pic").attr("src",e[0].pic_big);this.$("#@connected_pic").addClass("fb_photo")}else{this.$("#@connected_pic").hide()}if(e[0].contact_email&&this.$("#@email").val()===""){this.$("#@email").val(e[0].contact_email)}if(this.$("#@name").val()===""){this.$("#@name").val(e[0].name)}this.doSignup();window.loginInProgress=false}else{var t=window.console;if(t&&t.error){t.error("Error retrieving data from Facebook.")}this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_failed"}).send()}},doSignup:function(){this.$("#@form").submit()}});exports.SignupConnectedFriends=t.extend({onLoad:function(){},events:{"click #@more_friends":"onClickMoreFriends"},onClickMoreFriends:function(e){var t=this;t.dialog().title(t.dialog_title_text).cancel(null,t.dialog_close_text).html(t.dialog_desciption_text);return false}})},{"w2.context":true,window_manager:true,settings:true,webnode2:true,cookies:true,facebook:true,login:true,"w2.quora":true});require.install("app/view/signup/google_",function(require,exports,module){var e=require("settings"),t=require("w2.quora").Component,i=require("google_");window.loginInProgress=false;exports.SignupGoogleConnectButton=t.extend({events:{"click #@google_connect_button":"onClick"},onClick:function(){var t=this;var n={callback:this.fnbind(this.signInCallback),clientid:e.googleClientId,cookiepolicy:e.googleCookiePolicy,scope:this.scopes};if(this.prompt_ota_install){n.apppackagename=e.androidAppPackageName}i.onInit(function(){window.gapi.auth.setToken(null);window.gapi.auth.signIn(n);t.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_google"}).send()});return false},signInCallback:function(e){if(e&&e.error===undefined){if(e.status.method==="AUTO"&&e.num_sessions===1){this.onLogin(e)}else if(e.status.method==="PROMPT"){this.onLogin(e)}else{this.onLoginFailed()}}else{this.onLoginFailed()}},onLogin:function(e){this.serverCall("on_google_connected").send();this.queryGoogleProfile(e)},queryGoogleProfile:function(e){var t=this;i.getUserProfile(e,function(i){t.serverCall("record_signup_step").kwargs({signup_action:"fetched_user_google_profile"}).send();t.trigger("goog_login",e.access_token,i)})},onLoginFailed:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_google_connect_failed"}).send();this.trigger("goog_login_failed")}});exports.GoogleAutoLogin=t.extend({onLoad:function(){var t=this;if(!t.viewer){i.onInit(function(){window.gapi.auth.authorize({immediate:true,client_id:e.googleClientId,cookiepolicy:e.googleCookiePolicy,scope:t.scopes},t.fnbind(t.signInCallback))})}},signInCallback:function(e){if(e&&e.error===undefined){this.onLogin(e)}},onLogin:function(t){if(window.loginInProgress===true){return}window.loginInProgress=true;this.serverCall("try_auto_login").kwargs({access_token:t.access_token}).success(function(t){if(t&&e.pageMode==="post_reload"){require("window_manager").reload()}window.loginInProgress=false}).error(function(){window.loginInProgress=false}).except(function(){window.loginInProgress=false}).send()}})},{"w2.quora":true,google_:true,window_manager:true,settings:true});require.install("app/view/share/form",function(require,exports,module){var e=require("w2.quora").Component,t=require("app/view/share/connect").SocialConnector,i=require("w2.context");var n=exports.ShareCheckboxBase=t.extend({contextProperty:null,onLoad:function(){this.list_item=this.$("#@share_checkbox_list_item");this.checkbox=this.$("#@checkbox");this.action_link=this.$("#@action_link");this.message_preview=this.$("#@message_preview");this.message_preview_text=this.$("#@message_preview_text");this.label_clickable=this.$("#@label_clickable");this.editorContext=this.getContext(i.Editor);if(this.isStateModified()&&!this.is_disabled){var e=this.state("checked");if(e){this.checkbox.attr("checked","checked");this.list_item.removeClass("is_not_checked")}else{this.checkbox.removeAttr("checked");this.list_item.addClass("is_not_checked")}}this.maybeSetContext();this.checkbox.change(this.fnbind(function(){var e=this.isChecked();if(e&&this.needs_action){this.remedyDisabled();this.checkbox.removeAttr("checked");return}this.maybeSetContext();this.logCheckboxChangedJS(e);this.state("checked",e);if(e){this.list_item.removeClass("is_not_checked")}else{this.list_item.addClass("is_not_checked")}}));this.label_clickable.click(this.fnbind(function(){this.checkbox.click()}));this.action_link.click(this.fnbind(function(){if(this.is_disabled){this.remedyDisabled()}else{this.editText()}return false}))},maybeSetContext:function(){if(this.editorContext){this.editorContext.set(this.contextProperty,this.isChecked())}},logCheckboxChangedJS:function(e){this.serverCall("log_checkbox_changed_js").kwargs({is_checked:e,share_info:this.share_info}).send()},isStateModified:function(){var e=this.state("checked");return typeof e!="undefined"},isChecked:function(){return this.checkbox.attr("checked")==="checked"},remedyDisabled:function(){},beginEditingText:function(){}});exports.ShareCheckboxTwitter=n.extend({contextProperty:"shareToTwitter",remedyDisabled:function(){this.connectTwitter()}});exports.ShareCheckboxTwitterCompact=exports.ShareCheckboxTwitter.extend({onLoad:function(){this._super.apply(this,arguments);this.list_item.tooltip({contents:this.default_text})},remedyDisabled:function(){this.connectTwitter(this.fnbind(function(){this.checkbox.attr("checked","checked")}))}});exports.ShareCheckboxFacebook=n.extend({contextProperty:"shareToFacebook",remedyDisabled:function(){var e=this;require("facebook").maybePromptToPublish(e.fbUid,function(t,i,n){e.serverCall("connect_facebook").kwargs({fb_uid:t,access_token:i,expires_secs:n}).liveMutate().send()},function(){e.child("fb_different_account").show()})}});exports.ShareCheckboxFacebookCompact=exports.ShareCheckboxFacebook.extend({});exports.ShareForm=e.extend({getValues:function(){var e={};if(this.lookup("checkbox_fb",true)){e.fb=this.lookup("checkbox_fb").isChecked()}if(this.lookup("checkbox_tw",true)){e.tw=this.lookup("checkbox_tw").isChecked()}return e}});var o=require("qed/rules").Ruleset,s=new o,r=/\bshare_editor_link\b/;s.addOkTag("a",function(e){if(r.test(e.className)){return"a"}});s.addKeyHandler(65,require("qed/util").handleSelectAll);exports.ShareFormMessageEditor=e.extend({onLoad:function(){this.editor=this.$("#@editor").get(0);this.anchor=this.$("#@editor a.share_editor_link").get(0);$("a",this.editor).addClass("share_editor_link").after("\ufeff").before("\ufeff");this._qed=require("qed/edit").edit(this.editor,s);this._qed.modify(function(e,t){})},focus:function(){var e=this;e.whenOnLoaded(function(){e._qed.focus()})},appendAnchor:function(){var e=this;e.whenOnLoaded(function(){e._qed.modify(function(){e.$("#@editor").prepend(e.anchor)})})},removeAnchor:function(){var e=this;e.whenOnLoaded(function(){e._qed.modify(function(){$(e.anchor).remove()})})},isEmpty:function(){var e=this,t=e._qed.text(true);return t==="\n"||t===""},getText:function(){var e=this;return e._qed.text()},serialize:function(){var e=this._qed.html(true),t=document.createElement("div");t.innerHTML=e;$("a",t).remove();return{html:e,data:this.qlink_data||{},no_anchors:$(t).html()}}})},{"qed/edit":true,"app/view/share/connect":true,"w2.context":true,"qed/rules":true,facebook:true,"qed/util":true,"w2.quora":true});require.install("app/view/share/modal",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("app/view/share/connect").socialConnectorBase,n=require("view/modal").Base,o=require("window_manager"),s=require("cookies");exports.ShareFormModal=n.extend($.extend({},i,{onLoad:function(){var e=this;e.results=[];e.shortURLCopyField=e.$("#@short_url_copy_field");e.editor=e.child("message_editor").$("#@editor");e.editorPlaceholder=e.child("message_editor").$("#@editor_placeholder");e.linkedinCheckbox=e.$("#@linkedin_checkbox");e.linkedinConnectLink=e.$("#@linkedin_connect_link");e.wordpressCheckbox=e.$("#@wordpress_checkbox");e.wordpressConnectLink=e.$("#@wordpress_connect_link");e.tumblrCheckbox=e.$("#@tumblr_checkbox");e.tumblrConnectLink=e.$("#@tumblr_connect_link");e.boardCheckbox=e.$("#@board_checkbox");e.boardSelectorContainer=e.$("#@board_selector_container");e.boardSelectorWrapper=e.child("selector_wrapper");if(e.boardSelectorWrapper){e.boardSelector=e.boardSelectorWrapper.child("selector")}e.sendCheckbox=e.$("#@send_checkbox");e.multiSelectorContainer=e.$("#@multi_selector_container");e.typeahead=e.child("typeahead");if(typeof window.history.pushState=="function"){if(!o.isParamInURL("share")){window.history.pushState(null,"",o.addParamToURL(""+window.location,"share","1"))}}e.child("message_editor").whenOnLoaded(function(){e.updateShareEditorLinkDisplay()});if(e.isChecked(e.boardCheckbox)){e.boardSelectorContainer.show()}if(e.isChecked(e.sendCheckbox)){e.multiSelectorContainer.show()}function t(){e.showHidePlaceholder()}function i(){setTimeout(t,10)}e.editor.bind("keyup",i).bind("keydown",i);function n(){e.child("message_editor").focus()}e.editorPlaceholder.bind("click",n);e.linkedinCheckbox.click(function(){e.updateShareEditorLinkDisplay();if(!e.isChecked(e.linkedinCheckbox)){e.disableSubmitIfNecessary();return}if(e.liUid){e.enableSubmit();return}e.connectLinkedin(e.fnbind(e.checkLinkedin));return false});e.linkedinConnectLink.click(function(){e.connectLinkedin(e.fnbind(e.checkLinkedin));return false});e.wordpressCheckbox.click(function(){e.updateShareEditorLinkDisplay();if(!e.isChecked(e.wordpressCheckbox)){e.disableSubmitIfNecessary();return}if(e.wordpressConnected){e.enableSubmit();return}e.connectWordpress()});e.wordpressConnectLink.click(function(){e.connectWordpress();return false});$(document).bind("wordpress_connect_success",function(){e.checkWordpress()});e.tumblrCheckbox.click(function(){e.updateShareEditorLinkDisplay();if(!e.isChecked(e.tumblrCheckbox)){e.disableSubmitIfNecessary();return}if(e.tumblrConnected){e.enableSubmit();return}e.connectTumblr(function(){e.checkTumblr()})});e.tumblrConnectLink.click(function(){e.connectTumblr(function(){e.checkTumblr()});return false});e.boardCheckbox.click(function(){e.updateShareEditorLinkDisplay();if(!e.isChecked(e.boardCheckbox)){e.boardSelectorContainer.hide();e.disableSubmitIfNecessary();return}e.boardSelectorContainer.show();e.enableSubmit()});e.sendCheckbox.click(function(){e.updateShareEditorLinkDisplay();if(!e.isChecked(e.sendCheckbox)){e.typeahead.clear();e.multiSelectorContainer.hide();e.disableSubmitIfNecessary();return}e.multiSelectorContainer.show();e.typeahead.$("#@input").focus()});e.shortURLCopyField.click(function(){$(this).select()});this._super.apply(this,arguments);e.disableSubmitIfNecessary()},onClose:function(){this._closeModal();if(this.originalUrl&&typeof window.history.pushState=="function"){window.history.pushState(null,"",this.originalUrl)}return false},onSubmit:function(){var e=this;var i=e.checkboxValues();i.send=e.isChecked(e.sendCheckbox);if(e.boardSelector){var n=e.boardSelector.getBid();var o=e.boardSelector.getText();e.boardInfo.bid=n;e.boardInfo.name=n?null:o;e.boardInfo.is_submission=e.isSubmission}if(!e.atLeastOneChecked(i)){e.disableSubmit();return false}var r=t.Modal.openerFor(e);for(var a in i){if(i[a]===true){var l="Share"+a[0].toUpperCase()+a.slice(1);s.setQfeedLog(r,l);s.setTlog({type:l})}}s.setQueryLog(r,"BoardPost");require("action_log").logSecondaryAction("Share",e.share_target);e.disableSubmit();e.serverCall("dialog_submit_controller").kwargs({checkboxes:i,message:e.lookup("message_editor").serialize(),board_info:e.boardInfo,send_recipients:e.results}).success(function(t){e._closeModal()}).error(function(){e._closeModal()}).liveMutate().send()},regexUrl:/((?:https?:\/\/)?[a-zA-Z0-9](?:[-a-zA-Z0-9]*\.)+[a-zA-Z]{2,}(?:\/[^\/\s]+)*\/?)(?:\s|$)/gi,showHidePlaceholder:function(){if(this.child("message_editor").isEmpty()){this.editorPlaceholder.removeClass("hidden")}else{this.editorPlaceholder.addClass("hidden")}},tweetLength:function(e){if(!e){return 0}var t=e.length;var i=[];e.replace(this.regexUrl,function(e,t){i.push(t)});t-=i.join("").length;$.each(i,function(e,i){t+=i.match(/https:/)?23:22});t+=23;return t},updateShareEditorLinkDisplay:function(){var e=this.child("message_editor");e.removeAnchor();if(this.isChecked(this.linkedinCheckbox)||this.isChecked(this.wordpressCheckbox)||this.isChecked(this.tumblrCheckbox)||this.isChecked(this.boardCheckbox)||this.isChecked(this.sendCheckbox)){this.editor.addClass("highlight-link")}else{this.editor.removeClass("highlight-link")}this.showHidePlaceholder()},checkboxValues:function(){var e=this;var t={};$.each(e.shareChannels,function(){t[this]=e.isChecked(e.$("#@"+this+"_checkbox"))});return t},atLeastOneChecked:function(e){var t=false;$.each(e,function(e,i){t=t||i});return t},uncheckAll:function(){var e=this;$.each(e.shareChannels,function(){e.$("#@"+this+"_checkbox").attr("checked",false)});e.disableSubmit()},disableSubmitIfNecessary:function(){var e=this.checkboxValues();if(!this.atLeastOneChecked(e)&&this.results.length===0){this.disableSubmit()}},connectWordpress:function(){var e=this;e._dialog=e.dialog().title(e.wordpress_connect_title).close().load("connect_wordpress")},checkWordpress:function(){this.wordpressCheckbox.attr("checked",true);this.wordpressCheckbox.attr("disabled",false);this.wordpressConnectLink.hide();this.wordpressConnected=true;this.updateShareEditorLinkDisplay();this.enableSubmit()},checkTumblr:function(){this.tumblrCheckbox.attr("checked",true);this.tumblrCheckbox.attr("disabled",false);this.tumblrConnectLink.hide();this.tumblrConnected=true;this.updateShareEditorLinkDisplay();this.enableSubmit()},checkLinkedin:function(){var e=this;e.linkedinCheckbox.attr("checked",true);e.linkedinCheckbox.attr("disabled",false);e.linkedinConnectLink.hide();e.liUid=true;e.updateShareEditorLinkDisplay();e.enableSubmit()},updateResults:function(e){this.results=e;if(this.results.length>0||this.atLeastOneChecked(this.checkboxValues())){this.enableSubmit()}else{this.disableSubmit()}},setIsSubmission:function(e){this.isSubmission=e},hideDistroOptions:function(){},showDistroOptions:function(){},isChecked:function(e){return e.attr("checked")==="checked"}}))},{"app/view/share/connect":true,window_manager:true,webnode2:true,"view/modal":true,cookies:true,action_log:true,"w2.quora":true});require.install("app/view/contact_importer",function(require,exports,module){var e=require("settings"),t=require("google_"),i=require("w2.quora").Component;var n=[/@yahoo\.(ca|cn|co\.id|co\.in|co\.jp|co\.kr|co\.nz|co\.uk|com|com\.ar|com\.au|com\.br|com\.cn|com\.hk|com\.mx|com\.my|com\.ph|com\.sg|com\.tr|com\.tw|com\.vn|de|dk|es|fr|gr|ie|it|no|pl|se)$/,/@ymail\.com$/,/@rocketmail\.com$/],o=[/@gmail\.com$/,/@googlemail\.com$/],s=[/@.*(hotmail|live|msn)\..+$/];function r(e,t){var i=false;$.each(t,function(t,n){if(n.test(e)){i=true;return}});return i}var a=exports.ImportContactsForm=i.extend({prevEmail:null,isGoogleAppsEmail:false,shouldLogImpression:true,onLoad:function(){var e=this;this.isGoogleAppsEmail=this.is_google_apps_email;this.prevEmail=this.getEmail();this.$("input[type=submit]").focus();this.$("#@email").keyup(function(){if(e.prevEmail!=e.getEmail()){e.prevEmail=e.getEmail();e.validateEmail()}});this.$("input[type=submit]").click(function(){return e.onSubmit()});if(this.shouldLogImpression){this.serverCall("log_impression").kwargs({email:this.getEmail()}).send()}},submitForm:function(){this.$("#@contact_importer_form").submit()},updateAndSubmitForm:function(e,t){this.$("#@service").val(e);this.$("#@access_token").val(t);this.$("#@spinner").show();this.submitForm()},onOAuthRejected:function(e){},onSubmit:function(){if(this.openOAuthDialog(this.getEmail())){return false}return true},getEmail:function(){return $.trim(this.$("#@email").val())},lastTimeoutId:null,validateEmail:function(){var e=this.getEmail();if(!e){this.onOAuthEmailEntered("empty");return false}if(this.lastTimeoutId){clearTimeout(this.lastTimeoutId);this.lastTimeoutId=null}var t=r(e,n);var i=r(e,o);var a=r(e,s);this.isGoogleAppsEmail=false;this.isGoogleAppsDomainCheckQueued=false;if(t){this.onOAuthEmailEntered("yahoo")}else if(i){this.onOAuthEmailEntered("gmail");
}else if(a){this.onOAuthEmailEntered("hotmail")}else{this.onUnknownDomainEntered();this.lastTimeoutId=setTimeout(this.fnbind(function(){this.checkGoogleAppsDomain()}),500)}},onOAuthEmailEntered:function(e){},onUnknownEmailDomainEntered:function(){},isCheckingGoogleAppsDomain:false,isGoogleAppsDomainCheckQueued:false,checkGoogleAppsDomain:function(){if(this.isCheckingGoogleAppsDomain){this.isGoogleAppsDomainCheckQueued=true;return}this.isCheckingGoogleAppsDomain=true;var e=this.getEmail();var t=this;this.serverCall("is_google_apps_domain").kwargs({email:e}).success(function(i){if(i){t.isGoogleAppsEmail=true}t.onCheckGoogleAppsDomainResponse(e,i);t.isCheckingGoogleAppsDomain=false;if(t.isGoogleAppsDomainCheckQueued){t.isGoogleAppsDomainCheckQueued=false;t.checkGoogleAppsDomain()}}).send()},onCheckGoogleAppsDomainResponse:function(e,t){},logOAuthAttempt:function(e){this.serverCall("log_contact_importer_oauth_attempt").kwargs({email:e}).send()},onGoogleOAuthCallback:function(e){var t=this;if(e&&e.error===undefined){var i="google";var n=e.access_token;t.updateAndSubmitForm(i,n)}else{t.onOAuthRejected()}},openOAuthDialog:function(i){var a=this;if(r(i,n)){a.logOAuthAttempt(i);window.open("/oauth/yahoo","_BLANK","height=400,width=800");return true}else if(r(i,o)||a.isGoogleAppsEmail){a.logOAuthAttempt(i);t.onInit(function(){var t={callback:a.fnbind(a.onGoogleOAuthCallback),clientid:e.googleClientId,cookiepolicy:e.googleCookiePolicy,scope:a.scopes};if(a.prompt_ota_install){t.apppackagename=e.androidAppPackageName}window.gapi.auth.signIn(t)});return true}else if(r(i,s)){a.logOAuthAttempt(i);window.open("/oauth/hotmail","_BLANK","height=600,width=1000");return true}return false},getEmailDomain:function(e){if(r(e,n)){return"yahoo"}else if(r(e,o)||this.isGoogleAppsEmail){return"google"}else if(r(e,s)){return"hotmail"}return"other"}});exports.OAuthFormSubmissionListener=i.extend({onLoad:function(){var e=this;$(document).bind("oauth_approved",function(t,i){var n=i.service;var o=i.accessToken;e.lookup("contact_importer").updateAndSubmitForm(n,o)});$(document).bind("oauth_rejected",function(t,i){var n=i.service;e.lookup("contact_importer").onOAuthRejected()})}});exports.SimpleImportContactsForm=a.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@contact_importer_form").submit(this.fnbind(this.onFormSubmit))},onFormSubmit:function(){return!this.child("submit").$("#@import_contacts").is(":disabled")},unsupportedMessageTimeoutId:null,clearUnsupportedMessageTimeout:function(){if(this.unsupportedMessageTimeoutId){clearTimeout(this.unsupportedMessageTimeoutId);this.unsupportedMessageTimeoutId=null}},onOAuthEmailEntered:function(e){this.$("#@spinner").hide();this.$("#@email_import_error").hide();this.$("#@unsupported_domain").hide();this.$("#@form_error").hide();this.enableSubmitButton(true);this.clearUnsupportedMessageTimeout()},onUnknownDomainEntered:function(){this.$("#@spinner").show();this.$("#@email_import_error").hide();this.$("#@form_error").hide();this.enableSubmitButton(false);this.clearUnsupportedMessageTimeout()},onUnsupportedDomainEntered:function(){this.$("#@spinner").hide();this.$("#@unsupported_domain").show();this.$("#@email_import_error").show();this.enableSubmitButton(false)},onCheckGoogleAppsDomainResponse:function(e,t){if(this.getEmail()==e){if(!t){var i=this;this.unsupportedMessageTimeoutId=setTimeout(function(){i.onUnsupportedDomainEntered()},500)}else{this.$("#@spinner").hide();this.$("#@unsupported_domain").hide();this.enableSubmitButton(true)}}},enableSubmitButton:function(e){if(e){this.child("submit").$("#@import_contacts").attr("disabled",false).removeClass("submit_button_disabled").addClass("follow_button")}else{this.child("submit").$("#@import_contacts").attr("disabled",true).addClass("submit_button_disabled").removeClass("follow_button")}}});exports.NuxDialogImportContactsForm=exports.SimpleImportContactsForm.extend({shouldLogImpression:false,onLoad:function(){var e=this;e._super.apply(e,arguments);e.$("#@change_email_link").click(function(){e.$("#@default_email_container").hide();e.$("#@change_email_container").show();return false});if(e.getEmailDomain(e.getEmail())=="other"){e.onUnsupportedDomainEntered()}e.$("#@skip").click(function(){e.serverCall("record_step").kwargs({step_name:"skip_oauth_dialog"}).success(function(){e.lookup("dialog_step").skipNextStep()}).send();return false})},onOAuthRejected:function(e){this.serverCall("record_step").kwargs({step_name:"reject_oauth"}).send()},onSubmit:function(){var e=this._super.apply(this,arguments);var t=!e;if(t){this.serverCall("record_step").kwargs({step_name:"open_oauth",props:{domain:this.getEmailDomain(this.getEmail())}}).send()}else{this.serverCall("record_step").kwargs({step_name:"invalid_import_domain"}).send()}return e},submitForm:function(){var e=this.$("#@service").val();var t=this.$("#@access_token").val();this.importContacts(this.getEmail(),e,t);return false},importContacts:function(e,t,i){var n=this;n.$("#@alt_spinner").show();n.serverCall("import_contacts").kwargs({email:e,service:t,access_token:i}).liveMutate().success(function(){n.lookup("dialog_step").gotoNextStep()}).sendOnlyOnce()}})},{google_:true,"w2.quora":true,settings:true});require.install("app/view/growl",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2");var i=false;exports.GrowlBase=e.extend({onLoad:function(e){this.growl=this.$("#@growl");if(this.age_sec<(!e?15:1.5)){this.show(!e)}this.growl.mouseover(this.fnbind(function(e){if(!this.growl.hasClass("fade_out")){clearTimeout(this.hideTimer);this.growl.removeClass("fade_out");this.customMouseOver()}}));this.growl.mouseout(this.fnbind(function(e){this.hideAfter(1)}));this.hideAfter(this.visible_sec)},show:function(e){if(i){e=false}i=true;if(e){this.growl.addClass("fade_in")}this.growl.removeClass("fade_out").removeClass("hidden");if(e){setTimeout(this.fnbind(function(){this.growl.removeClass("fade_in")}),200)}},hideAfter:function(e){this.hideTimer=setTimeout(this.fnbind(function(){this.hide()}),e*1e3)},hide:function(){this.growl.addClass("fade_out");setTimeout(this.fnbind(function(){if(this.growl.hasClass("fade_out")){this.growl.addClass("hidden").removeClass("fade_out");i=false}}),1250)},customMouseOver:function(){}});exports.ProductNotifGrowl=exports.GrowlBase.extend({customMouseOver:function(){if(this.marked_as_read_sent){return}t.rpc("/notifications/mark_as_read_POST").kwargs({snid:this.snid}).send();this.marked_as_read_sent=true}})},{webnode2:true,"w2.quora":true});require.install("app/view/notifications/base",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager");exports.Notif=e.extend({onLoad:function(){var e=this;var i=this.$("#@notif a");var n=i.first();i.click(function(t){if($(this).attr("href")=="#"){t.preventDefault()}if(e.$("#@notif").hasClass("unseen")){e.markAsSeen()}});this.onKeyCombination(n,"o",function(){var e=n.attr("href");n.click();if(e!="#"){t.navigateTo(e)}});if(this.actionBar){this.$("#@content_toggle").click(this.fnbind(function(e){e.preventDefault();this.$("#@notif_content").removeClass("hidden");this.$("#@content_toggle").addClass("hidden")}))}},markAsSeen:function(e){this.serverCall("mark_as_seen").liveMutate().send()}});exports.AggregatedNotif=e.extend({onLoad:function(){var e=this;this.initState("expanded",this.expanded);this.$("#@expand").click(function(){e.state("expanded",!e.state("expanded"));return false});this.$("#@mark").click(function(t){t.preventDefault();e.markAsSeen()})},stateHandlers:{expanded:function(e){var t=this.lookup("list").$("#@notifs"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e)}},markAsSeen:function(){this.serverCall("mark_as_seen").liveMutate().send()}});exports.SentNotifCollectionViewBase=exports.Notif.extend({})},{window_manager:true,"w2.quora":true});require.install("app/view/notifications",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("app/view/notifications/base");exports.NotificationsMain=e.extend({onLoad:function(){t.makeFixable(this.$("#@notifs_nav"),{min_width:990})}});exports.NotificationsClearButton=e.extend({onLoad:function(){this.$("#@clear").click(this.fnbind(function(){this.serverCall("mark_as_seen").liveMutate().send();return false}))}});exports.NotificationPreview=e.extend({onLoad:function(){this.$("#@details").click(this.fnbind(function(){this.$("#@notification_details").toggleClass("hidden");return false}));this.$("#@notification").click(this.fnbind(function(){this.$("#@notification_diff").toggleClass("hidden");this.$("#@notification, #@bullet").hide();return false}))}});exports.UserFollowNotif=exports.BoardItemUpvoteNotif=exports.AnswerAgreeNotif=exports.SubscriptionNewSubscriberToUserNotif=i.Notif.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;if(e.child("name")){e.child("name").$("#@link").attr("href",e.responsibleUserUrl)}}})},{"view/fixable2":true,"app/view/notifications/base":true,"w2.quora":true});require.install("app/view/notifications/header",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("view/toggle");exports.TitleNotificationsCount=e.extend({onLoad:function(e){if(!e){this.setTitle()}},setTitle:function(){var e=t.getTitle(),i=e,n,o="",s;if(this.notif_count||this.inbox_count){o+="(";if(this.notif_count){o+=this.notif_count}if(this.inbox_count){o+="/"+this.inbox_count}o+=") "}i=e.replace(/^\(((\d+)?\/)?\d+\) |/,o);if(e!=i){t.setTitle(i)}}});exports.NextButton=i.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments);this.locked=false;$(document).keydown(this.fnbind(function(e){return this.docKeydown(e)}))},gotoNext:function(){if(this.nextUrl){t.navigateTo(this.nextUrl)}},isLocked:function(){var e=false;$("input, textarea, .qtext_editor_content").each(function(){var t=$(this);if(t.attr("focused")=="true"||t.is(":focus")){e=true;return false}});return this.locked||e},docKeydown:function(e){var t=e||window.event;if(this.isLocked()){return true}if(e.target.isContentEditable||e.target.nodeName=="INPUT"||e.target.nodeName=="TEXTAREA"){return true}if(t.keyCode==39){this.gotoNext();return false}}})},{"view/toggle":true,window_manager:true,"w2.quora":true});require.install("view/hover_menu",function(require,exports,module){require("jquery.whenIdle");var e=require("w2.quora").Component,t=require("Class").Class,i=require("log").log;exports.HoverMenu=e.extend({onLoad:function(e){this.on=this.on||350;this.off=this.off||350;this.st=null;this.ht=null;this.loaded=this.loaded||this.should_preload_menu;this.loading=false;this.shown=false;this.cancelHover=false;if(this.load_on_pageload&&e){this.loadMenu(true)}this.registerClickHandlers();this.maybeRegisterHoverHandlers()},registerClickHandlers:function(){if(this.click_open){var e=this;this.$("#@link").click(function(t){if(e.shown){e.cancelHover=true;e.doHide()}else{e.cancelHover=false;e.loadMenu();e.doShow()}t.preventDefault()});$(document).click(function(t){var i=e.isInvalidCloseTarget($(t.target));if(e.shown&&!i){e.cancelHover=true;e.doHide()}})}else{this.$("#@link").click(this.fnbind(function(){this.cancelHover=true;this.doHide()}))}},isInvalidCloseTarget:function(e){var t=this.$("#@link");if(e.is(t)||e.parents(t).is(t)){return true}return false},maybeRegisterHoverHandlers:function(){if(this.show_menu&&!this.click_open){this.$("#@link").hover(this.fnbind(function(){this.show()}),this.fnbind(function(){this.hide();this.cancelHover=false;this.$("#@link").removeClass("hover")}));this.$("#@menu").hover(this.fnbind(function(){this.show()}),this.fnbind(function(){this.hide()}))}},setPosition:function(){if(!this.css_positioning){var e=this.$("#@link").outerHeight();var t=this.$("#@link").offset();var i=t;var n=$(window).height();var o=275;var s=i.top-$(window).scrollTop();var r=n-s<o;var a=this.menu_offset_px?this.menu_offset_px:0;this.$("#@menu").removeAttr("style");if(r){if(this.attach_to_body){this.$("#@menu").css("bottom",n-t.top+a+"px")}else{this.$("#@menu").css("bottom",e+"px")}this.$("#@menu").addClass("hover_menu_above")}else{if(this.attach_to_body){this.$("#@menu").css("top",t.top+e+1+a+"px")}else{this.$("#@menu").css("top",e+"px")}this.$("#@menu").removeClass("hover_menu_above")}if(this.attach_to_body){var l=$(window).width();var u=this.$("#@menu").outerWidth();var d=u+i.left;var c=i.left;var h=this.$("#@link").outerWidth();if(this.alignment=="right"){this.$("#@menu").css("left",c-u+h+"px")}else if(this.alignment=="center"){this.$("#@menu").css("left",c-u/2+h/2+"px")}else{if(l<d){this.$("#@menu").addClass("right_align");this.$("#@menu").css("left",c-u+h+"px")}else{this.$("#@menu").css("left",c+"px");this.$("#@menu").removeClass("right_align")}}}}},hide:function(){clearTimeout(this.st);this.ht=setTimeout(this.fnbind(this.doHide),this.off)},doHide:function(){if(!this.shown){return}this.shown=false;this.$("#@link").removeClass("hover");this.$("#@menu").addClass("animate_out");setTimeout(this.fnbind(function(){if(!this.shown){this.$("#@menu").removeClass("animate_out");this.$("#@menu").addClass("hidden")}}),150)},getKwargs:function(){if(this.kwargs){return this.kwargs}return{}},okToShowHoverMenu:function(){return this.should_show_hover_menu&&this.$("#@menu").parents(".hover_menu_contents").length===0},show:function(){if(this.okToShowHoverMenu()){this.showInner()}},showInner:function(){clearTimeout(this.ht);this.st=setTimeout(this.fnbind(this.doShow),this.on);this.loadMenu();this.$("#@menu").removeClass("animate_out");this.$("#@link").addClass("hover")},doShow:function(){if(this.shown||this.cancelHover){return}this.shown=true;if(!this.css_positioning&&!this.movedToBody&&this.attach_to_body){this.$("#@menu").detach().prependTo($("body"));this.movedToBody=true}$(".GrowlNotification").hide();this.$("#@menu").removeClass("hidden").show();this.$("#@link").addClass("hover");this.setPosition()},loadMenu:function(e){if(e===undefined){e=false}var t=this.fnbind(function(){if(this.loaded||this.loading){return}if(i&&i.enabled){i("Quora.HoverMenu.loadMenu",this.cid,"is loading, preload =",e)}this.loading=true;this.serverCall("load_menu").kwargs(this.getKwargs()).contentFor(this.$("#@menu_contents"),{parentCID:this.cid}).success(this.fnbind(function(t){if(i&&i.enabled){i("Quora.HoverMenu.loadMenu",this.cid,"is loaded, preload =",e)}this.loaded=true;this.loading=false})).except(this.fnbind(function(t){if(i&&i.enabled){i("Quora.HoverMenu.loadMenu",this.cid,"is failed to load, preload =",e)}this.loading=false})).send()});if(e){$.whenIdle(1,1e3,t,"Quora.HoverMenu.loadMenu")}else{t()}}});exports.ToggleableMenu=t.extend({__init__:function(e){this.$linkElem=e.$linkElem;this.$menuElem=e.$menuElem;this.loadFunction=e.loadFunction;if(!(this.$linkElem&&this.$menuElem&&this.loadFunction)){throw new Error("Invalid kwargs given: "+e)}this.useCssPositioning=e.useCssPositioning||false;this.shouldAttachToBody=e.shouldAttachToBody||true;this.menuOffsetPx=e.menuOffsetPx||0;this.alignment=e.alignment||"left";this.clickOpen=e.clickOpen||false;this.showDelayMs=e.showDelayMs||350;this.hideDelayMs=e.hideDelayMs||350;this.shown=false;this.movedToBody=false;this.cancelHover=false;this.hideTimeout=null;this.showTimeout=null;this.registerHoverHandlers();this.registerClickHandlers()},registerHoverHandlers:function(){if(this.clickOpen){return}this.$linkElem.hover(this.showMenuSlow.bind(this),function(){this.hideMenuSlow();this.cancelHover=false;this.$linkElem.removeClass("hover")}.bind(this));this.$menuElem.hover(this.showMenuSlow.bind(this),this.hideMenuSlow.bind(this))},registerClickHandlers:function(){if(this.clickOpen){this.$linkElem.click(this.toggleMenu.bind(this));$(document).on("click",this.maybeHideMenu.bind(this))}else{this.$linkElem.click(this.hideMenu.bind(this))}},toggleMenu:function(e){e.preventDefault();if(this.shown){this.cancelHover=true;this.hideMenu()}else{this.cancelHover=false;this.loadFunction();this.showMenu()}},maybeHideMenu:function(e){var t=e.target;var i=this.$linkElem.get(0);if(t==i||t.parentNode==i){return}this.hideMenu()},hideMenuSlow:function(){clearTimeout(this.showTimeout);this.hideTimeout=setTimeout(this.hideMenu.bind(this),this.hideDelayMs)},hideMenu:function(){if(!this.shown){return}this.cancelHover=true;this.shown=false;this.$linkElem.removeClass("hover");this.$menuElem.addClass("animate_out");setTimeout(function(){if(this.shown){return}this.$menuElem.removeClass("animate_out");this.$menuElem.addClass("hidden")}.bind(this),150)},shouldShowMenu:function(){return this.$menuElem.parents(".hover_menu_contents").length===0},showMenuSlow:function(){if(!this.shouldShowMenu()){return}clearTimeout(this.hideTimeout);this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelayMs);this.loadFunction();this.$menuElem.removeClass("animate_out");this.$linkElem.addClass("hover")},showMenu:function(){if(this.shown||this.cancelHover){return}this.shown=true;this.moveMenuToBody();$(".GrowlNotification").hide();this.$menuElem.removeClass("hidden").show();this.$linkElem.addClass("hover");this.setPosition()},moveMenuToBody:function(){if(this.useCssPositioning||this.movedToBody||!this.shouldAttachToBody){return}this.movedToBody=true;this.$menuElem.detach().prependTo($("body"))},setPosition:function(){if(!this.useCssPositioning){var e=$(window);var t=this.$linkElem.outerHeight();var i=this.$linkElem.offset();var n=i;var o=e.height();var s=275;var r=n.top-e.scrollTop();var a=o-r<s;this.$menuElem.removeAttr("style");if(a){if(this.shouldAttachToBody){this.$menuElem.css("bottom",o-i.top+this.menuOffsetPx+"px")}else{this.$menuElem.css("bottom",t+"px")}this.$menuElem.addClass("hover_menu_above")}else{if(this.shouldAttachToBody){this.$menuElem.css("top",i.top+t+1+this.menuOffsetPx+"px")}else{this.$menuElem.css("top",t+"px")}this.$menuElem.removeClass("hover_menu_above")}if(this.shouldAttachToBody){var l=e.width();var u=this.$menuElem.outerWidth();var d=u+n.left;var c=n.left;var h=this.$linkElem.outerWidth();if(l<d){var f=d-l;if(this.alignment=="left"){c-=f+10}}if(this.alignment=="right"){this.$menuElem.css("left",c-u+h+"px")}else if(this.alignment=="center"){this.$menuElem.css("left",c-u/2+h/2+"px")}else{this.$menuElem.css("left",c+"px")}}}}})},{log:true,Class:true,"jquery.whenIdle":true,"w2.quora":true});require.install("view/editable_list",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings").interface_strings;exports.EditableList=e.extend({onLoad:function(){var e=this;e.setEditLink();setTimeout(function(){e.update()},1);e.initState();e.bindClickHandler()},setEditLink:function(){this.editLink=this.$("#@edit")},initState:function(){this.editLink.removeClass("hidden")},bindClickHandler:function(){this.editLink.click(this.fnbind(function(e){e.preventDefault();this.toggleEdit()}))},toggleEdit:function(){this.is_editing=!this.is_editing;this.update()},update:function(){if(this.is_editing){this.$("#@wrapper").addClass("is_editing");this.editLink.text(t.done)}else{this.$("#@wrapper").removeClass("is_editing");this.editLink.text(this.edit_text)}}});exports.EditableListItem=e.extend({onLoad:function(){this.$("#@remove").click(this.fnbind(function(e){this.serverCall("remove").liveMutate().send()}))}})},{settings:true,"w2.quora":true});require.install("app/view/navigation",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("view/hover_menu").HoverMenu,n=require("view/editable_list").EditableList;exports.SettingsNavListContents=n.extend({onLoad:function(){this._super.apply(this,arguments);t.makeFixable(this.$("#@wrapper"),{min_width:990})}});exports.HomeNavList=n.extend({setEditLink:function(){var e=this.lookup("hover_menu").$("#@link");this.editLink=e}});exports.HomeNavListHoverMenu=i.extend({isInvalidCloseTarget:function(e){var t=this.$("#@menu");var i=this._super.apply(this,arguments);if(i||e.parents().filter(t).length>0||e.hasClass("HomeNavListItem")||e.hasClass("remove_link")){return true}if(this.shown){this.parent().toggleEdit()}return false}});exports.TrendingTopicsNavListItem=e.extend({onLoad:function(){var e=this;this.$("#@tid").on("click",function(t){e.metaKey=t.metaKey;e.serverCall("log_click").success(function(){if(e.metaKey){return}window.location.href=e.uri}).error(function(){if(e.metaKey){return}window.location.href=e.uri}).send()});return false}});exports.ReadLaterFilters=e.extend({onLoad:function(){t.makeFixable(this.$("#@filters"),{min_width:990})}})},{"view/fixable2":true,"view/editable_list":true,"view/hover_menu":true,"w2.quora":true});require.install("app/view/nux",function(require,exports,module){var e=require("w2.quora").Component;exports.ProgressBar=e.extend({onLoad:function(){this.$("#@progress_bar").css({width:this.getWidth()})},getWidth:function(){var e=parseInt(this.$("#@progress_bar_wrapper").css("min-width"),10);var t=parseInt(this.$("#@progress_bar_wrapper").css("max-width"),10);var i=this.curr/this.total*t;return Math.min(t,Math.max(i,e))},update:function(e){this.curr=e;this.$("#@progress_bar").animate({width:this.getWidth()})}});exports.ProgressBarBeacon=e.extend({onLoad:function(){this.lookup("progress_bar").update(this.curr)}});exports.HeaderProgressBarBeacon=e.extend({onLoad:function(){this.cQuery(":dialog.header_progress_bar").update(this.curr)}})},{"w2.quora":true});require.install("app/view/nux/dialog",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2");exports.SetPasswordForm=e.extend({onLoad:function(){this.$("#@password").focus();this.$("#@form").submit(this.fnbind(this.onSubmit));this.validPassword=false;this.$("#@password").keyup(this.fnbind(this.onKeyup))},onKeyup:function(){var e=this;var t=e.$("#@password").val().length;if(t<=2){e.$("#@form").find(".error, .success").addClass("hidden");e.$("#@submit").attr("disabled","disabled").addClass("submit_button_disabled")}else if(t<5){e.$("#@form").find(".error").removeClass("hidden");e.$("#@form").find(".success").addClass("hidden");e.validPassword=false;e.$("#@submit").attr("disabled","disabled").addClass("submit_button_disabled")}else if(t>75){e.$("#@form").find(".error").removeClass("hidden");e.$("#@form").find(".success").addClass("hidden");e.validPassword=false;e.$("#@submit").attr("disabled","disabled").addClass("submit_button_disabled")}else{e.$("#@form").find(".error").addClass("hidden");e.$("#@form").find(".success").removeClass("hidden");e.validPassword=true;e.$("#@submit").removeAttr("disabled").removeClass("submit_button_disabled")}},validate:function(){var e=this.$("#@password").val().length;if(e<5||e>75){return false}this.child("password_validator").validate();return true},onSubmit:function(){var e=this;if(!e.validPassword){return false}e.$("#@spinner").show();e.$("#@form").find(".password_state").addClass("hidden");e.serverCall("set_password").kwargs({password:e.$("#@password").val()}).success(function(){e.parent().onPasswordSet(true)}).error(function(){e.parent().onPasswordSet(false)}).send();return false}});exports.ModalNuxDialogCloseIndicator=e.extend({onLoad:function(){$(document).trigger("nux_dialog_close");var e=this.lookup("paged_feed",true);if(e){e.dontLogImpressions=false}}});exports.ModalNuxDialog=e.extend({onLoad:function(e){this.lastStep=null;var t=this.lookup("paged_feed",true);if(t){t.dontLogImpressions=true}if(e){this.serverCall("log_impression").send()}if($(window).height()<600){$(".dialog .dialog_wrapper").css("position","static")}},hide:function(){this.$("#@modal_nux_wrapper").hide()}});exports.InternalModalNuxDialogRenderer=exports.ModalNuxDialog.extend({onLoad:function(e){var t=this;this.curr_step=this.step_num;$("body").keydown(this.fnbind(function(e){if(e.keyCode==37&&t.curr_step>0){t.changeStep(t.curr_step,--t.curr_step)}else if(e.keyCode==39&&t.curr_step<t.num_steps-1){t.changeStep(t.curr_step,++t.curr_step)}}));this.$("#@modal_nux_wrapper .step_name").click(function(){if(!$(this).hasClass("curr_step")){var e=parseInt($(this).attr("id"));t.changeStep(t.curr_step,e);t.curr_step=e}})},changeStep:function(e,t){this.$("#@modal_nux_wrapper .dialog_wrapper.step_"+e).parent().addClass("hidden");this.$("#@modal_nux_wrapper .step_name.step_name_"+e).removeClass("curr_step");this.$("#@modal_nux_wrapper .dialog_wrapper.step_"+t).parent().removeClass("hidden");this.$("#@modal_nux_wrapper .step_name.step_name_"+t).addClass("curr_step")}});exports.NuxDialogStep=e.extend({onLoad:function(){this.serverCall("record_step").kwargs({step_name:this.step_name+"_impr"}).send()},gotoStep:function(e){this.cQuery(":dialog.header_progress_bar").update(e);this.serverCall("goto_step").kwargs({step_num:e}).liveMutate().send()},closeDialogAndGoToStep:function(e){this.dialog_close=false;if(e>this.num_steps){var t=this.lookup("dialog",true);if(t){t.hide()}$(document).trigger("nux_dialog_close");this.dialog_close=true}this.gotoStep(e)},gotoNextStep:function(){this.closeDialogAndGoToStep(this.step_num+1)},skipNextStep:function(){var e=this.step_num+2;this.dialog_close=false;if(e<=this.num_steps){this.cQuery(":dialog.header_progress_bar").update(this.step_num+1)}else{this.lookup("dialog").hide();$(document).trigger("nux_dialog_close");this.dialog_close=true}this.serverCall("skip_step").kwargs({step_num:this.step_num+1}).liveMutate().send()},stepUrl:function(e){return"#step="+e},standaloneRefreshFeed:function(){this.serverCall("standalone_refresh_feed").liveMutate().send()}});exports.NuxDialogSetPasswordStep=exports.NuxDialogStep.extend({onPasswordSet:function(e){this.gotoNextStep()}});exports.NuxDialogSiloActivationStep=exports.NuxDialogStep.extend({onActivate:function(){this.gotoNextStep()}});exports.NuxDialogRefreshFeedStep=exports.NuxDialogStep.extend({onLoad:function(){this._super.apply(this,arguments);this.serverCall("refresh_feed").liveMutate().success(this.fnbind(function(){this.delayed_next_step();return false})).error(this.fnbind(function(){this.delayed_next_step();return false})).send()},delayed_next_step:function(){if(this.page_context!="internal_page"){setTimeout(this.fnbind(this.gotoNextStep),5500)}},gotoStep:function(e){this.serverCall("goto_step").kwargs({step_num:e}).send()}});exports.PowerUserFindFriendsStep=exports.NuxDialogStep.extend({maybeLoadFollowFriendsDialog:function(){var e=this;this.serverCall("should_load_follow_dialog").success(function(t){if(t){e._loadFollowDialog()}else{e._closeDialog()}}).error(this._closeDialog).send()},_loadFollowDialog:function(){this._closeDialog();this.dialog(false).close(null).title(this.dialog_title).load("get_follow_friends_dialog")},_closeDialog:function(){var e=require("webnode2").Dialog.dialogFor(this);e.close_()}});exports.NuxDialogContinueButton=e.extend({events:{"click #@next":"onClick"},onLoad:function(){if(this.standalone){this.standalone_dialog=this.lookup("standalone");this.dialog_step=this.parent()}},finishStep:function(){if(!this.$("#@next").hasClass("submit_button_disabled")){if(this.standalone){this.dialog_step.standaloneRefreshFeed();t.Dialog.dialogFor(this.standalone_dialog).close_()}else{if(this.parent()){this.parent().gotoNextStep()}}}},onClick:function(){this.finishStep();return false}});exports.NuxDialogInferredFriendsContinueButton=exports.NuxDialogContinueButton.extend({events:{"click #@next":"onClick"},onLoad:function(){this._super.apply(this,arguments);this.fuid_map={};for(var e=0;e<this.unchecked_fuids.length;++e){this.fuid_map[this.unchecked_fuids[e]]=false}for(var t=0;t<this.checked_fuids.length;++t){this.fuid_map[this.checked_fuids[t]]=true}},onClick:function(e){e.preventDefault();this.serverCall("button_clicked").kwargs({fuid_map:this.fuid_map,prechecked_fuids:this.checked_fuids}).success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()},add:function(e){this.fuid_map[e]=true},remove:function(e){this.fuid_map[e]=false},addAll:function(){for(var e in this.fuid_map){this.add(e)}},removeAll:function(){for(var e in this.fuid_map){this.remove(e)}}});exports.NewNuxDialogSkipButton=exports.NuxDialogContinueButton.extend({events:{"click #@next":"onClick"},onClick:function(e){e.preventDefault();this.serverCall("button_clicked").success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()},finishStep:function(){if(!this.$("#@next").hasClass("submit_button_disabled")){if(this.standalone){t.Dialog.dialogFor(this).close_()}else{if(this.parent()){this.parent().gotoNextStep()}}}}});exports.NuxDialogFollowMinimumTopicsContinueButton=exports.NuxDialogContinueButton.extend({onClick:function(e){e.preventDefault();if(this.$("#@next").hasClass("submit_button_disabled")){return false}this.serverCall("button_clicked").kwargs({tids:this.lookup("dynamic_topic_grid").newTids}).liveMutate().success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()},finishStep:function(){if(this.standalone){t.Dialog.dialogFor(this.standalone_dialog).close_()}else{this._super.apply(this,arguments)}},updateButton:function(e){var t=this.min_interests-e;if(t>=1){this.$("#@next").addClass("submit_button_disabled").text(this.num_topics_texts[t])}else{this.$("#@next").removeClass("submit_button_disabled").text(this.button_continue_text)}}});exports.DynamicTopicGrid=e.extend({newTids:[],onLoad:function(){this.newTids=[]},addTopic:function(e){this.followedTids.push(e);this.newTids.push(e);this.updateContinueButton()},addRow:function(e){this.$("#@more").append('<span class="new_items"></span>');var t=this.$("#@more").children(".new_items").last();this.serverCall("load_row").kwargs({tid:e}).contentFor(t,{parentCID:this.cid}).sendOnlyOnce()},getFollowingCount:function(){return this.followedTids.length},removeTopic:function(e){var t=$.inArray(e,this.followedTids);if(t!=-1){this.followedTids.splice(t,1)}this.updateContinueButton();t=$.inArray(e,this.newTids);if(t!=-1){this.newTids.splice(t,1)}},updateContinueButton:function(){this.lookup("continue_button").updateButton(this.getFollowingCount())}});exports.DynamicInterestsGrid=exports.DynamicTopicGrid.extend({addTopic:function(e){this._super.apply(this,arguments);this.addRow(e)}});exports.InterestsGridItems=e.extend({onLoad:function(){var e=this.new_tids;for(var t=0;t<e.length;t++){this.lookup("dynamic_topic_grid").shownTids.push(e[t])}}});exports.ExpertiseTopicListItemRemoveButton=e.extend({onLoad:function(){this.$("#@expertise-remove-button").click(this.fnbind(this.dismiss))},dismiss:function(e){e.preventDefault();this.serverCall("remove_expertise_topic").kwargs({tid:this.tid}).liveMutate().send();return false}});exports.NuxDialogFollowExpertiseContinueButton=exports.NuxDialogFollowMinimumTopicsContinueButton.extend({onClick:function(e){e.preventDefault();this.serverCall("button_clicked").liveMutate().success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()}})},{webnode2:true,"w2.quora":true});require.install("app/view/nux/existing_user",function(require,exports,module){var e=require("w2.quora").Component;exports.ExistingUserNuxSidebar=e.extend({onLoad:function(){this.serverCall("track_impression").send()}});exports.ExistingUserNuxButton=e.extend({onLoad:function(){this.$("#@existing-user-nux").click(this.fnbind(this.initate))},initate:function(e){e.preventDefault();this.serverCall("start_existing_user_nux").liveMutate().send();return false}});exports.ExistingUserNuxDismiss=e.extend({onLoad:function(){this.$("#@existing-user-nux-dismiss").click(this.fnbind(this.dismiss))},dismiss:function(e){e.preventDefault();this.serverCall("dismiss_existing_user_nux").liveMutate().send();return false}})},{"w2.quora":true});require.install("app/view/nux/find_friends",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("twitter"),n=require("facebook"),o=require("view/paged_list").PagedList;exports.FacebookFindFriendsButton=n.FacebookConnectButton.extend({events:{"click #@facebook_follow_button":"onClick"},onClick:function(){if(n.isInitialized()){this.serverCall("button_clicked").send();this.connect()}return false;
},onLogin:function(e){this.showLoading();this._super.apply(this,arguments)},closeDialog:function(){this.trigger("fb_connected");if(this.standalone){t.Dialog.dialogFor(this).close_();if(this.parent()){this.parent().standaloneRefreshFeed()}}},_onLogin:function(e){var t=this.serverCall("connect_facebook").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn});if(this.live_mutate){t.liveMutate()}t.success(this.fnbind(this.closeDialog)).error(this.fnbind(this.closeDialog)).send()},onLoginFailed:function(){this.serverCall("record_connect_failure").send()},showLoading:function(){this.$("#@normal_text").hide();this.$("#@loading_text").show();this.$("#@row").addClass("complete")}});exports.FacebookFindFriendsAndContinueButton=exports.FacebookFindFriendsButton.extend({onLoginFailed:function(){if(this.standalone){t.Dialog.dialogFor(this).close_()}else{this.serverCall("login_failed").liveMutate().send()}this.serverCall("record_connect_failure").send()}});exports.PowerUserFacebookFindFriendsAndContinueButton=exports.FacebookFindFriendsAndContinueButton.extend({onLoginFailed:function(){t.Dialog.dialogFor(this).close_();this.serverCall("record_connect_failure").send()},_onLogin:function(e){this.serverCall("connect_facebook").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn}).success(this.fnbind(this.closeDialogSuccess)).error(this.fnbind(this.closeDialog)).send()},closeDialog:function(){t.Dialog.dialogFor(this).close_()},closeDialogSuccess:function(){this.lookup("power_user_find_friends_dialog").maybeLoadFollowFriendsDialog()}});exports.FriendFollowIndicatorLink=e.extend({events:{"click #@toggle":"onClick"},onLoad:function(){this.toggle=this.$("#@toggle");this.continue_button=this.lookup("continue_button")},onClick:function(){this.$("#@toggle").toggleClass("selected");this.$("#@toggle").toggleClass("unselected");if(this.toggle.hasClass("selected")){this.continue_button.add(this.fuid)}else{this.continue_button.remove(this.fuid)}$(document).trigger("friendFollowChanged")}});exports.FriendToggleCheckbox=e.extend({events:{"click #@friend_row":"onClick"},onLoad:function(){this.checkbox=this.$("#@friend_row").find(":checkbox");this.checkbox.change(this.fnbind(function(){this.checkbox.prop("checked",!this.checkbox.prop("checked"))}));this.continue_button=this.lookup("continue_button")},onUnload:function(){this.checkbox.unbind()},onClick:function(){this.checkbox.prop("checked",!this.checkbox.prop("checked"));if(this.checkbox.prop("checked")){this.continue_button.add(this.fuid);this.$("#@friend_row").find(".follow_button").addClass("unfollow_button").text("â")}else{this.continue_button.remove(this.fuid);this.$("#@friend_row").find(".follow_button").removeClass("unfollow_button").text(this.follow_text)}}});exports.UnfollowedInferredFriendsToggleLink=e.extend({events:{"click #@add":"onAddClick","click #@remove":"onRemoveClick"},onLoad:function(){this.friends_list=$(this.lookup("inferred_friends_dialog").$("#@friends_list"));this.continue_button=this.lookup("continue_button")},changeAll:function(e){this.friend_toggles.prop("checked",e);if(e===true){this.friends_list.find(".follow_button").addClass("unfollow_button").text("â")}else{this.friends_list.find(".follow_button").removeClass("unfollow_button").text(this.follow_text)}},updateFriendsList:function(){if(!this.action){return}this.friend_toggles=this.friends_list.find(":checkbox");this.changeAll(this.action=="add_all"?true:false)},onAddClick:function(){this.friend_toggles=this.friends_list.find(":checkbox");this.action="add_all";this.changeAll(true);this.friends_list.find(".follow_toggle").addClass("selected");this.friends_list.find(".follow_toggle").removeClass("unselected");this.$("#@add").hide();this.$("#@remove").show();this.continue_button.addAll();this.serverCall("button_clicked").kwargs({button_name:this.action}).send()},onRemoveClick:function(){this.friend_toggles=this.friends_list.find(":checkbox");this.action="remove_all";this.changeAll(false);this.friends_list.find(".follow_toggle").addClass("unselected");this.friends_list.find(".follow_toggle").removeClass("selected");this.$("#@add").show();this.$("#@remove").hide();this.continue_button.removeAll();this.serverCall("button_clicked").kwargs({button_name:this.action}).send()}});exports.InferredFriendsList=o.extend({onUpdate:function(e){this._super.apply(this,arguments);var t=this.lookup("select_all_toggle");if(t){t.updateFriendsList()}}})},{webnode2:true,twitter:true,"view/paged_list":true,facebook:true,"w2.quora":true});require.install("app/view/activation/endorsement",function(require,exports,module){var e=require("w2.quora").Component;exports.EndorsementListItem=e.extend({onLoad:function(){this.$("#@remove_endorsement").click(this.fnbind(this.remove))},remove:function(e){e.preventDefault();this.serverCall("remove_endorsement").liveMutate().sendOnlyOnce()}});exports.AcceptEndorsementTopicButton=e.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(this.accept))},accept:function(e){e.preventDefault();this.serverCall("accept").liveMutate().sendOnlyOnce()}});exports.DeclineEndorsementTopicButton=e.extend({onLoad:function(){this.$("#@decline").click(this.fnbind(this.decline))},decline:function(e){e.preventDefault();this.serverCall("decline").liveMutate().sendOnlyOnce()}})},{"w2.quora":true});require.install("app/view/activation/endorsement/modal",function(require,exports,module){var e=require("w2.quora").Component;exports.EndorsedTopicsModalLink=e.extend({onLoad:function(){this.$("#@create_modal_link").click(this.fnbind(function(e){e.preventDefault();this.modal("load_inner")}))}});exports.UserTopicEndorsementsLink=e.extend({onLoad:function(){this.$("#@create_modal_link").click(this.fnbind(function(e){e.preventDefault();this.modal("load_inner")}));this.$("#@endorse_link").click(this.fnbind(function(e){e.preventDefault();this.serverCall("endorse_user").liveMutate().send()}));this.$("#@unendorse_link").click(this.fnbind(function(e){e.preventDefault();this.serverCall("unendorse_user").liveMutate().send()}))}})},{"w2.quora":true});require.install("app/view/activation/endorsement/endorse_by_topic",function(require,exports,module){var e=require("w2.quora").Component;var t=0;exports.EndorseByTopicSidebarNextButton=e.extend({onLoad:function(){this.$("#@sidebar-header-button").click(this.fnbind(this.next))},next:function(e){e.preventDefault();this.lookup("content").nextTopic()}});exports.EndorsementPeopleSelectorContainer=e.extend({onLoad:function(){this.lookup("people_selector").addQuestionBoxClass("ignore_interaction")},setTo:function(e){if(isNaN(parseInt(e))){return}this.lookup("people_selector").reset();this.addEndorsement(e)},addEndorsement:function(e){this.serverCall("add_endorsement").kwargs({to_uid:e}).send()}});exports.EndorseByTopicSidebarContent=e.extend({onLoad:function(){if(this.topicShown){this.serverCall("track_impression").sendOnlyOnce();t++;if(t>1){this.$("#@activation_sidebar_content").find(".question_box").focus()}}},nextTopic:function(){this.serverCall("next_topic").liveMutate().sendOnlyOnce()}})},{"w2.quora":true});require.install("app/view/activation/endorsement/endorse_by_user",function(require,exports,module){var e=require("w2.quora").Component;var t=0;exports.EndorseByUserSidebarNextButton=e.extend({onLoad:function(){this.$("#@sidebar-header-button").click(this.fnbind(this.next))},next:function(e){e.preventDefault();this.lookup("content").nextUser()}});exports.EndorseByUserSidebarContent=e.extend({onLoad:function(){if(this.userShown){this.serverCall("track_impression").sendOnlyOnce();t++;if(t>1){this.$("#@activation_sidebar_content").find(".question_box").focus()}}},nextUser:function(){this.serverCall("next_user").liveMutate().sendOnlyOnce()}})},{"w2.quora":true});require.install("app/view/activation/profile_topics",function(require,exports,module){var e=0;var t=require("w2.quora").Component;exports.CompleteProfileSidebarNextButton=t.extend({onLoad:function(){this.$("#@sidebar-header-button").click(this.fnbind(this.next))},next:function(e){e.preventDefault();this.lookup("content").completeStep()}});exports.CompleteProfileContents=t.extend({onLoad:function(){this.serverCall("track_impression").send()},completeStep:function(){this.serverCall("complete_topic_step").liveMutate().sendOnlyOnce()}});exports.CompleteProfileTopicSelectorContainer=t.extend({onLoad:function(){e++;if(e>1){this.$("#@topic_selector_container").find(".question_box").focus()}}});exports.TopicStepListItem=t.extend({onLoad:function(){this.$("#@remove_button").click(this.fnbind(this.remove))},remove:function(e){e.preventDefault();this.serverCall("remove_topic").liveMutate().send()}})},{"w2.quora":true});require.install("app/view/activation/progress",function(require,exports,module){var e=require("w2.quora").Component;exports.ProgressBar=e.extend({onLoad:function(){var e=this;if(e.getMaxWidth()===0){setTimeout(function(){e.initialize()},1)}else{e.initialize()}},getMaxWidth:function(){return this.$("#@progress_bar_wrapper").width()},initialize:function(){this.$("#@progress_bar").css({width:this.getWidth()})},getWidth:function(){var e=this.getMaxWidth();var t=this.curr/this.total*e;return Math.min(e,t)},update:function(e){this.curr=e;this.$("#@progress_bar").animate({width:this.getWidth()})}});exports.ProgressBarBeacon=e.extend({onLoad:function(){this.lookup("progress_bar").update(this.curr)}})},{"w2.quora":true});require.install("app/view/activation/topic_bios",function(require,exports,module){var e=require("w2.quora").Component;exports.TopicBiosContents=e.extend({onLoad:function(){this.serverCall("track_impression").send()}});exports.TopicStepListItem=e.extend({onLoad:function(){this.$("#@remove_button").click(this.fnbind(this.remove))},remove:function(e){e.preventDefault();this.serverCall("remove_topic").liveMutate().send()}})},{"w2.quora":true});require.install("app/view/post",function(require,exports,module){var e=require("w2.quora").Component;exports.PostSuggestedEditDiscardButtonInline=e.extend({onLoad:function(){var e=this;this.$("#@submit").click(function(t){e.serverCall("discard_suggested_edit").kwargs({pid:e.pid}).liveMutate().send();t.preventDefault()})}})},{"w2.quora":true});require.install("app/view/user",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("cookies"),n=require("settings"),o=require("view/modal").Base,s=n.interface_strings;exports.AcceptSuggestedSigButton=e.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(this.accept))},accept:function(e){e.preventDefault();this.serverCall("accept").liveMutate().sendOnlyOnce()}});exports.DiscardSuggestedSigButton=e.extend({onLoad:function(){var e=this;this.$("#@discard").on("click",function(t){e.discard(t)})},discard:function(e){e.preventDefault();this.serverCall("discard").liveMutate().sendOnlyOnce()}});exports.ReviewSuggestedSigButton=e.extend({onLoad:function(){this.$("#@review").click(this.fnbind(this.review))},review:function(e){e.preventDefault();e.stopPropagation();this.modal("get_editor")}});exports.BioRequestNotifButton=e.extend({onLoad:function(){this.$("#@add_bio").click(this.fnbind(this.add))},add:function(e){e.preventDefault();e.stopPropagation();this.modal("get_editor")}});exports.UserTopicSig=e.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){this.toggleSuggestion();return false}));if(this.isFlagged){var e;if(this.isNotHelpful){e=this.not_helpful_tooltip}else if(this.isNotStandalone){e=this.not_standalone_tooltip}this.$("#@sig").tooltip({contents:e})}},toggleSuggestion:function(){this.$("#@pending").toggle();this.$("#@view").toggle()}});exports.TopicSigSelectionModal=o.extend({onLoad:function(){var e=this;e.input=e.$("#@input");e.input.on("input",function(){var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$("#@limit").text(t)}else{e.$("#@limit").text("")}});var t=e.input.val();e.input.focus();e.input.val("");e.input.val(t);var i=parseInt(e.max_length)-e.input.val().length;if(i<=e.warning_length){e.$("#@limit").text(i)}else{e.$("#@limit").text("")}e._super.apply(e,arguments)},onSubmit:function(){this.submitSig()},submitSig:function(){var e=this;var t=this.$("#@checkbox").is(":checked");this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val(),experienced:t}).liveMutate().send();e._closeModal()}});exports.TopicSelectionForQuestionModal=exports.TopicSigSelectionModal.extend({submitSig:function(){var e=this;var t=this.$("#@checkbox").is(":checked");this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val(),experienced:t}).success(function(){e.modal("load_multi_topic_selection_modal_for_question")}).liveMutate().send()},onCancel:function(){this.modal("load_multi_topic_selection_modal_for_question")}});exports.UserBioSelectionModal=o.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.input=e.$("#@input");var t=e.input.val();e.input.on("input",function(){var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$("#@limit").text(t)}else{e.$("#@limit").text("")}});this.input.focus();this.input.val("");this.input.val(t);var i=parseInt(e.max_length)-e.input.val().length;if(i<=e.warning_length){e.$("#@limit").text(i)}else{e.$("#@limit").text("")}},onSubmit:function(){var e=this;this.serverCall("update_sig").kwargs({sig:this.input.val()}).success(function(){e._closeModal()}).liveMutate().send()}});exports.UserBioInMultiTopicBioModal=exports.UserBioSelectionModal.extend({onSubmit:function(){var e=this;this.serverCall("update_sig").kwargs({sig:this.input.val()}).success(function(){e.modal("load_multi_topic_selection_modal_for_question")}).send()},onCancel:function(){this.modal("load_multi_topic_selection_modal_for_question")},onClose:function(){this.modal("load_multi_topic_selection_modal_for_question")}});exports.SuggestedTopicModal=o.extend({onLoad:function(){var e=this;e.input=this.$("#@input");e.text=e.input.val();e.canEdit=e.viewer==e.uid;e.input.on("input",function(){var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$("#@limit").text(t)}else{e.$("#@limit").text("")}});e.input.focus();e.input.val("");e.input.val(this.text);var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$("#@limit").text(t)}else{e.$("#@limit").text("")}e._super.apply(this,arguments)},acceptSig:function(){var e=this;var t=this.$("#@checkbox").is(":checked");this.serverCall("accept").liveMutate().kwargs({experienced:t}).success(function(){e._closeModal()}).send()},discardSig:function(){this.serverCall("discard").liveMutate().send()},onSubmit:function(){if(this.canEdit&&this.input.val()==this.text){this.acceptSig()}else{this.submitSig()}},submitSig:function(){var e=this;var t=this.$("#@checkbox").is(":checked");this.serverCall("update_sig").liveMutate().kwargs({viewer:this.viewer,sig:this.input.val(),experienced:t}).success(function(){e._closeModal()}).send();return false},onCancel:function(){this.discardSig();this._closeModal()},onClose:function(){this._closeModal()}});exports.QuestionUserSigEditLink=exports.UserSigEditLinkDialog=exports.TopicSigEditLinkDialog=e.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this.showDialog();return false}))},showDialog:function(){this.modal("get_editor");return false}});exports.LinkBioListItem=e.extend({onLoad:function(){var e=this;if(e.tid===0){this.$("#@link").on("click",function(){e.showDialog();return false})}else{this.$("#@link").on("click",function(){e.modal("load_modal");return false})}},showDialog:function(){this.modal("get_editor");return false}});exports.QuestionTopicSigEditLink=e.extend({onLoad:function(){var e=this;this.$("#@link").on("click",function(){e.modal("load_modal");return false})}});exports.SetTopicForQuestionLinkSpan=e.extend({onLoad:function(){var e=this;var t=e.lookup("bio_list_item");if(t){t.$("#@bio_list_item").click(function(){if(e.$("#@radio")){e.unselectAll();e.setBio()}})}e.$("#@radio").click(function(t){e.unselectAll();e.setBio();t.stopPropagation()})},unselectAll:function(){var e=$(".SetTopicForQuestionLinkSpan input[type=radio]");for(var t=0;t<e.length;t++){e[t].checked=false;var i=this.lookup("bio_list_item");if(i){i.$("#@bio_list_item").removeClass("selected")}}},setBio:function(){this.$("#@radio").checked=true;var e=this.lookup("bio_list_item");if(e){e.$("#@bio_list_item").addClass("selected");this.serverCall("set_bio").liveMutate().send()}}});exports.ProfileBioListItem=e.extend({onLoad:function(){if(this.isFlagged){var e;if(this.isNotHelpful){e=this.not_helpful_tooltip}else if(this.isNotStandalone){e=this.not_standalone_tooltip}this.$("#@sig").tooltip({contents:e})}}});exports.ProfilePhoto=e.extend({toggleSuggestion:function(){this.$("#@view_pending").toggleClass("hidden");this.$("#@pending").toggleClass("hidden");var e=this.parent().$("#@user_action_link");if($(this.$("#@pending")).is(":visible")){e.addClass("w1").removeClass("w1_5")}else{e.removeClass("w1").addClass("w1_5")}}});exports.WantedAnswerDialog=require("dialog").Dialog.extend({onLoad:function(e){this._super.apply(this,arguments);this.child("question_selector").focus();this.setSuccessCallback(this.fnbind(function(e){if(e){t.navigateTo(e)}}))},getPars:function(){var e=this.child("question_selector").getQid();var t=this.child("question_selector").qValue;return{qid:e,text:t}}});exports.UserFollowLink=e.extend({onLoad:function(){this.$("#@follow_user").click(this.fnbind(function(e){this.follow();e.preventDefault()}));this.$("#@unfollow_user").click(this.fnbind(function(e){this.unfollow();e.preventDefault()}));this.onKeyCombination(this.$("#@follow_user"),"f",this.fnbind(this.follow));this.onKeyCombination(this.$("#@unfollow_user"),"f",this.fnbind(this.unfollow))},follow:function(){i.setQfeedLog(this,"UserFollow");i.setQueryLog(this,"UserFollow");i.setTlog({type:"UserFollow",uid:this.uid});this.serverCall("follow_user").liveMutate().send()},unfollow:function(){i.setQfeedLog(this,"UserUnfollow");i.setQueryLog(this,"UserUnfollow");i.setTlog({type:"UserUnfollow",uid:this.uid});this.serverCall("unfollow_user").liveMutate().send()}});exports.UserSig=e.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){this.toggleSuggestion();return false}))},toggleSuggestion:function(){this.$("#@pending").toggle();this.$("#@view").toggle()}});exports.BatchRevertControls=e.extend({onLoad:function(){this.$("#@select_all_check").change(this.fnbind(function(e){this.toggleCheckboxes();return false}));this.$("#@select_all_word").click(this.fnbind(function(e){this.toggleCheckboxes();return false}));this.$("#@revert").click(this.fnbind(function(){this.batchRevert();return false}))},batchRevert:function(){var e=[];this.$(".user_log_operations_to_revert input:checked").each(function(t){e.push($(this).attr("name"))});if(e.length===0){return false}this._dialog=this.dialog().title(this.dialog_title).cancel(null,s.cancel).ok(this.fnbind(function(t){var i=t.dialogComponent;var n=i.lookup("editor");if(n.isEmpty()){return}var o=n.serialize();this.serverCall("batch_revert").kwargs({revert_strings:e,comment:o}).liveMutate().send()})).load("batch_revert_dialog");return false},toggleCheckboxes:function(){var e=this.$(".user_log_operations_to_revert .pagedlist_hidden input:not(:disabled)").length;var t=this.$(".user_log_operations_to_revert input:not(:disabled)").length-e;var i=this.$(".user_log_operations_to_revert input:checked").length;if(t!=i){this.$("#@select_all_check").attr("checked",true);this.$("input:not(:disabled)").attr("checked",true);this.$(".user_log_operations_to_revert .pagedlist_hidden input").each(function(e){$(this).attr("checked",false)})}else{this.$("#@select_all_check").attr("checked",false);this.$("input:not(:disabled)").attr("checked",false)}},getKwargs:function(e,t){return{revert_strings:e,comment:t.serialize()}}});exports.UnconfirmedEmailBlockedEditor=e.extend({onLoad:function(){this.$("#@resend").click(this.fnbind(function(){this.serverCall("resend_email_confirmation").send();return false}))}})},{cookies:true,window_manager:true,settings:true,"view/modal":true,dialog:true,"w2.quora":true});require.install("app/view/query/query",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("action_log"),n=require("event").add,o=require("w2.context").AnswerVoteContext;var s=exports.QueryResult=i.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);this.setDvar("query_id",this.query_id);this.setDvar("index",this.index);var e="_blank";if(this.compact){e="_parent"}this.$('#@title a[href!="#"], #@content a[href!="#"]').attr("target",e);this.reportTidsToParent();this.checkHighlight();if(!this.unseen.bound){n(document,"scroll",this.fnbind(this.recordPrivateViews));setTimeout(this.fnbind(this.recordPrivateViews),400);this.unseen.bound=true}this.unseen.items[this.cid]=this;this.view_item=[this.type,this.object_id]},reportTidsToParent:function(){},navigateToObject:function(){var e=this.$("#@title a").attr("href");window.open(e,"_parent")},checkHighlight:function(){var e=this.$("#@title")[0];var t=this.$("#@content")[0];var i=e.innerHTML+t.innerHTML;if(i.indexOf("matched_term")<0){this.serverCall("log_highlight_error").send()}},unseen:{bound:false,items:{},lastCheckTime:0,rateLimit:500},recordPrivateViews:function(){var e=+new Date;if(e<this.unseen.lastCheckTime+this.unseen.rateLimit){return}this.unseen.lastCheckTime=e;var t=[];var i=[];for(var n in this.unseen.items){var o=this.unseen.items[n];if(o.$("#@item").is(":in-viewport")){t.push(o);i.push(o.view_item);delete this.unseen.items[n]}}if(t.length>0){t[0].serverCall("log_private_views").kwargs({view_items:i}).send()}}});exports.QuestionQueryResult=s.extend({reportTidsToParent:function(){this.lookup("query_results").storeQuestionTids(this.tids)}});exports.TopicQueryResult=s.extend({reportTidsToParent:function(){if(this.index===0){this.lookup("query_results").storeHighlightedTid(this.object_id)}}});exports.QueryResultRankingMetadata=e.extend({onLoad:function(){this.$("#@metadata").click(this.fnbind(function(){var e=this.$("#@metadata").parent().hasClass("expanded");this.$(".metadata").parent().removeClass("expanded");if(!e){this.$("#@metadata").parent().addClass("expanded")}}))}});exports.QueryResults=e.extend({contextConstructor:function(){return o},onLoad:function(e){this.storedResultTids=[];this.highlightedTid=null;this.haveUpdatedAddQuestionInSidebar=false;this.$("#@create_topic_link").click(this.fnbind(function(){this.showDialog("create_topic_dialog");return false}));t.makeFixable(this.$("#@sidebar_add_question"))},showDialog:function(e,t){this._dialog=this.dialog().load(e,{kwargs:{tid:this.getPrimaryTid()}})},storeQuestionTids:function(e){this.storedResultTids=this.storedResultTids.concat(e)},storeHighlightedTid:function(e){if(!this.highlightedTid){this.highlightedTid=e}},getPrimaryTid:function(){if(this.highlightedTid){return this.highlightedTid}var e=this.storedResultTids;var t={},i;for(var n=0;n<e.length;n++){i=e[n];if(t[i]){t[i]=t[i]+1}else{t[i]=1}}var o=-1;var s=-1;var r;for(var a=0;a<e.length;a++){i=e[a];r=t[i];if(r>s){o=i;s=r}}if(s>=this.tid_prepopulate_threshold){return o}else{return null}}})},{"w2.context":true,"view/fixable2":true,action_log:true,event:true,"w2.quora":true});require.install("app/view/query/selector",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("view/selector").Selector;function n(e){return e.replace(/ /g,"+")}exports.FullTextSearchInput=i.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.$instruction=e.$("#@instruction");e.busySpinnerConfig={length:4,width:1,radius:5}},resultWasSelected:function(e){t.navigateTo(n(e.data.url))},submit:function(){t.navigateTo("/search?q="+n(this.$input.val()))}})},{"view/selector":true,window_manager:true,"w2.quora":true});require.install("view/filter_nav_list",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager");exports.FilterNavListItem=e.extend({onLoad:function(){var e=this;this.$("#@item").on("click",function(){var t=$(this);if(t.hasClass("selected")){return false}var i=t.attr("value");e.updateDataAndReloadList(e.data_key,i);return false})},updateDataAndReloadList:function(e,i){var n=t.parseURLParams(location.search.substring(1).replace(/\+/g,"%20"));n[e]=i;for(var o in n){if(n[o]==="all"||n[o]===""){delete n[o]}}var s=$.param(n);window.location=window.location.pathname+"?"+s}});exports.FilterMultipleValuesNavListBase=e.extend({updateDataAndReloadList:function(e){var t=$.param(e);window.location=window.location.pathname+"?"+t},addFilterToKey:function(e){var i=this.data_key;var n=t.parseURLParams(location.search.substring(1).replace(/\+/g,"%20"));var o=[];if(n[i]=="followed"){delete n[i]}if(n[i]){o=n[i].split(" ")}if(o.length===0){n[i]=e}else{o.push(e);var s=o.join(" ");n[i]=s}this.updateDataAndReloadList(n)},removeFilterFromKey:function(e){var i=this.data_key;var n=t.parseURLParams(location.search.substring(1).replace(/\+/g,"%20"));var o=n[i].split(" ");var s=o.indexOf(e);if(s>-1){o.splice(s,1);var r=o.join(" ");n[i]=r}for(var a in n){if(n[a]==="all"||n[a]===""){delete n[a]}}this.updateDataAndReloadList(n)}});exports.FilterMultipleValuesNavListItemBase=e.extend({onLoad:function(){var e=this;e.$("#@remove").click(function(){e.lookup("multiple_value_list").removeFilterFromKey(e.filter_value.toString());return false})}})},{window_manager:true,"w2.quora":true});require.install("app/view/query/filters",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("view/filter_nav_list");exports.SearchFilters=e.extend({onLoad:function(){var e=this;t.makeFixable(e.$("#@sidebar_filters"),{min_height:e.$("#@sidebar_filters").outerHeight()+e.$("#@sidebar_filters").offset().top,min_width:990})}});exports.SearchFilterAuthorList=i.FilterMultipleValuesNavListBase.extend({setTo:function(e){this.lookup("people_selector").reset();this.addFilterToKey(e)}})},{"view/fixable2":true,"view/filter_nav_list":true,"w2.quora":true});require.install("app/view/funnel",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies").cookie,i=require("keystrokes"),n;exports.FunnelState=e.extend({onLoad:function(){var e=this;e.$("#@show_unstarted").click(function(){e.$("#@unstarted").show();e.$("#@show_unstarted").hide()});e.$("#@refresh").click(function(){location.reload()})}});exports.ResetFunnelLink=e.extend({onLoad:function(){var e=this;e.$("#@reset").click(function(){e.serverCall("reset_funnel").success(function(){location.reload()}).send()})}});exports.ActivateFunnelLink=e.extend({onLoad:function(){var e=this;e.$("#@activate").click(function(){e.serverCall("activate_funnel").liveMutate().send()})}});i.on([70,48,70,48],function(){if(n){n.toggle()}});exports.FunnelRideAlong=e.extend({onLoad:function(){var e=this,t;n=e;e.$("#@wrapper").hover(function(){t=clearTimeout(t);e.hovering=true;e.slideIn()},function(){t=setTimeout(function(){e.hovering=false;e.slideOut()},500)})},toggle:function(){if(this.$("#@wrapper").hasClass("hidden")){this.turnOn()}else{this.turnOff()}},turnOn:function(){this.$("#@wrapper").removeClass("hidden");t("funnelRideAlongOnByDefault","1")},turnOff:function(){this.$("#@wrapper").addClass("hidden");t("funnelRideAlongOnByDefault",null)},slideOut:function(){if(!this.hovering){var e=this.$("#@wrapper"),t=parseInt(e.css("padding"));e.animate({right:t-e.width()+50+"px"})}},slideIn:function(){this.$("#@wrapper").animate({right:"0px"})}})},{cookies:true,keystrokes:true,"w2.quora":true});require.install("app/view/group",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager");exports.GroupAnnouncementItem=e.extend({onLoad:function(){this.$("#@announcement_title").click(this.fnbind(function(){$(".announcement_editor").addClass("hidden");$(".announcement_item").removeClass("hidden");$(".editor_view").addClass("hidden");$(".current_view").removeClass("hidden");this.$("#@announcement_item").addClass("hidden");this.$("#@announcement_editor").removeClass("hidden")}))}});exports.LeaveGroupDialog=require("dialog").Dialog.extend({onLoad:function(e){this._super.apply(this,arguments);this.setSuccessCallback(this.fnbind(function(e){if(e){t.navigateTo(e)}}))}});exports.PostGroupAnnouncement=e.extend({onLoad:function(){this.$("#@title").focus();this.$("#@title").keyup(this.fnbind(function(){this.checkOkToPost()}));this.$("#@post_announcement").click(this.fnbind(function(){this.postAnnouncement();return false}))},checkOkToPost:function(){if(this.getTitle()){this.enableSubmit();return true}this.disableSubmit();return false},enableSubmit:function(){this.$("#@post_announcement").removeClass("submit_button_disabled")},disableSubmit:function(){this.$("#@post_announcement").addClass("submit_button_disabled")},getTitle:function(){return this.$("#@title").val()||null},getContent:function(){return this.child("editor").serialize()||null},postAnnouncement:function(){var e={title:this.getTitle(),content:this.getContent()};if(e){this.serverCall("post").kwargs(e).liveMutate().send()}}});exports.GroupAnnouncementsUpdateMain=e.extend({onLoad:function(){this.announcements=this.$("#@announcements");this.cQuery(":update.editor").whenOnLoaded(this.fnbind(function(){this.current_content=this.getContent()}));this.current_title=this.getTitle();this.lookup("content").registerTextArea(this.child("update").$("#@title"));this.lookup("content").registerTextArea(this.cQuery(":update.editor").$("#@editor"));this.child("update").$("#@title").keyup(this.fnbind(function(){this.checkOkToUpdate()}));this.cQuery(":update.editor").$("#@editor").keyup(this.fnbind(function(){this.checkOkToUpdate()}));this.$("#@update_announcement").click(this.fnbind(function(){this.updateGroupAnnouncement();return false}));this.$("#@remove_announcement").tooltip({contents:"Remove announcement"});this.$("#@remove_announcement").click(this.fnbind(function(){this.removeGroupAnnouncement();return false}))},checkOkToUpdate:function(){if(this.hasNewTitle()||this.hasNewContent()){this.enableSubmit();return true}this.disableSubmit();return false},enableSubmit:function(){this.$("#@update_announcement").removeClass("submit_button_disabled")},disableSubmit:function(){this.$("#@update_announcement").addClass("submit_button_disabled")},updateGroupAnnouncement:function(){var e={title:this.getTitle(),content:this.getContent()};if(e){this.serverCall("update").kwargs(e).success(this.fnbind(function(e){if(e){document.location=e}this.announcements.find(".editor_view").addClass("hidden");this.announcements.find(".current_view").removeClass("hidden")})).liveMutate().send()}},removeGroupAnnouncement:function(){this.serverCall("remove").success(this.fnbind(function(e){if(e){document.location=e}})).liveMutate().send()},getTitle:function(){return this.child("update").$("#@title").val()||null},getContent:function(){return this.cQuery(":update.editor").serialize()||null},hasNewTitle:function(){var e=this.getTitle();return $.trim(e)!=this.current_title},hasNewContent:function(){var e=this.getContent();return e.html!=this.current_content.html}})},{dialog:true,window_manager:true,"w2.quora":true});require.install("app/view/moderation/flag",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.AddFlag=e.extend({onLoad:function(){this.$("#@show_flag_dialog").click(this.fnbind(function(e){this.showFlagDialog();return false}))},showFlagDialog:function(){this.modal("flag_modal")}});exports.AddFlagModal=t.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@show_more_reasons a").click(this.fnbind(function(){this.$("#@show_more_reasons, #@more_reasons").toggleClass("hidden");return false}));this.$("%@flag_input").click(this.fnbind(function(e){this.$("#@report").removeAttr("disabled").removeClass("submit_button_disabled");this.$("#@comment").show();this.lookup("comment").focus();
this.$("#@required_comment_warning").hide();this.$("#@required_report_reason_warning").hide();var t=parseInt($(e.target).eq(0).val(),10);var i=parseInt(this.other_reason_id,10);var n=parseInt(this.factually_incorrect_reason_id,10);if(t==i||t==n){this.$("#@optional_label").hide()}else{this.$("#@optional_label").show()}}))},onSubmit:function(){this.report()},report:function(){var e=this.$("#@block_option").attr("checked")=="checked";var t={flag_reason:this.getFlagReason(),comment:this.child("comment").serialize()};if(e){t.block_uid=this.block_uid}var i=t.flag_reason==this.other_reason_id||t.flag_reason==this.factually_incorrect_reason_id;if(!t.flag_reason){this.$("#@required_report_reason_warning").show()}else if(i&&this.child("comment").isEmpty()){this.$("#@required_comment_warning").show()}else{if(t.flag_reason!==null){this.serverCall("flag_object").kwargs(t).liveMutate().success(this.fnbind(function(e){this._closeModal();if(e&&e[0]=="/"){window.location=e}})).send()}}},getFlagReason:function(){return this.$("%@flag_input").filter(":checked").val()}});exports.AggregatedFlagItem=e.extend({onLoad:function(){this.$("#@summary, #@more").click(this.fnbind(function(e){this.$("#@all_flags").toggleClass("hidden");return false}))}});exports.NeedsImprovementMenu=e.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(){this.$("#@menu_items").menu(this.$("#@menu_link"));return false}))},addTopic:function(e){if(!e){return}this.serverCall("add_topic").kwargs({qid:this.qid,tid:e}).liveMutate().send()}});exports.NeedsImprovementMenuItem=e.extend({onLoad:function(){this.$("#@ni_topic").click(this.fnbind(function(){this.parent().addTopic(this.tid);return false}))}});exports.BoardActionMenu=e.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(){this.$("#@menu_items").menu(this.$("#@menu_link"));return false}))}});exports.DismissLink=e.extend({onLoad:function(){this.$("#@dismiss").click(this.fnbind(function(e){this.dismiss();return false}))},dismiss:function(){this.serverCall("dismiss").liveMutate().send()}});exports.TargetAndReports=e.extend({onLoad:function(){this.$("#@toggle").click(this.fnbind(function(e){this.toggleComments();return false}))},toggleComments:function(){this.$("#@reports").toggleClass("hidden")}});exports.LockLink=e.extend({onLoad:function(){var e=this;e.$("#@lock_link").click(function(t){t.preventDefault();if($(this).hasClass("unlocked")){e.serverCall("lock_answer").liveMutate().send();$(this).removeClass("unlocked")}else{e.serverCall("unlock_answer").liveMutate().send();$(this).addClass("unlocked")}return false})}})},{"view/modal":true,"w2.quora":true});require.install("app/view/suggestions",function(require,exports,module){var e=require("w2.quora").Component,t=require("action_log");exports.FollowSuggestionCard=t.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var e=this,t=false,i=e.$("#@actionable").parent();i.mouseleave(e.fnbind(function(){if(t===true){i.fadeOut();e.serverCall("follow").liveMutate().send()}}));e.$("#@follow").click(e.fnbind(function(i){i.preventDefault();e.$("#@follow, #@unfollow").toggle();t=true}));e.$("#@unfollow").click(e.fnbind(function(i){i.preventDefault();e.$("#@follow, #@unfollow").toggle();t=false}))}})},{action_log:true,"w2.quora":true});require.install("email",function(require,exports,module){exports.isValidEmail=function(){var e="[^\\x0d\\x22\\x5c\\x80-\\xff]";var t="[^\\x0d\\x5b-\\x5d\\x80-\\xff]";var i="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+";var n="\\x5c[\\x00-\\x7f]";var o="\\x5b("+t+"|"+n+")*\\x5d";var s="\\x22("+e+"|"+n+")*\\x22";var r=i;var a="("+r+"|"+o+")";var l="("+i+"|"+s+")";var u=a+"(\\x2e"+a+")*";var d=l+"(\\x2e"+l+")*";var c=d+"\\x40"+u;var h="^"+c+"$";var f=new RegExp(h);return function(e){return f.test(e)}}()},{});require.install("app/view/user_stats",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/hover_menu").HoverMenu;exports.StatsMain=e.extend({show:function(){this.$("#@stats_main").removeClass("fade_in")},updateGraph:function(e){if(!e){e=this.content_type}this.child("graphs_section").updateGraphs(e,this.interval_type,this.oid)},updateContentList:function(){this.serverCall("render_new_content_list_wrapper").args(this.content_type,this.interval_type).contentFor(this.$("#@stats_side"),{parentCID:this.cid}).send()},updateAttributes:function(e){var t=false,i=false;if("oid"in e&&this.oid!=e.oid){this.oid=e.oid;t=true;if(this.content_type===4){this.updateGraph(e.content_type);return}}if("interval_type"in e){e.interval_type=parseInt(e.interval_type);if(this.interval_type!=e.interval_type){this.interval_type=e.interval_type;t=true;i=true}}if("content_type"in e){e.content_type=parseInt(e.content_type);if(this.content_type!=e.content_type){this.content_type=e.content_type;t=true;i=true}}if(t){this.updateGraph()}if(i){this.updateContentList()}}});exports.Filter=t.extend({registerClickHandlers:function(){var e=this;this._super.apply(this,arguments);this.$("%@option").click(function(t){e.updateAttributes($(t.target).attr("name"));e.$("#@link").text($(t.target).text());$(t.target).parent().siblings().removeClass("selected");$(t.target).parent().addClass("selected");t.preventDefault()})},updateAttributes:function(){}});exports.FilterIntervalType=exports.Filter.extend({updateAttributes:function(e){this.lookup("stats_main").updateAttributes({interval_type:e,oid:null})}});exports.FilterContentType=exports.Filter.extend({updateAttributes:function(e){this.lookup("stats_main").updateAttributes({content_type:e,oid:null})}});exports.ContentListWrapper=e.extend({onLoad:function(){var e=this.$("#@content_list_wrapper"),t=e.outerHeight(),i=$(window).height(),n=e.offset().top,o=i-n-32;if(o>t){e.css("height",o)}this.lookup("stats_main").show()}});exports.ContentListItem=e.extend({onLoad:function(){var e=this;this.$("#@link").click(this.fnbind(function(){if(!this.$("#@link").hasClass("is_active")){e.$(".is_active").removeClass("is_active");this.$("#@link").addClass("is_active")}this.lookup("stats_main").updateAttributes({oid:this.oid,content_type:this.content_type})}))}});exports.RSGraph=e.extend({onLoad:function(){var e=new Rickshaw.Color.Palette({scheme:this.colors});for(var t in this.data_json){this.data_json[t].color=e.color()}var i=new Rickshaw.Graph({element:this.$("#@rsgraph").get(0),series:this.data_json,width:this.width,height:this.getHeight(),renderer:"bar",stroke:true,min:this.min,max:this.max,xmin:this.xmin,xmax:this.xmax,interpolation:"step-after"});i.render();var n=new Rickshaw.Graph.Axis.Y({graph:i,tickFormat:this.ypercent?function(e){return(e*100).toFixed(1)+"%"}:null});n.render();var o=new Rickshaw.Graph.Axis.Time({graph:i});o.render();var s=new Rickshaw.Graph.HoverDetail({graph:i})},getHeight:function(){var e=$(window).height(),t=$(".graphs").offset().top,i=e-t-32;if(i>this.height){return i}else{return this.height}}});exports.Graphs=e.extend({onLoad:function(){var e=window.location.hash;this.metrics.forEach(this.fnbind(function(e){this.child("headsup_section").$("#@"+e).click(this.fnbind(function(t){var i=$(t.target);if(!i.hasClass("heads_up_item")){i=i.parents(".heads_up_item")}if(!i.hasClass("is_active")){i.siblings(".is_active").removeClass("is_active");i.addClass("is_active")}if(this.active_metric!=e){this.$(".stats_graph").hide();this.child("stats_graphs").$("#@graph_"+e).fadeIn(500);this.active_metric=e}t.preventDefault();return false}))}));this.metrics.forEach(this.fnbind(function(t){if("#"+t==e){this.child("headsup_section").$("#@"+t).click()}}))},updateGraphs:function(e,t,i){this.serverCall("render_new_graphs").args(e,t,i).contentFor(this.$("#@graphs"),{parentCID:this.cid}).send();this.serverCall("get_new_counts").args(e,t,i).success(this.fnbind(function(e){e.forEach(this.fnbind(function(e){if(e[1]===null){this.child("headsup_section").$("#@"+e[0]).hide()}else{this.child("headsup_section").$("#@"+e[0]).show();this.child("headsup_section").$("#@"+e[0]+">.big_num").text(e[1]);this.child("headsup_section").$("#@"+e[0]+">.num_label").text(e[2])}$(".heads_up_item").first().addClass("is_active")}))})).send()}})},{"view/hover_menu":true,"w2.quora":true});require.install("app/view/user/content",function(require,exports,module){var e=require("webnode2"),t=require("event"),i=t.add,n=t.remove,o=require("w2.quora").Component;exports.UserContentMain=o.extend({onLoad:function(){this.$("#@toggle_filters").click(this.fnbind(function(){this.$("#@filters").toggle();return false}))},getUrlVars:function(){var e={};var t=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,n){e[i]=n});return e},updateDataAndReloadList:function(e,t){var i=this.getUrlVars();i[e]=t;for(var n in i){if(i[n]===null){delete i[n]}}var o=$.param(i);window.location=window.location.pathname+"?"+o}});exports.UserContentFilter=o.extend({onLoad:function(){this.configureLinks()},configureLinks:function(){var e=this;var t=this.$("#@filter_links a");this.$("#@filter_links a").click(function(){var t=$(this);if(t.hasClass("selected")){return false}var i=t.attr("value");e.lookup("user_content_main").updateDataAndReloadList(e.data_key,i);return false})}});exports.UserContentFilterTopics=exports.UserContentFilter.extend({configureLinks:function(){this.$("#@all_topics").click(this.fnbind(function(){if(!this.$("#@all_topics").hasClass("selected")){this.clearChosenTopic()}return false}));this.$("#@remove_chosen_topic").click(this.fnbind(function(){this.clearChosenTopic();return false}))},clearChosenTopic:function(){this.lookup("user_content_main").updateDataAndReloadList(this.data_key,null)},tempTopicChosen:function(e,t){this.$("#@chosen_topic").text(t);this.$("#@chosen_topic_link_row").show();this.$("#@topic_selector_row").hide();this.$("#@all_topics").removeClass("selected");this.lookup("user_content_main").updateDataAndReloadList(this.data_key,e)}})},{webnode2:true,event:true,"w2.quora":true});require.install("app/view/user/setup_",function(require,exports,module){var e=require("w2.quora").Component;exports.ChecklistStep=e.extend({onLoad:function(){this.$("#@step_link").click(this.fnbind(function(e){e.preventDefault();if(window.checklistDialogActive){return}window.checklistDialogActive=true;if(this.short_name=="follow_topics"){this.dialog(false).opt("width",720).opt("left","50%").opt("dialogClass","dialog_nux").load("get_step_dialog").close(this.fnbind(this.onDialogClose))}else{this.dialog(false).opt("width",500).opt("left","50%").opt("dialogClass","dialog_nux").load("get_step_dialog").close(this.fnbind(this.onDialogClose))}}))},onDialogClose:function(){window.checklistDialogActive=false;this.serverCall("mark_dialog_step_complete").send()}});exports.ChecklistLinkStep=e.extend({onLoad:function(){this.$("#@step_link").click(this.fnbind(function(){this.serverCall("log_link_click").send()}))}})},{"w2.quora":true});require.install("app/view/user/subscribe",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.UserSubscribeLink=e.extend({onLoad:function(){var e=this;e.button=e.$("#@user_subscribe_button");e.button.click(function(t){e.modal("load_inner",{kwargs:{should_show_subscribe:e.canSubscribe(),subscribe_to_uid:e.uid}});t.preventDefault()})},canSubscribe:function(){return!this.button.hasClass("unsubscribe_button")}});exports.SubscribeConfirmModal=t.extend({onSubmit:function(){this.serverCall("change_subscription").liveMutate().success(this.fnbind(function(){this._closeModal()})).send()}})},{"view/modal":true,"w2.quora":true});require.install("view/toggle_list",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/toggle");exports.ToggledList=t.ToggledComponent.extend({onLoad:function(){var e=this.lookup("view_more_button",true);if(e){e.$("#@view_more_link").click(this.fnbind(function(){this.toggle();return false}))}}});exports.ViewMoreLink=e.extend({onLoad:function(){this.$("#@view_more_link").click(this.fnbind(function(){this.$("#@view_more_link").addClass("hidden");this.$("#@view_more_loading_text").removeClass("hidden")}))}})},{"view/toggle":true,"w2.quora":true});require.install("app/view/site_header/logged_in",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("view/hover_menu"),n=require("cookies"),o=require("siteuri").URI;exports.LoggedInSiteHeader=e.extend({shortcuts:{"Ctrl-Alt-h":"/","Ctrl-Alt-m":"/messages","Ctrl-Alt-n":"/notifications","Ctrl-Alt-w":"/write"},onShortcut:function(e){var i=o(this.shortcuts[e]).absolute();t.navigateTo(i)},onLoad:function(){for(var e in this.shortcuts){this.onKeyCombination(document.body,e,this.onShortcut.bind(this,e))}}});exports.NotifsNavItemBase=i.HoverMenu.extend({isInvalidCloseTarget:function(e){var t=this.$("#@link");var i=this.$(".SiteHeaderHoverMenuContents");if(e.is(t)||e.parents(t).is(t)||e.is(i)||e.parents(i).is(i)){return true}return false}});exports.NotifsHoverMenuContents=e.extend({onLoad:function(){var e=this.$("#@hover_menu_header_link");var t=this.$("#@dropdown");t.scroll(function(){if(t.scrollTop()>0){e.addClass("has_shadow")}else{e.removeClass("has_shadow")}})}});exports.MobileSiteLink=e.extend({onLoad:function(){this.$("#@mobile_link").click(this.fnbind(function(){n.cookie("m","1");location.reload(true);return false}))}})},{cookies:true,siteuri:true,"view/hover_menu":true,window_manager:true,"w2.quora":true});require.install("app/view/site_header/logged_out",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings");exports.LoggedOutSiteHeader=e.extend({onLoad:function(){var e=this;var i=t.controller;var n=t.action;e.$("#@signup").click(function(){e.serverCall("attempt_login").liveMutate().send();return false});e.$("#@login").click(function(){window.loginIntent=true;e.serverCall("attempt_login").liveMutate().send();return false})}})},{settings:true,"w2.quora":true});require.install("app/view/intro_to_quora",function(require,exports,module){var e=require("webnode2"),t=require("w2.quora").Component;var i=exports.ITQSidebar=t.extend({onLoad:function(){var e=this;e.stepHandler=function(t){e.nextStep(t)};e.introToQuoraSidebar=e.$("#@intro_to_quora_sidebar");e.activeInstruction=e.$(".sidebar_step_show");e.highlight(e.currStep);e.scrollToStory(e.currStep);e.$("#@close").one("click",function(){e.cancel()});e.$("div[sidebar-selector=next_step]").one("click",function(){e.nextStep()});e.$("div[sidebar-selector=opt_out]").one("click",function(){e.cancel()});e.serverCall("log_impression").send()},nextStep:function(){var e=this;e.activeInstruction=e.activeInstruction.next();if(e.activeInstruction.length!==0){e.activeInstruction.prev().hide(0);e.activeInstruction.show(0);e.currStep++;e.highlight(e.currStep);e.scrollToStory(e.currStep);e.serverCall("complete_step").kwargs({step_num:e.currStep}).send()}else{e.serverCall("complete_itq").liveMutate().send();e.close()}},highlight:function(e){this.clearHighlight();var t={pinned_topics:{selector:".HomeNavList"},upvote:{selector:".add_upvote"},follow:{selector:".itq_follow"},answer:[{selector:".answer_editor"},{selector:".write_answer"}],ask:{selector:".AddQuestionDialogButton",noticeSuffix:"_bottom_left"}};e=e.toString();var i=this.stepMap[e];if(i in t){var n=t[i];if(!Array.isArray(n)){n=[n]}for(var o=0;o<n.length;o++){var s=n[o];var r="itq_notice_bubble";var a=s.selector;if(typeof s.noticeSuffix!=="undefined"){r+=s.noticeSuffix}$(a).addClass(r);$(a).one("click",this.stepHandler)}}if(i==="ask"){this.introToQuoraSidebar.addClass("intro_to_quora_sidebar_point_up")}},clearHighlight:function(){var e=["","_bottom_left","_smaller"];for(var t=0;t<e.length;t++){var i="itq_notice_bubble"+e[t];$("."+i).unbind("click",this.stepHandler);$("."+i).removeClass(i)}this.introToQuoraSidebar.removeClass("intro_to_quora_sidebar_point_up")},selectStory:function(e){var t={upvote:"a.add_upvote",follow:"a.itq_follow",answer:"a.write_answer"};var i=null;var n=this.stepMap[e.toString()];if(n in t){i=t[n];if(Array.isArray(i)){i=i.join(",")}}else{return null}var o=$(".pagedlist_item").has(i);var s=null;for(var r=0;r<o.length;r++){var a=$(o[r]);var l=a.offset().top-$(window).scrollTop();if($(window).scrollTop()){l-=$(".SiteHeader").height()}else{l-=$(".Feed").offset().top}if(l>=0){return a}else{s=a}}return s},scrollToStory:function(e){var t=this;var i=t.selectStory(e);if(i===null){return}if(i.prev(".pagedlist_item").length===0){$("body").animate({scrollTop:0},1e3)}else{var n=i.prev(".pagedlist_item");var o=n.offset().top+n.height()-$(".SiteHeader").height();$("body").animate({scrollTop:o},1e3)}},close:function(){var e=this;e.clearHighlight();e.$(".sidebar_title").css("white-space","nowrap");e.introToQuoraSidebar.animate({opacity:0},1e3);e.introToQuoraSidebar.addClass("hidden")},cancel:function(){this.serverCall("cancel_itq").liveMutate().send();this.close()}})},{webnode2:true,"w2.quora":true});require.install("app/view/reading_list",function(require,exports,module){var e=require("w2.quora").Component;exports.MarkAsReadButton=e.extend({onLoad:function(){var e=this;e.$("#@read_later").click(function(t){t.preventDefault();e.serverCall("unmark_as_read_later").liveMutate().send();return false})}})},{"w2.quora":true});require.install("app/view/write",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("view/modal").Base;exports.WriteMain=e.extend({onLoad:function(){var e=this;var i=this.$("#@left_col_inner");var n=this.$("#@left_col");if(!e.notifBanner){if(n.length>0&&i.length>0){t.makeFixable(i,{min_height:n.outerHeight()+n.offset().top,min_width:990})}}}});exports.WritePageBatchActionLink=e.extend({onLoad:function(){var e=this;this.$("#@confirmation_dialogue").on("click",function(t){e.modal("load_inner");return false})}});exports.WritePageBatchActionConfirmationModal=i.extend({onLoad:function(){var e=this;this._super.apply(this,arguments)},onSubmit:function(){this.removeAll()},removeAll:function(){var e=this;this.serverCall("remove_all").liveMutate().success(function(t){e._closeModal()}).send()}});exports.SidebarAnswerOwnQuestionPrompt=e.extend({onLoad:function(){t.makeFixable(this.$("#@ask_and_answer_prompt"),{scroll_dep:true,min_scroll:this.$("#@ask_and_answer_prompt").offset().top,extra_top_spacing:60})}})},{"view/fixable2":true,"view/modal":true,"w2.quora":true});require.install("shared_utils",function(require,exports,module){var e=require("settings").interfaceLanguage;var t=exports.SECOND=1e3;var i=exports.MINUTE=60*t;var n=exports.HOUR=60*i;var o=exports.DAY=24*n;var s={en:{monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],timeAbbrevs:["d","h","m","s"],justNow:"just now",yesterday:"yesterday",agoTemplate:"{time} ago",dayMonthTemplate:"{day} {month}",dayMonthYearTemplate:"{day} {month} {year}"},es:{monthNames:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],timeAbbrevs:["d","h","m","s"],justNow:"ahora mismo",yesterday:"ayer",agoTemplate:"Hace {time}",dayMonthTemplate:"{day} {month}",dayMonthYearTemplate:"{day} {month} {year}"}};var r=s[e];var a=function(e,t){return e.replace(/\{([^{}]*)\}/g,function(e,i){return t[i]})};var l=function(e,s){var a=new Array(4);var l=[o,n,i,t];var u=r.timeAbbrevs;var d;for(d=0;d<a.length;++d){a[d]=Math.floor(e/l[d]);e-=a[d]*l[d]}var c=0;while(c<a.length&&!a[c]){++c}var h=a.length-1;while(h>=0&&l[h]<s){--h}var f="";for(d=c;d<=h;++d){f+=a[d].toString()+u[d];if(d<h){f+=" "}}return f};exports.timestampStr=function(s,u){var d=new Date;var c=new Date(s/1e3);var h=d.getTime()-c.getTime();var f;if(h<0){if(h>=-2*t){return r.justNow}else{return c.toLocaleDateString(e,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}}if(u){f=l(h,u);if(f){return a(r.agoTemplate,{time:f})}}if(h<i){return r.justNow}if(h<n){var p=Math.floor(d.getTime()/i)-Math.floor(c.getTime()/i);f=p.toString()+r.timeAbbrevs[2];return a(r.agoTemplate,{time:f})}if(h<12*n||h<o&&d.getDate()==c.getDate()){var g=Math.floor(d.getTime()/n)-Math.floor(c.getTime()/n);f=g.toString()+r.timeAbbrevs[1];return a(r.agoTemplate,{time:f})}var _=new Date;_.setDate(d.getDate()-1);if(h<2*o&&c.getDate()==_.getDate()){return r.yesterday}if(h<31*o&&d.getMonth()==c.getMonth()){var m=Math.floor(d.getTime()/o)-Math.floor(c.getTime()/o);f=m.toString()+r.timeAbbrevs[0];return a(r.agoTemplate,{time:f})}if(c.getFullYear()==d.getFullYear()){return a(r.dayMonthTemplate,{day:c.getDate().toString(),month:r.monthNames[c.getMonth()]})}return a(r.dayMonthYearTemplate,{day:c.getDate().toString(),month:r.monthNames[c.getMonth()],year:c.getFullYear()})}},{settings:true});require.install("view/upload",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("browser").browser,n=require("spin");var o=i.msie&&i.version<=9;exports.UploadDialogContents=e.extend({onLoad:function(){var e=this;this.child("upload_form").success(this.fnbind(this.uploadSuccess)).failure(this.fnbind(this.uploadFailure));if(this.isBrowserOlderThanIE10()){this.$("#@drop_zone").removeClass("drop_zone");this.child("drag_and_drop_form").$("#@drag_and_drop_form").hide();return false}if(this.child("drag_and_drop_form")){e.addBodyDragoverListener();var t=function(t){t.stopPropagation();t.preventDefault();t.originalEvent.dataTransfer.dropEffect="copy";e.child("drag_and_drop_form").$("#@form_title").addClass("drag_and_hover");e.$("#@drop_zone").addClass("drag_and_hover")};var i=function(t){t.stopPropagation();t.preventDefault();e.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover");e.$("#@drop_zone").removeClass("drag_and_hover")};this.child("drag_and_drop_form").setDropZone(this.$("#@drop_zone"),t,i);this.child("drag_and_drop_form").success(this.fnbind(this.uploadSuccess)).failure(this.fnbind(this.uploadFailure))}},onUnload:function(){this.removeBodyDragoverListener()},isBrowserOlderThanIE10:function(){return i.msie&&i.version<10},removeBodyDragoverListener:function(){$("document, body").unbind(".uploadDialog")},addBodyDragoverListener:function(){$("document, body").bind({"dragenter.uploadDialog":function(e){e.stopPropagation();e.preventDefault();var t=e.originalEvent.dataTransfer;t.effectAllowed=t.dropEffect="none"},"dragover.uploadDialog":function(e){e.stopPropagation();e.preventDefault();var t=e.originalEvent.dataTransfer;t.effectAllowed=t.dropEffect="none"}})},uploadSuccess:function(){},uploadFailure:function(){$(".drop_zone").removeClass("drag_and_hover");this.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover");this.child("upload_form").hideSpinner();if(this.child("upload_form").lookup("editor",true)){this.cQuery(".upload_form:editor").$("#@spinner").hide()}}});exports.InlineUploadWeb=e.extend({onLoad:function(){var e=this;e.$("#@download").click(this.fnbind(e.onClickDownload));e.$("#@url").bind("input",function(){if(e.$("#@url").val()){e.$("#@download").removeClass("hidden")}else{e.$("#@download").addClass("hidden")}})},onClickDownload:function(e){var t=this;var i=t.$("#@url").focus().val(),n;if(i){t.$("#@download").off("click");n=new Image;n.onload=function(){t.download(i)};n.onerror=function(){t.$("#@download").on("click",t.onClickDownload.bind(t));a1ert(t.invalid_image_text);t.$("#@url").val("")};n.src=i}e.preventDefault();e.stopPropagation()},download:function(){},focus:function(){this.$("#@url").focus()}});exports.InlineUploadPhotoWeb=exports.InlineUploadWeb.extend({download:function(e){this.serverCall("download").kwargs({target_id:this.target_id,target:this.target,url:e}).contentFor(this.lookup("upload_dialog").$("#@iframe"),{parentCID:this.cid}).liveMutate().except("image_error",this.fnbind(function(e){a1ert(e.message);t.Dialog.dialogFor(this).close_()})).except("thumbs_already_set",this.fnbind(function(){t.Dialog.dialogFor(this).close_()})).send();this.cQuery(":upload_dialog").$("#@drop_zone").addClass("disabled");this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").addClass("disabled");return false}});exports.InlineUploadQTextImageWeb=exports.InlineUploadWeb.extend({download:function(e){var i=t.Dialog.openerFor(this);t.Dialog.dialogFor(this).close_();i.addImage(e)}});exports.UploadBaseForm=e.extend({onUpload:function(e){if(e&&!e.success){if(e.message){a1ert(e.message)}if(typeof this._uploadFailed=="function"){this._uploadFailed(e)}return}if(typeof this._upload=="function"){this._upload(e)}},success:function(e){this._upload=e;return this},failure:function(e){this._uploadFailed=e;return this},_uploadFiles:function(e){var t=this,i=this.$("#@form").get(0);if(o){$(document).one("quora_file_upload",function(e,i){t.onUpload(i)});i.submit()}else{var n=new FormData;$.each(i,function(e,t){if(t.type=="hidden"){n.append(t.name,t.value)}});$.each(e,function(e,t){n.append("file",t)});$.ajax({type:"POST",url:"/_/imgupload/upload_POST",data:n,processData:false,contentType:false,success:this.fnbind(this.onUpload),error:this.fnbind(function(e){var t={success:false};if(e.status==413){t.message=this.too_large_error}else{t.message=this.upload_error}this.onUpload(t)})})}}});exports.UploadFileForm=exports.UploadBaseForm.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.file_input=e.$("#@file");e.file_button=e.$("#@file_button");e.shouldShowUploadButton=!o&&e.file_button.length;e.spinner=n.createSpinnerDom({});e.$("#@upload_spinner").append(e.spinner);e.file_input.on("change",function(){var t=e.$("#@file")[0].files;e.showSpinner();e._uploadFiles(t)});e.file_button.click(function(){e.file_input.click()});e._showInput()},_showInput:function(){if(this.shouldShowUploadButton){this.file_input.hide();this.file_button.show()}else{this.file_button.hide();this.file_input.show()}},_hideInput:function(){this.file_button.hide();this.file_input.hide()},showSpinner:function(){this._hideInput();this.$("#@upload_spinner").show();if(this.lookup("upload_dialog")&&this.lookup("drag_and_drop_form",true)){this.cQuery(":upload_dialog").$("#@drop_zone").addClass("disabled");this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").addClass("disabled")}},hideSpinner:function(){this.$("#@upload_spinner").hide();this._showInput();if(this.lookup("upload_dialog")&&this.lookup("drag_and_drop_form",true)){this.cQuery(":upload_dialog").$("#@drop_zone").removeClass("disabled");this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").removeClass("disabled")}}});exports.DragAndDropForm=exports.UploadBaseForm.extend({setDropZone:function(e,t,i){this.dropZoneElement=e;this.dropZoneElement.bind("dragover",t);this.dropZoneElement.bind("dragleave",i);this.addDropEventListener()},addDropEventListener:function(){if(this.dropZoneElement){this.onDropListener=this.fnbind(this.onDrop);this.dropZoneElement[0].addEventListener("drop",this.onDropListener,false)}},removeDropEventListener:function(){if(this.dropZoneElement){this.dropZoneElement[0].removeEventListener("drop",this.onDropListener)}},onUnload:function(){this.removeDropEventListener()},onDrop:function(e){if(e&&e.dataTransfer){var t=this.lookup("editor",true);e.stopPropagation();e.preventDefault();$(".editor_wrapper .drop_zone").removeClass("drag_and_hover");$(".editor_wrapper .drop_zone .target_box").addClass("hidden").removeClass("drag_and_hover");if(this.lookup("upload_dialog",true)){this.cQuery(":upload_dialog.upload_form").showSpinner()}if(t){t.$("#@spinner").show()}this._uploadFiles(e.dataTransfer.files)}},onUpload:function(){this._super.apply(this,arguments);var e=this.lookup("editor",true);if(e){e.$("#@spinner").hide()}}});exports.EditPhotoDialogContents=exports.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@from_facebook").click(this.fnbind(function(){if(this.fb_uid){require("facebook").onInit(this.fnbind(function(){window.FB.api({method:"fql.query",query:"SELECT pic_big FROM user WHERE uid = "+this.fb_uid},this.fnbind(function(e){var t=e[0];if(t.pic_big){this.$("#@view_web_upload").hide();this.$("#@web_upload").hide();this.$("#@from_facebook").hide();this.lookup("upload_web").$("#@url").hide().val(t.pic_big);this.lookup("upload_web").$("#@download").click();this.$("#@web_upload").show()}else{a1ert(this.no_fb_picture_error)}}))}))}}));var e=this;e.addBodyDragoverListener();var t=function(t){t.stopPropagation();t.preventDefault();t.originalEvent.dataTransfer.dropEffect="copy";e.child("drag_and_drop_form").$("#@form_title").addClass("drag_and_hover");e.$("#@drop_zone").addClass("drag_and_hover")};var i=function(t){t.stopPropagation();t.preventDefault();e.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover");e.$("#@drop_zone").removeClass("drag_and_hover")};this.child("drag_and_drop_form").setDropZone(this.$("#@drop_zone"),t,i);this.child("drag_and_drop_form").success(this.fnbind(this.uploadSuccess));this.child("upload_form").success(this.fnbind(this.uploadSuccess));return false},uploadSuccess:function(e){if(e.need_thumb_selection){this.serverCall("upload").kwargs({target_id:this.target_id,target:this.target}).contentFor(this.$("#@iframe"),{parentCID:this.cid}).send()}else{t.Dialog.dialogFor(this).close_()}}});exports.UploadQTextImageDialogContents=exports.UploadDialogContents.extend({uploadSuccess:function(e){var i=t.Dialog.openerFor(this);t.Dialog.dialogFor(this).close_();for(var n=0;n<e.qimg_urls.length;n++){i.addImage(e.qimg_urls[n])}i.inputEntered()}})},{webnode2:true,facebook:true,browser:true,spin:true,"w2.quora":true});require.install("app/view/bug_report",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("view/upload");exports.BugReportLink=e.extend({onLoad:function(){this.$("#@send_feedback").click(this.fnbind(function(e){e.preventDefault();var t=this;if(t.should_hide_more_nav){this.lookup("more_nav_item").doHide()}this._dialog=this.dialog({showXButton:true,closeOnClickOut:true,width:495}).title(t.dialog_title).close(function(){t._dialog=null}).load("dialog_contents");return false}))},closeDialog:function(){this._dialog.close_()}});exports.BugReportDialog=i.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments);this.lookup("editor").focus();this.$("#@submit_feedback").click(this.fnbind(function(e){var i=this.lookup("editor").serialize();var n=this.$("#@photo_key").val();this.serverCall("submit_feedback").kwargs({target:this.target,msg:i,photo_key:n}).success(this.fnbind(function(){t.Dialog.openerFor(this).closeDialog();return false})).sendOnlyOnce();return false}))},uploadSuccess:function(e){this.$("#@photo_key").val(e.photo_key);this.serverCall("upload").kwargs({photo_key:e.photo_key,target:this.target}).contentFor(this.$("#@iframe"),{parentCID:this.cid}).send()}});exports.BugReportMain=i.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@submit_report").click(this.fnbind(function(e){var t=this.$("#@subject").val();var i=this.$("#@description").val();var n=this.$("#@photo_key").val();var o=this.$("#@project").val();this.serverCall("submit_report").kwargs({target:this.target,subject:t,description:i,photo_key:n,project:o}).success(this.fnbind(function(e){window.location.reload()})).sendOnlyOnce();return false}))},uploadSuccess:function(e){this.$("#@photo_key").val(e.photo_key);this.serverCall("upload").kwargs({photo_key:e.photo_key,target:this.target}).contentFor(this.$("#@upload_screenshot"),{parentCID:this.cid}).send()}});exports.BugReportTableCell=e.extend({onLoad:function(){this.$("#@delete_report").click(this.fnbind(function(e){this.serverCall("delete_report").kwargs({report_id:this.report_id}).success(this.fnbind(function(e){window.location.reload()})).send();return false}))}})},{webnode2:true,"view/upload":true,"w2.quora":true});require.install("app/view/primary_topic",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.PrimaryTopicLink=e.extend({onLoad:function(){var e=this;this.$("#@add_primary_topic").click(this.fnbind(function(e){e.preventDefault();
this.modal("load_modal");return false}));this.$("#@remove_primary_topic").click(this.fnbind(function(e){e.preventDefault();this.serverCall("clear_primary").liveMutate().send()}))}});exports.AddPrimaryTopicDialog=t.extend({onSubmit:function(){this._super.apply(this,arguments);var e=this.lookup("topic_selection");var t=e.getTopicNames();if(!t){return}this.serverCall("add").kwargs({topic_name:t[0],viewer_private:e.viewerPrivate}).liveMutate().send()}});exports.AddPrimaryTopicSelection=e.extend({onLoad:function(){this.setUpLabelClicks();this.topic_added_index=0},setUpLabelClicks:function(){this.$("#@topic_list").find(".TopicRow").click(function(e){var t=$(this).find("input[type=radio]").eq(0);t.prop("checked",true)})},getTopicNames:function(){var e=[];this.$("#@topic_list").find("input[type=radio]").each(function(t){if($(this).is(":checked")){e.push($(this).val())}});return e},getAllTopicNames:function(){var e=[];this.$("#@topic_list").find("input[type=radio]").each(function(t){e.push($(this).val())});return e},newTopicAdded:function(e){var t=e.value;this.serverCall("new_topic_added").kwargs({topic_name:t}).contentFor(this.$("#@topic_added_"+this.topic_added_index),{parentCID:this.cid}).success(this.fnbind(function(){var t=this.$("#@topic_added_"+this.topic_added_index);t.show();t.find(".TopicRow").click(function(e){var t=$(this).find("input[type=radio]").eq(0);t.prop("checked",true)});this.topic_added_index++;if(typeof e.id!=="undefined"){this.lookup("selector").addIgnoreOid(e.id)}})).send()}})},{"view/modal":true,"w2.quora":true});require.install("view/voter_list",function(require,exports,module){var e=require("w2.quora").Component;exports.VoterListModalLink=e.extend({onLoad:function(){this.$("#@modal_link").click(this.fnbind(function(){this.modal("load_inner",{kwargs:{object_id:this.object_id}});return false}))}})},{"w2.quora":true});require.install("view/follower_list",function(require,exports,module){var e=require("w2.quora").Component;exports.FollowerListModalLink=e.extend({onLoad:function(){this.$("#@modal_link").click(this.fnbind(function(){this.modal("load_inner",{kwargs:{object_id:this.object_id}});return false}))}})},{"w2.quora":true});require.install("app/view/share",function(require,exports,module){var e=require("w2.quora").Component,t;var i=exports.ShareAction=e.extend({onLoad:function(){var e=this.$("#@share");this.onKeyCombination(e,"s",function(){e.mouseover().click();return false})},showDialog:function(){this.modal("load_modal");return false},events:{"click #@share":"showDialog"}});var n;exports.AutoShowShareAction=i.extend({onLoad:function(){n=this},show:function(e){this.__js_init=e;setTimeout(this.fnbind(this.showDialog),1500)}});exports.showShareAction=function(e){if(n){n.show(e)}}},{"w2.quora":true});require.install("app/view/question/question_add",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("cookies"),n=require("window_manager");function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var s=exports.AddQuestionInline=e.extend({onLoad:function(){this.editor=this.lookup("navigator");this.lookup("navigator").$("#@input").focus(this.fnbind(function(){this.$("#@wrapper").addClass("expanded")}));this.lookup("navigator").$("#@input").keydown(this.fnbind(function(){this.$("#@add").removeClass("disabled");this.$("#@topic_section").fadeIn(250)}));this.setupAddClick();this.disabled=false},focusQuestionBox:function(){this.editor.focus(true)},setupAddClick:function(){this.$("#@add").click(this.fnbind(function(){this.addQuestion();return false}))},checkSubmitStatus:function(){if(this.add_request_pending||this.minLength&&this.lookup("editor").valLength()<this.minLength){$(".dialog .submit_button").addClass("submit_button_disabled");this.disabled=true}else{$(".dialog .submit_button").removeClass("submit_button_disabled");this.disabled=false}},isDefaultText:function(){return this.lookup("editor").html().slice(0,this.default_text.length)==this.default_text},setFocusCallback:function(e){this.lookup("editor").setFocusCallback(e)},fixQuestion:function(e){this.$("#@fixit").show();this.$("#@text").html(e);this.attempts++;if(this.attempts>1){this.$("#@skip").show()}},questionAddedCallback:function(e){var i=e[0];if(n.sameDomainURL(i)){n.navigateTo(i)}t.Dialog.openerFor(this).closeDialog()},addQuestionClickedCallback:function(e){},isPrivate:function(){return this.getDistribution()===0?1:0},expand:function(){if(this.expanded){return}this.$("#@editor_row").addClass("form_row");this.$("#@form_buttons").removeClass("hidden");this.$("#@form_option_row").removeClass("hidden");this.focus();this.expanded=true},clear:function(){this.lookup("editor").clear();this.$("#@question_privacy").attr("checked",false)},select:function(){this.lookup("editor").selectAll()},getKwargs:function(){var e={question:this.getQuestionText(),is_private:this.isPrivate(),topic_names:this.lookup("topic_section").getTopicNames(),unselected_topic_names:this.lookup("topic_section").getUnselectedTopicNames(),context_topic_name:this.getContextTopicName()};return e},getContextTopicName:function(){return this.$("#@context_topic_section").find('input[name="tidsugg_null"]').val()},getQuestionText:function(){return this.lookup("navigator").$("#@input").val()},getDistribution:function(){var e=this.lookup("anon_checkbox");if(e){return e.getValue()}else{return 1}},showPoorQuestionFeedback:function(e){this.add_request_pending=false;this.enableAddQuestionButton();this.editor.focus();this.fixQuestion(e.note);this.$("#@fixit").show()},addQuestion:function(){if(this.disabled){return false}require("action_log").logSecondaryAction("QuestionAdd",null);this.disableAddQuestionButton();var e=this.getKwargs();var t=this.serverCall(this.getAddQuestionServerCall()).kwargs(e).success(this.fnbind(function(e){this.add_request_pending=false;this.enableAddQuestionButton();this.questionAddedCallback(e)})).except("poor_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).except("problematic_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).except("non_english_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).except("survey_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).error(this.fnbind(function(e){this.add_request_pending=false;this.enableAddQuestionButton()})).disableNextPostReload();if(this.shouldLiveMutateAddQuestionCall()){t.liveMutate();t.persistMutation()}t.send();this.addQuestionClickedCallback(e)},shouldLiveMutateAddQuestionCall:function(){return true},getAddQuestionServerCall:function(){return this.shouldLiveMutateAddQuestionCall()?"add_question":"add_question_with_context"},focus:function(){this.lookup("navigator").focus(true)},disableAddQuestionButton:function(){this.disabled=true},enableAddQuestionButton:function(){this.disabled=false}});var r=exports.AddQuestionIntoTopicInline=s.extend({questionAddedCallback:function(e){var t=e[0];var i=e[1];this.parent().newQuestionAdded(t,i)},addQuestionClickedCallback:function(e){var t=e.question;this.parent().newQuestionPending(t);this.lookup("navigator").clear();this.focusQuestionBox()},disableAddQuestionButton:function(){},enableAddQuestionButton:function(){},shouldLiveMutateAddQuestionCall:function(){return false}});exports.AddQuestionWithTopicInline=r.extend({getKwargs:function(){var e=this._super.apply(this,arguments);e.question_details=this.lookup("details_editor").serialize();return e},addQuestionClickedCallback:function(e){this._super.apply(this,arguments);this.lookup("details_editor").clear()}});exports.AddQuestionDialogFromInlineForm=e.extend({onLoad:function(){this.hasStartedTyping=false;this.$("#@question_text").keydown(this.fnbind(function(e){if(e.keyCode==13){this.lookup("button").openDialog();e.stopPropagation();return false}if(!this.hasStartedTyping){this.serverCall("log_start_adding_question").send();this.hasStartedTyping=true}}));this.$("#@question_text").bind("focus keydown",this.fnbind(function(e){this.$("#@anon_checkbox").show()}))},addButtonClickCallback:function(){if(!this.hasStartedTyping){this.serverCall("log_start_adding_question").send();this.hasStartedTyping=true}},getQuestionText:function(){var e=this.$("#@question_text").val();var t=$("<div/>").text(e).html();return t},getIsPrivate:function(){var e=this.child("anon_checkbox",true);if(e){return e.getValue()===0?1:0}else{return 0}}});exports.AddQuestionDialogLink=e.extend({onLoad:function(){if(this.should_show_tooltip){this.$("#@tooltip_container").tooltip({contents:this.tooltip_text,direction:"bottom"})}else{this.$("#@dialog_link").click(this.fnbind(function(){this.openDialog();return false}))}},openDialog:function(){var e=false;var t=null;var i=null;var n=null;var o=this.parent();var s=this.getQuestionText();if(o){if(o.addButtonClickCallback){o.addButtonClickCallback()}if(o.getIsPrivate){e=o.getIsPrivate()}if(o.query){t=o.query}if(o.question_text){i=o.question_text}if(o.skip_step){n=o.skip_step}if(o.getQuestionDetails){this.lookup("wizard").forceQuestionDetails(o.getQuestionDetails())}}this.lookup("wizard").open(s,e,t,i,n,this.tid);if(this.lookup("hover_menu")&&this.lookup("hover_menu").doHide){this.lookup("hover_menu").doHide()}return false},getQuestionText:function(){if(this.parent().getQuestionText){return this.parent().getQuestionText()}else{return""}}});exports.AddQuestionDialogLinkInSearch=exports.AddQuestionDialogLink.extend({onLoad:function(){var e=this;this.$("#@dialog_link").click(this.fnbind(function(){require("action_log").logPrimaryAction("StartQuestionAdd",{hash:e.hash,type:e.impression_type});this.openDialog();return false}))}});exports.AddQuestionWizard=e.extend({onLoad:function(){this.$("#@question_text_done").click(this.fnbind(function(e){this.questionTextDoneCallback();return false}));this.$("#@cancel, #@close_x").click(this.fnbind(function(){this.close();return false}));var e=this,t=e.lookup("question");t.setEnterCallback(function(){e.questionTextDoneCallback()});this.duration=75;this.question_text_html=null;this.last_topic_lookup_question_text_html=null;this.add_button_disabled=false;this.$("#@remove_context_link").click(this.fnbind(function(){this.context_tid=0;this.$("#@add_question_context").remove();this.$("#@remove_context_link").remove();return false}));this.enableQuestionTextDoneButton();this.lookup("question").setFocusCallback(this.fnbind(function(){this.removeQuestionFeedbackHighlight()}));this.skip_soft_rules=false;this.duplicate_no_results=false;this.forced_question_details=null},_show_add_question:function(){this.$("#@add_question_title").addClass("as_title");this.$("#@question_row_inner").show()},_hide_add_question:function(){this.$("#@add_question_title").removeClass("as_title");this.$("#@question_row_inner").hide()},open:function(e,t,i,n,o,s){this.origQuestionHtml=n||e;this.origQuery=i;this.tid=s;this.skipStep=o;this.showCheckboxesOnDuplicateStep=o=="skip_1";this.skipDuplicateCheckOnOrigQuestion=o=="skip_2";var r=this.lookup("anon_checkbox");if(r){var a=t?r.anon_value:r.public_value;r.setValue(a)}this.center();this.$("#@wizard_dialog .dialog_buttons").remove();this.$("#@wizard_dialog").removeClass("hidden");var l=this.lookup("question");l.focus();if(e){this.lookup("question").setHtml(e);var u=this;$(document).ready(function(){setTimeout(function(){if(e){u.questionTextDoneCallback()}},0)})}this.serverCall("log_open_wizard_dialog").send()},center:function(){var e=420;var t=100;var i=this.$("#@wizard_dialog");var n=$(window).width(),o=$(window).scrollTop(),s=e,r=n-s,a=r/2;var l=$(window).height()/2;l-=i.outerHeight();i.css("top",l+"px");i.css("left",a+"px");i.css("width",e+"px");i.appendTo($(document.body));return},close:function(){this.add_button_disabled=false;this.enableQuestionTextDoneButton();this.skip_soft_rules=false;this.$("#@wizard_dialog").addClass("hidden");this.showQuestionSection();this.lookup("question").clear();this.$("#@fixit_title").html("");this.$("#@fixit_text").html("");this.$("#@fixit").hide()},showQuestionSection:function(){this.toggleSection("#@question_row_inner");this.toggleTitles("#@add_question_title",false);this.$("#@question_text_preview").addClass("hidden").text("");this.lookup("question").$("#@editor").removeClass("disabled_for_submit");this._show_add_question();this.center();return false},showDuplicatesSection:function(){var e=this.question_text_html.replace(/<(?:.|\n)*?>/gm,"");var t=this.$("#@question_text_preview");var i="&nbsp;";var n=new RegExp(i,"g");e=e.replace(n," ");var o=150;if(e.length>o){e=e.substring(0,o)+"..."}t.html(e).removeClass("hidden");var s=$(window).height()/2-t.height();this.$("#@wizard_dialog").find(".question_wizard_duplicate_wrapper").css("max-height",s+"px").css("overflow","auto");if(this.skipDuplicateCheckOnOrigQuestion&&this.question_text_html==this.origQuestionHtml){this.duplicatesDoneCallback();return false}else{this.serverCall("log_duplicate_step_started").send()}this.toggleSection("#@duplicate_row_inner");this.toggleTitles("#@duplicates_title",false);this.checkDuplicateResults();var r=this.lookup("wizard");if(r.duplicate_no_results){r.duplicatesDoneCallback()}var a=this.$("#@wizard_dialog").outerHeight()/2;this.$("#@wizard_dialog").css("top",s-a+"px");return false},showTopicsSection:function(){this.toggleSection("#@topics_row_inner");this.toggleTitles("#@topics_title",false);var e=this.$("#@wizard_dialog");var t=e.find(".selector");var i=0,n=this;function o(){i++;var t=n.lookup("add_topics_step",true);if(t){t.onShownInWizard();var s=$(window).height()/3;e.find(".AddQuestionWizardTopicSelection").css("max-height",s+"px").css("overflow","auto")}else if(i<=10){setTimeout(o,200)}}o();t.css("max-height",t.height());return false},onEnterPressed:function(){if(this.enterPressedCallback){this.enterPressedCallback()}},onEditorInputChange:function(){this.enableQuestionTextDoneButton();this.skip_soft_rules=false},toggleSection:function(e){this.$("%@section_inner_content").hide();this.$(e).show()},toggleTitles:function(e,t){if(t){this.$("%@title_tabs").removeClass("hidden").addClass("inactive")}else{this.$("%@title_tabs").addClass("hidden")}this.$(e).removeClass("inactive").removeClass("hidden")},showPoorQuestionFeedback:function(e){this.showQuestionSection();this.$("#@fixit_title").html(e.title);this.$("#@fixit_text").html(e.note);this.$("#@fixit").slideDown(200);if(e.matched_phrase&&!e.is_matched_phrase_details){this.addQuestionFeedbackHighlight(e.matched_phrase)}if(e.is_blocking){this.disableQuestionTextDoneButton();this.$("#@fixit_instruction").hide()}else{this.$("#@fixit_instruction").show();this.skip_soft_rules=true}},hidePoorQuestionFeedback:function(){this.$("#@fixit").slideUp(200)},removeQuestionFeedbackHighlight:function(){this.lookup("question").$("#@editor .question_feedback_highlight").contents().unwrap()},addQuestionFeedbackHighlight:function(e){this.lookup("question").$("#@editor").html(function(t,i){var n=new RegExp("("+o(e)+")","i");return i.replace(n,'<span class="question_feedback_highlight">$1</span>')})},enableQuestionTextDoneButton:function(){this.question_text_done_button_enabled=true;this.$("#@question_text_done").removeClass("submit_button_disabled");this.lookup("question").$("#@editor").removeClass("disabled_for_submit")},disableQuestionTextDoneButton:function(){this.$("#@question_text_done").addClass("submit_button_disabled");this.question_text_done_button_enabled=false},checkDuplicateResults:function(){var e=this.$(".duplicate_question_link_span");this.duplicate_no_results=e.length===0},questionTextDoneCallback:function(){if(!this.question_text_done_button_enabled){return}this.hidePoorQuestionFeedback();this.lookup("question").$("#@editor").addClass("disabled_for_submit");this.lookup("question").blur();this.question_text_html=this.lookup("question").html(false);this.$("#@duplicate_row_inner").empty().hide();this.serverCall("get_duplicate_component").contentFor(this.$("#@duplicate_row_inner"),{parentCID:this.cid}).kwargs({query:this.lookup("question").serialize(),check_for_question_issues:true,skip_soft_rules:this.skip_soft_rules}).except("poor_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).except("problematic_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).except("non_english_question",this.fnbind(function(e){this.showPoorQuestionFeedback(e)})).success(this.fnbind(function(e){this.loadTopics();if(!this.skipStep){this.$("#@topics_row").hide();this.$("#@duplicate_row").show();this.showDuplicatesSection()}})).send();if(this.skipStep){this.$("#@topics_row").hide();this.$("#@duplicate_row").show();this.showDuplicatesSection()}},loadTopics:function(){var e=this.lookup("question").html(false);if(this.last_topic_lookup_question_text_html!=e){this.last_topic_lookup_question_text_html=e;this.serverCall("get_topic_component").contentFor(this.$("#@topics_row_inner"),{parentCID:this.cid}).kwargs({query:this.lookup("question").serialize()}).send()}},duplicatesDoneCallback:function(){this.$("#@topics_row").show();this.showTopicsSection()},getQuestionText:function(){return this.lookup("question").serialize()},forceQuestionDetails:function(e){this.forced_question_details=e},getQuestionDetails:function(){if(this.forced_question_details===null){return this.lookup("duplicate_step").getQuestionDetails()}return this.forced_question_details},topicsDoneCallback:function(){if(this.add_button_disabled){return}var e={question:this.getQuestionText(),question_details:this.getQuestionDetails(),is_private:this.lookup("add_topics_step").getIsPrivate(),topic_names:this.lookup("add_topics_step").getTopicNames(),unselected_topic_names:this.lookup("add_topics_step").getUnselectedTopicNames(),added_topic_names:this.lookup("add_topics_step").getAddedTopicNames(),orig_query:this.origQuery,context_tid:this.context_tid,faq_tid:this.tid,top_topic_suggestions:this.lookup("add_topics_step").getTopTopicSuggestions()};require("action_log").logSecondaryAction("QuestionAdd",null);this.add_button_disabled=true;this.serverCall("add_question").kwargs(e).liveMutate().success(this.fnbind(function(e){var t=e[0];n.navigateTo(t)})).error(this.fnbind(function(){this.add_button_disabled=false})).except(this.fnbind(function(){this.add_button_disabled=false})).send()}});exports.AddQuestionWizardDuplicateStep=e.extend({onLoad:function(){if(this.parent().showCheckboxesOnDuplicateStep){this.$("#@extra_checkboxes").show()}this.whenOnLoaded(this.fnbind(function(){var e;var t=this.child("anon_checkbox2"),i;if(t){i=this.parent().lookup("anon_checkbox");if(i){e=t.$("#@checkbox");e.change(function(){i.setValue(t.getValue())})}}}));var e=this.$("#@question_details_link");if(e){e.click(this.fnbind(function(){this.$("#@question_details_link").hide();this.$("#@question_details_editor").show();this.lookup("question_details").focus();return false}))}this.$("#@duplicates_done").click(this.fnbind(function(e){this.serverCall("log_step_complete").kwargs({details:this.getQuestionDetails()}).success(this.fnbind(function(e){this.$("#@question_details_too_long").hide();this.parent().duplicatesDoneCallback()})).except("long_question_details",this.fnbind(function(e){this.$("#@question_details_too_long").show()})).send();return false}));this.$("#@duplicates_done").focus();this.$("#@cancel").click(this.fnbind(function(){this.parent().showQuestionSection();this.$("#@extra_checkboxes").hide();this.parent().showCheckboxesOnDuplicateStep=false;return false}))},getQuestionDetails:function(){return this.lookup("question_details").serialize()}});exports.AddQuestionDuplicateQuestionLink=e.extend({onLoad:function(){this.$("#@link").find("a").click(this.fnbind(function(){i.setMessage("look",[this.qid,true]);this.serverCall("log_question_click").send();return true}))}});exports.AddQuestionWizardTopicStep=e.extend({onLoad:function(){this.$("#@topics_done").click(this.fnbind(function(e){this.parent().topicsDoneCallback();return false}));this.$("#@topics_done").focus();this.$("#@cancel").click(this.fnbind(function(){var e=this.parent();if(e.skipDuplicateCheckOnOrigQuestion&&e.question_text_html==e.origQuestionHtml){e.showQuestionSection()}else{if(e.duplicate_no_results){e.showQuestionSection()}else{e.showDuplicatesSection()}}return false}))},onShownInWizard:function(){if(this.empty){this.lookup("selector").focus(true)}},getIsPrivate:function(){var e=this.lookup("anon_checkbox");if(e){return e.getValue()===0?1:0}else{return false}},getTopicNames:function(){return this.lookup("topic_selection").getTopicNames()},getUnselectedTopicNames:function(){return this.lookup("topic_selection").getUnselectedTopicNames()},getAddedTopicNames:function(){return this.lookup("topic_selection").getAddedTopicNames()},getTopTopicSuggestions:function(){return this.lookup("topic_selection").top_topic_suggestions}});exports.AddQuestionTopicSelection=e.extend({onLoad:function(){this.setUpLabelClicks();this.topic_added_index=0},setUpLabelClicks:function(){var e=".QuestionWizardTopicRow";this.$("#@topic_list").find(e).click(function(e){var t=$(this).find("input[type=checkbox]").eq(0);t.prop("checked",!t.prop("checked"))});this.$("#@topic_list").find("input[type=checkbox]").click(function(e){e.stopPropagation()})},getTopicNames:function(){var e=[];this.$("#@topic_list").find("input[type=checkbox]").each(function(t){if($(this).is(":checked")&&$(this).val()){e.push($(this).val())}});return e},getUnselectedTopicNames:function(){var e=[];this.$("#@topic_list").find("input[type=checkbox]").each(function(t){if(!$(this).is(":checked")&&$(this).val()){e.push($(this).val())}});return e},getAddedTopicNames:function(){var e=[];for(var t=0;t<this.topic_added_index;t++){var i=this.$("#@topic_added_"+t).find("input[type=checkbox]");if(i.val()){e.push(i.val())}}return e},newTopicAdded:function(e){var t=e.value;var i=this.topic_added_index;this.topic_added_index++;this.serverCall("new_topic_added").kwargs({topic_name:t}).contentFor(this.$("#@topic_added_"+i),{parentCID:this.cid}).success(this.fnbind(function(){var t=this.$("#@topic_added_"+i);t.show();var n=t.find(".QuestionWizardTopicRow");var o=n.find("input[type=checkbox]");n.click(function(){o.prop("checked",!o.prop("checked"))});o.click(function(e){e.stopPropagation()});if(typeof e.id!="undefined"){this.lookup("selector").addIgnoreOid(e.id)}})).send()}});exports.AddQuestionAnonymousCheckbox=e.extend({onLoad:function(){this.cb=this.$("#@checkbox")},getValue:function(){if(this.cb.attr("checked")){return this.anon_value}else{return this.public_value}},setValue:function(e){if(e==this.anon_value){this.cb.attr("checked","checked")}else{this.cb.removeAttr("checked")}},getCheckboxElement:function(){return this.$("#@checkbox")}})},{webnode2:true,cookies:true,action_log:true,window_manager:true,"w2.quora":true});require.install("app/view/threaded_comments",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor").InlineEditor,i=require("window_manager").isInHash,n=require("mathify").renderMath;exports.TCommentListWrapper=e.extend({onLoad:function(e){var t=this;this.initState("visible",true);this.first_level_all_loaded=false;this.moreLink=this.$("#@comment_list_more_link");this.isMoreLinkActive=true;this.isFirstExpand=true;if(this.moreLink){this.offsetStep=this.offset;this.moreLink.on("click",function(){if(t.isMoreLinkActive){t.isMoreLinkActive=false;t.pageComment()}})}},pageComment:function(){this.serverCall("page_comment").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level,offset:this.offset,limit:this.getNextPageLimit()}).success(this.fnbind(function(){this.isMoreLinkActive=true;this.offset=this.getNextPageLimit();if(this.offset===null||this.offset>=this.num_children){this.moreLink.addClass("hidden")}this.isFirstExpand=false})).contentFor(this.$("#@comment_list_first_level_placeholder_"+this.offset),{parentCID:this.cid}).sendOnlyOnce()},getNextPageLimit:function(){var e;if(this.isFirstExpand){e=this.offset+this.offsetStep}else{e=null}return e},hasSingleChild:function(){var e=this.child("t_comment_list");return e&&e.hasSingleChild()},focusAddRoot:function(){var e=this.child("t_comment_add_root");if(e){e.focusEditor()}},loadChildren:function(){this.lazy_load_children=false;this.serverCall("load_child_list").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level}).success(this.fnbind(function(e){this.state("visible",true)})).contentFor(this.$("#@comment_list_placeholder"),{parentCID:this.cid}).send()},loadAllFirstLevel:function(){this.first_level_all_loaded=true;this.serverCall("load_all_first_level").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level}).contentFor(this.$("#@first_level_placeholder"),{parentCID:this.cid}).send()},stateHandlers:{highlighted:function(e){var t=this.$("#@comment_list"),i=t.hasClass("selected");if(arguments.length<1){return i}t.toggleClass("selected",e)},visible:function(e){var t=this.$("#@comment_list_wrapper"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e);var n=this.child("t_comment_list");if(n){var o=this.hasSingleChild();var s=!this.is_root;n.eachChildInAnyOrder(function(t){t.state("visible",e);if(e&&o&&s&&t.hasSingleChild&&t.hasSingleChild()){t.state("expanded",true)}})}else if(e&&this.lazy_load_children){this.loadChildren()}if(e&&this.$("#@first_level_placeholder").size()>0&&!this.first_level_all_loaded){this.loadAllFirstLevel()}}}});exports.TCommentList=e.extend({hasSingleChild:function(){return this.children()&&this.children().length===1},eachChildInAnyOrder:function(e){var t=this.children();if(t){for(var i=0;i<t.length;i++){e(t[i])}}}});exports.TComment=e.extend({parentComment:function(){return this.parent().parent().parent()},clickHandlers:{delete_link:function(){this.deleteComment()},show_downvoted_link:function(){this.state("showDownvotedLinkVisible",false)}},hasSingleChild:function(){var e=this.child("t_comment_list_wrapper");if(!e){return false}return e.hasSingleChild()},onLoad:function(){this.initState("expanded",false);this.initState("showDownvotedLinkVisible",this.is_downvoted_and_hidden);this.initState("visible",true);this.installMouseHandlers();this.expandOnNotif();n("@comment")},addNotifHighlight:function(e){e.addClass("highlighter");var t=false;var i=function(){var t=e.offset().top;var i=t+e.height();var n=$(window).scrollTop();var o=n+$(window).height();return i>=n&&t<=o};var n=i();var o=function(){t=true};$(window).scroll(o);var s=setInterval(function(){if(t){var r=i();if(n&&!r){e.removeClass("highlighter");clearInterval(s);$(window).unbind("scroll",o)}n=r;t=false}},500)},expandOnNotif:function(){if(!this.initState("first_call",true)){if(i("comment"+this.id)){var e=[],t=this;while(!t.is_root){t=t.parentComment();e.unshift(t)}for(var n=0;n<e.length;n++){e[n].state("expanded",true)}this.addNotifHighlight(this.$("#@comment_highlight_wrapper"))}}},deleteComment:function(){this.dialog().title(this.delete_dialog_title).cancel(null,this.delete_dialog_cancel_button_text).ok(this.fnbind(function(){this.serverCall("delete_comment").kwargs({cid:this.id,oid:this.object_id}).liveMutate().send()}),this.delete_dialog_title).html(this.delete_dialog_message)},stateHandlers:{expanded:function(e){var t=this.$("#@comment_inner"),i=t.hasClass("expanded");if(arguments.length<1){return i}t.toggleClass("expanded",e);var n=this.child("t_comment_replies_collapsed");if(n){n.state("visible",!e)}var o=this.child("t_comment_list_wrapper");if(o){o.state("visible",e)}this.$("#@comment").toggleClass("last_expanded",e&&this.is_last)},visible:function(e){var t=this.$("#@comment"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e)},showDownvotedLinkVisible:function(e){var t=this.$("#@show_downvoted_link_wrapper"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e);this.$("#@full_comment_text, #@footer_wrapper").toggleClass("hidden",e)}}});exports.TCommentReplyBox=e.extend({clickHandlers:{add_comment_link:function(){this._request()},cancel_link:function(){this._cancel()}},onLoad:function(e){this.initState("visible",false);this.installMouseHandlers()},_cancel:function(e){this.state("visible",false);this.lookup("t_comment_action_bar").state("visible",true)},stateHandlers:{visible:function(e){var t=this.$("#@reply_box"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e);if(e){var n=this.lookup("editor");setTimeout(function(){if(n!==null){n.focus()}},0)}this.$("#@reply_box").toggleClass("parent_expanded",this.parent().state("expanded"))}},_request:function(){var e=this.lookup("editor");if(e.isEmpty()){return}var t=e.serialize();this._cancel();this.serverCall("add_comment").kwargs({oid:this.object_id,comment:t,reply_to_id:this.reply_to_id}).success(this.fnbind(function(t){this.parent().state("expanded",true);e.clear()})).liveMutate().sendOnlyOnce()}});exports.TCommentAddRoot=e.extend({clickHandlers:{add_root_link:function(){this._request()}},onLoad:function(){this.installMouseHandlers()},focusEditor:function(){var e=this.lookup("editor");e.focus()},_request:function(){var e=this.lookup("editor");if(e.isEmpty()){return}this.serverCall("add_comment").kwargs({oid:this.object_id,comment:e.serialize()}).success(this.fnbind(function(t){e.clear()})).liveMutate().sendOnlyOnce()}});exports.TCommentRepliesCollapsed=e.extend({clickHandlers:{show_child_link:function(e){this.parent().state("expanded",true)}},onLoad:function(e){this.initState("visible",!this.parent().state("expanded"));this.installMouseHandlers()},stateHandlers:{visible:function(e){var t=this.$("#@show_child_link_wrapper"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e)}}});exports.TCommentActionBar=e.extend({vote:function(e,t){this.serverCall("comment_vote").kwargs({oid:this.object_id,cid:this.id,is_upvote:e,cancel:t}).liveMutate().sendOnlyOnce()},clickHandlers:{comment_downvote:function(){this.vote(false,false)},comment_upvote:function(){this.vote(true,false)},comment_downvote_cancel:function(){this.vote(false,true)},show_reply_box_link:function(){this.startEditing()},comment_upvote_cancel:function(){this.vote(true,true)}},startEditing:function(){this.state("visible",false);this.lookup("t_comment_reply_box").state("visible",true)},mouseDownHandlers:{show_reply_box_link:function(){this.startEditing()}},onLoad:function(e){this.initState("visible",true);this.installMouseHandlers();this.$("#@show_reply_box_link").focus(this.fnbind(this.startEditing))},stateHandlers:{visible:function(e){var t=this.$("#@action_bar"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e)}}});exports.TCommentFullTextInlineEditor=t.extend({onLoad:function(){this._super.apply(this,arguments);this.setToggleCallback(this.fnbind(function(){if(this.parent()){var e=this.lookup("t_comment_"+this.id);if(e){e.$("#@comment_inner").toggleClass("comment_editor_focused")}}}))}});exports.TCommentStandalone=e.extend({onLoad:function(){this.initState("expanded",true);this.initState("comment_log_visible",false);this.installMouseHandlers()},clickHandlers:{change_log_toggle:function(){this.state("comment_log_visible",!this.state("comment_log_visible"))}},stateHandlers:{expanded:function(e){var t=this.$("#@comments"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e);var n=this.child("t_comment_"+this.comment_id);if(!n){return}n.state("expanded",true)},comment_log_visible:function(e){var t=this.$("#@comment_log"),i=!t.hasClass("hidden");if(arguments.length<1){return i}t.toggleClass("hidden",!e);this.$("#@view_label").toggle(!e)}}});exports.DeleteCommentButton=e.extend({onLoad:function(){this.$("#@delete").click(this.fnbind(function(e){this.deleteComment();return false}))},deleteComment:function(){this.serverCall("delete").liveMutate().send()}})},{"view/inline_editor":true,mathify:true,window_manager:true,"w2.quora":true});require.install("view/notif",function(require,exports,module){var e=require("w2.quora").Component;exports.NotifQuestionLink=e.extend({onLoad:function(){
this.$("#@link").click(this.fnbind(function(){this.serverCall("link_clicked_callback").send()}))}})},{"w2.quora":true});require.install("qtext",function(require,exports,module){exports.tooltip=function(e,t){e=$(e);if(e.attr("data-tooltip")){return false}e.attr("data-tooltip","attached");e.tooltip({contents:t,parent_class:"external_link_tooltip",prepend:true,align_center:false});setTimeout(function(){e.trigger("mouseenter")},10);return false}},{});require.install("swfobject",function(require,exports,module){var e=null;var t=function(){if(e==null)e=function(){var t="undefined",i="object",n="Shockwave Flash",o="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",r="SWFObjectExprInst",a="onreadystatechange",l=window,u=document,d=navigator,c=false,h=[I],f=[],p=[],g=[],_,m,v,w,b=false,k=false,C,y,x=true,S=function(){var e=typeof u.getElementById!=t&&typeof u.getElementsByTagName!=t&&typeof u.createElement!=t,r=d.userAgent.toLowerCase(),a=d.platform.toLowerCase(),h=a?/win/.test(a):/win/.test(r),f=a?/mac/.test(a):/mac/.test(r),p=/webkit/.test(r)?parseFloat(r.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,g=!+"1",_=[0,0,0],m=null;if(typeof d.plugins!=t&&typeof d.plugins[n]==i){m=d.plugins[n].description;if(m&&!(typeof d.mimeTypes!=t&&d.mimeTypes[s]&&!d.mimeTypes[s].enabledPlugin)){c=true;g=false;m=m.replace(/^.*\s+(\S+\s+\S+$)/,"$1");_[0]=parseInt(m.replace(/^(.*)\..*$/,"$1"),10);_[1]=parseInt(m.replace(/^.*\.(.*)\s.*$/,"$1"),10);_[2]=/[a-zA-Z]/.test(m)?parseInt(m.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof l.ActiveXObject!=t){try{var v=new ActiveXObject(o);if(v){m=v.GetVariable("$version");if(m){g=true;m=m.split(" ")[1].split(",");_=[parseInt(m[0],10),parseInt(m[1],10),parseInt(m[2],10)]}}}catch(w){}}}return{w3:e,pv:_,wk:p,ie:g,win:h,mac:f}}(),T=function(){if(!S.w3){return}if(typeof u.readyState!=t&&u.readyState=="complete"||typeof u.readyState==t&&(u.getElementsByTagName("body")[0]||u.body)){L()}if(!b){if(typeof u.addEventListener!=t){u.addEventListener("DOMContentLoaded",L,false)}if(S.ie&&S.win){u.attachEvent(a,function(){if(u.readyState=="complete"){u.detachEvent(a,arguments.callee);L()}});if(l==top){(function(){if(b){return}try{u.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}L()})()}}if(S.wk){(function(){if(b){return}if(!/loaded|complete/.test(u.readyState)){setTimeout(arguments.callee,0);return}L()})()}E(L)}}();function L(){if(b){return}try{var e=u.getElementsByTagName("body")[0].appendChild(j("span"));e.parentNode.removeChild(e)}catch(t){return}b=true;var i=h.length;for(var n=0;n<i;n++){h[n]()}}function q(e){if(b){e()}else{h[h.length]=e}}function E(e){if(typeof l.addEventListener!=t){l.addEventListener("load",e,false)}else{if(typeof u.addEventListener!=t){u.addEventListener("load",e,false)}else{if(typeof l.attachEvent!=t){W(l,"onload",e)}else{if(typeof l.onload=="function"){var i=l.onload;l.onload=function(){i();e()}}else{l.onload=e}}}}}function I(){if(c){M()}else{A()}}function M(){var e=u.getElementsByTagName("body")[0];var n=j(i);n.setAttribute("type",s);var o=e.appendChild(n);if(o){var r=0;(function(){if(typeof o.GetVariable!=t){var i=o.GetVariable("$version");if(i){i=i.split(" ")[1].split(",");S.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}}else{if(r<10){r++;setTimeout(arguments.callee,10);return}}e.removeChild(n);o=null;A()})()}else{A()}}function A(){var e=f.length;if(e>0){for(var i=0;i<e;i++){var n=f[i].id;var o=f[i].callbackFn;var s={success:false,id:n};if(S.pv[0]>0){var r=Q(n);if(r){if(V(f[i].swfVersion)&&!(S.wk&&S.wk<312)){K(n,true);if(o){s.success=true;s.ref=D(n);o(s)}}else{if(f[i].expressInstall&&N()){var a={};a.data=f[i].expressInstall;a.width=r.getAttribute("width")||"0";a.height=r.getAttribute("height")||"0";if(r.getAttribute("class")){a.styleclass=r.getAttribute("class")}if(r.getAttribute("align")){a.align=r.getAttribute("align")}var l={};var u=r.getElementsByTagName("param");var d=u.length;for(var c=0;c<d;c++){if(u[c].getAttribute("name").toLowerCase()!="movie"){l[u[c].getAttribute("name")]=u[c].getAttribute("value")}}O(a,l,n,o)}else{F(r);if(o){o(s)}}}}}else{K(n,true);if(o){var h=D(n);if(h&&typeof h.SetVariable!=t){s.success=true;s.ref=h}o(s)}}}}}function D(e){var n=null;var o=Q(e);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=t){n=o}else{var s=o.getElementsByTagName(i)[0];if(s){n=s}}}return n}function N(){return!k&&V("6.0.65")&&(S.win||S.mac)&&!(S.wk&&S.wk<312)}function O(e,i,n,o){k=true;v=o||null;w={success:false,id:n};var s=Q(n);if(s){if(s.nodeName=="OBJECT"){_=R(s);m=null}else{_=s;m=n}e.id=r;if(typeof e.width==t||!/%$/.test(e.width)&&parseInt(e.width,10)<310){e.width="310"}if(typeof e.height==t||!/%$/.test(e.height)&&parseInt(e.height,10)<137){e.height="137"}u.title=u.title.slice(0,47)+" - Flash Player Installation";var a=S.ie&&S.win?"ActiveX":"PlugIn",d="MMredirectURL="+l.location.toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+u.title;if(typeof i.flashvars!=t){i.flashvars+="&"+d}else{i.flashvars=d}if(S.ie&&S.win&&s.readyState!=4){var c=j("div");n+="SWFObjectNew";c.setAttribute("id",n);s.parentNode.insertBefore(c,s);s.style.display="none";(function(){if(s.readyState==4){s.parentNode.removeChild(s)}else{setTimeout(arguments.callee,10)}})()}P(e,i,n)}}function F(e){if(S.ie&&S.win&&e.readyState!=4){var t=j("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(R(e),t);e.style.display="none";(function(){if(e.readyState==4){e.parentNode.removeChild(e)}else{setTimeout(arguments.callee,10)}})()}else{e.parentNode.replaceChild(R(e),e)}}function R(e){var t=j("div");if(S.win&&S.ie){t.innerHTML=e.innerHTML}else{var n=e.getElementsByTagName(i)[0];if(n){var o=n.childNodes;if(o){var s=o.length;for(var r=0;r<s;r++){if(!(o[r].nodeType==1&&o[r].nodeName=="PARAM")&&!(o[r].nodeType==8)){t.appendChild(o[r].cloneNode(true))}}}}}return t}function P(e,n,o){var r,a=Q(o);if(S.wk&&S.wk<312){return r}if(a){if(typeof e.id==t){e.id=o}if(S.ie&&S.win){var l="";for(var u in e){if(e[u]!=Object.prototype[u]){if(u.toLowerCase()=="data"){n.movie=e[u]}else{if(u.toLowerCase()=="styleclass"){l+=' class="'+e[u]+'"'}else{if(u.toLowerCase()!="classid"){l+=" "+u+'="'+e[u]+'"'}}}}}var d="";for(var c in n){if(n[c]!=Object.prototype[c]){d+='<param name="'+c+'" value="'+n[c]+'" />'}}a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+l+">"+d+"</object>";p[p.length]=e.id;r=Q(e.id)}else{var h=j(i);h.setAttribute("type",s);for(var f in e){if(e[f]!=Object.prototype[f]){if(f.toLowerCase()=="styleclass"){h.setAttribute("class",e[f])}else{if(f.toLowerCase()!="classid"){h.setAttribute(f,e[f])}}}}for(var g in n){if(n[g]!=Object.prototype[g]&&g.toLowerCase()!="movie"){B(h,g,n[g])}}a.parentNode.replaceChild(h,a);r=h}}return r}function B(e,t,i){var n=j("param");n.setAttribute("name",t);n.setAttribute("value",i);e.appendChild(n)}function H(e){var t=Q(e);if(t&&t.nodeName=="OBJECT"){if(S.ie&&S.win){t.style.display="none";(function(){if(t.readyState==4){U(e)}else{setTimeout(arguments.callee,10)}})()}else{t.parentNode.removeChild(t)}}}function U(e){var t=Q(e);if(t){for(var i in t){if(typeof t[i]=="function"){t[i]=null}}t.parentNode.removeChild(t)}}function Q(e){var t=null;try{t=u.getElementById(e)}catch(i){}return t}function j(e){return u.createElement(e)}function W(e,t,i){e.attachEvent(t,i);g[g.length]=[e,t,i]}function V(e){var t=S.pv,i=e.split(".");i[0]=parseInt(i[0],10);i[1]=parseInt(i[1],10)||0;i[2]=parseInt(i[2],10)||0;return t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?true:false}function z(e,n,o,s){if(S.ie&&S.mac){return}var r=u.getElementsByTagName("head")[0];if(!r){return}var a=o&&typeof o=="string"?o:"screen";if(s){C=null;y=null}if(!C||y!=a){var l=j("style");l.setAttribute("type","text/css");l.setAttribute("media",a);C=r.appendChild(l);if(S.ie&&S.win&&typeof u.styleSheets!=t&&u.styleSheets.length>0){C=u.styleSheets[u.styleSheets.length-1]}y=a}if(S.ie&&S.win){if(C&&typeof C.addRule==i){C.addRule(e,n)}}else{if(C&&typeof u.createTextNode!=t){C.appendChild(u.createTextNode(e+" {"+n+"}"))}}}function K(e,t){if(!x){return}var i=t?"visible":"hidden";if(b&&Q(e)){Q(e).style.visibility=i}else{z("#"+e,"visibility:"+i)}}function G(e){var i=/[\\\"<>\.;]/;var n=i.exec(e)!=null;return n&&typeof encodeURIComponent!=t?encodeURIComponent(e):e}var J=function(){if(S.ie&&S.win){window.attachEvent("onunload",function(){var t=g.length;for(var i=0;i<t;i++){g[i][0].detachEvent(g[i][1],g[i][2])}var n=p.length;for(var o=0;o<n;o++){H(p[o])}for(var s in S){S[s]=null}S=null;for(var r in e){e[r]=null}e=null})}}();return{registerObject:function(e,t,i,n){if(S.w3&&e&&t){var o={};o.id=e;o.swfVersion=t;o.expressInstall=i;o.callbackFn=n;f[f.length]=o;K(e,false)}else{if(n){n({success:false,id:e})}}},getObjectById:function(e){if(S.w3){return D(e)}},embedSWF:function(e,n,o,s,r,a,l,u,d,c){var h={success:false,id:n};if(S.w3&&!(S.wk&&S.wk<312)&&e&&n&&o&&s&&r){K(n,false);q(function(){o+="";s+="";var f={};if(d&&typeof d===i){for(var p in d){f[p]=d[p]}}f.data=e;f.width=o;f.height=s;var g={};if(u&&typeof u===i){for(var _ in u){g[_]=u[_]}}if(l&&typeof l===i){for(var m in l){if(typeof g.flashvars!=t){g.flashvars+="&"+m+"="+l[m]}else{g.flashvars=m+"="+l[m]}}}if(V(r)){var v=P(f,g,n);if(f.id==n){K(n,true)}h.success=true;h.ref=v}else{if(a&&N()){f.data=a;O(f,g,n,c);return}else{K(n,true)}}if(c){c(h)}})}else{if(c){c(h)}}},switchOffAutoHideShow:function(){x=false},ua:S,getFlashPlayerVersion:function(){return{major:S.pv[0],minor:S.pv[1],release:S.pv[2]}},hasFlashPlayerVersion:V,createSWF:function(e,t,i){if(S.w3){return P(e,t,i)}else{return undefined}},showExpressInstall:function(e,t,i,n){if(S.w3&&N()){O(e,t,i,n)}},removeSWF:function(e){if(S.w3){H(e)}},createCSS:function(e,t,i,n){if(S.w3){z(e,t,i,n)}},addDomLoadEvent:q,addLoadEvent:E,getQueryParamValue:function(e){var t=u.location.search||u.location.hash;if(t){if(/\?/.test(t)){t=t.split("?")[1]}if(e==null){return G(t)}var i=t.split("&");for(var n=0;n<i.length;n++){if(i[n].substring(0,i[n].indexOf("="))==e){return G(i[n].substring(i[n].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(k){var e=Q(r);if(e&&_){e.parentNode.replaceChild(_,e);if(m){K(m,true);if(S.ie&&S.win){_.style.display="block"}}if(v){v(w)}}k=false}}}}()};require("jquery.whenIdle");var i=require("settings");var n=function(i,n){t();return e[i].apply(e,n)};exports.embedSWF=function(){var e=arguments;$.whenIdle(350,function(){n("embedSWF",e)},"load swfobject (from embedSWF)")};exports.removeSWF=function(){return n("removeSWF",arguments)};$.whenIdle(350,t,"load swfobject (by timeout)")},{"jquery.whenIdle":true,settings:true});require.install("flash",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2").FlashClient={};exports.FlashClient=e.extend({onLoad:function(e){if(e){t.onInit=this.delayedFn(this.onFlashInit);t.onComplete=this.fnbind(this.onComplete);try{require("swfobject").embedSWF(this.swf_url,this.$("#@flash").attr("id"),"1","1","10.0.0",null,this.flash_vars,{allowScriptAccess:"always"},{allowscriptaccess:"always"})}catch(i){$.serverLog("error in swfobject library: "+i)}}},delayedFn:function(e){return this.fnbind(function(){var t=arguments;setTimeout(this.fnbind(function(){e.apply(this,t)}),1)})},onFlashInit:function(){try{this.getSwf().init(this.so,this.cp,this.fc)}catch(e){$.serverLog("Unable to call onFlashInit(): "+e)}},onComplete:function(){},getSwf:function(){return this.$("#@flash").get(0)}})},{webnode2:true,swfobject:true,"w2.quora":true});require.install("app/view/thread",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor").InlineEditor;exports.ThreadComposeMessageBox=e.extend({onLoad:function(){this.$("#@submit").click(this.fnbind(function(){this.lookup("editor").request();return false}))}});exports.ThreadMessageInlineEditor=t.extend({trigger_request:function(){if(this.typing_area){this.lookup("editor").stopTyping()}this.lookup("editor").request();this.lookup("editor").resetThreadDetailHeight()},server_call_method:"UNDEFINED_SERVER_CALL_METHOD",_get_kwargs:function(){$.serverLog("Tried to call ThreadMessageInlineEditor#_get_kwargs()","ERROR");throw"UNDEFINED_KWARGS"}})},{"view/inline_editor":true,"w2.quora":true});require.install("app/view/survey/question_page",function(require,exports,module){var e=require("w2.quora").Component;exports.Survey=e.extend({onLoad:function(){var e=this;e.bindSurveyDismissHandler();e.bindSurveySubmitHandler();e.serverCall("show_card").send()},bindSurveySubmitHandler:function(){var e=this;this.$("#@submit_form").on("click",function(){var t=e.$("#@survey_form").find("input[type='radio']:checked").val();var i=$(this).parents(".Survey");var n=e.$("#@response_input").val();if(typeof t!=="undefined"){e.serverCall("submit_survey").kwargs({selected_option:t,response_text:n}).success(function(){e.$("#@survey_wrapper").addClass("hidden");e.$("#@feedback").removeClass("hidden");i.hide()}).send()}})},bindSurveyDismissHandler:function(){var e=this;this.$("#@dismiss").on("click",function(){e.$("#@survey").fadeOut(800);e.serverCall("dismiss_survey").send()})}})},{"w2.quora":true});require.install("app/view/topic/topic_ontology",function(require,exports,module){var e=require("w2.quora").Component;exports.AddTopicParents=e.extend({onLoad:function(){this.$("#@existing_link").click(this.fnbind(function(e){e.preventDefault();this.$("#@existing_link").addClass("hidden");this.$("#@existing").removeClass("hidden");this.lookup("parent_selector").focus()}))}});exports.AddTopicChildren=e.extend({onLoad:function(){this.$("#@existing_link").click(this.fnbind(function(e){e.preventDefault();this.$("#@existing_link").addClass("hidden");this.$("#@existing").removeClass("hidden");this.lookup("child_selector").focus()}))}});exports.OrganizeChildItem=e.extend({toggleInstruction:function(){this.$("#@instruction").toggleClass("hidden")}});exports.ManageParentTopicsLink=e.extend({onLoad:function(){var e=this;e.$("#@link").click(function(t){t.preventDefault();e.modal("load")})}})},{"w2.quora":true});require.install("app/view/topic/leaderboard",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/hover_menu").HoverMenu;exports.LeaderboardHoverMenu=t.extend({isInvalidCloseTarget:function(e){var t=this.$("#@menu");var i=this._super.apply(this,arguments);if(i||e.parents().filter(t).length>0){return true}return false}});exports.HideFromProfileLink=e.extend({onLoad:function(){var e=this;e.$("#@hide_from_profile").click(function(t){e.serverCall("hide_from_profile").success(function(){e.$("%@link").toggleClass("hidden")}).send();t.preventDefault()});e.$("#@show_on_profile").click(function(t){e.serverCall("show_on_profile").success(function(){e.$("%@link").toggleClass("hidden")}).send();t.preventDefault()})}});exports.LeaderboardStatus=e.extend({onLoad:function(){var e=this;e.$("#@refresh_link").click(function(t){t.preventDefault();e.refreshLeaderboard()})},refreshLeaderboard:function(){var e=this;e.serverCall("refresh_leaderboard").kwargs({tid:e.tid}).success(function(){e.$("#@refresh_link").addClass("completed").text("Refreshing completed. (Reloading the page)");require("window_manager").reload()}).error(function(){e.$("#@refresh_link").addClass("completed").text("Refreshing failed! Reload to retry.")}).send();e.$("#@refresh_link").addClass("completed").text("Refreshing started...")}});exports.AddToBlacklistMVW=e.extend({onLoad:function(){var e=this;e.$("#@add_link").click(function(t){t.preventDefault();e.update(false)});e.$("#@remove_link").click(function(t){t.preventDefault();e.update(true)})},update:function(e){var t=this;t.serverCall("update").kwargs({tid:t.tid,is_removal:e}).success(function(){if(e===true){t.$("#@remove_link").addClass("completed").text("Removed")}else{t.$("#@add_link").addClass("completed").text("Added")}}).send()}})},{"view/hover_menu":true,window_manager:true,"w2.quora":true});require.install("app/view/draft",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings").interface_strings;exports.ClearDraft=e.extend({onLoad:function(){this.$("#@clear_draft").click(this.fnbind(function(){var e={};e[this.clear_draft_title]=this.fnbind(function(){this.serverCall("clear_draft").liveMutate().send()});e[t.cancel]=null;$(".ContentWrapper").dialog({title:this.clear_draft_title,contents:this.clear_draft_message,buttons:e});return false}))}})},{settings:true,"w2.quora":true});require.install("app/view/board/follow",function(require,exports,module){var e=require("w2.quora").Component;exports.BoardMemberSelector=e.extend({onLoad:function(e){if(this.focusOnload&&e){this.focus()}},focus:function(){this.lookup("selector").focus(true)},clear:function(){this.lookup("selector").reset()},setTo:function(e){if(e&&e!==""){this.serverCall("add").kwargs({bid:this.bid,target_uid:e}).success(this.fnbind(function(){this.focus()})).liveMutate().send()}}})},{"w2.quora":true});require.install("app/view/board/view_tracker",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("event").add;exports.instance=null;exports.BoardItemViewTracker=e.extend({init:function(){exports.instance=this;this.all_board_item_ids={};this.reported_board_item_ids={};this.last_report_time=+new Date;this.rate_limit_ms=3e3},onLoad:function(){var e=this.fnbind(this.report);i(document,"mousemove",e);i(document,"keypress",e);i(document,"scroll",e)},addBoardItem:function(e,t){this.all_board_item_ids[e]=t},removeBoardItem:function(e,t){delete this.all_board_item_ids[e]},isBoardItemVisible:function(e){var i=t._domids[e];if(!i){return false}var n=document.getElementById(i);if(!n){return false}var o=$(n);if(!o.children("div:first").is(":in-viewport")){return false}if(!o.is(":visible")){return false}return true},report:function(){var e=+new Date;if(e<this.last_report_time+this.rate_limit_ms){return}this.last_report_time=e;var t=[];for(var i in this.all_board_item_ids){var n=this.all_board_item_ids[i];if(this.reported_board_item_ids[n]===undefined){if(this.isBoardItemVisible(i)){t.push(n);this.reported_board_item_ids[n]=true}}}if(t.length>0){this.serverCall("report").kwargs({board_item_ids:t}).send()}}})},{webnode2:true,event:true,"w2.quora":true});require.install("app/view/board/item",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies"),i=require("window_manager"),n=require("app/view/board/view_tracker"),o=require("view/inline_editor").InlineEditor,s=require("views").viewsLogger;exports.BoardItemTimestamp=e.extend({onLoad:function(e){var n=this;n.$("#@link").mousedown(function(){t.setQfeedLog(n,"BoardItemClickthrough");t.setQueryLog(n,"BoardItemClickthrough")});n.onKeyCombination(n.$("#@link"),"o",function(){i.navigateTo(n.$("#@link").attr("href"));return false})}});exports.BoardItemTitle=e.extend({onLoad:function(e){var i=this;i.$("#@link").mousedown(function(){t.setQfeedLog(i,"BoardItemClickthrough");t.setQueryLog(i,"BoardItemClickthrough")})}});exports.LinkBoardItemView=e.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$("#@edit").click(function(){e.showEditor();return false});e.$("#@item").hover(function(t){e.$("#@item").addClass("hover")},function(t){e.$("#@item").removeClass("hover")})},showEditor:function(){this.cQuery(":description.editor").toggle_editor()}});exports.LinkBoardItemDescriptionInlineEditor=o.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.board_item=e.lookup("board_item");e.setToggleCallback(function(){e.board_item.$("#@preview, #@edit").toggle()})},_get_kwargs:function(){return{input:this.get_value(),preview:this.cQuery(":link_editor.preview").getLinkInfo()}}});exports.BoardListItem=e.extend({onLoad:function(){if(n.instance){n.instance.addBoardItem(this.cid,this.board_item_id)}},onUnload:function(){if(n.instance){n.instance.removeBoardItem(this.cid,this.board_item_id)}}});exports.BoardItem=e.extend({onLoad:function(){s.addComponentToTrack(this)}})},{cookies:true,window_manager:true,views:true,"view/inline_editor":true,"app/view/board/view_tracker":true,"w2.quora":true});require.install("html",function(require,exports,module){var e=document.createElement("div");exports.encode=function(t){e.innerText=t;return e.innerHTML};exports.decode=function(t){e.innerHTML=t;return e.innerText}},{});require.install("async_post",function(require,exports,module){var e=require("webnode2");function t(t){var i=this,n=[],o=null,s=500,r=false,a=[];i.send=function(e){n.push(e);l()};function l(){if(o){clearTimeout(o)}o=setTimeout(u,s)}function u(){if(n.length===0){return}if(r){l();return}r=true;a=n;n=[];e.rpc(t).kwargs({messages:a}).success(d).error(c).send()}function d(){a.length=0;r=false}function c(){n=n.concat(a);a.length=0;r=false}return i}exports.AsyncPost=function(e){return t(e)}},{webnode2:true});require.install("typeahead",function(require,exports,module){var e=require("simscroll"),t=require("window_manager"),i=require("cookies"),n=require("w2.quora").Component,o=require("html"),s=require("siteuri").URI,r=require("settings").keyboardShortcuts,a=require("email"),l=require("async_post").AsyncPost,u=require("e2e"),d=require("assert").ok;var c=l("/ajax/typeahead_log_POST");function h(){return new Date}exports.TypeaheadResults=n.extend({onLoad:function(){this.focusedIndex=null;this.instructions=null;this.runSetup()},preventOverflow:function(){var e=this.$("#@results_frame");var i=e.offset().top;var n=e.outerHeight(true);var o=i+n;var s=$(window).scrollTop()+t.headerOffset;var r=$(window).scrollTop()+$(window).height();var a=r-i;var l=i-s;var u;if(n&&$(document.body).height()<n){$(document.body).height(n)}if(l>500&&a<200){e.addClass("inverted");u=s-e.offset().top}else{u=o-r}if(u>0){e.css({"overflow-y":"scroll",height:n-u})}},runSetup:function(){for(var e=0;e<this.results.length;e++){this.setupListItem(e)}},setupListItem:function(e){var t=this.$("#@list_item_"+e);t.addClass("needsclick");this.$("#@list_item_"+e+" *").addClass("needsclick");t.mouseover(this.fnbind(function(t){this.setFocusIndex(e);return false}));t.mouseout(this.fnbind(function(){this.setFocusIndex(null);return false}));t.mousedown(this.fnbind(function(t){t.stopPropagation();t.preventDefault();return this.goResult(e,t)}))},hideDropdown:function(e,t){var i=this.$("#@results_frame");if(e){this.parent().shouldAnimateShowDropdown=true;i.removeClass("fade_in").addClass("fade_out");setTimeout(function(){i.removeClass("is_shown").removeClass("fade_out");if(t){t()}},150)}else{i.removeClass("is_shown");if(t){t()}}},showDropdown:function(e,t){if(this.results.length){var i=this.$("#@results_frame");if(this.parent().shouldAnimateShowDropdown){e=true;this.parent().shouldAnimateShowDropdown=false}if(e){if(!i.hasClass("fade_in")){i.addClass("is_shown").addClass("fade_in")}setTimeout(function(){if(t){t()}},150)}else{i.addClass("is_shown")}this.preventOverflow()}},isVisible:function(){var e=this.$("#@results_frame");return e.is(":visible")&&e.css("visibility")!="hidden"},hide:function(){this.hideDropdown(true);this.setFocusIndex(null)},getResult:function(e){return this.results[e]},logData:function(e){if(this.query&&this.log_data_json){var t={data:this.log_data_json,click_index:e};c.send(t)}},goResult:function(e,i){this.logData(e);if(this.actionType=="url"){t.handleClick(this.actionOfIndex[e],i)}else if(this.actionType=="value"){this.hide();this.qValue=this.actionOfIndex[e];this.parent().setValue(this.qValue,this.results[e]);return false}else{d(0)}},down:function(){if(this.focusedIndex===null){this.setFocusIndex(0)}else if(this.focusedIndex<this.nResults-1){this.setFocusIndex(this.focusedIndex+1)}else if(this.focusedIndex==this.nResults-1){this.setFocusIndex(null)}},up:function(){if(this.focusedIndex===null){this.setFocusIndex(this.nResults-1)}else if(0===this.focusedIndex){this.setFocusIndex(null)}else if(0<this.focusedIndex){this.setFocusIndex(this.focusedIndex-1)}},go:function(e){if(this.focusedIndex!==null){this.goResult(this.focusedIndex,e);return true}return false},setFocusIndex:function(e,t){if(this.empty){return}var i=this.$("#@list_item_"+e);if(this.focusedIndex!==null){this.$("#@list_item_"+this.focusedIndex).removeClass("selected")}if(i.hasClass("instruction")){if(t&&t.cancelIfSelectingInstruction||this.focusedIndex===e+1){this.focusedIndex=null}else{this.setFocusIndex(e+1)}return}if(i.length===0){this.focusedIndex=null;return}if(e!==null){i.addClass("selected");var n=$(window),o=n.scrollTop(),s=i.offset().top+i.height()+20-(o+n.height());if(s>0){n.scrollTop(o+s)}}this.focusedIndex=e}});exports.NavigatorResults=exports.TypeaheadResults.extend({onLoad:function(){this._super.apply(this,arguments);this.cookieSet=false},setCookieHelper:function(e,t){if(!this.cookieSet){this.cookieSet=true;i.setMessage("qrl",[require("webnode2").windowId,this.query,this.matchTargetsJson,this.contextTid,e]);i.setSingleUse("q",JSON.stringify(this.query))}},goResult:function(e,t){var n=e;if(this.query&&this.numMatches>0){if(n>=this.numMatches){n=-1}if(!this.cookieSet){this.cookieSet=true;i.setMessage("qrl",[require("webnode2").windowId,this.query,this.matchTargetsJson,this.contextTid,n]);i.setSingleUse("q",JSON.stringify(this.query))}}this._super.apply(this,arguments)}});exports.FullNavigatorResults=exports.NavigatorResults.extend({onLoad:function(e){this._super.apply(this,arguments);if(e||!this.query){this.hideDropdown()}this.focusedIndex=null;this.instructions=null;this.forceOpenResults=false;this.openResultsLinkInNewTab=this.parent().openResultsLinkInNewTab();if(!this.openResultsLinkInNewTab){this.runSetup()}},hideDropdown:function(e,t){if(!this.forceOpenResults){this._super.apply(this,arguments);this.parent().parent().$("#@results_tray").hide()}},hide:function(){this.hideDropdown(true);if(!this.forceOpenResults){this.setFocusIndex(null)}},showDropdown:function(e,t){if(this.results.length){this.$("#@results_frame").show();var i=null;var n=this.parent().parent().$("#@results_tray");if(this.results.length<=1){i=35}else{var o=Math.max(375,this.results.length*35);i=o}n.show();if(parseInt(n.height(),10)!==parseInt(i,10)){n.css("height",i+"px")}}},goResult:function(e,i){this.forceOpenResults=true;if(this.actionType=="url"){this.setCookieHelper(e,i);if(this.$("#@list_item_"+e).hasClass("addquestionitem")){this.parent().addQuestionClick()}else{t.handleClick(this.actionOfIndex[e],i)}}else{d(0)}},go:function(e){this.forceOpenResults=true;if(this.focusedIndex!==null){if(this.$("#@list_item_"+this.focusedIndex).hasClass("addquestionitem")){this.parent().addQuestionClick()}else{this.goResult(this.focusedIndex,e)}return true}return false},down:function(){if(this.focusedIndex===null){this.setFocusIndex(0)}else if(this.focusedIndex<this.nResults-1){this.setFocusIndex(this.focusedIndex+1)}else if(this.focusedIndex===this.nResults-1){if(this.highlightAddQuestion){this.setFocusIndex(0)}else{this.setFocusIndex(null)}}}});exports.InlineQuestionsNavigatorResults=exports.FullNavigatorResults.extend({onLoad:function(e){this._super.apply(this,arguments);for(var t=0;t<this.results.length;t++){this.bindListItem(t)}},bindListItem:function(e){this.$("#@list_item_"+e).click(this.fnbind(function(){this.serverCall("log_question_click").send()}))}});exports.Typeahead=n.extend({onLoad:function(){this.qValue=this.initialValue;this.result=null;this.requestOutstanding=false;this.closed=false;this.selectionChosen=false;this.selectionlessCallback=null;this.placeholderActive=false;this.extraKeydown=null;this.userClicked=false;this.shouldAnimateShowDropdown=true;this.simulateScroll=true;var e=this.$("#@input").attr("placeholder");this.$("#@input").attr("placeholder",o.decode(e));this.$("#@view_selector").click(this.fnbind(function(){this.$("#@selector_wrapper").removeClass("hidden");this.$("#@view_selector_wrapper").addClass("hidden");this.focus(true);return false}));var t=this;if(!t.data){t.data={}}t.$("#@input").focus(function(){$(this).attr("focused","true");t.inputFocus();if(t.extraFocus){t.extraFocus()}}).blur(function(){if(!t.$("#@results_shell").children(".results_frame:hover").length){$(this).removeAttr("focused");t.inputBlur();t.userClicked=false}else{t.$("#@input").focus()}}).keydown(function(e){return t.inputKeydown(e)}).keyup(function(e){return t.inputKeyup(e)}).keypress(function(e){if(e.which==13||e.which==27){e.stopPropagation();e.preventDefault();return false}}).click(function(){t.userClicked=true})},getRequestUpdatePostData:function(){return{q:this.qValue,data:JSON.stringify(this.data)}},requestUpdate:function(){this.requestOutstanding=true;this.requestStartTime=h();var e=this.getRequestUpdatePostData();e.___W2_parentId=this.cid;e.___W2_windowId=require("webnode2").windowId;var i=$.param(e).replace(/\+/g,"%20");var n=u.startAction({url:t.getURL(),vcon:this.fakeVcon,method:this.fakeMethod,mustReport:Math.random()<u.SAMPLE_RATE,server_time:1,standard:{server_side:100,e2e:200,owner:6}});var o=this.fnbind(function(){$.ajax({type:"GET",url:this.resultsQueryPath,dataType:"json",data:i,success:this.fnbind(function(e){u.finishAction(n.id);this.ajaxCallback(e)}),error:this.fnbind(function(e,t,i){this.requestOutstanding=false})})});if(!e||e.q.length===0){this.child("results").hideDropdown(true,o)}else{o()}},close:function(){this.closed=true;this.child("results").hide()},clear:function(){this.clearInput();this.close()},clearInput:function(){this.$("#@input").val("");this.$("#@input").get(0).style.backgroundColor="#fff"},reset:function(){this.qValue=this.initialValue;this.clearInput();this.result=null},resetFocus:function(){this.reset();this.requestUpdate();this.focus();this.inputFocus()},setCallback:function(e){var t=this.callback;if(!t){t=e}else{var i=t;t=function(){i();e()}}this.callback=t},setSelectionlessCallback:function(e){var t=this.selectionlessCallback;if(!t){t=e}else{var i=t;t=function(){i();e()}}this.selectionlessCallback=t},setExtraFocus:function(e){this.extraFocus=e},setExtraKeydown:function(e){this.extraKeydown=e},setValue:function(e,t){this.qValue=e;this.$("#@input").val(this.qValue);this.result=t;var i=this.$("#@input");this.selectionChosen=true;if(this.callback){this.callback()}},getValue:function(){if(this.placeholderActive){return""}else{return this.$("#@input").val()}},ajaxCallback:function(e){var t=h();if(!this.requestOutstanding){return}this.requestOutstanding=false;if(this.closed){return}if(!this.child("results")){return}require("webnode2").unloadComponent(this.child("results").cid);this.$("#@results_shell").setContent(e);if(!this.child("results").empty&&(this.child("results").query||this.always_show_dropdown_on_results)){this.child("results").showDropdown()}if(this.child("results").query!=this.qValue){this.requestUpdate()}if(this.shouldHighlightFirstResult()){this.child("results").setFocusIndex(0,{cancelIfSelectingInstruction:true})}if(this.child("results").highlightAddQuestion){this.child("results").setFocusIndex(this.child("results").results.length-1,{cancelIfSelectingInstruction:true})}if(this.parent().typeaheadUpdateReturned){this.parent().typeaheadUpdateReturned()}if(this.openResultsLinkInNewTab){this.$("#@results_shell").find('a[href!="#"]').attr("target","_blank")}},openResultsLinkInNewTab:function(){return false},shouldHighlightFirstResult:function(){return this.minAutoFocusIndexLength&&this.qValue.length<this.minAutoFocusIndexLength||this.child("results").highlightFirst},inputKeydown:function(t){var i=this.$("#@input"),n=i.val();if(this.simulateScroll&&!this.child("results").isVisible()&&!this.requestOutstanding&&e.maybeSimulateScroll(t)){i.blur();return false}e.cancelSimulatedScroll();if(t.keyCode==40){this.requestOutstanding=false;this.child("results").down();return false}else if(t.keyCode==38){this.child("results").up();return false}else if(t.keyCode==27){this.child("results").hide();this.userClicked=false;return false}else if(t.keyCode==13){if(this.child("results").go(t)){return false}else if(this.selectionlessCallback&&this.selectionlessCallback()){return false}}if(this.extraKeydown){return this.extraKeydown(t.keyCode)}
return true},inputKeyup:function(){this.onInputChange();return false},onInputChange:function(){var e=this.getValue();if(e==this.qValue){return}this.qValue=e;if(!this.requestOutstanding){this.requestUpdate()}if(this.qValue===""){this.closed=false}},inputBlur:function(){this.setPlaceholder();this.blurFakeInput();if(this.child("results")&&!this.no_hide_on_blur){this.child("results").hide()}},disable:function(){this.close();this.$("#@input").attr("disabled","disabled");this.$("#@input").css("background","#e0e0e0")},enable:function(){this.$("#@input").attr("disabled",false);this.$("#@input").css("background","#fff")},setText:function(e){var t=this.$("#@input").val();if(t!=e){this.$("#@input").val(e);this.onInputChange()}},setPlaceholder:function(){var e=this.$("#@input").attr("placeholder");if(e&&!this.getValue()){this.placeholderActive=true;this.$("#@input").addClass("light");this.$("#@input").val(e)}},removePlaceholder:function(){if(this.placeholderActive){this.placeholderActive=false;this.$("#@input").removeClass("light");this.clearInput()}},focus:function(e){if(e){}else if(window.getSelection){if(window.getSelection().rangeCount>0){return}}else if(document.selection&&document.selection.createRange()){return}if(!this.$("#@input").is(":visible")){return}this.$("#@input").attr("focused",true);this.closed=false;this.$("#@input").focus();this.removePlaceholder()},inputFocus:function(){this.$("#@input").attr("focused",true);this.removePlaceholder();this.$("#@input").get(0).style.backgroundColor="";this.focusFakeInput();if(this.selectionChosen){this.selectionChosen=false;this.result=null;this.requestUpdate()}else if(!this.focusOnLoad||this.userClicked&&this.focusOnLoad){this.showResultsDropdown()}},focusFakeInput:function(){this.$("#@input").closest(".search_input").addClass("focus")},blurFakeInput:function(){this.$("#@input").closest(".search_input").removeClass("focus")},showResultsDropdown:function(){this.child("results").showDropdown()},hideResultsDropdown:function(){this.child("results").hideDropdown(true)},cursorPosition:function(e){var t=e.get(0);var i=null;if(t.selectionStart!==undefined){if(t.selectionStart==t.selectionEnd){i=t.selectionStart}}else if(document.selection){var n=document.selection.createRange().duplicate();if(n.text===""){n.moveEnd("character",t.value.length);if(n.text===""){i=t.value.length}else{i=t.value.lastIndexOf(n.text)}}}return i},addIgnoreOid:function(e){if(typeof this.data.ignore_oids=="undefined"){this.data.ignore_oids=[]}this.data.ignore_oids.push(e)},removeIgnoreOid:function(e){if(typeof this.data.ignore_oids=="undefined"){this.data.ignore_oids=[]}var t=this.data.ignore_oids.indexOf(e);if(t>-1){this.data.ignore_oids.splice(t,1)}}});exports.ContextTypeahead=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.width=this.$("#@input").outerWidth();this.paddingRight=parseInt(this.$("#@input").css("paddingRight").replace("px",""),10);this.orgPlaceholder=this.$("#@input").attr("placeholder");if(this.child("context")&&this.child("context").setDefault){this.child("context").setDefault();if(this.context_dict.id){this.clearInstruction()}}if(this.child("context")&&this.child("context").hasContext()){this.showClearButton()}this.$("#@clear").click(this.fnbind(function(){this.reset();this.resetContext();this.clearInstruction();this.$("#@input").focus();return false}));this.setExtraKeydown(this.fnbind(function(e){if(e==9){var t=this.child("results").focusedIndex?this.child("results").focusedIndex:0;var i=this.child("results").getResult(t);if(i&&i.text){this.clearInstruction();this.context_dict={type:i.type,id:i.id};this.child("context").setContext(i.text,i.url);this.$("#@input").val("");this.showClearButton();return false}}else if(e==8){var n=this.$("#@input");if(n.val()===""||this.cursorPosition(n)===0){this.resetContext()}}return true}));this.setExtraFocus(this.fnbind(function(){this.$("#@input_wrapper").css("background-color","#fff")}));if(this.focusOnLoad){this.focus()}else{this.setPlaceholder()}},showClearButton:function(){this.$("#@clear").show()},hideClearButton:function(){this.$("#@clear").hide()},clearInstruction:function(){this.$("#@input").attr("placeholder","");this.removePlaceholder()},resetContext:function(){this.context_dict={};this.child("context").removeContext();this.$("#@input").attr("placeholder",this.orgPlaceholder);this.hideClearButton();this.requestUpdate()},getRequestUpdatePostData:function(){var e={q:this.qValue,context_type:this.context_dict.type,context_id:this.context_dict.id,data:JSON.stringify(this.data)};return e}});exports.MultiSelectTypeahead=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);var t=this;t.data.partial_results=null;t.qValues=[];t.results=[];t.count=0;t.input=t.$("#@input");t.$("#@multi_select_typeahead").click(function(){t.input.focus()});t.input.keypress(function(e){if(e.which===13){t.input.attr("focused",false);t.child("results").hide();e.preventDefault()}});t.input.keydown(function(e){if(e.which===8&&t.input.val()===""){if(t.qValues.length>0){var i=t.qValues.length-1;while(i>=0&&!(i in t.qValues)){i--}if(i in t.qValues){t.remove(i);t.child("token_list").$("#@item"+i).hide()}}}t.fixWidth()});t.input.bind("paste",t.fnbind(t.fixWidth))},fixWidth:function(){var e=350;var t=50;var i=12;if(this.count===0){this.input.width(e)}else{this.input.width(Math.min(e,Math.max(t,i*this.input.val().length)))}},setValue:function(e,t){this.qValue=e;this.input.val(this.qValue);this.result=t;if($.inArray(this.qValue,this.qValues)!=-1){this.reset();return}this.qValues.push(this.qValue);this.results.push(this.result);this.data.partial_results=this.results;this.updateContainer();this.count++;this.child("token_list").addItem(this.result.text,this.qValues.length-1);this.input.attr("placeholder","");this.fixWidth();if(!this.input.hasClass("maintain_background_white")){this.input.css("background-color","#eee")}this.selectionChosen=true;if(this.callback){this.callback()}this.reset()},remove:function(e){delete this.qValues[e];delete this.results[e];this.updateContainer();this.count--;if(this.count===0){this.input.attr("placeholder",this.placeholder)}},updateContainer:function(){var e=this;this.lookup("typeaheadContainer").updateValues($.grep(this.qValues,function(t,i){return i in e.qValues}))},clear:function(){var e=this;$.each(e.qValues,function(t,i){delete e.qValues[t];delete e.results[t];e.child("token_list").$("#@item"+t).hide()});e.count=0;e.input.attr("placeholder",e.placeholder);e.resetFocus();e.fixWidth();e.updateContainer()},focusFakeInput:function(){this.$("#@input").closest(".multi_select_typeahead").addClass("focus")},blurFakeInput:function(){this.$("#@input").closest(".multi_select_typeahead").removeClass("focus")}});exports.MultiSelectTokenList=n.extend({attachRemoveClickHandler:function(e){this.$("#@remove"+e).click(this.fnbind(function(e){this.parent().remove(e);this.parent().fixWidth();this.parent().input.focus();this.$("#@item"+e).hide();return false},e))},cloneItem:function(e){var t=this.$("#@item"+e).clone();var i=t.attr("id");t.attr("id",this.constructNextId(i,e));var n=$(".token_remove",t);var o=n.attr("id");n.attr("id",this.constructNextId(o,e));var s=$(".token_name_text",t);var r=s.attr("id");s.attr("id",this.constructNextId(r,e));this.attachRemoveClickHandler(e);return t},constructNextId:function(e,t){var i=e.lastIndexOf(t);var n=e.slice(0,i)+(t+1);return n},addItem:function(e,t){this.cloneItem(t).appendTo(this.$("#@token_list"));this.$("#@text"+t).text(e);this.$("#@item"+t).css("display","inline-block")}});exports.TopicSelector=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.setCallback(this.fnbind(function(){this.lookup("topic_add").select();if(this.type!="to_tid"&&this.type!="replace_topic"){this.reset()}}));this.simulateScroll=false},shouldHighlightFirstResult:function(){return this._super.apply(this,arguments)&&this.child("results").nResults>1},addTempTopic:function(e){this.$("#@temp_topics_list").append(e);this.parent().$("#@update").show();if(this.parent().onAddTempTopic){this.parent().onAddTempTopic()}},resetTempTopics:function(e){this.$("#@temp_topics_list").text("")},hideSelector:function(){this.$("#@selector_wrapper").addClass("hidden");this.$("#@view_selector_wrapper").removeClass("hidden");this.$("#@view_selector").focus()}});exports.Navigator=exports.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@add_new_question").click(this.fnbind(function(){this.lookup("add_question").openDialog(this.qValue);return false}));this.setSelectionlessCallback(this.fnbind(function(){this.lookup("add_question").openDialog(this.qValue)}))}});exports.FullNavigator=exports.ContextTypeahead.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@input").keydown(this.fnbind(function(e){this.keydownHandler(e)}));this.$("#@input").blur(this.fnbind(function(){this.hideAddQuestionNote()}));this.$("#@input").focus(this.fnbind(function(){this.hideAddQuestionNote()}));this.$("#@add_new_question").click(this.fnbind(function(){this.addQuestionClick();return false}));this.$("#@placeholder").hover(this.fnbind(function(){this.hideInstructionPlaceholder()}));this.$("#@input").click(this.fnbind(function(){this.focus(true);return false}));this.setSelectionlessCallback(this.fnbind(function(){}));if(this.open_add_question_dialog_on_load){this.lookup("add_question").openDialog(this.qValue)}if(this.focusOnLoad){this.showInstructionPlaceholder(this.translated_instruction_placeholder)}},keydownHandler:function(e){if(e.keyCode!=13){this.hideAddQuestionNote()}},hideAddQuestionNote:function(){this.hideInstructionPlaceholder();this.lookup("add_question_note").$("#@note").hide()},addQuestionClick:function(){this.child("results").hide();this.lookup("add_question").setTid(this.getTopic());this.lookup("add_question").openDialog(this.qValue)},showInstructionPlaceholder:function(e){if(!this.$("#@input").val()&&!this.context_dict.id){this.$("#@placeholder").text(e);this.$("#@placeholder").show()}},hideInstructionPlaceholder:function(){this.$("#@placeholder").hide()},getTopic:function(){if(this.context_dict&&this.context_dict.type=="topic"){return this.context_dict.id}return null}});exports.InlineQuestionsNavigator=exports.FullNavigator.extend({onLoad:function(){this._super.apply(this,arguments)},inputBlur:function(){this.setPlaceholder();this.blurFakeInput()},addQuestionClick:function(){this.parent().addQuestion()}});exports.SearchPageInlineQuestionsNavigator=exports.InlineQuestionsNavigator.extend({onLoad:function(){this.loaded=false;this._super.apply(this,arguments);this.$("#@input").focus(this.fnbind(function(){if(!this.loaded){this.requestUpdate();this.loaded=true}}));this.simulateScroll=false},keydownHandler:function(e){this._super.apply(this,arguments);if(e.keyCode>=48&&e.keyCode<=90){this.$("#@results_shell").slideDown(100)}},close:function(){this._super.apply(this,arguments);this.$("#@results_shell").slideUp(100)},openResultsLinkInNewTab:function(){return true},addQuestionClick:function(){}});exports.InlineTopicsNavigator=exports.InlineQuestionsNavigator.extend({onLoad:function(){this._super.apply(this,arguments);this.extraKeydown=null;this.simulateScroll=false},inputBlur:function(){this.setPlaceholder();this.blurFakeInput();if(this.child("results")&&!this.no_hide_on_blur){this.child("results").$("#@results_frame").hide()}}});exports.RedirectQuestionSelector=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.setCallback(this.fnbind(function(){this.$("#@input").val($.trim($("<div>"+this.result.html+"</div>").text()));this.parent().$("#@to_qid").val(this.qValue);this.serverCall("question_redirect_preview").kwargs({to_qid:this.qValue}).contentFor(this.parent().$("#@question_redirect_preview"),{parentCID:this.cid}).send();this.$("#@input").blur()}))}});exports.WantedAnswerSelector=exports.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.setCallback(function(t){e.to_uid=e.qValue;e.lookup("wanted_answer_suggestions").setTo(e.to_uid,t)})},setValue:function(e,t,i){this.qValue=e;this.result=t;this.selectionChosen=true;if(this.callback){this.callback(i)}}});exports.WantedAnswerSelectorResults=exports.TypeaheadResults.extend({goResult:function(e,t){if(t.target.classList.contains("ask_to_answer")||t.type==="keydown"&&t.keyCode===13){var i=$(t.target).parents("li");this.logData(e);this.qValue=this.actionOfIndex[e];this.lookup("wanted_answer_selector").setValue(this.qValue,this.results[e],i);this.updateResultItem(i);return false}},updateResultItem:function(e){e.children(".text_col.asked").removeClass("hidden");e.children(".text_col.ask").addClass("hidden");e.children(".ask_button_column").addClass("hidden")}});exports.FeedControlSelectorResults=exports.TypeaheadResults.extend({goResult:function(e,t){var i=this;var n=$(t.target).parents("a");if(n){if(n.hasClass("pressed")){n.removeClass("pressed");n.children("span").text(i.follow_text)}else{n.addClass("pressed");n.children("span").text(i.unfollow_text)}}}});exports.PeopleSelector=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.setCallback(this.fnbind(function(){this.to_uid=this.qValue;this.reset();this.parent().setTo(this.to_uid)}));if(this.parent().allow_selectionless_input){this.setSelectionlessCallback(this.fnbind(function(){this.to_uid=this.qValue;this.reset();this.parent().setTo(this.to_uid)}))}}});exports.EndorsementSelector=exports.PeopleSelector.extend({addQuestionBoxClass:function(e){this.$("#@input").addClass(e)}});exports.ContactsSelector=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.setCallback(this.fnbind(function(){this.setEmail(this.qValue)}));if(this.allow_selectionless_input){this.setSelectionlessCallback(this.fnbind(function(){this.setEmail(this.qValue)}))}if(this.trigger_selection_on_blur){this.$("#@input").blur(this.fnbind(function(){var e=this.$("#@input").val();if(e&&e!=this.placeholder){this.setEmail(e)}}))}this.$("#@input").keypress(this.fnbind(function(e){if(e.which==13){this.$("#@input").attr("focused",false);this.child("results").hide();e.preventDefault()}}))},setEmail:function(e){this.parent().setTo(e);if(this.forceReset){this.reset()}}});exports.LinkSelector=exports.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.simulateScroll=false;e.$("#@input").keydown(function(){if(e._escKeyDown){return e._escKeyDown.apply(this,arguments)}});e.$("#@input").keyup(function(t){if(e._keyUp){return e._keyUp.apply(this,arguments)}})},setEscKeyDown:function(e){this._escKeyDown=e},setKeyUp:function(e){this._keyUp=e}});exports.BoardSelector=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.qValue=this.bid?this.bid:null;this.simulateScroll=false;this.$("#@fake_input").click(this.fnbind(function(){this.clearInput();return false}));this.setSelectionlessCallback(function(){this.child("results").hideDropdown();this.focusNext()});this.setCallback(this.fnbind(function(){var e=this.getBid();if(e){this.swapInput(e)}else{this.$("#@input").css("background","#fff");this.focusNext();return}}));this.$("#@input").click(this.fnbind(function(e){e.stopPropagation()}));this.child("results").$("#@results_frame").click(this.fnbind(function(e){e.stopPropagation()}));$(document).click(this.fnbind(function(){if(this.child("results")){this.child("results").hide()}}))},inputBlur:function(){this.setPlaceholder()},setInput:function(e){this.setValue(e);this.swapInput(e)},swapInput:function(e){this.$("#@input_wrapper").hide();this.$("#@fake_input").show();this.selectionChosen=false;this.serverCall("update_preview").kwargs({bid:e}).contentFor(this.$("#@fake_input"),{parentCID:this.cid}).send();this.focusNext()},focusNext:function(){try{if(this.cQuery(":editor.editor")){this.cQuery(":editor").showEditor()}}catch(e){}},resetFakeInput:function(){this.qValue=this.initialValue;this.$("#@fake_input").hide();this.$("#@input_wrapper").show();this.$("#@input").val("");this.$("#@input").css("background","#fff")},clearInput:function(e){this.resetFakeInput();this.focus(true);this.child("results").showDropdown()},getText:function(){var e=this.$("#@input").val();if(e==this.$("#@input").attr("placeholder")){return null}else{return e}},getBid:function(){return isNaN(this.qValue)?null:this.qValue}});exports.PeopleAndSocialContactsSelector=exports.Typeahead.extend({onLoad:function(e){this._super.apply(this,arguments);this.setCallback(this.fnbind(function(){if(this.result&&this.result.text){this.setUserOrEmail(this.qValue,this.result.text)}else{this.setUserOrEmail(this.qValue,this.qValue)}}));if(this.allow_selectionless_input){this.setSelectionlessCallback(this.callback)}if(this.trigger_selection_on_blur){this.$("#@input").blur(this.fnbind(function(){var e=this.$("#@input").val();if(e&&e!=this.placeholder){this.setUserOrEmail(e,e)}}))}this.$("#@input").keypress(this.fnbind(function(e){if(e.which==13){this.$("#@input").attr("focused",false);this.child("results").hide();e.preventDefault()}}))},setUserOrEmail:function(e,t){if(typeof e=="string"&&e.indexOf("@")>=0){this.parent().setEmailTo(e,t)}else if(typeof e=="number"){this.parent().setUserTo(e,t)}else{}this.reset()}});exports.PeopleAndSocialContactsMultiSelector=exports.MultiSelectTypeahead.extend({onLoad:function(e){this._super.apply(this,arguments);var t=this;if(t.allow_selectionless_input){t.setSelectionlessCallback(t.fnbind(t.setWithoutSelection))}if(t.trigger_selection_on_blur){t.input.blur(t.fnbind(t.setWithoutSelection))}},setWithoutSelection:function(){if(this.qValue&&a.isValidEmail(this.qValue)){this.setValue(this.qValue,{type:"contact",value:this.qValue,text:this.qValue})}},updateContainer:function(){var e=this;this.lookup("socialTypeaheadContainer").updateResults($.grep(this.results,function(t,i){return i in e.results&&t.type!=="instruction"}))}});exports.SearchSuggestions=exports.TypeaheadResults.extend({onLoad:function(){this._super.apply(this,arguments);var e=this.$(".full_search.instant_results").width();this.$("#@results_frame").css("width",e)},hide:function(){this.hideDropdown(true);if(!this.forceOpenResults){this.setFocusIndex(null)}},goResult:function(e,n){if(this.actionType=="url"){this.serverCall("log_navigator_click").kwargs({query_hash:this.query_hash,index:e}).send();this.setCookies();var o=this.results[e].type||null;if(o=="addquestionitem"){var s=this.results[e].question;var r=this.parent().lookup("wizard");r.close();var a=this.results[e].query||null;var l=s;r.open(s,false,false,a,l,"skip_1");return}var u=this.query_type;if(u=="all"){i.setSingleUse("q",JSON.stringify(this.results[e].plaintext))}else if(u=="author"){i.setSingleUse("q",JSON.stringify("author: "+this.parent().selectedAuthor+": "+this.results[e].plaintext))}else{i.setSingleUse("q",JSON.stringify(u+": "+this.results[e].plaintext))}if(this.parent().isAuthorSelected===true){var c=this.actionOfIndex[e].slice(0,20);var h=this.actionOfIndex[e].slice(20,this.actionOfIndex[e].length);var f=this.parent().selectedAuthor.replace(/ /g,"+");var p=c+f+"%3A+"+h;t.handleClick(p,n)}else{t.handleClick(this.actionOfIndex[e],n)}}else{d(0)}},setCookies:function(){i.setMessage("qhash",[this.query_hash,this.parent().selectedOid])}});exports.QuerySuggestionsNavigator=exports.Typeahead.extend({onLoad:function(){this.qValue=this.initialValue;this.result=null;this.requestOutstanding=false;this.closed=false;this.selectionChosen=false;this.selectionlessCallback=null;this.placeholderActive=false;this.extraKeydown=null;this.userClicked=false;this.simulateScroll=true;this.originalPageTitle=$("title").text();this.query_hash=Math.random().toString(36);this.data={query_hash:this.query_hash,keepFilters:this.keepFilters};this.search_typ="";this.selectedOid=null;this.selectedAuthor="";this.isAuthorSelected=false;var e=this.$("#@input").attr("placeholder");this.$("#@input").attr("placeholder",o.decode(e));this.$("#@view_selector").click(this.fnbind(function(){this.$("#@selector_wrapper").removeClass("hidden");this.$("#@view_selector_wrapper").addClass("hidden");this.focus();return false}));var t=this;if(!t.data){t.data={}}t.$("#@input").focus(function(){$(this).attr("focused","true");t.inputFocus();if(t.extraFocus){t.extraFocus()}}).blur(function(){$(this).removeAttr("focused");t.inputBlur();t.userClicked=false}).keydown(function(e){return t.inputKeydown(e)}).keyup(function(e){return t.inputKeyup(e)}).click(function(){t.userClicked=true});this.onKeyCombination(document.body,"/",function(){t.$("#@input").focus();t.showResultsDropdown();return false},document.body);this.setSelectionlessCallback(this.fnbind(function(){if(this.child("results").actionType=="url"&&this.qValue!==""){var e=s("/search?q="+encodeURIComponent(this.qValue).replace(/%20/g,"+")+this.keepFilters);this.setCookies();window.location.href=e.unicode()}this.child("results").hide()}));this.$("#@search").click(this.fnbind(function(){this.selectionlessCallback();return false}))},inputKeydown:function(t){var i=this.$("#@input"),n=i.val();this.qValue=n;var o=!this.child("results").isVisible()&&!this.requestOutstanding;var s=t.keyCode==39,a=r&&t.keyCode==27;if(!this.userClicked&&this.simulateScroll&&o&&(e.maybeSimulateScroll(t)||s||a)){i.blur();if(s){return}return false}this.closed=false;e.cancelSimulatedScroll();if(t.keyCode==40){this.requestOutstanding=false;this.child("results").down();this.previewSearchInInput();return false}else if(t.keyCode==38){this.child("results").up();this.previewSearchInInput();return false}else if(t.keyCode==27){if(!r||this.child("results").isVisible()){this.child("results").hide()}else{i.blur()}this.userClicked=false;this.resetInputIcon();return false}else if(t.keyCode==13){if(this.child("results").go(t)){this.child("results").hide();return false}else if(this.selectionlessCallback&&this.selectionlessCallback()){return false}}else if(t.keyCode==9){var l=this.child("results").focusedIndex;if(l===null){this.child("results").down();this.previewSearchInInput();return false}else{this.requestUpdate();return false}}else if(t.keyCode==39){this.userClicked=true}this.resetInputIcon();if(this.extraKeydown){return this.extraKeydown(t.keyCode)}return true},onInputChange:function(){var e=this.getValue();if(e==this.qValue){return}if(!this.should_update){return}this.qValue=e;if(!this.requestOutstanding){this.requestUpdate()}if(this.qValue===""){this.closed=false}},focusedUpdate:function(){var e=this.qValue;var t;if(e.indexOf(":")>=0){var i=e.split(":");var n=i[0];this.search_type=$.trim(n);if(this.search_type=="author"){var o=i[1];t=i[2]}else{t=i[1]}}},setValue:function(e,t){this._super.apply(this,arguments);if(t.img_src){this.$("#@input_icon").attr("src",t.img_src)}else{this.resetInputIcon()}},resetInputIcon:function(){this.$("#@input_icon").attr("src",this.default_search_icon)},previewSearchInInput:function(){var e=this.child("results").focusedIndex;var t=this.child("results").getResult(e);if(t===undefined){this.setValue(this.child("results").query,{})}else{this.setValue(t.plaintext,t)}},getRequestUpdatePostData:function(){return{q:this.qValue,data:JSON.stringify(this.data)}},setCookies:function(){i.setMessage("qhash",[this.query_hash,this.selectedOid])}})},{cookies:true,async_post:true,window_manager:true,siteuri:true,settings:true,webnode2:true,simscroll:true,assert:true,e2e:true,html:true,email:true,"w2.quora":true});require.install("view/topic_selector",function(require,exports,module){var e=require("w2.quora").Component,t=require("typeahead").TypeaheadResults,i=require("settings").interface_strings;exports.TypeBasedTempTopicSelectorAdd=e.extend({onLoad:function(){this.$("#@add_btn").click(this.fnbind(function(){this.select();return false}));this.tempTopicList={};this.lowercaseTempTopicList={}},select:function(){if(this.type=="to_tid"){this.showDialog()}else{this._request()}},showDialog:function(){var e=this;e.dialog().title(e.topic_merge_text).ok(function(){var t=require("app/view/topic").getTopicDialog();var i=t.lookup("editor");if(i.isEmpty()){return false}e._request()},i.ok).cancel(null,i.cancel).load("merge_dialog")},_get_kwargs:function(){var e,t,i={};if(!(i.tid=this.oid)||!(i.type=this.type)||!(i.topic_name=this.parent().qValue)||/^\s*$/.test(i.topic_name)||this.type=="to_tid"&&(e=require("app/view/topic").getTopicDialog())&&(t=e.lookup("editor"))&&t.isEmpty()){return null}if(t){i.comment=t.serialize()}return i},_request:function(){var e=this._get_kwargs();if(!e){return false}this.serverCall("add_topic").kwargs(e).success(this.fnbind(function(){this.parent().reset()})).liveMutate().send();if(this.hide){this.parent().hideSelector()}}});exports.TempTopicSelectorAdd=exports.TypeBasedTempTopicSelectorAdd.extend({select:function(){this.saveTempTopic(this.parent().result)},setoid:function(e){this.oid=e},saveName:function(e){this.tempTopicList[e]=e;this.lowercaseTempTopicList[e.toLowerCase()]=e},deleteName:function(e){delete this.tempTopicList[e];delete this.lowercaseTempTopicList[e.toLowerCase()]},getTempTopicNames:function(){return this.tempTopicList},getLowercaseTempTopicNames:function(){return this.lowercaseTempTopicList},getTempTopicNamesAsArray:function(){var e=[];for(var t in this.tempTopicList){e.push(t)}return e},reset:function(){this.parent().resetTempTopics();this.tempTopicList={}},saveTempTopic:function(e){var t=e.value;if(!t){return}this.saveName(t);var i=$("<li/>").addClass(this.tempTopicClass()).append($("<input/>").attr("type","hidden").attr("name","tidsugg_"+this.oid).val(t)).append($(this.topicNameTag()).text(this.tempTopicVisibleText(t)).addClass(this.topicNameClasses())).append($("<a/>").text(this.removeTopicText()).addClass(this.editLinkClasses()).attr("href","#").click(this.fnbind(function(){this.deleteName(t);i.remove();return false})));this.parent().addTempTopic(i)},topicNameTag:function(){return"<strong/>"},topicNameClasses:function(){return""},editLinkClasses:function(){return"light"},tempTopicClass:function(){return"p0_5"},onTempTopicAdded:function(e){this.parent().setText("");this.parent().focus()},tempTopicVisibleText:function(e){return e},removeTopicText:function(){return" remove"}});exports.TempBoardItemTopicSelectorAdd=exports.TempTopicSelectorAdd.extend({topicNameTag:function(){return"<span/>"},topicNameClasses:function(){return"topic_name"},editLinkClasses:function(){return"topic_remove"},removeTopicText:function(){return""},tempTopicClass:function(){return"topic_list_item"}});exports.TempBoardItemTopicSuggestionsSelectorAdd=exports.TempBoardItemTopicSelectorAdd.extend({saveTempTopic:function(e){var t=e.value;if(!t){return}this.saveName(t);var i=$("<div/>").addClass("board_temp_topics_list_item").append($("<span/>").addClass(this.tempTopicClass()).append($(this.topicNameTag()).text(this.tempTopicVisibleText(t)).addClass(this.topicNameClasses()))).append($("<input/>").attr("type","checkbox").attr("checked","checked").attr("value",t).click(this.fnbind(function(){this.checkClicked(t)})));this.parent().addTempTopic(i);this.updateFollowersCount()},updateFollowersCount:function(){this.serverCall("update_count").kwargs({names:this.getTempTopicNames()}).contentFor(this.parent().$("#@followers"),{parentCID:this.cid}).send()},checkClicked:function(e){var t=this.tempTopicList[e];if(t&&t!=="undefined"){this.deleteName(e)}else{this.saveName(e);this.updateFollowersCount()}},deleteName:function(e){delete this.tempTopicList[e];this.updateFollowersCount()},onTempTopicAdded:function(){this.updateFollowersCount()}});exports.TempTopicContextSelectorAdd=exports.TempTopicSelectorAdd.extend({onLoad:function(){this._super.apply(this,arguments);if(this.defaultTopicName){this.saveTempTopic({value:this.defaultTopicName,type:"topic",id:this.defaultTid,follower_count:this.defaultTopicFollowerCount})}},tempTopicVisibleText:function(e){return e+":"},editLinkClasses:function(){return"light edit o"},tempTopicClass:function(){return""},removeTopicText:function(){return this.edit_text},onTempTopicAdded:function(){this._super.apply(this,arguments);this.parent().$("#@selector_wrapper, #@title").hide();this.parent().$("#@input").blur()},deleteName:function(e){this._super.apply(this,arguments);this.parent().$("#@selector_wrapper, #@title").show();this.parent().resetFocus()}});exports.TempReviewTopicContextSelectorAdd=exports.TempTopicContextSelectorAdd.extend({tempTopicVisibleText:function(e){return this.reviews_of_text+e}});exports.TempTopicQuestionWizardSelectorAdd=exports.TempTopicSelectorAdd.extend({onLoad:function(){this._super.apply(this,arguments);var e=this.lookup("topic_selection").getTopicNames().concat(this.lookup("topic_selection").getUnselectedTopicNames());for(var t=0;t<e.length;t++){var i=e[t];this.saveName(i)}},saveTempTopic:function(e){var t=e.value;if(!t){return}if(!this.getLowercaseTempTopicNames()[t.toLowerCase()]){this.saveName(t);this.lookup("topic_selection").newTopicAdded(e)}}});exports.TempPrimaryTopicSelectorAdd=exports.TempTopicSelectorAdd.extend({onLoad:function(){this._super.apply(this,arguments);var e=this.lookup("topic_selection").getAllTopicNames();for(var t=0;t<e.length;t++){this.saveName(e[t])}},saveTempTopic:function(e){var t=e.value;if(!t){return}if(!this.getLowercaseTempTopicNames()[t.toLowerCase()]){this.saveName(t);this.lookup("topic_selection").newTopicAdded(e)}}});exports.LiveTempPrimaryTopicSelectorAdd=exports.TempTopicSelectorAdd.extend({saveTempTopic:function(e){var t=e.value;if(!t){return}this.lookup("topic_selection").newTopicAdded(e)}});exports.TopicSelectorAdd=e.extend({onLoad:function(e){this.$("#@add_btn").click(this.fnbind(function(e){this.select();return false}))},getTopicName:function(){return this.parent().qValue},getKwargs:function(){return{selected_topic:this.getTopicName()}},select:function(){var e=this.getTopicName();var t=this.getKwargs();if(this.parent()){this.parent().resetFocus()}this.onSelectCallback();if(e){this.addTopic(t)}},addTopic:function(e){var t=this;t.serverCall("add").kwargs(e).liveMutate().error(t.fnbind(function(){var e={};e[this.close_button_text]=null;$(".ContentWrapper").dialog({title:this.dialog_title,contents:this.dialog_message,buttons:e})})).send()},onSelectCallback:function(){}});exports.QuestionTopicSelectorAdd=exports.TopicSelectorAdd.extend({getKwargs:function(){return{selected_topics:this.getTopicName(),viewer_private:this.viewer_private,qid:this.qid}},getTopicName:function(){if(this.parent().qValue!==""){return $.makeArray(this.parent().qValue)}}});exports.UserContentFilterTempTopicSelectorAdd=exports.TempTopicSelectorAdd.extend({saveTempTopic:function(e){var t=e.value;var i=e.id;if(!t){return}this.lookup("user_content_filter").tempTopicChosen(i,t)}});exports.ExpertiseTopicSelectorAdd=exports.TopicSelectorAdd.extend({});exports.FilterNavListTempTopicSelectorAdd=exports.TempTopicSelectorAdd.extend({saveTempTopic:function(e){var t=e.value;var i=e.id;var n=e.routing_name;if(!t){return}this.lookup("multiple_value_list").addFilterToKey(n)}});exports.HomePagePinnedTopicSelectorResults=t.extend({preventOverflow:function(){}})},{typeahead:true,settings:true,"app/view/topic":true,"w2.quora":true});require.install("app/view/topic/edit_topic_modal",function(require,exports,module){var e=require("w2.quora").Component;exports.EditTopicsLink=e.extend({onLoad:function(){var e=this;this.$("#@edit_topics").click(function(t){e.modal("load_modal");t.preventDefault()})}});exports.EditTopicsList=e.extend({newTopicAdded:function(e){var t=this;this.serverCall("new_topic_added").kwargs({topic_name:e.value}).liveMutate().success(function(e){if(e.tid){t.lookup("selector").addIgnoreOid(e.tid)}}).send()}});exports.TopicRow=e.extend({onLoad:function(){this.bindClickHandlers()},bindClickHandlers:function(){var e=this,t=e.lookup("selector");this.$("#@remove_topic").click(function(i){i.preventDefault();e.lookup("topic_selection").serverCall("topic_removed").kwargs({tid:e.tid}).success(function(e){if(e.tid){t.removeIgnoreOid(e.tid)}}).liveMutate().send()})}})},{"w2.quora":true});require.install("app/view/pmsg/pmsg",function(require,exports,module){
var e=require("w2.quora").Component,t=require("view/pmsg");exports.FlagConfirmationPmsg=t.PMsg.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@undo").click(this.fnbind(function(e){this.undo();return false}))},undo:function(){this.serverCall("undo").liveMutate().send()}})},{"view/pmsg":true,"w2.quora":true});require.install("app/view/admin",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor").InlineEditor,i=require("view/modal").Base,n=require("window_manager"),o=require("settings").interface_strings;exports.AdminLogItemView=e.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){this.$("#@details").toggleClass("hidden");return false}));this.$("#@item").hover(this.fnbind(function(){this.$("#@item").addClass("hover");this.$("#@buttons").removeClass("hidden")}),this.fnbind(function(){this.$("#@item").removeClass("hover");this.$("#@buttons").addClass("hidden")}));this.$("#@remove").tooltip({contents:this.hide_title}).click(this.fnbind(function(){this.dialog().title(this.hide_title).cancel(null,o.cancel).ok(this.fnbind(function(){this.serverCall("hide_log_item").send()}),this.hide_title).html(this.hide_message);return false}))}});exports.UserAdminMenuLink=e.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(e){this.$("#@menu").menu(this.$("#@menu_link"));return false}))}});exports.AdminMode=e.extend({toggle:function(){this.serverCall("toggle").liveMutate().send()},onLoad:function(){var e=this;function t(){e.toggle();return false}e.$("#@toggle").click(t);if(e.listen){require("keystrokes").on([81,49,81,49],t)}}});exports.AdminModeListener=e.extend({toggle:function(){this.serverCall("toggle").liveMutate().send()},onLoad:function(){var e=this;function t(){e.toggle();return false}require("keystrokes").on([81,49,81,49],t)}});exports.NicknameInlineEditor=t.extend({onLoad:function(){this._super.apply(this,arguments);if(n.getHash().substr(0,9)=="#editname"){this.toggle_editor()}}});exports.RemoveInboxMessagesLink=e.extend({onLoad:function(){this.$("#@delete").click(this.fnbind(function(){this.dialog().title(this.delete_messages_title).cancel(null,o.cancel).ok(this.fnbind(function(){this.serverCall("delete_messages").liveMutate().send()}),this.delete_messages_title).html(this.delete_messages_message);return false}))}});exports.AdminRemoveUserPhoto=e.extend({onLoad:function(e){this.$("#@remove_photo_link").click(this.fnbind(function(){this.dialog().title(this.remove_profile_photo).cancel().ok(this.fnbind(function(e){var t=e.dialogComponent.child("editor").serialize();this.serverCall("remove_photo").kwargs({ce:t}).liveMutate().send()}),this.remove_photo).load("remove_photo_dialog");$("#admin_remove_profile_photo_comment").focus();return false}))}});exports.FlagNameLink=e.extend({onLoad:function(){this.$("#@show_flag_name_modal").click(this.fnbind(function(){this.modal("flag_modal");return false}))}});exports.ResolveNameLink=e.extend({onLoad:function(){this.$("#@show_resolve_name_modal").click(this.fnbind(function(){this.modal("verify_modal");return false}))}});exports.ResolveNameModal=i.extend({onSubmit:function(){var e=this;this.serverCall("resolve_name").liveMutate().success(function(){e._closeModal()}).send()}});exports.FlagNameModal=i.extend({onSubmit:function(){var e=this;this.serverCall("flag_name").liveMutate().success(function(){e._closeModal()}).send()}});exports.BanRemoveLink=e.extend({onLoad:function(){var e=this;e.$("#@ban_remove_link").click(function(){e.modal("ban_remove_modal");return false})}});exports.BanRemoveModal=i.extend({onLoad:function(){this._super.apply(this,arguments);this.lookup("editor").focus()},onSubmit:function(){var e=this;var t=e.lookup("editor");if(t.isEmpty()){e.$("#@required_comment_warning").removeClass("hidden");t.focus();return}else{var i=t.serialize();var n=this.$("#@revert_edits").is(":checked");var o=this.$("#@mark_as_verified_spammer").is(":checked");var s=function(t){return e.$("#@"+t).attr("checked")==="checked"};e.serverCall("ban_remove_all_users").kwargs({comment:i,revert_edits:n,mark_as_verified_spammer:o,uids_to_ban_remove:e.uids_to_ban_remove.filter(s)}).liveMutate().success(function(){e._closeModal()}).send();return false}}})},{window_manager:true,keystrokes:true,settings:true,"view/modal":true,"view/inline_editor":true,"w2.quora":true});require.install("app/view/suggested_photo",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings").interface_strings;exports.SuggestProfilePhoto=e.extend({onLoad:function(){this.$("#@photo").hover(this.fnbind(function(e){this.$("#@add, #@edit").show()}),this.fnbind(function(e){this.$("#@add, #@edit").hide()}))}});exports.SuggestedPhotoPending=e.extend({onLoad:function(){if(!this.suggestion_from_viewer){this.$("#@photo").hover(this.fnbind(function(e){this.$("#@pending").show()}),this.fnbind(function(e){this.$("#@pending").hide()}))}this.$("#@view").click(this.fnbind(function(){this.parent().toggleSuggestion();return false}))}});exports.SuggestedPhotoAccept=e.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(function(){this.serverCall("accept").kwargs({uid:this.uid}).liveMutate().send();return false}))}});exports.SuggestedPhotoDiscard=e.extend({onLoad:function(){this.$("#@discard").click(this.fnbind(function(){this._dialog=this.dialog().title(this.dialog_title).ok(this.fnbind(function(){this.serverCall("discard").kwargs({to_uid:this.to_uid}).liveMutate().send()}),this.dialog_button_text).cancel(null,t.cancel).html(this.dialog_message);return false}))}})},{settings:true,"w2.quora":true});require.install("app/view/vc",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("settings").interface_strings;exports.RevertDialog=e.extend({onLoad:function(){this.lookup("editor").focus();t.revertDialog=this},validateReason:function(){var e=this.lookup("editor");if(e.isEmpty()){this.$("#@required_comment_warning").removeClass("hidden");e.focus();return false}else{return true}}});exports.BatchRevertDialog=e.extend({onLoad:function(){this.lookup("editor").focus();t.batchRevertDialog=this}});exports.OperationRevert=e.extend({onLoad:function(){var e=this;e.$("#@operation_revert").click(function(){e.dialog().title(e.dialog_title).ok(function(){var i=t.revertDialog.lookup("editor");if(!t.revertDialog.validateReason()){return false}e.serverCall("revert_revision").kwargs(e.getKwargs(i)).liveMutate().send()},e.ok_text).cancel(null,i.cancel).load("revert_dialog");return false})},getKwargs:function(e){return{oid:this.oid,comment:e.serialize()}}});exports.AddQuestionRedirectRevertLink=e.extend({onLoad:function(){var e=this;e.$("#@revert").click(function(n){n.preventDefault();e.dialog().title(e.dialog_title).ok(function(){var i=t.revertDialog.lookup("editor");if(i.isEmpty()){return false}e.serverCall("revert").kwargs({to_qid:e.to_qid,from_qid:e.from_qid,comment:i.serialize()}).liveMutate().send()},e.ok_text).cancel(null,i.cancel).load("revert_dialog")})}})},{webnode2:true,settings:true,"w2.quora":true});require.install("app/view/widgets",function(require,exports,module){var e=require("w2.quora").Component;function t(){setTimeout(function(){window.close()},1e3)}exports.IframeBuster=e.extend({onLoad:function(){top.location=this.to_url}})},{"w2.quora":true});require.install("app/view/question/answer_tag",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2");exports.AnswerTagLink=e.extend({onLoad:function(){if(this.enabled){this.$("#@link").click(this.fnbind(function(e){this.$("#@menu").menu(this.$("#@link"));return false}))}}});exports.AnswerTagMenuListItem=e.extend({onLoad:function(){this.$("#@select_tag").click(this.fnbind(function(){this._dialog=this.dialog().title(this.dialog_title).load("add_tag_dialog");return false}))}});exports.AddTagDialog=e.extend({onLoad:function(){var e=this;this.$("#@cancel").click(this.fnbind(function(){t.Dialog.dialogFor(e).close_();return false}));this.$("#@add_tag").click(this.fnbind(function(){var i=null;if(this.should_show_editor){var n=this.lookup("editor");i=n.serialize()}var o=this.$("#@locked").is(":checked");this.serverCall("add_tag").kwargs({comment:i,lock:o}).liveMutate().success(this.fnbind(function(){t.Dialog.dialogFor(e).close_()})).send();return false}))}});exports.AnswerTag=e.extend({onLoad:function(){this.$("#@show_comment").click(this.fnbind(function(){this.$("#@comment").removeClass("hidden");this.$("#@show_comment").addClass("hidden");return false}));this.$("#@remove").tooltip({contents:this.remove_short_text});this.$("#@remove").click(this.fnbind(function(){this._dialog=this.dialog().title(this.remove_text).cancel().ok(this.fnbind(function(){var e=arguments[0].dialogComponent;var t=e.lookup("editor").serialize();this.serverCall("remove_tag").kwargs({comment:t}).liveMutate().send()}),this.remove_short_text).load("remove_tag_dialog");return false}))}});exports.AnswerCollapsedTag=e.extend({onLoad:function(){var e=this;this.$("#@show_comment").click(function(t){t.preventDefault();e.$("#@comment").removeClass("hidden");e.$("#@show_comment").addClass("hidden")})}});exports.AnswerTagsMenuAdminOptions=e.extend({onLoad:function(){this.$("#@collapse").click(this.fnbind(function(){this.serverCall("collapse").kwargs({lock:false}).liveMutate().send();return false}));this.$("#@collapse_and_lock").click(this.fnbind(function(){this.serverCall("collapse").kwargs({lock:true}).liveMutate().send();return false}))}})},{webnode2:true,"w2.quora":true});require.install("view/photo",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies");exports.InlinePhotoEditor=e.extend({onLoad:function(){var e=this;this.$("#@x_photo").click(this.fnbind(function(){this.dialog().title(e.dialog_title).cancel(null,e.close_button_text).ok(this.fnbind(function(){this.serverCall("remove_photo").send()}),e.dialog_button_text).html(e.dialog_message);return false}));e.whenOnLoaded(function(){e.$("#@photo").hover(function(){e.$("#@edit").toggleClass("hidden");e.$("#@x_photo").toggleClass("hidden")})})}});exports.BoardPhoto=e.extend({onLoad:function(e){this.$("#@link").mousedown(this.fnbind(function(){t.setQfeedLog(this,"BoardClickthrough");t.setQueryLog(this,"BoardClickthrough")}))}});exports.TopicPhoto=e.extend({onLoad:function(e){this.$("#@link").mousedown(this.fnbind(function(){t.setQfeedLog(this,"TopicClickthrough");t.setQueryLog(this,"TopicClickthrough")}))}})},{cookies:true,"w2.quora":true});require.install("app/view/question/add_answer",function(require,exports,module){require("jquery.webnode2");var e=require("w2.quora").Component,t=require("view/inline_editor").InlineEditor,i=require("cookies"),n=require("window_manager"),o=require("view/modal").Base,s=require("settings"),r=require("qtexteditor").QTextEditor,a=s.interface_strings,l=require("w2.context"),u=require("input_validate").InputValidator,d=require("gating");exports.AnswerAdd=e.extend({onLoad:function(){var e=this;e.answerAdd=e.$("#@answer_add");e.inner=e.answerAdd.find(".inner");e.$("#@zen_enter").tooltip({contents:e.zen_mode_tooltip});e.$("#@zen_enter").click(function(){e.enterZen()});if(e.start_in_zen_mode){setTimeout(function(){e.lookup("editor").lookup("editor").hideFakeEditor()},100);setTimeout(function(){e.enterZen(1e3)},1e3)}},createExitZenButton:function(){var e=this;$("body").append('<div class="zen_exit"></div>');e.exitZenButton=$(".zen_exit");e.exitZenButton.css("right",$.getScrollbarWidth());e.exitZenButton.click(function(){e.exitZen()})},createPlaceholder:function(){if($("#zen_placeholder").length===0){this.answerAdd.after('<div id="zen_placeholder"></div>')}this.placeholder=$("#zen_placeholder");this.placeholder.css("width",this.answerAdd.outerWidth());this.placeholder.css("height",this.answerAdd.outerHeight(true))},resizeEditor:function(){var e=this,t=$(window).height(),i=e.answerAdd.find(".qtext_editor_buttons_wrapper").outerHeight(true),n=e.answerAdd.find(".AnswerEditorHeader").outerHeight(true),o=e.footer.outerHeight(true),s=e.answerAdd.find(".star_rating_row").outerHeight(true),r=e.answerAdd.find(".AnswerEditorMetadata").outerHeight(true),a=3,l=t-i-n-o-e.getQuestionTextHeight()-s-r-a;e.answerAdd.find(".qed_content").css({"min-height":l})},getQuestionTextHeight:function(){return this.$("#@zen_question_text").outerHeight(true)},fixEditorOptions:function(){var e=this,t=e.answerAdd.find(".qtext_editor_buttons"),i=t.offset().top;e.answerAdd.scroll(function(){if(e.answerAdd.scrollTop()>=i){if(!t.hasClass("fixable_fixed")){t.addClass("fixable_fixed");t.css("top",0)}}else{t.removeClass("fixable_fixed");t.attr("style","")}})},enterZen:function(e){var t=this;t.footer=t.answerAdd.find(".form_buttons");t.topOffset=t.inner.offset().top-$(window).scrollTop();t.transformDistance=t.topOffset-t.getQuestionTextHeight();t.footerTransformDistance=$(window).height()-t.footer.position().top-t.footer.outerHeight(true)-t.getQuestionTextHeight();if(e===undefined){t.animTime=333}else{t.animTime=e}t.$("#@zen_bg").show().addClass("is_active");$("body").addClass("zen_mode");$(".SiteHeader").css("padding-right",$.getScrollbarWidth()+"px");$("body").css("padding-right",$.getScrollbarWidth()+"px");t.createPlaceholder();t.createExitZenButton();t.answerAdd.addClass("is_zen");t.inner.css({"margin-top":t.transformDistance+8,"-webkit-transition":"-webkit-transform "+t.animTime+"ms, border-color "+t.animTime+"ms",transition:"transform "+t.animTime+"ms, border-color "+t.animTime+"ms","-webkit-transform":"translate3d(0,"+-t.transformDistance+"px,0)",transform:"translate3d(0,"+-t.transformDistance+"px,0)"});t.footer.css({"-webkit-transition":"all "+t.animTime+"ms",transition:"all "+t.animTime+"ms","-webkit-transform":"translate3d(0,"+t.footerTransformDistance+"px,0)",transform:"translate3d(0,"+t.footerTransformDistance+"px,0)"});setTimeout(function(){t.initZen()},t.animTime);t.serverCall("zen_mode_entered").send()},initZen:function(){var e=this;e.answerAdd.addClass("finished_transition");e.inner.attr("style","");e.footer.attr("style","");e.answerAdd.find(".editor_plus_options_wrapper").css("margin-bottom",e.footer.outerHeight());e.fixEditorOptions();e.resizeEditor();$(window).resize(function(){e.resizeEditor()});e.lookup("editor").focusEditorInput();e.lookup("qtexteditor").setEscapeKeyCallback(e.fnbind(function(){if(e.answerAdd.hasClass("is_zen")){e.exitZen()}}));e.footer.find(".submit_button").click(function(){if(e.answerAdd.hasClass("is_zen")){e.exitZen()}})},exitZen:function(){var e=this;e.$("#@zen_bg").removeClass("is_active");e.exitZenButton.addClass("transitioning_out");e.answerAdd.addClass("transitioning_out");e.inner.css({"-webkit-transition":"-webkit-transform "+e.animTime+"ms, border-color "+e.animTime+"ms "+e.animTime+"ms",transition:"transform "+e.animTime+"ms, border-color "+e.animTime+"ms "+e.animTime+"ms","-webkit-transform":"translate3d(0,"+e.transformDistance+"px,0)",transform:"translate3d(0,"+e.transformDistance+"px,0)"});e.footer.css({"margin-top":e.footerTransformDistance,"-webkit-transition":"-webkit-transform ."+e.animTime+"s",transition:"transform ."+e.animTime+"s","-webkit-transform":"translate3d(0,"+-e.footerTransformDistance+"px,0)",transform:"translate3d(0,"+-e.footerTransformDistance+"px,0)"});$("body").removeClass("zen_mode");e.answerAdd.find(".qed_content").attr("style","");e.answerAdd.find(".editor_plus_options_wrapper").attr("style","");setTimeout(function(){e.resetEditor()},e.animTime);e.serverCall("zen_mode_exited").send()},resetEditor:function(){var e=this;e.$("#@zen_bg").hide();$("body").attr("style","");$(".SiteHeader").attr("style","");e.placeholder.remove();e.exitZenButton.remove();e.answerAdd.removeClass("is_zen finished_transition transitioning_out");e.inner.attr("style","");e.footer.attr("style","");$(window).off("resize");e.answerAdd.unbind("scroll");e.lookup("editor").focusEditorInput()},showHidden:function(){this.answerAdd.removeClass("collapsed")}});exports.AnswerInFeedEditorSection=e.extend({onLoad:function(){this._super.apply(this,arguments);this.cQuery(":editor.editor").hideFakeEditorByDefault=true;this.cQuery(":editor.editor").blurOnLoad=!this.parent().parent().open}});var c=exports.AnswerEditor=t.extend({contextConstructor:function(){return l.Editor},onLoad:function(){this.editor=this.lookup("editor");var e=this,t=this.editor.child("review_rating");this.editor.prevent_load_drop_zone=true;this._super.apply(this,arguments);this.editorContext=this.getContext(l.Editor);this.qTextEditorContext=this.getContext(l.QTextEditor);this.disclaimer_update="";this.answer_resistance=false;if(this.writing_tips_enabled){this.writingTips=this.cQuery(":writing_tips.tips");this.shouldShowWritingTips=this.writingTips.shouldShowWritingTips}this.editor.setFocusCallback(function(){e.focusEditor()});if(!this.editor.isInteractive()){this.focusEditor()}if(this.draft_space){this.editor.setAnswerLaterCallback(function(){e.save_draft(true);e.editor.hideFakeEditor();return false})}this.updated_question_modal_shown=false;if(t){this.editor.setBlurCallback(this.fnbind(function(){t.$(".star_rating_row").removeClass("focus")}))}this.onKeyCombination(this.input_button_obj,"Cmd-Enter",function(){e.input_button_obj.click();return false},null,true);if(this.qTextEditorContext){this.qTextEditorContext.on("focusInput",this.focusEditorInput.bind(this))}},focusEditor:function(){var e=this.parent().parent();if(e.showHidden){e.showHidden()}if(this.shouldShowWritingTips&&this.writingTips.isHidden()){this.showWritingTips();this.shouldShowWritingTips=false}if(!d.qtext2){this.editor.$("#@editor").removeClass("hidden")}if(this.editor.support_drag_and_drop_upload){if(!this.dragAndDropFormLoaded){this.dragAndDropFormLoaded=true;this.editor.loadDragAndDropForm()}}var t=this.editor.child("review_rating");if(t){t.$(".star_rating_row").addClass("focus")}},focusEditorInput:function(){this.editor.hideFakeEditor()},showShareWarningDialog:function(){var e=this.lookup("editor_share"),t=e.getValues(),i;if(t.tw){if(t.fb){i=this.share_warning_texts.tw_fb}else{i=this.share_warning_texts.tw}}else if(t.fb){i=this.share_warning_texts.fb}e.serverCall("warning_dialog_shown").send();this.lookup("editor_share").dialog().title(this.share_warning_dialog_title).cancel(null,a.cancel).ok(this.fnbind(function(){this.shouldShowShareWarningDialog=false;this.input_button_obj.click()}),this.share_warning_dialog_ok).html(i)},showAnonAnswerWarningDialog:function(){var e=this;e.modal("anon_answer_warning").onSubmitCallBack(function(){e.shouldShowAnonAnswerWarningDialog=false;e.input_button_obj.click()})},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(e){if(this.getEditor()&&this.isEditorEmpty()){return false}var t={};if(this.lookup("editor_share",true)){t=this.lookup("editor_share").getValues()}var i=(t.tw||t.fb)&&this.shouldShowShareWarningDialog;if(i){this.showShareWarningDialog();return false}if(this.shouldShowAnonAnswerWarningDialog){this.showAnonAnswerWarningDialog();return false}var n=this.editor.child("review_rating");if(n){var o=n.$("#@ratings").attr("class");if(o&&o.slice(-1)){u.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}})}else{n.$(".inline_label").addClass("error")}}else{u.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}})}e.preventDefault()}))},invokeEditServerCall:function(){if(this.getFacebookCheckbox()&&!require("facebook").hasPermission("publish_actions")){var e=arguments,t=this._super;require("facebook").requestPermissions("publish_stream",this.fnbind(function(){t.apply(this,e)}))}else{this._super.apply(this,arguments)}},ajax_callback:function(e){if(e&&e.answer_resistance){this.showAnswerResistance();this.locked=false;return}if(e&&e.show_updated_question_modal){this.modal("load_changed_modal",{kwargs:{submit_id:this.input_button_obj.attr("id"),qid:e.qid}});this.updated_question_modal_shown=true;this.locked=false;return}if(e.prompt_topic_bio){this.modal("topic_bio_modal",{kwargs:{aid:e.aid}})}if(e.share_data&&e.share_data.autoShowShareDialog){require("app/view/share").showShareAction(e.share_data)}if(e&&e.show_collapse_modal){this.showAnswerCollapseModal(e.aid)}if(n.sameDomainURL(e.url)){n.navigateTo(e.url)}return this._super.apply(this,arguments)},tlog_data:function(){return{type:"AddAnswer"}},getLoggedAction:function(){return"AnswerAdd"},logSaveDraft:function(){i.setTlog({type:"QuestionSaveDraft",qid:this.id})},_get_kwargs:function(){var e={id:this.id,input:this.get_value(),disclaimer_update:this.disclaimer_update,tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),fb_uid:require("facebook").getFbUid(),fb_access_token:require("facebook").getAccessToken(),fb_expires:require("facebook").getExpiresIn(),review_data:this.getReviewData(),answer_resistance:this.answer_resistance,updated_question_modal_shown:this.updated_question_modal_shown};if(this.lookup("editor_share",true)){e.share_values=this.lookup("editor_share").getValues()}return e},getSaveDraftKwargs:function(){var e=this._super.apply(this,arguments);return e},getFacebookCheckbox:function(){return this.editorContext.get("shareToFacebook")},getTwitterCheckbox:function(){return this.editorContext.get("shareToTwitter")},showWritingTips:function(){this.writingTips.show();this.serverCall("log_show_flyout_on_editor_focus").kwargs({qid:this.id}).send()},showAnswerResistance:function(){if(this.writing_tips_enabled&&this.writingTips.isVisible()){this.writingTips.hide()}this.answer_resistance=true;this.lookup("answer_resistance").show();this.input_button_obj.removeClass("disabled").text(this.answer_resistance_text);this.focusInput()},showAnswerCollapseModal:function(e){this.modal("show_collapse_modal",{kwargs:{aid:e,is_answer_page:this.is_answer_page}})}});exports.AnswerInFeedEditor=c.extend({onLoad:function(){this._super.apply(this,arguments)},trigger_request:function(){i.setQfeedLog(this,"AddAnswer");this._super.apply(this,arguments)},logSaveDraft:function(){i.setQfeedLog(this,"QuestionSaveDraft")},ajax_callback:function(e){if(e.answer_resistance){this.showAnswerResistance();this.locked=false;return}this.$("#@inline_editor_form").parents(".answer_editor").addClass("hidden");this._super.apply(this,arguments)}});exports.AnswerEditorMetadataItem=e.extend({onLoad:function(){var e=this,t=this.$("#@toggle");t.click(function(){e.$("#@item").toggleClass("ghosted");if(t.text()===e.show_text){e.showItem();t.text(e.hide_text)}else{e.hideItem();t.text(e.show_text)}return false})},showItem:function(){return false},hideItem:function(){return false}});exports.AnswerEditorMetadataDisclaimerItem=exports.AnswerEditorMetadataItem.extend({showItem:function(){if(this.lookup("content_editor")){this.lookup("content_editor").disclaimer_update="attach"}return false},hideItem:function(){if(this.lookup("content_editor")){this.lookup("content_editor").disclaimer_update="remove"}return false}});exports.AnswerEditorMetadataA2AItem=exports.AnswerEditorMetadataItem.extend({showItem:function(){if(this.lookup("content_editor")){this.lookup("content_editor").answer_attribution_update="attach"}if(!this.aid){this.serverCall("show_answer_attribution").liveMutate().send()}return false},hideItem:function(){if(this.lookup("content_editor")){this.lookup("content_editor").answer_attribution_update="remove"}if(!this.aid){this.serverCall("hide_answer_attribution").liveMutate().send()}return false}});exports.AnswerCollapseModal=o.extend({onSubmit:function(){if(!this.isAnswerPage){this.goToAnswerPage()}this._closeModal()},goToAnswerPage:function(){window.location=this.url}});exports.AnswerQTextEditor=r.extend({onLoad:function(){this._super.apply(this,arguments);var e=this,t=this.$("#@editor_outer");if(this.should_track_question_state){this.editor.one("focus",this.fnbind(this.trackQuestionState))}this.onKeyCombination(t,"a",function(){n.scrollIntoView(t);e.hideFakeEditor();return false});this.onKeyCombination(t,"Escape",function(){document.activeElement.blur();var e=t;while(e.get(0)!==document.body&&!e.hasClass("kbfocusable")){e=e.parent()}e.click().focus();return false},null,true)},trackQuestionState:function(){this.serverCall("track_question_state").kwargs({qid:this.qid}).send()},setAnswerLaterCallback:function(e){this.$("#@answer_later_link").click(e)}});exports.ChangedQuestionModal=o.extend({onSubmit:function(){var e=this;this._closeModal();$("#"+e.submit_id).click()}})},{facebook:true,cookies:true,input_validate:true,window_manager:true,settings:true,"app/view/share":true,"view/modal":true,"w2.context":true,"jquery.webnode2":true,qtexteditor:true,gating:true,"view/inline_editor":true,"w2.quora":true});require.install("app/view/question/disclaimer",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2");exports.AttachDisclaimer=e.extend({onLoad:function(e){var t=this;t.$("#@add_disclaimer_link").click(function(){t.attachDisclaimer();return false});t.$("#@remove_button").tooltip({contents:t.remove_disclaimer_tooltip});t.$("#@remove_button").click(function(){t.removeAttachedDisclaimer();return false})},attachDisclaimer:function(){if(!this.user_has_set_disclaimer){this.showDisclaimerDialog()}else{this.$("#@add_disclaimer_link, #@disclaimer_attached").toggleClass("hidden");if(this.lookup("content_editor")){this.lookup("content_editor").disclaimer_update="attach"}}},removeAttachedDisclaimer:function(){this.$("#@add_disclaimer_link, #@disclaimer_attached").toggleClass("hidden");if(this.lookup("content_editor")){this.lookup("content_editor").disclaimer_update="remove"}},showDisclaimerDialog:function(){this._dialog=this.dialog().title(this.create_disclaimer_title).load("set_disclaimer_dialog")}});exports.SetDisclaimerDialog=e.extend({onLoad:function(e){var i=this;i.$("#@cancel").click(function(){t.Dialog.dialogFor(i).close_();return false})},showEditor:function(){this.$("#@choose_profession_area").hide();this.$("#@edit_disclaimer_area").show();this.lookup("editor").focusInput();this.$("#@cancel").hide()},showError:function(){this.$("#@choose_profession_area").hide();this.$("#@wrong_profession_error").show()}});exports.DisclaimerIndicateProfession=e.extend({onLoad:function(){var e=this;e.$("%@profession").click(function(){e.parent().showEditor();return false});e.$("%@other").click(function(){e.parent().showError();return false})}})},{webnode2:true,"w2.quora":true});require.install("app/view/question/question_redirect",function(require,exports,module){var e=require("w2.quora").Component;exports.QuestionRedirectReviewsLink=e.extend({onLoad:function(){var e=this;e.$("#@redirect").click(function(t){e.serverCall("add_question_redirect").liveMutate().send();t.preventDefault();return false})}})},{"w2.quora":true});require.install("app/view/question/lookup_bar",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/selector").ServerCallSelector,i=require("qtexteditor").QTextEditor,n=require("window_manager"),o=require("siteuri").URI,s=require("cookies");var r=null;exports.LookupBarSelector=t.extend({onLoad:function(){var e=this;r=e;this._super.apply(this,arguments);this.$results_wrapper=this.$("#@results_wrapper");e.displayedRevision=0;e.currentRevision=0;e.currentOutstandingRequests=0;e.lastRevisionNeedsUpdate=false;e.cache={};e.cacheSize=0;e.focused=true;e.shouldSimScroll=true;e.$wrapper=e.$("#@wrapper");e.$(document).mouseup(function(t){if(!e.$wrapper.is(t.target)&&e.$wrapper.has(t.target).length===0&&$.inArray("LookupBarAddQuestionDetailsLink",t.target.classList)<0){e.focused=false;e.setHighlight(false);e.showResults(false);if(e.askMode==="forced"){if(e.query.trim()===""||e._queryIsPunctation(e.query.trim())){e.setAskMode(false);e.hideInterstitials()}else{e.askMode=true}if(e.query.trim()===""||e._queryIsPunctation(e.query.trim())){e._setQuery("",true)}}}else{e.shouldSimScroll=false;e.focused=true;if(e.query.trim().length!==0){if(!e.hasResults){e._setQuery(e.$input.val())}else{e.showResults(true)}}else{e.showResults(false)}}});e.addQuestion=this.lookup("add_question");e.askMode=false;e.showingInterstitial=false;e.hideResultsOnServerCall=false;e.source=null},capitalize:function(e){if(!e){return e}e=e.charAt(0).toUpperCase()+e.slice(1);return e},setInputVal:function(e,t){var i=this.$input[0].selectionStart,n=this.$input[0].selectionEnd;if(t){i+=t;n+=t}this.$input.val(e);if(e.length>0){this.$input[0].setSelectionRange(i,n)}},_queryIsPunctation:function(e){return e===this.opening_question_punctuation+this.closing_question_punctuation||e===this.opening_question_punctuation&&e.length>0||e===this.closing_question_punctuation&&e.length>0},_setQuery:function(e,t){var i=this.capitalize(e);if(t||this.askMode&&i!==e){var n="";if((e||t)&&e.indexOf(this.opening_question_punctuation)==-1){n=this.opening_question_punctuation}var o="";if((e||t)&&e.indexOf(this.closing_question_punctuation)==-1){o=this.closing_question_punctuation}e=n+i+o;this.setInputVal(e,n.length)}else if(this.askMode&&this.askMode!=="forced"&&this._queryIsPunctation(e)){e="";this.setInputVal(e)}if(this.length_limit){if(e.length>this.length_limit){this.addQuestion.questionIsOverLimit=true}else{this.addQuestion.questionIsOverLimit=false}}this._super.apply(this,[e])},addToCache:function(e,t){if(!(e in this.cache)){this.cacheSize++}this.cache[e]=t;if(this.cacheSize>this.max_cache_size){var i=this.currentRevision+1;var n=null;for(var o in this.cache){if(this.cache[o][1]<i){i=this.cache[o][1];n=o}}this.cacheSize--;delete this.cache[n]}},updateResults:function(){var e=this;var t=e.query.trim();if(e.askMode==="forced"&&(e._queryIsPunctation(t)||t==="")){e.showInterstitial("button");return}var i={query:e.query};var n=e.getExtraKwargs();for(var o in n){i[o]=n[o]}var s=JSON.stringify(i);var r=e.currentRevision;e.lastRevisionNeedsUpdate=false;if(t.length===0){e.displayedRevision=r;e.setAskMode(false);e.showResults(false)}else if(s in e.cache){e.currentOutstandingRequests++;e.resultsServerCallHandler(r,e.cache[s][0],this.showingInterstitial)}else if(e.currentOutstandingRequests<e.max_concurrent_requests){i.parent_cid=e.cid;e.currentOutstandingRequests++;var a=this.showingInterstitial;e.serverCall("results_content_for").kwargs(i).success(function(t){e.resultsServerCallHandler(r,t,s,a)}).except(function(){e.resultsServerCallHandler(r,null,s,a)}).error(function(){e.resultsServerCallHandler(r,null,s,a)}).send()}else{e.lastRevisionNeedsUpdate=true}},getExtraKwargs:function(){return{ask_mode:this.askMode}},resultsServerCallHandler:function(e,t,i,n){this.currentOutstandingRequests--;this.hasResults=true;if(e<this.displayedRevision){return}if(n){this.showingInterstitial=false;this.$("#@ask_mode_interstitial").addClass("hidden");this.$("#@results").removeClass("hidden")}if(t!==null){this.$results.forgetContents();this.$results.setContent(t);this.displayedRevision=e;this.addToCache(i,[t,e])}this.showResults(true);if(this.lastRevisionNeedsUpdate){this.updateResults()}},queryDidChange:function(){this.currentRevision++;this.addQuestion.enableButton(true);this._super.apply(this,arguments)},showResults:function(e){if(e&&this.focused){this.$results_wrapper.removeClass("hidden")}else{this.$results_wrapper.addClass("hidden")}},resultWasSelected:function(e,t){var i=this;var n=this.lookup("results").lookup(e.data.cname);n.processAction(e.data.action_mousedown);if(e.ty==="search"){i.submit(t)}else{if(e.data.qid!==-1){s.setMessage("look",[e.data.qid,true])}if(i.query.length<140){s.cookie("qsu-q",JSON.stringify(i.query),{expires:1})}if(t){window.open(e.data.url)}else{window.location.href=e.data.url}}},openDialog:function(e){var t=null;var i=null;var n="step_2";var o=this.addQuestion.$("#@anon_checkbox");var s=o.attr("checked");var r=this.lookup("wizard");r.forceQuestionDetails(this.addQuestion.getQuestionDetails());r.open(e,s,t,i,n,this.tid);if(this.lookup("hover_menu")&&this.lookup("hover_menu").doHide){this.lookup("hover_menu").doHide()}return false},hideInterstitials:function(){var e=["bad","good","button","wp"];for(var t=0;t<e.length;t++){this.$("#@interstitial_text_"+e[t]).addClass("hidden");
}this.showingInterstitial=false;this.$("#@ask_mode_interstitial").addClass("hidden");this.$("#@results").removeClass("hidden")},showInterstitial:function(e){this.hideInterstitials();this.$("#@interstitial_text_"+e).removeClass("hidden");this.showingInterstitial=true;this.$("#@ask_mode_interstitial").removeClass("hidden");this.$("#@results").addClass("hidden")},setHighlight:function(e,t){var i=this.parent().parent().$("#@body_blur");if(e){i.addClass("lookup_bar_modal_overlay")}else{i.removeClass("lookup_bar_modal_overlay")}if(this.nextHighlightCallback){this.nextHighlightCallback()}this.nextHighlightCallback=t},setAskMode:function(e,t){this.askMode=e;if(this.query.trim()||e){this._setQuery(this.query.trim(),true)}if(e){this.$input.focus();if(t){this.showInterstitial(t)}else if(this.query.trim().length>=10&&this.query.split(" ").length>=3){this.showInterstitial("good")}else{this.showInterstitial("bad")}this.addQuestion.$("#@ask_mode").removeClass("hidden");this.addQuestion.$("#@ask_switch").addClass("hidden");this.logMiscAction("LookupBarSetAskModeClickthrough");this.lastRevisionNeedsUpdate=false;this.focused=true;this.showResults(true);this.shouldShowLengthCounter=true;this.showLengthCounter(true)}else{this.addQuestion.$("#@ask_mode").addClass("hidden");this.addQuestion.$("#@ask_switch").removeClass("hidden");this.shouldShowLengthCounter=false;this.showLengthCounter(false)}},logMiscAction:function(e){var t=this.lookup("results",true);if(!t){return}var i=t.lookup("search",true);if(!i){return}i.processAction(e)},submit:function(e){if(this.query.trim()){var t=o("/search?q="+encodeURIComponent(this.query).replace(/%20/g,"+")+this.keepFilters);if(e){window.open(t.unicode())}else{window.location.href=t.unicode()}}},ask:function(){var e=this;if(e.hasPendingServerCall()){return}e.addQuestion.enableButton(false);e.makeServerCall(e.serverCall("add_question").kwargs({input_text:e.query,is_anon:e.addQuestion.getIsPrivate(),question_details:e.addQuestion.getQuestionDetails(),source:e.source}));this.$input.focus()},setSource:function(e){var t=this;t.source=e},serverCallHandler:function(e,t){this._super.apply(this,arguments);this.addQuestion.enableButton(true);if(!e&&t.type=="success"){this.logMiscAction("LookupBarAddQuestionSuccess");n.navigateTo(t.url)}else{this.logMiscAction("LookupBarAddQuestionFail")}}});exports.AddQuestionSwitchModeButton=e.extend({onLoad:function(){this.$("#@dialog_link").click(this.fnbind(function(){this.parent().parent().setAskMode(true);return false}))}});exports.AddQuestionSubmitAutoTopicsButton=e.extend({onLoad:function(){this.$("#@dialog_link").click(this.fnbind(function(){this.parent().parent().ask();return false}))}});exports.LookupBarAddQuestion=e.extend({onLoad:function(){this.skip_step="step_2";this.askButton=this.lookup("ask_button");this.questionIsOverLimit=false;this.detailIsOverLimit=false},getQuestionText:function(){return this.parent().query},showQuestionDetailsEditior:function(){this.$("#@question_details_editor").show();this.lookup("question_details").focus()},getQuestionDetails:function(){var e=this.lookup("question_details",true);if(e){return e.serialize()}return""},getIsPrivate:function(){return!!this.$("#@anon_checkbox").attr("checked")},enableButton:function(e){if(this.questionIsOverLimit||this.detailIsOverLimit){this.askButton.$("#@dialog_link").addClass("fake_disabled")}else{if(e){this.askButton.$("#@dialog_link").removeClass("disabled");this.askButton.$("#@dialog_link").removeClass("fake_disabled")}else{this.askButton.$("#@dialog_link").addClass("disabled")}}}});exports.LookupBarAddQuestionDetailsLink=e.extend({onLoad:function(){var e=this;e.$("#@question_details_link").click(function(){e.lookup("lookup_bar_add_question").showQuestionDetailsEditior();e.lookup("selector").showResults(true)})}});exports.LookupBarAddQuestionDetailsEditor=i.extend({updateButton:function(e){var t=this.lookup("lookup_bar_add_question");if(e){t.detailIsOverLimit=true;t.enableButton(false)}else{t.detailIsOverLimit=false;t.enableButton(true)}}});var a=[];exports.AddQuestionLookupBarButton=e.extend({setAllEnabled:function(e){a.forEach(function(t){t.setEnabled(e)})},setEnabled:function(e){if(e){this.$("#@dialog_link").removeClass("disabled")}else{this.$("#@dialog_link").addClass("disabled")}},onLoad:function(){var e=this;a.push(e);this.$("#@dialog_link").click(function(){var t=r;var i="button";if(e.source){i=e.source}t.setAskMode("forced",i);e.setAllEnabled(false);t.setHighlight(true,function(){e.setAllEnabled(true)});t.setSource(e.source);return false})}})},{cookies:true,window_manager:true,siteuri:true,qtexteditor:true,"view/selector":true,"w2.quora":true});require.install("app/view/components",function(require,exports,module){require("jquery.whenIdle");var e=require("w2.quora").Component,t=require("cookies"),i=require("webnode2"),n=require("views").viewsLogger,o=require("view/inline_editor").registerEditorCallback,s=require("view/inline_editor").unregisterEditorCallback,r=require("view/inline_editor").isInEditMode,a=require("mathify").renderMath,l=require("settings").interface_strings,u=require("w2.context").AnswerVoteContext,d=require("unified_view/qtext").ExpandableContext;exports.TruncatedQText=e.extend({onLoad:function(e){this.expandableContext=this.getContext(d);if(this.expandableContext){var t=this;this.$more=this.$("#@more");this.$loading=this.$("#@loading");this.expandableContext.on("loading",function(){if(t.$more&&t.$loading){t.$more.addClass("hidden");t.$loading.removeClass("hidden")}})}a("@truncated")}});exports.ExpandedQText=e.extend({onLoad:function(){this._super.apply(this,arguments);a("@expanded")}});exports.TruncatePhraseList=e.extend({onLoad:function(){var e=this;e.$("#@view_all_link").click(function(){e.$("#@partial_phrases").addClass("hidden");e.$("#@all_phrases").removeClass("hidden");return false})}});exports.QTextDiff=e.extend({onLoad:function(){var e=this;e.$("#@more_link").click(function(){e.$("#@diff_snip").addClass("hidden");e.$("#@full_diff").removeClass("hidden");return false})}});var c=function(e){return e.target.nodeName=="A"||$(e.target).hasClass("qtext_embed")};exports.QtextTruncate=e.extend({init:function(){this._super.apply(this,arguments);this.callback=null},onLoad:function(e){var t=this;if(t.show_more&&t.was_truncated||t.$("#@more_link").length>0){t.$("#@text_snip").click(function(e){if(!c(e)){return t.onClick()}});t.$("#@more_link").click(function(){return t.onClick()})}},onClick:function(){var e=this;e.viewMore();if(e.callback){e.callback()}return false},setCallback:function(e){this.callback=e},viewMore:function(){this.$("#@text_snip").addClass("hidden");this.$("#@full_text").removeClass("hidden")}});exports.JSTest=e.extend({onLoad:function(){var e=this;$.whenIdle(1,1e3,function(){setTimeout(function(){if(i.atLeastOneServerCallIsSent){return}e.serverCall("noop").send()},1e3)},"Quora.JSTest.noop")}});exports.SimpleMenu=e.extend({onLoad:function(){if(!this.options){this.options={}}this.$("#@menu_link").click(this.fnbind(function(){this.$("#@menu_items").menu(this.$("#@menu_link"),this.options);return false}))}});exports.SimpleUserRequest=e.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(e){this.onClick();e.preventDefault()}));var e;if(this.upvote||this.remove_upvote){e="u"}else if(this.downvote||this.remove_downvote){e="d"}else if(this.board_follow_button||this.board_request_follow_button||this.board_unfollow_button){e="f"}if(e){this.onKeyCombination(this.$("#@link"),e,this.fnbind(this.onClick))}},onClick:function(){if(this.upvote){t.setQfeedLog(this,"BoardItemUpvote");t.setQueryLog(this,"BoardItemUpvote");t.setTlog({type:"BoardItemUpvote",board_item_id:this.board_item_id});require("action_log").logSecondaryAction("BoardItemUpvote",{type:"board_item",board_item_id:this.board_item_id})}if(this.downvote){t.setQfeedLog(this,"BoardItemDownvote");t.setTlog({type:"BoardItemVoteDown",board_item_id:this.board_item_id})}if(this.board_follow_button||this.board_request_follow_button){t.setQfeedLog(this,"BoardFollow");t.setQueryLog(this,"BoardFollow");t.setTlog({type:"BoardFollow",bid:this.bid});require("action_log").logSecondaryAction("BoardFollow",{type:"board",bid:this.bid})}this.serverCall("request").liveMutate().send()}});exports.SimpleUserRequestConfirm=e.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this._dialog=this.dialog().title(this.title).cancel(null,l.cancel).ok(this.fnbind(function(){this.serverCall("request").liveMutate().send()}),this.button_text).html(this.confirm_text);return false}))}});exports.OrderItemButtons=e.extend({onLoad:function(){this.$("#@up").click(this.fnbind(function(){this.serverCall("move_up").liveMutate().send();return false}));this.$("#@down").click(this.fnbind(function(){this.serverCall("move_down").liveMutate().send();return false}))}});exports.AnswerListItem=e.extend({contextConstructor:function(){return u},onLoad:function(){n.addComponentToTrack(this)}});exports.AnswerHeader=e.extend({onLoad:function(){this.answerVoteContext=this.getContext(u);var e=this;if(e.optimistic_for_web){try{e.answerVoteContext.on("voteState",function(t,i){if(i=="upvote"){e.$("#@credibility_fact_upvoted").removeClass("hidden");e.$("#@credibility_fact_no_vote").addClass("hidden")}else{e.$("#@credibility_fact_upvoted").addClass("hidden");e.$("#@credibility_fact_no_vote").removeClass("hidden")}})}catch(t){}}}});exports.ToggledAnswerHeader=e.extend({onLoad:function(){var e=this;e._registerLoadAndEdit();o("cancel",e.contentType,e.oid,e.cid,e.performCancel.bind(e));o("submitted",e.contentType,e.oid,e.cid,function(){e.performCancel();s("edit",e.contentType,e.oid,e.cid);e._registerLoadAndEdit();return false});if(r(e.contentType,e.oid)){e._unregisterLoadAndRegisterEdit()}},_registerLoadAndEdit:function(){var e=this;o("load",e.contentType,e.oid,e.cid,function(){e._unregisterLoadAndRegisterEdit()})},_unregisterLoadAndRegisterEdit:function(){var e=this;s("load",e.contentType,e.oid,e.cid);e.performEdit();o("edit",e.contentType,e.oid,e.cid,function(){e.performEdit();return false});return false},onUnload:function(){s("load",this.contentType,this.oid,this.cid);s("edit",this.contentType,this.oid,this.cid);s("cancel",this.contentType,this.oid,this.cid);s("submitted",this.contentType,this.oid,this.cid)},performEdit:function(){this.$("#@read_mode_header").addClass("hidden");this.$("#@edit_mode_header").removeClass("hidden")},performCancel:function(){this.$("#@read_mode_header").removeClass("hidden");this.$("#@edit_mode_header").addClass("hidden")}})},{"unified_view/qtext":true,cookies:true,views:true,webnode2:true,mathify:true,"w2.context":true,"jquery.whenIdle":true,"view/inline_editor":true,settings:true,action_log:true,"w2.quora":true});require.install("app/view/link",function(require,exports,module){var e=require("w2.quora").Component,t=require("qtexteditor");var i={onLoad:function(){this.$("#@link_no_image").click(this.fnbind(function(){this.clearAllSelected();this.setDisplayType("link_no_image");this.$("#@link_no_image").addClass("selected");return false}));this.$("#@link_small_image").click(this.fnbind(function(){this.clearAllSelected();this.setDisplayType("link_small_image");this.$("#@link_small_image").addClass("selected");return false}));this.$("#@link_large_image").click(this.fnbind(function(){this.clearAllSelected();this.setDisplayType("link_large_image");this.$("#@link_large_image").addClass("selected");return false}));this.$("#@remove_url").click(this.fnbind(function(){this.parent().removeUrl();return false}))},clearAllSelected:function(){this.$("#@link_no_image, #@link_small_image, #@link_large_image").removeClass("selected")},setDisplayType:function(e){var t;if(e=="link_no_image"){t=1}else if(e=="link_small_image"){t=2}else{t=3}this.cQuery(":preview").setDisplayType(e,t)}};exports.LinkEditor=e.extend(i);exports.LinkVideo=e.extend({onLoad:function(){this.$("#@video_wrapper").click(this.fnbind(function(){this.parent().playVideo();this.$("#@video_wrapper .qtext_embed.thumbnail").css("width","100%").css("height","272px")}))}});exports.LinkImageEditor=e.extend({onLoad:function(){this.index=0;this.$("#@next_photo").click(this.fnbind(function(e){this.cycle_photo(1);return false}));this.$("#@prev_photo").click(this.fnbind(function(e){this.cycle_photo(this.keys_and_sources.length-1);return false}));this.$("#@link").click(this.fnbind(function(){this.serverCall("track").send()}))},get_image_keys:function(){if(this.keys_and_sources!={}){var e=[];for(var t=this.index,i=0,n=this.keys_and_sources.length;i<n;i++,t=(t+1)%n){e.push(this.keys_and_sources[t][0])}return e}else{return[]}},cycle_photo:function(e){var t=this.index;this.index=(t+e)%this.keys_and_sources.length;this.$("#@img").attr("src",this.keys_and_sources[this.index][1])}});exports.LinkTitle=e.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this.serverCall("track").send()}))}});exports.EmbedLinkEditor=t.EmbedComponentBase.extend($.extend({},i,{onLoad:function(){i.onLoad.apply(this,arguments);this.$("#@remove_url").unbind("click");var e=this;this.$("#@remove_url").click(function(){e.componentDeleted()});var t=function(){setTimeout(function(){e.triggerDataChanged()},0);return true};var n=this.cQuery("preview.title.editor.editor");n.$("#@editor").keydown(t);var o=this.cQuery("preview.snippet.editor.editor");o.$("#@editor").keydown(t);this.getLinkImageEditor().whenOnLoaded(function(){n.whenOnLoaded(function(){o.whenOnLoaded(function(){var i=e.previous_info=e.getInfo();e.registerWithParent(e.preview.url,i);var n=e.getLinkImageEditor();n.$("#@next_photo").click(t);n.$("#@prev_photo").click(t)})})})},triggerDataChanged:function(){var e=this.getInfo();if(e!==this.previous_data){this.dataChanged(e);this.previous_data=e}},initializeEmbedComponent:function(e,t,i){this._super.apply(this,arguments);var n=this;var o=i.find(".link_photo img")||[];if(o.length){o.load(function(){n.updatePlaceholderImageSize();n.parent().updateEmbedComponentPositions()})}else{n.updatePlaceholderImageSize()}},setDisplayType:function(e){i.setDisplayType.apply(this,arguments);this.triggerDataChanged()},getLink:function(){return this.cQuery("preview")},getLinkImageEditor:function(){return this.getLink().cQuery(":media")},getInfo:function(){var e=this.getLink().getLinkInfo();e.embed_type="link";var t=JSON.stringify(e);return t}}));exports.Link=e.extend({getLinkInfo:function(){this.link_info.title=this.cQuery(":title.editor").get_value();this.link_info.snippet=this.cQuery(":snippet.editor").get_value();var e=this.cQuery(":media");if(e.editable){this.link_info.image_keys=e.get_image_keys()}return this.link_info},disableInputs:function(){this.cQuery(":title.editor.editor").$("#@editor").addClass("qtext_editor_content_disabled");this.cQuery(":snippet.editor.editor").$("#@editor").addClass("qtext_editor_content_disabled")},setDisplayType:function(e,t){this.$("#@link_wrapper").removeClass().addClass(e);this.link_info.display_type=t},playVideo:function(){var e=2;if(this.link_info.display_type==e){this.$("#@image_col, #@info_col").css("float","left");this.$("#@image_col").css("width","100%");this.$("#@image_and_info").css("display","block")}}})},{qtexteditor:true,"w2.quora":true});require.install("app/view/static",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager");exports.JobsMain=e.extend({onLoad:function(){var e=this;e.$(".expand_link").click(function(t){t.preventDefault();var i=$(this).attr("id").split("_").pop();e.$("#@expand_"+i).toggleClass("hidden")})}});exports.JobListingMain=e.extend({events:{"click #@apply_now":"onClickApplyNow"},onClickApplyNow:function(){var e=this;$(document).trigger("fire_facebook_conversion_pixel",[e.pixel_id]);e.serverCall("mark_ad_pixel_completed").success(function(){t.replaceURL(t.getPathName());t.navigateTo(e.apply_url)}).send();return false}})},{window_manager:true,"w2.quora":true});require.install("app/view/answer_wiki",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor").InlineEditor;exports.CreateAnswerWikiInlineEditor=t.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@inline_editor_cancel").click(this.fnbind(function(){this.toggle_editor();$("#answer_wiki").addClass("hidden");return false}))},_get_kwargs:function(){return{qid:this.id,input:this.get_value()}}});exports.AnswerWikiInlineEditor=t.extend({_get_kwargs:function(){var e="";if(this.has_comment&&!this.lookup("comment_editor").isEmpty()){e=this.lookup("comment_editor").serialize()}var t=this.$("#@notif"),i;if(t){i=t.attr("checked")?1:0}else{i=0}return{qid:this.id,input:this.get_value(),sugg_exists:this.sugg_exists,comment:e,notif:i}}})},{"view/inline_editor":true,"w2.quora":true});require.install("view/suggested_edits",function(require,exports,module){var e=require("w2.quora").Component,t=require("app/view/common"),i=require("view/inline_editor"),n=i.triggerEditorCallback;exports.SuggestedEditBar=e.extend({toggleButtons:function(){this.$("#@suggested_answer_buttons").toggleClass("hidden")}});exports.SuggestedEditButtons=e.extend({onLoad:function(){var e=this;e.$("#@view_original").click(function(){if(e.content_type){t.triggerContentToggleCallback(e.content_type,e.object_id)}else{e.parent().parent().toggleSuggestion()}return false});if(!e.content_type){return}e.$("#@edit_suggestion").click(function(){n("edit",e.content_type,e.object_id);return false})}})},{"view/inline_editor":true,"app/view/common":true,"w2.quora":true});require.install("app/view/topic/topic_create",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("webnode2");exports.TopicCreateMain=e.extend({onLoad:function(){this.submitted=false;this.$("#@fake_editor").click(this.fnbind(function(){this.$("#@fake_editor_row").hide();this.$("#@editor_row").show();this.lookup("editor").focus();return false}));this.$("#@create").click(this.fnbind(function(){var e=this.getTopicName();var i=this.lookup("editor").serialize();if(e&&!this.submitted){this.submitted=true;this.serverCall("create_topic").kwargs({topic_name:e,about:i}).success(this.fnbind(function(e){if(t.sameDomainURL(e)){document.location=e}})).liveMutate().send()}return false}));this.$("#@cancel").click(this.fnbind(function(){this.cancelClicked();return false}))},getTopicName:function(){return this.lookup("navigator").$("#@input").val()},cancelClicked:function(){}});exports.TopicCreateDialog=exports.TopicCreateMain.extend({cancelClicked:function(){i.Dialog.dialogFor(this).close_()}})},{webnode2:true,window_manager:true,"w2.quora":true});require.install("app/view/suggested_sig",function(require,exports,module){var e=require("w2.quora").Component;exports.SuggestedSigOptions=e.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){this.parent().parent().toggleSuggestion();return false}))}})},{"w2.quora":true});require.install("app/view/announcement",function(require,exports,module){var e=require("w2.quora").Component;exports.NUXQuestionPromptAnnouncementClose=e.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){this.parent().closeAnnouncement();return false}))}})},{"w2.quora":true});require.install("view/board_selector",function(require,exports,module){var e=require("w2.quora").Component;exports.BoardItemLabel=e.extend({onLoad:function(e){var t=this.lookup("editor");var i=this.lookup("distro_options_container");if(this.is_submission){t.setIsSubmission(true);t.$("#@post_text").hide();t.$("#@submit_text").show()}else{t.setIsSubmission(false);t.$("#@post_text").show();t.$("#@submit_text").hide()}if(this.is_private||this.is_submission){i.hideDistroOptions()}else{i.showDistroOptions()}}})},{"w2.quora":true});require.install("view/user",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/hover_menu").HoverMenu,i=require("cookies");exports.Name=t.extend({onLoad:function(e){this._super.apply(this,arguments);this.$("#@link").mousedown(this.fnbind(function(){i.setQfeedLog(this,"UserClickthrough");i.setQueryLog(this,"UserClickthrough")}))}});exports.UserPhoto=e.extend({onLoad:function(e){var t=this;this.$("#@link").mousedown(function(){i.setQfeedLog(t,"UserClickthrough");i.setQueryLog(t,"UserClickthrough")})}});exports.TopWriterIcon=e.extend({onLoad:function(){this.$("#@icon").tooltip({contents:this.tooltip_text})}})},{cookies:true,"view/hover_menu":true,"w2.quora":true});require.install("app/view/layout",function(require,exports,module){var e=require("w2.quora").Component,t=require("w2.livenode");exports.QTextImageEnlarger=e.extend({onLoad:function(){var e=this;$(document).on("click",".qtext_image",function(t){e.openModal(t)});$(document).on("keydown",function(t){if(t.keyCode==27){for(var i in e.masters){e.hideModal(e.masters[i])}}});$(document).on("click",".photo_modal_bg, .photo_modal_close",function(){for(var t in e.masters){e.hideModal(e.masters[t])}})},getContainer:function(e,t){var i=this;i.masters={};return i.masters[e]||(i.masters[e]=$("<div>").addClass("photo_modal_container").append($("<div>").addClass("photo_modal_bg")).append($("<div>").addClass("photo_modal_close")).append($("<img>").addClass("photo_modal_img").attr("src",e)).append($("<img>").addClass("photo_modal_img_large").attr("src",t)))},openModal:function(e){var t=this,i=$(e.target),n=i.attr("src"),o=i.attr("master_src"),s=i.hasClass("zoomable_in"),r=i.parents(".truncated_q_text").length>0,a=i.hasClass("qtext_image_large"),l=r&&!a;if(!s||!o||l){return}var u=parseInt(i.attr("master_w")),d=parseInt(i.attr("master_h")),c=$(window).width(),h=$(window).height(),f=t.getContainer(n,o),p=false;if(d>3*h&&d/u>3){p=true}if(u>c){d*=(c-40)/u;u=c-40}if(d>h){u*=(h-40)/d;d=h-40}var g=i.offset().left,_=i.offset().top-$(window).scrollTop(),m=Math.round((c-i.width())/2-g),v=Math.round((h-i.height())/2-_),w=u/i.width();f.find(".photo_modal_img").css("left",g).css("top",_).css("width",i.width()).css("height",i.height());if(p){f.find(".photo_modal_img").css("visibility","hidden")}f.appendTo("body");i.css("visibility","hidden");var b=$(document).scrollTop();$("body").css({position:"fixed",width:"100%",top:-b});var k=f.find(".photo_modal_close").outerWidth();if(p){f.find(".photo_modal_close").css("left",(c+parseInt(i.attr("master_w")))/2-k).css("top",(h-d)/2)}else{f.find(".photo_modal_close").css("left",(c+u)/2-k).css("top",(h-d)/2)}setTimeout(function(){f.find(".photo_modal_bg, .photo_modal_close").addClass("active");if(p){f.find(".photo_modal_bg").css("height",20+parseInt(i.attr("master_h")))}else{f.find(".photo_modal_img").css("transform","translate3d("+m+"px,"+v+"px,0) scale("+w+")").css("-moz-transform","translate3d("+m+"px,"+v+"px,0) scale("+w+")").css("-ms-transform","translate3d("+m+"px,"+v+"px,0) scale("+w+")").css("-o-transform","translate3d("+m+"px,"+v+"px,0) scale("+w+")").css("-webkit-transform","translate3d("+m+"px,"+v+"px,0) scale("+w+")")}},1);var C=false;var y=false;setTimeout(function(){y=true;x()},333);if(p){f.css("position","fixed").css("overflow","scroll")}f.find(".photo_modal_img_large").load(function(){$(this).css("top",(h-d)/2);if(!p){$(this).css("left",(c-u)/2).css("width",u).css("height",d)}else{$(this).css("position","relative").css("left",(c-i.attr("master_w"))/2)}C=true;x()});function x(){if(C&&y){f.find(".photo_modal_img_large").css("visibility","visible");f.find(".photo_modal_img").css("visibility","hidden")}}},hideModal:function(e){e.find(".photo_modal_bg, .photo_modal_close").removeClass("active");e.find(".photo_modal_img_large").remove();e.find(".photo_modal_img").css("visibility","visible");e.find(".photo_modal_img").css("-webkit-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("-moz-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("-ms-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("-o-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("ms-transform","translate3d(0,0,0) scale(1)");setTimeout(function(){$(".qtext_image").css("visibility","visible");var t=Math.abs(parseInt($("body").css("top")));$("body").css({position:"",width:"",top:""});$(document).scrollTop(t);e.remove()},333)}});exports.QTextGIFPlayer=e.extend({onLoad:function(e){if(!e){return}$(document).click(this.fnbind(function(e){var t=$(e.target).parent("[gif-embedded]");if(!t){return}var i=t.attr("gif-embedded");var n=t.attr("background-url");if(t.attr("is-playing")=="false"){var o=new Image;o.onload=function(){t.children(".qtext_image").attr("src",i);t.children(".gif_embed_noclick").css("visibility","hidden");t.attr("is-playing","true")};o.src=i}else{t.children(".qtext_image").attr("src",n);t.children(".gif_embed_noclick").css("visibility","visible");t.attr("is-playing","false")}}))}});function i(e,t){$.each(window.YT.players,function(i,n){if(n.playerId==t){n.state=e.data;if(n.state==window.YT.PlayerState.PLAYING&&n.onReady){n.onReady(n);n.onReady=null}}});if(e.data==window.YT.PlayerState.PLAYING){n(t)}}function n(e){if(!window.YT||!window.YT.players){return}$.each(window.YT.players,function(t,i){if(i.playerId!=e){if(i.player&&$("#"+i.playerId).size()){i.player.pauseVideo()}}})}exports.QTextEmbedEnlarger=e.extend({onLoad:function(e){if(!e){return}$(document).click(this.fnbind(function(e){var t=$(e.target),i;if(t.attr("data-embed")){i=t.attr("data-embed")}else{t=t.parent();i=t&&t.attr("data-embed")}if(!i||!t.hasClass("thumbnail")){return}this.loadEmbed(t,i)}))},loadEmbed:function(e,t){var o=this;if(!window.YT){window.YT={};window.YT.players=[];window.YT.next_id=0;var s=document.createElement("script");s.src="//www.youtube.com/player_api";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r);var a=50;var l=function c(i){if(i<0){return}window.setTimeout(function(){if(window.YT.Player){o.loadEmbed(e,t)}else{c(i-a)}},a)};l(1e4)}if(!window.YT.Player){return}e.append(t).removeClass("thumbnail");var u="YTPlayer-"+window.YT.next_id++;e.find(":first-child").attr("id",u);var d=new window.YT.Player(u,{events:{onStateChange:function(e){return i(e,u)}}});window.YT.players.push({player:d,playerId:u,state:-1});n(u)}});exports.GridGuide=e.extend({onLoad:function(){this.setupKeyboardShortcut()},toggle:function(){if(this.$("#@grid-guide").is(":visible")){this.$("#@grid-guide").fadeOut(150)}else{this.$("#@grid-guide").fadeIn(150)}},setupKeyboardShortcut:function(){require("keystrokes").on([71,82,73,68],this.fnbind(this.toggle))}});exports.BrowserWarning=e.extend({onLoad:function(){t.addContentPadding()}});exports.LogoutNavElement=e.extend({onLoad:function(){this.$("#@logout_link").click(this.fnbind(function(){this.$("#@logout_form").submit();t.stopLiveUpdates();return false}))}});exports.FacebookAdConversionPixel=e.extend({onLoad:function(){if(this.pixel_id){$(document).trigger("fire_facebook_conversion_pixel",[this.pixel_id])}}})},{"w2.livenode":true,keystrokes:true,"w2.quora":true});require.install("app/view/comment",function(require,exports,module){var e=require("w2.quora").Component;exports.CommentLink=e.extend({onLoad:function(){var e=this.$("#@view_comment_link");this.hasCheckedTriggeringModal=false;this.onKeyCombination(e,"c",function(){e.mouseover().click();return false})},maybeTriggerModal:function(){var e=this;if(!e.is_logged_in){return}if(e.type==="board_item_id"||e.hasCheckedTriggeringModal){return}e.hasCheckedTriggeringModal=true;e.serverCall("should_trigger_warning_modal").success(function(t){if(t){e.triggerModal()}}).send()},triggerModal:function(){this.modal("load_modal");this.serverCall("mark_education_modal_seen").send()}})},{"w2.quora":true});require.install("view/datetime_",function(require,exports,module){var e=require("w2.quora").Component,t=require("shared_utils"),i=null,n={};exports.DateTimeComponent=e.extend({onLoad:function(){if(this.js_disp){this.timespanElem=this.$("#@datespan");this.timespanElem.html(t.timestampStr(this.epoch_us,this.granularity))}if(this.js_update_interval){var e=this.js_update_interval+Math.floor(Math.random()*this.js_update_interval*.1);setInterval(this.fnbind(this.updateDisplayStr),e)}},updateDisplayStr:function(){this.timespanElem.html(t.timestampStr(this.epoch_us,this.granularity))}});exports.CountdownClock=e.extend({onLoad:function(){var e=this;var t=e.$("#@countdown");if(i===null){i=setInterval(function(){var e=true;for(var t in n){if(n.hasOwnProperty(t)){e=false;n[t]()}}if(e){clearInterval(i);i=null}},200)}n[e.cid]=function(){var i=Math.floor(Date.now()/1e3);var o=e.getTimeDifference(i);var s=Math.floor(o/60%60);var r=Math.floor(o/(60*60));var a=Math.floor(o%60);var l;if(e.should_pad_zeroes){var u=function(e){var t=e.toString();return t.length>1?t:"0"+t};s=u(s);a=u(a)}l=e.template.replace("{hrs}",r).replace("{mins}",s).replace("{secs}",a);if(e.text!==l){e.text=l;t.text(l)}if(e.hasExpired(i)){delete n[e.cid]}}},onUnload:function(){delete n[this.cid]},getTimeDifference:function(e){return Math.max(this.expires_secs-e,0)},hasExpired:function(e){return e>this.expires_secs}});exports.TimeElapsedClock=exports.CountdownClock.extend({getTimeDifference:function(e){return Math.max(e-this.expires_secs,0)},hasExpired:function(e){return false}})},{shared_utils:true,"w2.quora":true});require.install("app/view/topic/topic_editor",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/toggle");exports.QuestionTopicsEditorCallToAction=e.extend({onLoad:function(e){if(e&&this.should_open_edit_state){this.lookup("topics_editor").do_toggle()}}});exports.TopicsEditor=t.ToggledComponent.extend({onLoad:function(e){this.isPageLoad=e;if(this.lazy_load){this.do_toggle()}this.$("#@done").click(this.fnbind(function(){this.toggleClasses();return false}))},focusSelector:function(){try{this.cQuery(":topic_list.selector_wrapper.selector").focus(true)}catch(e){}},toggleClasses:function(){this.$("#@selector").toggleClass("hidden");this.$("#@view_topics").toggleClass("hidden");this.$("#@edit_topics").toggleClass("hidden");this.$("#@edit").toggleClass("hidden");this.$("#@edit_link").toggleClass("hidden")},do_toggle:function(e){if(this.lazy_load&&!this.toggled){return false}this.toggleClasses();if(!this.isPageLoad||e===true){this.focusSelector()}return true}});exports.TopicEditorButton=e.extend({onLoad:function(){this.$("#@edit").click(this.fnbind(function(){return this.onClickAddOrEdit()}));this.$("#@add").click(this.fnbind(function(){return this.onClickAddOrEdit()}))},onClickAddOrEdit:function(){this.hideTooltip();return!this.parent().do_toggle(true)},hideTooltip:function(){var e=this.lookup("topic_editor_tooltip",true);if(e!==undefined){e.hide()}}});exports.QuestionTopicEditorTooltip=e.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){this.hide()}))},hide:function(){this.$("#@tooltip").hide()}})},{"view/toggle":true,"w2.quora":true});require.install("app/view/oauth",function(require,exports,module){var e=require("w2.quora").Component;exports.OauthCallbackPage=e.extend({onLoad:function(){if(window.opener){if(this.access_token){window.opener.$(window.opener.document).trigger("oauth_approved",{service:this.service,accessToken:this.access_token})}else{window.opener.$(window.opener.document).trigger("oauth_rejected",{service:this.service})}window.close()}else{this.$("#@me").text("access token: "+JSON.stringify(this.access_token))}}})},{"w2.quora":true});require.install("app/view/linkedin_",function(require,exports,module){var e=require("w2.quora").Component;exports.LinkedinCallbackPage=e.extend({onLoad:function(){if(window.opener){window.opener.$(window.opener.document).trigger("linkedin_oauth_approved",this.liUid);window.close()}}})},{"w2.quora":true});require.install("view/invisibleinfo",function(require,exports,module){var e=require("w2.quora").Component;exports.InfoToggle=e.extend({onLoad:function(){this._state=false;this.setupKeyboardShortcut()},toggle:function(){if(!this._state){this._state=true;$(".invisible_info").show()}else{this._state=false;$(".invisible_info").hide()}},setupKeyboardShortcut:function(){require("keystrokes").on([81,73,68,81,73,68],this.fnbind(this.toggle));
}})},{keystrokes:true,"w2.quora":true});require.install("app/view/login",function(require,exports,module){var e=require("w2.quora").Component;exports.LogoutAllSessionsButton=e.extend({onLoad:function(){var e=this;e.$("#@logout").click(function(t){e.serverCall("logout_all_sessions").kwargs({unh:e.unh,time:e.time,uid:e.uid}).liveMutate().send();return false})}})},{"w2.quora":true});require.install("app/view/question/suggested_answer",function(require,exports,module){var e=require("w2.quora").Component;exports.AnswerSuggestedEditDiscardButtonInline=e.extend({onLoad:function(){this.$("#@submit").click(this.fnbind(function(){this.serverCall("discard_suggested_edit").kwargs({aid:this.aid}).liveMutate().send();return false}))}})},{"w2.quora":true});require.install("app/view/photo",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("webnode2");exports.EditPhotoDialogLink=e.extend({onLoad:function(){this.$("#@open_edit_photo").click(this.fnbind(function(){this.editPhoto();return false}))},editPhoto:function(){if(!this._dialog){this._dialog=this.dialog({showXButton:true,closeOnClickOut:true,width:550}).title(this.dialog_title).load("set_dialog_contents").close(this.fnbind(function(){this._dialog=null}))}}});exports.EditPhotoChoice=e.extend({onLoad:function(){this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").text(this.click_best_text);this.cQuery(":upload_dialog.drag_and_drop_form").$("h3").removeClass("drag_and_hover");this.cQuery(":upload_dialog").$("#@drop_zone").removeClass("drag_and_hover");this.$(".@img_choice").click(this.fnbind(function(e){var n=$(e.target).attr("choice");this.serverCall("choose_photo").kwargs({choice:n}).success(this.fnbind(function(){if(this.next_url){t.navigateTo(this.next_url)}else{i.Dialog.dialogFor(this).close_()}})).send();this.$("#@choices").text(this.setting_text);return false}))}})},{webnode2:true,window_manager:true,"w2.quora":true});require.install("app/view/thanks",function(require,exports,module){var e=require("w2.quora").Component;exports.ThanksLink=e.extend({onLoad:function(){var e=this;this.$("#@thanks_link").click(function(){e.serverCall("send_thanks").liveMutate().send();return false})}})},{"w2.quora":true});require.install("app/view/tumblr",function(require,exports,module){var e=require("w2.quora").Component;exports.TumblrCallbackPage=e.extend({onLoad:function(){if(window.opener){if(this.url){window.opener.$(window.opener.document).trigger("tumblr_oauth_approved",this.url);window.close()}else{alert(this.error_message)}}}})},{"w2.quora":true});require.install("app/view/related",function(require,exports,module){require("jquery.whenIdle");var e=require("w2.quora").Component;exports.RelatedQuestionsMoreLink=e.extend({onLoad:function(){var e=this;e.$("#@more").click(function(){e.onClick()})},onVisible:function(){var e=this;var t=e.fnbind(function(){e.serverCall("register_box_load").kwargs({experiment_id:e.experiment_id,clicktrack_id:e.clicktrack_id,qid:e.qid,qids:e.qids}).send()});$.whenIdle(350,t,"Quora.RelatedQuestionsToggler.registerBoxLoad")},onClick:function(){var e=this;e.serverCall("register_show_more").kwargs({experiment_id:e.experiment_id,clicktrack_id:e.clicktrack_id}).send()}})},{"jquery.whenIdle":true,"w2.quora":true});require.install("app/view/payment/payable",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.BankSettings=e.extend({onLoad:function(){var e=this;e.$("#@edit").click(function(t){t.preventDefault();e.modal("load_edit_debit_card_modal")})}});exports.EditDebitCardModal=t.extend({onSubmit:function(){var e=this;e.child("add_debit_card_form").submit(function(){e._closeModal()})}})},{"view/modal":true,"w2.quora":true});require.install("app/view/question/question_alias",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings").interface_strings;exports.AddQuestionAliasList=e.extend({onLoad:function(){this.$("#@create_link").click(this.fnbind(function(){this.$("#@create").hide();this.$("#@add_alias").show();this.lookup("input").$("#@input").focus();return false}));this.$("#@add").click(this.fnbind(function(){var e=this.lookup("input").$("#@input").val();if(e){this.serverCall("add_question_alias").kwargs({qid:this.qid,alias:e}).success(this.fnbind(function(){this.lookup("input").$("#@input").val("");this.lookup("input").$("#@input").focus()})).liveMutate().send()}return false}))}});exports.QuestionAliasText=e.extend({onLoad:function(){this.$("#@edit").click(this.fnbind(function(){this.toggleEditor();return false}));this.$("#@cancel").click(this.fnbind(function(){this.toggleEditor();return false}));this.$("#@update").click(this.fnbind(function(){var e=this.lookup("input").$("#@input").val();if(e){this.serverCall("edit_question_alias").kwargs({qid:this.qid,alias_id:this.alias_id,new_alias:e}).success(this.fnbind(function(){this.lookup("input").$("#@input").val("");this.toggleEditor()})).liveMutate().send()}return false}))},toggleEditor:function(){this.$("#@text").toggle();this.$("#@editor").toggle();this.parent().$("#@remove").toggle()}});exports.QuestionAliasItem=e.extend({onLoad:function(){this.$("#@remove").tooltip({contents:this.tooltip_text}).click(this.fnbind(function(){this.clear();this.$("#@text").addClass("item_selected");if(this._dialog){return}this._dialog=this.dialog().title(this.dialog_title).ok(this.fnbind(function(){this.serverCall("remove_question_alias").kwargs({qid:this.qid,alias_id:this.alias_id}).liveMutate().send()}),this.button_text).cancel(this.fnbind(function(){this.clear()}),t.cancel).html(this.dialog_message);return false}));this.$("#@item").hover(this.fnbind(function(e){this.$("#@remove").show()}),this.fnbind(function(e){this.$("#@remove").hide()}))},clear:function(){$(".item_selected").removeClass("item_selected")}})},{settings:true,"w2.quora":true});require.install("app/view/question/topics",function(require,exports,module){var e=require("app/view/topic/edit_topic_modal");exports.TopicRow=e.TopicRow.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.$("#@row").hover(function(){if(!e.$("#@remove_context_topic_wrapper").is(":visible")){e.$("#@set_context_topic").show()}},function(){if(!e.$("#@remove_context_topic_wrapper").is(":visible")){e.$("#@set_context_topic").hide()}})},bindClickHandlers:function(){var e=this;this.$("#@remove_topic").click(function(t){var i=e.lookup("selector");t.preventDefault();if(e.is_context_topic){e.removeContextTopic()}e.lookup("topic_selection").serverCall("topic_removed").kwargs({tid:e.tid}).success(function(e){if(e.tid){i.removeIgnoreOid(e.tid)}}).liveMutate().send()});this.$("#@topic_name").click(function(){e.setContextTopic()});this.$("#@set_context_topic").click(function(t){t.preventDefault();e.setContextTopic()});this.$("#@remove_context_topic").click(function(t){t.preventDefault();if(e.is_context_topic){e.removeContextTopic()}})},setContextTopic:function(){this.lookup("topic_selection").serverCall("context_topic_changed").kwargs({tid:this.tid}).liveMutate().send()},removeContextTopic:function(){this.lookup("topic_selection").serverCall("context_topic_changed").kwargs({tid:""}).liveMutate().send()}})},{"app/view/topic/edit_topic_modal":true});require.install("app/view/user/profile",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("view/toggle");exports.RestrictedTopicExpertSubmitApplicationForm=e.extend({onLoad:function(){var e=this;e.$("#@submit").click(this.fnbind(function(){for(var t=0;t<this.tid_count;t++){e.lookup("item_"+t).submit()}}))}});exports.RestrictedTopicExpertSubmitApplicationItem=e.extend({onLoad:function(){var e=this.$("#@checkbox");var t=this.lookup("field");e.click(this.fnbind(function(){if(e.attr("checked")=="checked"){t.showEditor()}else{t.hideEditor()}}))},checkBox:function(){this.$("#@checkbox").attr("checked","checked")},submit:function(){var e=this.$("#@checkbox");if(e.attr("checked")=="checked"){var t,i;var n=this.lookup("field").can_edit;if(n){i=this.lookup("field").needs_bio;var o=this.cQuery(":field.editor");if(!o.isEmpty()){t=o.serialize()}}if(!i||!n||i&&t){this.serverCall("submit_application").liveMutate().send()}if(t){this.serverCall("update_bio").kwargs({bio:t}).liveMutate().send()}}}});exports.RestrictedTopicExpertSubmitApplicationSigField=e.extend({onLoad:function(){var e=this;this.$("#@link").click(this.fnbind(function(){e.showEditor();e.lookup("item").checkBox();return false}))},showEditor:function(){this.$("#@link").hide();this.$("#@editor").show()},hideEditor:function(){this.$("#@link").show();this.$("#@editor").hide()}});exports.ProfileNameAndSigEditor=e.extend({onLoad:function(){if(t.getHash().substr(0,9)=="#editname"){this.toggleEditor();this.showNameEditor();this.$("#@name").focus()}this.$("#@edit").click(this.fnbind(function(){this.toggleEditor();this.$("#@bio").focus();return false}));this.$("#@edit_name").click(this.fnbind(function(){this.showNameEditor();return false}));this.$("#@done").click(this.fnbind(function(){this.hideNameEditor();this.toggleEditor();return false}));this.$("#@update").click(this.fnbind(function(){var e=this.$("#@name").val();var t=this.$("#@bio").val();this.serverCall("update").kwargs({name:e,bio:t}).success(this.fnbind(function(e){if(!e){this.toggleEditor()}else{this.$("#@name").addClass("input_validation_error");this.$("#@error").text(e+".").show()}})).liveMutate().send();return false}))},showNameEditor:function(){this.$("#@edit_name").hide();this.$("#@view_name").hide();this.$("#@name_input").show()},hideNameEditor:function(){this.$("#@edit_name").show();this.$("#@view_name").show();this.$("#@name_input").hide()},toggleEditor:function(){this.$("#@view").toggle();this.$("#@edit_view").toggle();this.$("#@error").text("").hide();this.$("#@name").removeClass("input_validation_error")}});exports.VerificationBadge=e.extend({onLoad:function(e){this.$("#@badge").tooltip({contents:this.tooltip_text})}});exports.NGProfileNameEditor=i.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@update").click(this.fnbind(function(){var e=this.$("#@name").val();this.serverCall("update").kwargs({name:e}).success(this.fnbind(function(e){this.toggle()})).liveMutate().send();return false}))}})},{"view/toggle":true,window_manager:true,"w2.quora":true});require.install("app/view/question/not_helpful",function(require,exports,module){var e=require("w2.quora").Component;exports.CollapseAnswerLink=e.extend({onLoad:function(){this.$("#@undo_not_collapsible").click(this.fnbind(function(e){this.serverCall("undo_not_collapsible").kwargs({aid:this.aid}).liveMutate().send();return false}));this.$("#@make_uncollapsible").click(this.fnbind(function(e){this.serverCall("make_uncollapsible").kwargs({aid:this.aid}).liveMutate().send();return false}));this.$("#@undo_collapse").click(this.fnbind(function(e){this.serverCall("undo_collapse").kwargs({aid:this.aid}).liveMutate().send();return false}));this.$("#@collapse").click(this.fnbind(function(e){this.serverCall("collapse").kwargs({aid:this.aid}).liveMutate().send();return false}));this.$("#@undo_lock").click(this.fnbind(function(e){this.serverCall("unlock").kwargs({aid:this.aid}).liveMutate().send();return false}));this.$("#@lock_collapse").click(this.fnbind(function(e){this.serverCall("lock_collapse").kwargs({aid:this.aid}).liveMutate().send();return false}))}})},{"w2.quora":true});require.install("view/filterable_list",function(require,exports,module){var e=require("w2.quora").Component;exports.FilterableList=e.extend({onLoad:function(){this.lastQuery=null;this.delay=100;var e=this;this.$("#@search").keyup(function(){var t=e.fnbind(function(t){e.fetchResults(t)});setTimeout(t,e.delay,e.$("#@search").val())});this.$("#@search_link").click(this.fnbind(function(){this.$("#@search_link, #@bullet").hide();this.$("#@search").show().focus();this.$("#@after_search").show().focus();this.$("#@search_row").show().focus();return false}))},newQueryEntered:function(e){},fetchResults:function(e){if(e!=this.$("#@search").val()){return}if(e==this.lastQuery){return}if(e&&e!==""&&e!=this.lastQuery){this.serverCall("search_results").kwargs({query:e}).contentFor(this.$("#@search_results"),{parentCID:this.cid,useLoadingSpinner:false}).success(this.fnbind(function(){var e=this.$("#@search").val();if(e&&e!==""){this.$("#@search_results").show();this.$("#@default").hide()}else{this.$("#@search_results").hide();this.$("#@default").show()}})).send();this.lastQuery=e;this.newQueryEntered(e)}else if(e===""){this.$("#@search_results").hide();this.$("#@default").show()}}})},{"w2.quora":true});require.install("app/view/board/submission",function(require,exports,module){var e=require("w2.quora").Component,t=require("settings").interface_strings;exports.SimpleUserRequestCommentConfirm=e.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this._dialog=this.dialog().title(this.title).cancel(null,t.cancel).ok(this.fnbind(function(){var e=arguments[0].dialogComponent;var t=e.cQuery(":comment").serialize();this.serverCall("request").kwargs({comment:t}).liveMutate().send()}),this.button_text).load("comment_dialog");return false}))}});exports.SubmissionView=e.extend({onLoad:function(e){var t=this;this.$("#@item").hover(function(e){t.$("#@delete").show();t.$("#@item").addClass("hover")},function(e){t.$("#@delete").hide();t.$("#@item").removeClass("hover")});this.$("#@update_accept").click(this.fnbind(function(){this.request("update_accept");return false}));this.$("#@update").click(this.fnbind(function(){this.request("update");return false}));this.$("#@edit").click(this.fnbind(function(){this.toggle();return false}));this.$("#@cancel").click(this.fnbind(function(){this.toggle();return false}))},getNewPreview:function(){return null},request:function(e){var t=this.lookup("description").serialize();var i=this.lookup("title").serialize();var n=this.getNewPreview();this.serverCall(e).kwargs({new_description:t,new_title:i,new_preview:n}).liveMutate().send()},toggle:function(){this.$("#@editor").toggle();this.$("#@content").toggle()}});exports.RejectSubmissionDialogContents=e.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this.$("#@comment").toggle();this.lookup("comment").focus();return false}))}})},{settings:true,"w2.quora":true});require.install("view/announcement",function(require,exports,module){var e=require("w2.quora").Component;exports.Announcement=e.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){this.closeAnnouncement("x");return false}));this.serverCall("track_announcement_view").send()},closeAnnouncement:function(e){this.serverCall("close_announcement").kwargs({closing_action:e}).liveMutate().send()}});exports.AddAdminAnnouncement=exports.Announcement.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(function(){this.closeAnnouncement("accept");return false}));this.$("#@decline").click(this.fnbind(function(){this.closeAnnouncement("decline");return false}));this.serverCall("track_announcement_view").send()}});exports.NetworkAnnouncement=exports.Announcement.extend({closeAnnouncement:function(e){this.serverCall("close_announcement").kwargs({ann_id:this.ann_id}).liveMutate().send()}})},{"w2.quora":true});require.install("app/view/board/settings",function(require,exports,module){var e=require("w2.quora").Component;exports.BlogSubdomainInput=e.extend({onLoad:function(){this.urlIsOK=false;this.$("#@url").bind("keyup",this.fnbind(function(e){this.checkURL()}));this.$("#@update").click(this.fnbind(function(){this.updateURL();return false}))},checkURL:function(){var e=this.$("#@url").val();this.serverCall("check_url").kwargs({url:e}).success(this.fnbind(function(e){if(e===true){this.urlAvailable()}else if(e===false){this.urlNotAvailable()}else{this.urlEmpty()}})).error(this.fnbind(function(){this.urlNotAvailable()})).send()},getInput:function(){return this.$("#@url")},urlEmpty:function(){this.urlAvailable();this.urlIsOK=false;if(this.bid){this.$("#@button").hide()}},urlAvailable:function(){this.urlIsOK=true;this.$("#@domain_unavailable").hide();this.$("#@url").removeClass("input_validation_error");if(this.bid){this.$("#@button").show()}},urlNotAvailable:function(){this.urlIsOK=false;this.$("#@domain_unavailable").show();this.$("#@url").addClass("input_validation_error");if(this.bid){this.$("#@button").hide()}},updateURL:function(){var e=this.$("#@url").val();if(e){this.serverCall("register_choice").kwargs({url:e}).success(this.fnbind(function(){location.reload(true)})).liveMutate().send()}return false}})},{"w2.quora":true});require.install("app/view/zapdos/card",function(require,exports,module){var e=require("w2.quora").Component;exports.CardButton=e.extend({onLoad:function(){var e=this;e.$("#@card-button-link").click(e.fnbind(e.onClick))},onClick:function(e){e.preventDefault();var t=this;if(t.redirectUrl){window.location.href=t.redirectUrl}else if(t.uiToHideId){t.$("#"+t.uiToHideId).hide()}t.serverCall("click").send();return false}})},{"w2.quora":true});require.install("app/view/ask",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager"),i=require("view/selector").ServerCallSelector;exports.AskSelector=i.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionMarkInserted=false;e.$headerNav=e.parent().$("#@nav");e.$contentWrapper=$(".ContentWrapper");e.$("#@ask_button").click(function(t){e.addQuestion()});e.$input.focus(function(t){e.$headerNav.fadeTo(400,.4)});e.$input.blur(function(t){e.$headerNav.fadeTo(400,1);e.$contentWrapper.fadeTo(400,1)});if(e.$input.val().length>0){e.$input.focus();e.updateResults()}},addQuestion:function(){var e=this;if(e.hasPendingServerCall()){return}e.makeServerCall(e.serverCall("add_question").kwargs({input_text:e.query}).except("success",e.fnbind(e._handleAddQuestionSuccess)))},_handleAddQuestionSuccess:function(e){t.navigateTo(e.url)},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery("");this.questionMarkInserted=false;return}if(!this.query){this.questionMarkInserted=false;return}if(this.questionMarkInserted){return}if(this.query.match(/[?]$/)===null){this.questionMarkInserted=true;this.setQuery(this.query+"?")}},queryDidChange:function(){this._super.apply(this,arguments);this.maybeInsertQuestionMark()},resultsDidChange:function(){var e=this.child("results").numResults>0?.4:1;this.$contentWrapper.fadeTo(400,e)},resultWasSelected:function(e){switch(e.ty){case"question":t.navigateTo(e.data.url);break;case"ask_question":this.addQuestion();break}}})},{"view/selector":true,window_manager:true,"w2.quora":true});require.install("app/view/user_settings/settings",function(require,exports,module){var e=require("w2.quora").Component;exports.SettingsRow=e.extend({onLoad:function(){var e=this;e.selectorId="#"+e.selectorId;this.$(e.selectorId).on("click",function(){e.optionSelected()})},optionSelected:function(){this.serverCall("settings_toggle").liveMutate().send()}})},{"w2.quora":true});require.install("view/reorderable_list",function(require,exports,module){var e=require("w2.quora").Component;var t=document.createElement("div");var i="webkitTransition"in t.style?"webkitTransition":"transition";var n="webkitTransform"in t.style?"webkitTransform":"transform";var o=n==="webkitTransform"?"-webkit-transform":"transform";var s="webkitUserSelect"in t.style?"webkitUserSelect":"userSelect";t.style[n]="translateZ(0)";var r=t.style[n]?"translateZ(0) ":"";var a=t.style[n]?"translateZ(1px) ":"";function l(e){var t=e.style[n];if(t){return{value:t,original:t}}if(window.getComputedStyle){var i=window.getComputedStyle(e).getPropertyValue(o);if(i&&i!=="none"){return{value:i,original:""}}}return{value:"",original:""}}function u(e){var t=e.ownerDocument&&e.ownerDocument.defaultView&&e.ownerDocument.defaultView.getComputedStyle&&e.ownerDocument.defaultView.getComputedStyle(e,null),i=t&&t.getPropertyValue("height")||"";if(i&&i.indexOf(".")>-1){i=parseFloat(i)+parseInt(t.getPropertyValue("padding-top"))+parseInt(t.getPropertyValue("padding-bottom"))+parseInt(t.getPropertyValue("border-top-width"))+parseInt(t.getPropertyValue("border-bottom-width"))}else{i=e.offsetHeight}return i}function d(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}}exports.ReorderableList=e.extend({onLoad:function(){this.pageRoots=$(".Standard2ColLayout").add($(".ContentPageFeed").parent())},isOnDragActive:false,enableLocalUpdate:true,onStartSectionMousedownCallback:null,onEndSectionMousedownCallback:null,onStartSubsectionMousedownCallback:null,onEndSubsectionMousedownCallback:null,onStartSectionMousemoveCallback:null,onEndSectionMousemoveCallback:null,onStartSubsectionMousemoveCallback:null,onEndSubsectionMousemoveCallback:null,onStartSectionMouseupCallback:null,onEndSectionMouseupCallback:null,onStartSubsectionMouseupCallback:null,onEndSubsectionMouseupCallback:null,setToDefaultView:function(){this.target.node.style[s]="";this.target.node.style[i]="";this.target.node.style[n]=this.target.baseTransform.original;this.target.node.style.zIndex="";document.body.removeChild(this.targetNodeClone);this.targetNodeClone=null;this.target.node.style.visibility="";for(var e=0;e<this.sectionNodesContainer.length;e++){var t=this.sectionNodes[e][0];t.style.height="";t.style[n]="";t.style[i]="";for(var o=0;o<this.sectionNodesContainer[e].nodes.length;o++){var r=this.sectionNodesContainer[e].nodes[o];r.node.style[n]=r.baseTransform.original;r.node.style[i]=""}}this.pageRoots.removeClass("unselectable");d();this.removeMouseHandlers()},attach:function(){this.ReorderableList=this.$("#@wrapper")[0];this.otherNodes=[];var e=[];this.sectionNodes=this.$("#@wrapper").find(".ReorderableListBranch").each(function(){e.push($(this).parent())});this.sectionNodes=e;for(var t=0;t<this.sectionNodes.length;t++){var i=this.sectionNodes[t].find(".section_title_wrapper .drag_icon");var n={startSectionIndex:t,node:this.sectionNodes[t]};i.on("mousedown",n,this.fnbind(this._onSectionMousedown));var o=this.sectionNodes[t].find(".ReorderableListContents .drag_icon");for(var s=0;s<o.length;s++){var r=o[s];var a=$(r).closest(".ReorderableListItem").parent();n={startSectionIndex:t,startSubsectionIndex:r,node:a};$(r).on("mousedown",n,this.fnbind(this._onSubsectionMousedown))}}},detach:function(){if(this.sectionNodes){for(var e=0;e<this.sectionNodes.length;e++){var t=this.sectionNodes[e].find(".section_title_wrapper .drag_icon");t.off("mousedown");var i=this.sectionNodes[e].find(".ReorderableListContents .drag_icon");for(var n=0;n<i.length;n++){var o=i[n];$(o).off("mousedown")}}}},updatePosition:function(e,t){this.latestPosition=t;var i=40,n=0;var o=document.body,s=o.getBoundingClientRect(),r=this.target.node.getBoundingClientRect(),a=Math.min(s.bottom,window.innerHeight)-r.bottom,l=r.top-Math.max(s.top,0);if(a<i){n=i-a}else if(l<i){n=l-i}var u=o.scrollTop;if(u!=o.scrollTop){this.startPosition.y+=u-o.scrollTop}if(this.latestPosition.time-this.previousPosition.time>100){this.previousPosition=this.latestPosition}},removeMouseHandlers:function(){if(this.mouseHandlersAttached){this.mouseHandlersAttached=false;$(window).off("mousemove");$(window).off("mouseup")}},_onMousedown:function(e){var t=e.data.node[0];this.startSectionIndex=e.data.startSectionIndex;this.startSubsectionIndex=e.data.startSubsectionIndex;this.target={node:t,baseTransform:l(t),height:t.offsetHeight};this.zero=this.target.node.offsetTop+this.target.height/2;this.sectionNodesContainer=[];for(var n=0;n<this.sectionNodes.length;n++){var s;var r=[];var a=this.sectionNodes[n][0];if(this.target.node!==a){a.style[i]=o+" 0.2s ease-in-out"}var d=this.sectionNodes[n].find(".ReorderableListContents .ReorderableListItem");for(var c=0;c<d.length;c++){var h=d.eq(c)[0].parentNode;if(this.target.node!==h){h.style[i]=o+" 0.2s ease-in-out"}s=h.offsetTop;r.push({node:h,baseTransform:l(h),pos:s+(s<this.zero?h.offsetHeight:0)-this.zero})}s=a.offsetTop;this.sectionNodesContainer.push({nodes:r,posRelative:s+(s<this.zero?a.offsetHeight:0)-this.zero,pos:a.getBoundingClientRect().top+window.pageYOffset-a.clientTop,height:u(a)})}var f={x:e.pageX,y:e.pageY,time:e.timeStamp};this.startTransformPosition=e.clientY;this.startPosition=this.previousPosition=this.latestPosition=f;this.targetNodeClone=this.target.node.cloneNode(true);this.target.node.style.visibility="hidden";var p=this.target.node.getBoundingClientRect();this.targetNodeClone.style.position="fixed";this.targetNodeClone.style.top=p.top+"px";this.targetNodeClone.style.left=p.left+"px";this.targetNodeClone.style["background-color"]="#fff";document.body.appendChild(this.targetNodeClone)},_onSectionMousedown:function(e){if(typeof this.onStartSectionMousedownCallback==="function"){this.onStartSectionMousedownCallback()}this._onMousedown(e);if(typeof this.onEndSectionMousedownCallback==="function"){this.onEndSectionMousedownCallback(this.target.node,this.targetNodeClone)}this._onSectionMousemove(e);if(!this.mouseHandlersAttached){this.mouseHandlersAttached=true;$(window).on("mousemove",this.fnbind(this._onSectionMousemove));$(window).on("mouseup",this.fnbind(this._onSectionMouseup))}},_onSubsectionMousedown:function(e){if(typeof this.onStartSubsectionMousedownCallback==="function"){this.onStartSubsectionMousedownCallback()}this._onMousedown(e);if(typeof this.onEndSubsectionMousedownCallback==="function"){this.onEndSubsectionMousedownCallback(this.targetNodeClone,this.startSectionIndex)}this._onSubsectionMousemove(e);if(!this.mouseHandlersAttached){this.mouseHandlersAttached=true;$(window).on("mousemove",this.fnbind(this._onSubsectionMousemove));$(window).on("mouseup",this.fnbind(this._onSubsectionMouseup))}},_onMousemove:function(e){this.isOnDragActive=true;this.updatePosition(e,{x:e.pageX,y:e.pageY,time:e.timeStamp});this.transformY=e.clientY;this.scrollIfNearEdge(this.transformY);this.pageRoots.addClass("unselectable");var t=this.transformY-this.startTransformPosition;this.target.node.style[n]="translate(0, "+t+"px) "+a+this.target.baseTransform.value;this.targetNodeClone.style[n]=this.target.node.style[n]},_onSectionMousemove:function(e){if(typeof this.onStartSectionMousemoveCallback==="function"){this.onStartSectionMousemoveCallback()}this._onMousemove(e);var t=this.getTotalMovement();var i=this.target.node.offsetHeight;for(var o=0;o<this.sectionNodesContainer.length;o++){var s=this.sectionNodesContainer[o];var a=this.sectionNodes[o][0];var l=0;if(s.posRelative<0&&t.y<0&&s.posRelative>t.y){l=i}else if(s.posRelative>0&&t.y>0&&s.posRelative<t.y){l=-i}if(l){a.style[n]="translate(0,"+l+"px) "+r}else{a.style[n]=""}}if(typeof this.onEndSectionMousemoveCallback==="function"){this.onEndSectionMousemoveCallback()}},_onSubsectionMousemove:function(e){if(typeof this.onStartSubsectionMousemoveCallback==="function"){this.onStartSubsectionMousemoveCallback()}this._onMousemove(e);var t=this.getTotalMovement();var i=this.target.height;for(var o=0;o<this.sectionNodesContainer.length;o++){if(this.latestPosition.y>this.sectionNodesContainer[o].pos&&this.latestPosition.y<(this.sectionNodesContainer[o+1]?this.sectionNodesContainer[o+1].pos:Infinity)){this.endSectionIndex=o;if(o!==this.startSectionIndex){this.sectionNodes[o][0].style.height=this.sectionNodesContainer[o].height+this.target.height+"px"}else{this.sectionNodes[o][0].style.height=this.sectionNodesContainer[o].height+"px"}}else{if(o===this.startSectionIndex){this.sectionNodes[o][0].style.height=this.sectionNodesContainer[o].height-this.target.height+"px"}else{this.sectionNodes[o][0].style.height=this.sectionNodesContainer[o].height+"px"}}}for(o=0;o<this.sectionNodesContainer.length;o++){var s=this.sectionNodesContainer[o];for(var a=0;a<s.nodes.length;a++){var l=0;var u=s.nodes[a];if(u.pos<0&&t.y<0&&u.pos>t.y){l+=i}else if(u.pos>0&&t.y>0&&u.pos<t.y){l+=-i}if(this.latestPosition.y>s.pos&&o>this.startSectionIndex){l+=i;this.zero=this.target.node.offsetTop+this.target.height/2;var d=u.node.offsetTop;if(t.y>0){u.pos=d+(d<this.zero?u.offsetHeight:0)-this.zero+i}else if(t.y<0){u.pos=d+(d<this.zero?u.offsetHeight:0)-this.zero-i}for(var c=0;c<this.sectionNodes.length;c++){this.sectionNodesContainer[c].pos=this.sectionNodes[c][0].getBoundingClientRect().top+window.pageYOffset-this.sectionNodes[c][0].clientTop}}u.node.style[n]=l?"translate(0,"+l+"px) "+r+u.baseTransform.value:u.baseTransform.original}}if(typeof this.onEndSubsectionMousemoveCallback==="function"){this.onEndSubsectionMousemoveCallback()}},_onMouseup:function(){this.isOnDragActive=false;$("html, body").stop()},_onSectionMouseup:function(){if(typeof this.onStartSectionMouseupCallback==="function"){this.onStartSectionMouseupCallback()}this._onMouseup();var e=this.getTotalMovement();var t;if(e.y<0){for(t=0;t<this.sectionNodesContainer.length;t++){if(this.sectionNodesContainer[t].posRelative>e.y){this.endSectionIndex=t;if(this.enableLocalUpdate){this.target.node.parentNode.insertBefore(this.target.node,this.sectionNodes[this.endSectionIndex])}break}}}else{for(t=this.sectionNodesContainer.length-1;t>=0;t--){if(this.sectionNodesContainer[t].posRelative<e.y){if(this.startSectionIndex===t+1){this.endSectionIndex=t+1}else{this.endSectionIndex=t}if(this.enableLocalUpdate){this.target.node.parentNode.insertBefore(this.target.node,this.sectionNodes[t+1]?this.sectionNodes[t+1]:null)}break}}}this.removeMouseHandlers();if(!this.enableLocalUpdate){var i=this.targetNodeClone.getBoundingClientRect().left;this.targetNodeClone.style[n]="";this.targetNodeClone.style.position="absolute";this.targetNodeClone.style.left=i;var o;var s=$(window).scrollTop();if(this.endSectionIndex!==0){if(e.y<0){o=this.sectionNodes[this.endSectionIndex-1][0];s+=o.getBoundingClientRect().bottom}else{o=this.sectionNodes[this.endSectionIndex][0];s+=o.getBoundingClientRect().bottom}}this.targetNodeClone.style.top=s+"px"}if(typeof this.onEndSectionMouseupCallback==="function"){this.onEndSectionMouseupCallback(this.target.node,this.targetNodeClone,this.endSectionIndex,this.startSectionIndex)}},_onSubsectionMouseup:function(){this.removeMouseHandlers();if(typeof this.onStartSubsectionMouseupCallback==="function"){this.onStartSubsectionMouseupCallback(this.target.node,this.endSubsectionIndex,this.startSubsectionIndex)}this._onMouseup();var e;var t=this.sectionNodesContainer[this.endSectionIndex].nodes;var i=this.getTotalMovement();if(t.length===0){if(this.enableLocalUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.appendChild(this.target.node)}this.endSubsectionIndex=0}else{if(i.y<0){if(t[t.length-1].pos+this.target.height>i.y){if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[t.length-1].node.nextSibling)}this.endSubsectionIndex=t.length}for(e=0;e<t.length;e++){if(t[e].pos>i.y){this.endSubsectionIndex=e;if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[e].node)}break}}}else{if(t[0].pos>i.y){if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[0].node)}this.endSubsectionIndex=0}for(e=t.length-1;e>=0;e--){if(t[e].pos<i.y){if(this.endSectionIndex===this.startSectionIndex&&e+1!==this.startSubsectionIndex){this.endSubsectionIndex=e}else{this.endSubsectionIndex=e+1}if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[e+1]?t[e+1].node:null)}break}}}}if(!this.enableLocalUpdate){var o=this.targetNodeClone.getBoundingClientRect().left;this.targetNodeClone.style[n]="";this.targetNodeClone.style.position="absolute";this.targetNodeClone.style.left=o;var s;
var r=$(window).scrollTop();if(this.endSubsectionIndex===0||this.sectionNodesContainer[this.endSectionIndex].nodes.length===0){s=$(this.sectionNodes[this.endSectionIndex]).find(".section_title_wrapper")[0];if(s===undefined){s=$(this.sectionNodes[this.endSectionIndex])[0];r+=s.getBoundingClientRect().top}else{r+=s.getBoundingClientRect().bottom}}else if(i.y<0){s=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex-1].node;r+=s.getBoundingClientRect().bottom}else{if(this.endSectionIndex!==this.startSectionIndex){s=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex-1].node}else{s=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex].node}r+=s.getBoundingClientRect().bottom}this.targetNodeClone.style.top=r+"px"}if(typeof this.onEndSubsectionMouseupCallback==="function"){this.onEndSubsectionMouseupCallback(this.target.node,this.targetNodeClone,this.endSubsectionIndex,this.startSubsectionIndex,this.endSectionIndex,this.startSectionIndex)}},scrollIfNearEdge:function(e){if(this.isOnDragActive){if(e+50>$(window).height()){$("html, body").stop().animate({scrollTop:$(document).height()},6e3,"linear")}else if(e<100){$("html, body").stop().animate({scrollTop:0},6e3,"linear")}else{$("html, body").stop()}}},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}}});exports.ReorderableListContents=e.extend({onLoad:function(){if(this.separator_tooltip_content){this.$("#@separator").tooltip({contents:this.separator_tooltip_content})}},onClickViewMore:function(){}});exports.ReorderableListItem=e.extend({onLoad:function(){var e=this;var t=e.lookup("reorderable_list");var i=e.lookup("reorderable_list_branch");if(t.is_editing){t.detach();t.attach()}t.showErrorOnLiveUpdate();e.$("#@remove").click(function(){e.remove();return false});e.$("#@item").mousedown(function(){if(t.$("#@wrapper").hasClass("is_editing")){t.resetActiveState();if(e.is_internal_node){i.$("#@wrapper").addClass("active");$(this).focus()}else{$(this).addClass("active").focus()}}})},remove:function(){this.serverCall("remove").liveMutate().send()}})},{"w2.quora":true});require.install("view/scroll_indicator",function(require,exports,module){var e=$(window);var t=$(document);var i=function(){};this.anchorOffsets=[];i.prototype.refreshIndicator=function(){var i=this;this.anchorOffsets=[];this.navTargetNode=$(this.options.navContainer+" "+this.options.navTarget);this.navAnchorNode=$(this.options.navContainer+" "+this.options.navTarget+" "+this.options.navAnchor);var n=[];this.selectedIndex=0;if(this.options.navClickToScroll){this.navAnchorNode.click(function(e){i.navBeingClicked=true;var t=$(e.target).closest(i.options.navTarget).index();i.navTargetNode.each(function(){$(this).removeClass("active")});$(e.target).closest(i.options.navTarget).addClass("active");$("html, body").animate({scrollTop:i.anchorOffsets[t]+2},300,function(){i.navBeingClicked=false});e.preventDefault()})}var o=0;this.navAnchorNode.each(function(e,t){n.push($(t).attr("href"))});for(var s=0;s<n.length;s++){var r=n[s];o=$(r).offset().top-this.options.offsetHeight;if(o>t.height()-e.height()){break}this.anchorOffsets.push(o)}var a=s>1?$(n[s-1]).offset().top-this.options.offsetHeight:0;var l=n.length-s;var u=this.options.heightOffsetBottom/l;for(var d=s;d<n.length;d++){var c=d-s;o=a+u*c;this.anchorOffsets.push(o)}};i.prototype.onScrollWindow=function(){if(!this.navBeingClicked){var t=e.scrollTop();for(var i=0;i<this.anchorOffsets.length;i++){if(t>this.anchorOffsets[i]){$(this.navTargetNode[this.selectedIndex]).removeClass("active");this.selectedIndex=i;$(this.navTargetNode[i]).addClass("active")}}}};function n(t){var n=new i;t=$.extend({anchorNav:null,navContainer:".nav",navTarget:"li",navAnchor:"a",navClickToScroll:true,bodyElement:"",offsetHeight:0,heightOffsetBottom:150},t);n.navBeingClicked=false;n.options=t;$.whenLoaded(1,function(){n.refreshIndicator()});e.scroll(n.onScrollWindow.bind(n));return n}exports.makeIndicator=n},{});require.install("third_party/truncate",function(require,exports,module){(function(module,$,e){var t=["table","thead","tbody","tfoot","tr","col","colgroup","object","embed","param","ol","ul","dl","blockquote","select","optgroup","option","textarea","script","style"];function i(e,t){if(e.innerText){e.innerText=t}else if(e.nodeValue){e.nodeValue=t}else if(e.textContent){e.textContent=t}else{return false}}function n(e,t,n,s){var r=e.parent();var a;e.remove();var l=n?n.length:0;if(r.contents().length>l){a=r.contents().eq(-1-l);return o(a,t,n,s)}else{var u=r.prev();a=u.contents().eq(-1);if(a.length){i(a[0],a.text()+s.ellipsis);r.remove();if(n.length){u.append(n)}return true}}return false}function o(e,t,o,s){var r=e[0];var a=e.text();var l="";var u,d;var c=0;var h=a.length;while(c<=h){u=c+(h-c>>1);d=$.trim(a.substr(0,u+1))+s.ellipsis;i(r,d);if(t.height()>s.maxHeight){h=u-1}else{c=u+1;l=l.length>d.length?l:d}}if(l.length>0){i(r,l);return true}else{return n(e,t,o,s)}}function s(e,i,n,r){var a=e[0];var l=e.contents();var u,d;var c=0;var h=l.length;var f=false;e.empty();for(;c<h&&!f;c++){u=l.eq(c);d=u[0];if(d.nodeType===8){continue}a.appendChild(d);if(n.length){if($.inArray(a.tagName.toLowerCase(),t)>=0){e.after(n)}else{e.append(n)}}if(i.height()>r.maxHeight){if(d.nodeType===3){f=o(u,i,n,r)}else{f=s(u,i,n,r)}}if(!f&&n.length){n.remove()}}return f}function r(t,i){this.element=t;this.$element=$(t);this._name="truncate";this._defaults={lineHeight:parseInt(this.$element.css("line-height")),lines:1,ellipsis:"â¦",showMore:"",showLess:""};this.options=$.extend({},this._defaults,i);if(this.options.maxHeight===e){this.options.maxHeight=parseInt(this.options.lines,10)*parseInt(this.options.lineHeight,10)}this.$clipNode=$($(this.options.showMore),this.$element);this.original=this.cached=t.innerHTML;this.isTruncated=false;this.isCollapsed=true;this.update()}r.prototype={update:function(e){var t=!this.isCollapsed;if(e){this.original=this.element.innerHTML=e}else if(this.isCollapsed&&this.element.innerHTML===this.cached){this.element.innerHTML=this.original}var i=this.$element.wrapInner("<div/>").children();i.css({border:"none",margin:0,padding:0,width:"auto",height:"auto"});this.isTruncated=false;if(i.height()>this.options.maxHeight){this.isTruncated=s(i,i,this.$clipNode,this.options)}else{this.isCollapsed=false}i.replaceWith(i.contents());this.cached=this.element.innerHTML;if(t){this.element.innerHTML=this.original}},expand:function(){if(!this.isCollapsed){return}this.isCollapsed=false;this.element.innerHTML=this.isTruncated?this.original+this.options.showLess:this.original},collapse:function(e){if(this.isCollapsed){return}this.isCollapsed=true;e=e||false;if(e){this.update()}else{this.element.innerHTML=this.cached}}};$.fn.truncate=function(e){var t=$.makeArray(arguments).slice(1);return this.each(function(){var i=$.data(this,"jquery-truncate");if(!i){$.data(this,"jquery-truncate",new r(this,e))}else if(typeof i[e]==="function"){i[e].apply(i,t)}})};module.Truncate=r})(this,jQuery)},{});require.install("app/view/topic/faq",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2"),i=require("view/scroll_indicator"),n=require("view/selector").ServerCallSelector,o=require("view/inline_editor").InlineEditor,s=require("input_validate").InputValidator,r=require("view/reorderable_list").ReorderableList,a=require("view/reorderable_list").ReorderableListContents,l=require("view/reorderable_list").ReorderableListItem,u=require("view/modal").Base,d=require("view/hover_menu").HoverMenu,c=require("view/topic_selector").TopicSelectorAdd,h=exports.TopicFaqScrollIndicator=function(){},f=require("action_log").ActionableComponent,p=require("third_party/truncate"),g=require("w2.context").AnswerVoteContext;exports.FaqBadge=e.extend({onLoad:function(){this.$("#@faq_badge").tooltip({contents:this.tooltip_text})}});exports.TopicFaqMainListWrapper=f.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@actionable").off("mousedown");this.$("#@actionable").off("click")}});exports.TopicFaqMainList=r.extend({onLoad:function(){this._super.apply(this,arguments);if(this.user_can_edit){this.setEditLink();this.update();this.bindClickHandler();this.updateToc()}this.updateFixable();this.makeScrollIndicator();var e=this;if(e.is_editable_on_load){setTimeout(function(){e.child("section_focus_helper").focusSection()},0)}},enableLocalUpdate:false,resetActiveState:function(){this.$("#@wrapper").find(".active").removeClass("active")},makeScrollIndicator:function(){h=i.makeIndicator({navContainer:".toc_section_titles",offsetHeight:0})},update:function(){if(this.is_editing){this.$("#@wrapper").addClass("is_editing");this.attach()}else{this.$("#@wrapper").removeClass("is_editing");this.detach()}this.resetActiveState()},updateScrollIndicator:function(){h.refreshIndicator()},updateFixable:function(){var e,i;e=$(".ContentPageTopicFeed");i=160;t.makeFixable(this.$("#@topic_nav"),{scroll_dep:true,footer:e,extra_top_spacing:20,extra_bottom_spacing:i,min_width:990})},showErrorOnLiveUpdate:function(){if(this.isOnDragActive){this.isOnDragActive=false;$("html, body").stop();var e=this;this.serverCall("show_error_on_liveupdate").send().success(function(){setTimeout(e.fnbind(function(){e.detach();e.attach()}),0)})}},toggleEditMode:function(){this.is_editing=!this.is_editing;this.update();this.resetActiveState();h.refreshIndicator();this.updateFixable()},editLinkClickCallback:function(){},bindClickHandler:function(){this.editSectionLink.click(this.fnbind(function(e){e.preventDefault();this.toggleEditSection()}))},toggleEditSection:function(){this.is_editing_section=!this.is_editing_section;this.updateToc()},updateToc:function(){if(this.is_editing_section){this.$("#@wrapper").addClass("is_editing_section");this.editSectionLink.text(this.done_text)}else{this.$("#@wrapper").removeClass("is_editing_section");this.editSectionLink.text(this.add_text)}},setEditLink:function(){var e=this.child("hover_menu").$("#@link");this.editSectionLink=e},onEndSectionMousedownCallback:function(e,t){$(t).addClass("dragging_node node_clone_section on_drag");e.style.height=$(t).outerHeight()+"px"},onEndSubsectionMousedownCallback:function(e,t){$(e).addClass("dragging_node node_clone on_drag");if(t<1){$(e).addClass("primary_section")}else{$(e).addClass("sec_section")}},onEndSubsectionMouseupCallback:function(e,t,i,n,o,s){$(t).removeClass("on_drag");$(t).addClass("on_release");if(i===n&&o===s){this.setToDefaultView();return}e=e.firstChild;var r=e.getAttribute("sid");var a=this.sectionNodes[o][0].firstChild.getAttribute("sid");var l=this;if(o===s){this.serverCall("move_question_in_section").kwargs({section_id:parseInt(a),qid:parseInt(e.getAttribute("oid")),new_pos:i}).liveMutate().send().success(function(){l.setToDefaultView()}).error(function(){l.setToDefaultView();setTimeout(function(){l.detach();l.attach()})})}else{this.serverCall("move_question_across_section").kwargs({section_id:parseInt(a),old_section_id:parseInt(r),qid:parseInt(e.getAttribute("oid")),new_pos:i}).liveMutate().send().success(function(){l.setToDefaultView()}).error(function(){l.setToDefaultView();setTimeout(function(){l.detach();l.attach()})})}},onEndSectionMouseupCallback:function(e,t,i,n){$(t).removeClass("on_drag");$(t).addClass("on_release");if(i<1||i===n){this.setToDefaultView();return}e=e.firstChild;if(i!=n){var o=this;this.serverCall("move_section").kwargs({section_id:parseInt(e.getAttribute("sid")),tid:o.tid,new_pos:i}).liveMutate().send().success(function(){o.setToDefaultView()})}}});exports.TopicFaqSubPageMainList=exports.TopicFaqMainList.extend({updateFixable:function(){},setEditLink:function(){},bindClickHandler:function(){},updateToc:function(){}});exports.TopicFaqMainListEditLink=f.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.mainList=e.lookup("reorderable_list");e.$("#@edit").click(function(t){t.preventDefault();var i=e.$("#@edit").offset().top-$(window).scrollTop();e.toggleMainListEditMode();if(e.is_faq_incomplete){var n=e.mainList.lookup("overview_selector");n.$input.focus();var o=e.$("#@edit").offset().top;var s=o-i;$("html, body").scrollTop(s)}});e.$("#@done").click(function(t){t.preventDefault();e.toggleMainListEditMode()})},toggleMainListEditMode:function(){this.mainList.toggleEditMode()}});exports.TopicFaqContents=a.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;var t=e.lookup("reorderable_list");t.showErrorOnLiveUpdate();document.addEventListener("mousedown",function(){t.resetActiveState()},true)}});exports.TopicFaqContentsScroller=e.extend({onLoad:function(){var e=this;var t=e.lookup("reorderable_list");if(t.is_editing){if(e.scroll_to_section_id){e.whenOnLoaded(function(){var t=$("div[sid='"+e.scroll_to_section_id+"'].ReorderableListBranch");var i=t.offset().top;var n=$(window).height();var o=i-n/2;$("html, body").animate({scrollTop:o},300);t.addClass("highlighted")})}}}});exports.TopicFaqSectionFocusHelper=e.extend({focusSection:function(){if(this.focus_section_id){$(document).trigger("focusSection"+this.focus_section_id)}}});exports.TopicSection=e.extend({onLoad:function(){var e=this;var t=e.lookup("reorderable_list");e.registerFocusSectionEvent()},scrollToAnchor:function(){var e=$("#"+this.anchor_id);$("html, body").scrollTop(e.offset().top)},registerFocusSectionEvent:function(){var e=this;$(document).on("focusSection"+e.section_id,function(){e.child("selector").$input.focus();e.scrollToAnchor()})}});exports.TopicSectionContents=a.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.faq_list=e.cQuery(":topic_page.topic_faq_list");e.selector=e.cQuery(":reorderable_list_branch.selector")},onClickViewMore:function(){this._super.apply(this,arguments);this.lookup("reorderable_list").updateScrollIndicator()}});exports.RecentlyAddedQuestionHighlighter=e.extend({onLoad:function(){var e=this;var t=e.lookup("reorderable_list");if(t.is_editing&&e.highlight_question){e.whenOnLoaded(function(){var t=$("div[sid='"+e.section_id+"'][oid='"+e.highlight_question+"']");t.addClass("highlighted")})}}});exports.TopicSectionEmptyState=e.extend({onLoad:function(){var e=this.cQuery(":reorderable_list_branch.selector");var t=this;t.$("#@add_question").click(function(i){var n,o;if(t.is_secondary_section){n=t.cQuery(":reorderable_list_branch.section_title");o=n.$("#@item").offset().top-$(window).scrollTop()}t.lookup("reorderable_list").toggleEditMode();e.$input.focus();if(t.is_secondary_section){var s=n.$("#@item").offset().top;var r=s-o;$("html, body").scrollTop(r)}i.preventDefault()})}});exports.TopicFaqViewMoreLabel=e.extend({onLoad:function(){var e=this;e.$("#@view_more").click(function(t){t.preventDefault();e.expand()});var t=e.lookup("reorderable_list_contents");if(t.$("#@contents_wrapper").hasClass("show_hidden_items")){e.expand()}},expand:function(){this.lookup("reorderable_list_contents").$("#@contents_wrapper").addClass("show_hidden_items");this.$("#@view_more").removeClass("view_mode_only");this.$("#@view_more").addClass("hidden")}});exports.TopicSectionQuestionItem=l.extend({remove:function(){this.modal("remove")}});exports.SectionTitleItem=l.extend({remove:function(){this.modal("remove")}});exports.SectionEditFaqLink=f.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$("#@link").click(function(t){var i=e.lookup("section_title_item");var n=i.$("#@item").offset().top-$(window).scrollTop();e.lookup("reorderable_list").toggleEditMode();var o=i.$("#@item").offset().top;var s=o-n;$("html, body").scrollTop(s);if(e.incomplete_state){var r=e.cQuery(":reorderable_list_branch.selector");r.$input.focus()}t.preventDefault()})}});exports.TopicFaqRemoveQuestionWarning=u.extend({onSubmit:function(){var e=this;e.serverCall("remove").liveMutate().success(function(){e._closeModal()}).sendOnlyOnce()}});exports.TopicFaqRemoveSectionWarning=u.extend({onSubmit:function(){var e=this;e.serverCall("remove").liveMutate().success(function(){e._closeModal()}).sendOnlyOnce()}});exports.TopicFaqEmptyState=e.extend({onLoad:function(){var e=this;e.$("#@edit_faq").click(function(t){e.lookup("topic_faq_list").toggleEditMode();t.preventDefault()})}});exports.TopicPageAboutSection=e.extend({toggleTopicPhoto:function(){this.$("#@topic_photo").toggleClass("hidden")}});exports.TopicWikiNoButtonInlineEditor=o.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);var t=e.lookup("topic_about");if(t){var i=t.fnbind(t.toggleTopicPhoto);e.setToggleCallback(i)}}});exports.SectionShortNameInlineEditor=o.extend({submitHandler:function(){var e=this;e._super.apply(e,arguments);this.input_obj.keypress(this.fnbind(function(e){var t=e.which;if(t=="13"){s.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}});e.preventDefault()}}))}});exports.TopicFaqQuestionSelector=n.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionMarkInserted=false;if(e.should_render_instruction){e.serverCall("results_content_for").contentFor(e.$results,{parentCID:e.cid}).kwargs({query:e.query}).send();e.$input.focus(function(){e.showResults(true)});e.$input.blur(function(){e.showResults(false)})}},serverCallHandler:function(e,t){this._super.apply(this,arguments);if(!e&&!this.faq_is_empty){this.setQuery("")}},resultsServerCallHandler:function(){this._super.apply(this,arguments);this.$input.focus()},updateResults:function(){var e=this;if(!e.should_render_instruction){e._super.apply(e,arguments)}else if(!e._busy){e.setBusy(true);e.serverCall("results_content_for").contentFor(e.$results,{parentCID:e.cid}).kwargs({query:e.query}).success(e.fnbind(e.resultsServerCallHandler)).except(e.fnbind(e.resultsServerCallHandler)).error(e.fnbind(e.resultsServerCallHandler)).send()}},createNewQuestion:function(){var e=this;if(e.hasPendingServerCall()){return}require("action_log").logPrimaryAction("WebTopicFaqMainListWrapperQuestionAdd",e.impression_target);e.makeServerCall(e.serverCall("create_new_question").kwargs({input_text:e.query}).liveMutate().except("success",e.fnbind(e._handleAddQuestionSuccess)))},addExistingQuestion:function(e){var t=this;if(t.hasPendingServerCall()){return}t.makeServerCall(t.serverCall("add_existing_question").kwargs({qid:e}).liveMutate())},_handleAddQuestionSuccess:function(e){this.serverCallHandler(false,e)},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery("");this.questionMarkInserted=false;return}if(!this.query){this.questionMarkInserted=false;return}if(this.questionMarkInserted){return}if(this.query.match(/[?]$/)===null){this.questionMarkInserted=true;this.setQuery(this.query+"?")}},queryDidChange:function(){this._super.apply(this,arguments);this.maybeInsertQuestionMark()},resultWasSelected:function(e){switch(e.ty){case"question":this.addExistingQuestion(e.data.qid);break;case"create_question":this.createNewQuestion();break}}});exports.TopicFaqAddSectionHoverMenu=d.extend({isInvalidCloseTarget:function(e){var t=this.$("#@menu");var i=this._super.apply(this,arguments);if(i||e.parents().filter(t).length>0){return true}if(this.shown){this.lookup("reorderable_list").toggleEditSection()}return false},doShow:function(){this._super.apply(this,arguments);this.cQuery(".menu_contents.selector").focus()}});exports.SectionTitleSelectorAdd=c.extend({addTopic:function(e){var t=this;t.serverCall("is_descendant_topic").kwargs(e).success(function(i){if(i){var n={};n[t.error_dialog_button_text]=null;t.serverCall("add").kwargs(e).liveMutate().error(t.fnbind(function(){$(".ContentWrapper").dialog({title:t.error_dialog_title,contents:t.error_dialog_message,buttons:n})})).send()}else{t.modal("load_resistance_modal",{kwargs:e})}}).send()},onSelectCallback:function(){this.lookup("hover_menu").hide();this.lookup("reorderable_list").toggleEditSection()}});exports.TopicFaqAddSectionResistanceModal=u.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.$radios=e.$("#@picker input[type=radio]");e.$radios.change(function(){e.$radios.map(function(){var e=$(this),t=$("label[for='"+e.attr("id")+"']");t.toggleClass("selected",e.is(":checked"));t.toggleClass("not_selected",!e.is(":checked"))})});e.$("#@new_topic_name").focus(function(){e.$("#@create_topic").prop("checked",true);e.$("#@create_topic").change()});e.$("#@new_topic_name").focus()},onSubmit:function(){var e=this;if(e.$("#@create_topic").is(":checked")){e.serverCall("add_new_topic").kwargs({new_topic_name:e.$("#@new_topic_name").val()}).liveMutate().error(e.fnbind(function(){var t={};t[e.error_dialog_button_text]=null;$(".ContentWrapper").dialog({title:e.error_dialog_title,contents:e.error_dialog_message,buttons:t})})).success(function(){e._closeModal()}).send()}else{e.serverCall("add_selected_topic").liveMutate().success(function(){e._closeModal()}).send()}}});exports.TopicFaqQuestionCard=e.extend({contextConstructor:function(){return g}})},{"view/fixable2":true,"view/modal":true,input_validate:true,"w2.context":true,"view/reorderable_list":true,"view/topic_selector":true,"third_party/truncate":true,"view/hover_menu":true,"view/selector":true,"view/inline_editor":true,"view/scroll_indicator":true,action_log:true,"w2.quora":true});require.install("app/view/quora_meets_bagel",function(require,exports,module){var e=require("w2.quora").Component;exports.QMBPage=e.extend({onLoad:function(){var e=this;e.$("%@qmb_button").click(e.fnbind(function(t){var i=t.target.id;e.serverCall("take_qmb_action").kwargs({which_action:i}).success(function(){window.location.reload()}).send();return false}))}})},{"w2.quora":true});require.install("app/view/moderation/appeal",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.AppealLink=e.extend({onLoad:function(){this.$("#@show_appeal_modal").click(this.fnbind(function(){this.showAppealModal();return false}))},showAppealModal:function(){this.modal("appeal_modal")}});exports.AppealModal=t.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@submit_button").addClass("submit_button_disabled");var e=this.$("#@policy_checkbox");var t=this;e.click(function(e){if(e.currentTarget.checked){t.$("#@appeal_details").removeClass("hidden")}else{t.$("#@appeal_details").addClass("hidden");t.$("#@submit_button").addClass("submit_button_disabled")}});t.$("#@appeal_type").change(this.fnbind(function(){t.$("#@submit_button").removeClass("submit_button_disabled")}));var i=this.$("#@answer_tag_details_link");var n=this.$("#@answer_tag_details_content");i.click(function(e){if(n.hasClass("hidden")){n.removeClass("hidden");i.text(t.collapse_details)}else{n.addClass("hidden");i.text(t.show_details)}})},onSubmit:function(){this.appeal()},appeal:function(){var e=this.child("appeal_comment").serialize();var t=this.$("input:radio:checked").val();var i={comment:e,appeal_type:t};this.serverCall("send_appeal").liveMutate().kwargs(i).success(this._closeModal()).send()}})},{"view/modal":true,"w2.quora":true});require.install("app/view/embed",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base,i=require("views").viewsLogger,n=require("third_party/truncate");exports.EmbedModalLink=e.extend({onLoad:function(){var e=this;this.$("#@modal_link").on("click",function(t){e.modal("load_inner");t.preventDefault()});this.$("#@embed_disabled").tooltip({contents:e.embed_disabled_text})}});exports.EmbedModal=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.selectAllOnFocus(e.$("#@code_area"));e.$("#@full_answer_checkbox").click(e.fnbind(e.toggleFullAnswer))},selectAllOnFocus:function(e){e.focus(function(){var e=$(this);e.select();window.setTimeout(function(){e.select()},1);e.mouseup(function(){e.unbind("mouseup");return false})})},hideFullAnswerCheckbox:function(){this.$("#@full_answer_checkbox").addClass("hidden")},toggleFullAnswer:function(){var e=this;if(e.$("#@full_answer").is(":checked")){e.$("#@truncated_preview").addClass("hidden");e.$("#@full_preview").removeClass("hidden");e.$("#@code_area").val(e.full_answer_code)}else{e.$("#@truncated_preview").removeClass("hidden");e.$("#@full_preview").addClass("hidden");e.$("#@code_area").val(e.truncated_answer_code)}}});exports.AnswerEmbedAnswer=e.extend({onLoad:function(){var e=this;if(e.is_short_answer){e.lookup("modal").hideFullAnswerCheckbox()}i.addComponentToTrack(this);i.logViews();if(e.embedly){e.$("#@question_text").truncate({lineHeight:"24",lines:3});e.$("#@answer_header").truncate({lines:1})}}})},{"third_party/truncate":true,views:true,"view/modal":true,"w2.quora":true});require.install("app/view/question/answer_credibility",function(require,exports,module){var e=require("w2.quora").Component;exports.EndorsementAndAnswerFact=e.extend({onLoad:function(){var e=this;e.$("#@endorsement_modal").click(function(){e.modal("load_endorsement_modal");return false})}})},{"w2.quora":true});require.install("app/view/quality/base",function(require,exports,module){var e=require("w2.quora").Component;exports.QualityTips=e.extend({onLoad:function(){var e=this;if(e.is_dismissable){e.$("#@close").click(function(t){e.hide();e.onClose();t.preventDefault()})}},onClose:function(){this.serverCall("close_popover").send()},isVisible:function(){return!this.isHidden()},isHidden:function(){return this.$("#@popover").hasClass("hidden")},show:function(){this.$("#@popover").removeClass("hidden")},hide:function(){this.$("#@popover").addClass("hidden")},toggle:function(){this.$("#@popover").toggleClass("hidden")}})},{"w2.quora":true});require.install("app/view/quality/answer",function(require,exports,module){var e=require("w2.quora").Component,t=require("app/view/quality/base").QualityTips;exports.WritingTips=t.extend({toggle:function(){if(this.$("#@popover").hasClass("hidden")){this.serverCall("log_show_flyout_on_icon_click").send()}this._super.apply(this,arguments);this.cQuery(":content_editor.editor.answer_resistance").hide()}})},{"app/view/quality/base":true,"w2.quora":true});require.install("app/view/answer/improvement",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/inline_editor"),i=t.registerEditorCallback,n=t.unregisterEditorCallback,o=t.triggerEditorCallback,s=t.isInEditMode;exports.EditAnswer=e.extend({onLoad:function(){var e=this;e.editing=false;e.$("#@link").click(function(){e.handleClick();return false});i("cancel",e.content_type,e.oid,e.cid,function(){e.performCancel();return false});i("submitted",e.content_type,e.oid,e.cid,function(){e.performCancel();return false});i("edit",e.content_type,e.oid,e.cid,function(){e.performEdit();return false});if(s(e.content_type,e.oid)){e.performEdit()}},onUnload:function(){n("cancel",this.content_type,this.oid,this.cid);n("submitted",this.content_type,this.oid,this.cid);n("edit",this.content_type,this.oid,this.cid)},handleClick:function(){if(this.editing){o("cancel",this.content_type,this.oid)}else{o("edit",this.content_type,this.oid)}},performEdit:function(){this.editing=true;this.$("#@link").text(this.alternate_text)},performCancel:function(){this.editing=false;this.$("#@link").text(this.text)}});exports.AskToImproveLink=e.extend({onLoad:function(){var e=this;var t=this.lookup("answer",null);if(t){var i=t.$("#@ask_to_improve");e.$("#@link").click(function(t){t.preventDefault();e.serverCall("load_prompt").contentFor(i,{parentCID:e.cid}).send()})}}});exports.AskToImprovePrompt=e.extend({onLoad:function(){var e=this;this.selectedType=null;this.$("#@prompt input[type=radio]").click(function(){e.setRequestType($(this).val())});this.$("#@prompt .prompt_option").click(function(){var t=$(this).find("input[type=radio]");t.attr("checked",true);e.setRequestType(t.val())});this.$("#@cancel").click(function(t){t.preventDefault();e.closePrompt()});this.$("#@submit").click(function(){if(!e.$("#@submit").hasClass("disabled")){e.serverCall("add_request").kwargs({request_type:e.getRequestType()}).success(function(){e.$("#@prompt").fadeOut()}).liveMutate().send()}})},closePrompt:function(){this.$("#@prompt").hide()},setRequestType:function(e){this.selectedType=e;if(this.$("#@submit").hasClass("disabled")){this.$("#@submit").removeClass("disabled")}},getRequestType:function(){return this.selectedType}});exports.WritingTips=e.extend({onLoad:function(){var e=this;this.$("#@icon").click(function(){e.child("tips").toggle()})}})},{"view/inline_editor":true,"w2.quora":true});require.install("view/tooltip",function(require,exports,module){var e=require("w2.quora").Component;exports.TooltipComponent=e.extend({onLoad:function(){var e=this.$("#@tooltip");e.parent().tooltip(this.options);e.remove()}})},{"w2.quora":true});require.install("view/fixable_component",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/fixable2");exports.FixableComponent=e.extend({onLoad:function(){var e=this.$("#@fixable_component");t.makeFixable(e.parent(),this.options);e.remove()}})},{"view/fixable2":true,"w2.quora":true});require.install("app/view/advertising/create_ad",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/upload"),i=require("window_manager");exports.CreateAdMain=t.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments);this.$("#@submit_ad").click(this.fnbind(function(e){var t=this.$("#@headline").val();var n=this.$("#@url").val();var o=this.$("#@description").val();var s=this.$("#@photo_key").val();this.serverCall("submit_ad").kwargs({ad_id:this.ad_id,headline:t,description:o,url:n,photo_key:s}).success(this.fnbind(function(e){i.navigateTo("create_campaign?ad_id="+e)})).send();return false}))},uploadSuccess:function(e){this.$("#@photo_key").val(e.photo_key);this.serverCall("upload").kwargs({ad_id:this.ad_id,photo_key:e.photo_key}).contentFor(this.$("#@upload_image"),{parentCID:this.cid}).send()}})},{window_manager:true,"view/upload":true,"w2.quora":true});require.install("app/view/advertising/manage_payment",function(require,exports,module){var e=require("w2.quora").Component;exports.AddCreditCardForm=e.extend({onLoad:function(){var e=this;e.cc_form=e.child("add_credit_card_form");e.$("#@add_card_button").click(function(t){console.log(e.cc_form);e.cc_form.getStripeToken(function(t,i){if(i.error){alert(i.error.message)}else{console.log(i);e.serverCall("save_credit_card").kwargs({token:i}).liveMutate().success(function(){}).send()}})})}});exports.CreditCardDisplayInfo=e.extend({onLoad:function(){var e=this;e.$("#@delete_card").click(function(t){e.serverCall("delete_credit_card").kwargs({}).liveMutate().send()});e.$("#@set_default").click(function(t){e.serverCall("set_default_card").kwargs({}).liveMutate().send()})}})},{"w2.quora":true});require.install("app/view/advertising/create_campaign",function(require,exports,module){var e=require("w2.quora").Component,t=require("window_manager");exports.CreateCampaignForm=e.extend({onLoad:function(){var e=this;e.$("#@ad_content_"+e.selected_ad_id).show();e.$("#@ad_selector").change(function(){e.changeSelectedAd()});e.$("#@submit").click(function(){e.doSubmit()})},changeSelectedAd:function(){var e=this;e.$("#@ad_content_"+e.selected_ad_id).hide();e.selected_ad_id=e.$("#@ad_selector").val();e.$("#@ad_content_"+e.selected_ad_id).show()},doSubmit:function(){var e=this;var i=e.selected_ad_id;var n=e.lookup("start_date").getTime();var o=e.lookup("end_date").getTime();var s=e.lookup("topic_selection").getTopicNames();e.serverCall("create_campaign").kwargs({offer:e.$("#@offer").val(),budget:e.$("#@budget").val(),start:n*1e3,end:o*1e3,topic_names:s,ad_id:i}).success(function(e){t.navigateTo("manage?campaign_id="+e)}).send()}});exports.DateSelector=e.extend({onLoad:function(){var e=this;var t=new Date;var i=t.toJSON().slice(0,10);e.$("#@select_date").val(i)},convertDateToTimeStamp:function(e){var t=new Date(e);return t.getTime()},getTime:function(){var e=this.$("#@select_date").val();if(e===""){return-1}var t=new Date(e);return t.getTime()}})},{window_manager:true,"w2.quora":true});require.install("app/view/advertising/manage_campaign",function(require,exports,module){
var e=require("w2.quora").Component;var t=exports.CampaignStopButton=e.extend({events:{"click #@stop":"onClick"},onLoad:function(){console.log("load")},onClick:function(e){console.log("clicked");this.serverCall("stop").send();return false}})},{"w2.quora":true});require.install("app/view/advertising/ads_home",function(require,exports,module){var e=require("w2.quora").Component;exports.AdsHomeMain=e.extend({onLoad:function(){var e=this;e.$("#@manage_payment").click(function(e){window.location="advertising/manage_payment"});e.$("#@create_ad").click(function(e){window.location="advertising/create_ad"});e.$("#@create_campaign").click(function(e){window.location="advertising/create_campaign"});e.$("#@manage_campaign").click(function(e){window.location="advertising/manage"})}})},{"w2.quora":true});require.install("app/view/signup/conversion_logging",function(require,exports,module){var e=require("w2.quora").Component,t=require("webnode2"),i=require("cookies"),n=require("settings");exports.ConversionLogging=e.extend({onLoad:function(){$("a").on("click",function(e){var o=e.currentTarget;var s=o.getAttribute("href");if(s&&s!="#"){var r=t.getComponentFromElement(o);var a=[];for(var l=0;l<3&&r&&r.__vcon;l++){a.push(r);r=r.parent()}var u=[];for(l=0;l<a.length;l++){u.push(a[l].__vcon[0])}var d=[];d.push(n.controller);d.push(n.action);d.push(window.location.pathname);var c=d.concat(u);if(JSON.stringify(c).length<400){i.setMessage("cl",c)}}})}})},{webnode2:true,cookies:true,settings:true,"w2.quora":true});require.install("view/privacy",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base,i=require("webnode2");exports.FirstAnonAnswerWarningDialog=t.extend({onSubmit:function(){this.serverCall("accept").send();this._super.apply(this,arguments);i.Modal.modalFor(this).executeOnSubmitCallBack()}})},{webnode2:true,"view/modal":true,"w2.quora":true});require.install("app/view/manage",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base,i=require("w2.context");var n=exports.FeedControlModalContext=i.Context.extend({initialProperties:function(){return{itemFollowed:[]}}});exports.FeedControlModal=t.extend({contextConstructor:function(){return n},onLoad:function(){var e=this;e._super.apply(this,arguments);var t=e.$("#@organize");var i=e.$("#@discover");var n=e.$("#__w2_modal_overlay_");var o=e.child("feed_control_container").$("#@organize");var s=e.child("feed_control_container").$("#@discover");t.click(this.fnbind(function(){t.addClass("selected");o.removeClass("hidden");i.removeClass("selected");s.addClass("hidden")}));i.click(this.fnbind(function(){i.addClass("selected");s.removeClass("hidden");t.removeClass("selected");o.addClass("hidden")}));n.on("mousedown",function(t){if(t.target==this&&!e._isScrollBarClicked(t)){e.maybeRefreshFeed()}})},_isScrollBarClicked:function(e){var t=$.getScrollbarWidth();if(window.innerWidth-e.clientX<t){return true}else{return false}},onClose:function(){this.maybeRefreshFeed()},onSubmit:function(){this.maybeRefreshFeed()},onCancel:function(){this.maybeRefreshFeed()},maybeRefreshFeed:function(){var e=this;e.FeedControlModalContext=e.getContext(n);var t=e.FeedControlModalContext.get("itemFollowed");e._closeModal();if(Object.keys(t).length>0){e.refreshFeed()}},refreshFeed:function(){var e=this;var t=$("#feed_control_update_feed_screen");var i=5500;t.removeClass("hidden");e.serverCall("refresh_feed").success(function(){setTimeout(t.addClass("hidden"),i)}).error(function(){setTimeout(t.addClass("hidden"),i)}).liveMutate().send()}});exports.FeedControlModalLink=e.extend({onLoad:function(){var e=this;this.$("#@create_modal_link").click(this.fnbind(function(){e.modal("load_inner",{closeOnBackgroundClick:false});return false}))}});exports.FeedControlContent=e.extend({onLoad:function(){var e=this;e.feed_control_contents=[];for(var t in e.content_ids){var i=e.content_ids[t];var n="#@"+i;e.feed_control_contents[i]={js_id:n,scroll_position:0}}for(var o in e.feed_control_contents){var s=e.feed_control_contents[o];var r=e._createOnLinkClicked(o);var a=e.child("filter_section").$(s.js_id);a.click(this.fnbind(r))}},_createOnLinkClicked:function(e){var t=this;return function(){var i=t.feed_control_contents[t.active_id];var n=t.child("filter_section").$(i.js_id);var o=t.$(i.js_id);i.scroll_position=o.parent().scrollTop();n.removeClass("selected");o.addClass("hidden");var s=t.feed_control_contents[e];var r=t.child("filter_section").$(s.js_id);var a=t.$(s.js_id);r.addClass("selected");a.removeClass("hidden");a.parent().scrollTop(s.scroll_position);t.active_id=e}}});exports.FeedControlContentRow=e.extend({onLoad:function(){var e=this;var t=e.$("#@item_button");e.FeedControlModalContext=e.getContext(n);t.click(this.fnbind(function(){var t=this.cid;var i=e.FeedControlModalContext.get("itemFollowed");if(t in i){delete i[t]}else{i[t]=true}e.FeedControlModalContext.set("itemFollowed",i)}))}})},{"w2.context":true,"view/modal":true,"w2.quora":true});require.install("unified_view/util",function(require,exports,module){exports.positionForElement=function(e){var t=0;var i=0;var n=e.offsetWidth;var o=e.offsetHeight;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t+=e.offsetLeft-e.scrollLeft;i+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{left:t,top:i,width:n,height:o}}},{});require.install("unified_view/action_bar/base",function(require,exports,module){var e=require("interface/component").Component,t=require("w2.context"),i=require("interface/settings"),n=require("unified_view/util"),o=require;if(i.pageIsMobile){var s=o("mobile_app2/client")}else{var r=o("view/hover_menu");var a=o("sticky");var l=o("window_manager")}exports.ActionBarWeb=e.extend({contextConstructor:function(){return t.ActionBar},onLoad:function(){this.overflowMenuShown=false;this.overflowMenuMovedToBody=false;this.overflowMenuLoaded=!this.lazy_loaded;this.$overflowLinkElem=this.unsafe$id("@overflow_link");this.$overflowMenuElem=this.unsafe$id("@overflow_menu");this.$actionBarElem=this.unsafe$id("@action_bar");this.$overflowMenuContentsElem=this.$id("@overflow_menu_contents");this.actionBarContext=this.getContext(t.ActionBar);this.overflowMenu=new r.ToggleableMenu({$linkElem:this.$overflowLinkElem,$menuElem:this.$overflowMenuElem,loadFunction:this.loadOverflowMenu.bind(this),alignment:"right",clickOpen:true});if(this.is_sticky){this.actionBarContext.on("commentsElem",this.maybeEnableSticky.bind(this));this.actionBarContext.on("updateSticky",this.updateSticky.bind(this))}},loadOverflowMenu:function(){if(this.overflowMenuLoaded){return}this.overflowMenuLoaded=true;this.serverCall("load_menu").contentFor(this.$overflowMenuContentsElem.get(0),{parentCID:this.cid}).send()},maybeEnableSticky:function(){if(!this.is_sticky){return}var e=this.actionBarContext.get("commentsElem");var t=this.actionBarContext.get("showComments");if(e&&!t){a.add({elem:this.$actionBarElem,container:this.$actionBarElem.parent().parent(),offsets:this.sticky_offsets})}else{a.remove(this.$actionBarElem)}},updateSticky:function(){if(!this.is_sticky){return}this.maybeEnableSticky();l.scrollIntoView(this.$actionBarElem)}});exports.ActionBarMobile=e.extend({contextConstructor:function(){return t.ActionBar},onLoad:function(){this.actionBarContext=this.getContext(t.ActionBar);this.overflowMenuLoaded=!this.lazy_loaded;this.overflowMenuLoading=false;this.overflowMenuShown=false;this.overflowMenuShownPending=false;this.$overflowMenuContentsElem=this.$id("@overflow_menu_contents");this.$overflowLinkElem=this.$id("@overflow_link");this.$overflowLinkElem.on("click",this.showMenu.bind(this));if(this.lazy_loaded){this.loadOverflowMenu()}},loadOverflowMenu:function(){if(this.overflowMenuLoading||this.overflowMenuLoaded){return}this.overflowMenuLoading=true;this.serverCall("load_menu").contentFor(this.$overflowMenuContentsElem.get(0),{parentCID:this.cid}).success(this.maybeShowMenu.bind(this)).send({batched:true})},enterLoadingState:function(){s.sendMessageToClient("showLoadingView")},exitLoadingState:function(){s.sendMessageToClient("hideLoadingView")},maybeShowMenu:function(){this.overflowMenuLoaded=true;this.overflowMenuLoading=false;if(!this.overflowMenuShownPending){return}this.overflowMenuShownPending=false;this.exitLoadingState();this.showMenu()},showMenu:function(){if(!this.overflowMenuLoaded){this.overflowMenuShownPending=true;this.enterLoadingState();this.loadOverflowMenu();return}if(this.overflowMenuShown){return}this.overflowMenuShown=true;var e=this.actionBarContext.get("overflowItems");var t=[];var i=-1;e.forEach(function(e,n){t.push(e.label);if(e.is_destructive){i=n}});if(!s.supportsDestructiveActionSheetButtons()){i=-1}s.sendMessageToClient("showActionSheet",{buttonTitles:t,destructiveButtonIndex:i,position:n.positionForElement(this.$overflowLinkElem.get(0))});s.registerOneTimeMessageHandler("actionSheetDismissed",function(t){this.overflowMenuShown=false;var i=parseInt(t.buttonIndex,10);if(i<0||e.length<=i){return}setTimeout(this.selectOverflowItem.bind(this,i),100)}.bind(this))},selectOverflowItem:function(e){this.actionBarContext.set("selectedOverflowItem",e)}})},{"unified_view/util":true,"interface/settings":true,"interface/component":true,"w2.context":true});require.install("unified_view/action_bar/answer",function(require,exports,module){var e=require("interface/component").Component,t=require("w2.context");exports.ReadMoreActionItem=e.extend({onLoad:function(){this.$id(this.link_id).on("click",this.handleClick.bind(this))},handleClick:function(e){e.preventDefault();this.getContext(t.QuestionAnswerVerbose).set("expand",true)}})},{"interface/component":true,"w2.context":true});require.install("unified_view/action_bar/_action_bar",function(require,exports,module){var e=require("unified_view/action_bar/base"),t=require("w2.context");exports.Question=e.ActionBarWeb.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionAreaContext=e.getContext(t.QuestionArea);if(e.questionAreaContext){e.questionAreaContext.on("showActionBar",function(t,i){if(i){e.$actionBarElem.show()}else{e.$actionBarElem.hide()}})}}});exports.EditQuestionOverflow=e.ActionBarMobile.extend({onLoad:function(){var e=this;e.editQuestionOverflowContext=e.getContext(t.EditQuestionOverflow);e.editQuestionOverflowContext.on("showMenu",function(){e.showMenu()});e._super.apply(e,arguments)}})},{"w2.context":true,"unified_view/action_bar/base":true});require.install("unified_view/action_bar/shared",function(require,exports,module){var e=require("interface/component").Component,t=require("w2.context");exports.CommentsActionItem=e.extend({onLoad:function(){this.actionBarContext=this.getContext(t.ActionBar);this.$linkElem=this.$id(this.link_id);this.$linkElem.on("hover",this.loadComments.bind(this));this.$linkElem.on("click",this.toggleComments.bind(this))},loadComments:function(){this.actionBarContext.set("loadComments",true)},toggleComments:function(e){e.preventDefault();var t=this.actionBarContext.get("showComments");this.actionBarContext.set("showComments",!t)}});exports.CommentsExtraItem=e.extend({onLoad:function(){this.actionBarContext=this.getContext(t.ActionBar);this.$wrapperElem=this.$id(this.wrapper_id);this.fetched=!this.lazy_loaded;this.actionBarContext.set("commentsElem",this.$wrapperElem);this.actionBarContext.on("loadComments",this.loadComments.bind(this));this.actionBarContext.on("showComments",this.toggleComments.bind(this))},loadComments:function(){if(this.fetched){return}this.fetched=true;this.serverCall("fetch_comments").contentFor(this.$wrapperElem.get(0),{parentCID:this.parent().cid}).send()},toggleComments:function(e,t){this.$wrapperElem.toggleClass("hidden",!t);this.actionBarContext.set("updateSticky",true)}})},{"interface/component":true,"w2.context":true});require.install("unified_view/action_bar/blog",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/settings"),i=require;if(t.pageIsMobile){var n=i("mobile_app2/client")}exports.AddPostActionItem=e.extend({onLoad:function(){this.$id(this.link_id).on("click",this.handleClick.bind(this))},handleClick:function(e){e.preventDefault();n.sendMessageToClient("invokeRichTextEditor",this.editor_kwargs)}})},{"interface/settings":true,"interface/component":true});require.install("unified_view/action_bar/question",function(require,exports,module){var e=require("interface/component").Component,t=require("w2.context"),i=require("interface/settings").pageIsMobile,n=require;if(i){var o=n("mobile_app2/client"),s=n("mobile_app2/cookies"),r=n("mobile_app2/action_log")}exports.AddAnswerEditorWrapper=e.extend({contextConstructor:function(){return t.QTextEditor},onLoad:function(){var e=this;e.editorLoaded=false;e.$editorWrapper=e.$id("@add_answer_editor_wrapper");e.getContext(t.ActionBar).on("toggleEditor",function(){e.toggleEditor()})},toggleEditor:function(){if(!this.editorLoaded){this.loadEditor()}else if(this.$editorWrapper.hasClass("hidden")){this.$editorWrapper.removeClass("hidden");this.focusEditor()}else{this.$editorWrapper.addClass("hidden")}},loadEditor:function(){if(i){this.loadEditorMobile()}else{this.loadEditorDesktop()}},loadEditorMobile:function(){var e=this;if(e.should_track_question_state){e.trackQuestionState()}if(this.editor_kwargs.is_qtext2){this.createModal("load_editor_modal").kwargs({qid:e.qid}).onSubmit(function(t){s.setTlog({type:"AddAnswer"});s.setQfeedLog(e,"AddAnswer");r.logPrimaryAction("MobileEditorAddAnswer",e.getDvar("impression_target"));r.logSecondaryAction("MobileEditorAddAnswer",null);o.sendMessageToClient("openURL",{url:t.value.next_url})}).show()}else{o.invokeRichTextEditor(e.editor_kwargs,{onSucceed:function(){s.setTlog({type:"AddAnswer"});s.setQfeedLog(e,"AddAnswer");o.broadcastReload(e.editor_kwargs.broadcast_key);r.logPrimaryAction("MobileEditorAddAnswer",e.getDvar("impression_target"));r.logSecondaryAction("MobileEditorAddAnswer",null)},onCancel:function(){o.broadcastReload(e.editor_kwargs.broadcast_key)}})}},loadEditorDesktop:function(){var e=this;e.serverCall("load_add_answer_editor").contentFor(e.$editorWrapper.get(0),{parentCID:e.cid}).success(function(){e.$editorWrapper.removeClass("hidden");e.editorLoaded=true;e.focusEditor()}).send()},focusEditor:function(){this.getContext(t.QTextEditor).set("focusInput",true)},trackQuestionState:function(){this.serverCall("track_question_state").kwargs({qid:this.qid}).send()}})},{"interface/settings":true,"interface/component":true,"w2.context":true});require.install("unified_view/action_bar/remove_from_feed",function(require,exports,module){var e=require("unified_view/action_bar/base"),t=require("w2.context");exports.RemoveFromFeed=e.ActionBarMobile.extend({onLoad:function(){var e=this;e.feedStoryItemContext=e.getContext(t.FeedStoryItem);e.feedStoryItemContext.on("showRemoveFromFeedMenu",function(){e.showMenu()});e._super.apply(e,arguments)}})},{"w2.context":true,"unified_view/action_bar/base":true});require.install("unified_view/action_bar/user",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/settings"),i=require;if(t.pageIsMobile){var n=i("mobile_app2/client"),o=i("mobile_app2/util")}exports.SendMessageActionItem=e.extend({onLoad:function(){var e=this;o.safeClickHandler(this.$id("@message_link").get(0),function(t){n.sendMessageToClient("invokeRichTextEditor",{title:e.editor_title,editor_type:"text",text_formatting:"basic",done_server_call:"compose_new_message_wrapper",request_params:{uid:e.oid,target:e.oid},supports_callbacks:true},{onSucceed:function(){n.markPageAsDirty("/inbox");n.reloadDirtyPages();if(n.isIOSApp()){n.sendMessageToClient("dismissModal")}}});t.preventDefault()})}})},{"interface/settings":true,"interface/component":true});require.install("interface/dialog",function(require,exports,module){var e=require("interface/settings"),t=require;if(e.pageIsMobile){var i=t("mobile_app2/app/view/common");exports.showConfirmationDialog=function(e,t,n,o){i.showConfirm({title:t,message:n,callback:o})}}else{var n=t("webnode2").Dialog.extend();exports.showConfirmationDialog=function(t,i,o,s){t._dialog=new n(t).title(i).cancel(null,e.interface_strings.cancel).ok(function(){s()},i).close(function(){t._dialog=null}).html(o)}}},{"interface/settings":true});require.install("unified_view/modal",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/modal"),i=require("interface/settings").pageIsMobile,n=require;if(i){var o=n("mobile_app2/client")}else{var s=n("webnode2")}exports.ModalBase=e.extend({onLoad:function(){var e=this;this.$id("@close").on("click",function(t){t.preventDefault();e.onClose()});this.$id("@cancel").on("click",function(t){t.preventDefault();e.onClose()});this.$id("@submit").on("click",function(t){t.preventDefault();e.onSubmit()});this.onLoadMobile()},onLoadMobile:function(){if(!i){return}this.setMobileDoneButton(false)},setMobileDoneButton:function(e){if(!this.done_button){return}if(o.isNativeApp()){o.setNavigationButton({elem:this.$id("@nav").get(0),text:this.done_button,style:"done",disabled:e,callback:this.onSubmit.bind(this)})}else{var t=this.$id("@nav");t.text(this.done_button);t.addClass("is_done");t.removeClass("hidden");t.toggleClass("is_disabled",e);t.on("click",this.onSubmit.bind(this))}},close:function(){t.handleClose(this)},onClose:function(){this.close()},submit:function(e){t.handleSubmit(this,e)},onSubmit:function(e){this.submit(e);this.close()}})},{"interface/modal":true,"interface/settings":true,"interface/component":true});require.install("unified_view/action_bar/overflow_menu/base",function(require,exports,module){var e=require,t=require("interface/component").Component,i=require("interface/settings").pageIsMobile,n=require("w2.context"),o=require("interface/cookies"),s=require("interface/dialog").showConfirmationDialog,r=require("unified_view/modal").ModalBase;if(i){var a=e("mobile_app2/client"),l=e("mobile_app2/app/view/common")}else{var u=e("webnode2"),d=u.ModalWithCallBacks}exports.Item=t.extend({onLoad:function(){if(i){this.mobileOnLoad()}else{this.desktopOnLoad()}},mobileOnLoad:function(){this.actionBarContext=this.getContext(n.ActionBar);var e=this,t=this.actionBarContext.get("overflowItems");t[this.index]={label:this.label,is_destructive:this.is_destructive};this.actionBarContext.set("overflowItems",t);this.actionBarContext.on("selectedOverflowItem",function(t,i){if(i==e.index){e.onSelectAction()}})},desktopOnLoad:function(){var e=this;this.$id("@overflow_menu_item").on("click",function(t){e.onSelectAction();if(e.close_on_click){t.preventDefault()}return e.close_on_click})},onSelectAction:function(){},invokeRichTextEditor:function(e){a.invokeRichTextEditor(e,{onSucceed:function(){if(e.broadcast_key){a.broadcastReload(e.broadcast_key)}}})}});exports.WithServerCall=exports.Item.extend({onSelectAction:function(){this.serverCall("selected").success(function(e){if(i){if(e.value&&e.value.url){a.sendMessageToClient("openURL",{url:e.value.url})}}else{if(e.url){document.location=e.url}}}).send()}});exports.WithLink=exports.Item.extend({desktopOnLoad:function(){var e=this;this.$id("@overflow_menu_item").on("click",function(t){e.onSelectAction(t)})},onSelectAction:function(){if(!i){return}a.sendMessageToClient("openURL",{target:this.target,url:this.url})}});exports.WithModal=exports.WithLink.extend({onSelectAction:function(e){if(i){this._super.apply(this,arguments)}else{e.preventDefault();var t=new d(this,{});t.load("load_modal")}}});exports.Toggleable=exports.Item.extend({onToggledOff:function(){if(this.one_way){return}if(this.qfeed_log_action_on_disable){o.setQfeedLog(this,this.qfeed_log_action_on_disable)}if(this.tlog_action_context&&this.tlog_action_on_disable){var e={type:this.tlog_action_on_disable};e[this.tlog_action_context]=this.oid;o.setTlog(e)}if(this.with_server_call){this.makeServerCall("on_toggled_off")}},onToggledOn:function(){if(this.qfeed_log_action_on_enable){o.setQfeedLog(this,this.qfeed_log_action_on_enable)}if(this.tlog_action_context&&this.tlog_action_on_enable){var e={type:this.tlog_action_on_enable};e[this.tlog_action_context]=this.oid;o.setTlog(e)}if(this.with_server_call){this.makeServerCall("on_toggled_on")}},makeServerCall:function(e){var t=this;t.serverCall(e).liveMutate().success(function(){if(i){if(t.broadcast_key){a.broadcastReload(t.broadcast_key)}if(t.should_reload){a.sendMessageToClient("reload")}}}).send()},onSelectAction:function(){if(this.is_on){this.onToggledOff()}else{this.onToggledOn()}}});exports.ToggleableWithConfirmation=exports.Toggleable.extend({onToggledOn:function(){var e=this;var t=e._super;var n=function(){t.apply(e)};if(e.should_show_on_toggled_on){if(i){l.showConfirm({title:e.on_toggled_on_title,message:e.on_toggled_on_message,callback:n})}else{this.createModal("load_modal").onSubmit(n).show()}}else{n()}},onToggledOff:function(){var e=this;var t=e._super;var n=function(){t.apply(e)};if(e.should_show_on_toggled_off){if(i){l.showConfirm({title:e.on_toggled_off_title,message:e.on_toggled_off_message,callback:n})}else{this.createModal("load_modal").onSubmit(n).show()}}else{n()}}})},{"interface/settings":true,"interface/component":true,"w2.context":true,"interface/cookies":true,"unified_view/modal":true,"interface/dialog":true});require.install("unified_view/action_bar/overflow_menu/answer",function(require,exports,module){var e=require,t=require("interface/settings").pageIsMobile,i=require("unified_view/action_bar/overflow_menu/base");if(t){var n=e("mobile_app2/client")}else{var o=e("webnode2").ModalWithCallBacks}exports.EditBio=i.WithServerCall.extend({onSelectAction:function(){if(t){n.sendMessageToClient("openURL",{target:"modal",url:this.url})}else{var e=new o(this,{});e.load("selected")}}});exports.AskToImprove=i.Toggleable.extend({onToggledOn:function(){if(t&&this.url!="#"){n.sendMessageToClient("openURL",{target:"modal",url:this.url})}}})},{"interface/settings":true,"unified_view/action_bar/overflow_menu/base":true});require.install("unified_view/action_bar/overflow_menu/profile",function(require,exports,module){var e=require,t=require("interface/settings").pageIsMobile,i=require("unified_view/action_bar/overflow_menu/base");if(!t){var n=e("webnode2"),o=n.ModalWithCallBacks,s=e("view/modal").Base;exports.CallbackModal=s.extend({onSubmit:function(){this._super.apply(this,arguments);n.Modal.modalFor(this).executeOnSubmitCallBack()}})}else{var r=e("mobile_app2/client")}exports.MuteUser=i.Toggleable.extend({onToggledOff:function(){var e=this;if(t){this.unmuteServerCall()}else{var i=new o(this,{});i.onSubmitCallBack(function(){e.unmuteServerCall()});i.load("load_unmute_modal")}},onToggledOn:function(){var e=this;if(t){this.muteServerCall()}else{var i=new o(this,{});i.onSubmitCallBack(function(){e.muteServerCall()});i.load("load_mute_modal")}},muteServerCall:function(){this.serverCall("mute_user").liveMutate().send()},unmuteServerCall:function(){this.serverCall("unmute_user").liveMutate().send()}});exports.BlockUser=i.Toggleable.extend({onToggledOff:function(){var e=this;if(t){this.unblockServerCall()}else{var i=new o(this,{});i.onSubmitCallBack(function(){e.unblockServerCall()});i.load("load_unblock_modal")}},onToggledOn:function(){var e=this;if(t){this.blockServerCall()}else{var i=new o(this,{});i.onSubmitCallBack(function(){e.blockServerCall()});i.load("load_block_modal")}},blockServerCall:function(){this.serverCall("block_user").liveMutate().send()},unblockServerCall:function(){this.serverCall("unblock_user").liveMutate().send()}})},{"interface/settings":true,"unified_view/action_bar/overflow_menu/base":true});require.install("unified_view/privacy",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/settings").pageIsMobile,i=require("unified_view/modal").ModalBase,n=require;if(!t){var o=n("webnode2"),s=o.ModalWithCallBacks}else{var r=n("mobile_app2/client")}exports.ToggleQuestionPrivacyJSMixin={loadConfirmationDialog:function(e){this.createModal("confirm_dialog_contents").kwargs({to_privacy:this.to_privacy,acted_inconsistent_qids:e.acted_inconsistent_qids}).onSubmit(this._setPrivacyUNSAFE.bind(this,{qid:this.qid,to_privacy:this.to_privacy,all_inconsistent_qids:e.all_inconsistent_qids})).show()},_setPrivacyUNSAFE:function(e){this.serverCall("set_privacy").kwargs(e).liveMutate().send()},trySetPrivacy:function(){var e=this;e.serverCall("try_set_privacy").kwargs({qid:e.qid,to_privacy:e.to_privacy}).success(function(i){if(t){i=i.value;if(!i){r.sendMessageToClient("reload")}}if(i&&"response"in i&&i.response=="privacy_change_needs_confirmation"){e.loadConfirmationDialog(i)}}).liveMutate().send();return false}};exports.ToggleQuestionPrivacyMixin=e.extend(exports.ToggleQuestionPrivacyJSMixin);exports.QuestionAnonLink=exports.ToggleQuestionPrivacyMixin.extend({onLoad:function(){var e=this;this.$id("@set_privacy").on("click",function(t){t.preventDefault();e.trySetPrivacy()})}})},{"interface/settings":true,"interface/component":true,"unified_view/modal":true});require.install("unified_view/action_bar/overflow_menu/question",function(require,exports,module){var e=require,t=require("unified_view/action_bar/overflow_menu/base"),i=require("unified_view/privacy"),n=require("w2.context");exports.PrivacyToggle=t.Toggleable.extend(i.ToggleQuestionPrivacyJSMixin).extend({onToggledOn:function(){this.trySetPrivacy()},onToggledOff:function(){this.trySetPrivacy()}});exports.EditMenu=t.Item.extend({contextConstructor:function(){return n.EditQuestionOverflow},onSelectAction:function(){this.getContext(n.EditQuestionOverflow).set("showMenu",true)}})},{"w2.context":true,"unified_view/action_bar/overflow_menu/base":true,"unified_view/privacy":true});require.install("unified_view/action_bar/overflow_menu/remove_from_feed",function(require,exports,module){var e=require("unified_view/action_bar/overflow_menu/base"),t=require("w2.context");exports.Item=e.WithServerCall.extend({onSelectAction:function(){this._super.apply(this,arguments);this.getContext(t.FeedStoryItem).set("hideItem",true)}});exports.DownvoteQuestion=e.WithServerCall.extend({onSelectAction:function(){this._super.apply(this,arguments);this.getContext(t.FeedStoryItem).set("showQuestionDownvoteFeedback",true)}})},{"w2.context":true,"unified_view/action_bar/overflow_menu/base":true});require.install("unified_view/action_bar/overflow_menu/shared",function(require,exports,module){var e=require,t=require("interface/settings").pageIsMobile,i=require("unified_view/action_bar/overflow_menu/base"),n=require("w2.context");if(t){var o=e("mobile_app2/client")}else{var s=e("view/inline_editor"),r=s.registerEditorCallback,a=s.unregisterEditorCallback,l=s.triggerEditorCallback,u=s.isInEditMode,d=e("app/view/common"),c=d.registerContentToggleCallback,h=d.unregisterContentToggleCallback,f=d.triggerContentToggleCallback}exports.AddModerationFlagWrapper=i.Item.extend({desktopOnLoad:function(){},onSelectAction:function(){o.sendMessageToClient("openURL",{target:"modal",url:this.url})}});exports.NativeShare=i.Item.extend({onSelectAction:function(){var e=this;o.showNativeShareSheet(this.share,this,function(t,i){switch(i){case 0:o.sendMessageToClient("openURL",t.quora_message_data);break;case 1:o.sendMessageToClient("openURL",t.share_to_blog_data);break;case 2:o.sendMessageToClient("shareCopyURL",t.copy_data);e.serverCall("share_log_copy_link").kwargs({data:t}).send();break}})}});exports.EditItemMobile=i.Item.extend({onSelectAction:function(){if(this.editor_kwargs.is_qtext2){this.createModal("load_editor_modal").kwargs({oid:this.oid}).onSubmit(function(e){if(e.value.next_url){o.sendMessageToClient("openURL",{url:e.value.next_url})}}).show()}else{this.invokeRichTextEditor(this.editor_kwargs)}}});exports.EditItemWeb=i.Item.extend({onLoad:function(){this._super();this.$labelElem=this.$id("@contents");this.bindEditorEvents();this.editorLoaded()},onUnload:function(){this.unbindEditorEvents()},bindEditorEvents:function(){r("cancel",this.content_type,this.oid,this.cid,this.setToggled.bind(this,false));r("submitted",this.content_type,this.oid,this.cid,this.setToggled.bind(this,false));r("load",this.content_type,this.oid,this.cid,this.editorLoaded.bind(this));r("edit",this.content_type,this.oid,this.cid,this.toggle.bind(this))},unbindEditorEvents:function(){a("cancel",this.content_type,this.oid,this.cid);a("submitted",this.content_type,this.oid,this.cid);a("edit",this.content_type,this.oid,this.cid)},onSelectAction:function(){var e=this.toggled?"cancel":"edit";l(e,this.content_type,this.oid)},editorLoaded:function(){this.setToggled(u(this.content_type,this.oid))},setToggled:function(e){this.toggled=e;this.updateLabel()},toggle:function(){this.setToggled(!this.toggled)},updateLabel:function(){var e=!this.toggled?this.label:this.alternate_label;this.$labelElem.text(e)}});exports.SuggestionsPendingItemWeb=exports.EditItemWeb.extend({bindEditorEvents:function(){c(this.content_type,this.oid,this.cid,this.toggle.bind(this));r("submit",this.content_type,this.oid,this.cid,this.toggle.bind(this))},unbindEditorEvents:function(){h(this.content_type,this.oid,this.cid);a("submit",this.content_type,this.oid,this.cid)},onSelectAction:function(){f(this.content_type,this.oid)}});exports.AddComment=i.Item.extend({onSelectAction:function(){this.invokeRichTextEditor(this.editor_kwargs)}});exports.RemoveFromFeed=i.Item.extend({onSelectAction:function(){this.getContext(n.FeedStoryItem).set("showRemoveFromFeedMenu",true)}})},{"interface/settings":true,"w2.context":true,"unified_view/action_bar/overflow_menu/base":true});require.install("unified_view/button/abstract",function(require,exports,module){var e=require("interface/component").Component,t=require,i=require("interface/settings"),n=require("interface/cookies");exports.Button=e.extend({keyCombination:null,onLoad:function(){var e=this;if(!e.disabled){var t=e.$id("@button");t.on("click",function(t){t.preventDefault();e.onClick()});if(e.keyCombination){e.onKeyCombination(t.get(),e.keyCombination,e.onClick.bind(e))}}},onClick:function(){this.onPressed()},onPressed:function(){var e=this;if(e.qfeed_log_press_action){n.setQfeedLog(e,e.qfeed_log_press_action)}this.serverCall("press").liveMutate().error(function(){e.switchState(false)}).send()}});exports.TwoStateButton=exports.Button.extend({onClick:function(){var e=this;e.dirtyURL();if(e.pressed){e.onUnpressed()}else{e.onPressed()}e.switchState(!this.pressed)},dirtyURL:function(){var e=this;if(i.pageIsMobile){if(e.url_to_dirty){var n=t("mobile_app2/client");n.sendMessageToClient("removeURLFromCache",{url:e.url_to_dirty})}}},switchState:function(e){if(this.pressed==e){return}if(!i.isLoggedIn){return}if(!i.pageIsMobile&&!this.optimistic_for_web){return}var t=this.$id("@button");var n=this.$id("@text");var o=n.text();n.text(this.optimistic_text);this.optimistic_text=o;if(this.optimistic_count){var s=this.$id("@count");if(this.optimistic_count==="0"){s.addClass("hidden")}else{s.removeClass("hidden")}var r=s.text();s.text(this.optimistic_count);this.optimistic_count=r}if(this.pressed){t.removeClass("pressed")}else{t.addClass("pressed")}this.pressed=e},onUnpressed:function(){var e=this;if(e.qfeed_log_unpress_action){n.setQfeedLog(e,e.qfeed_log_unpress_action)}this.serverCall("unpress").liveMutate().error(function(){e.switchState(true)}).send()}})},{"interface/cookies":true,"interface/settings":true,"interface/component":true});require.install("unified_view/button/downvote",function(require,exports,module){var e=require("unified_view/button/abstract").TwoStateButton,t=require("interface/cookies"),i=require("interface/settings"),n=require("w2.context").AnswerVoteContext,o=require("w2.context").FeedStoryItem;exports.Answer=e.extend({keyCombination:"d",onLoad:function(){var e=this;this._super.apply(this,arguments);this.answerVoteContext=this.getContext(n);this.feedStoryItemContext=this.getContext(o);if(!this.optimistic_for_web){return}this.answerVoteContext.on("voteState",function(t,i){if(i==="downvote"){e.switchState(true)}else{e.switchState(false);
}});if(this.answerVoteContext.get("voteState")==="no"){if(this.pressed){this.answerVoteContext.set("voteState","downvote")}}if(this.feedStoryItemContext!==null){var t=function(t,i){if(i===false){e.answerVoteContext.set("voteState","no")}};this.feedStoryItemContext.on("feedbackShown",t)}},onClick:function(){this.dirtyURL();if(this.pressed){this.onUnpressed();this.updateAnswerVoteState("no")}else{this.onPressed();this.updateAnswerVoteState("downvote")}},updateAnswerVoteState:function(e){if(this.optimistic_for_web){this.answerVoteContext.set("voteState",e)}else{this.switchState(!this.pressed)}},onPressed:function(){t.setQfeedLog(this,"AnswerDownvote");t.setTlog({type:"AnswerVoteDown",aid:this.aid});if(this.show_feedback&&this.feedStoryItemContext){this.feedStoryItemContext.set("showAnswerDownvoteFeedback",true)}this._super.apply(this,arguments)},onUnpressed:function(){if(!i.pageIsMobile){if(this.show_feedback&&this.feedStoryItemContext){this.feedStoryItemContext.set("showAnswerDownvoteFeedback",false)}}this._super.apply(this,arguments)}});exports.BlogPost=e.extend({keyCombination:"d",onPressed:function(){t.setTlog({type:"BoardItemVoteDown",board_item_id:this.biid});this._super.apply(this,arguments)}});exports.Question=e.extend({keyCombination:"d",onLoad:function(){this.feedStoryItemContext=this.getContext(o);this._super.apply(this,arguments)},onPressed:function(){t.setQfeedLog(this,"QuestionDownvote");t.setTlog({type:"QuestionDownvote",qid:this.qid});if(this.show_feedback&&this.feedStoryItemContext){this.feedStoryItemContext.set("showQuestionDownvoteFeedback",true)}this._super.apply(this,arguments)},onUnpressed:function(){this._super.apply(this,arguments)}})},{"interface/cookies":true,"interface/settings":true,"w2.context":true,"unified_view/button/abstract":true});require.install("unified_view/button/follow",function(require,exports,module){var e=require("unified_view/button/abstract").TwoStateButton,t=require("interface/cookies"),i=require("interface/settings").pageIsMobile,n=require;if(i){var o=n("mobile_app2/client")}exports.Topic=e.extend({onPressed:function(){t.setTlog({type:"TopicFollow",tid:this.tid});t.setQfeedLog(this,"TopicFollow");this._super.apply(this,arguments)},onUnpressed:function(){t.setTlog({type:"TopicUnfollow",tid:this.tid});t.setQfeedLog(this,"TopicUnfollow");this._super.apply(this,arguments)}});exports.Question=e.extend({keyCombination:"w",onLoad:function(){var e=this;e._super.apply(this,arguments);if(i){e.followBroadcastKey=o.getBroadcastKey("question",this.qid,"following");o.registerMessageHandler(e.followBroadcastKey,function(t){e.switchState(t.state==="yes")})}},onPressed:function(){t.setTlog({type:"QuestionFollow",qid:this.qid});if(i){o.broadcastKeyUpdate(this.followBroadcastKey,"yes")}this._super.apply(this,arguments)},onUnpressed:function(){t.setTlog({type:"QuestionUnfollow",qid:this.qid});if(i){o.broadcastKeyUpdate(this.followBroadcastKey,"no")}this._super.apply(this,arguments)}});exports.User=e.extend({keyCombination:"f",onPressed:function(){t.setTlog({type:"UserFollow",uid:this.uid});t.setQfeedLog(this,"UserFollow");this._super.apply(this,arguments)},onUnpressed:function(){t.setTlog({type:"UserUnfollow",uid:this.uid});t.setQfeedLog(this,"UserUnfollow");this._super.apply(this,arguments)}});exports.Blog=e.extend({onPressed:function(){t.setTlog({type:"BoardFollow",bid:this.bid});this._super.apply(this,arguments)}})},{"interface/cookies":true,"interface/settings":true,"unified_view/button/abstract":true});require.install("unified_view/button/pin",function(require,exports,module){var e=require("unified_view/button/abstract").TwoStateButton,t=require("interface/cookies");exports.Topic=e.extend({onPressed:function(){t.setTlog({type:"PinFollow",oid:this.oid});t.setQfeedLog(this,"PinFollow");this._super.apply(this,arguments)},onUnpressed:function(){t.setTlog({type:"PinFollow",oid:this.oid});t.setQfeedLog(this,"PinUnfollow");this._super.apply(this,arguments)}})},{"interface/cookies":true,"unified_view/button/abstract":true});require.install("unified_view/button/reask",function(require,exports,module){var e=require("unified_view/button/abstract").TwoStateButton,t=require("interface/cookies"),i=require("interface/settings").pageIsMobile,n=require;if(i){var o=n("mobile_app2/client")}exports.ReAsk=e.extend({onLoad:function(){this._super.apply(this,arguments);if(i){this.followBroadcastKey=o.getBroadcastKey("question",this.qid,"following");this.reaskBroadcastKey=o.getBroadcastKey("question",this.qid,"reasked")}},onPressed:function(){t.setTlog({type:"ReAsk",qid:this.qid});t.setQfeedLog(this,"ReAsk");if(i){o.broadcastKeyUpdate(this.followBroadcastKey,"yes");o.broadcastKeyUpdate(this.reaskBroadcastKey,"yes")}this._super.apply(this,arguments)},onUnpressed:function(){t.setTlog({type:"ReAsk",qid:this.qid});t.setQfeedLog(this,"ReAsk");if(i){o.broadcastKeyUpdate(this.reaskBroadcastKey,"no")}this._super.apply(this,arguments)}})},{"interface/cookies":true,"interface/settings":true,"unified_view/button/abstract":true});require.install("unified_view/button/slow_connection",function(require,exports,module){var e=require("unified_view/button/abstract").Button,t=require,i=require("interface/settings").pageIsMobile;if(i){var n=t("mobile_app2/client")}exports.SlowConnectionButton=e.extend({onPressed:function(){this.serverCall("press").success(function(){if(i){n.sendMessageToClient("reload")}}).send()}})},{"interface/settings":true,"unified_view/button/abstract":true});require.install("unified_view/button/network",function(require,exports,module){var e=require,t=require("unified_view/button/abstract").Button,i=require("interface/settings").pageIsMobile;if(i){var n=e("mobile_app2/client")}exports.ActivationButton=t.extend({onPressed:function(){this.serverCall("press").success(function(){if(i){n.sendMessageToClient("openURL",{url:"/"})}else{document.location="/"}}).liveMutate().send()}})},{"interface/settings":true,"unified_view/button/abstract":true});require.install("unified_view/button/upvote",function(require,exports,module){var e=require("unified_view/button/abstract").TwoStateButton,t=require("interface/cookies"),i=require("w2.context").AnswerVoteContext;exports.Answer=e.extend({keyCombination:"u",onLoad:function(){var e=this;this._super.apply(this,arguments);this.answerVoteContext=this.getContext(i);if(!this.optimistic_for_web){return}this.answerVoteContext.on("voteState",function(t,i){if(i==="upvote"){e.switchState(true)}else{e.switchState(false)}});if(this.answerVoteContext.get("voteState")==="no"){if(this.pressed){this.answerVoteContext.set("voteState","upvote")}}},onClick:function(){this.dirtyURL();if(this.pressed){this.onUnpressed();this.updateAnswerVoteState("no")}else{this.onPressed();this.updateAnswerVoteState("upvote")}},updateAnswerVoteState:function(e){if(this.optimistic_for_web){this.answerVoteContext.set("voteState",e)}else{this.switchState(!this.pressed)}},onPressed:function(){t.setQfeedLog(this,"AnswerUpvote");t.setTlog({type:"AnswerVoteUp",aid:this.aid});this._super.apply(this,arguments)}});exports.BlogPost=e.extend({keyCombination:"u",onPressed:function(){t.setQfeedLog(this,"BoardItemUpvote");t.setTlog({type:"BoardItemUpvote",board_item_id:this.biid});this._super.apply(this,arguments)}})},{"interface/cookies":true,"w2.context":true,"unified_view/button/abstract":true});require.install("unified_view/button/write_answer",function(require,exports,module){var e=require("unified_view/button/abstract").Button,t=require("w2.context");exports.WriteAnswer=e.extend({keyCombination:"a",onClick:function(){this.getContext(t.ActionBar).set("toggleEditor",true)}})},{"w2.context":true,"unified_view/button/abstract":true});require.install("unified_view/button/writing_list",function(require,exports,module){var e=require("unified_view/button/abstract").TwoStateButton,t=require("interface/cookies");exports.WritingList=e.extend({onPressed:function(){t.setTlog({type:"QuestionAnswerLater",oid:this.oid});t.setQfeedLog(this,"QuestionAnswerLater");this._super.apply(this,arguments)},onUnpressed:function(){t.setTlog({type:"UnmarkQuestionAnswerLater",oid:this.oid});t.setQfeedLog(this,"UnmarkQuestionAnswerLater");this._super.apply(this,arguments)}})},{"interface/cookies":true,"unified_view/button/abstract":true});require.install("unified_view/lazy",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/rpc").rpc,i=require("core/component").parseVcon;exports.LazyComponent=e.extend({onLoad:function(){var e=this;var n=e.$id("@wrapper").get()[0];if(n){t("/api/rerender_component_POST").contentFor(n,{parentCID:e.parent().cid}).kwargs({serialized_component:e.serialized_component,vcon:i(e)}).send({batched:true})}}})},{"interface/rpc":true,"interface/component":true,"core/component":true});require.install("unified_view/network/invite",function(require,exports,module){var e=require("interface/component").Component;exports.InviteForm=e.extend({onLoad:function(){var e=this;e.$id("@input").on("keydown",function(t){if(t.keyCode==13){e.sendInvite()}});e.$id("@submit").on("click",function(){e.sendInvite()})},sendInvite:function(){var e=this;var t=e.$id("@input").val();e.serverCall("invite").kwargs({email:t}).success(function(){e.$id("@input").val("").focus()}).send()}})},{"interface/component":true});require.install("unified_view/network/join",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/settings").pageIsMobile,i=require;if(t){var n=i("mobile_app2/client")}exports.PublicRequestForm=e.extend({onLoad:function(){var e=this;e.$id("@input").on("keydown",function(t){if(t.keyCode==13){e.sendRequest()}});e.$id("@submit").on("click",function(){e.sendRequest()})},sendRequest:function(){var e=this;var i=e.$id("@input").val();e.serverCall("request").kwargs({email:i}).success(function(){if(t){n.sendMessageToClient("reload")}else{e.$id("@input").val("").focus()}}).liveMutate().send()}})},{"interface/settings":true,"interface/component":true});require.install("unified_view/payment/money",function(require,exports,module){var e=require("interface/component").Component;exports.MoneyAmountInput=e.extend({onLoad:function(){var e=this;e.$amount=e.$id("@amount");e.$amount.on("keydown paste change",function(t){setTimeout(function(){e._filter()},1)});e.$amount.on("blur",function(t){e._filter(true)})},getValueInCents:function(){var e=this._cleanVal(true)[1];if(e.indexOf(".")===-1){e+="00"}else{e=e.replace(".","")}return parseInt(e)},_filter:function(e){var t=this._cleanVal(e),i=t[0],n=t[1],o=t[2];if(i!==n){var s=this.$amount.get()[0],r=s.selectionStart+o,a=s.selectionEnd+o;this.$amount.val(n);s.setSelectionRange(r,a)}},_cleanVal:function(e){var t=this.$amount.val(),i="",n=0,o=0,s=0;for(var r=0;r<t.length;r++){var a=t.charAt(r);if(this.allowCents&&a==="."){if(o===0){if(n===0){i+="0";n++;s++}i+=a;o++}}else if(!isNaN(a)){if(o>0){if(o!==3){i+=a;o++}}else{if(n<this.maxDollarNumbers){i+=a;n++}}}}if(e){while(o!==0&&o<3){i+="0";o++}}var l=i.length;i=i.replace(/^0+(?=\d)/,"");var u=l-i.length;if(u>0){n-=u;s-=u}return[t,i,s]}})},{"interface/component":true});require.install("unified_view/payment/_payment",function(require,exports,module){var e=require("interface/component").Component;exports.PaymentMethod=e;exports.AddCardForm=e.extend({onLoad:function(){var e=this;e.$name=e.$id("@name");e.$number=e.$id("@number");e.$expiry=e.$id("@expiry");e.$cvc=e.$id("@cvc");e.$zip=e.$id("@zip");e.$date_of_birth=e.$id("@date_of_birth");e.cardType=null;e.isSubmitting=false;e._inputClean(e.$number,function(t){var i=Stripe.card.cardType(t);switch(i){case"Unknown":i=null;break;case"American Express":i="amex";break;case"Diners Club":i="diners";break;default:i=i.toLowerCase().replace(/\s+/g,"")}e._setCardType(i);var n=t.replace(/[^0-9]/g,"");if(i==="amex"){n=(n.slice(0,4)+" "+n.slice(4,10)+" "+n.slice(10,n.length)).trim()}else{n=(n.slice(0,4)+" "+n.slice(4,8)+" "+n.slice(8,12)+" "+n.slice(12,n.length)).trim()}return n});e._inputClean(e.$expiry,function(e){var t=e.replace(/[^0-9]/g,"");if(e.slice(2,e.length)===" /"){return t[0]}if(t.length===1){if(t[0]!=="0"&&t[0]!=="1"||e.length===2&&t[0]==="1"&&(e[1]===" "||isNaN(e[1]))){t="0"+t}}if(t.length>1){t=t.slice(0,2)+" / "+t.slice(2,t.length)}return t});if(e.$cvc){e._inputClean(e.$cvc,function(e){return e.replace(/[^0-9]/g,"")})}if(e.$date_of_birth){e._inputClean(e.$date_of_birth,function(e){var t=e.replace(/[^0-9]/g,"");if(e.slice(-2)===" /"){t=t.slice(0,t.length-1)}var i=t.slice(0,2);var n=parseInt(i,10);if(n>12||i.length<2&&n>1){t="0"+t}var o=t.slice(2,4);var s=parseInt(o,10);if(s>31||o.length<2&&s>3){t=t.slice(0,2)+"0"+t.slice(2,t.length)}var r=t.slice(4,6);if(r.length==2&&r!="19"&&r!="20"){var a="19";if(parseInt(r,10)<16){a="20"}t=t.slice(0,4)+a+t.slice(4,t.length)}var l=t.slice(0,2);if(t.length>=2){l+=" / "+t.slice(2,4)}if(t.length>=4){l+=" / "+t.slice(4,t.length)}return l})}e.focus()},focus:function(){this.$number.focus()},getExpiryMonth:function(){return this.$expiry.val().replace(/[^0-9]/g,"").slice(0,2)},getExpiryYear:function(){var e=this.$expiry.val();return e.replace(/[^0-9]/g,"").slice(2,e.length)},getBirthYear:function(){var e=this.$date_of_birth.val();return e.replace(/[^0-9]/g,"").slice(4,e.length)},getBirthMonth:function(){return this.$date_of_birth.val().replace(/[^0-9]/g,"").slice(0,2)},getBirthDay:function(){return this.$date_of_birth.val().replace(/[^0-9]/g,"").slice(2,4)},isValid:function(){if(this.debit_only){return this.getBirthYear()&&this.getBirthMonth()&&this.getBirthDay()}return true},submit:function(e){var t=this;if(!t.isSubmitting&&t.isValid()){t.isSubmitting=true;t._getStripeToken(function(i,n){if(n.error){t.isSubmitting=false;alert(n.error.message)}else{var o={stripe_response:n};if(t.debit_only){o.birth_year=t.getBirthYear();o.birth_month=t.getBirthMonth();o.birth_day=t.getBirthDay()}t.serverCall("submit").kwargs(o).success(function(){t.isSubmitting=false;e()}).error(function(){t.isSubmitting=false}).liveMutate().send()}})}},_getStripeToken:function(e){var t=this;function i(i,n){if(!n.error&&t.debit_only&&n.card.funding!=="debit"){e(i,{error:{message:t.debit_only_error_text}})}else{e(i,n)}}Stripe.card.createToken({name:this.$name.val(),number:this.$number.val(),exp_month:this.getExpiryMonth(),exp_year:this.getExpiryYear(),cvc:!this.debit_only?this.$cvc.val():undefined,address_zip:!this.debit_only?this.$zip.val():undefined,currency:"usd"},i)},_inputClean:function(e,t){if(e){e.on("keydown paste change",function(i){setTimeout(function(){var i=e.val(),n=t(i);if(i!==n){e.val(n)}},1)})}},_setCardType:function(e){if(this.cardType===e){return}if(this.cardType){this.$number.removeClass(this.cardType)}this.cardType=e;if(this.cardType){this.$number.addClass(this.cardType)}if(this.cardType==="amex"){this.$number.attr("maxlength","17")}else{this.$number.attr("maxlength","19")}}})},{"interface/component":true});require.install("unified_view/settings/privacy",function(require,exports,module){var e=require,t=require("interface/component").Component,i=require("interface/settings").pageIsMobile;if(!i){var n=e("webnode2"),o=n.ModalWithCallBacks}else{var s=e("mobile_app2/app/view/common"),r=e("mobile_app2/client"),a=e("settings").interface_strings}var l=t.extend({onLoad:function(e){if(i){this.mobileOnLoad()}else{this.desktopOnLoad(e)}},desktopOnLoad:function(){var e=this;this.$id("@check_reauth").on("click",function(t){e.serverCall("check_reauth").success(function(){e.showControl()}).send();t.preventDefault()})},showControl:function(){this.$id("@check_reauth").addClass("hidden");this.$id("@option_control").removeClass("hidden")},showAlert:function(e){var t=this;s.showAlert({title:t.dialog_title,message:t.dialog_message,callback:function(t){if(t.buttonIndex===0&&e){e()}},cancelButtonTitle:t.dialog_button_title,otherButtonTitles:[a.cancel]})}});exports.DeactivateAccountCell=l.extend({desktopOnLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@deactivate").on("click",function(){var t=new o(e,{});t.onSubmitCallBack(function(){e.deactivateAccount()});t.load("load_deactivate_account_modal")})},mobileOnLoad:function(){var e=this;this.$id("@deactivate").on("click",function(){e.showAlert(e.deactivateAccount.bind(e))})},deactivateAccount:function(){this.serverCall("deactivate_account").success(function(){if(i){r.sendMessageToClient("loginStateChanged",{isLoggedIn:false})}}).send()}});exports.DeleteAccountCell=l.extend({desktopOnLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@delete").on("click",function(){var t=new o(e,{});t.onSubmitCallBack(function(){e.deleteAccount()});t.load("load_delete_account_modal")})},mobileOnLoad:function(){var e=this;this.$id("@delete").on("click",function(){e.showAlert(e.deleteAccount.bind(e))})},deleteAccount:function(){this.serverCall("delete_account").success(function(){if(i){r.sendMessageToClient("loginStateChanged",{isLoggedIn:false})}}).send()}})},{"interface/settings":true,"interface/component":true});require.install("unified_view/switch",function(require,exports,module){var e=require("interface/component").Component;exports.Switch=e.extend({onLoad:function(){var e=this,t=e.$id("@switch");t.on("click",function(){if(t.hasClass("on")){e.serverCall("off").kwargs(e.kwargs).liveMutate().error(function(){t.removeClass("on").addClass("off")}).send()}else{e.serverCall("on").kwargs(e.kwargs).liveMutate().error(function(){t.addClass("on").removeClass("off")}).send()}t.toggleClass("on").toggleClass("off")})}})},{"interface/component":true});require.install("unified_view/mobile_debug",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/cookies"),i=require("keystrokes"),n,o;var s=e.extend({toggle:function(){var e=this;if(e.has_cookie){t.setCookie(e.cookie_key,null)}else{t.setCookie(e.cookie_key,1)}window.location.reload()}});exports.ToggleMobileButton=s.extend({onLoad:function(){var e=this;n=e;e.$id("@toggle").on("click",function(t){e.toggle();t.preventDefault();t.stopPropagation();return false})}});exports.ToggleTabletButton=s.extend({onLoad:function(){var e=this;o=e;e.$id("@toggle").on("click",function(t){e.toggle();t.preventDefault();t.stopPropagation();return false})}});i.on([77,48,77,48],function(){if(n){n.toggle()}});i.on([84,48,84,48],function(){if(o){o.toggle()}})},{"interface/cookies":true,"interface/component":true,keystrokes:true});require.install("unified_view/translation",function(require,exports,module){var e=require("interface/component").Component;exports.TranslationInterfaceToggle=e.extend({onLoad:function(){this._state=false;this.setupKeyboardShortcut()},toggle:function(){var e=this;var t;var i=document.getElementsByClassName("translation_interface_info");if(!e._state){e._state=true;for(t=0;t<i.length;t++){i[t].style.display="block"}}else{e._state=false;for(t=0;t<i.length;t++){i[t].style.display="none"}}},setupKeyboardShortcut:function(){require("keystrokes").on([76,73,68,76,73,68],this.fnbind(this.toggle))}})},{"interface/component":true,keystrokes:true});require.install("qtext2/util",function(require,exports,module){var e=["keydown","keyup","keypress"],t=/^https?\:\/\//;var i={assert:function(e){if(!e){var t=Array.prototype.slice.call(arguments,1);throw new Error(t)}},create:function(e){return document.createElement(e)},extend:function(e,t){if(!t){return e}for(var i in t){if(t.hasOwnProperty(i)){e[i]=t[i]}}return e},getData:function(e,t){return e.getAttribute("data-"+t)},setData:function(e,t,i){e.setAttribute("data-"+t,i)},removeData:function(e,t){e.removeAttribute("data-"+t)},isTextNode:function(e){return e.nodeType==3},on:function(t,i,n){i.addEventListener(t,function(i){var o;if(e.indexOf(t)!=-1){i.which=i.charCode!==undefined?i.charCode:i.keyCode}o=n(i);if(o===false){i.preventDefault();i.stopPropagation()}return o})},ensureProtocol:function(e){if(!t.test(e)){e="http://"+e}return e},splitLines:function(e){return e.split(/\n|\r\n?/)},splitByRegex:function(e,t){var i,n=[];while(e){i=e.match(t);if(i){if(i.index){n.push({text:e.slice(0,i.index)})}n.push({text:i[0],match:i});e=e.slice(i.index+i[0].length)}else{n.push({text:e});e=""}}return n},jsonEqual:function(e,t){var n,o;if(e===t){return true}if(typeof e!="object"||typeof t!="object"){return e===t}if(e===null||e===undefined||t===null||t===undefined){return false}if(typeof e!==typeof t){return false}if(e instanceof Array){if(e.length!==t.length){return false}for(var s=0;s<e.length;s++){if(!i.jsonEqual(e[s],t[s])){return false}}return true}n=Object.getOwnPropertyNames(e);o=Object.getOwnPropertyNames(t);if(n.length!=o.length){return false}return n.every(function(n){return i.jsonEqual(e[n],t[n])})}};exports.Util=i},{});require.install("third_party/rangy-core",function(require,exports,module){window["rangy"]=function(){var e="object",t="function",i="undefined";var n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var r=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function a(i,n){var o=typeof i[n];return o==t||!!(o==e&&i[n])||o=="unknown"}function l(t,i){return!!(typeof t[i]==e&&t[i])}function u(e,t){return typeof e[t]!=i}function d(e){return function(t,i){var n=i.length;while(n--){if(!e(t,i[n])){return false}}return true}}var c=d(a);var h=d(l);var f=d(u);function p(e){return e&&c(e,r)&&f(e,s)}var g={version:"1.2.3",initialized:false,supported:true,util:{isHostMethod:a,isHostObject:l,isHostProperty:u,areHostMethods:c,areHostObjects:h,areHostProperties:f,isTextRange:p},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function _(e){window.alert("Rangy not supported in your browser. Reason: "+e);g.initialized=true;g.supported=false}g.fail=_;function m(e){var t="Rangy warning: "+e;if(g.config.alertOnWarn){window.alert(t)}else if(typeof window.console!=i&&typeof window.console.log!=i){window.console.log(t)}}g.warn=m;if({}.hasOwnProperty){g.util.extend=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){e[i]=t[i]}}}}else{_("hasOwnProperty not supported")}var v=[];var w=[];function b(){if(g.initialized){return}var e;var t=false,i=false;if(a(document,"createRange")){e=document.createRange();if(c(e,o)&&f(e,n)){t=true}e.detach()}var s=l(document,"body")?document.body:document.getElementsByTagName("body")[0];if(s&&a(s,"createTextRange")){e=s.createTextRange();if(p(e)){i=true}}if(!t&&!i){_("Neither Range nor TextRange are implemented")}g.initialized=true;g.features={implementsDomRange:t,implementsTextRange:i};var r=w.concat(v);for(var u=0,d=r.length;u<d;++u){try{r[u](g)}catch(h){if(l(window,"console")&&a(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",h)}}}}g.init=b;g.addInitListener=function(e){if(g.initialized){e(g)}else{v.push(e)}};var k=[];g.addCreateMissingNativeApiListener=function(e){k.push(e)};function C(e){e=e||window;b();for(var t=0,i=k.length;t<i;++t){k[t](e)}}g.createMissingNativeApi=C;function y(e){this.name=e;this.initialized=false;this.supported=false}y.prototype.fail=function(e){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+e)};y.prototype.warn=function(e){g.warn("Module "+this.name+": "+e)};y.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)};g.createModule=function(e,t){var module=new y(e);g.modules[e]=module;w.push(function(e){t(e,module);module.initialized=true;module.supported=true})};g.requireModules=function(e){for(var t=0,i=e.length,module,n;t<i;++t){n=e[t];module=g.modules[n];if(!module||!(module instanceof y)){throw new Error("Module '"+n+"' not found")}if(!module.supported){throw new Error("Module '"+n+"' not supported")}}};var x=false;var S=function(e){if(!x){x=true;if(!g.initialized){b()}}};if(typeof window==i){_("No window found");return}if(typeof document==i){_("No document found");return}if(a(document,"addEventListener")){document.addEventListener("DOMContentLoaded",S,false)}if(a(window,"addEventListener")){window.addEventListener("load",S,false)}else if(a(window,"attachEvent")){window.attachEvent("onload",S)}else{_("Window does not have required addEventListener or attachEvent method")}return g}();rangy.createModule("DomUtil",function(e,module){var t="undefined";var i=e.util;if(!i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){module.fail("document missing a Node creation method")}if(!i.isHostMethod(document,"getElementsByTagName")){module.fail("document missing getElementsByTagName method")}var n=document.createElement("div");if(!i.areHostMethods(n,["insertBefore","appendChild","cloneNode"]||!i.areHostObjects(n,["previousSibling","nextSibling","childNodes","parentNode"]))){module.fail("Incomplete Element implementation")}if(!i.isHostProperty(n,"innerHTML")){module.fail("Element is missing innerHTML property")}var o=document.createTextNode("test");if(!i.areHostMethods(o,["splitText","deleteData","insertData","appendData","cloneNode"]||!i.areHostObjects(n,["previousSibling","nextSibling","childNodes","parentNode"])||!i.areHostProperties(o,["data"]))){module.fail("Incomplete Text Node implementation")}var s=function(e,t){var i=e.length;while(i--){if(e[i]===t){return true}}return false};function r(e){var i;return typeof e.namespaceURI==t||((i=e.namespaceURI)===null||i=="http://www.w3.org/1999/xhtml")}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function l(e){var t=0;while(e=e.previousSibling){t++}return t}function u(e){var t;return f(e)?e.length:(t=e.childNodes)?t.length:0}function d(e,t){var i=[],n;for(n=e;n;n=n.parentNode){i.push(n)}for(n=t;n;n=n.parentNode){if(s(i,n)){return n}}return null}function c(e,t,i){var n=i?t:t.parentNode;while(n){if(n===e){return true}else{n=n.parentNode}}return false}function h(e,t,i){var n,o=i?e:e.parentNode;while(o){n=o.parentNode;if(n===t){return o}o=n}return null}function f(e){var t=e.nodeType;return t==3||t==4||t==8}function p(e,t){var i=t.nextSibling,n=t.parentNode;if(i){n.insertBefore(e,i)}else{n.appendChild(e)}return e}function g(e,t){var i=e.cloneNode(false);i.deleteData(0,t);e.deleteData(t,e.length-t);p(i,e);return i}function _(e){if(e.nodeType==9){return e}else if(typeof e.ownerDocument!=t){return e.ownerDocument}else if(typeof e.document!=t){return e.document}else if(e.parentNode){return _(e.parentNode)}else{throw new Error("getDocument: no document found for node")}}function m(e){var i=_(e);if(typeof i.defaultView!=t){return i.defaultView}else if(typeof i.parentWindow!=t){return i.parentWindow}else{throw new Error("Cannot get a window object for node")}}function v(e){if(typeof e.contentDocument!=t){return e.contentDocument}else if(typeof e.contentWindow!=t){return e.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}function w(e){if(typeof e.contentWindow!=t){return e.contentWindow}else if(typeof e.contentDocument!=t){return e.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}function b(e){return i.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function k(e){var t;while(t=e.parentNode){e=t}return e}function C(e,t,i,n){var o,s,r,a,u;if(e==i){return t===n?0:t<n?-1:1}else if(o=h(i,e,true)){return t<=l(o)?-1:1}else if(o=h(e,i,true)){return l(o)<n?-1:1}else{s=d(e,i);r=e===s?s:h(e,s,true);a=i===s?s:h(i,s,true);if(r===a){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{u=s.firstChild;while(u){if(u===r){return-1}else if(u===a){return 1}u=u.nextSibling}throw new Error("Should not be here!")}}}function y(e){var t=_(e).createDocumentFragment(),i;while(i=e.firstChild){t.appendChild(i)}return t}function x(e){if(!e){return"[No node]"}if(f(e)){return'"'+e.data+'"'}else if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}else{return e.nodeName}}function S(e){this.root=e;this._next=e}S.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;var t,i;if(this._current){t=e.firstChild;if(t){this._next=t}else{i=null;while(e!==this.root&&!(i=e.nextSibling)){e=e.parentNode}this._next=i}}return this._current},detach:function(){this._current=this._next=this.root=null}};function T(e){return new S(e)}function L(e,t){this.node=e;this.offset=t}L.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"}};function q(e){this.code=this[e];this.codeName=e;this.message="DOMException: "+this.codeName}q.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};q.prototype.toString=function(){return this.message};e.dom={arrayContains:s,isHtmlNamespace:r,parentElement:a,getNodeIndex:l,getNodeLength:u,getCommonAncestor:d,isAncestorOf:c,getClosestAncestorIn:h,isCharacterDataNode:f,insertAfter:p,splitDataNode:g,getDocument:_,getWindow:m,getIframeWindow:w,getIframeDocument:v,getBody:b,getRootContainer:k,comparePoints:C,inspectNode:x,fragmentFromNodeChildren:y,createIterator:T,DomPosition:L};e.DOMException=q});rangy.createModule("DomRange",function(e,module){e.requireModules(["DomUtil"]);var t=e.dom;var i=t.DomPosition;var n=e.DOMException;function o(e,i){return e.nodeType!=3&&(t.isAncestorOf(e,i.startContainer,true)||t.isAncestorOf(e,i.endContainer,true))}function s(e){return t.getDocument(e.startContainer)}function r(e,t,i){var n=e._listeners[t];if(n){for(var o=0,s=n.length;o<s;++o){n[o].call(e,{target:e,args:i})}}}function a(e){return new i(e.parentNode,t.getNodeIndex(e))}function l(e){return new i(e.parentNode,t.getNodeIndex(e)+1)}function u(e,i,n){var o=e.nodeType==11?e.firstChild:e;if(t.isCharacterDataNode(i)){if(n==i.length){t.insertAfter(e,i)}else{i.parentNode.insertBefore(e,n==0?i:t.splitDataNode(i,n))}}else if(n>=i.childNodes.length){i.appendChild(e)}else{i.insertBefore(e,i.childNodes[n])}return o}function d(e){var t;for(var i,o=s(e.range).createDocumentFragment(),r;i=e.next();){t=e.isPartiallySelectedSubtree();i=i.cloneNode(!t);if(t){r=e.getSubtreeIterator();i.appendChild(d(r));r.detach(true)}if(i.nodeType==10){throw new n("HIERARCHY_REQUEST_ERR")}o.appendChild(i)}return o}function c(e,i,n){var o,s;n=n||{stop:false};for(var r,a;r=e.next();){if(e.isPartiallySelectedSubtree()){if(i(r)===false){n.stop=true;return}else{a=e.getSubtreeIterator();c(a,i,n);a.detach(true);if(n.stop){return}}}else{o=t.createIterator(r);while(s=o.next()){if(i(s)===false){n.stop=true;return}}}}}function h(e){var t;while(e.next()){if(e.isPartiallySelectedSubtree()){t=e.getSubtreeIterator();h(t);t.detach(true)}else{e.remove()}}}function f(e){for(var t,i=s(e.range).createDocumentFragment(),o;t=e.next();){if(e.isPartiallySelectedSubtree()){t=t.cloneNode(false);o=e.getSubtreeIterator();t.appendChild(f(o));o.detach(true)}else{e.remove()}if(t.nodeType==10){throw new n("HIERARCHY_REQUEST_ERR")}i.appendChild(t)}return i}function p(e,t,i){var n=!!(t&&t.length),o;var s=!!i;if(n){o=new RegExp("^("+t.join("|")+")$")}var r=[];c(new _(e,false),function(e){if((!n||o.test(e.nodeType))&&(!s||i(e))){r.push(e)}});return r}function g(e){var i=typeof e.getName=="undefined"?"Range":e.getName();return"["+i+"("+t.inspectNode(e.startContainer)+":"+e.startOffset+", "+t.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function _(e,i){this.range=e;this.clonePartiallySelectedTextNodes=i;if(!e.collapsed){
this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var n=e.commonAncestorContainer;if(this.sc===this.ec&&t.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===n&&!t.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:t.getClosestAncestorIn(this.sc,n,true);this._last=this.ec===n&&!t.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:t.getClosestAncestorIn(this.ec,n,true)}}}_.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;if(e){this._next=e!==this._last?e.nextSibling:null;if(t.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var e=this._current,i,n;if(t.isCharacterDataNode(e)&&(e===this.sc||e===this.ec)){i=e===this.sc?this.so:0;n=e===this.ec?this.eo:e.length;if(i!=n){e.deleteData(i,n-i)}}else{if(e.parentNode){e.parentNode.removeChild(e)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return o(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode){e=this.range.cloneRange();e.collapse()}else{e=new le(s(this.range));var i=this._current;var n=i,o=0,r=i,a=t.getNodeLength(i);if(t.isAncestorOf(i,this.sc,true)){n=this.sc;o=this.so}if(t.isAncestorOf(i,this.ec,true)){r=this.ec;a=this.eo}re(e,n,o,r,a)}return new _(e,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function m(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}m.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};m.prototype.toString=function(){return this.message};function v(e,t,i){this.nodes=p(e,t,i);this._next=this.nodes[0];this._position=0}v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var w=[1,3,4,5,7,8,10];var b=[2,9,11];var k=[5,6,10,12];var C=[1,3,4,5,7,8,10,11];var y=[1,3,4,5,7,8];function x(e){return function(i,n){var o,s=n?i:i.parentNode;while(s){o=s.nodeType;if(t.arrayContains(e,o)){return s}s=s.parentNode}return null}}var S=t.getRootContainer;var T=x([9,11]);var L=x(k);var q=x([6,10,12]);function E(e,t){if(q(e,t)){throw new m("INVALID_NODE_TYPE_ERR")}}function I(e){if(!e.startContainer){throw new n("INVALID_STATE_ERR")}}function M(e,i){if(!t.arrayContains(i,e.nodeType)){throw new m("INVALID_NODE_TYPE_ERR")}}function A(e,i){if(i<0||i>(t.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new n("INDEX_SIZE_ERR")}}function D(e,t){if(T(e,true)!==T(t,true)){throw new n("WRONG_DOCUMENT_ERR")}}function N(e){if(L(e,true)){throw new n("NO_MODIFICATION_ALLOWED_ERR")}}function O(e,t){if(!e){throw new n(t)}}function F(e){return!t.arrayContains(b,e.nodeType)&&!T(e,true)}function R(e,i){return i<=(t.isCharacterDataNode(e)?e.length:e.childNodes.length)}function P(e){return!!e.startContainer&&!!e.endContainer&&!F(e.startContainer)&&!F(e.endContainer)&&R(e.startContainer,e.startOffset)&&R(e.endContainer,e.endOffset)}function B(e){I(e);if(!P(e)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var H=document.createElement("style");var U=false;try{H.innerHTML="<b>x</b>";U=H.firstChild.nodeType==3}catch(Q){}e.features.htmlParsingConforms=U;var j=U?function(e){var i=this.startContainer;var o=t.getDocument(i);if(!i){throw new n("INVALID_STATE_ERR")}var s=null;if(i.nodeType==1){s=i}else if(t.isCharacterDataNode(i)){s=t.parentElement(i)}if(s===null||s.nodeName=="HTML"&&t.isHtmlNamespace(t.getDocument(s).documentElement)&&t.isHtmlNamespace(s)){s=o.createElement("body")}else{s=s.cloneNode(false)}s.innerHTML=e;return t.fragmentFromNodeChildren(s)}:function(e){I(this);var i=s(this);var n=i.createElement("body");n.innerHTML=e;return t.fragmentFromNodeChildren(n)};var W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var V=0,z=1,K=2,G=3;var J=0,Y=1,X=2,Z=3;function ee(){}ee.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,i){B(this);D(this.startContainer,i.startContainer);var n,o,s,r;var a=e==G||e==V?"start":"end";var l=e==z||e==V?"start":"end";n=this[a+"Container"];o=this[a+"Offset"];s=i[l+"Container"];r=i[l+"Offset"];return t.comparePoints(n,o,s,r)},insertNode:function(e){B(this);M(e,C);N(this.startContainer);if(t.isAncestorOf(e,this.startContainer,true)){throw new n("HIERARCHY_REQUEST_ERR")}var i=u(e,this.startContainer,this.startOffset);this.setStartBefore(i)},cloneContents:function(){B(this);var e,i;if(this.collapsed){return s(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&t.isCharacterDataNode(this.startContainer)){e=this.startContainer.cloneNode(true);e.data=e.data.slice(this.startOffset,this.endOffset);i=s(this).createDocumentFragment();i.appendChild(e);return i}else{var n=new _(this,true);e=d(n);n.detach()}return e}},canSurroundContents:function(){B(this);N(this.startContainer);N(this.endContainer);var e=new _(this,true);var t=e._first&&o(e._first,this)||e._last&&o(e._last,this);e.detach();return!t},surroundContents:function(e){M(e,y);if(!this.canSurroundContents()){throw new m("BAD_BOUNDARYPOINTS_ERR")}var t=this.extractContents();if(e.hasChildNodes()){while(e.lastChild){e.removeChild(e.lastChild)}}u(e,this.startContainer,this.startOffset);e.appendChild(t);this.selectNode(e)},cloneRange:function(){B(this);var e=new le(s(this));var t=W.length,i;while(t--){i=W[t];e[i]=this[i]}return e},toString:function(){B(this);var e=this.startContainer;if(e===this.endContainer&&t.isCharacterDataNode(e)){return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):""}else{var i=[],n=new _(this,true);c(n,function(e){if(e.nodeType==3||e.nodeType==4){i.push(e.data)}});n.detach();return i.join("")}},compareNode:function(e){B(this);var i=e.parentNode;var o=t.getNodeIndex(e);if(!i){throw new n("NOT_FOUND_ERR")}var s=this.comparePoint(i,o),r=this.comparePoint(i,o+1);if(s<0){return r>0?X:J}else{return r>0?Y:Z}},comparePoint:function(e,i){B(this);O(e,"HIERARCHY_REQUEST_ERR");D(e,this.startContainer);if(t.comparePoints(e,i,this.startContainer,this.startOffset)<0){return-1}else if(t.comparePoints(e,i,this.endContainer,this.endOffset)>0){return 1}return 0},createContextualFragment:j,toHtml:function(){B(this);var e=s(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(e,i){B(this);O(e,"NOT_FOUND_ERR");if(t.getDocument(e)!==s(this)){return false}var n=e.parentNode,o=t.getNodeIndex(e);O(n,"NOT_FOUND_ERR");var r=t.comparePoints(n,o,this.endContainer,this.endOffset),a=t.comparePoints(n,o+1,this.startContainer,this.startOffset);return i?r<=0&&a>=0:r<0&&a>0},isPointInRange:function(e,i){B(this);O(e,"HIERARCHY_REQUEST_ERR");D(e,this.startContainer);return t.comparePoints(e,i,this.startContainer,this.startOffset)>=0&&t.comparePoints(e,i,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,i){B(this);if(s(e)!=s(this)){throw new n("WRONG_DOCUMENT_ERR")}var o=t.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),r=t.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return i?o<=0&&r>=0:o<0&&r>0},intersection:function(e){if(this.intersectsRange(e)){var i=t.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=t.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var o=this.cloneRange();if(i==-1){o.setStart(e.startContainer,e.startOffset)}if(n==1){o.setEnd(e.endContainer,e.endOffset)}return o}return null},union:function(e){if(this.intersectsRange(e,true)){var i=this.cloneRange();if(t.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){i.setStart(e.startContainer,e.startOffset)}if(t.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){i.setEnd(e.endContainer,e.endOffset)}return i}else{throw new m("Ranges do not intersect")}},containsNode:function(e,t){if(t){return this.intersectsNode(e,false)}else{return this.compareNode(e)==Z}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,t.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var i=t.getNodes([3]);if(i.length>0){t.setStart(i[0],0);var n=i.pop();t.setEnd(n,n.length);var o=this.containsRange(t);t.detach();return o}else{return this.containsNodeContents(e)}},createNodeIterator:function(e,t){B(this);return new v(this,e,t)},getNodes:function(e,t){B(this);return p(this,e,t)},getDocument:function(){return s(this)},collapseBefore:function(e){I(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){I(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return le.rangesEqual(this,e)},isValid:function(){return P(this)},inspect:function(){return g(this)}};function te(e){e.START_TO_START=V;e.START_TO_END=z;e.END_TO_END=K;e.END_TO_START=G;e.NODE_BEFORE=J;e.NODE_AFTER=Y;e.NODE_BEFORE_AND_AFTER=X;e.NODE_INSIDE=Z}function ie(e){te(e);te(e.prototype)}function ne(e,i){return function(){B(this);var n=this.startContainer,o=this.startOffset,s=this.commonAncestorContainer;var r=new _(this,true);var a,u;if(n!==s){a=t.getClosestAncestorIn(n,s,true);u=l(a);n=u.node;o=u.offset}c(r,N);r.reset();var d=e(r);r.detach();i(this,n,o,n,o);return d}}function oe(i,n,s){function r(e,t){return function(i){I(this);M(i,w);M(S(i),b);var n=(e?a:l)(i);(t?u:d)(this,n.node,n.offset)}}function u(e,i,o){var s=e.endContainer,r=e.endOffset;if(i!==e.startContainer||o!==e.startOffset){if(S(i)!=S(s)||t.comparePoints(i,o,s,r)==1){s=i;r=o}n(e,i,o,s,r)}}function d(e,i,o){var s=e.startContainer,r=e.startOffset;if(i!==e.endContainer||o!==e.endOffset){if(S(i)!=S(s)||t.comparePoints(i,o,s,r)==-1){s=i;r=o}n(e,s,r,i,o)}}function c(e,t,i){if(t!==e.startContainer||i!==e.startOffset||t!==e.endContainer||i!==e.endOffset){n(e,t,i,t,i)}}i.prototype=new ee;e.util.extend(i.prototype,{setStart:function(e,t){I(this);E(e,true);A(e,t);u(this,e,t)},setEnd:function(e,t){I(this);E(e,true);A(e,t);d(this,e,t)},setStartBefore:r(true,true),setStartAfter:r(false,true),setEndBefore:r(true,false),setEndAfter:r(false,false),collapse:function(e){B(this);if(e){n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(e){I(this);E(e,true);n(this,e,0,e,t.getNodeLength(e))},selectNode:function(e){I(this);E(e,false);M(e,w);var t=a(e),i=l(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:ne(f,n),deleteContents:ne(h,n),canSurroundContents:function(){B(this);N(this.startContainer);N(this.endContainer);var e=new _(this,true);var t=e._first&&o(e._first,this)||e._last&&o(e._last,this);e.detach();return!t},detach:function(){s(this)},splitBoundaries:function(){B(this);var e=this.startContainer,i=this.startOffset,o=this.endContainer,s=this.endOffset;var r=e===o;if(t.isCharacterDataNode(o)&&s>0&&s<o.length){t.splitDataNode(o,s)}if(t.isCharacterDataNode(e)&&i>0&&i<e.length){e=t.splitDataNode(e,i);if(r){s-=i;o=e}else if(o==e.parentNode&&s>=t.getNodeIndex(e)){s++}i=0}n(this,e,i,o,s)},normalizeBoundaries:function(){B(this);var e=this.startContainer,i=this.startOffset,o=this.endContainer,s=this.endOffset;var r=function(e){var t=e.nextSibling;if(t&&t.nodeType==e.nodeType){o=e;s=e.length;e.appendData(t.data);t.parentNode.removeChild(t)}};var a=function(n){var r=n.previousSibling;if(r&&r.nodeType==n.nodeType){e=n;var a=n.length;i=r.length;n.insertData(0,r.data);r.parentNode.removeChild(r);if(e==o){s+=i;o=e}else if(o==n.parentNode){var l=t.getNodeIndex(n);if(s==l){o=n;s=a}else if(s>l){s--}}}};var l=true;if(t.isCharacterDataNode(o)){if(o.length==s){r(o)}}else{if(s>0){var u=o.childNodes[s-1];if(u&&t.isCharacterDataNode(u)){r(u)}}l=!this.collapsed}if(l){if(t.isCharacterDataNode(e)){if(i==0){a(e)}}else{if(i<e.childNodes.length){var d=e.childNodes[i];if(d&&t.isCharacterDataNode(d)){a(d)}}}}else{e=o;i=s}n(this,e,i,o,s)},collapseToPoint:function(e,t){I(this);E(e,true);A(e,t);c(this,e,t)}});ie(i)}function se(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;e.commonAncestorContainer=e.collapsed?e.startContainer:t.getCommonAncestor(e.startContainer,e.endContainer)}function re(e,t,i,n,o){var s=e.startContainer!==t||e.startOffset!==i;var a=e.endContainer!==n||e.endOffset!==o;e.startContainer=t;e.startOffset=i;e.endContainer=n;e.endOffset=o;se(e);r(e,"boundarychange",{startMoved:s,endMoved:a})}function ae(e){I(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;r(e,"detach",null);e._listeners=null}function le(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};se(this)}oe(le,re,ae);e.rangePrototype=ee.prototype;le.rangeProperties=W;le.RangeIterator=_;le.copyComparisonConstants=ie;le.createPrototypeRange=oe;le.inspect=g;le.getRangeDocument=s;le.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset};e.DomRange=le;e.RangeException=m});rangy.createModule("WrappedRange",function(e,module){e.requireModules(["DomUtil","DomRange"]);var t;var i=e.dom;var n=i.DomPosition;var o=e.DomRange;function s(e){var t=e.parentElement();var n=e.duplicate();n.collapse(true);var o=n.parentElement();n=e.duplicate();n.collapse(false);var s=n.parentElement();var r=o==s?o:i.getCommonAncestor(o,s);return r==t?r:i.getCommonAncestor(t,r)}function r(e){return e.compareEndPoints("StartToEnd",e)==0}function a(e,t,o,s){var r=e.duplicate();r.collapse(o);var a=r.parentElement();if(!i.isAncestorOf(t,a,true)){a=t}if(!a.canHaveHTML){return new n(a.parentNode,i.getNodeIndex(a))}var l=i.getDocument(a).createElement("span");var u,d=o?"StartToStart":"StartToEnd";var c,h,f,p;do{a.insertBefore(l,l.previousSibling);r.moveToElementText(l)}while((u=r.compareEndPoints(d,e))>0&&l.previousSibling);p=l.nextSibling;if(u==-1&&p&&i.isCharacterDataNode(p)){r.setEndPoint(o?"EndToStart":"EndToEnd",e);var g;if(/[\r\n]/.test(p.data)){var _=r.duplicate();var m=_.text.replace(/\r\n/g,"\r").length;g=_.moveStart("character",m);while((u=_.compareEndPoints("StartToEnd",_))==-1){g++;_.moveStart("character",1)}}else{g=r.text.length}f=new n(p,g)}else{c=(s||!o)&&l.previousSibling;h=(s||o)&&l.nextSibling;if(h&&i.isCharacterDataNode(h)){f=new n(h,0)}else if(c&&i.isCharacterDataNode(c)){f=new n(c,c.length)}else{f=new n(a,i.getNodeIndex(l))}}l.parentNode.removeChild(l);return f}function l(e,t){var n,o,s=e.offset;var r=i.getDocument(e.node);var a,l,u=r.body.createTextRange();var d=i.isCharacterDataNode(e.node);if(d){n=e.node;o=n.parentNode}else{l=e.node.childNodes;n=s<l.length?l[s]:null;o=e.node}a=r.createElement("span");a.innerHTML="&#feff;";if(n){o.insertBefore(a,n)}else{o.appendChild(a)}u.moveToElementText(a);u.collapse(!t);o.removeChild(a);if(d){u[t?"moveStart":"moveEnd"]("character",s)}return u}if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange)){(function(){var n;var s=o.rangeProperties;var r;function a(e){var t=s.length,i;while(t--){i=s[t];e[i]=e.nativeRange[i]}}function l(e,t,i,n,o){var s=e.startContainer!==t||e.startOffset!=i;var r=e.endContainer!==n||e.endOffset!=o;if(s||r){e.setEnd(n,o);e.setStart(t,i)}}function u(e){e.nativeRange.detach();e.detached=true;var t=s.length,i;while(t--){i=s[t];e[i]=null}}var d;t=function(e){if(!e){throw new Error("Range must be specified")}this.nativeRange=e;a(this)};o.createPrototypeRange(t,l,u);n=t.prototype;n.selectNode=function(e){this.nativeRange.selectNode(e);a(this)};n.deleteContents=function(){this.nativeRange.deleteContents();a(this)};n.extractContents=function(){var e=this.nativeRange.extractContents();a(this);return e};n.cloneContents=function(){return this.nativeRange.cloneContents()};n.surroundContents=function(e){this.nativeRange.surroundContents(e);a(this)};n.collapse=function(e){this.nativeRange.collapse(e);a(this)};n.cloneRange=function(){return new t(this.nativeRange.cloneRange())};n.refresh=function(){a(this)};n.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");i.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0);h.setEnd(c,0);try{h.setStart(c,1);r=true;n.setStart=function(e,t){this.nativeRange.setStart(e,t);a(this)};n.setEnd=function(e,t){this.nativeRange.setEnd(e,t);a(this)};d=function(e){return function(t){this.nativeRange[e](t);a(this)}}}catch(f){r=false;n.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(i){this.nativeRange.setEnd(e,t);this.nativeRange.setStart(e,t)}a(this)};n.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(i){this.nativeRange.setStart(e,t);this.nativeRange.setEnd(e,t)}a(this)};d=function(e,t){return function(i){try{this.nativeRange[e](i)}catch(n){this.nativeRange[t](i);this.nativeRange[e](i)}a(this)}}}n.setStartBefore=d("setStartBefore","setEndBefore");n.setStartAfter=d("setStartAfter","setEndAfter");n.setEndBefore=d("setEndBefore","setStartBefore");n.setEndAfter=d("setEndAfter","setStartAfter");h.selectNodeContents(c);if(h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length){n.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e);a(this)}}else{n.selectNodeContents=function(e){this.setStart(e,0);this.setEnd(e,o.getEndOffset(e))}}h.selectNodeContents(c);h.setEnd(c,3);var p=document.createRange();p.selectNodeContents(c);p.setEnd(c,4);p.setStart(c,2);if(h.compareBoundaryPoints(h.START_TO_END,p)==-1&h.compareBoundaryPoints(h.END_TO_START,p)==1){n.compareBoundaryPoints=function(e,t){t=t.nativeRange||t;if(e==t.START_TO_END){e=t.END_TO_START}else if(e==t.END_TO_START){e=t.START_TO_END}return this.nativeRange.compareBoundaryPoints(e,t)}}else{n.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)}}if(e.util.isHostMethod(h,"createContextualFragment")){n.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}}i.getBody(document).removeChild(c);h.detach();p.detach()})();e.createNativeRange=function(e){e=e||document;return e.createRange()}}else if(e.features.implementsTextRange){t=function(e){this.textRange=e;this.refresh()};t.prototype=new o(document);t.prototype.refresh=function(){var e,t;var i=s(this.textRange);if(r(this.textRange)){t=e=a(this.textRange,i,true,true)}else{e=a(this.textRange,i,true,false);t=a(this.textRange,i,false,false)}this.setStart(e.node,e.offset);this.setEnd(t.node,t.offset)};o.copyComparisonConstants(t);var u=function(){return this}();if(typeof u.Range=="undefined"){u.Range=t}e.createNativeRange=function(e){e=e||document;return e.body.createTextRange()}}if(e.features.implementsTextRange){t.rangeToTextRange=function(e){if(e.collapsed){var t=l(new n(e.startContainer,e.startOffset),true);return t}else{var o=l(new n(e.startContainer,e.startOffset),true);var s=l(new n(e.endContainer,e.endOffset),false);var r=i.getDocument(e.startContainer).body.createTextRange();r.setEndPoint("StartToStart",o);r.setEndPoint("EndToEnd",s);return r}}}t.prototype.getName=function(){return"WrappedRange"};e.WrappedRange=t;e.createRange=function(i){i=i||document;return new t(e.createNativeRange(i))};e.createRangyRange=function(e){e=e||document;return new o(e)};e.createIframeRange=function(t){return e.createRange(i.getIframeDocument(t))};e.createIframeRangyRange=function(t){return e.createRangyRange(i.getIframeDocument(t))};e.addCreateMissingNativeApiListener(function(t){var i=t.document;if(typeof i.createRange=="undefined"){i.createRange=function(){return e.createRange(this)}}i=t=null})});rangy.createModule("WrappedSelection",function(e,module){e.requireModules(["DomUtil","DomRange","WrappedRange"]);e.config.checkSelectionRanges=true;var t="boolean",i="_rangySelection",n=e.dom,o=e.util,s=e.DomRange,r=e.WrappedRange,a=e.DOMException,l=n.DomPosition,u,d,c="Control";function h(e){return(e||window).getSelection()}function f(e){return(e||window).document.selection}var p=e.util.isHostMethod(window,"getSelection"),g=e.util.isHostObject(document,"selection");var _=g&&(!p||e.config.preferTextRange);if(_){u=f;e.isSelectionValid=function(e){var t=(e||window).document,i=t.selection;return i.type!="None"||n.getDocument(i.createRange().parentElement())==t}}else if(p){u=h;e.isSelectionValid=function(){return true}}else{module.fail("Neither document.selection or window.getSelection() detected.")}e.getNativeSelection=u;var m=u();var v=e.createNativeRange(document);var w=n.getBody(document);var b=o.areHostObjects(m,["anchorNode","focusNode"]&&o.areHostProperties(m,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=b;var k=o.isHostMethod(m,"extend");e.features.selectionHasExtend=k;var C=typeof m.rangeCount=="number";e.features.selectionHasRangeCount=C;var y=false;var x=true;if(o.areHostMethods(m,["addRange","getRangeAt","removeAllRanges"])&&typeof m.rangeCount=="number"&&e.features.implementsDomRange){(function(){var e=document.createElement("iframe");e.frameBorder=0;e.style.position="absolute";e.style.left="-10000px";w.appendChild(e);var t=n.getIframeDocument(e);t.open();t.write("<html><head></head><body>12</body></html>");t.close();var i=n.getIframeWindow(e).getSelection();var o=t.documentElement;var s=o.lastChild,r=s.firstChild;var a=t.createRange();a.setStart(r,1);a.collapse(true);i.addRange(a);x=i.rangeCount==1;i.removeAllRanges();var l=a.cloneRange();a.setStart(r,0);l.setEnd(r,2);i.addRange(a);i.addRange(l);y=i.rangeCount==2;a.detach();l.detach();w.removeChild(e)})()}e.features.selectionSupportsMultipleRanges=y;e.features.collapsedNonEditableSelectionsSupported=x;var S=false,T;if(w&&o.isHostMethod(w,"createControlRange")){T=w.createControlRange();if(o.areHostProperties(T,["item","add"])){S=true}}e.features.implementsControlRange=S;if(b){d=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}}else{d=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:false}}function L(e,t,i){var n=i?"end":"start",o=i?"start":"end";e.anchorNode=t[n+"Container"];e.anchorOffset=t[n+"Offset"];e.focusNode=t[o+"Container"];e.focusOffset=t[o+"Offset"]}function q(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode;e.anchorOffset=t.anchorOffset;e.focusNode=t.focusNode;e.focusOffset=t.focusOffset}function E(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0}function I(t){var i;if(t instanceof s){i=t._selectionNativeRange;if(!i){i=e.createNativeRange(n.getDocument(t.startContainer));i.setEnd(t.endContainer,t.endOffset);i.setStart(t.startContainer,t.startOffset);t._selectionNativeRange=i;t.attachListener("detach",function(){this._selectionNativeRange=null})}}else if(t instanceof r){i=t.nativeRange}else if(e.features.implementsDomRange&&t instanceof n.getWindow(t.startContainer).Range){i=t}return i}function M(e){if(!e.length||e[0].nodeType!=1){return false}for(var t=1,i=e.length;t<i;++t){if(!n.isAncestorOf(e[0],e[t])){return false}}return true}function A(e){var t=e.getNodes();if(!M(t)){throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}return t[0]}function D(e){return!!e&&typeof e.text!="undefined"}function N(e,t){var i=new r(t);e._ranges=[i];L(e,i,false);e.rangeCount=1;e.isCollapsed=i.collapsed}function O(t){t._ranges.length=0;if(t.docSelection.type=="None"){E(t)}else{var i=t.docSelection.createRange();if(D(i)){N(t,i)}else{t.rangeCount=i.length;var o,s=n.getDocument(i.item(0));for(var r=0;r<t.rangeCount;++r){o=e.createRange(s);o.selectNode(i.item(r));t._ranges.push(o)}t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed;L(t,t._ranges[t.rangeCount-1],false)}}}function F(e,t){var i=e.docSelection.createRange();var o=A(t);var s=n.getDocument(i.item(0));var r=n.getBody(s).createControlRange();for(var a=0,l=i.length;a<l;++a){r.add(i.item(a))}try{r.add(o)}catch(u){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select();O(e)}var R;if(o.isHostMethod(m,"getRangeAt")){R=function(e,t){try{return e.getRangeAt(t)}catch(i){return null}}}else if(b){R=function(t){var i=n.getDocument(t.anchorNode);var o=e.createRange(i);o.setStart(t.anchorNode,t.anchorOffset);o.setEnd(t.focusNode,t.focusOffset);if(o.collapsed!==this.isCollapsed){o.setStart(t.focusNode,t.focusOffset);o.setEnd(t.anchorNode,t.anchorOffset)}return o}}function P(e,t,i){this.nativeSelection=e;this.docSelection=t;this._ranges=[];this.win=i;this.refresh()}e.getSelection=function(e){e=e||window;var t=e[i];var n=u(e),o=g?f(e):null;if(t){t.nativeSelection=n;t.docSelection=o;t.refresh(e)}else{t=new P(n,o,e);e[i]=t}return t};e.getIframeSelection=function(t){return e.getSelection(n.getIframeWindow(t))};var B=P.prototype;function H(e,t){var i=n.getDocument(t[0].startContainer);var o=n.getBody(i).createControlRange();for(var s=0,r;s<rangeCount;++s){r=A(t[s]);try{o.add(r)}catch(a){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select();O(e)}if(!_&&b&&o.areHostMethods(m,["removeAllRanges","addRange"])){B.removeAllRanges=function(){this.nativeSelection.removeAllRanges();E(this)};var U=function(t,i){var n=s.getRangeDocument(i);var o=e.createRange(n);o.collapseToPoint(i.endContainer,i.endOffset);t.nativeSelection.addRange(I(o));t.nativeSelection.extend(i.startContainer,i.startOffset);t.refresh()};if(C){B.addRange=function(t,i){if(S&&g&&this.docSelection.type==c){F(this,t)}else{if(i&&k){U(this,t)}else{var n;if(y){n=this.rangeCount}else{this.removeAllRanges();n=0}this.nativeSelection.addRange(I(t));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==n+1){if(e.config.checkSelectionRanges){var o=R(this.nativeSelection,this.rangeCount-1);if(o&&!s.rangesEqual(o,t)){t=new r(o)}}this._ranges[this.rangeCount-1]=t;L(this,t,W(this.nativeSelection));this.isCollapsed=d(this)}else{this.refresh()}}}}}else{B.addRange=function(e,t){if(t&&k){U(this,e)}else{this.nativeSelection.addRange(I(e));this.refresh()}}}B.setRanges=function(e){if(S&&e.length>1){H(this,e)}else{this.removeAllRanges();for(var t=0,i=e.length;t<i;++t){this.addRange(e[t])}}}}else if(o.isHostMethod(m,"empty")&&o.isHostMethod(v,"select")&&S&&_){B.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode){e=n.getDocument(this.anchorNode)}else if(this.docSelection.type==c){var t=this.docSelection.createRange();if(t.length){e=n.getDocument(t.item(0)).body.createTextRange()}}if(e){var i=e.body.createTextRange();i.select();this.docSelection.empty()}}}catch(o){}E(this)};B.addRange=function(e){if(this.docSelection.type==c){F(this,e)}else{r.rangeToTextRange(e).select();this._ranges[0]=e;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;L(this,e,false)}};B.setRanges=function(e){this.removeAllRanges();var t=e.length;if(t>1){H(this,e)}else if(t){this.addRange(e[0])}}}else{module.fail("No means of selecting a Range or TextRange was found");return false}B.getRangeAt=function(e){if(e<0||e>=this.rangeCount){throw new a("INDEX_SIZE_ERR")}else{return this._ranges[e]}};var Q;if(_){Q=function(t){var i;if(e.isSelectionValid(t.win)){i=t.docSelection.createRange()}else{i=n.getBody(t.win.document).createTextRange();i.collapse(true)}if(t.docSelection.type==c){O(t)}else if(D(i)){N(t,i)}else{E(t)}}}else if(o.isHostMethod(m,"getRangeAt")&&typeof m.rangeCount=="number"){Q=function(t){if(S&&g&&t.docSelection.type==c){O(t)}else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var i=0,n=t.rangeCount;i<n;++i){t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i))}L(t,t._ranges[t.rangeCount-1],W(t.nativeSelection));t.isCollapsed=d(t)}else{E(t)}}}}else if(b&&typeof m.isCollapsed==t&&typeof v.collapsed==t&&e.features.implementsDomRange){Q=function(e){var t,i=e.nativeSelection;if(i.anchorNode){t=R(i,0);e._ranges=[t];e.rangeCount=1;q(e);e.isCollapsed=d(e)}else{E(e)}}}else{module.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}B.refresh=function(e){var t=e?this._ranges.slice(0):null;Q(this);if(e){var i=t.length;if(i!=this._ranges.length){return false}while(i--){if(!s.rangesEqual(t[i],this._ranges[i])){return false}}return true}};var j=function(e,t){var i=e.getAllRanges(),n=false;e.removeAllRanges();for(var o=0,s=i.length;o<s;++o){if(n||t!==i[o]){e.addRange(i[o])}else{n=true}}if(!e.rangeCount){E(e)}};if(S){B.removeRange=function(e){if(this.docSelection.type==c){var t=this.docSelection.createRange();var i=A(e);var o=n.getDocument(t.item(0));var s=n.getBody(o).createControlRange();var r,a=false;for(var l=0,u=t.length;l<u;++l){r=t.item(l);if(r!==i||a){s.add(t.item(l))}else{a=true}}s.select();O(this)}else{j(this,e)}}}else{B.removeRange=function(e){j(this,e)}}var W;if(!_&&b&&e.features.implementsDomRange){W=function(e){var t=false;if(e.anchorNode){t=n.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1}return t};B.isBackwards=function(){return W(this)}}else{W=B.isBackwards=function(){return false}}B.toString=function(){var e=[];for(var t=0,i=this.rangeCount;t<i;++t){e[t]=""+this._ranges[t]}return e.join("")};function V(e,t){if(e.anchorNode&&n.getDocument(e.anchorNode)!==n.getDocument(t)){throw new a("WRONG_DOCUMENT_ERR")}}B.collapse=function(t,i){V(this,t);var o=e.createRange(n.getDocument(t));o.collapseToPoint(t,i);this.removeAllRanges();this.addRange(o);this.isCollapsed=true};B.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else{throw new a("INVALID_STATE_ERR")}};B.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else{throw new a("INVALID_STATE_ERR")}};B.selectAllChildren=function(t){V(this,t);var i=e.createRange(n.getDocument(t));i.selectNodeContents(t);this.removeAllRanges();this.addRange(i)};B.deleteFromDocument=function(){if(S&&g&&this.docSelection.type==c){var e=this.docSelection.createRange();var t;while(e.length){t=e.item(0);e.remove(t);t.parentNode.removeChild(t)}this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();this.removeAllRanges();for(var n=0,o=i.length;n<o;++n){i[n].deleteContents()}this.addRange(i[o-1])}};B.getAllRanges=function(){return this._ranges.slice(0)};B.setSingleRange=function(e){this.setRanges([e])};B.containsNode=function(e,t){for(var i=0,n=this._ranges.length;i<n;++i){if(this._ranges[i].containsNode(e,t)){return true}}return false};B.toHtml=function(){var e="";if(this.rangeCount){var t=s.getRangeDocument(this._ranges[0]).createElement("div");for(var i=0,n=this._ranges.length;i<n;++i){t.appendChild(this._ranges[i].cloneContents())}e=t.innerHTML}return e};function z(e){var t=[];var i=new l(e.anchorNode,e.anchorOffset);var n=new l(e.focusNode,e.focusOffset);var o=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined"){for(var r=0,a=e.rangeCount;r<a;++r){t[r]=s.inspect(e.getRangeAt(r))}}return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]";
}B.getName=function(){return"WrappedSelection"};B.inspect=function(){return z(this)};B.detach=function(){this.win[i]=null;this.win=this.anchorNode=this.focusNode=null};P.inspect=z;e.Selection=P;e.selectionPrototype=B;e.addCreateMissingNativeApiListener(function(t){if(typeof t.getSelection=="undefined"){t.getSelection=function(){return e.getSelection(this)}}t=null})})},{});require.install("qtext2/undo",function(require,exports,module){var e=require("Class").Class;var t=e.extend({__init__:function(e){this.current={state:e,next:null,prev:null}},state:function(){return this.current.state},add:function(e){if(this.current.next){this.current.next.prev=null}this.current.next={state:e,prev:this.current,next:null};this.current=this.current.next},undo:function(){if(this.current.prev){this.current=this.current.prev}},redo:function(){if(this.current.next){this.current=this.current.next}},canUndo:function(){return!!this.current.prev},canRedo:function(){return!!this.current.next}});exports.UndoManager=t},{Class:true});require.install("qtext2/keys",function(require,exports,module){var e=require("Class").Class;var t=exports.isMac=/Mac/.test(navigator.platform);var i={8:"BACKSPACE",9:"TAB",13:"RETURN",27:"ESCAPE",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",46:"DELETE",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var n=function(e){return[35,36,37,38,39,40].indexOf(e.which)!=-1};var o=e.extend({__init__:function(e){e=e.toUpperCase();this.alt=/ALT-/.test(e);this.ctrl=/CTRL-/.test(e)||!t&&/CMD-/.test(e);this.meta=/META-/.test(e)||t&&/CMD-/.test(e);this.shift=/SHIFT-/.test(e);this.character=e.split("-").pop()},toString:function(){var e="";if(this.alt){e+="ALT-"}if(this.ctrl){e+="CTRL-"}if(this.meta){e+="META-"}if(this.shift){e+="SHIFT-"}e+=this.character;return e}});var s=function(e){var t=i[e.which]||String.fromCharCode(e.which).toUpperCase(),n="";if(e.altKey){n+="ALT-"}if(e.ctrlKey){n+="CTRL-"}if(e.metaKey){n+="META-"}if(e.shiftKey){n+="SHIFT-"}n+=t;return n};var r=e.extend({__init__:function(){this._handlers=[]},on:function(e,t){var i=new o(e);if(i in this._handlers){throw new Error("Already attached handler for "+i)}this._handlers[i]=t},trigger:function(e){var t=s(e),i=this._handlers[t];if(i){return i(e)}return true}});exports.isNavigation=n;exports.Hub=r},{Class:true});require.install("qtext2/mutations",function(require,exports,module){var e=require("qtext2/base"),t=require("qtext2/util").Util,i=e.Span,n=e.Section,o=require("log").log;o=o.bind(o,"qtext2");var s=function(e){var t=e.tagName,i=e.getAttribute("style"),n,s=false;if(t=="B"){n="bold"}else if(t=="I"){n="italic"}else if(t=="U"){n="underline"}else if(i=="font-weight: normal;"){n="bold";s=true}else if(i=="font-style: normal;"){n="italic";s=true}else if(i=="text-decoration: none;"||i=="text-decoration: underline;"){n="underline";s=true}else{o("Unsure of intended action",e,t,i)}return{modifier:n,shouldRemove:s}};var r=function(e){var n=i.get(e.parentElement),r=t.extend({},n.modifiers),a=s(e),l;o("Fixing span",n.node,a);if(a.modifier){if(a.shouldRemove){n.removeModifier(a.modifier);e.removeAttribute("style")}else{n.setModifier(a.modifier)}}l=e.parentElement.firstChild;while(l!=e){n.parent.insertBefore(new i(l.textContent,r),n);l=l.nextSibling}l=l.nextSibling;while(l){n.parent.insertBefore(new i(l.textContent,r),n.nextSibling());l=l.nextSibling}n.setText(e.textContent);return[n]};var a=function(e){var t=s(e),n=[];o("Fixing section",e.parentElement,t);while(e.firstElementChild){n.push(i.get(e.firstElementChild));e.parentElement.insertBefore(e.firstElementChild,e)}e.parentElement.removeChild(e);n.forEach(function(e){if(t.modifier){if(t.shouldRemove){e.removeModifier(t.modifier)}else{e.setModifier(t.modifier)}}});return n};var l=function(e){var n=e.previousSibling&&e.previousSibling.textContent,r=e.textContent,a=e.nextSibling&&e.nextSibling.textContent,l=i.get(e.parentElement.parentElement),u=l.parent,d=s(e),c=t.extend({},l.modifiers);o("Fixing span2",l,e,d,n,r,a);if(n){u.insertBefore(new i(n,c),l)}if(a){u.insertBefore(new i(a,c),l.nextSibling())}if(r){l.setText(r);if(d.modifier){if(d.shouldRemove){l.removeModifier(d.modifier)}else{l.setModifier(d.modifier)}}}else{l.parent.removeChild(l)}return[l]};var u=function(e,t){var o=[],s,u,d=[];t.forEach(function(e){if(e.type=="attributes"){o.push(e.target)}else if(e.type=="childList"){for(u=0;u<e.addedNodes.length;u++){s=e.addedNodes[u];if(s.tagName=="B"||s.tagName=="I"||s.tagName=="U"||s.nodeType==1&&s.hasAttribute("style")){o.push(s)}}}});o.forEach(function(e){if(i.is(e.parentElement)){d=d.concat(r(e))}else if(n.is(e.parentElement)){d=d.concat(a(e))}else if(i.is(e.parentElement.parentElement)){d=d.concat(l(e))}});if(d.length){e.caret.move(d[0].first(),d[d.length-1].last())}};exports.observe=function(e){var t=new MutationObserver(u.bind(null,e));t.observe(e.node,{childList:true,attributes:true,subtree:true,attributeOldValue:true,attributeFilter:["style"]})}},{"qtext2/util":true,"qtext2/base":true,log:true});require.install("qtext2/parser",function(require,exports,module){var e=require("Class").Class,t=require("log").log,i=require("qtext2/base"),n=require("qtext2/util").Util,o=i.Span,s=i.UnorderedListSection,r=i.OrderedListSection,a=i.PlainSection,l=i.CodeSection,u=i.ImageSection,d=i.VideoSection,c=i.CONTENT_TYPES;var h=function(e){return["B","I","U","A","EM","STRONG"].indexOf(e)!=-1};var f=function(e){return["OL","UL"].indexOf(e)!=-1};var p=function(e){return["H1","H2","H3","H4","H5"].indexOf(e)!=-1};var g=function(e){return e=="BLOCKQUOTE"};var _=function(e){return e=="META"};var m=function(e){return e.replace(/( |\r\n|\n|\r|\u00a0)+/gm," ")};var v=e.extend({__init__:function(e){this.spans=[];this.modifiers=n.extend(e,{});this.indent=0;this.content=""},visit:function(e){this._enter(e);this._exit(e)},_visitChildren:function(e){for(var t=e.firstChild;t!==null;t=t.nextSibling){this.visit(t)}},_enter:function(e){if(n.isTextNode(e)){this.content+=e.textContent;return}if(this._getModifier(e)){this.modifiers[this._getModifier(e)]=this._getModifierValue(e)}this._visitChildren(e)},_exit:function(e){if(n.isTextNode(e)){this._createSpan()}else if(this._getModifier(e)){delete this.modifiers[this._getModifier(e)]}},_createSpan:function(){var e=this.content;if(e.match(/^\n+$/g)||!e.length){return}e=m(e);this.spans.push(new o(e,this.modifiers));this.content=""},_getModifier:function(e){return{B:"bold",STRONG:"bold",I:"italic",EM:"italic",U:"italic",A:"link"}[e.nodeName]},_getModifierValue:function(e){return{B:true,I:true,EM:true,U:true,A:{type:"url",url:e.href}}[e.nodeName]}});var w=function(e,t){var i=new v(t);i.visit(e);return i.spans};var b=function(e,t){var i,o=e.nodeName=="OL"?r:s,a=[],l;t=t||0;n.assert(f(e.nodeName),"Unknown list type",e);for(var u=e.firstElementChild;u;u=u.nextElementSibling){i=u.nodeName;if(i=="LI"){l=new o(w(u,{}));l.setIndent(t);a.push(l)}else if(f(i)){a=a.concat(b(u,t+1))}}return a};var k=function(e,i){var o,s=[],r=[],d;i=i||{};var c=function(){if(s.length){r.push(new a(s));s=[]}};for(var m=e.firstChild;m;m=m.nextSibling){o=m.nodeName;if(o=="SPAN"||n.isTextNode(m)||h(o)){s=s.concat(w(m,i))}else if(o=="CODE"){s=s.concat(w(m,n.extend(i,{code:true})))}else{c();if(o=="P"||o=="DIV"){r=r.concat(k(m))}else if(f(o)){r=r.concat(b(m))}else if(p(o)){r=r.concat(k(m,n.extend(i,{bold:true})))}else if(g(o)){d=k(m);d.forEach(function(e){e.setQuoted(true)});r=r.concat(d)}else if(o=="PRE"){r.push(new l(w(m,i)))}else if(o=="IMG"){r.push(u.fromURL(m.src))}else if(_(o)){}else{t.warn("qtext2","Cannot create section from ",m)}}}c();return r};var C=function(e){var i=document.createElement("DIV"),n;i.innerHTML=e;n=k(i);t.log("qtext2",i);return n};var y=function(e){var t=[];if(e.length===0){return[]}n.splitLines(e).forEach(function(e){n.splitByRegex(e,d.YOUTUBE_URL_RE).forEach(function(e){if(e.match){t.push(d.fromURL(e.text))}else{t.push(new a([new o(e.text)]))}})});return t};var x=function(e,t){if(t==c.HTML){return C(e)}if(t==c.TEXT){return y(e)}return[]};exports.parseHTML=C;exports.parseText=y;exports.parse=x},{"qtext2/util":true,Class:true,"qtext2/base":true,log:true});require.install("qtext2/base",function(require,exports,module){require("third_party/rangy-core");var e=window.rangy,t=require("browser").browser,i=require("linkify"),n=require("log").log,o=require("Class").Class,s=require("qtext2/util").Util,r=require("qtext2/undo").UndoManager,a=require("interface/settings").pageIsMobile,l=require("window_manager"),u=require("qtext2/keys"),d=require,c;if(a){c=d("mobile_app2/client")}n=n.bind(n,"qtext2");var h={Backspace:"backspace",Delete:"delete",Return:"return","Shift-Return":"soft-return",Tab:"indent","Shift-Tab":"deindent","Cmd-B":"bold","Cmd-I":"italic","Cmd-U":"underline","Cmd-K":"link","Cmd-Shift-7":"ordered_list","Cmd-Shift-8":"unordered_list","Cmd-Shift-9":"quote","Cmd-Shift-K":"code","Cmd-Shift-L":"math","Cmd-Z":"undo","Cmd-Shift-Z":"redo","Shift-2":"mention"};if(u.isMac){s.extend(h,{"Ctrl-H":"backspace","Ctrl-D":"delete","Ctrl-K":"delete-forward","Cmd-Backspace":"delete-backward","Ctrl-T":"transpose","Ctrl-Backspace":"backspace","Ctrl-Delete":"delete","Shift-Backspace":"backspace","Shift-Delete":"delete","Alt-Backspace":"delete-next-word","Alt-Delete":"delete-previous-word"})}else{s.extend(h,{"Ctrl-Backspace":"delete-next-word","Ctrl-Delete":"delete-previous-word","Shift-Backspace":"backspace","Shift-Delete":"delete","Alt-Backspace":"backspace","Alt-Delete":"delete"})}var f={TEXT:"text/plain",HTML:"text/html"};var p={};var g=o.extend({__init__:function(e,t){this.span=e;this.offset=t},toJSON:function(){var e=this.span.parent;return{spanIdx:e.children.indexOf(this.span),sectionIdx:e.parent.children.indexOf(e),offset:this.offset}},clone:function(){return new g(this.span,this.offset)},atSpanStart:function(){return this.offset===0},atSpanEnd:function(){return this.offset==this.span.getLength()},atSectionStart:function(){var e=this.span.parent;return this.atSpanStart()&&this.span==e.firstChild()},atSectionEnd:function(){var e=this.span.parent;return this.atSpanEnd()&&this.span==e.lastChild()},atDocStart:function(){var e=this.span.parent,t=e.parent;return this.atSectionStart()&&e==t.firstChild()},atDocEnd:function(){var e=this.span.parent,t=e.parent;return this.atSectionEnd()&&e==t.lastChild()},equals:function(e){return e.span===this.span&&e.offset===this.offset}});var _=o.extend({__init__:function(e,t){this.start=e;this.end=t},toJSON:function(){return{start:this.start.toJSON(),end:this.end.toJSON()}},getStartNode:function(){return this.start.span.getFocusNode()},getEndNode:function(){return this.end.span.getFocusNode()},moveStart:function(e){this.start.span=e.span;this.start.offset=e.offset;this._apply()},moveEnd:function(e){this.end.span=e.span;this.end.offset=e.offset;this._apply()},move:function(e,t,i){t=t||e;this.start.span=e.span;this.start.offset=e.offset;this.end.span=t.span;this.end.offset=t.offset;this._apply(i)},isCollapsed:function(){return this.start.span==this.end.span&&this.start.offset==this.end.offset},update:function(t){var i=e.getSelection(),n,o,s;if(!i.anchorNode){return}if(i.isCollapsed){n=o=this._fromNode(i.anchorNode,i.anchorOffset)}else{s=i.getRangeAt(0);n=this._fromNode(s.startContainer,s.startOffset);o=this._fromNode(s.endContainer,s.endOffset)}if(n&&o){this.move(n,o,t)}},_fromNode:function(e,t){var i,n,o,s;if(w.is(e)){s=w.get(e);if(t===0){n=s.firstChild().firstChild();o=0}else{n=s.lastChild().lastChild();o=n.getLength()}}else if(b.is(e)){i=b.get(e);if(t===0){n=i.firstChild();o=0}else{n=i.lastChild();o=n.getLength()}}else{while(e&&!q.is(e)){e=e.parentNode}if(!e){return null}n=q.get(e);o=t}return new g(n,o)},_apply:function(t){var i=e.getSelection(),n=this.getStartNode(),o,s;if(this.isCollapsed()){if(!t&&i.isCollapsed&&n==i.anchorNode&&this.start.offset==i.anchorOffset){return}s=e.createRange();s.setStart(n,this.start.offset);s.setEnd(n,this.start.offset);s.collapse(true);i.setSingleRange(s)}else{s=i.getRangeAt(0);o=this.end.span.getFocusNode();if(!t&&!i.isCollapsed&&n==s.startContainer&&this.start.offset==s.startOffset&&o==s.endContainer&&this.end.offset==s.endOffset){return}s.setStart(n,this.start.offset);s.setEnd(o,this.end.offset);i.setSingleRange(s)}},scrollIntoViewIfNeeded:function(){if(!a){return}var e=window.getSelection().getRangeAt(0).getClientRects(),t=document.body,i=t.parentElement,n=t.scrollTop||i.scrollTop,o=n+window.innerHeight,s,r,l=30;if(e.length===0){s=this.start.span.parent.node.offsetTop}else{s=n+e[0].top}r=s+l;if(s<n){t.scrollTop+=s-n;i.scrollTop+=s-n}else if(r>o){t.scrollTop+=r-o;i.scrollTop+=r-o}}});var m=o.extend({__init__:function(e,t){this.update(e,t)},update:function(e){this.position=e.start.clone();this.modifiers=s.extend({},e.start.span.modifiers)},toggleModifier:function(e,t){if(t in this.modifiers){delete this.modifiers[t]}else{this.modifiers[t]=true}this.position=e.start.clone()},hasModifier:function(e){return e in this.modifiers},hasChanged:function(e){return!s.jsonEqual(this.modifiers,e.start.span.modifiers)},apply:function(e){var t;for(t in this.modifiers){e.setModifier(t)}for(t in e.modifiers){if(!this.hasModifier(t)){e.removeModifier(t)}}}});var v=o.extend({__init__:function(e){this.kind=e;this.node=s.create("DIV");this.node.className=this.kind;this.children=[]},init:function(){},insertBefore:function(e,t){if(e.parent){e.parent.removeChild(e)}if(t){this.node.insertBefore(e.node,t.node);this.children.splice(this.children.indexOf(t),0,e)}else{this.node.appendChild(e.node);this.children.push(e)}e.parent=this},appendChild:function(e){this.insertBefore(e)},removeChild:function(e){var t=this.children.indexOf(e);this.children.splice(t,1);this.node.removeChild(e.node)},removeChildren:function(){var e=this.firstChild(),t;while(e){t=e.nextSibling();this.removeChild(e);e=t}},previousSibling:function(){return this.node.previousSibling&&this.Class.get(this.node.previousSibling)},nextSibling:function(){return this.node.nextSibling&&this.Class.get(this.node.nextSibling)},firstChild:function(){if(this.children.length===0){return null}return this.children[0]},lastChild:function(){if(this.children.length===0){return null}return this.children[this.children.length-1]}});v.create=function(e,t){var i;s.assert(!t.__init__,"Do not override __init__");t.__init__=function(){this._super(e);this.init.apply(this,arguments);this.Class=i;i.add(this,this.node)};i=v.extend(t);i.add=function(e,t){s.setData(t,"kind",e.kind);t.qtextContainer=e};i.get=function(e){s.assert(i.is(e));return e.qtextContainer};i.is=function(t){return t.nodeType==1&&s.getData(t,"kind")==e};return i};var w=v.create("doc",{init:function(t){this.node.setAttribute("contenteditable","true");this._attachEventListeners();this._attachMutationFixer();if(!t){t=[new k]}t.forEach(this.appendChild.bind(this));e.init();var i=this.firstChild().firstChild();this.caret=new _(i.first(),i.first());this.formattingState=new m(this.caret);this.undoManager=new r(this.toJSON());this.linkSelector=null;this._listeners={};this._updatePlaceholder()},isEmpty:function(){return this.children.length==1&&this.children[0].isEmpty()},toJSON:function(){var e={sections:[],caret:this.caret.toJSON()};this.children.forEach(function(t){e.sections.push(t.toJSON())});return e},fromJSON:function(e){var t,i,n=this;this.removeChildren();if(e.sections&&e.sections.length){e.sections.forEach(function(e){n.appendChild(b.fromJSON(e))})}else{this.appendChild(new k)}if(e.caret){t=e.caret.start;i=e.caret.end;this.caret.move(new g(this.children[t.sectionIdx].children[t.spanIdx],t.offset),new g(this.children[i.sectionIdx].children[i.spanIdx],i.offset))}else{this.caret.move(this.lastChild().last())}},hasChanged:function(e){var t=this.toJSON();return!s.jsonEqual(t.sections,e.sections)},_updatePlaceholder:function(){var e=this.isEmpty()&&this.children[0]instanceof k&&!this.children[0].isQuoted();if(e){this.node.classList.add("empty")}else{this.node.classList.remove("empty")}window.requestAnimationFrame(this._updatePlaceholder.bind(this))},_handleEmptySpan:function(e,t){var i,n,o;if(e.parent.firstChild()==e&&e.parent.children.length==1){e.setPlaceholder();return e.first()}n=e.previousSibling();o=e.nextSibling();e.parent.removeChild(e);if(t){if(n){e=n;i=n.getLength()}else{e=o;i=0}}else{if(o){e=o;i=0}else{e=n;i=n.getLength()}}return new g(e,i)},_attachMutationFixer:function(){if(a&&require("browser").browser.ios&&c.isMobileWeb()){console.log("Attaching mutation observer...");require("qtext2/mutations").observe(this)}},_attachEventListeners:function(){var e=this,i=new u.Hub(this.node),o,r,a;a=function(t,i){n(t,i.which,i,e.caret)};for(o in h){r=h[o];i.on(o,this.handleCommand.bind(this,r))}i.on(" ",function(){e.saveState();return e.detectLinks()});i.on(",",function(){e.saveState()});i.on(".",function(){e.saveState()});["Left","Up","Home"].forEach(function(t){i.on(t,function(){return!(e.caret.isCollapsed()&&e.caret.start.atDocStart())})});["Right","Down","End"].forEach(function(t){i.on(t,function(){return!(e.caret.isCollapsed()&&e.caret.start.atDocEnd())})});s.on("keydown",this.node,function(t){a("keydown",t);var n;e.caret.update();n=i.trigger(t);e._trigger("keydown");return n});s.on("keypress",this.node,function(t){a("keypress",t);if(!e.caret.isCollapsed()&&t.which!==0&&!t.ctrlKey&&!t.metaKey&&!t.altKey){e._deleteSelection()}});s.on("keyup",this.node,function(t){a("keyup",t);e.caret.update();if(u.isNavigation(t.which)){e._updateFormattingState()}else{if(e.formattingState.hasChanged(e.caret)){e._applyFormattingChange()}}return false});s.on("mousedown",this.node,function(t){e.caret.update();a("mousedown",t)});s.on("mousemove",this.node,function(){e.caret.update()});s.on("mouseup",this.node,function(t){a("mouseup",t);e.caret.update();e._updateFormattingState()});s.on("compositionstart",this.node,function(e){a("compositionstart",e)});s.on("compositionupdate",this.node,function(e){a("compositionupdate",e)});s.on("compositionend",this.node,function(e){a("compositionend",e)});s.on("focus",this.node,this._trigger.bind(this,"focus"));s.on("blur",this.node,this._trigger.bind(this,"blur"));s.on("copy",this.node,function(t){a("copy",t);t.clipboardData.setData(f.TEXT,e.convertSelectionToContent(f.TEXT));t.clipboardData.setData(f.HTML,e.convertSelectionToContent(f.HTML));t.preventDefault();t.stopPropagation()});s.on("cut",this.node,function(t){a("cut",t);t.clipboardData.setData(f.TEXT,e.convertSelectionToContent(f.TEXT));t.clipboardData.setData(f.HTML,e.convertSelectionToContent(f.HTML));e._deleteSelection();t.preventDefault();t.stopPropagation()});s.on("paste",this.node,function(t){a("paste",t);if(!t.clipboardData||!t.clipboardData.types||!t.clipboardData.types.indexOf||!t.clipboardData.getData){return}var i=[f.HTML,f.TEXT],o;i.some(function(i){if(t.clipboardData.types.indexOf(i)>=0){o=t.clipboardData.getData(i);n("paste",i,o);e.handlePaste(o,i);e.saveState();return true}});return false});if(t.mobile||t.ipad){var l=function(){e.caret.update();window.requestAnimationFrame(l)};window.requestAnimationFrame(l)}},on:function(e,t){this._listeners[e]=this._listeners[e]||[];this._listeners[e].push(t)},_trigger:function(e){if(this._listeners[e]){this._listeners[e].forEach(function(e){e()})}},_updateFormattingState:function(){this.formattingState.update(this.caret)},_applyFormattingChange:function(){var e=this.caret.start.span,t=this.formattingState.position.offset,i=this.caret.start.offset;if(e===this.formattingState.position.span){if(i>t){if(i<e.getLength()){e.split(i)}if(t>0){e=e.split(t)}this.formattingState.apply(e);this.caret.move(e.last());this._updateFormattingState()}else if(i<t){this._updateFormattingState()}else{}}else{this._updateFormattingState()}},getToolbarState:function(e){var t=this.formattingState,i=this.caret.start.span,n=i.parent,o=this.caret.isCollapsed(),s=t.hasModifier("bold"),r=t.hasModifier("italic"),a=t.hasModifier("link"),l=t.hasModifier("code")||n instanceof x,u=t.hasModifier("math")||n instanceof S,d=n instanceof y,c=n instanceof C,h=d||c,f=a||l||u,p=!this.undoManager.canUndo(),g=!this.undoManager.canRedo();if(e===0){return[{name:"link_input",focused:true},{name:"space"},{name:"cite"},{name:"link_save"}]}else if(e===1){return[{name:"bold",pressed:s,disabled:f},{name:"italic",pressed:r,disabled:f},{name:"ordered_list",pressed:d},{name:"unordered_list",pressed:c},{name:"quote",pressed:n.isQuoted()},{name:"link",pressed:a,disabled:o},{name:"image"},{name:"space"},{name:"overflow_show"}]}else if(e===2){return[{name:"undo",disabled:p},{name:"redo",disabled:g},{name:"deindent",disabled:!h},{name:"indent",disabled:!h},{name:"mention",disabled:a||l||u},{name:"code",pressed:l},{name:"math",pressed:u},{name:"space"},{name:"overflow_hide"}]}},handleCommand:function(e){var t,i=this;switch(e){case"backspace":i.saveState();t=i.handleBackspace();i.caret.scrollIntoViewIfNeeded();return t;case"delete":i.saveState();return i.handleDelete();case"return":i.saveState();t=i.handleReturn();i.caret.scrollIntoViewIfNeeded();return t;case"soft-return":return false;case"delete-forward":i.saveState();i.handleDeleteForward();return false;case"delete-backward":i.saveState();i.handleDeleteBackward();return false;case"delete-next-word":return false;case"delete-previous-word":return false;case"transpose":return false;case"bold":i.saveState();return i.toggleModifier("bold");case"italic":i.saveState();return i.toggleModifier("italic");case"underline":return false;case"ordered_list":i.saveState();return i.toggleSectionType(y);case"unordered_list":i.saveState();return i.toggleSectionType(C);case"quote":i.saveState();return i.toggleQuotes();case"link":i.saveState();return i.toggleExternalLink(false);case"cite":i.saveState();return i.toggleExternalLink(true);case"mention":return i.showInternalLinkSelector();case"code":i.saveState();return i.toggleCode();case"math":i.saveState();return i.toggleMath();case"indent":i.saveState();return i.indentSections();case"deindent":i.saveState();return i.deindentSections();case"undo":return i.handleUndo();case"redo":return i.handleRedo()}},handleBackspace:function(){var e,t;if(!this.caret.isCollapsed()){this._deleteSelection(true);return false}t=this.caret.start.clone();if(t.atDocStart()){return false}if(t.atSectionStart()){e=t.span.parent;if(e.getIndent()>0){e.setIndent(e.getIndent()-1)}else{this.caret.move(e.previousSibling().merge(e))}return false}if(t.atSpanStart()){t.span=t.span.previous();t.offset=t.span.getLength()}t.span.deleteText(t.offset-1,t.offset);if(t.span.isEmpty()){t=this._handleEmptySpan(t.span,true);this.caret.move(t,t,true)}else{t.offset--;this.caret.move(t)}return false},handleDelete:function(){var e,t;if(!this.caret.isCollapsed()){this._deleteSelection(false);return false}t=this.caret.start.clone();if(t.atDocEnd()){return false}if(t.atSectionEnd()){e=t.span.parent;this.caret.move(e.merge(e.nextSibling()));return false}if(t.atSpanEnd()){t.span=t.span.next();t.offset=0}t.span.deleteText(t.offset,t.offset+1);if(t.span.isEmpty()){this.caret.move(this._handleEmptySpan(t.span,true))}else{this.caret.move(t)}return false},handleDeleteForward:function(){if(this.caret.isCollapsed()){this.caret.moveEnd(this.caret.start.span.parent.last())}return this.handleDelete()},handleDeleteBackward:function(){if(this.caret.isCollapsed()){this.caret.moveStart(this.caret.start.span.parent.first())}return this.handleBackspace()},handleReturn:function(){var e,t;if(!this.caret.isCollapsed()){this._deleteSelection(false)}e=this.caret.start.span.parent;t=this.caret.start.clone();if(e.isEmpty()){if(e.getIndent()>0){e.setIndent(e.getIndent()-1)}else if(!(e instanceof k)){e=e.changeType(k)}else if(e.isQuoted()){e.setQuoted(false)}else{}t=e.first();this.caret.move(t);return false}this.caret.move(this.caret.start.span.parent.split(this.caret.start));return false},_deleteSelection:function(e){var t=this.caret.start,i=this.caret.end,n=t.span.parent,o=i.span.parent,s;if(n==o){n.deleteText(t,i)}else{n.deleteText(t,n.last());while(n.nextSibling()!=o){n.parent.removeChild(n.nextSibling())}o.deleteText(o.first(),i);t=n.merge(o)}if(t.span.isEmpty()){s=this._handleEmptySpan(t.span,e)}else{s=t}this.caret.move(s,s,true)},_getSelectedSpans:function(e){var t=[],i=this.caret.start,n=this.caret.end;if(this.caret.isCollapsed()){return[]}if(i.span==n.span){if(n.offset<n.span.getLength()){n.span.split(n.offset,e)}if(i.offset>0){n.span=i.span=i.span.split(i.offset,e)}t=[i.span]}else{if(i.offset>0){if(i.offset==i.span.getLength()){i.span=i.span.next()}else{i.span=i.span.split(i.offset,e)}}if(n.offset<n.span.getLength()){if(n.offset===0){n.span=n.span.previous()}else{n.span.split(n.offset,e)}}for(var o=i.span;o!=n.span;o=o.next()){t.push(o)}t.push(n.span)}this.caret.move(i.span.first(),n.span.last());return t},toggleModifier:function(e){var t,i;this.formattingState.toggleModifier(this.caret,e);if(this.caret.isCollapsed()){return false}t=this._getSelectedSpans(false);i=t[0].getModifier(e);t.forEach(function(t){if(i){t.removeModifier(e)}else{t.setModifier(e,true)}});return false},_toggleMathOrCodeModifier:function(e){var t=this._getSelectedSpans(true),i=t[0].getModifier(e);if(i){t.forEach(function(t){t.removeModifier(e)})}else{t=this._mergeSpansBySection(t);t.forEach(function(t){t.removeModifier("math");t.removeModifier("code");t.setModifier(e,true)});this.caret.move(t[0].first(),t[t.length-1].last())}},_getSelectedSections:function(){var e=[],t=this.caret.start,i=this.caret.end,n;if(this.caret.isCollapsed()){e.push(t.span.parent)}else{for(n=t.span.parent;n!=i.span.parent;n=n.nextSibling()){e.push(n)}e.push(i.span.parent)}return e},toggleSectionType:function(e){var t=this._getSelectedSections(),i=t[0]instanceof e,n=this.caret.start.clone(),o=this.caret.end.clone();t.forEach(function(t){if(i){t.changeType(k)}else{t.changeType(e)}});this.caret.move(n,o);return false},indentSections:function(){var e=this._getSelectedSections();e.forEach(function(e){e.setIndent(e.getIndent()+1)});return false},deindentSections:function(){var e=this._getSelectedSections();e.forEach(function(e){e.setIndent(e.getIndent()-1)});return false},toggleQuotes:function(){var e=this._getSelectedSections(),t=e[0].isQuoted();e.forEach(function(e){e.setQuoted(!t)});return false},toggleCode:function(){if(this.caret.isCollapsed()){this.toggleSectionType(x)}else{this._toggleMathOrCodeModifier("code")}return false},toggleMath:function(){if(this.caret.isCollapsed()){this.toggleSectionType(S)}else{this._toggleMathOrCodeModifier("math")}return false},convertSelectionToContent:function(e){var t=this._getSelectedSpans(false),i=this._getSelectedSections(),o=i[0],s=o.getContentPrefix(e,i);t.forEach(function(t){if(o!=t.parent){s+=o.getContentSuffix(e,i);o=t.parent;s+=o.getContentPrefix(e,i)}s+=t.toContent(e)});s+=o.getContentSuffix(e,i);n(e,s);return s},handlePaste:function(e,t){var i=this,n,o,s,r,a,l,u;u=require("qtext2/parser").parse(e,t);if(u.length===0){return}if(!i.caret.isCollapsed()){i._deleteSelection(true)}n=i.caret.start;s=n.span.parent;s.split(n);r=s.nextSibling();u.forEach(function(e){i.insertBefore(e,r)});a=s.nextSibling();if(a.constructor==s.constructor||a instanceof k){s.merge(a)}l=r.previousSibling();if(l.isEditable()&&(l.constructor==r.constructor||r instanceof k)){o=l.last();l.merge(r)}else{o=r.first()}this.caret.move(o)},saveState:function(){this.undoManager.add(this.toJSON());this._trigger("meaningfulChange")},handleUndo:function(){if(!this.undoManager.canRedo()){this.saveState()}this.undoManager.undo();this.fromJSON(this.undoManager.state());return false},handleRedo:function(){this.undoManager.redo();this.fromJSON(this.undoManager.state());return false},_shouldAllowLinks:function(){var e=this.caret.start.span,t=e.parent;if(!this.caret.isCollapsed()){return false}if(e.hasModifier("link")){return false}if(t instanceof x||e.hasModifier("code")){return false}if(t instanceof S||e.hasModifier("math")){return false}return true},setLinkSelector:function(e){var t=this;t.linkSelector=e;e.onSubmit(function(i){var n=t.caret.start.span,o=new q(" ",n.modifiers);n.setText(i.text);n.setModifier("link",i.target||{type:"url",url:i.url});n.parent.insertBefore(o,n.nextSibling());e.hide();t.caret.move(o.last());t.saveState()});e.onCancel(function(i){var n=t.caret.start.span;n.setText(i);e.hide();t.caret.move(n.last())})},showInternalLinkSelector:function(){if(!this._shouldAllowLinks()){return true}var e=this.caret.start,t=e.span,i=t.parent,n,o;if(i.isEmpty()){n=t;n.setText("@")}else{n=new q("@",t.modifiers);if(e.atSpanStart()){i.insertBefore(n,t)}else if(e.atSpanEnd()){i.insertBefore(n,t.nextSibling())}else{t=t.split(e.offset);i.insertBefore(n,t)}}this.caret.move(n.last());if(a){this.linkSelector.show()}else{o=$(n.node).offset();this.linkSelector.show(o.left+$(n.node).width(),o.top)}return false},detectLinks:function(){if(!this._shouldAllowLinks()){return true}var e=this.caret.start.span,t=this.caret.start.offset,n=e.parent,o=e.getText(),s,r=[],a;i.linkify(o.slice(0,t),{callback:function(t,i){if(t.length>0){s=new q(t,e.modifiers);if(i){s.setModifier("link",{type:"url",url:i});a=s}r.push(s)}}});if(!a){return true}r.forEach(function(t){n.insertBefore(t,e)});if(t<e.getLength()){e.setText(o.slice(t));this.caret.move(e.first());return true}else{e.setText(" ");this.caret.move(e.last());return false}},toggleExternalLink:function(){var e=this,t;if(this.caret.isCollapsed()){return false}t=this._getSelectedSpans(true);if(t[0].hasModifier("link")||t[0].hasModifier("citation")){t.forEach(function(e){e.removeModifier("link");e.removeModifier("citation")})}else{this.linkSelector.getExternalURL(function(i){var n=i.url,o=i.isCitation,r=window.scrollX,a=window.scrollY,l=o?"citation":"link";if(n){n=s.ensureProtocol(n);t=e._mergeSpansBySection(t);t.forEach(function(e){e.setModifier(l,{type:"url",url:n})})}r=window.scrollX;a=window.scrollY;e.node.focus();window.scrollTo(r,a);e.caret.move(t[0].first(),t[t.length-1].last())})}return false},_mergeSpansBySection:function(e){var t=null,i=null,n=[];e.forEach(function(e){if(e.parent!=i){t=e;i=e.parent;n.push(e)}else{t.setText(t.getText()+e.getText());e.parent.removeChild(e)}});return n},insertImages:function(e){if(e.length===0){return}var t=this,i=this.caret.start,n=i.span.parent,o;if(i.atSectionStart()){o=n}else{if(!i.atSectionEnd()){n.split(i)}o=n.nextSibling()}e.forEach(function(e){t.insertBefore(T.fromURL(e),o)});if(o){this.caret.move(o.first())}else{this.caret.move(n.last())}}});var b=v.create("section",{init:function(e,t,i,n){var o=this;t=t||[new q];t.slice().forEach(function(e){o.appendChild(e)});s.setData(this.node,"type",e);this.setIndent(i||0);this.setQuoted(n)},getType:function(){return s.getData(this.node,"type")},getIndent:function(){return parseInt(s.getData(this.node,"indent"))},setIndent:function(e){e=Math.min(this.maxIndent,Math.max(0,e));return s.setData(this.node,"indent",e)},setQuoted:function(e){if(e){s.setData(this.node,"quoted","true")}else{s.removeData(this.node,"quoted")}},isQuoted:function(){return!!s.getData(this.node,"quoted")},setEditable:function(e){if(e){this.node.removeAttribute("contenteditable")}else{this.node.setAttribute("contenteditable","false")}},isEditable:function(){return this.node.isContentEditable},toJSON:function(){var e={type:this.getType(),indent:this.getIndent(),quoted:this.isQuoted(),spans:[]};this.children.forEach(function(t){e.spans.push(t.toJSON())});return e},first:function(){return this.firstChild().first()},last:function(){return this.lastChild().last()},deleteText:function(e,t){if(e.span==t.span){e.span.deleteText(e.offset,t.offset)}else{e.span.deleteText(e.offset,e.span.getLength());while(e.span.nextSibling()!=t.span){this.removeChild(e.span.nextSibling())}if(t.span){t.span.deleteText(0,t.offset);if(t.span.isEmpty()){this.removeChild(t.span)}}if(e.span.isEmpty()){if(this.children.length==1){e.span.setPlaceholder()}else{this.removeChild(e.span)}}}},isEmpty:function(){return this.children.length==1&&this.children[0].isEmpty()},_createSplitSection:function(){return new this.constructor([],this.getIndent(),this.isQuoted());
},split:function(e){var t,i=this._createSplitSection(),n,o,s=e.span,r=e.offset;if(r===0){if(s==this.firstChild()){this.insertBefore(new q,s)}o=s}else if(r===s.getLength()&&s!=this.lastChild()){o=s.nextSibling()}else{o=s.split(r,true)}t=this.children.indexOf(o)+1;n=this.children.slice(t);n.unshift(o);n.forEach(function(e){i.appendChild(e)});this.parent.insertBefore(i,this.nextSibling());return o.first()},merge:function(e){var t;if(!this.isEditable()){this.parent.removeChild(this);t=e.first()}else if(e.isEmpty()||!e.isEditable()){e.parent.removeChild(e);t=this.last()}else{if(this.isEmpty()){this.removeChild(this.firstChild());this.setIndent(e.getIndent());this.setQuoted(e.isQuoted());t=e.first()}else{t=this.last()}while(e.children.length){this.appendChild(e.firstChild())}e.parent.removeChild(e)}return t},changeType:function(e){var t=new e(this.children,this.getIndent(),this.isQuoted());this.parent.insertBefore(t,this);this.parent.removeChild(this);return t},getContentPrefix:function(e,t){if(e==f.TEXT){return this._getTextPrefix(t)}else if(e==f.HTML){return this._getHTMLPrefix(t)}},getContentSuffix:function(e,t){if(e==f.TEXT){return this._getTextSuffix(t)}else if(e==f.HTML){return this._getHTMLSuffix(t)}},_getTextPrefix:function(){var e,t="";for(e=0;e<this.getIndent()*4;e++){t+=" "}if(this.isQuoted()){t+=">"}return t},_getTextSuffix:function(){return"\n"},_getHTMLPrefix:function(e){var t="",i=e.indexOf(this),n=this.getIndent(),o=-1,s;if(i>0){s=e[i-1];if(s instanceof this.constructor){o=s.getIndent()}if(this.isQuoted()&&!s.isQuoted()){t+="<blockquote>"}}else if(this.isQuoted()){t+="<blockquote>"}while(n>o){t+=this.htmlIndentPrefix;n--}return t+this.htmlPrefix},_getHTMLSuffix:function(e){var t=this.htmlSuffix,i=e.indexOf(this),n=this.getIndent(),o=-1,s;if(i<e.length-1){s=e[i+1];if(s instanceof this.constructor){o=s.getIndent()}}while(n>o){n--;t+=this.htmlIndentSuffix}if(this.isQuoted()&&(!s||!s.isQuoted())){t+="</blockquote>"}return t},maxIndent:0});b.fromJSON=function(e){var t=[],i=p[e.type];e.spans.forEach(function(e){t.push(new q(e.text,e.modifiers))});return new i(t,e.indent,e.quoted)};var k=b.extend({init:function(e,t,i){this._super("plain",e,t,i)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});p.plain=k;var C=b.extend({init:function(e,t,i){this._super("unordered-list",e,t,i)},_getTextPrefix:function(e){return this._super(e)+"* "},maxIndent:2,htmlIndentPrefix:"<ul>",htmlIndentSuffix:"</ul>",htmlPrefix:"<li>",htmlSuffix:"</li>"});p["unordered-list"]=C;var y=b.extend({init:function(e,t,i){this._super("ordered-list",e,t,i)},_getTextPrefix:function(e){var t=this._super(e),i,n=this.getIndent(),o=e.indexOf(this)-1,s=1;while(o>=0){i=e[o];if(n>i.getIndent()||!(i instanceof this.constructor)){break}if(n==i.getIndent()){s++}o--}return t+s+". "},maxIndent:2,htmlIndentPrefix:"<ol>",htmlIndentSuffix:"</ol>",htmlPrefix:"<li>",htmlSuffix:"</li>"});p["ordered-list"]=y;var x=b.extend({init:function(e,t,i){this._super("code",e,t,i)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<pre>",htmlSuffix:"</pre>"});p.code=x;var S=b.extend({init:function(e,t,i){this._super("math",e,t,i)},_getTextPrefix:function(e){return this._super(e)+"$$"},_getTextSuffix:function(e){return"$$"+this._super(e)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<pre>$$",htmlSuffix:"$$</pre>"});p.math=S;var T=b.extend({init:function(e,t,i){s.assert(e.length==1,"ImageSections should have exactly one child:",e);s.assert(e[0].hasModifier("image"),"missing image modifier on image span");this._super("image",e,t,i);this.setEditable(false)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});T.fromURL=function(e){return new T([new q("",{image:e})])};p.image=T;var L=b.extend({init:function(e,t,i){s.assert(e.length==1,"VideoSections should have exactly one child:",e);s.assert(e[0].hasModifier("video"),"missing video modifier on video span");this._super("video",e,t,i);this.setEditable(false);this._setPreviewImage()},_setPreviewImage:function(){var e=this.children[0].getModifier("video"),t=l.parseParams(e),i,n;if(t.v){i=t.v}else{n=document.createElement("a");n.href=e;i=n.pathname.slice(1)}this.children[0].setModifier("image","https://img.youtube.com/vi/"+i+"/hqdefault.jpg")},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});L.YOUTUBE_URL_RE=/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s]+)/;L.fromURL=function(e){return new L([new q("",{video:e})])};p.video=L;var q=v.create("span",{init:function(e,t){t=t||{};this.modifiers={};this._content=s.create("div");this._content.className="content";this.node.appendChild(this._content);this._image=null;if(e){this.setText(e)}else{this.setPlaceholder()}for(var i in t){this.setModifier(i,t[i])}},toJSON:function(){return{modifiers:s.extend({},this.modifiers),text:this.getText()}},previous:function(){return this.previousSibling()||this.parent.previousSibling()&&this.parent.previousSibling().lastChild()},next:function(){return this.nextSibling()||this.parent.nextSibling()&&this.parent.nextSibling().firstChild()},first:function(){return new g(this,0)},last:function(){return new g(this,this.getLength())},setModifier:function(e,t){this.modifiers[e]=t||true;if(e=="image"){if(this._image===null){this._image=s.create("img")}this.setText("");this._content.appendChild(this._image);this._image.src=t}if(e=="underline"){this._content.style.textDecoration="underline"}this._updateClass()},removeModifier:function(e){delete this.modifiers[e];this._updateClass()},getModifier:function(e){return this.modifiers[e]},hasModifier:function(e){return e in this.modifiers},_updateClass:function(){this.node.className="span";for(var e in this.modifiers){if(this.modifiers.hasOwnProperty(e)&&this.modifiers[e]){this.node.className+=" "+e}}},isEmpty:function(){return this.node.textContent===""||this.node.innerHTML===""||this.node.innerHTML=="<br>"},getText:function(){return this._content.textContent},setText:function(e){this._content.textContent=e},deleteText:function(e,t){this.setText(this.getText().slice(0,e)+this.getText().slice(t))},getLength:function(){if(this.hasModifier("image")){return 1}return this.getText().length},getFocusNode:function(){if(s.isTextNode(this._content.firstChild)){return this._content.firstChild}return this._content},setPlaceholder:function(){this._content.innerHTML="<br/>";for(var e in this.modifiers){this.removeModifier(e)}},shouldAvoidSplitting:function(){return this.hasModifier("link")||this.hasModifier("code")||this.hasModifier("math")},split:function(e,t){var i;if(!t&&this.shouldAvoidSplitting()){return this}if(this.isEmpty()){i=new q(null,this.modifiers)}else if(e===0){i=new q(this.getText(),this.modifiers);this.setPlaceholder()}else{i=new q(this.getText().slice(e),this.modifiers);this.setText(this.getText().slice(0,e))}this.parent.insertBefore(i,this.nextSibling());return i},_toText:function(){var e,t;e=this.getText();if(this.hasModifier("math")){e="$"+e+"$"}if(this.hasModifier("italic")){e="*"+e+"*"}if(this.hasModifier("bold")){e="**"+e+"**"}if(this.hasModifier("underline")){e="_"+e+"_"}if(this.hasModifier("link")){t=this.getModifier("link");e+=" ("+t.url+")"}return e},_toHTML:function(){var e,t;if(this.hasModifier("image")){return'<img src="'+this.getModifier("image")+'"/>'}e=this.getText();if(this.hasModifier("italic")){e="<i>"+e+"</i>"}if(this.hasModifier("bold")){e="<b>"+e+"</b>"}if(this.hasModifier("underline")){e="<u>"+e+"</u>"}if(this.hasModifier("link")){t=this.getModifier("link");e='<a href="'+t.url+'">'+e+"</a>"}if(this.hasModifier("code")){e="<code>"+e+"</code>"}else if(this.hasModifier("math")){e="<code>$"+e+"$</code>"}return e},toContent:function(e){if(e==f.TEXT){return this._toText()}else if(e==f.HTML){return this._toHTML()}}});exports.CONTENT_TYPES=f;exports.Position=g;exports.Caret=_;exports.Container=v;exports.Doc=w;exports.Section=b;exports.PlainSection=k;exports.UnorderedListSection=C;exports.OrderedListSection=y;exports.CodeSection=x;exports.MathSection=S;exports.ImageSection=T;exports.VideoSection=L;exports.Span=q},{"qtext2/undo":true,"interface/settings":true,"qtext2/parser":true,log:true,window_manager:true,"qtext2/util":true,"third_party/rangy-core":true,"qtext2/keys":true,"qtext2/mutations":true,linkify:true,Class:true,browser:true});require.install("qtext2/ui",function(require,exports,module){var e=require("Class").Class;exports.LinkSelector=e.extend({show:function(){},hide:function(){},onSubmit:function(){},onCancel:function(){},getExternalURL:function(){}})},{Class:true});require.install("unified_view/upload",function(require,exports,module){exports.uploadImages=function(e,t,i,n){var o=new FormData;o.append("formkey",require("settings").formkey);o.append("kind",e);for(var s=0;s<t.length;s++){o.append("file",t[s])}var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState!=4){return}if(r.status!=200){n()}var e=JSON.parse(r.response);if(e.success){i(e.qimg_urls)}else{n(e.message)}};r.open("POST","/_/imgupload/upload_POST",true);r.send(o)}},{settings:true});require.install("unified_view/qtext2/editor",function(require,exports,module){var e=require("interface/component").Component,t=require("qtext2/util").Util,i=require("qtext2/base").Doc,n=require("interface/settings").pageIsMobile,o=require("qtext2/ui"),s=require("unified_view/upload"),r,a,l=require;if(n){r=l("mobile_app2/client")}else{a=l("window_manager")}var u=function(e,i,n,o){var r=function(){i.innerHTML=o.drop_images;i.classList.remove("hidden");i.style.lineHeight=e.node.clientHeight+"px"};var a=function(){i.classList.remove("uploading");i.classList.add("hidden")};var l=function(e){r();if(e>1){i.innerHTML=o.uploading_images.replace("{}",e)}else{i.innerHTML=o.uploading_image}};var u=function(t){e.saveState();e.insertImages(t);a()};var d=function(e){a1ert(e||o.upload_error);a()};var c=function(e){if(e.length){l(e.length);s.uploadImages("qtext",e,u,d)}else{a()}};t.on("dragenter",e.node,r);t.on("dragleave",i,a);t.on("dragover",i,function(e){e.preventDefault()});t.on("drop",i,function(e){e.preventDefault();e.stopPropagation();if(!e.dataTransfer){a();return}c(e.dataTransfer.files)});t.on("change",n,function(){c(n.files)});t.on("paste",e.node,function(e){var t=e.clipboardData,i=[];if(!t||!t.items){return false}for(var n=0;n<t.items.length;++n){var o=t.items[n].type;if(o.match(/image/i)||o.match(/file/i)){i.push(t.items[n].getAsFile())}}c(i);return false})};var d=o.LinkSelector.extend({__init__:function(e,t,i){this.toolbar=e;this.$selector=t;this.$wrapper=i;this._onSubmitCallback=null},show:function(e,t){var i,o=this;if(n){this.toolbar.createModal("load_link_selector").onSubmit(function(e){if(o._onSubmitCallback){o._onSubmitCallback(e)}}).show()}else{i=this.$wrapper.parent().offset();e-=i.left;t-=i.top;this.$selector.clearInput();this.$wrapper.css("position","absolute").css("left",e).css("top",t).removeClass("hidden");this.$selector.focus(true);this.$selector.setCallback(function(){if(o._onSubmitCallback){o._onSubmitCallback({text:o.$selector.result.value,url:o.$selector.result.url})}});this.$selector.setEscKeyDown(function(e){var t="@"+o.$selector.getValue();if(e.keyCode==27||t==="@"&&(e.keyCode==8||e.keyCode==13)){if(o._onCancelCallback){o._onCancelCallback(t);return false}}})}},hide:function(){if(!n){this.$wrapper.addClass("hidden")}},onSubmit:function(e){this._onSubmitCallback=e},onCancel:function(e){this._onCancelCallback=e},getExternalURL:function(e){this.toolbar.on("linkInput",e);this.toolbar.showBar(0)}});exports.Editor=e.extend({onLoad:function(){var e=this;this.toolbar=this.child("toolbar");this.doc=new i;this.doc.fromJSON(this.content_json);u(this.doc,this.$id("@drop_zone").get(0),this.$id("@file").get(0),this.interface_strings);this.doc.setLinkSelector(new d(this.toolbar,this.child("link_selector"),this.unsafe$id("@link_selector_wrapper")));this.toolbar.on("click",function(t){if(t=="image"){e.unsafe$id("@file").click()}else if(t=="link_hide"){e.toolbar.showBar(1)}else if(t=="overflow_show"){e.toolbar.showBar(2)}else if(t=="overflow_hide"){e.toolbar.showBar(1)}else{e.doc.handleCommand(t)}});this.toolbar.on("imageUpload",function(t){e.doc.insertImages(t)});this.unsafe$id("@doc").append(this.doc.node);this.doc.node.setAttribute("placeholder",this.interface_strings.placeholder);this.doc.on("focus",function(){e.toolbar.makeActive(e.doc)});this.toolbar.makeActive(this.doc);this.$id("@fake_editor").on("click",this.hideFakeEditor.bind(this));this._setupEventListeners()},_setupEventListeners:function(){var e=this;this.doc.on("focus",function(){if(e._onFocus){e._onFocus()}});this.doc.on("blur",function(){if(e._onBlur){e._onBlur()}});this.doc.on("meaningfulChange",this.reportMeaningfulChange.bind(this));this._trackTypingState()},_trackTypingState:function(){var e=this,t=10*1e3,i=55*1e3,n="empty",o=0,s=0,r;var a=function(){var l,u,d=(new Date).getTime();if(e.isEmpty()){l="empty"}else{if(o<d-t){l="paused"}else{l="typing"}if(s<d-i){u=true}}if(l!=n){u=true}if(u&&e._onTypingStateChange){e._onTypingStateChange(l);n=l;s=d}if(r){clearTimeout(r);r=null}if(l=="typing"||l=="paused"){r=setTimeout(a,t)}};this.doc.on("keydown",function(){o=(new Date).getTime();a()})},setFocusCallback:function(e){this._onFocus=e},setBlurCallback:function(e){this._onBlur=e},setMeaningfulChangeCallback:function(e){this._onMeaningfulChange=e},reportMeaningfulChange:function(){if(this._onMeaningfulChange){this._onMeaningfulChange()}},setTypingStateCallback:function(e){this._onTypingStateChange=e},isInteractive:function(){return true},isEmpty:function(){return this.doc.isEmpty()},stopTyping:function(){},fixEditorButtons:function(){this.toolbar.fix()},focus:function(){this.doc.node.focus()},hideFakeEditor:function(){this.$id("@fake_editor").addClass("hidden");this.$id("@editor").removeClass("hidden");this.focus();this.fixEditorButtons()},serialize:function(){return this.doc.toJSON()},hasChanged:function(e){return this.doc.hasChanged(e)},disable:function(){},enable:function(){},clear:function(){this.doc.fromJSON({})}});exports.Answer=exports.Editor.extend({onLoad:function(){this._super.apply(this,arguments);this.setupKeyboardShortcuts()},setAnswerLaterCallback:function(e){this.$id("@answer_later_link").on("click",e)},setupKeyboardShortcuts:function(){var e=this,t=this.unsafe$id("@editor_outer");this.onKeyCombination(t,"a",function(){a.scrollIntoView(t);e.hideFakeEditor();return false});this.onKeyCombination(t,"Escape",function(){e.doc.node.blur();var i=t;while(i.get(0)!==document.body&&!i.hasClass("kbfocusable")){i=i.parent()}i.click().focus();return false},null,true)}})},{"interface/settings":true,"interface/component":true,"qtext2/base":true,"qtext2/util":true,"unified_view/upload":true,"qtext2/ui":true});require.install("unified_view/qtext2/editor/mobile",function(require,exports,module){var e,t=require("interface/settings").pageIsMobile,i=require("unified_view/modal").ModalBase,n=require("qtext2/util").Util,o=require;if(t){e=o("mobile_app2/client")}exports.EditorModal=i.extend({onLoad:function(){var t=this;this._super.apply(this,arguments);this.editor=this.lookup("editor");exports.activeEditor=this;e.sendMessageToClient("setupEditor",{hasDraft:!!this.has_draft});e.sendMessageToClient("restoreState",{key:this.getKey()});this.editor.setFocusCallback(function(){exports.activeEditor=t});this.editor.setMeaningfulChangeCallback(this.saveState.bind(this))},focus:function(){this.editor.focus()},saveState:function(){e.sendMessageToClient("saveState",{key:this.getKey(),value:this.editor.serialize()})},restoreState:function(e){this.editor.doc.fromJSON(e)},_onDraftSaveSuccess:function(){e.sendMessageToClient("draftSaveComplete",{success:true})},_onDraftSaveError:function(){e.sendMessageToClient("draftSaveComplete",{success:false})},_onDraftClearSuccess:function(){e.sendMessageToClient("draftClearComplete",{key:this.getKey(),success:true})},_onDraftClearError:function(){e.sendMessageToClient("draftClearComplete",{key:this.getKey(),success:false})},saveDraft:function(){if(!this.has_draft){e.sendMessageToClient("dismissModal");return}var t=n.extend(this.getExtraKwargs(),{content:this.editor.serialize()});e.sendMessageToClient("showLoadingView");this.serverCall("save_draft").kwargs(t).success(this._onDraftSaveSuccess.bind(this)).error(this._onDraftSaveError.bind(this)).send()},clearDraft:function(){if(!this.has_draft){e.sendMessageToClient("dismissModal");return}e.sendMessageToClient("showLoadingView");this.serverCall("clear_draft").kwargs(this.getExtraKwargs()).success(this._onDraftClearSuccess.bind(this)).error(this._onDraftClearError.bind(this)).send()},onSubmit:function(){var t=this._super.bind(this),i=n.extend(this.getExtraKwargs(),{content:this.editor.serialize()});e.sendMessageToClient("showLoadingView");this.serverCall("submit").kwargs(i).success(function(i){e.sendMessageToClient("hideLoadingView");if(i.value.success){t(i)}}).error(function(){e.sendMessageToClient("hideLoadingView")}).send()},getKey:function(){throw new Error("Not implemented")}});exports.WriteAnswerModal=exports.EditorModal.extend({getKey:function(){return"question-"+this.qid},getExtraKwargs:function(){return{qid:this.qid}}});exports.EditAnswerModal=exports.EditorModal.extend({getKey:function(){return"answer-"+this.aid},getExtraKwargs:function(){return{aid:this.aid}}});exports.SuggestAnswerEditsModal=exports.EditorModal.extend({getKey:function(){return"answer-"+this.aid},getExtraKwargs:function(){return{aid:this.aid}}});exports.EditAnswerWikiModal=exports.EditorModal.extend({getKey:function(){return"answer-wiki-"+this.qid},getExtraKwargs:function(){return{qid:this.qid}}});exports.EditBlogDescriptionModal=exports.EditorModal.extend({getKey:function(){return"blog-description-"+this.bid},getExtraKwargs:function(){return{bid:this.bid}}});exports.LinkSelector=i.extend({onLoad:function(){var t=this;this._super.apply(this,arguments);e.registerOneTimeMessageHandler("addLinkSelectorPressed",function(e){t.onSubmit(e)});e.sendMessageToClient("showSearchInput",{searchPlaceholderText:this.interface_strings.search_placeholder,searchFocus:true,searchCancelButton:false})}});exports.activeEditor=null},{"interface/settings":true,"unified_view/modal":true,"qtext2/util":true});require.install("qtext2",function(require,exports,module){var e=require("unified_view/qtext2/editor/mobile"),t=require("unified_view/qtext2/toolbar");exports.handleToolbarAction=function(e,i){if(t.activeToolbar){t.activeToolbar.trigger(e,i)}};exports.handleRestoreState=function(t){e.activeEditor.restoreState(t)};exports.saveDraft=function(){e.activeEditor.saveDraft()};exports.clearDraft=function(){e.activeEditor.clearDraft()};exports.focus=function(){e.activeEditor.focus()}},{"unified_view/qtext2/toolbar":true,"unified_view/qtext2/editor/mobile":true});require.install("unified_view/qtext2/toolbar",function(require,exports,module){var e=require("interface/component").Component,t=require("interface/settings").pageIsMobile,i=require("qtext2"),n=require("qtext2/util").Util,o=require,s;if(t){s=o("mobile_app2/client")}var r=e.extend({onLoad:function(){this._barIdx=1},on:function(e,t){this._handlers=this._handlers||[];this._handlers[e]=t},trigger:function(e,t){if(this._handlers[e]){this._handlers[e](t)}},makeActive:function(e){this.showBar(1);this._doc=e;this._startUpdating();exports.activeToolbar=this},makeInactive:function(){this._doc=null;exports.activeToolbar=null},showBar:function(e){if(this._barIdx<e){this._animation="up"}else if(this._barIdx>e){this._animation="down"}else{this._animation=""}this._barIdx=e},_startUpdating:function(){var e=this;var t=function(){if(e._doc){e.update(e._doc.getToolbarState(e._barIdx),e._animation);e._animation=false;requestAnimationFrame(t)}};t()},update:function(e,t){if(n.jsonEqual(e,this.currentState)){return}this._update(e,t);this.currentState=e},_update:null});exports.Web=r.extend({onLoad:function(){this._super.apply(this,arguments);var e=this,t=e.$id("@link_input");e.buttons.forEach(function(t){var i=t=="image"?"click":"touchstart mousedown";e.$id("@"+t).on(i,function(){e.trigger("click",t);return false})});var i=function(){e.trigger("linkInput",{url:t.val(),isCitation:e.$id("@is_citation").attr("checked")=="checked"});t.val("")};e.$id("@link_save").on("click",function(){i();return false});t.on("keydown",function(e){if(e.which==13){e.preventDefault();e.stopPropagation();i()}else if(e.which==27){e.preventDefault();e.stopPropagation();t.val("");i()}});e.fix()},_update:function(e,t){var i=this,n,o=this.unsafe$id("@bar"+this._barIdx),s=i.unsafe$id("@storage"),r=o.children(".left"),a=i.unsafe$id("@scroller");o.find(".modifier").each(function(e,t){s.append(t)});e.forEach(function(e){if(e.name=="space"){r=o.children(".right")}else{n=i.unsafe$id("@"+e.name);if(e.disabled){n.removeClass("pressed");n.addClass("disabled")}else if(e.pressed){n.removeClass("disabled");n.addClass("pressed")}else{n.removeClass("disabled");n.removeClass("pressed")}r.append(n);if(e.focused){n.focus()}}});if(t){a.addClass("animate")}else{a.removeClass("animate")}a.css("top",-this._barIdx*100+"%")},fix:function(){var e=this.unsafe$id("@toolbar"),t=e.parent(),i=$(".SiteHeader").height();var n=function(){var o=t.offset().top-document.body.scrollTop-i,s=o+t.height()-e.height()*2;if(o<0&&s>0){e.css("position","fixed").css("top",i).css("left",t.offset().left).css("width",t.width())}else{e.css("position","absolute").css("top",0).css("left",0).css("width","")}window.requestAnimationFrame(n)};n()}});exports.activeToolbar=null;var a=this;exports.MobileWebShim=exports.Web.extend({onLoad:function(){this._super.apply(this);a=this},trigger:function(e,t){i.handleToolbarAction(e,t)},fix:function(){var e=this.unsafe$id("@toolbar");var t=function(){if(document.body.scrollTop>e.height()){e.css("position","absolute");e.css("top",document.body.scrollTop+"px")}else{e.css("position","");e.css("top","")}window.requestAnimationFrame(t)};t()}});exports.updateMobileWebShim=function(e){if(a){var t=1;for(var i=0;i<e.buttons.length;i++){if(e.buttons[i].name=="link_input"){t=0;break}else if(e.buttons[i].name=="undo"){t=2;break}}a.showBar(t);a.update(e.buttons,e.animation)}};exports.Mobile=r.extend({makeActive:function(){this._super.apply(this,arguments)},_update:function(e,t){s.sendMessageToClient("updateToolbar",{buttons:e,animation:t})}})},{qtext2:true,"interface/settings":true,"interface/component":true,"qtext2/util":true});require.install("unified_view/character_counter",function(require,exports,module){var e=require("interface/component").Component;exports.CharacterCounter=e.extend({updateCounter:function(e){var t=this,i=t.$id("@counter");t.left=parseInt(t.limit)-e;i.text(t.left);i.toggleClass("warning",t.left<=t.warning_limit);t.updateVisibility()},updateVisibility:function(){if(this.left<this.visible_on){this.show()}else{this.hide()}},show:function(){if(this.left<this.visible_on){this.$id("@counter").removeClass("fade_out")}},hide:function(){if(this.left>=0){this.$id("@counter").addClass("fade_out")}}})},{"interface/component":true});require.install("unified_view/main",function(require,exports,module){true||require("unified_view/action_bar/base");true||require("unified_view/action_bar/answer");true||require("unified_view/action_bar/_action_bar");true||require("unified_view/action_bar/shared");true||require("unified_view/action_bar/blog");true||require("unified_view/action_bar/question");true||require("unified_view/action_bar/remove_from_feed");true||require("unified_view/action_bar/user");true||require("unified_view/action_bar/overflow_menu/answer");true||require("unified_view/action_bar/overflow_menu/base");true||require("unified_view/action_bar/overflow_menu/profile");true||require("unified_view/action_bar/overflow_menu/question");true||require("unified_view/action_bar/overflow_menu/remove_from_feed");true||require("unified_view/action_bar/overflow_menu/shared");true||require("unified_view/button/abstract");true||require("unified_view/button/downvote");true||require("unified_view/button/follow");true||require("unified_view/button/pin");true||require("unified_view/button/reask");true||require("unified_view/button/slow_connection");true||require("unified_view/button/network");true||require("unified_view/button/upvote");true||require("unified_view/button/write_answer");true||require("unified_view/button/writing_list");true||require("unified_view/lazy");true||require("unified_view/network/invite");true||require("unified_view/network/join");true||require("unified_view/payment/money");true||require("unified_view/payment/_payment");true||require("unified_view/privacy");true||require("unified_view/settings/privacy");true||require("unified_view/switch");true||require("unified_view/toggle");true||require("unified_view/util");true||require("unified_view/privacy");true||require("unified_view/modal");true||require("unified_view/mobile_debug");true||require("unified_view/translation");true||require("unified_view/qtext");true||require("unified_view/qtext2/editor");true||require("unified_view/qtext2/editor/mobile");true||require("unified_view/qtext2/toolbar");true||require("unified_view/character_counter")},{"unified_view/qtext2/editor/mobile":true,"unified_view/action_bar/overflow_menu/base":true,"unified_view/payment/_payment":true,"unified_view/action_bar/shared":true,"unified_view/button/downvote":true,"unified_view/action_bar/overflow_menu/answer":true,"unified_view/button/write_answer":true,"unified_view/network/invite":true,"unified_view/action_bar/base":true,"unified_view/action_bar/user":true,"unified_view/qtext2/toolbar":true,"unified_view/qtext":true,"unified_view/translation":true,"unified_view/action_bar/overflow_menu/profile":true,"unified_view/toggle":true,"unified_view/action_bar/answer":true,"unified_view/button/network":true,"unified_view/button/writing_list":true,"unified_view/button/slow_connection":true,"unified_view/network/join":true,"unified_view/action_bar/remove_from_feed":true,"unified_view/button/reask":true,"unified_view/action_bar/_action_bar":true,"unified_view/button/upvote":true,"unified_view/settings/privacy":true,"unified_view/action_bar/overflow_menu/question":true,"unified_view/lazy":true,"unified_view/payment/money":true,"unified_view/switch":true,"unified_view/qtext2/editor":true,"unified_view/action_bar/question":true,"unified_view/button/abstract":true,"unified_view/character_counter":true,"unified_view/action_bar/blog":true,"unified_view/action_bar/overflow_menu/remove_from_feed":true,"unified_view/mobile_debug":true,"unified_view/privacy":true,"unified_view/button/pin":true,"unified_view/util":true,"unified_view/modal":true,"unified_view/action_bar/overflow_menu/shared":true,"unified_view/button/follow":true});require.install("unified_view/captcha",function(require,exports,module){var e=require("interface/component").Component,t=require("w2.context").CaptchaInput;var i=[],n=false;var o=function(e){if(n===false){i.push(e)}else{e.render()}};exports.captchaLoaded=function(){n=true;i.map(o)};exports.CaptchaInput=e.extend({onLoad:function(){var e=this;e._isGrecaptchaReady=false;e.captchaContext=e.getContext(t);e.captchaContext.on("sync",function(t,i){var n=e.getCaptchaResponse();e.captchaContext.set("captchaResponse",n);e.captchaContext.set("isCaptchaFilled",n!==""&&n!=="random string");if(i===true){e.maybeAddValidationText()}});e.renderedId=null;o(e)},getCaptchaResponse:function(){var e=this;if(e.renderedId!==null&&n===true){return grecaptcha.getResponse(e.renderedId)}return""},render:function(){var e=this;var t=function(){e.captchaContext.set("sync",true)};var i=e.$id("@captcha");var n=i.get()[0];e.renderedId=grecaptcha.render(n.id,{sitekey:e.recaptcha_key,theme:"light",callback:t,"expired-callback":t})},maybeAddValidationText:function(){var e=this;var t=e.getCaptchaResponse();if(t===""){e.$id("@captcha_validation_text").text(e.missing_captcha_text)}else{e.$id("@captcha_validation_text").text("")}}})},{"interface/component":true,"w2.context":true});require.install("app/view/ama",function(require,exports,module){var e=require("interface/settings").pageIsMobile,t=require("unified_view/modal").ModalBase,i=require;if(!e){var n=i("webnode2"),o=n.ModalWithCallBacks}var s=require("interface/component").Component,r=require("view/fixable2"),a=require("view/selector").ServerCallSelector;exports.AMAAddQuestionSelector=a.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionMarkInserted=false},serverCallHandler:function(e,t){this._super.apply(this,arguments);this.setQuery("")},resultsServerCallHandler:function(){this._super.apply(this,arguments);this.$input.focus()},updateResults:function(){var e=this;if(!e._busy){e.setBusy(true);e.serverCall("results_content_for").contentFor(e.$results,{parentCID:e.cid}).kwargs({query:e.query}).success(e.fnbind(e.resultsServerCallHandler)).except(e.fnbind(e.resultsServerCallHandler)).error(e.fnbind(e.resultsServerCallHandler)).send()}},createNewQuestion:function(){var e=this;if(e.hasPendingServerCall()){return}e.makeServerCall(e.serverCall("create_new_question").kwargs({input_text:e.query}).liveMutate())},pickExistingQuestion:function(e){var t=this;if(t.hasPendingServerCall()){return}t.makeServerCall(t.serverCall("pick_existing_question").kwargs({qid:e}))},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery("");this.questionMarkInserted=false;return}if(!this.query){this.questionMarkInserted=false;return}if(this.questionMarkInserted){return}if(this.query.match(/[?]$/)===null){this.questionMarkInserted=true;this.setQuery(this.query+"?")}},queryDidChange:function(){this._super.apply(this,arguments);this.maybeInsertQuestionMark()},resultWasSelected:function(e){switch(e.ty){case"question":this.pickExistingQuestion(e.data.qid);break;case"create_question":this.createNewQuestion();break}}});exports.AMACoverBar=s.extend({onLoad:function(){var e=this.$id("@coverbar").get(0);if(e){r.makeFixable(e,{scroll_dep:true})}}});exports.AMAWriterStats=s.extend({onLoad:function(){var e=this.$id("@writer_stats").get(0);if(e){r.makeFixable(e,{scroll_dep:true})}}});exports.AMAMetricGraph=s.extend({onLoad:function(){var e=new Rickshaw.Graph({element:this.$id("@rsgraph").get(0),series:[{color:"steelblue",data:this.series_data}],width:150,height:40,interpolation:"basis",renderer:"line"});e.render()}});exports.FinishSessionButton=s.extend({onLoad:function(){this.$id("@finish_session_button").on("click",this.finishSessionConfirm.bind(this))},finishSessionConfirm:function(){this.createModal("finish_session_confirm").onSubmit(this.finishSession.bind(this)).show()},finishSession:function(){this.serverCall("finish_session").kwargs({ama_id:this.ama_id}).success(this.redirectToSessionPage.bind(this)).send()},redirectToSessionPage:function(){window.location.replace(this.redirect_url)}})},{"view/selector":true,"interface/settings":true,"unified_view/modal":true,"interface/component":true,"view/fixable2":true});require.install("app/view/tribes",function(require,exports,module){var e=require("w2.quora").Component,t=require("cookies"),i=require("linkify"),n=require("w2.context").TribeChat,o=require("view/modal").Base;exports.allMessageListComponents={};exports.notifyMessageListComponent=function(e){if(e.channel_id in exports.allMessageListComponents){exports.allMessageListComponents[e.channel_id].addMessage(e)}};exports.TribeChat=e.extend({contextConstructor:function(){return n},onLoad:function(){var e=this;this.tribeChatContext=this.getContext(n);var i=t.cookie(e.getCookieName())&&t.cookie(e.getCookieName())=="1";if(i){e.tribeChatContext.set("minimized",true)}e.$("#@title").click(function(){if(e.tribeChatContext.get("minimized")===false){e.hidePopup()}else{e.showPopup()}});e.$("#@title_link").click(function(e){e.stopPropagation()});e.tribeChatContext.set("unreadMessageCount",e.unread_count);e.tribeChatContext.on("unreadMessageCount",function(t,i){e.updateUnreadCount(i)})},getCookieName:function(){return this.cookie_prefix+String(this.channel_id)},updateUnreadCount:function(e){
if(e===0){this.$("#@unread_badge").addClass("hidden")}else{this.$("#@unread_badge").removeClass("hidden");this.$("#@unread_badge").text(e)}},hidePopup:function(){this.tribeChatContext.set("minimized",true);t.cookie(this.getCookieName(),"1")},showPopup:function(){this.tribeChatContext.set("minimized",false);t.cookie(this.getCookieName(),"0")}});exports.MessageList=e.extend({onLoad:function(){var e=this;this.tribeChatContext=this.getContext(n);e.pageTitle=document.title;exports.allMessageListComponents[e.channel_id]=e;e.sortMessages();e.renderMessageList();e.tribeIsSeen=false;e.notifyBrowserTab();setTimeout(function(){e.initSeenDetection()},100);e.tribeChatContext.on("minimized",function(t,i){if(i===true){e.$("#@messages").addClass("hidden")}else{e.$("#@messages").removeClass("hidden");e.scrollMessageList()}})},sortMessages:function(){this.messages.sort(function(e,t){return e.time-t.time})},getCookieName:function(){return"tv-"+String(this.channel_id)},getCurrentTime:function(){return(new Date).getTime()*1e3},getUser:function(e){var t=$.grep(this.users,function(t){return t.uid==e});return t[0]},initSeenDetection:function(){var e=this;e.$("#@messages").on("wheel click",function(){clearTimeout(e.unseenTimer);e.markTribeAsSeen(e.getCurrentTime())});e.tribeChatContext.on("messageBoxFocused",function(t,i){if(i===true){clearTimeout(e.unseenTimer);e.markTribeAsSeen(e.getCurrentTime())}})},startUnseenTimer:function(){var e=this;e.unseenTimer=setTimeout(function(){e.markTribeAsUnseen()},1e4)},notifyBrowserTab:function(){var e=this;e.notifyBrowserInterval=setInterval(function(){var t=e.tribeChatContext.get("unreadMessageCount");if(t===0){return}if($('link[rel="shortcut icon"').length===0){var i='<link type="image/x-icon" rel="shortcut icon"'+'href="'+e.favicon_url+'">';$("head").append(i)}if(document.title==e.pageTitle){if(t==1){document.title="1 New Message"}else{document.title=t+" New Messages"}}else{document.title=e.pageTitle}},2e3)},resetBrowser:function(){var e=this;document.title=e.pageTitle;if($('link[rel="shortcut icon"').length>0){var t="/static/images/favicon.ico";$('link[rel="shortcut icon"').attr("href",t)}clearInterval(e.notifyBrowserInterval)},markTribeAsUnseen:function(){this.tribeIsSeen=false;this.notifyBrowserTab();this.tribeChatContext.set("messageBoxFocused",false)},markTribeAsSeen:function(e){this.tribeIsSeen=true;this.tribeChatContext.set("unreadMessageCount",0);this.startUnseenTimer();this.resetBrowser();this.serverCall("mark_channel_as_seen").kwargs({channel_id:this.channel_id,time:e}).send()},addMessage:function(e){var t=this;if(t.channel_id!=e.channel_id){return}var i=0;for(var n=0;n<t.messages.length;n++){if(t.messages[n].message_id==e.message_id){return}if(t.messages[n].time<e.time){i=n+1}}t.messages.splice(i,0,e);if(t.messages.length>100){t.messages.shift()}t.renderMessageList();if(t.viewer!==e.uid&&t.tribeIsSeen===false){var o=t.tribeChatContext.get("unreadMessageCount");o+=1;t.tribeChatContext.set("unreadMessageCount",o)}},prettyTime:function(e){var t=new Date(e/1e3),i=t.getHours(),n="0"+t.getMinutes();return i+":"+n.substr(-2)},getMessageHtml:function(e){var t=document.createElement("div");t.appendChild(document.createTextNode(e));t=t.innerHTML;var n="";i.linkify(t,{callback:function(e,t){if(t){n+='<a target="_blank" href="'+t+'">'+e+"</a>"}else{n+=e}}});return n},renderMessage:function(e){var t=this.getUser(e.uid);if(!t){return""}var i=$("<div/>",{"class":"tribe_message"}),n=t.name+" "+this.prettyTime(e.time);i.append($("<a/>",{"class":"profile_photo_link",href:t.url}).append($("<img/>",{"class":"profile_photo_img",src:t.photo_url,title:t.name})).append($("<div/>",{"class":"profile_photo_tooltip",text:n}))).append($("<div/>",{"class":"tribe_message_contents"}).append($("<span/>",{html:this.getMessageHtml(e.message)})));return i},renderTimestamp:function(e){return $("<div/>",{"class":"tribe_timestamp",text:this.prettyTime(e.time)})},renderMessageList:function(){var e=this,t=0,i=e.$("#@messages");i.empty();e.messages.forEach(function(n,o){if(o!==0&&n.time-t>=18e8){i.append(e.renderTimestamp(n))}t=n.time;i.append(e.renderMessage(n))});e.scrollMessageList()},scrollMessageList:function(){var e=this;e.$("#@messages").scrollTop(e.$("#@messages").prop("scrollHeight"))}});exports.ComposeMessageBox=e.extend({onLoad:function(){var e=this,t=this.$("#@message_box");this.tribeChatContext=this.getContext(n);e.initTextarea(t);t.on("click",function(){e.tribeChatContext.set("messageBoxFocused",true)});t.on("blur",function(){e.tribeChatContext.set("messageBoxFocused",false)});t.on("keydown",function(i){if(e.tribeChatContext.get("messageBoxFocused")===false){e.tribeChatContext.set("messageBoxFocused",true)}if(i.keyCode==13){if(t.val().length!==0){e.serverCall("add_message").kwargs({message:t.val()}).send()}setTimeout(function(){t.val("");t.css("height","auto")},1)}});e.tribeChatContext.on("minimized",function(e,i){if(i===true){t.addClass("hidden")}else{t.removeClass("hidden")}})},initTextarea:function(e){e.on("keydown paste",function(){var t=e.height(),i=parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")),n=parseInt(e.prop("scrollHeight"))-i;if(this.max&&n>this.max){n=this.max}if(n>t-i){e.css("height",n+"px")}})}});exports.ManageMembersModalLink=e.extend({onLoad:function(){var e=this;this.$("#@modal_link").on("click",function(t){e.modal("load_inner");t.preventDefault()})}});exports.ManageMembersModal=o.extend({onLoad:function(){this._super.apply(this,arguments);this.lookup("people_selector").inputFocus()},setTo:function(e){if(isNaN(parseInt(e))){return}this.serverCall("add_member").kwargs({channel_id:this.channel_id,to_uid:e}).send();this.lookup("people_selector").reset()}})},{linkify:true,cookies:true,"view/modal":true,"w2.context":true,"w2.quora":true});require.install("app/view/bounty/_bounty",function(require,exports,module){var e=require("w2.quora").Component;exports.BountyBadge=e.extend({onLoad:function(){var e=this;e.$("#@learn_more").click(function(t){t.preventDefault();e.modal("load_detail_modal")})}})},{"w2.quora":true});require.install("app/view/bounty/manage",function(require,exports,module){var e=require("w2.quora").Component,t=require("view/modal").Base;exports.BountyManage=e.extend({onLoad:function(){var e=this;e.$("#@choose_best").click(function(t){t.preventDefault();e.modal("load_choose_best_modal")})}});exports.BountyAddLink=e.extend({onLoad:function(){var e=this;e.$("#@link").click(function(t){t.preventDefault();e.modal("load_modal")})}});exports.BountyAddModal=t.extend({onSubmit:function(){var e=this,t=e.child("add_card_form",true);function i(){e.child("bounty_add_form").submit(function(){e._closeModal()})}if(t){t.submit(function(){i()})}else{i()}}});exports.BountyAddForm=e.extend({onLoad:function(){this.isSubmitting=false},isValid:function(){var e=this.getValues();return!!e.question_text},getAmountCents:function(){var e=this.$("#@amount_picker input[type=radio]:checked");if(e){return parseInt(e.val())}},getValues:function(){return{question_text:this.$("#@question_text").val(),question_details:this.$("#@question_details").val(),amount_cents:this.getAmountCents(),anonymous:this.$("#@anonymous").attr("checked")==="checked"}},submit:function(e){var t=this;if(!t.isSubmitting){t.isSubmitting=true;t.serverCall("submit").kwargs(this.getValues()).success(function(){t.isSubmitting=false;e()}).error(function(){t.isSubmitting=false}).liveMutate().send()}}});exports.BountyChooseBestModal=t.extend({onSubmit:function(){var e=this;e.child("choose_best_form").submit(function(){e._closeModal()})}});exports.BountyChooseBestForm=e.extend({onLoad:function(){this.isSubmitting=false},isValid:function(){return!!this.getSelectedAIDs().length},getSelectedAIDs:function(){var e=[];this.$("#@checkboxes input[type=checkbox]:checked").map(function(){e.push(parseInt(this.value))});return e},submit:function(e){var t=this;if(t.isValid()&&!t.isSubmitting){t.isSubmitting=true;t.serverCall("submit").kwargs({aids:t.getSelectedAIDs()}).success(function(){t.isSubmitting=false;e()}).error(function(){t.isSubmitting=false}).liveMutate().send()}}})},{"view/modal":true,"w2.quora":true});require.enqueue(function(require){require("json2");require("assert");require("log");require("jquery");require("jquery.securepost");require("jquery.cookie");require("jquery.dialog");require("jquery.tooltip");require("jquery.menu");require("jquery.topic");require("jquery.viewport");require("spin");require("jquery.whenIdle");require("Class");require("jquery.ajax");require("effects.core");require("effects.shake");require("effects.highlight");require("jquery.webnode2");require("jquery.quora");require("polyfills/requestAnimationFrame");require("w2.errors");require("w2.dialog");require("w2.modal");require("w2.rpc");require("w2.interaction");require("w2.event");require("w2.quora");true||require("tchannel_up");require("init");require("facebook");require("twitter");require("google_");require("mathjax");require("login");require("network");require("dialog");require("mobile");require("keystrokes");require("view/captcha");require("view/repeat_offender");require("view/reauth");require("lazy_load_images");true||require("sticky");true||require("view/spinner");true||require("view/embed");true||require("view/embed_editor");true||require("view/placepicker");true||require("view/selector");true||require("view/question_selector");true||require("view/pmsg");true||require("app/view/home");true||require("app/view/mathjax");true||require("app/view/messages");true||require("app/view/common");true||require("app/view/feed");true||require("app/view/feed/feedback");true||require("app/view/settings");true||require("app/view/tutorial");true||require("app/view/question");true||require("app/view/question/wanted_answer");true||require("app/view/question/cant_answer");true||require("app/view/question/merge/_merge");true||require("app/view/question/merge/selector");true||require("app/view/question/merge/modal");true||require("app/view/board");true||require("app/view/board/blog");true||require("app/view/board/create_box");true||require("app/view/board/follow_invite");true||require("app/view/topic");true||require("app/view/topic/topic_list");true||require("app/view/topic/topic_redesign");true||require("app/view/topic/location");true||require("app/view/topic/merge");true||require("app/view/signup");true||require("app/view/signup/google_");true||require("app/view/share/connect");true||require("app/view/share/form");true||require("app/view/share/modal");true||require("app/view/contact_importer");true||require("app/view/growl");true||require("app/view/notifications");true||require("app/view/notifications/base");true||require("app/view/notifications/header");true||require("app/view/navigation");true||require("app/view/nux");true||require("app/view/nux/dialog");true||require("app/view/nux/existing_user");true||require("app/view/nux/find_friends");true||require("app/view/activation/endorsement");true||require("app/view/activation/endorsement/modal");true||require("app/view/activation/endorsement/endorse_by_topic");true||require("app/view/activation/endorsement/endorse_by_user");true||require("app/view/activation/profile_topics");true||require("app/view/activation/progress");true||require("app/view/activation/topic_bios");true||require("app/view/post");true||require("app/view/user");true||require("app/view/query/query");true||require("app/view/query/selector");true||require("app/view/query/filters");true||require("app/view/funnel");true||require("app/view/group");true||require("app/view/moderation/flag");true||require("app/view/suggestions");true||require("email");true||require("app/view/user_stats");true||require("app/view/user/content");true||require("app/view/user/setup_");true||require("app/view/user/subscribe");true||require("view/toggle_list");true||require("app/view/site_header/logged_in");true||require("app/view/site_header/logged_out");true||require("app/view/intro_to_quora");true||require("app/view/reading_list");true||require("app/view/write");true||require("shared_utils");true||require("app/view/bug_report");true||require("app/view/primary_topic");true||require("w2.perf");true||require("e2e");true||require("view/voter_list");true||require("view/follower_list");true||require("siteuri");true||require("view/paged_list");true||require("app/view/share");true||require("app/view/question/question_add");true||require("app/view/threaded_comments");true||require("ytplayer");true||require("browser");true||require("view/notif");true||require("window_manager");true||require("qtext");true||require("qtexteditor");true||require("flash");true||require("app/view/thread");true||require("app/view/survey/question_page");true||require("app/view/topic/topic_ontology");true||require("app/view/topic/leaderboard");true||require("app/view/draft");true||require("app/view/board/follow");true||require("app/view/board/item");true||require("view/topic_selector");true||require("app/view/topic/edit_topic_modal");true||require("app/view/pmsg/pmsg");true||require("app/view/admin");true||require("app/view/suggested_photo");true||require("app/view/vc");true||require("app/view/widgets");true||require("app/view/question/answer_tag");true||require("view/photo");true||require("app/view/question/add_answer");true||require("app/view/question/disclaimer");true||require("app/view/question/question_redirect");true||require("app/view/question/lookup_bar");true||require("app/view/components");true||require("app/view/link");true||require("app/view/static");true||require("app/view/answer_wiki");true||require("view/suggested_edits");true||require("app/view/topic/topic_create");true||require("app/view/suggested_sig");true||require("app/view/announcement");true||require("app/view/board/view_tracker");true||require("view/board_selector");true||require("view/user");true||require("view/hover_menu");true||require("app/view/layout");true||require("app/view/comment");true||require("view/datetime_");true||require("app/view/topic/topic_editor");true||require("app/view/oauth");true||require("app/view/linkedin_");true||require("view/invisibleinfo");true||require("app/view/login");true||require("app/view/question/suggested_answer");true||require("app/view/photo");true||require("app/view/thanks");true||require("app/view/tumblr");true||require("app/view/related");true||require("app/view/payment/payable");true||require("app/view/question/question_alias");true||require("app/view/question/topics");true||require("app/view/user/profile");true||require("app/view/question/not_helpful");true||require("view/filterable_list");true||require("view/upload");true||require("app/view/board/submission");true||require("view/announcement");true||require("view/modal");true||require("view/editable_list");true||require("app/view/board/settings");true||require("app/view/zapdos/card");true||require("app/view/ask");true||require("app/view/user_settings/settings");true||require("view/reorderable_list");true||require("app/view/topic/faq");true||require("view/filter_nav_list");true||require("app/view/quora_meets_bagel");true||require("third_party/truncate");true||require("app/view/moderation/appeal");true||require("views");true||require("app/view/embed");true||require("app/view/question/answer_credibility");true||require("app/view/quality/base");true||require("app/view/quality/answer");true||require("app/view/answer/improvement");true||require("view/tooltip");true||require("view/fixable_component");true||require("app/view/advertising/create_ad");true||require("app/view/advertising/manage_payment");true||require("app/view/advertising/create_campaign");true||require("app/view/advertising/manage_campaign");true||require("app/view/advertising/ads_home");true||require("app/view/signup/conversion_logging");true||require("view/paged_list");true||require("app/view/share");true||require("view/privacy");true||require("app/view/question/question_add");true||require("app/view/threaded_comments");true||require("app/view/manage");true||require("unified_view/main");true||require("unified_view/captcha");true||require("typeahead");true||require("input_validate");true||require("app/view/ama");true||require("app/view/tribes");true||require("third_party/rangy-core");true||require("app/view/bounty/_bounty");true||require("app/view/bounty/manage");if(window.log&&window.log.enabled){window.log("main","main is loaded.")}require("w2.timing").logTime("mainScriptEnd")});require.install("main-loaded",function(require,exports,module){},{});
