KISSY.add("mui/brandbar/brandbar",function(e,t,a){var n={show:function(n){var r=this,o=r.domEl;n=n||{};r.cancelFly=n.cancelFly;if(!o){t.addStyleSheet("#J_BrandBar{font-size:12px;cursor:pointer;background-color:#EEEEEE;width:120px;margin:2px 5px 0 5px;height:28px;border:solid 1px #d0d0d0;-moz-border-radius: 3px 3px 0px 0px;-khtml-border-radius: 3px 3px 0px 0px;-webkit-border-radius: 3px 3px 0px 0px;border-radius: 3px 3px 0px 0px;}"+"#J_BrandBar:hover,#J_BrandBar.hoverBrandBar{background-color:#d9d1d1;border-color:#bcb0b0}"+'.BrandFlyer{width:20px;height:20px;float:left;margin:4px 0px 4px 12px;background:url(//img.alicdn.com/tps/i2/T1KMGHXC4dXXcu5FDa-20-20.png);background-repeat:no-repeat;*background:none;*filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src="//img.alicdn.com/tps/i2/T1KMGHXC4dXXcu5FDa-20-20.png");zoom:1;}'+'.BrandPopup{cursor:pointer;background:url(//img.alicdn.com/tps/i1/T1wW9HXAdfXXcH0rHA-152-131.png);background-repeat:no-repeat;*background:none;*filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src="//img.alicdn.com/tps/i1/T1wW9HXAdfXXcH0rHA-152-131.png");background-size:100% 100%;}'+"#J_BrandBar a,#J_BrandBar a:hover{line-height:20px;display:block;margin:4px 4px 4px 0;float:left;color:#181818;text-decoration:none;}");o=r.domEl=t.create('<div id="J_BrandBar" order="20">');var i=n.urlMyBrand||"//mybrand.tmall.com/";t.html(o,'<div class="BrandFlyer"></div><a href="'+i+'" target="'+(n.newWindow?' target="_blank"':"")+'">\u6211\u5173\u6ce8\u7684\u54c1\u724c</a>');a.on(o,"click",function(e){if(e.target.nodeName!="A"){var a=t.get("a",o);if(a.click){a.click()}else if(document.createEvent){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);a.dispatchEvent(n)}}else{(new Image).src="//log.mmstat.com/tmallbrand.1001.1.2.3"}});if(e.UA.ie==6){a.on(o,"mouseenter",function(){t.addClass(o,"hoverBrandBar")});a.on(o,"mouseleave",function(){t.removeClass(o,"hoverBrandBar")})}}e.use("mui/bottombar",function(e,a){a=a||e["mui/bottombar"];t.append(t.create("<div>",{css:{width:"23px",height:"13px",left:"87px",top:"-6px",position:"absolute",background:"url(//img.alicdn.com/tps/i3/T1Zs7TXiNcXXbmSHkB-191-207.png) no-repeat",backgroundPosition:"-158px -75px"}}),o);a.add(o)})},setClass:function(e,a){if(!t.hasClass(e,"ui-brand-btn")){return}a=a===undefined?e._hover:a;var n=t.hasClass(e,"ui-brand-collected")?a?"\u53d6\u6d88":"\u5df2\u5173\u6ce8":t.hasClass(e,"ui-brand-btn-ex-s")&&t.hasClass(e,"ui-brand-btn-ex-bubble")?"\u5173\u6ce8\u54c1\u724c":"\u5173\u6ce8";t.text(t.get("span",e),n)},bindEl:function(n,r){r=r||{};var o=this,i=r.attrName||"data-brandid";var c=a.delegate||function(n,r,o,i,c){a.on(n,r,function(a){var r=false;e.each(t.query(o,n),function(e){if(!r&&(e==a.target||t.contains(e,a.target))){r=true}});if(!r){return}i&&i.apply(this,arguments)},c)};c(document,"click",n,function(e){e.preventDefault();if(e.brandCooked){return}e.brandCooked=true;var a=e.target;while(a&&!(brandId=t.attr(a,i))){a=t.parent(a)}if(!a){return}o.flyAdd(a,brandId,r)});var l=[];e.each(t.query(n),function(e){var n=t.attr(e,i);if(n&&t.hasClass(e,"ui-brand-btn")){l.push(n);a.on(e,"mouseenter",function(){o.setClass(e,e._hover=true)});a.on(e,"mouseleave",function(){o.setClass(e,e._hover=false)})}});if(l[0]){e.use("mui/wishlist",function(e,a){a.queryBrand({ids:l},function(a){e.each(t.query(".j_CollectBrandNum"),function(n){var r=t.attr(n,i);e.each(a.result,function(e){if(e.brandId==r){t.text(n,e.popularity)}})});e.each(t.query(n),function(n){var r=t.attr(n,i);e.each(a.result,function(e){if(e.brandId==r&&e.isMyBrand&&t.hasClass(n,"ui-brand-btn")){t.addClass(n,"ui-brand-collected");o.setClass(n,false)}})})})})}},flyAdd:function(t,a,n){var r=this;e.use("mui/brandbar/fly",function(e,o){o.cancelFly=r.cancelFly;e.mix(r,o);r.flyAdd(t,a,n)})}};e.mix(n,e.EventTarget);return n},{requires:["dom","event"]});KISSY.add("mui/mallbar/index",function(a,e,t,r,i,l,n,m,o,s,b,d,u,c,_,f){var p=window.location.href.indexOf("mbar-mock-bubble=1")>-1;var v=['<div class="mui-mbar-plugin {5} mui-mbar-plugin-{0}">','<div class="mui-mbar-plugin-hd">','<a target="{3}" href="{2}" target="_blank" class="mui-mbar-plugin-hd-title {4}">{1}</a>',' <div class="mui-mbar-plugin-hd-tip"></div>',' <div class="mui-mbar-plugin-cover"></div>','<div class="mui-mbar-plugin-hd-close mui-mbar-iconfont">&#xe61b;</div>',"</div>",'<div class="mui-mbar-plugin-bd"><div class="mui-mbar-plugin-load"></div></div>',"</div>"].join("");var E=['<div class="mui-mbar-tab mui-mbar-tab-{2} {4}" style="top:{1}px;">','<div class="mui-mbar-tab-logo mui-mbar-tab-logo-{2}">{7}</div>','<div class="mui-mbar-tab-txt">{3}</div>','<div class="mui-mbar-tab-new" style="display:{5};"></div>','<div class="mui-mbar-tab-sup"></div>','<div class="mui-mbar-tab-tip">{0}<div class="mui-mbar-arr mui-mbar-tab-tip-arr">\u25c6</div></div>','<div class="mui-mbar-arr mui-mbar-tab-logo-arr {8}">\u25c6</div>',"</div>"].join("");var T=['<div class="mui-mbar-tab-sup-bg">','<div class="mui-mbar-tab-sup-bd">{0}</div>',"</div>"].join("");var g=['<div class="mui-mbar-tab-bubble mui-mbar-tab-bubble-{0}"><div class="mui-mbar-tab-bubble-bd"></div></div>'].join("");var I=['<div class="mui-mbar-mini">','  <div class="mui-mbar-mini-avatar-def"></div>','  <div class="mui-mbar-mini-mask"></div>','  <div class="mui-mbar-tab-sup"></div>',"</div>",'<div class="mui-mbar-mini-logo"></div>'].join("");var A=[];var O=true;var B=false;var C=function(e){var t=parseFloat(a.version);u.log("Kissy \u7248\u672c\u68c0\u6d4b\uff1a",a.version,t);if(t<1.3){return}var r=this;e=e||{};e.shopConfig=e.shopConfig||window.shop_config;e.gConfig=window.g_config;var i=a.one(document.body)||document.getElementsByTagName("body");if(i&&i.length>0){i=a.one(i[0])}e.container=e.container?a.one(e.container):i;if(!e.container){u.log(d.M.B);return}C.superclass.constructor.call(r,e);r.init()};C.ATTRS={oldIndex:{value:-1}};a.extend(C,e,{init:function(){var e=this;var t=a.all(u.fm('<div id="J_MUIMallbar" class="mui-mbar-outer j_Mallbar_{0}"><div class="mui-mbar"></div></div>',d.VER)).appendTo(e.get(d.K.CONTAINER));e.set(d.K.ROOT,a.one(".mui-mbar"));e.set(d.K.ROOT_OUTER,t);e.set(d.K.ITEMS,{});var r=new c;e.set(d.K.MODEL,r);r.on(d.E.AFTER_BAR_CHANGE,function(t){u.log(t.type);function r(){a.use("mui/mallbar/guide",function(a,t){new t({isMask:false,callback:function(){e.initBar()}})});setTimeout(function(){if(a.one(".mui-mbar-guide")){a.one(".mui-mbar-guide").remove();e.initBar()}},12*1e3)}e.navHeight={};u.getStaticConf({cb:function(a){u.log("getStaticConf",a);if(a.topAddHeight){e.set("topAddHeight",a.topAddHeight)}if(a.notWideTab){e.set("notWideTab",a.notWideTab)}if(a.navBgColor=="#12a20d"){e.set("navBgColor",1)}e.navNarrow=a.navNarrow||"";e.navWideLittle=a.navWideLittle||"";e.navWideBig=a.navWideBig||"";e.navHeight=a.navHeight||{};e.navTopColor=a.navTopColor||"";var t="";!!window.g_config&&(t=window.g_config.shopId||"");if(a.bubbleBlacklist&&a.bubbleBlacklist.length){var i=a.bubbleBlacklist.length;var l=a.bubbleBlacklist;for(var n=0;n<i;n++){if(t==l[n]){e.set("notWideTab",1)}}}if(a.showCartGuide){if(window.localStorage){f.get({k:d.K.FRM_CART,success:function(a){if(a){e.initBar()}else{f.set({k:d.K.FRM_CART,v:true});r()}}})}else{if(o.get("_mbg")){e.initBar()}else{o.set("_mbg","1",60,d.DEBUG?"tmall.net":"tmall.com","/");r()}}}else{e.initBar()}}})});r.getBar({shopId:e.get(d.K.SHOP_CONFIG)?"1":"",gConfig:e.get(d.K.G_CONFIG),mallbar:e});u.getStaticConf({cb:function(a){var t=a.firstBubbleWaitTime||3;setTimeout(function(){u.log("::mallbar.js::\u9996\u6b21\u6c14\u6ce1\u5df2\u7ecf\u6536\u96c6\u5b8c\u6210");e.firstBubble()},t*1e3)}})},initBar:function(){var e=this;if(e.get(d.K.INITED)){return}e.set(d.K.INITED,true);var t=e.get(d.K.MODEL).get(d.K.BAR);var r=e.get(d.K.ROOT);var n=e.get(d.K.ROOT_OUTER);var m=e.get(d.K.MODEL);var o=m.get(d.K.USERINFO);var s=e.get(d.K.ITEMS);var b,c,f;u.log("::after bucket::",t.l);var p=[];p.push('<div class="mui-mbar-plugins">');for(b=0,c=t.l.length;b<c;++b){f=t.l[b];var T=f.u.indexOf("//")===0;p.push(u.fm(v,f.id,f.n,f.u,T?"_blank":"_self",T?"":"mui-mbar-plugin-hd-title-txt",f.tms?"mui-mbar-plugin-tms":""))}p.push("</div>");var A="mui-mbar-tabs-narrow";p.push('<div class="mui-mbar-tabs  '+A+'">');for(b=0,c=t.l.length;b<c;++b){f=t.l[b];p.push(u.fm(g,f.id))}p.push('<div class="mui-mbar-tabs-mask">');p.push('<div class="mui-mbar-tabs-top-wide"><div class="mui-mbar-tab-top-left"></div></div>');for(b=0,c=t.l.length;b<c;++b){f=t.l[b];var O="";if(f.id=="nav"){O='<div class="mui-mbar-tab-logo-nav-top" '+(e.navTopColor?'style="background-color:'+e.navTopColor+'"':"")+"></div>"}var C="";if(f.specail){C="mui-mbar-tab-logo-arr-show"}p.push(u.fm(E,f.n,0,f.id,f.nick,f.custom?"mui-mbar-tab-custom":"",f.isNew?"block":"none",f.text?f.text:"",O,C))}p.push("</div>");p.push("</div>");p.push(I);r.html(p.join(""));var h=a.one(window);var R=r.one(".mui-mbar-mini");var L=r.one(".mui-mbar-mini-logo");var S=r.one(".mui-mbar-tabs");var N=r.one(".mui-mbar-tabs-mask");var U=r.one(".mui-mbar-plugins");var M=S.all(".mui-mbar-tab");var P;var D;for(b=0,c=M.length;b<c;++b){var F=a.one(M[b]);var w=t.l[b];s[w.id]=new _({mallbar:e,index:b,data:w,tab:F,bubble:r.one(".mui-mbar-tab-bubble-"+w.id),plugin:U.one(".mui-mbar-plugin-"+w.id)});if(d.P.CART===w.id){P=s[w.id].get(d.K.TAB)}if(d.P.TOP===w.id){D=s[w.id].get(d.K.TAB)}if(l.ie&&l.ie===6&&w.ie6Tab){F.one(".mui-mbar-tab-logo").css({backgroundImage:u.fm("url({0})",w.ie6Tab)})}}function G(){a.each(s,function(a){a.fire(d.E.VISIBILITY_CHANGE,{visible:false})})}e.on(d.E.STATUS_CHANGE,function(t){u.log("::status change::",t.status);var l=t.status;if(e.get(d.K.STATUS)===l){return}var n=e.get(d.K.STATUS);e.set(d.K.STATUS,l);switch(l){case d.S.MINI:{r.removeClass("mui-mbar-status-standard");r.removeClass("mui-mbar-status-expand");r.addClass("mui-mbar-status-mini");i(r,{right:-r.width()+"px"},.2,d.EASE).run();P&&i(P,{left:"-35px"},.2,d.EASE).run();i(D,{left:"-35px"},.2,d.EASE).run();e.fire(d.E.SUPTIP_CHANGE);G();L.css("visibility","hidden");d.S.STANDARD===n&&u.sendLog(d.ARR.S21)}break;case d.S.STANDARD:{r.addClass("mui-mbar-status-standard");r.removeClass("mui-mbar-status-expand");r.removeClass("mui-mbar-status-mini");i(r,{right:-r.width()+S.width()+"px"},.2,d.EASE).run();P&&i(P,{left:"0px"},.2,d.EASE).run();i(D,{left:"0px"},.2,d.EASE).run();L.css("visibility","hidden");G();d.S.MINI===n&&u.sendLog(d.ARR.S12);d.S.EXPAND===n&&u.sendLog(d.ARR.S32)}break;case d.S.EXPAND:{r.removeClass("mui-mbar-status-standard");r.removeClass("mui-mbar-status-mini");r.addClass("mui-mbar-status-expand");i(r,{right:"0px"},.31,d.EASE).run();P&&i(P,{left:"0px"},.31,d.EASE).run();i(D,{left:"0px"},.31,d.EASE).run();L.css("visibility","visible");B=true}break}e.broadcast(d.E.MALLBAR_STATUS_CHANGE,{status:l});if(!t.noToClose){var m=e.get(d.K.ITEMS);if(m){a.each(m,function(a){var e=a.get(d.K.BUBBLE);!!e&&e.hide()})}}});e.on(d.E.SUPTIP_CHANGE,function(a){});var y=function(a){var t=e.get(d.K.STATUS);var r;switch(t){case d.S.MINI:{r=d.S.STANDARD;u.sendLog(d.ARR.S12_ACTIVE)}break;case d.S.STANDARD:{r=d.S.MINI;u.sendLog(d.ARR.S21_ACTIVE)}break;case d.S.EXPAND:{if(!e.isMiniWidth()){r=d.S.STANDARD;u.sendLog(d.ARR.S32_ACTIVE)}else{r=d.S.MINI;u.sendLog(d.ARR.S31_ACTIVE)}}break}e.fire(d.E.STATUS_CHANGE,{status:r})};L.on("click",y);e.on(d.E.PAGE_VISIBILITY_CHANGE,function(e){if(!e.pageVisible||!o.isLogin){return}if(d.S.BAR_NO_MSG===t.s){return}if(d.SAMPLING<Math.random()){return}var r=[];a.each(s,function(a,e){r.push(e)});u.getStaticConf({cb:function(e){if(!e.notGetMessageWarn){u.ajax({url:u.fm(d.URL.GET_MSG),jsonpCallback:"__mallbarGetMessageWarn",data:{id:r.join(",")},success:function(e){if(!e){return}var t=e.s;if(t===d.S.BAR_SUCCESS||t===d.S.BAR_NOT_LOGIN||t===d.S.BAR_NO_MSG){a.each(e.q,function(a){var e=s[a.id];if(e){e.fire(d.E.SUPTIP_CHANGE,{show:a.m>0})}})}}})}}})});if(l.ie&&l.ie<7){h.on("scroll",function(){n.css("top",h.scrollTop()+"px")});n.css("top",h.scrollTop()+"px")}r.on("click",function(a){a.stopPropagation()});var H=a.one(document);H.on("click",function(a){u.log("document click");if(d.S.EXPAND===e.get(d.K.STATUS)){e.fire(d.E.STATUS_CHANGE,{status:e.isMiniWidth()?d.S.MINI:d.S.STANDARD})}});var K=0;var k=e.get(d.K.G_CONFIG);H.on("mousemove",a.buffer(function(t){if(!e.isMiniWidth()&&!k.forceMallBarMini){return}var r=a.DOM.viewportWidth()-t.pageX+H.scrollLeft();var i=e.get(d.K.STATUS);var l=r<=d.MINI_HIT_WIDTH;if(l&&d.S.MINI===i){u.sendLog(d.ARR.S12_USER_TRIGGER);e.fire(d.E.STATUS_CHANGE,{status:d.S.STANDARD})}K=l},300));r.on("mouseleave",a.buffer(function(){if(!e.isMiniWidth()&&!k.forceMallBarMini){return}var a=e.get(d.K.STATUS);if(d.S.STANDARD===a){e.fire(d.E.STATUS_CHANGE,{status:d.S.MINI})}}));h.on("focus",a.buffer(function(a){e.broadcast(d.E.PAGE_VISIBILITY_CHANGE,{pageVisible:true})},d.COMMON_DELAY,e));h.on("blur",a.buffer(function(a){e.broadcast(d.E.PAGE_VISIBILITY_CHANGE,{pageVisible:false})},d.COMMON_DELAY,e));var x=false;var V=true;function W(){u.log("onresize");var i=a.DOM.viewportWidth();var l=a.DOM.viewportHeight();n.height(l);r.height(l);S.height(l);N.height(l);U.height(l);a.each(U.all(".mui-mbar-plugin"),function(e){e=a.one(e);e.height(l);var t=e.one(".mui-mbar-plugin-hd");var r=e.one(".mui-mbar-plugin-bd");r.height(l-t.height())});var m=0;a.each(t.l,function(a,e){if(!a.custom&&!a.bottom&&a.on&&!a.defaultHide){var t=s[a.id].get(d.K.TAB);m+=t.height()+(a.margin*2||0)}});var o=0;if(a.one(".mui-mbar-tabs-narrow")){o=e.get("topAddHeight")||50}var _=(l-m)/2+o;var p=_;var v=0;var E=0;for(b=0,c=t.l.length;b<c;++b){f=t.l[b];var T=s[f.id];var g=T.get(d.K.TAB);var I=f.margin||0;if(f.custom){p-=I;p-=g.height();g.css("position","absolute");g.css("top",p+"px");if(f.id=="nav"&&p>0){var A=a.one(".mui-mbar-tabs-narrow")||"";if(A){var O=A.one(".mui-mbar-tab-logo-nav-top");e.set("offsetYCustom",p);if(O){O.css("height",p+"px");O.css("top",-p+"px")}}}}else if(f.bottom){v+=I;g.removeAttr("style");g.css("bottom",v+"px");g.css("position","absolute");v+=g.height()}else{if(f.id=="prof"){if(_<35){_=35}g.css("margin",_+"px 0 "+E+"px")}else{g.css("margin",I+"px 0")}}T.resetBubble()}e.set("baseY",_);function B(){a.one(".mui-mbar").one(".mui-mbar-tabs").removeClass("mui-mbar-tabs-wide");var t=e.get("offsetYCustom")||0;var r=a.one(".mui-mbar-tabs-narrow")||"";if(r){var i=r.one(".mui-mbar-tab-logo-nav-top");if(i){var l=e.navHeight.n||30;if(t<l){i.css("background-image","none")}else{if(!(a.UA.ie<8)){!!e.navNarrow&&i.css("background-image","url("+e.navNarrow+")")}}}}var n=a.one(".mui-mbar").one(".mui-mbar-tabs-top-wide");!!n&&n.css("height","0px")}function C(){if(e.get("notWideTab")){B();return}a.one(".mui-mbar").one(".mui-mbar-tabs").addClass("mui-mbar-tabs-wide");e.get("offsetYCustom");var t=a.one(".mui-mbar-tabs-narrow")||"";if(t){var r=t.one(".mui-mbar-tab-logo-nav-top");if(r){var i=e.navHeight.wl||30;var l=e.navHeight.wb||90;if(p<i){r.css("background-image","none")}else if(p>i&&p<l){!!e.navWideLittle&&r.css("background-image","url("+e.navWideLittle+")")}else{!!e.navWideBig&&r.css("background-image","url("+e.navWideBig+")")}}}var n=a.one(".mui-mbar").one(".mui-mbar-tabs-top-wide");var m=e.get("baseY")||0;!!n&&n.css("height",m+"px")}if(e.get("navBgColor")){a.one(".mui-mbar").one(".mui-mbar-tabs").addClass("mui-mbar-tabs-green")}if(e.isMiniWidth()||k.forceMallBarMini){if(a.one(".mui-mbar").one(".mui-mbar-tabs")){B()}e.fire(d.E.STATUS_CHANGE,{status:d.S.MINI});if(V){u.sendLog(d.ARR.S1_DEFAULT);V=false}}else{if(a.DOM.viewportWidth()<1380){B()}else{if(!(a.UA.ie<8)){C()}else{B()}}e.fire(d.E.STATUS_CHANGE,{status:d.S.STANDARD})}if(e.isMiniWidth()){!x&&Math.random()<d.SAM_PV&&u.sendLog(d.ARR.EXP1);x=true}}W();r.css("visibility")==="hidden"&&r.css("visibility","visible");var Y={w:a.DOM.viewportWidth(),h:a.DOM.viewportHeight()};h.on("resize",a.buffer(function(t){u.log(t.type,Y);var r={w:a.DOM.viewportWidth(),h:a.DOM.viewportHeight()};var i=true;if(Y.h===r.h&&Y.w!==r.w&&d.S.EXPAND===e.get(d.K.STATUS)){i=false}Y=r;i&&W()},d.COMMON_DELAY,e));var X=a.one("body");X.delegate("click",".mui-favor-add",function(t){var r=a.one(t.currentTarget).attr("data-itemId");e._addFavor(r,t);t.halt()});X.delegate("click",".mui-favor-delete",function(t){var r=a.one(t.currentTarget).attr("data-itemId");e._deleteFavor(r);t.halt()});Math.random()<d.SAM_PV&&u.sendLog(d.ARR.PV);e.get(d.K.LOADED)&&setTimeout(function(){e.get(d.K.LOADED)(e)},10)},addFavor:function(a){u.log("::mallbar addFavor::start");var e=a.favorAd||"",t=a.itemId||"",r={},i=a.callback||"",l=a.e||"";if(!t){return}r={sellerId:a.sellerId||"",categoryId:a.categoryId||""};var n=this;var m=n.get(d.K.MODEL).get(d.K.USERINFO);if(m.isLogin){new s({url:d.URL.FAVORITE_ITEM,scriptCharset:"gbk",dataType:"jsonp",type:"GET",data:{itemId:t,favorite:"1",_tb_token_:n.get("token")||""},success:function(a){if(a.s==1){n.driving({type:"favor",e:l,bubble:true,callback:i,id:t,params:r,favorAd:e,speed:2})}else{u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.favor.addFavor.status.error","\u6536\u85cf\u63a5\u53e3\u72b6\u6001\u5f02\u5e38")}},error:function(){u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.favor.addFavor.data.error","\u6536\u85cf\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25")}})}else{}},_addFavor:function(a,e,t){var r=this;TB.Global.loginStatusReady(function(i){new s({url:d.URL.FAVORITE_ITEM,scriptCharset:"gbk",dataType:"jsonp",type:"GET",data:{itemId:a,favorite:"1",_tb_token_:i["tbToken"]},success:function(a){if(a.s==1){r.driving({type:"favor",e:e,speed:2,bubble:true,callback:t})}else{u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.favor.addFavor.status.error","\u6536\u85cf\u63a5\u53e3\u72b6\u6001\u5f02\u5e38")}},error:function(){u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.favor.addFavor.data.error","\u6536\u85cf\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25")}})})},_deleteFavor:function(a,e){var t=this;TB.Global.loginStatusReady(function(t){new s({url:d.URL.FAVORITE_ITEM,dataType:"jsonp",scriptCharset:"gbk",type:"GET",data:{itemId:a,favorite:"0",_tb_token_:t["tbToken"]},success:function(a){if(a.s==1){e()}else{u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.favor.deleteFavor.status.error","\u53d6\u6d88\u6536\u85cf\u63a5\u53e3\u72b6\u6001\u5f02\u5e38")}},error:function(){u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.favor.addFavor.data.error","\u53d6\u6d88\u6536\u85cf\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25")}})})},getCueMsgInfo:function(e){var t=this;this.cueMsgCallbacks=this.cueMsgCallbacks||[];this.cueMsgCallbacks.push(e);if(!this.sendCueMsg){t.sendCueMsg=true;var r=t.get("sellerId");var i=t.get("itemId");var l=t.get("brandId");var n=t.get("category");var m=t.get("bizId");u.getStaticConf({cb:function(e){if(!e.notGetCueMsgInfo){u.ajax({url:d.URL.GET_PLUGIN_ASSET_TIP,data:{sellerId:r,itemId:i,brandId:l,frontEndCatId:n,bizId:m},timeout:4,scriptCharset:"gbk",jsonpCallback:"__mallbarCueAssetMsg",success:function(e){t.cueMsgData=e;a.each(t.cueMsgCallbacks,function(t){if(a.isFunction(t)){t(e)}});var r=[];var i="";!!e.vip&&(r=e.vip.va||[]);if(e.vip&&e.vip.vp){i=e.vip.vp.b||""}t.set("profList",r);t.set("currentProf",i);t.cueMsgCallbacks=[]},error:function(){u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.mallbar.getCueMsgInfo.get.failure","mallbar\u83b7\u53d6\u6c14\u6ce1\u4fe1\u606f\u5931\u8d25")}})}}})}else if(t.cueMsgData){a.each(t.cueMsgCallbacks,function(a){a(t.cueMsgData)})}},isMiniWidth:function(){return a.DOM.viewportWidth()<1260},broadcast:function(e,t){var r=this;r.fire(e,t);var i=r.get(d.K.ITEMS);a.each(i,function(a){a.fire(e,t)})},toggle:function(a){var e=a.obj;i(e,{right:a.expand?0:-e.outerWidth()+"px"},a.duration||.3,a.easing||d.EASE,function(){a.cb&&a.cb()}).run()},isValid:function(e){var t=false;e=e.toUpperCase();a.each(d.P,function(a,r){if(e===r){t=true;return false}});return t},collapse:function(a){var e=this;u.log("mallbar collapse",a);a=a||{};var t=d.S.MINI===a.status?d.S.MINI:d.S.STANDARD;e.fire(d.E.STATUS_CHANGE,{status:t})},expand:function(a){var e=this;u.log("mallbar expand",a);a=a||{};var t=a.type.toUpperCase();if(!e.isValid(t)){return}var r=e.get(d.K.ITEMS)[d.P[t]];return r&&r.expand()},getPoint:function(a){var e=this;u.log("mallbar getPoint",a);a=a||{};var t=a.type.toUpperCase();if(!e.isValid(t)){return null}if(t=="BRAND"){if(e.get(d.K.ITEMS)[d.P[t]]){t="BRAND"}else if(e.get(d.K.ITEMS)["my1111"]){d.P.BRAND="my1111"}}var r=e.get(d.K.ITEMS)[d.P[t]];return r?r.getPoint():null},_bubbleTips:function(e){var t=this;u.log("mallbar favor or cart bubble",e);e=e||{};var r=e.type.toUpperCase();if(!t.isValid(r)){return}if(!(r=="FAVOR"||r=="CART")){return}var i=t.get(d.K.ITEMS)[d.P[r]];var l=e.bubble===undefined?true:e.bubble;if(i){e.item=i;u.getStaticConf({cb:function(a){if(!a.notFavorDefaultBubble&&r=="FAVOR"||!a.notCartDefaultBubble&&r=="CART"||p){n(e)}}})}function n(e){var r=new b(['<div class="mui-mbar-bubble mui-mbar-bubble-recommend mui-mbar-bubble-recommend-cart" >','<div class="mui-mbar-arr mui-mbar-bubble-recommend-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>','<div class="mui-mbar-bubble-recommend-bd">','<div class="mui-mbar-bubble-recommend-content-head">'+'<span class="mui-mbar-iconfont mui-mbar-bubble-recom-hd-logo">&#xe60c;</span>','<div class="mui-mbar-bubble-recom-hd-p">','<p class="mui-mbar-bubble-recom-hd-p-1"><b>\u6210\u529f\u52a0\u5165\u8d2d\u7269\u8f66\uff01</b>{{#if showNum}}\u5df2\u6709<span>{{cartNum}}</span>\u4eba\u52a0\u5165\u8d2d\u7269\u8f66\uff0c\u8fd8\u4e0d\u5feb\u62a2\uff01{{/if}}</p>','<p class="mui-mbar-bubble-recom-hd-p-2">\u60a8\u53ef\u4ee5<a href="//cart.tmall.com?scm=1048.1.12.2" target="_blank">\u53bb\u8d2d\u7269\u8f66\u7ed3\u7b97</a>{{#if goRoom}}\u6216<a href="//www.tmall.com/go/market/brand/worth.php?from=mybrand_tab?scm=1048.1.12.6" target="_blank">\u53bb\u60a8\u7684\u4e13\u5c5e\u63a8\u8350</a>{{/if}}</p>',"</div>","</div>",'<div class="mui-mbar-bubble-recommend-content-blow">','<p class="mui-mbar-bubble-recom-bd-p">\u8fbe\u4eba\u7684\u8d2d\u7269\u8f66\u91cc\u90fd\u6709\u5565 <a target ="_blank" href="//www.tmall.com/go/market/brand/worth.php?from=addCart&scm=1048.1.12.5&invalidItems={{itemParam}}">\u67e5\u770b\u66f4\u591a</a></p>','<div class="mui-mbar-recom-list-slide mui-mbar-recom-list-slide-cart">','<div class="mui-mbar-recom-list-slide-cont mui-mbar-recom-list-slide-cont-cart">',"{{#each data}}",'<div class="mui-mbar-bubble-recom-list-item mui-mbar-bubble-recom-list-item-cart">','<a target="_blank" href="{{itemUrl}}">                        <img src="{{pictUrl}}_120x120" width="120" height="120"/>                        <p><span class="mui-price-font">&yen;</span>{{promotionPrice}}</p>                    </a>',"</div>","{{/each}}",'</div><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-prev mui-mbar-recom-list-slide-prev-cart">&#xe60d;</span><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-next mui-mbar-recom-list-slide-next-cart">&#xe60e;</span></div>',"</div>","</div>","</div>"].join(""));var i=new b(['<div class="mui-mbar-bubble mui-mbar-bubble-recommend mui-mbar-bubble-recommend-favor{{#if favorAd}} mui-mbar-bubble-recommend-favor-ad {{/if}}" >','<div class="mui-mbar-arr mui-mbar-bubble-recommend-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>','<div class="mui-mbar-bubble-recommend-bd">','<div class="mui-mbar-bubble-recommend-content-head">'+'<span class="mui-mbar-iconfont mui-mbar-bubble-recom-hd-logo">&#xe60c;</span>','<div class="mui-mbar-bubble-recom-hd-p">','<p class="mui-mbar-bubble-recom-hd-p-1"><b>\u6210\u529f\u52a0\u5165\u6536\u85cf\u5939\uff01</b></p>','<p class="mui-mbar-bubble-recom-hd-p-2">\u60a8\u53ef\u4ee5<a href="//favorite.taobao.com/item_collect.htm?scm=1048.1.12.1" target="_blank">\u67e5\u770b\u6536\u85cf\u5939</a>{{#if goRoom}}\u6216<a href="//www.tmall.com/go/market/brand/worth.php?from=mybrand_tab?scm=1048.1.12.7" target="_blank">\u53bb\u60a8\u7684\u4e13\u5c5e\u63a8\u8350</a>{{/if}}</p>',"</div>","","</div>",'<div class="mui-mbar-bubble-recommend-content-blow">','<p class="mui-mbar-bubble-recom-bd-p">\u770b\u770b\u5927\u5bb6\u90fd\u6536\u85cf\u4e86\u5565 </p>','<div class="mui-mbar-recom-list-slide mui-mbar-recom-list-slide-favor">','<div class="mui-mbar-recom-list-slide-cont mui-mbar-recom-list-slide-cont-favor">',"{{#each data}}",'<div class="mui-mbar-bubble-recom-list-item mui-mbar-bubble-recom-list-item-favor">','<a target="_blank" href="{{itemUrl}}">                        <img src="{{pictUrl}}_120x120" width="120" height="120" alt="{{itemTitle}}"/>                        <p><span class="mui-price-font">&yen;</span>{{promotionPrice}}</p>                    </a>',"</div>","{{/each}}",'</div><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-prev mui-mbar-recom-list-slide-prev-favor">&#xe60d;</span><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-next mui-mbar-recom-list-slide-next-favor">&#xe60e;</span></div>','{{#if favorAd}} <div class=" mui-mbar-bubble-recommend-favor-ad-cont" > {{/if}}',"{favorAdHtml}","{{#if favorAd}} </div> {{/if}}","</div>","</div>","</div>"].join(""));var l=e.id||"";var n=e.item;var m=e.type;var o="";var s="";var c={};u.log("obj",e);if(m!="CART"&&m!="FAVOR"){return}var _=window.g_config||{};var f=_.isInternational||"";if(m=="CART"){o=d.URL.GET_MBAR_ADD_CART_RECOMMEND;s="_mallbarCartBubbleRecommend";if(!e.params){return}var p=e.params;c={itemId:p.itemId||"",sellerId:p.sellerId||"",categoryId:p.categoryId||""};!!f&&(c.tag="13186")}if(m=="FAVOR"){o=d.URL.GET_MBAR_ADD_FAVOR_RECOMMEND;s="_mallbarFavorBubbleRecommend";var p=e.params||{};c={itemId:l,sellerId:p.sellerId||"",categoryId:p.categoryId||""};!!f&&(c.tag="13186")}u.ajax({url:o,jsonpCallback:s,dataType:"jsonp",data:c,timeout:5,success:function(l){if(!l){return}var o="";u.getStaticConf({cb:function(s){var b=t.get(d.K.MODEL).get(d.K.TIMESTAMP);if(s.bubbleShowGo11){var c=s.bubbleShowGo11;var _=c.s?c.s:"";var f=c.e?c.e:"";if(b>_&&b<f){l.goRoom=true}}if(s.bubbleShowCharge){var c=s.bubbleShowCharge;var _=c.s?c.s:"";var f=c.e?c.e:"";if(b>_&&b<f){l.goAsset=true}}l.showNum=true;if(s.notCartBubbleNum){l.showNum=false}if(m=="CART"){if(!l.data||!l.data.length){return}if(!l.cartNum||l.cartNum<1){l.showNum=false}o=r.render(l);l.tab="cart"}if(m=="FAVOR"){if(!l.data||!l.data.length){return}if(e.favorAd){l.favorAd=true}o=i.render(l).replace("{favorAdHtml}",e.favorAd);l.tab="favor"}n.fire(d.E.BUBBLE_CHANGE,{show:true,html:o,customConentType:3,isCustomContent:true,isNotTabFire:true,bubbleType:0,isToForever:true,showed:function(){!!l.exposureParam&&u.sendLog(l.exposureParam);!!l.acurl&&u.sendLog(l.acurl);u.sendLog(d.ARR["MBAR_RECOMMEND_BUBBLE_"+m]);a.config({modules:{"mui/slider/base":{requires:["node","json","event","anim","ua","mui/slider/slide-util","mui/slider/kissy2yui"]},"mui/slider/index":{requires:["mui/slider/base"]},"mui/slider/kissy2yui":{requires:["node","event"]},"mui/slider/slide-util":{requires:["node","json","event"]}},packages:{"mui/slider":{debug:true,ignorePackageNameInUri:true,version:"3.0.1",path:"//g.alicdn.com/mui/slider/3.0.1/"}}});a.use("mui/slider/",function(a,e){var t=new e(a.one(".mui-mbar-recom-list-slide-"+l.tab),{effect:"hSlide",autoSlide:false,contentClass:"mui-mbar-recom-list-slide-cont-"+l.tab,pannelClass:"mui-mbar-bubble-recom-list-item-"+l.tab,carousel:true,colspan:4,speed:500});a.one(".mui-mbar-recom-list-slide-prev-"+l.tab).on("click",function(){t.previous()});a.one(".mui-mbar-recom-list-slide-next-"+l.tab).on("click",function(){t.next()})})},colsedClicked:function(){var e=a.one(".mui-mbar-bubble mui-mbar-bubble-recommend");!!e&&a.DOM.remove(e)}})}})},error:function(){u.codeTracker.sendTrack(d.T.NUMLEV,"mallbar.bubble.recommend.get.failure-"+m,"\u83b7\u53d6\u6c14\u6ce1\u63a8\u8350\u5185\u5bb9\u5931\u8d25")}})}},onFinish:function(e){var t=this;u.log("mallbar onFinish",e);e=e||{};var r=e.type.toUpperCase();if(!t.isValid(r)){return}if(r=="FAVOR"||r=="CART"){return}var i=t.get(d.K.ITEMS)[d.P[r]];var l=e.bubble===undefined?true:e.bubble;if(i){i.fire(d.E.FLYIN_END);if(l){i.fire(d.E.BUBBLE_CHANGE,{show:false,cb:function(){var t="";var l="";var n="";var m={};var s=true;switch(r){case"BRAND":o(e.id);s=false;break;case"ASSET":l=d.ARR.COUPON_FLY_BUB_SHOW;n=d.ARR.COUPON_FLY_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u4f18\u60e0\u5238\u9886\u53d6\u6210\u529f</span><br><p class="mui-mbar-bubble-href"><a>\u7acb\u5373\u67e5\u770b</a></p>';break;case"BONUS":l=d.ARR.BONUS_FLY_BUB_SHOW;n=d.ARR.BONUS_FLY_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u7ea2\u5305\u9886\u53d6\u6210\u529f\uff01</span><br>\u7ea2\u5305\u4f1a\u572824\u5c0f\u65f6\u5230\u8d26\uff0c\u67e5\u770b\u6211\u5df2\u9886\u7528\u7684\u7ea2\u5305\uff01';break;case"GUESS_POINT":l=d.ARR.POINT_SHOW;n=d.ARR.POINT_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u5929\u732b\u79ef\u5206\u9886\u53d6\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="//vip.tmall.com/vip/index.htm?scm=1048.1.3.27">\u53bb\u770b\u770b\u79ef\u5206</a></p>';break;case"SIGN_POINT":l=d.ARR.POINT_SHOW;n=d.ARR.POINT_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u5929\u732b\u79ef\u5206\u9886\u53d6\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="//vip.tmall.com/vip/index.htm?scm=1048.1.3.27">\u53bb\u770b\u770b\u79ef\u5206</a></p>';break;case"GET_COUPON":l=d.ARR.GET_COUPON_BUB_SHOW;n=d.ARR.GET_COUPON_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u4f18\u60e0\u5238\u9886\u53d6\u6210\u529f</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="//mybrand.tmall.com/myCoupon.html?scm=1048.1.3.28">\u53bb\u770b\u770b\u4f18\u60e0\u5238</a></p>';break;case"FOOT":l=d.ARR.FOOT_FLY_BUB_SHOW;n=d.ARR.FOOT_FLY_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u60a8\u9489\u4f4f\u7684\u5546\u54c1\u5728\u8fd9\u91cc\u54e6\uff01</span><br><p class="mui-mbar-bubble-href"><a>\u53bb\u770b\u770b</a></p>';m.height="110px";break;case"FAVOR":s=false;break;case"DELETE_FAVOR":l=d.ARR.DELETE_FAVOR_FLY_BUB_SHOW;n=d.ARR.DELETE_FAVOR_FLY_BUB_CLICK;t='<span class="mui-mbar-bubble-em">\u53d6\u6d88\u6536\u85cf\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a>\u53bb\u770b\u770b</a></p>';break;case"CART":s=false;break}if(s){i.fire(d.E.BUBBLE_CHANGE,a.mix(m,{show:true,html:t,customConentType:1,isNotTabFire:false,showDelay:10,hideDelay:e.hideDelay===undefined?"":e.hideDelay,showed:function(a){l&&u.sendLog(l);var e=a.one(".j_BubbleLink");if(e){e.on("click",function(a){switch(r){case"BRAND":u.sendLog(d.ARR.BRAND_FLY_BUB_LINK_CLICK);break;case"GET_COUPON":u.sendLog(d.ARR.GET_COUPON_BUB_LINK_CLICK);break;case"SIGN_POINT":u.sendLog(d.ARR.POINT_BUB_LINK_CLICK);break;case"GUESS_POINT":u.sendLog(d.ARR.POINT_BUB_LINK_CLICK);break}a.stopPropagation()});u.getStaticConf({cb:function(a){a.brandBubUrl&&e.attr("href",a.brandBubUrl)}})}},clicked:function(){n&&u.sendLog(n)}}))}}})}else{var n="",m="";switch(r){case"BRAND":n=d.ARR.BRAND_FLY_BUB_SHOW;m=d.ARR.BRAND_FLY_BUB_CLICK;break;case"ASSET":n=d.ARR.COUPON_FLY_BUB_SHOW;m=d.ARR.COUPON_FLY_BUB_CLICK;break;case"BONUS":n=d.ARR.BONUS_FLY_BUB_SHOW;m=d.ARR.BONUS_FLY_BUB_CLICK;break;case"GUESS_POINT":n=d.ARR.POINT_SHOW;m=d.ARR.POINT_BUB_CLICK;break;case"SIGN_POINT":n=d.ARR.POINT_SHOW;m=d.ARR.POINT_BUB_CLICK;break;case"GET_COUPON":n=d.ARR.GET_COUPON_BUB_SHOW;m=d.ARR.GET_COUPON_BUB_CLICK;break;case"FOOT":n=d.ARR.FOOT_FLY_BUB_SHOW;m=d.ARR.FOOT_FLY_BUB_CLICK;break;case"CART":break}n&&u.sendLog(n);m&&u.sendLog(m)}}function o(a){var r=d.ARR.BRAND_FLY_BUB_SHOW,i=d.ARR.BRAND_FLY_BUB_CLICK,l="";var n=t.get(d.K.ITEMS)[d.P["BRAND"]];if(e.id){l=u.fm(['<div class="mui-mbar-bubble mui-mbarp-brand-success-bubble">','<div class="mui-mbar-arr mui-mbarp-brand-success-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-brand-success-close"><a class="j_BubbleLink " target="_blank" href="//mybrand.tmall.com/brandInfo.htm?brandId={0}&scm={1}"></a></div>'].join(""),a,d.SCM.BRAND_FLY_BUB_LINK)}else{l=['<div class="mui-mbar-bubble mui-mbarp-brand-success-bubble">','<div class="mui-mbar-arr mui-mbarp-brand-success-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-brand-success-close"></div>'].join("")}n.fire(d.E.BUBBLE_CHANGE,{show:true,html:l,customContentType:3,bubbleType:1,showDelay:10,showed:function(){u.sendLog(r)},clicked:function(){u.sendLog(i)}})}},fly:function(e){var t=this;var r=e.type.toUpperCase();if(!t.isValid(r)){return}var l=t.getPoint({type:r});if(!l){return}var n=e.flyer,o=e.start,s=e.target,b=e.unAnim,u=e.speed?e.speed:1.16,c=e.bubble===undefined?true:e.bubble,_=e.hideDelay?e.hideDelay:"",f={left:l.x,top:l.y}||m.offset(s),p=a.UA.ie!=6,v=e.targetOffset||{left:0,top:0},E=e.flyerOffset||{left:0,top:0},T=e.flyerResize||{x:16,y:16},g=-1,I;t._bubbleTips({type:r,id:e.id,params:e.params,favorAd:e.favorAd,bubble:c,hideDelay:_});var A=function(){var l=a.UA.ie==6;var o=t._popEl,s=a.UA.webkit,b=s?2:0,u={opacity:0,top:f.top-8-35-b+(l?m.scrollTop():0)+"px"},p={position:l?"absolute":"fixed",opacity:0,left:f.left-8-b+(l?m.scrollLeft():0)+"px",top:f.top-8-b+(l?m.scrollTop():0)+"px"};if(!o){var v=t.get(d.K.ITEMS);var E;if(v){E=v[e.type];if(E){E=E.get(d.K.POBJ);E.fire(d.E.DATA_CHANGE)}}o=t._popEl=m.create("<div>1</div>",{css:a.mix({display:"none",textAlign:"center",backgroundColor:"#b3000e",color:"#ffffff",zIndex:1000001},s?{width:"20px",height:"20px",borderRadius:"10px",color:"#ffffff",lineHeight:"20px",fontSize:"12px",transform:"scale(0.8)",WebkitTransform:"scale(0.8)"}:{width:"16px",height:"16px",borderRadius:"8px",lineHeight:"16px",fontSize:"10px"})});m.append(o,document.body)}function T(){m.hide(n);if(r=="FAVOR"){e.complete&&e.complete();return}m.css(o,p);m.show(o);i(o,{opacity:1},.1,"easeOut",function(){i(o,u,1,"easeOut",function(){m.hide(o);t.onFinish({type:r,id:e.id,params:e.params,favorAd:e.favorAd,bubble:c,hideDelay:_});e.complete&&e.complete()}).run()}).run()}if(l){T()}else{i(n,{opacity:0},.8,"easeOut",T).run()}};if(T){I={x:m.width(n),y:m.height(n)}}m.append(n,document.body);m.css(n,{position:p?"fixed":"absolute",zIndex:1e6});if(p){o={left:o.left-m.scrollLeft(),top:o.top-m.scrollTop()};if(s){f={left:parseFloat(m.css(s,"left")),top:parseFloat(m.css(s,"top"))}}}else{if(s){f=m.offset(s)}else{f.left+=m.scrollLeft();f.top+=m.scrollTop()}}f.top+=v.top-4;var O=p?0:m.scrollTop();var B=Math.min(o.top,f.top)-Math.abs(o.left-f.left)*(1/3);if(B<O){if(o.left==f.left){B=f.top}B=Math.min(O,Math.min(o.top,f.top))}u=a.UA.ie==6?u:u/2;var C=Math.sqrt(Math.pow(o.top-f.top,2)+Math.pow(o.left-f.left,2));var h=Math.ceil(Math.min(Math.max(Math.log(C)/.05-75,30),100)/u);var R=o.top==B?0:-Math.sqrt((f.top-B)/(o.top-B)),L=(R*o.left-f.left)/(R-1),S=f.left==L?0:(f.top-B)/Math.pow(f.left-L,2);n.fadeIn();if(T){I={x:m.width(n),y:m.height(n)}}if(!b){var N=setInterval(function(){++g;var a=o.left+(f.left-o.left)*g/h;var e=S==0?o.top+(f.top-o.top)*g/h:S*Math.pow(a-L,2)+B;var t={left:a,top:e};if(T){var r=h/2;var i=T.x-(T.x-I.x)*Math.cos(g<r?0:(g-r)/(h-r)*Math.PI/2),l=T.y-(T.y-I.y)*Math.cos(g<r?0:(g-r)/(h-r)*Math.PI/2);m.css(n,{width:i+"px",height:l+"px","font-size":Math.min(i,l)+"px"});E.left=-i/2;E.top=-l/2}m.css(n,{left:t.left+E.left+"px",top:t.top+E.top+"px"});if(g==0){m.show(n)}if(g==h){clearInterval(N);A()}},16)}else{A()}},driving:function(e){u.log("driving\u65b9\u6cd5\u4f20\u5165\u53c2\u6570\uff1a",e);var t=this;var r=[{id:"asset",name:"&#xe606;"},{id:"get_coupon",name:"&#xe606;"},{id:"brand",name:"&#xe600;"},{id:"guess_point",name:"&#xf000a;"},{id:"sign_point",name:"&#xf000a;"},{id:"foot",name:"&#xe607;"},{id:"favor",name:"&#xe607;"}];function i(e,t){var r="";a.each(t,function(a){if(a.id==e){r=a.name;return true}});return r}if(e){var l,n,m;l=e.e;n=e.type||a.one(l.target).attr("data-type");if(!l||!n){return}if(n=="brand"){if(t.get(d.K.ITEMS)[n]){n="brand"}else{d.P.BRAND="my1111"}}var o=l.target;var s=a.DOM;m=e.callback||"";var b;if(e.flyer){var c=e.width?e.width:50;var _=e.height?e.height:50;var f=a.UA.ie<9;var p="";if(f){p='<img width="{2}" height="{3}" src="{4}"/>'
}else{p='<div class="mui-mbar-pan" style="border-radius: 50%; -webkit-border-radius: 50%; width: {2}px; height: {3}px; background:{4}; background-size: 100%;"></div>'}b=a.one(p.replace("{2}",c).replace("{3}",_).replace("{4}",f?e.flyer:"url("+e.flyer+")")).appendTo(document.getElementsByTagName("body")[0])}else{b=a.one('<div class="mui-mbar-pan mui-mbar-{0}-pan">{3}</div>'.replace("{0}",i(n,r)?n:"default").replace("{3}",i(n,r)?i(n,r):"")).appendTo(document.getElementsByTagName("body")[0])}if(n!="cart"){l.pageX=s.offset(o).left+(s.width(o)-b.width())/2;l.pageY=s.offset(o).top-b.height()/2}b.css({left:l.pageX-s.scrollLeft(),top:l.pageY-s.scrollTop()});if(n=="cart"||n=="favor"){e.bubble=e.bubble===undefined?true:e.bubble}if(n=="cart"){var v=t.get(d.K.ITEMS);var E;if(v){E=v.cart;if(E){E=E.get(d.K.POBJ);E.fire("addCartItem")}}}var T;var g;if(b&&b.width){T=l.pageX+b.width()/2;g=l.pageY+b.height()/2}else{T=l.pageX;g=l.pageY}this.fly({id:e.id||e.itemId||"",type:n,flyer:b,start:{left:T,top:g},target:e.target?e.target:null,unAnim:e.unAnim||false,bubble:e.bubble===false?e.bubble:true,speed:e.speed?e.speed:1.16,hideDelay:e.hideDelay?e.hideDelay:"",params:e.params||"",favorAd:e.favorAd||"",complete:function(){if(typeof m=="function"){m()}}})}},bubble:function(a){var e=this;a=a||{};a.show=typeof a.show=="undefined"?a.show=true:a.show;a.tab=a.tab||"PROF";a.title=a.title||"";a.content=a.content||"";a.isCustomContent=!!a.isCustomContent;var t=a.customContentType||2;if(typeof a.bubbleType=="undefined"){a.bubbleType=1}if(typeof a.isNotTabFire=="undefined"){a.isNotTabFire=true}var r={PROF:1,CART:2,ASSET:3,BRAND:4,PROMOTION:5};var i=e.get(d.K.ITEMS)[d.P[a.tab]];if(!i){return}if(a.show){u.log("isMallbarExpend",B);if(O){var l={tab:a.tab,id:a.flag||r[a.tab],item:i,opt:a};A.push(l);return}else if(!B&&!a.first){return}}if(a.show){if(a.tab=="PROF"){i.get("pluginObj").fire(d.E.PROF_HIDE)}}i.fire(d.E.BUBBLE_CHANGE,{show:a.show,html:a.content,height:a.height||"",showDelay:500,contentTitle:a.title,bubbleType:a.bubbleType,customContentType:t,isNotTabFire:a.isNotTabFire,hideDelay:a.hideDelay||"",showDelay:a.showDelay,dismiss:a.dismiss||"",showed:a.showed||"",clicked:a.clicked||"",arrClicked:a.arrClicked||"",arrShowed:a.arrShowed||"",colsedClicked:a.colsedClicked||""})},firstBubble:function(){var a=this;O=false;u.log("arrBubble",A);if(A&&A.length){var e=0,t={},r=A.length;for(var i=0;i<r;i++){for(e=i;e<r;e++){if(A[i].id>A[e].id){t=A[i];A[i]=A[e];A[e]=t}}}u.log("arrBubble sort",A);var l=A[0].opt;if(l.showTwo){if(A[1]){var n=A[1].opt;n.first=true;var m=l.dismiss||"";l.dismiss=function(){!!m&&m();a.bubble(n)}}}if(l){l.first=true;a.bubble(l)}A=[]}},openFavorRecommend:function(a){var e=this;if(!a){return}e.set("favorRec",a);var t=e.get(d.K.ITEMS)["favor"];var r=t.get(d.K.POBJ);if(!t.get(d.K.EXPAND)){e.expand({type:"favor"})}else{r.fire("visibilityChange",{visible:true})}}});return C},{requires:["base","event","node","anim","ua","swf","dom","cookie","ajax","xtemplate","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/model","mui/mallbar/mallbar-item","mui/mallbar/store","mui/mallbar/mallbar.css","mui/mallbar/mallbar-tab.css","mui/mallbar/mallbar-guide","mui/mallbar/plugin-prof","mui/mallbar/plugin-asset","mui/mallbar/plugin-brand","mui/mallbar/plugin-live","mui/mallbar/plugin-foot","mui/mallbar/plugin-top","mui/mallbar/plugin-ue","mui/mallbar/plugin-qrcode","mui/mallbar/plugin-favor","mui/mallbar/plugin-charge","mui/mallbar/plugin-promotion","mui/mallbar/plugin-cart","mui/mallbar/plugin-nav","mui/mallbar/plugin-worth"]});/*
Copyright 2014, KISSY v1.44
MIT Licensed
build time: May 22 12:31
*/
KISSY.add("swf/ua",[],function(h){function j(b){var i="string"===typeof b?b.match(/\d+/g).splice(0,3):b;h.isArray(i)&&(b=parseFloat(i[0]+"."+m(i[1],3)+m(i[2],5)));return b||0}function m(b,i){var b=(b||0)+"",h=i+1-b.length;return Array(0<h?h:0).join("0")+b}function k(h){if(h||l){l=!1;var i;if(navigator.plugins&&navigator.mimeTypes.length)i=(navigator.plugins["Shockwave Flash"]||0).description;else try{i=(new b.ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(k){}q=!i?void 0:
i.match(/\d+/g).splice(0,3)}return q}var q,l=!0,b=h.Env.host;return{fpv:k,fpvGTE:function(b,h){return j(k(h))>=j(b)}}});
KISSY.add("swf",["dom","json","attribute","swf/ua"],function(h,j){function m(a){var d=g;h.each(a,function(a,c){c=c.toLowerCase();c in z?d+=l(c,a):c===A&&(d+=l(c,q(a)))});return d}function k(a,d,e,c){var b=g,f=g;h.each(d,function(a,c){b+=" "+c+'="'+a+'"'});c?(b+=' classid="'+B+'"',f+=l("movie",a)):(b+=' data="'+a+'"',b+=' type="'+C+'"');f+=m(e);return r+s+b+t+f}function q(a){var b=[];h.each(a,function(a,c){"string"!==typeof a&&(a=y.stringify(a));a&&b.push(c+"="+D(a))});return b.join("&")}function l(a,
b){return'<param name="'+a+'" value="'+b+'"></param>'}var b=j("dom"),y=j("json"),i=j("attribute"),v=j("swf/ua"),o=!!h.Env.host.ActiveXObject,C="application/x-shockwave-flash",B="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",A="flashvars",g="",r="<",t=">",E=h.Env.host.document,w=v.fpv,F=v.fpvGEQ,x=v.fpvGTE,s="object",D=encodeURIComponent,z={wmode:g,allowscriptaccess:g,allownetworking:g,allowfullscreen:g,play:"false",loop:g,menu:g,quality:g,scale:g,salign:g,bgcolor:g,devicefont:g,hasPriority:g,base:g,
swliveconnect:g,seamlesstabbing:g},u;return u=i.extend({constructor:function(a){this.callSuper(a);var d=this.get("expressInstall"),e,c,g,a=this.get("htmlMode");c=this.get("params");var f=this.get("attrs"),i=this.get("document"),j=b.create("<span>",void 0,i),l=this.get("elBefore"),n=this.get("src"),m=!("id"in f),p=this.get("version");g=f.id=f.id||h.guid("ks-swf-");m&&(e=RegExp("\\s+id\\s*=\\s*['\"]?"+h.escapeRegExp(g)+"['\"]?","i"));if(w()){if(p&&!x(p)&&(this.set("status",u.Status.TOO_LOW),d)){n=d;
if(!("width"in f)||!/%$/.test(f.width)&&310>parseInt(f.width,10))f.width="310";if(!("height"in f)||!/%$/.test(f.height)&&137>parseInt(f.height,10))f.height="137";d=c.flashVars=c.flashVars||{};h.mix(d,{MMredirectURL:location.href,MMplayerType:o?"ActiveX":"PlugIn",MMdoctitle:i.title.slice(0,47)+" - Flash Player Installation"})}"full"===a?(o?(d=k(n,f,c,1),delete f.id,delete f.style,p=k(n,f,c,0)):(p=k(n,f,c,0),delete f.id,delete f.style,d=k(n,f,c,1)),c=d+p+r+"/"+s+t+r+"/"+s+t):c=k(n,f,c,o)+r+"/"+s+t;
this.set("html",e?c.replace(e,""):c);l?b.insertBefore(j,l):b.append(j,this.get("render"));"outerHTML"in j?j.outerHTML=c:j.parentNode.replaceChild(b.create(c),j);e=b.get("#"+g,i);"full"===a?o?this.set("swfObject",e):this.set("swfObject",e.parentNode):this.set("swfObject",e);m&&b.removeAttr(e,"id");this.set("el",e);this.get("status")||this.set("status",u.Status.SUCCESS)}else this.set("status",u.Status.NOT_INSTALLED)},callSWF:function(a,b){var e=this.get("el"),c,b=b||[];try{e[a]&&(c=e[a].apply(e,b))}catch(g){c=
"",0!==b.length&&(c='"'+b.join('", "')+'"'),c=(new Function("swf","return swf."+a+"("+c+");"))(e)}return c},destroy:function(){var a=this.get("swfObject");o?(a.style.display="none",function e(){if(4===a.readyState){for(var b in a)"function"===typeof a[b]&&(a[b]=null);a.parentNode.removeChild(a)}else setTimeout(e,10)}()):a.parentNode.removeChild(a)}},{ATTRS:{expressInstall:{value:h.config("base")+"swf/assets/expressInstall.swf"},src:{},version:{value:"9"},params:{value:{}},attrs:{value:{}},render:{setter:function(a){"string"===
typeof a&&(a=b.get(a,this.get("document")));return a},valueFn:function(){return document.body}},elBefore:{setter:function(a){"string"===typeof a&&(a=b.get(a,this.get("document")));return a}},document:{value:E},status:{},el:{},swfObject:{},html:{},htmlMode:{value:"default"}},getSrc:function(a){var d=a=b.get(a),e="",c,a=[],e=b.nodeName(d);if("object"===e){(e=b.attr(d,"data"))&&a.push(d);d=d.childNodes;for(e=0;e<d.length;e++)c=d[e],1===c.nodeType&&("movie"===(b.attr(c,"name")||"").toLowerCase()?a.push(c):
"embed"===b.nodeName(c)?a.push(c):"object"===b.nodeName(d[e])&&a.push(c))}else"embed"===e&&a.push(d);d=(a=a[0])&&b.nodeName(a);return"embed"===d?b.attr(a,"src"):"object"===d?b.attr(a,"data"):"param"===d?b.attr(a,"value"):null},Status:{TOO_LOW:"flash version is too low",NOT_INSTALLED:"flash is not installed",SUCCESS:"success"},HtmlMode:{DEFAULT:"default",FULL:"full"},fpv:w,fpvGEQ:F,fpvGTE:x})});
KISSY.add("mui/mallbar/conf",function(a){var _=location.href;var l=_.indexOf("mbar-debug=1")>-1;var t=_.indexOf("mbar-debug-tms=1")>-1;var m=_.indexOf("mbar-debug-log=1")>-1;var E="2014-03-06 03:20";var r=window.TB;var O=r&&r.globalToolFn&&a.isFunction(r.globalToolFn.isDaily)?r.globalToolFn.isDaily():location.hostname.indexOf(".net")>=0||location.hostname.indexOf(".com.hk")>=0;var n="//gm.mmstat.com";var B={VER:"2.4.0",DEBUG:l,DEBUG_LOG:m,IS_DAILY:O,SKIN:"mui-mbar-d11",TAB_W:50,MINI_HIT_WIDTH:50,TAB_W_C:100,ZINDEX:999999,SAMPLING:5/1e3,SAM_PV:1/1e3,EASE:"easeOut",BUBBLE_PAD:5,COMMON_DELAY:100,TIMEOUT_TOP:5*1e3,TIMEOUT_STORAGE:3*1e3,DEGRADE:-99,BUBBLE_HIDE_DELAY:12*1e3,AVATAR:O?"//wsapi.jianghu.daily.taobao.net/avatar/getAvatar.do?userId={0}&width={1}&height={1}&type=ww":"//wwc.alicdn.com/avatar/getAvatar.do?userId={0}&width={1}&height={1}&type=ww",CAT:"//img.alicdn.com/tps/i4/T1VaaiFdpdXXXtxVjX.swf",AR:n,CK_USED:"_mr",NO_IMG:"//img.alicdn.com/tps/i1/T1aYCaFaVcXXX6DYsb-100-100.gif",STORAGE_PROXY:"//www.tmall.com/go/act/storage-proxy.php",DOMAIN:O?".tmall.net":".tmall.com",RECOMMEND_APPID:"03159",ARR:{S1_DEFAULT:n+"/tmallbrand.999.102",S12:n+"/tmallbrand.99.1",S21:n+"/tmallbrand.99.2",S12_ACTIVE:n+"/tmallbrand.99.48",S21_ACTIVE:n+"/tmallbrand.99.49",S32_ACTIVE:n+"/tmallbrand.99.70",S31_ACTIVE:n+"/tmallbrand.99.71",S32:n+"/tmallbrand.99.9",S12_USER_TRIGGER:n+"/tmallbrand.99.113",S21_ICON_CLOSE:n+"/tmallbrand.99.114",QRCODE:n+"/tmallbrand.99.66",PROF:n+"/tmallbrand.99.3",PROF_LOGIN:n+"/tmallbrand.99.62",PROF_BUB_SHOW:n+"/tmallbrand.99.19",PROF_BUB_CLICK:n+"/tmallbrand.99.20",PROF_BUB_LINK_CLICK:n+"/tmallbrand.99.21",PROF_BUB_T0_SHOW:n+"/tmallbrand.99.89",PROF_BUB_T0_CLICK:n+"/tmallbrand.99.90",ASSETS_TAB_CLICK:n+"/tmallbrand.99.116",COUPON_AVAILABLE_SHOW:n+"/tmallbrand.99.7",COUPON_AVAILABLE_CLICK:n+"/tmallbrand.99.10",COUPON_MEMBER_BUBBLE_A_SHOW:n+"/tmallbrand.99.85",COUPON_MEMBER_BUBBLE_A_CLICK:n+"/tmallbrand.99.86",COUPON_MEMBER_BUBBLE_B_SHOW:n+"/tmallbrand.99.87",COUPON_MEMBER_BUBBLE_B_CLICK:n+"/tmallbrand.99.88",COUPON_7_SHOW:n+"/tmallbrand.99.13",COUPON_1_SHOW:n+"/tmallbrand.99.14",COUPON_7_CLICK:n+"/tmallbrand.99.15",COUPON_1_CLICK:n+"/tmallbrand.99.16",COUPON_COULD_SHOW:n+"/tmallbrand.99.59",COUPON_COULD_CLICK:n+"/tmallbrand.99.58",COUPON_FLY_BUB_SHOW:n+"/tmallbrand.99.26",COUPON_FLY_BUB_CLICK:n+"/tmallbrand.99.27",BONUS_FLY_BUB_SHOW:n+"/tmallbrand.99.28",BONUS_FLY_BUB_CLICK:n+"/tmallbrand.99.29",BONUS_AVAILABLE_BUB_SHOW:n+"/tmallbrand.99.30",BONUS_AVAILABLE_BUB_CLICK:n+"/tmallbrand.99.31",POINT_SHOW:n+"/tmallbrand.99.64",POINT_BUB_CLICK:n+"/tmallbrand.99.63",POINT_BUB_LINK_CLICK:n+"/tmallbrand.99.67",GET_COUPON_BUB_SHOW:n+"/tmallbrand.99.65",GET_COUPON_BUB_CLICK:n+"/tmallbrand.99.68",GET_COUPON_BUB_LINK_CLICK:n+"/tmallbrand.99.69",BRAND_FLY_BUB_SHOW:n+"/tmallbrand.99.23",BRAND_FLY_BUB_CLICK:n+"/tmallbrand.99.24",BRAND_FLY_BUB_LINK_CLICK:n+"/tmallbrand.99.25",LIVE_SHOW:n+"/tmallbrand.99.8",LIVE_CLICK:n+"/tmallbrand.99.11",LIVE_BUB_LINK_CLICK:n+"/tmallbrand.99.22",FOOT_BUBBLE:n+"/tmallbrand.99.17",FOOT_BUBBLE_CLICK:n+"/tmallbrand.99.18",FOOT_FLY_BUB_SHOW:n+"/tmallbrand.99.32",FOOT_FLY_BUB_CLICK:n+"/tmallbrand.99.33",FOOT_PIN_ITEM:n+"/tmallbrand.99.40",FOOT_DELETE_ITEM:n+"/tmallbrand.99.41",FOOT_CLEAR_HISTORY:n+"/tmallbrand.99.42",FOOT_UNPIN_ITEM:n+"/tmallbrand.99.43",CAL_REMIND:n+"/tmallbrand.99.53",CAL_BUB_SHOW:n+"/tmallbrand.99.54",CAL_BUB_CLICK:n+"/tmallbrand.99.55",CAL_BUB_LINK_CLICK:n+"/tmallbrand.99.57",CAL_DATE:n+"/tmallbrand.99.56",BACKTOP_CLICK:n+"/tmallbrand.99.115",PV:n+"/tmallbrand.999.1",LOGIN1:n+"/tmallbrand.999.2",LOGIN2:n+"/tmallbrand.999.3",RETINA:n+"/tmallbrand.999.4",FOOT_MORE_CLICK:n+"/tmallbrand.999.9",EXP1:n+"/tmallbrand.999.11",EXP2:n+"/tmallbrand.999.12",EXP3:n+"/tmallbrand.999.13",TIME1s:n+"/tmallbrand.999.14",TIME1m:n+"/tmallbrand.999.15",TIME1h:n+"/tmallbrand.999.16",TIME1d:n+"/tmallbrand.999.17",INCOGNITO:n+"/tmallbrand.999.18",CLEAR:n+"/tmallbrand.999.19",EXP7:n+"/tmallbrand.999.20",FAVOR_TO_MATCH:n+"/tmallbrand.99.77",FAVOR_TO_FX:n+"/tmallbrand.99.78",FAVOR_DELETE:n+"/tmallbrand.99.79",FAVOR_BACK:n+"/tmallbrand.99.80",FAVOR_CATE_CHECK:n+"/tmallbrand.99.81",FOOT_ADD_FAVOR:n+"/tmallbrand.99.82",PROMOTION_SHOW:n+"/tmallbrand.99.84",CART_TAB_CLICK:n+"/tmallbrand.99.101",CART_TAB_CLICK_DOWN:n+"/tmallbrand.99.102",PROMOTION_BUBBLE_SHOW:n+"/tmallbrand.99.91",PROMOTION_BUBBLE_CLICK:n+"/tmallbrand.99.92",LIVE_SHOP_CHAT_BUBBLE_SHOW:n+"/tmallbrand.99.121",LIVE_CHAT_BUBBLE_CLICK_TO_WW:n+"/tmallbrand.99.122",LIVE_CHAT_BUBBLE_CLICK_TO_LIVE:n+"/tmallbrand.99.123",QRCODE_BUBBLE_NO_LOGIN_QRCODE_SHOW:n+"/tmallbrand.99.124",QRCODE_BUBBLE_TUSER_QRCODE_SHOW:n+"/tmallbrand.99.125",QRCODE_BUBBLE_TUSER_QRCODE_CLICK:n+"/tmallbrand.99.126",ADD_FAVOR_FLY_BUB_SHOW:n+"/tmallbrand.99.127",ADD_FAVOR_FLY_BUB_CLICK:n+"/tmallbrand.99.128",DELETE_FAVOR_FLY_BUB_SHOW:n+"/tmallbrand.99.129",DELETE_FAVOR_FLY_BUB_CLICK:n+"/tmallbrand.99.130",MBAR_RECOMMEND_BUBBLE_CART:n+"/tmallbrand.99.131",MBAR_RECOMMEND_BUBBLE_FAVOR:n+"/tmallbrand.99.132",LIVE_EXPEND_TO_WW:n+"/tmallbrand.99.134",TMALLBAO_BUBBLE_SHOW:n+"/tmallbrand.99.135",TMALLBAO_BUBBLE_CLICK:n+"/tmallbrand.99.136",WORTH_BUBBLE_SHOW:n+"/tmallbrand.99.138",WORTH_BUBBLE_CLICK:n+"/tmallbrand.99.139",LIVE_BUBBLE_CLOSE_BOTTON_CLICK:n+"/tmallbrand.99.140",PROF_VIP_BUBBLE_DEFAULT_SHOW:n+"/tmallbrand.99.141",PROF_VIP_BUBBLE_DEFAULT_CLICK:n+"/tmallbrand.99.142",PROF_VIP_BUBBLE_SHOP_SHOW:n+"/tmallbrand.99.143",PROF_VIP_BUBBLE_SHOP_CLICK:n+"/tmallbrand.99.144",PROF_VIP_BUBBLE_DETAIL_SHOW:n+"/tmallbrand.99.145",PROF_VIP_BUBBLE_DETAIL_CLICK:n+"/tmallbrand.99.146",PROF_VIP_ACTIVATE_BUTTON:n+"/tmallbrand.99.147",PROF_VIP_ACTIVATE_SHOW:n+"/tmallbrand.99.148",PROF_VIP_ACTIVATE_SUCCESS:n+"/tmallbrand.99.149",PROF_VIP_COUPON_RENEWAL:n+"/tmallbrand.99.150",PROF_VIP_ITEM_RENEWAL:n+"/tmallbrand.99.151",PROF_VIP_BRAND_RENEWAL:n+"/tmallbrand.99.152",BRAND_MZ_TRY_BUBBLE_SHOW_DETAIL:n+"/tmallbrand.99.156",BRAND_MZ_TRY_BUBBLE_CLICK_DETAIL:n+"/tmallbrand.99.157",BRAND_MZ_TRY_BUBBLE_SHOW_SHOP:n+"/tmallbrand.99.158",BRAND_MZ_TRY_BUBBLE_CLICK_SHOP:n+"/tmallbrand.99.159",BRAND_MZ_TRY_BUBBLE_SHOW_LIST:n+"/tmallbrand.99.160",BRAND_MZ_TRY_BUBBLE_CLICK_LIST:n+"/tmallbrand.99.161",BRAND_MZ_TRY_BUBBLE_SHOW:n+"/tmallbrand.99.162",BRAND_MZ_TRY_BUBBLE_CLICK:n+"/tmallbrand.99.163",BRAND_MZ_TRY_BUBBLE_SHOW_ALL:n+"/tmallbrand.99.164",BRAND_MZ_TRY_BUBBLE_CLICK_ALL:n+"/tmallbrand.99.165",PROF_CHANNLE_BUBBLE_SHOW_BABY:n+"/tmallbrand.99.170",PROF_CHANNLE_BUBBLE_CLICK_BABY:n+"/tmallbrand.99.171",PROF_VIP_CHANGE_PROF:n+"/tmallbrand.99.166",PROF_VIP_MUYING_NEXT5Z:n+"/tmallbrand.99.167",PROF_VIP_MUYING_NEXT9Y:n+"/tmallbrand.99.168",PROF_VIP_MUYING_EDIT_BABYPLAN:n+"/tmallbrand.99.169",QRCODE_BUBBLE_NEW_QRCODE_SHOW:n+"/tmallbrand.99.172",QRCODE_BUBBLE_NEW_QRCODE_CLICK:n+"/tmallbrand.99.173",QRCODE_BUBBLE_OLD_QRCODE_SHOW:n+"/tmallbrand.99.174",QRCODE_BUBBLE_OLD_QRCODE_CLICK:n+"/tmallbrand.99.175",QRCODE_DEFAULT_BUBBLE_SHOW:n+"/tmallbrand.99.176",QRCODE_DEFAULT_BUBBLE_CLICK:n+"/tmallbrand.99.177",PROF_VIP_ACT_RENEWAL:n+"/tmallbrand.99.178"},PE:{},SCM:{PROF:"1048.1.2.2",LIVE:"1048.1.5.2",LIVE_BUB_LINK:"1048.1.5.3",BRAND_FLY_BUB_LINK:"1048.1.4.15",CAL_ACT:"1048.1.10.2",FAVOR_ITEM:"1048.1.11.1"},URL:{GET_BAR:O?"//bar.daily.tmall.net/getMallBar.htm?shopId={0}&v={1}&bizId={2}&sellerId={3}":"//bar.tmall.com/getMallBar.htm?shopId={0}&v={1}&bizId={2}&sellerId={3}",GET_MSG:O?"//bar.daily.tmall.net/getMessageWarn.htm":"//bar.tmall.com/getMessageWarn.htm",GET_PLUGIN_EXAMPLE:"example.do",GEI_PLUGIN_PROF:O?"//bar.daily.tmall.net/getMyInfo.htm":"//bar.tmall.com/getMyInfo.htm",GET_PLUGIN_ASSET:O?"//bar.daily.tmall.net/getMyAssets.htm":"//bar.tmall.com/getMyAssets.htm",GET_PLUGIN_ASSET_COUPON_DUE_TIP:O?"//bar.daily.tmall.net/cueCouponInfo.htm":"//bar.tmall.com/cueCouponInfo.htm",GET_PLUGIN_ASSET_COUPON_DISABLE_TIP:O?"//bar.daily.tmall.net/disableCouponInfo.htm":"//bar.tmall.com/disableCouponInfo.htm",GET_PLUGIN_ASSET_TIP:O?"//bar.daily.tmall.net/cueAssetMsg.htm":"//bar.tmall.com/cueAssetMsg.htm",GET_PLUGIN_MEMBER_RIGHT:O?"//bar.daily.tmall.net/getMemberRight.htm":"//bar.tmall.com/getMemberRight.htm",GET_PLUGIN_BRAND:"brand.do",GET_PLUGIN_GET_BRAND:O?"//mybrand.daily.tmall.net/ajax/mybrands/getMallBarMyBrands.htm?type=2":"//mybrand.tmall.com/ajax/mybrands/getMallBarMyBrands.htm?type=2",GET_PLUGIN_LIVE:O?"//tmm.daily.taobao.net/messagebox/readRadiateMsg.do":"//tmm.taobao.com/messagebox/readRadiateMsg.do?mconf=1",GET_PLUGIN_LIVE_TIP:O?"//bar.daily.tmall.net/getActiveMessage.htm":"//bar.tmall.com/getActiveMessage.htm",GET_PLUGIN_FOOT_ITEMS:O?"//bar.daily.tmall.net/getItemList.htm":"//bar.tmall.com/getItemList.htm",GET_PLUGIN_FOOT_ITEMS2:O?"//bar.daily.tmall.net/getItemList.htm":"//bar.tmall.com/getItemList.htm",GET_PLUGIN_FOOT_PINITEM:O?"//bar.daily.tmall.net/pinItem.htm":"//bar.tmall.com/pinItem.htm",GET_CALENDAR:O?"//tmsprepub.alicdn.com/go/act/getcalendar.php?date={0}":"//www.tmall.com/go/act/getcalendar.php?date={0}",GET_CONF:l?"data/mallbar-conf.js":O?"//tms.taobao.com/go/act/mallbar-conf.php":"//www.tmall.com/go/act/mallbar-conf.php",GEI_PUSH_ITEMS:O?"//110.75.14.52/recommend.htm":"//ald.taobao.com/recommend.htm",GET_PLUGIN_ASSET_OBTAIN_COUPON_LIST:O?"//bar.daily.tmall.net/cueAssetMsg.htm":"//bar.tmall.com/cueAssetMsg.htm",GET_PLUGIN_ASSET_OBTAIN_COUPON:O?"//bar.daily.tmall.net/obtainCoupon.htm":"//bar.tmall.com/obtainCoupon.htm",GET_PLUGIN_FAVOR_INFO:O?"//bar.daily.tmall.net/getCollectInfo.htm":"//bar.tmall.com/getCollectInfo.htm",GET_PLUGIN_FAVOR_FX:"//ald.taobao.com/recommend.htm?appId=03276",GET_PLUGIN_FAVOR_MATCH:"//ald.taobao.com/recommend.htm?appId=03278",FAVORITE_ITEM:O?"//bar.daily.tmall.net/favorite/favoriteItem.htm":"//bar.tmall.com/favorite/favoriteItem.htm",GET_PLUGIN_PROF_QUERY_T0_USER:O?"//bar.daily.tmall.net/activate/queryT0User.htm":"//bar.tmall.com/activate/queryT0User.htm",GET_PLUGIN_PROF_SET_T0_USER:O?"//bar.daily.tmall.net/activate/setT0User.htm":"//bar.tmall.com/activate/setT0User.htm",GET_PLUGIN_WORTH_RECOMMEND:"//ald.taobao.com/recommend.htm?appId=03343",GET_PLUGIN_WORTH_LISTS:"//ald.taobao.com/recommend.htm?appId=03342",GET_PLUGIN_LIVE_SHOP_INFO:O?"//bar.daily.tmall.net/wwDataSet.htm":"//bar.tmall.com/wwDataSet.htm",GET_MBAR_ADD_FAVOR_RECOMMEND:"//aldcdn.tmall.com/recommend.htm?appId=03136",GET_MBAR_ADD_CART_RECOMMEND:"//ald.taobao.com/recommend.htm?appId=03348",GET_SHOP_CARD:O?"//neo.daily.tmall.net/shopcard/showMyCards.do":"//neo.tmall.com/shopcard/showMyCards.do",GET_CLOSE_SALE_NUM:O?"//bar.daily.tmall.net/closeSaleNum.htm":"//bar.tmall.com/closeSaleNum.htm"},P:{PROF:"prof",ASSET:"asset",GET_COUPON:"asset",BONUS:"asset",GUESS_POINT:"asset",SIGN_POINT:"asset",BRAND:"brand",LIVE:"live",FOOT:"foot",CAL:"cal",TRIP:"trip",CART:"cart",NAV:" nav",QRCODE:"qrcode",TOP:"top",UE:"ue",CHARGE:"charge",FAVOR:"favor",PROMOTION:"promotion",WORTH:"worth",MY1111:"my1111"},E:{AFTER_BAR_CHANGE:"afterBarChange",MALLBAR_STATUS_CHANGE:"mallbarStatusChange",STATUS_CHANGE:"statusChange",SUPTIP_CHANGE:"suptipChange",BUBBLE_CHANGE:"bubbleChange",PAGE_VISIBILITY_CHANGE:"pageVisibilityChange",VISIBILITY_CHANGE:"visibilityChange",DATA_CHANGE:"dataChange",FLYIN_END:"flyinEnd",ERROR:"error",LOGIN:"login",LOGIN_SUCCESS:"loginSuccess",AFTER_EXPAND_CHANGE:"afterExpandChange",AFTER_TITLE_CHANGE:"afterTitleChange",PROF_CHANGE:"profChange",QRCODE_CHANGE:"qrcodeChange",ON_LOAD:"onLoad",PROF_HIDE:"hideProf",RIGHT_TAB_ITEM_CLICK:"rightTabItemClick"},K:{BAR:"bar",USERINFO:"userinfo",STATIC_CONF:"staticConf",TIMESTAMP:"timestamp",ACCESSED:"__mallbar_accessed",FRM_INIT:"mui/mallbar/frm/init",FRM_USERINFO:"mui/mallbar/frm/userinfo",FRM_ACCESS:"mui/mallbar/frm/access",FRM_STATUS:"mui/mallbar/frm/status",FRM_CART:"mui/mallbar/frm/cart",IFRAME:"iframe",XD:"xd",XD_TIMEOUT:"xdTimeout",IFRAME_TIMEOUT:"iframeTimeout",PROXY:"proxy",CALLBACK_LIST:"callbackList",CACHED_ACTION_LIST:"cachedActionList",PROXY_READY:"proxyReady",INITED:"inited",CONTAINER:"container",G_CONFIG:"gConfig",SHOP_CONFIG:"shopConfig",ITEMS:"items",MODEL:"model",ROOT:"root",ROOT_OUTER:"rootOuter",STATUS:"status",OLD_INDEX:"oldIndex",LOADED:"loaded",MALLBAR:"mallbar",MALLBAR_ITEM:"mallbarItem",TIP_CONTAINER:"tipContainer",TAB:"tab",TITLE:"title",INDEX:"index",BUBBLE:"bubble",PLUGIN:"plugin",SCR:"scr",EXPAND:"expand",POBJ:"pluginObj",PG_FISRT_VISIBLE:"pgFirstVisible",DATA:"data",SHOW_SUPTIP:"showSuptip",SUPTIP_NUM:"suptipNum",BUBBLE_TYPE:"bubbleType",SHOW_BUBBLE:"showBubble",NOT_TO_SUPTIP:"notToSuptip",COUPON_ANCHOR:"anchor",ADD_CART_ITEM:"addCartItem"},B:{FOREVER:1},S:{MINI:1,STANDARD:2,EXPAND:3,SCREEN:4,BAR_NO_MSG:-4,BAR_NOT_LOGIN:-2,BAR_SUCCESS:1},C:{TAB_HIGHLIGHT:"mui-mbar-tab-hover",TABS_SHADOW:"mui-mbar-tabs-shadow",MINI_CLOSE:"mui-mbar-mini-logo-close",CAT_LEFT:"mui-mbar-cat-left",SCALE_DOWN:"mui-mbar-plugin-scaleDown"},M:{B:"\u672c\u9875\u9762\u4e0d\u652f\u6301\u5de5\u5177\u680f",T:"\u63d2\u4ef6\u7c7b\u578b\u53ea\u652f\u6301\uff1abrand\u3001asset\u3001prof\u3001live\u3001foot"},U:{PROF_INTERACT:O?"//www.daily.tmall.net/go/act/tmall/2013-khc.php":"//1111.tmall.com",TRIP_TMS:t?"//demo.tmall.net/sell/gonglue/":"//www.tmall.com/go/rgn/promotion-act/strategytools.php",NAV_TMS:t?"//tmsprepub.alicdn.com/go/act/1212/mallbar-nav.php":O?"//tmsprepub.alicdn.com/go/act/1212/mallbar-nav.php":"//www.tmall.com/go/act/1212/mallbar-nav.php",ETC:{DAILY:"//tmsprepub.alicdn.com/go/rgn/main/2015/mallbar/config/mconf-pub-3_0_0.php",STB:"//www.tmall.com/go/rgn/main/2015/mallbar/config/mconf-pub-3_0_0.php",PRE:"//tmsprepub.alicdn.com/go/rgn/main/2015/mallbar/config/mconf-pub-3_0_0.php",ONLINE:"//www.tmall.com/go/rgn/main/2015/mallbar/config/mconf-pub-3_0_0.php"},QR:"//gtd.alicdn.com/tps/i1/TB1DV.LGXXXXXXgXFXXszjdGpXX-140-140.png",WW_MODULE:"//g.alicdn.com/aliww/ww/tlight/base.js"},T:{NUMLEV:13}};return B});KISSY.add("mui/mallbar/util",function(a,e,i,t,r,n,o,s,l){var m=/(\/\/.+?)(\?(.*?))?(#(.*?))?$/;var u={log:function(){if(!o.DEBUG_LOG){return}if(window.console&&window.console.log&&window.console.log.apply){window.console.log.apply(window.console,arguments)}},fm:function(){if(arguments.length==0){return""}else if(arguments.length==1){return arguments[0]}var a=arguments[0],e;for(e=1;e<arguments.length;++e){var i=new RegExp("\\{"+(e-1)+"\\}","g");a=a.replace(i,arguments[e])}return a},segment:function(a){var e={url:"",qs:"",hash:""};if(!a){return e}a+="";var i=m.exec(a);if(!i){return e}e.url=i[1]?i[1]:"";e.qs=i[3]?i[3]:"";e.hash=i[5]?i[5]:"";return e}};var c=u;c.getViewportWidth=function(){var a=document.documentElement;return window.innerWidth||a&&a.clientWidth||document.body.clientWidth};c.getViewportHeight=function(){var a=document.documentElement;return window.innerHeight||a&&a.clientHeight||document.body.clientHeight};c.getViewportSize=function(){return{w:c.getViewportWidth(),h:c.getViewportHeight()}};c.sendLog=function(a){if(!a){return}var e="__mbar_"+ +new Date+Math.random();var i=new Image;window[e]=i;i.src=c.fm("{0}{1}r{2}=1",a,a.indexOf("?")>-1?"&":"?",+new Date);i.onload=function(){window[e]=null}};var b;var d=false;var p=[];c.getStaticConf=function(e){if(b){e.cb&&e.cb(b);return}else{e.cb&&p.push(e.cb)}if(e.url){c.ajax({url:e.url,jsonpCallback:"__mallbarGetConf",scriptCharset:"gbk",error:function(a){c.log("__mallbarGetConf error\uff1a",a)},success:function(e){c.log("__mallbarGetConf",e);if(e){b=e;a.each(p,function(a){a(e)});p=[]}}})}};c.ajax=function(e){var i=e.success;var t=e.complete;var r=location.href;var n=r.indexOf("mbar-local=1")>-1;if(n&&o.DEBUG&&e.url.indexOf("mconf")>=0){e.type="get";e.dataType="script";var s="";var l=e.url;if(e.url.indexOf("?")>=0){var m=e.url.split("?");l=m[0];s=m[1]}var u=l.substring(l.lastIndexOf("/")+1,l.lastIndexOf(".")>=0?l.lastIndexOf("."):l.length);l=c.fm("data/{0}.js{1}",u,s?"?"+s:"");e.url=e._mockUrl?e._mockUrl:l;e.success=function(){i&&i(exports.response)}}else{e.type=e.type||"get";e.dataType=e.dataType||"jsonp";e.success=function(a){i&&i(a)}}var b=e.url.lastIndexOf("?")>-1;e.url=c.fm("{0}{1}_input_charset=UTF-8",e.url,b?"&":"?");e.timeout=e.timeout||5;e.error=e.error||function(a){c.log("U.ajax error: ",a)};var d=window.g_config||{};e.data=e.data||{};e.data.bizInfo=[d.bizId||"",d.sysId||"",d.devId||"pc"].join(".");e.complete=function(a){t&&t(a)};e.scriptCharset="gbk";a.ajax(e)};c.deepMerge=function(e,i){if(!a.isObject(e)||!a.isObject(i)){return e}a.each(i,function(i,t){if(a.isObject(e[t])){c.deepMerge(e[t],i)}else{e[t]=i}});return e};c.noScroll=function(a){if(!a){return}t.on(a,"mousewheel",function(a){var e=a.delta;var i=this.scrollTop;if(e>0&&0===i||e<0&&i+r.outerHeight(this)>=this.scrollHeight){a.halt()}})};var f=/^(\d+?)-(\d+?)-(\d+?) (\d+?):(\d+?):(\d+?)$/;var v=/^(\d+?)-(\d+?)-(\d+?)$/;c.getDateStr=function(a){a=a instanceof Date?a:new Date(a);return c.fm("{0}-{1}-{2}",a.getFullYear(),a.getMonth()+1,a.getDate())};c.parseDate=function(a){var e;e=f.exec(a);if(e){return new Date(e[1],parseInt(e[2],10)-1,e[3],e[4],e[5],e[6])}e=v.exec(a);if(e){return new Date(e[1],parseInt(e[2],10)-1,e[3])}return null};c.addSCM=function(a,e){var i=c.segment(a);i.qs=c.fm("?{0}{1}scm={2}",i.qs,i.qs?"&":"",e);return c.fm("{0}{1}{2}",i.url,i.qs,i.hash?"#"+i.hash:"")};var g=/^(\d+)\.(\d+)\.(\d+)$/;c.compareVersion=function(a,e){if(!g.test(a)||!g.test(e)){return-2}a=g.exec(a);e=g.exec(e);a=parseInt(a[1],10)*100+parseInt(a[2],10)*10+parseInt(a[3],10);e=parseInt(e[1],10)*100+parseInt(e[2],10)*10+parseInt(e[3],10);if(a===e){return 0}else if(a<e){return-1}else if(a>e){return 1}};c.sub=function(a,e){var i=/[^\x00-\xff]/g;if(a.replace(i,"mm").length<=e)return a;e=e-3;var t=Math.floor(e/2);for(var r=t;r<a.length;r++){if(a.substr(0,r).replace(i,"mm").length>=e){return a.substr(0,r)+"..."}}return a};if(a.isFunction(l)){c.codeTracker=new l;c.codeTracker.config({numLev:13,url:"//mallbar.tmall.com/code-tracker"})}else{c.codeTracker=l}c.getSysId=function(){var a="";var e=window.g_config.appId==1;var i=window.g_config.sysId=="list";var t=window.g_config.appId==2||window.g_config.appId==7;!!i&&(a="list");!!e&&(a="detail");!!t&&(a="shop");return a};return c},{requires:["cookie","ajax","event","dom","ua","mui/mallbar/conf","mui/minilogin/index","mui/code-tracker/code-tracker"]});window.MLoginTimer=0;window.MLoginShow=0;KISSY.add("mui/minilogin/index",function(e,n,i){var o=function(e){var n=location.hostname.split(".");return n.splice(n.length-e>0?n.length-e:0,e).join(".")}(2),t=location.hostname.indexOf(".net")>=0||location.hostname.indexOf(".com.hk")>=0,a=t?"daily.taobao.net":"taobao.com",r=t?"daily.tmall.net":"tmall.com",l=t?"daily.tmall.com.hk":"tmall.hk",c,m="assets_css=2.0.0/login_mini.css&enup_css=2.0.0/enup_mini.css",s="//login."+a+"/member/login.jhtml?style=miniall&enup=true&from=tmall&allp="+escape(m);var d=window.location.protocol;var w={check:true,needRedirect:false,sub:false,proxy:{tmall:d+"//vip."+r+"/miniLoginProxy.htm",hk:d+"//www."+l+"/loginproxy.htm",yao:d+"//yao.95095.com/go/rgn/95095/loginproxy.php",etao:d+"//vip.daily.tmall.net/miniLoginProxy.htm"}};function f(e){var n=document.createElement("a");n.href=e;return n.hostname===location.hostname}var u={show:function(n,i){window.goldlog&&window.goldlog.send("//log.mmstat.com/tmallmember.9.2",{});u.Analytics.MLstar=new Date*1;var o=this;if(typeof n!=="function"){i=n;n=null}i=e.merge(w,i);var t=new Date;t.setDate(t.getDate()-1);document.cookie="cookie2=;expires="+t.toGMTString()+";path=/;domain=.tmall.com";if(i.check===false){this._show(n,i)}else{this._check(function(e){u.Analytics.MLcheckStar=new Date*1;if(e){if(window.MLoginShow<=1){TB&&TB.Global&&TB.Global.updateLoginInfo()}n&&n();window.MLoginShow+=1}else{o._show(n,i)}},i)}},_checkPage:function(){return window.TB&&window.TB.userInfo&&window.TB.userInfo.isLogin},_check:function(n,i){u.Analytics.MLcheckStar=new Date*1;var o=this;var t=i.checkTimeout||5;var a=false,l=e.later(function(){if(!a){n(o._checkPage())}l&&l.cancel()},t*1e3);if(i&&i.checkApi&&i.checkApi.indexOf(".tmall.")==-1){i.checkApi=undefined}return e.io({type:"get",url:i.checkApi?i.checkApi:"//miaoxin."+r+"/member/user_login_info2.do",success:function(e){u.Analytics.MLcheckEnd=new Date*1;e=e||{};if(e.status==1111){a=true;n(o._checkPage());return}a=true;n(e.login)},error:function(){a=true;n(o._checkPage())},timeout:t,dataType:"jsonp",charset:"utf-8",cache:false,headers:{"X-Requested-With":false}})},_show:function(i,t){u.Analytics.MLshowStar=new Date*1;window.MLoginTimer+=1;if(!!t.insert){window.MLoginTimer=0}if(window.MLoginTimer>1){return}var r,l=s,m="",d=window.location.hostname,w="";if(!!e.UA.mobile){m=window.location.href;l="//login."+a+"/member/login.jhtml?redirectURL="+encodeURIComponent(m);window.location.href=l;window.MLoginTimer=0;return false}if(t.needRedirect){var h=t.redirectUrl?t.redirectUrl:location.href.split("#")[0];l+="&full_redirect=true&tpl_redirect_url="+encodeURIComponent(h)}else{r="g_tml_callbak"+(new Date).getTime();window[r]=function(){var e=window.TB||{};c&&c.hide();e&&e.Global&&e.Global.updateLoginInfo();window.MLoginTimer=0;window.MLoginShow+=1;i&&i.apply(this,arguments);try{delete window[r]}catch(n){}};if(t["proxyURL"]){m+=t["proxyURL"]}else if(d.indexOf(".hk")>=0){m+=t["proxy"]["hk"]}else if(d.indexOf("95095.com")>=0){m+=t["proxy"]["yao"]}else if(d.indexOf("95095.daily.etao.net")>=0){m+=t["proxy"]["etao"]}else{m+=t["proxy"]["tmall"]}m+=(m.indexOf("?")>0?"&":"?")+"callback="+r;if(!f(m)&&document.domain!==o){document.domain=o}if(f(m)&&document.domain===location.hostname){m+="&nsdomain=true"}l+="&full_redirect=false&tpl_redirect_url="+encodeURIComponent(m)}if(t.sub){l+="&sub=true"}if(window.g_config&&window.g_config.moduleTimeStamp&&window.g_config.moduleTimeStamp.minilogin){l+="&t="+window.g_config.moduleTimeStamp.minilogin}w='<iframe class="j_minilogin_iframe"'+'style="background: #FFF; '+(!!t.insert?'"':'margin:20px 0 0 40px;"')+' width="320" scrolling="no" height="304" frameborder="no" src="'+l+'"></iframe>';if(!!t.insert){e.all(t.insert).append(w);return}c=new n({width:400,height:360,bodyContent:w,mask:true,showCat:true,zIndex:999999,align:{points:["cc","cc"]}});c.render();c.show();var g=e.version.indexOf("1.3")>=0,p=e.all(g?c.__attrVals.el:c.$el),y=g?".mui-stdmod-body":".mui-dialog-body",k=g?".mui-ext-close":".mui-dialog-close",_=p.all(".j_minilogin_iframe");_.parent(y).style("background-color","#FAFAFA");u.Analytics.MLshowEnd=new Date*1;p.all(k).on("click",function(){t.closeCallback&&t.closeCallback();window.MLoginTimer=0;c.destroy()});_.on("load",function(){u.Analytics.MLloaded=new Date*1;u.sendTrack()})},Analytics:{},sendTrack:function(){if(!window.performance||window.performance&&!window.performance.getEntriesByType){return}var e;for(var n=0,i=window.performance.getEntriesByType("resource");n<i.length;n++){if(i[n]["initiatorType"]=="iframe"&&i[n]["name"].indexOf("https://login.taobao.com/member/login.jhtml")>=0){e=i[n];break}}if(!e){return}var o=[];for(var t in e){o.push(t+"="+(t=="name"?"//login.taobao.com":e[t]))}for(var t in u.Analytics){o.push(t+"="+u.Analytics[t])}o.push("MLtype=minilogin");var a=["[uhttp://login.tmall.com/track/0.2.0/]","[r10]"].join(""),r=document.cookie.match(/_nk_\=([^\;]*); /),l=r&&r[1]||"",c="//gm.mmstat.com/ued.1.1.2?type=9&id=jstracker&v=0.02&nick="+encodeURIComponent(l)+"&msg="+a+escape(o.join("&"));(new Image).src=c}};return u},{requires:["mui/overlay/dialog","io"]});KISSY.add("mui/overlay/dialog",function(e,t){function i(t){var n=this;n.config=e.merge(i.Config,t);n.config.elCls=n.config.elCls||"";n.config.elCls+=n.config.skin?" mui-dialog-"+n.config.skin:"";if(n.config.mask){n.config.elCls+=" mui-dialog-hasmask"}i.superclass.constructor.call(this,n.config);var s=true;function o(){var t=n.get("el"),i=e.UA.ie<8?"style='height:expression(this.parentNode.clientHeight);'":"";t.append("<div class='mui-dialog-skin' "+i+"></div>"+(n.config.showCat?"<i class='mui-dialog-cat'></i>":""));s=false}n.on("afterRenderUI",function(){o()});if(n.get("initRender")){n.render()}}i.Config={prefixCls:"mui-",showCat:true,zIndex:99999,initRender:false};e.extend(i,t.Dialog);e.augment(i,{setBodyContent:function(e){var t=this;t.set("bodyContent",e);t.render()},setHeaderContent:function(e){var t=this;t.set("headerContent",e);t.render()},setFooterContent:function(e){var t=this;t.set("footerContent",e);t.render()}});if(e.version.match(/^1\.[123]/)){e.getScript(location.protocol+"//g.alicdn.com/mui/overlay/1.0.6/overlay.css")}return i},{requires:["overlay","mui/overlay/overlay.css","mui/button/btn.css","mui/button/btn-tb.css","mui/msg/msg.css"]});/*
Copyright 2014, KISSY v1.44
MIT Licensed
build time: May 22 12:29
*/
KISSY.add("overlay/extension/loading",["node"],function(h,e){function c(){}var g=e("node");c.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new g('<div class="'+this.get("prefixCls")+'ext-loading" style="position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);"/>')).appendTo(this.$el));this._loadingExtEl.show()},unloading:function(){var b=this._loadingExtEl;b&&b.hide()}};return c});
KISSY.add("overlay/extension/mask",["node"],function(h,e){function c(a,b){var i=a.view.getBaseCssClasses("mask"),i=m('<div  style="width:'+(f?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(f?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(f?"absolute":"fixed")+';" class="'+i+" "+b+'">'+(f?'<iframe style="position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;"></iframe>':
"")+"</div>").prependTo("body");i.unselectable();i.on("mousedown",function(a){a.preventDefault()});return i}function g(){}function b(a,i){var b=a.get("maskNode"),d=a.view.getBaseCssClasses("mask-hidden");i?b.removeClass(d):b.addClass(d)}function a(a,i,d,c){var f=a.effect||k;b(c,d);if(f!==k){var c=a.duration,a=a.easing,e=d?1:0;i.stop(1,1);i.css("display",d?k:"block");i[f+l[f][e]](c,function(){i.css("display","")},a)}}function i(i){var b=this.get("maskNode");if(i=i.newVal){var d=Number(this.$el.css("z-index"));
isNaN(d)||b.css("z-index",d)}a(this.get("mask"),b,i,this)}var d=h.UA,p=e("node"),f=6===d.ie,m=p.all;g.ATTRS={mask:{value:!1},maskNode:{}};var k="none",l={fade:["Out","In"],slide:["Up","Down"]};g.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",c(this,this.get("visible")?"":this.view.getBaseCssClasses("mask-hidden")))},__bindUI:function(){var a,b;if(b=this.get("mask")){a=this.get("maskNode");if(b.closeOnClick)a.on(p.Gesture.tap,this.close,this);this.on("afterVisibleChange",i)}},
__destructor:function(){var a;(a=this.get("maskNode"))&&a.remove()}};return g});
KISSY.add("overlay/close-xtpl",[],function(){return function(h){var e,c=this;e=this.config.utils;var g=e.runBlockCommand,b=e.renderOutput,a=e.getProperty,i=e.runInlineCommand,d=e.getPropertyOrRunCommand;e="";var p={},f=[],a=a(c,h,"closable",0,1);f.push(a);p.params=f;p.fn=function(a){var f;f='\n<a href="javascript:void(\'close\')"\n   id="ks-overlay-close-';var e=d(c,a,{},"id",0,3);f+=b(e,!0);f+='"\n   class="';var e={},g=[];g.push("close");e.params=g;e=i(c,a,e,"getBaseCssClasses",4);f+=b(e,!0);f+=
"\"\n   role='button'>\n    <span class=\"";e={};g=[];g.push("close-x");e.params=g;a=i(c,a,e,"getBaseCssClasses",6);f+=b(a,!0);return f+'">close</span>\n</a>\n'};e+=g(c,h,p,"if",1);return e+"\n"}});
KISSY.add("overlay/overlay-xtpl",["overlay/close-xtpl","component/extension/content-xtpl"],function(h,e,c,g){return function(b){var a,i;a=this.config.utils;"undefined"!==typeof g&&g.kissy&&(i=g);var d=a.renderOutput,c=a.runInlineCommand;a="";var f={},m=[];m.push("overlay/close-xtpl");f.params=m;i&&(e("overlay/close-xtpl"),f.params[0]=i.resolveByName(f.params[0]));f=c(this,b,f,"include",1);a+=d(f,!1);a+="\n";f={};m=[];m.push("component/extension/content-xtpl");f.params=m;i&&(e("component/extension/content-xtpl"),
f.params[0]=i.resolveByName(f.params[0]));b=c(this,b,f,"include",2);return a+=d(b,!1)}});
KISSY.add("overlay/overlay-render",["component/container","./overlay-xtpl","component/extension/content-render"],function(h,e){var c=e("component/container"),g=e("./overlay-xtpl"),b=e("component/extension/content-render");return c.getDefaultRender().extend([b],{createDom:function(){this.fillChildrenElsBySelectors({closeBtn:"#ks-overlay-close-{id}"})}},{ATTRS:{contentTpl:{value:g}},HTML_PARSER:{closeBtn:function(a){return a.one("."+this.getBaseCssClass("close"))}}})});
KISSY.add("overlay/extension/overlay-effect",[],function(h){function e(a){var b=a.$el.clone(!0);b.css({visibility:"visible",overflow:"hidden"}).addClass(a.get("prefixCls")+"overlay-ghost");return a.__afterCreateEffectGhost(b)}function c(a,b){a.__effectGhost&&a.__effectGhost.stop(1,1);var c=a.$el,f=h.all,g=a.get("effect"),k=f(g.target),f=g.duration,l={width:k.width(),height:k.height()},j=k.offset(),o={width:c.width(),height:c.height()},r=c.offset(),q,n=e(a),s=g.easing;n.insertAfter(c);b?(k=l,q=j,l=
o,j=r):(k=o,q=r);n.offset(j);h.mix(l,{left:n.css("left"),top:n.css("top")});c.css("visibility","hidden");n.css(k);n.offset(q);a.__effectGhost=n;n.css("visibility","visible");n.animate(l,{Anim:g.Anim,duration:f,easing:s,complete:function(){a.__effectGhost=null;n.remove();c.css("visibility","")}})}function g(b,d,e){var f=b.$el,g=b.get("effect"),k=g.effect||"none",l=g.target;"none"===k&&!l?e():l?c(b,d,e):(b=g.duration,g=g.easing,l=d?1:0,f.stop(1,1),f.css({visibility:"visible",display:d?"none":"block"}),
f[k+a[k][l]](b,function(){f.css({display:"block",visibility:""});e()},g))}function b(){}var a={fade:["Out","In"],slide:["Up","Down"]};b.ATTRS={effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(b){var d=b.effect;"string"===typeof d&&!a[d]&&(b.effect="")}}};b.prototype={__afterCreateEffectGhost:function(a){return a},_onSetVisible:function(a){var b=this;g(b,a,function(){b.fire(a?"show":"hide")})}};return b});
KISSY.add("overlay/control","component/container,component/extension/shim,component/extension/align,./extension/loading,./extension/mask,./overlay-render,./extension/overlay-effect".split(","),function(h,e){var c=e("component/container"),g=e("component/extension/shim"),b=e("component/extension/align"),a=e("./extension/loading"),i=e("./extension/mask"),d=e("./overlay-render"),p=e("./extension/overlay-effect"),f={hide:"hide",destroy:"destroy"};return c.extend([g,a,b,i,p],{bindUI:function(){var a=this,
b=a.get("closeBtn");if(b)b.on("click",function(b){a.close();b.preventDefault()})},close:function(){this[f[this.get("closeAction")]||"hide"]();return this}},{ATTRS:{contentEl:{},closable:{value:false,view:1},closeBtn:{view:1},closeAction:{value:"hide"},focusable:{value:false},allowTextSelection:{value:true},handleMouseEvents:{value:false},visible:{value:false},xrender:{value:d}},xclass:"overlay"})});
KISSY.add("overlay/dialog-xtpl",["overlay/close-xtpl"],function(h,e,c,g){return function(b){var a,c=this,d;a=this.config.utils;"undefined"!==typeof g&&g.kissy&&(d=g);var h=a.runBlockCommand,f=a.renderOutput,m=a.getProperty,k=a.runInlineCommand,l=a.getPropertyOrRunCommand;a="";var j={},o=[];o.push("overlay/close-xtpl");j.params=o;d&&(e("overlay/close-xtpl"),j.params[0]=d.resolveByName(j.params[0]));d=k(c,b,j,"include",1);a+=f(d,!1);a+='\n<div id="ks-content-';d=l(c,b,{},"id",0,2);a+=f(d,!0);a+='"\n     class="';
d={};j=[];j.push("content");d.params=j;d=k(c,b,d,"getBaseCssClasses",3);a+=f(d,!0);a+='">\n    <div class="';d={};j=[];j.push("header");d.params=j;d=k(c,b,d,"getBaseCssClasses",4);a+=f(d,!0);a+='"\n         style="\n';d={};j=[];o=m(c,b,"headerStyle",0,6);j.push(o);d.params=j;d.fn=function(a){var b;b=" \n ";var d=l(c,a,{},"xindex",0,7);b=b+f(d,true);b=b+":";a=l(c,a,{},".",0,7);b=b+f(a,true);return b+";\n"};a+=h(c,b,d,"each",6);a+='\n"\n         id="ks-stdmod-header-';d=l(c,b,{},"id",0,10);a+=f(d,!0);
a+='">';d=l(c,b,{},"headerContent",0,10);a+=f(d,!1);a+='</div>\n\n    <div class="';d={};j=[];j.push("body");d.params=j;d=k(c,b,d,"getBaseCssClasses",12);a+=f(d,!0);a+='"\n         style="\n';d={};j=[];o=m(c,b,"bodyStyle",0,14);j.push(o);d.params=j;d.fn=function(a){var b;b=" \n ";var d=l(c,a,{},"xindex",0,15);b=b+f(d,true);b=b+":";a=l(c,a,{},".",0,15);b=b+f(a,true);return b+";\n"};a+=h(c,b,d,"each",14);a+='\n"\n         id="ks-stdmod-body-';d=l(c,b,{},"id",0,18);a+=f(d,!0);a+='">';d=l(c,b,{},"bodyContent",
0,18);a+=f(d,!1);a+='</div>\n\n    <div class="';d={};j=[];j.push("footer");d.params=j;k=k(c,b,d,"getBaseCssClasses",20);a+=f(k,!0);a+='"\n         style="\n';k={};d=[];m=m(c,b,"footerStyle",0,22);d.push(m);k.params=d;k.fn=function(a){var b;b=" \n ";var d=l(c,a,{},"xindex",0,23);b=b+f(d,true);b=b+":";a=l(c,a,{},".",0,23);b=b+f(a,true);return b+";\n"};a+=h(c,b,k,"each",22);a+='\n"\n         id="ks-stdmod-footer-';h=l(c,b,{},"id",0,26);a+=f(h,!0);a+='">';b=l(c,b,{},"footerContent",0,26);a+=f(b,!1);
return a+'</div>\n</div>\n<div tabindex="0"></div>'}});
KISSY.add("overlay/dialog-render",["./overlay-render","./dialog-xtpl"],function(h,e){var c=e("./overlay-render"),g=e("./dialog-xtpl");return c.extend({beforeCreateDom:function(b){h.mix(b.elAttrs,{role:"dialog","aria-labelledby":"ks-stdmod-header-"+this.control.get("id")})},createDom:function(){this.fillChildrenElsBySelectors({header:"#ks-stdmod-header-{id}",body:"#ks-stdmod-body-{id}",footer:"#ks-stdmod-footer-{id}"})},getChildrenContainerEl:function(){return this.control.get("body")},_onSetBodyStyle:function(b){this.control.get("body").css(b)},
_onSetHeaderStyle:function(b){this.control.get("header").css(b)},_onSetFooterStyle:function(b){this.control.get("footer").css(b)},_onSetBodyContent:function(b){var a;a=this.control.get("body");a.html(b)},_onSetHeaderContent:function(b){var a;a=this.control.get("header");a.html(b)},_onSetFooterContent:function(b){var a;a=this.control.get("footer");a.html(b)}},{ATTRS:{contentTpl:{value:g}},HTML_PARSER:{header:function(b){return b.one("."+this.getBaseCssClass("header"))},body:function(b){return b.one("."+
this.getBaseCssClass("body"))},footer:function(b){return b.one("."+this.getBaseCssClass("footer"))},headerContent:function(b){return b.one("."+this.getBaseCssClass("header")).html()},bodyContent:function(b){return b.one("."+this.getBaseCssClass("body")).html()},footerContent:function(b){return(b=b.one("."+this.getBaseCssClass("footer")))&&b.html()}}})});
KISSY.add("overlay/dialog",["./control","./dialog-render","node"],function(h,e){var c=e("./control"),g=e("./dialog-render"),b=e("node"),c=c.extend({__afterCreateEffectGhost:function(a){var b=this.get("body");a.all("."+this.get("prefixCls")+"stdmod-body").css({height:b.height(),width:b.width()}).html("");return a},handleKeyDownInternal:function(c){if(this.get("escapeToClose")&&c.keyCode===b.KeyCode.ESC){if("select"!==c.target.nodeName.toLowerCase()||c.target.disabled)this.close(),c.halt()}else a:if(c.keyCode===
a){var d=this.$el,e=b.all(c.target),f=d.last();if(e.equals(d)&&c.shiftKey)f[0].focus(),c.halt();else if(e.equals(f)&&!c.shiftKey)this.focus(),c.halt();else if(e.equals(d)||d.contains(e))break a;c.halt()}},_onSetVisible:function(a,b){var c=this.el;if(a)this.__lastActive=c.ownerDocument.activeElement,this.focus(),c.setAttribute("aria-hidden","false");else{c.setAttribute("aria-hidden","true");try{this.__lastActive&&this.__lastActive.focus()}catch(f){}}this.callSuper(a,b)}},{ATTRS:{header:{view:1},body:{view:1},
footer:{view:1},bodyStyle:{value:{},view:1},footerStyle:{value:{},view:1},headerStyle:{value:{},view:1},headerContent:{value:"",view:1},bodyContent:{value:"",view:1},footerContent:{value:"",view:1},closable:{value:!0},xrender:{value:g},focusable:{value:!0},escapeToClose:{value:!0}},xclass:"dialog"}),a=b.KeyCode.TAB;return c});
KISSY.add("overlay/popup",["./control"],function(h,e){return e("./control").extend({initializer:function(){var c=this;c.get("trigger")&&("mouse"===c.get("triggerType")?(c._bindTriggerMouse(),c.on("afterRenderUI",function(){c._bindContainerMouse()})):c._bindTriggerClick())},_bindTriggerMouse:function(){var c=this,e=c.get("trigger"),b;c.__mouseEnterPopup=function(a){c._clearHiddenTimer();b=h.later(function(){c._showing(a);b=void 0},1E3*c.get("mouseDelay"))};e.on("mouseenter",c.__mouseEnterPopup);c._mouseLeavePopup=
function(){b&&(b.cancel(),b=void 0);c._setHiddenTimer()};e.on("mouseleave",c._mouseLeavePopup)},_bindContainerMouse:function(){this.$el.on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var c=this;c._hiddenTimer=h.later(function(){c._hiding()},1E3*c.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=void 0)},_bindTriggerClick:function(){var c=this;c.__clickPopup=function(e){e.preventDefault();
if(c.get("toggle"))c[c.get("visible")?"_hiding":"_showing"](e);else c._showing(e)};c.get("trigger").on("click",c.__clickPopup)},_showing:function(c){this.set("currentTrigger",h.one(c.target));this.show()},_hiding:function(){this.set("currentTrigger",void 0);this.hide()},destructor:function(){var c=this.$el,e=this.get("trigger");e&&(this.__clickPopup&&e.detach("click",this.__clickPopup),this.__mouseEnterPopup&&e.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&e.detach("mouseleave",
this._mouseLeavePopup));c.detach("mouseleave",this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(c){return h.all(c)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}},xclass:"popup"})});KISSY.add("overlay",["overlay/control","overlay/dialog","overlay/popup"],function(h,e){var c=e("overlay/control"),g=e("overlay/dialog"),b=e("overlay/popup");c.Dialog=g;h.Dialog=g;c.Popup=b;return h.Overlay=c});
KISSY.add("mui/mallbar/model",function(a,e,t,i,r,n){var l=window.location.href.indexOf("mbar-mock-20141111=1")>-1;var o=function(a){var e=this;a=a||{};o.superclass.constructor.call(e,a);e.init()};a.extend(o,a.Base,{init:function(){var a=this},isAccessed:function(){var a=t.get(i.CK_USED);r.log("used",a,t);return a==="1"},setAccessed:function(){t.set(i.CK_USED,"1",2147483647/86400,i.DOMAIN,"/")},getServerTime:function(){var a=this;var e=a.get(i.K.TIMESTAMP);return e?new Date(e):new Date},getUid:function(a){var e=this;a=a||e.get(i.K.USERINFO);var t="";try{if(a&&a.memberInfo){t=a.memberInfo.cookies.unb.value}}catch(n){r.log("getUid error",n)}return t},getBar:function(e){var t=this;var o=false;var s=0;var m=e.mallbar||null;var b={isLogin:true,nick:"",memberInfo:{isLogin:true,availablePoints:-99,activeStatus:-99,cookies:{unb:{value:""}}}};r.log("\u5f00\u59cb\u83b7\u53d6\u7528\u6237\u6570\u636e");function c(o){clearTimeout(s);r.log("\u5df2\u83b7\u53d6\u7528\u6237\u6570\u636e memberInfoReady",o);t.set(i.K.USERINFO,o);n.set({k:i.K.FRM_USERINFO,v:""});o.isLogin&&Math.random()<i.SAM_PV&&r.sendLog(i.ARR.LOGIN1);if(window.shop_config){e.sellerNickName=window.shop_config.user_nick||""}else{e.sellerNickName=e.gConfig.sellerNickName||""}r.log("\u5f00\u59cb\u83b7\u53d6\u6846\u67b6\u6570\u636e",e);r.ajax({url:r.fm(i.URL.GET_BAR,e.shopId,i.VER,e.gConfig.bizId||"",e.gConfig.sellerId||""),data:{sellerNickName:decodeURIComponent(e.sellerNickName)},scriptCharset:"gbk",jsonpCallback:"__mallbarGetMallBar",success:function(o){r.log("\u5df2\u83b7\u53d6\u6846\u67b6\u6570\u636e",o);if(!o){r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.model.mallbarGetMallBar.get.data.empty","\u83b7\u53d6\u6846\u67b6\u6570\u636e\u4e3a\u7a7a");return}if(o.t){t.set(i.K.TIMESTAMP,o.t)}var s=o.s;if(s===i.S.BAR_SUCCESS||s===i.S.BAR_NOT_LOGIN||s===i.S.BAR_NO_MSG){s===i.S.BAR_SUCCESS&&Math.random()<i.SAM_PV&&r.sendLog(i.ARR.LOGIN2);r.getStaticConf({url:i.U.ETC[o.l.toUpperCase()],cb:function(s){if(!s.l||!s.l.length){return}var m=[];a.each(s.l,function(a){var t=l&&a.specail;if(a.on&&(!a.since||r.compareVersion(i.VER,a.since)>=0)||t){if(e.gConfig.bizId==="chaoshi"&&a.id===i.P.CART){return}a.m=0;m.push(a)}});if(!m.length){return}o.l=m;a.each(o.q,function(e){a.each(o.l,function(a){if(a.id===e.id){a.m=e.m;return false}})});n.set({k:i.K.FRM_INIT,success:function(){r.log("\u5408\u5e76\u540e\u7684\u6846\u67b6\u6570\u636e",o);t.set(i.K.BAR,o)}})}})}},error:function(n){r.log("\u83b7\u53d6\u6846\u67b6\u6570\u636e\u5931\u8d25",n);r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.model.mallbarGetMallBar.get.failure","\u83b7\u53d6\u5de5\u5177\u680f\u6846\u67b6\u4fe1\u606f\u5931\u8d25");r.getStaticConf({url:i.U.ETC["ONLINE"],cb:function(l){n=n||{};if(!l.l||!l.l.length){return}var o=[];a.each(l.l,function(a){if(a.on&&(!a.since||r.compareVersion(i.VER,a.since)>=0)){if(e.gConfig.bizId==="chaoshi"&&a.id===i.P.CART){return}a.m=0;o.push(a)}});if(!o.length){return}t.set(i.K.BAR,{l:o})}})}})}function d(a){o=true;a=a||b;r.log("\u8d85\u65f6\u5f02\u5e38\u6216\u65e0\u540a\u9876",a);c(a)}var u=window.TB;if(u&&u.Global&&u.Global.loginStatusReady&&u.Global.memberInfoReady){var f={};s=setTimeout(function(){var e=r.deepMerge(a.clone(b),e);r.log("timeout enter",e);d(e)},i.TIMEOUT_TOP);u.Global.loginStatusReady(function(a){r.log("loginStatusReady",a);f=a;m.set("token",a["tbToken"]);if(!a.isLogin){c(a)}else{u.Global.memberInfoReady(function(a){if(o){r.log("timeout quit",a);return}c(a)})}})}else{d()}var g=m.get(i.K.SHOP_CONFIG)||m.get(i.K.G_CONFIG)||{};var _="",v="",p="",T="",E="",A="";if(window.g_config&&window.g_config.itemId){_=window.g_config.itemId}v=g.userId||g.sellerId||"";p=!!g.shopId?g.shopId:"";var h=a.one(".j_CollectBrand");if(h){E=h.attr("data-brandId")||""}var I=a.one("#J_CrumbSearchForm");var B=I&&I.one('input[name="cat"]');if(B){T=B.val()}if(!T){var C=a.unparam(r.segment(location.href).qs)||{};T=C.cat||""}if(window.g_config){A=!!window.g_config.bizId?window.g_config.bizId:""}m.set("itemId",_);m.set("sellerId",v);m.set("shopId",p);m.set("brandId",E);m.set("category",T);m.set("bizId",A);setTimeout(function(){var a=window.devicePixelRatio>1;a&&Math.random()<i.SAM_PV&&r.sendLog(i.ARR.RETINA)},3e3)}});return o},{requires:["base","cookie","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store"]});KISSY.add("mui/mallbar/store",function(a,e,i,t){if(window.__MUI_STORAGE){return window.__MUI_STORAGE}var r;if(window.TB&&TB.Global&&TB.Global.storage){r=TB.Global.storage;i.log("TB.Global.storage",r)}else{r=new t;i.log("mallbar storage",r)}window.__MUI_STORAGE=r;return r},{requires:["mui/mallbar/conf","mui/mallbar/util","mui/storage/index"]});KISSY.add("mui/mallbar/mallbar-item",function(a,e,t,i,r,n,l,o,s,m){var b=['<div class="mui-mbar-bubble">','<div class="mui-mbar-arr mui-mbar-bubble-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbar-bubble-close-bg"></div>','<div class="mui-mbar-bubble-bd">{0}</div>',"</div>"].join("");var c=['<div class="mui-mbar-tab-sup-bg">','<div class="mui-mbar-tab-sup-bd">{0}</div>',"</div>"].join("");var d=new n(['<div class="mui-mbar-dialog">','<div class="mui-mbar-dialog-mask"></div>','<div class="mui-mbar-dialog-bd">','  <div class="mui-mbar-dialog-tip">{{{tip}}}</div>','  <div class="mui-mbar-dialog-btn"><div class="mui-mbar-dialog-btn-txt mui-mbar-dialog-yes">\u786e\u5b9a</div></div>','   {{#if dialogType===2}}<div class="mui-mbar-dialog-btn"><div class="mui-mbar-dialog-btn-txt mui-mbar-dialog-no">\u53d6\u6d88</div></div>{{/if}}',"</div>","</div>"].join(""));var u="mui-mbar-dialog";var f="mui-mbar-dialog-bd";var _="mui-mbar-dialog-yes";var g="mui-mbar-dialog-no";var v=function(a){var e=this;v.superclass.constructor.call(e,a);e.init()};v.ATTRS={showBubble:{value:false},expand:{value:false},pgFirstVisible:{value:true},suptipNum:{value:0}};a.extend(v,e,{init:function(){var e=this;var t=e.get(o.K.MALLBAR);var i=t.get(o.K.MODEL);var n=i.get(o.K.USERINFO);var l=t.get(o.K.ITEMS);var d=e.get(o.K.DATA);var u=e.get(o.K.PLUGIN);var f=u.one(".mui-mbar-plugin-bd");var _=u.one(".mui-mbar-plugin-cover");var g=e.get(o.K.TAB);var v=e.get(o.K.BUBBLE);var p=v.one(".mui-mbar-tab-bubble-bd");var T=g.one(".mui-mbar-tab-sup");var E=g.one(".mui-mbar-tab-tip");var A=g.one(s.fm(".mui-mbar-tab-logo-{0}",d.id));var h=s.fm(".mui-mbar-tab-hover");var I=s.fm(".mui-mbar-tab-sel");var B=s.fm(".mui-mbar-tab-logo-{0}-sel",d.id);var C=0;f.on("scroll",a.buffer(function(a){var e=f.scrollTop();e>0?_.css("visibility","visible"):_.css("visibility","hidden")},100));!d.scroll&&s.noScroll(f);a.use(d.p,function(a,t){var i=new t({mallbarItem:e,container:f,pluginHead:u.one(".mui-mbar-plugin-hd"),tipContainer:u.one(".mui-mbar-plugin-hd-tip")});e.set(o.K.POBJ,i)});u.one(".mui-mbar-plugin-hd-close").on("click",function(){t.fire(o.E.STATUS_CHANGE,{status:o.S.STANDARD})});var O=0;g.on("mouseenter",function(){if(a.one(".mui-mbar").one(".mui-mbar-tabs").hasClass("mui-mbar-tabs-wide")){if(g.hasClass("mui-mbar-tab-custom")){return}}g.addClass(h);if(d.noHover||e.get(o.K.SHOW_BUBBLE)){return true}if(O){O=0}O=setTimeout(function(){if(!O){return}E.css({right:"70px",opacity:0});E.show();var a=g.width();r(E,{right:a,opacity:1},.3,"easeOut",function(){}).run()},200)}).on("mouseleave",function(){g.removeClass(h);if(d.noHover||e.get(o.K.SHOW_BUBBLE)){return true}if(O){O=0}r(E,{right:"70px",opacity:0},.3,"easeIn",function(){E.hide()}).run()}).on("click",function(){var i=e.get(o.K.POBJ);if(i&&i.needLogin){i.needLogin(r)}else{r(false)}function r(r){if(!d.noLogin&&!n.isLogin||r){e.fire(o.E.LOGIN);return}if(d.noExpand){return}if(i&&i.disableExpand&&i.disableExpand()){if(o.S.MINI===t.get(o.K.STATUS)){t.fire(o.E.STATUS_CHANGE,{status:o.S.STANDARD})}return}g.fire("mouseout");t.get(o.K.ROOT).width(u.width()+35);s.log(e.get(o.K.EXPAND));var m="";if(a.UA.firefox&&a.UA.firefox>0){m=a.one("#J_MUIMallbar").one("#J_MBarMiniCart")}if(!e.get(o.K.EXPAND)){m&&m.show();a.each(l,function(a){a.fire(o.E.VISIBILITY_CHANGE,{visible:false})});e.fire(o.E.VISIBILITY_CHANGE,{visible:true});t.fire(o.E.STATUS_CHANGE,{status:o.S.EXPAND});e.fire(o.E.BUBBLE_CHANGE,{show:false});s.sendLog(d.arr)}else{m&&m.hide();t.fire(o.E.STATUS_CHANGE,{status:o.S.STANDARD})}}});e.on(o.E.VISIBILITY_CHANGE,function(i){var n=e.get(o.K.EXPAND);u.css("zIndex",o.ZINDEX-2);g.removeClass(h);var l=g.one(".mui-mbar-tab-logo-arr")||"";if(l&&l.hasClass("mui-mbar-tab-logo-arr-show")){l.hide()}if(i.visible){A.addClass(B);g.addClass(I);d.custom&&g.css("backgroundImage","none");var s=a.one("#J_MUIMallbar").one(".tm-mcHandler");!!s&&s.css("position","relative");var l=g.one(".mui-mbar-tab-logo-arr")||"";if(l&&l.hasClass("mui-mbar-tab-logo-arr-show")){l.show()}if(!n){var m=t.get(o.K.OLD_INDEX);u.removeClass(o.C.SCALE_DOWN);u.css("top",0);u.css("zIndex",o.ZINDEX);u.css("visibility","visible");var b=e.get(o.K.INDEX);if(o.S.EXPAND===t.get(o.K.STATUS)&&m!==-1&&b!==m){u.css("top",u.height()+"px");r(u,{top:"0"},.4,"easeOut").run()}else{a.each(t.get(o.K.ITEMS),function(a){var e=a.get(o.K.PLUGIN);if(e!==u){e.css("visibility","hidden")}})}}!!s&&s.css("position","fixed")}else{A.removeClass(B);g.removeClass(I);if(n){var m=e.get(o.K.INDEX);t.set(o.K.OLD_INDEX,m);u.css("zIndex",o.ZINDEX-1);if(o.S.EXPAND===t.get(o.K.STATUS)){u.addClass(o.C.SCALE_DOWN)}}}e.set(o.K.EXPAND,i.visible)});e.on(o.E.AFTER_EXPAND_CHANGE,function(a){var t=e.get(o.K.POBJ);var i=a.newVal;var r=e.get(o.K.PG_FISRT_VISIBLE);t&&t.fire(o.E.VISIBILITY_CHANGE,{visible:i,first:r});if(r&&i){e.set(o.K.PG_FISRT_VISIBLE,false)}});e.on(o.E.SUPTIP_CHANGE,function(i){e.set(o.K.SHOW_SUPTIP,i.show);if(i.show){var r=1;if(a.isNumber(i.num)){r=i.num}else{r=e.get(o.K.SUPTIP_NUM)+1}e.set(o.K.SUPTIP_NUM,r);if(r>99){r="99"}T.html(s.fm(c,r));T.show()}else{e.set(o.K.SUPTIP_NUM,0);T.hide()}var n=e.get(o.K.POBJ);if(n&&i.show){n.fire(o.E.DATA_CHANGE)}t.fire(o.E.SUPTIP_CHANGE)});e.on(o.E.BUBBLE_CHANGE,function(i){var n=!!i.show;var l=i.showDelay||1e3;var c=!!i.customContentType?i.customContentType:"";var d=!!i.isCustomContent;var u=!!i.isNotTabFire;var f="//gm.mmstat.com/";if(n===e.set(o.K.SHOW_BUBBLE)){return}if(n&&o.S.EXPAND===t.get(o.K.STATUS)){return}function _(){var l=e.get(o.K.BUBBLE);var _=l.one(".mui-mbar-tab-bubble-bd");if(C){clearTimeout(C);C=0}e.set(o.K.SHOW_BUBBLE,n);i.bubbleType&&e.set(o.K.BUBBLE_TYPE,i.bubbleType);if(n){var v=t.get(o.K.ITEMS);if(v){a.each(v,function(a){var e=a.get(o.K.BUBBLE);!!e&&e.hide()})}var p=t.get(o.K.STATUS);if(o.S.MINI===p){t.fire(o.E.STATUS_CHANGE,{status:o.S.STANDARD,noToClose:true})}if(o.B.FOREVER===i.bubbleType){m.set({k:o.K.FRM_STATUS,v:o.S.STANDARD})}else{C=setTimeout(function(){s.log("tmBubbleHide timeout");e.fire(o.E.BUBBLE_CHANGE,{show:false,timeout:true,cb:function(){i.dismiss&&i.dismiss();m.get({k:o.K.FRM_STATUS,success:function(a){if(o.S.MINI===a){t.fire(o.E.STATUS_CHANGE,{status:o.S.MINI})}}})}})},i.hideDelay||o.BUBBLE_HIDE_DELAY)}var T=['<div class="mui-mbar-bubble mui-mbar-bubble-flexible">','<p class="mui-mbar-bubble-flexible-title">{0}</p>','<div class="mui-mbar-arr mui-mbar-bubble-flexible-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>','<div class="mui-mbar-bubble-flexible-bd">{1}</div>',"</div>"].join("");if(!d&&!c){c=1}else if(d&&!c){c=3}if(c==1){var E=s.fm(b,i.html)}else if(c==2){var E=s.fm(T,i.contentTitle||"",i.html);i.height=i.height+40||"200px"}else if(c==3){var E=i.html}_.html(E);var A=_.one(".mui-mbar-bubble-close");var h=_.one(".mui-mbar-bubble");if(A){A.on("click",function(a){i.colsedClicked&&i.colsedClicked();a.stopPropagation();e.fire(o.E.BUBBLE_CHANGE,{show:false})})}if(h&&i.height){h.css("height",i.height)}l.show();r(l,{opacity:1},.3,o.EASE,function(){i.cb&&i.cb()}).run();l.detach("click");var I;l.on("click",function(e){if(i.isToForever){if(C){clearTimeout(C);C=0}}i.arrClicked&&s.sendLog(f+i.arrClicked);i.clicked&&i.clicked();if(!u){var t=h.one("a");if(t){I=t.attr("href");if(a.isString(I)&&I.indexOf("//")>=0){window.open(I);e.halt()}else{g.fire("click")}}else{g.fire("click")}}});if(!!i.tabMouseleave){g.on("mouseleave",function(e){var t=a.one(e.toElement||e.relatedTarget);if(t){if(!a.DOM.hasClass(t,"mui-mbar-tabs-shadow")){if(!t.parent(".mui-mbar-tab-bubble")){l.detach("click");l.hide()}}}});l.on("mouseleave",function(a){r(l,{opacity:0},.1,o.EASE,function(){l.hide()}).run()})}e.resetBubble();i.arrShowed&&s.sendLog(f+i.arrShowed);i.showed&&i.showed(l)}else{r(l,{opacity:0},.1,o.EASE,function(){l.hide();i.cb&&i.cb()}).run()}}s.getStaticConf({cb:function(a){var e="";!!window.g_config&&(e=window.g_config.shopId||"");if(a.bubbleBlacklist&&a.bubbleBlacklist.length){var t=a.bubbleBlacklist.length;var i=a.bubbleBlacklist;for(var r=0;r<t;r++){if(e==i[r]){return}}}if(n){setTimeout(_,l)}else{_()}}})});e.on(o.E.MALLBAR_STATUS_CHANGE,function(a){var t=a.status;if(o.B.FOREVER!==e.get(o.K.BUBBLE_TYPE)&&e.get(o.K.SHOW_BUBBLE)&&o.S.STANDARD!==t){e.fire(o.E.BUBBLE_CHANGE,{show:false})}if((o.S.EXPAND===t||o.S.SCREEN===t)&&!e.get(o.K.EXPAND)){p.hide()}else{p.show()}});e.on(o.E.ERROR,function(a){var e="\u554a\u54e6\uff0c\u597d\u50cf\u6709\u70b9\u95ee\u9898";if(a&&a.tip){e=a.tip}f.html('<div class="mui-mbar-plugin-err">'+e+"</div>")});e.on(o.E.LOGIN,function(a){var e=t.get(o.K.ITEMS)[o.P.PROF];e.get(o.K.POBJ).fire(o.E.PROF_CHANGE,{toLogin:1,pid:d.id,success:a.success})});e.on(o.E.FLYIN_END,function(a){var t=e.get(o.K.POBJ);t&&t.fire(o.E.DATA_CHANGE)});e.on(o.E.PAGE_VISIBILITY_CHANGE,function(a){var t=e.get(o.K.POBJ);t&&t.fire(a.type,{pageVisible:a.pageVisible})});if(d.m>0){e.fire(o.E.SUPTIP_CHANGE,{show:true,num:d.m})}},getUserInfo:function(){var a=this;return a.get(o.K.MALLBAR).get(o.K.MODEL).get(o.K.USERINFO)},setUserInfo:function(a){var e=this;var t=e.get(o.K.MALLBAR).get(o.K.MODEL).get(o.K.USERINFO);t=s.deepMerge(t,a);m.set({k:o.K.FRM_USERINFO,v:""})},getUid:function(){var a=this;return a.get(o.K.MALLBAR).get(o.K.MODEL).getUid()},expand:function(){var a=this;var e=a.get(o.K.TAB);if(!a.get(o.K.EXPAND)){e.fire("click")}},getShopConfig:function(){var a=this;return a.get(o.K.MALLBAR).get(o.K.SHOP_CONFIG)},getGConfig:function(){var a=this;return a.get(o.K.MALLBAR).get(o.K.G_CONFIG)},resetBubble:function(){var a=this;var e=a.get(o.K.TAB);var t=a.get(o.K.BUBBLE);t.offset({top:e.offset().top})},getOrigin:function(){var e=this;var t=e.get(o.K.MALLBAR);var i=t.get(o.K.STATUS);var r=t.get(o.K.ROOT);var n=e.get(o.K.TAB);var l=n.offset();var s;if(i==o.S.EXPAND){s=a.DOM.viewportWidth()-r.width()}else{s=a.DOM.viewportWidth()-n.width()}var m={x:s,y:l.top-a.one(window).scrollTop()};return m},getPoint:function(){var a=this;var e=a.get(o.K.MALLBAR);var t=a.get(o.K.TAB);var i=a.getOrigin();var r={x:t.width()/2+i.x,y:t.width()/2+i.y};if(o.S.MINI===e.get(o.K.STATUS)){e.fire(o.E.STATUS_CHANGE,{status:o.S.STANDARD})}return r},getServerTime:function(){var a=this;return a.get(o.K.MALLBAR).get(o.K.MODEL).getServerTime()},dialog:function(e){var t=this;var i=t.get(o.K.PLUGIN);i.append(a.all(d.render(e)));var r=i.one("."+u);var n=r.one("."+f);var l=r.one("."+_);var m=r.one("."+g);r.show();r.width(i.width());r.height(i.height());n.css("top",(i.height()-n.height())/2+"px");s.log(i.width(),i.height(),r.width(),r.height());function b(a){r.remove();e.callback&&e.callback(a)}l.on("click",function(){b(true)});m&&m.on("click",function(){b(false)})},alert:function(a){var e=this;a.dialogType=1;e.dialog(a)},confirm:function(a){var e=this;a.dialogType=2;e.dialog(a)},getTabName:function(){var a=this;var e=a.get(o.K.MALLBAR);var t=e.get(o.K.MODEL);var i=a.get(o.K.INDEX);var r=t.get(o.K.BAR);var n="";!!r&&r.l&&(n=r.l[i].id);return n}});return v},{requires:["base","event","node","anim","xtemplate","mui/minilogin/index","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store"]});KISSY.add("mui/mallbar/mallbar-guide",function(a,e,t,i){var r,l=false,n;var o=function(e){var t=this;t.config=a.merge(o.config,e);t._init()};o.config={picBox:[{src:"//gtd.alicdn.com/tps/i1/T11E.AFzxXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T15b3zFuVaXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T1mZonFvVeXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i4/T1zygsFp0dXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i1/T1Hf3tFzpcXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T1zKAnFqJeXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T1AvIuFuhcXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T1pHUAFDFXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i4/T1tR3sFCNcXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i1/T1sKsrFx4dXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T1z7crFw8dXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T1A0ZAFDBXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i4/T1SpMBFABXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i1/T1jrUAFEXXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T1NEUrFqXdXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T1WvIAFC4XXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i4/T1x5ZtFwRcXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i1/T17tsAFEdXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T15cBaFTRXXXbw.PjB-284-35.png"}],picBoxIE:[{src:"//gtd.alicdn.com/tps/i1/T11E.AFzxXXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T15b3zFuVaXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T1mZonFvVeXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i4/T1zygsFp0dXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i1/T1Hf3tFzpcXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i2/T1zKAnFqJeXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T15cBaFTRXXXbw.PjB-284-35.png"},{src:"//gtd.alicdn.com/tps/i2/T1XTktFzlcXXa.AtHl-250-300.png"},{src:"//gtd.alicdn.com/tps/i3/T1hHwvFrVcXXa.AtHl-250-300.png"}],AnimateTimeLine:[{lineName:"line-bent",startLine:{X:"127",Y:"229",Cx1:"127",Cy1:"229",Cx2:"127",Cy2:"229",X2:"127",Y2:"229"},animateTime:"0.5"},{lineName:"line-stretch",startLine:{X:"83",Y:"593",Cx1:"265",Cy1:"584",Cx2:"104",Cy2:"274",X2:"127",Y2:"229",X3:"67",Y3:"251"},animateTime:"0.5"},{lineName:"shake",startLine:{X:"83",Y:"593",Cx1:"83",Cy1:"593",Cx2:"125",Cy2:"229",X2:"124",Y2:"232",X3:"251",Y3:"121"},animateTime:"0.03"},{lineName:"up-vertical",startLine:{X:"83",Y:"593",Cx1:"83",Cy1:"593",Cx2:"125",Cy2:"229",X2:"124",Y2:"232",X3:"100",Y3:"121",M:"1.5"},animateTime:"0.01"},{lineName:"throw-out",startLine:{X:"67",Y:"320",Cx1:"180",Cy1:"100",Cx2:"398",Cy2:"80",X2:"157",Y2:"113",M:"90",X5:"50"},endLine:{X:"432",Y:"69",Cx1:"300",Cy1:"100",Cx2:"500",Cy2:"180",X2:"324",Y2:"24",M:"120",X5:"110"},animateTime:"1"}],isMask:false,callback:false};o.prototype={_init:function(){var t=this,l=!!(a.UA.ie<=8);if(!l){t._imagesLoad(t.config.picBox,function(){var i;if(t.config.isMask){i='<div class="mui-mbar-animate-mask-bg"></div>'}else{i=""}var l=[i,'<canvas width="300" height="600" id="J_animate-canvas" class="mui-mbar-animate-canvas mui-mbar-guide"></canvas>'].join("");e(l).appendTo(a.one("body"));r=a.get(".mui-mbar-animate-canvas").getContext("2d");r.webkitImageSmoothingEnabled=true;a.getScript("//g.alicdn.com/tm/act/1.10.36/??mazi/ShoppingCartAnimate/TweenLite.js",function(){t._catAnimate()})})}else{t._imagesLoad(t.config.picBoxIE,function(){var e;if(t.config.isMask){e='<div class="mui-mbar-animate-mask-bg"></div>'}else{e=""}var r=[e,'<div class="mui-mbar-animate-box mui-mbar-guide">','<img class="mui-mbar-animate-cat" src="//img.alicdn.com/tps/i3/T1ouJHXndmXXXXXXXX-1-1.gif" width="250" height="300" alt=""/>','<div class="mui-mbar-animate-buy"><img  src="//gtd.alicdn.com/tps/i3/T15cBaFTRXXXbw.PjB-284-35.png" width="284" height="35"/></div>',"<div>"].join("");a.one("body").append(r);var l=i.viewportWidth(),n=i.viewportHeight();a.one(".mui-mbar-animate-mask-bg")&&a.one(".mui-mbar-animate-mask-bg").css({width:l+"px",height:n+"px"});t._catAnimateIE()})}},_catAnimate:function(){var a=this;var e=0;var t=setInterval(function(){if(e<6){r.clearRect(0,0,300,600);r.beginPath();r.drawImage(a.config.picBox[18].Dom,15,566,284,35);r.drawImage(a.config.picBox[e].Dom,50,0,250,300)}else{setTimeout(function(){r.clearRect(0,0,300,600);r.beginPath();r.drawImage(a.config.picBox[18].Dom,15,566,284,35);setTimeout(function(){a._catPole(e)},0)},500);clearInterval(t)}e++},150)},_catPole:function(a){var e=this;var t=setInterval(function(){if(a<11){r.clearRect(0,0,300,600);r.beginPath();r.drawImage(e.config.picBox[18].Dom,15,566,284,35);r.drawImage(e.config.picBox[a].Dom,50,0,250,300)}else{clearInterval(t);e._pushLineAnimate()}a++},100)},_pushLineAnimate:function(){var e=this,t=0,i,l,n,o,m;r.lineWidth=1;i=e.config.AnimateTimeLine[t].startLine;l=e.config.AnimateTimeLine[t+1].startLine;o=e.config.AnimateTimeLine[t].animateTime;TweenLite.to(i,o,a.merge(l,{onUpdate:function(){r.clearRect(0,0,300,600);r.beginPath();r.moveTo(i.X,i.Y);r.bezierCurveTo(i.Cx1,i.Cy1,i.Cx2,i.Cy2,i.X2,i.Y2);r.stroke();r.drawImage(e.config.picBox[18].Dom,15,566,284,35);r.drawImage(e.config.picBox[11].Dom,50,0,250,300)},onComplete:function(){n=e.config.AnimateTimeLine[t+2].startLine;m=t+1;e._lineStraightenAnimate(l,n,m)}}))},_lineStraightenAnimate:function(e,t,i){var n=this,o=n.config.AnimateTimeLine[i].animateTime;TweenLite.to(e,o,a.merge(t,{onUpdate:function(){r.clearRect(0,0,300,600);r.beginPath();r.moveTo(e.X,e.Y);r.bezierCurveTo(e.Cx1,e.Cy1,e.Cx2,e.Cy2,e.X2,e.Y2);r.stroke();r.drawImage(n.config.picBox[18].Dom,15,566,284,35);r.drawImage(n.config.picBox[12].Dom,50,0,250,300)},onComplete:function(){var a=0;l=false;i+=1;var e=setInterval(function(){a++;if(a>5&&l==true){clearInterval(e);setTimeout(function(){n._upAnimate(i)},300)}else{var r=n.config.AnimateTimeLine[i+1].startLine;n._shakeAnimate(t,r,i)}},200)}}))},_shakeAnimate:function(e,t,i){var n=this,o=n.config.AnimateTimeLine[i].animateTime;TweenLite.to(e,o,a.merge(t,{onUpdate:function(){r.clearRect(0,0,300,600);r.beginPath();r.moveTo(e.X,e.Y);r.bezierCurveTo(e.X,e.Y,e.X2,e.Y2,e.X2,e.Y2);r.stroke();r.drawImage(n.config.picBox[14].Dom,50,0,250,300);r.save();r.rotate(1.5*Math.PI/180);r.drawImage(n.config.picBox[18].Dom,30,559,284,35);r.restore()},onComplete:function(){TweenLite.to(t,o,a.merge(e,{onUpdate:function(){r.clearRect(0,0,300,600);r.beginPath();r.moveTo(e.X,e.Y);r.bezierCurveTo(e.X,e.Y,e.X2,e.Y2,e.X2,e.Y2);r.stroke();r.drawImage(n.config.picBox[12].Dom,50,0,250,300);r.save();r.rotate(Math.PI/180);r.drawImage(n.config.picBox[18].Dom,24,562,284,35);r.restore()},onComplete:function(){l=true}}))}}))},_upAnimate:function(e){var t=this,i=t.config.AnimateTimeLine[e+1].startLine,l=t.config.AnimateTimeLine[e+2].startLine,n=t.config.AnimateTimeLine[e+1].animateTime;TweenLite.to(i,n,a.merge(l,{onUpdate:function(){r.clearRect(0,0,300,600);r.beginPath();r.moveTo(i.X,i.Y);r.bezierCurveTo(i.Cx1,i.Cy1,i.Cx2,i.Cy2,157,113);r.stroke();r.drawImage(t.config.picBox[15].Dom,50,0,250,300);r.save();r.translate(i.X,i.Y);r.rotate(i.M*Math.PI/180);r.drawImage(t.config.picBox[18].Dom,-81,0,284,35);r.restore()},onComplete:function(){e+=2;t._throwAnimate(e)}}))},_throwAnimate:function(e){var t=this,l=t.config.AnimateTimeLine[e].startLine,n=t.config.AnimateTimeLine[e].endLine,o=t.config.AnimateTimeLine[e].animateTime;TweenLite.to(l,o,a.merge(n,{onUpdate:function(){r.clearRect(0,0,300,600);r.beginPath();r.moveTo(l.X,l.Y);r.bezierCurveTo(l.Cx1,l.Cy1,l.Cx2,l.Cy2,324,24);r.stroke();if(l.X5>90){r.drawImage(t.config.picBox[16].Dom,l.X5,0,250,300)}else{r.drawImage(t.config.picBox[17].Dom,l.X5,0,250,300)}r.save();r.translate(l.X,l.Y);r.rotate(l.M*Math.PI/180);r.drawImage(t.config.picBox[18].Dom,-81,0,284,35);r.restore()},onComplete:function(){r.clearRect(0,0,300,600);i.remove(".mui-mbar-animate-mask-bg");i.remove(".mui-mbar-animate-canvas");if(a.isFunction(t.config.callback)){t.config.callback()}}}))},_catAnimateIE:function(){var e=this,t=0;n=a.one(".mui-mbar-animate-cat");var i=setInterval(function(){if(t<6){n.attr("src",e.config.picBox[t].src)}else{setTimeout(function(){e._buyAnimateIE()},500);clearInterval(i)}t++},150)},_buyAnimateIE:function(){var e=this,t=a.one(".mui-mbar-animate-buy");n.attr("src",e.config.picBoxIE[8].src);t.stop().animate({width:"34px",height:"34px",right:"100px"},.5,"elasticBoth",function(){n.attr("src",e.config.picBoxIE[7].src);t.stop().animate({bottom:"334px",right:"110px"},1,"elasticIn",function(){n.attr("src",e.config.picBoxIE[8].src);setTimeout(function(){var i=setInterval(function(){if(parseInt(t.css("right"))>-250){var r=10;t.css("right",parseInt(t.css("right"))-r);n.css("right",parseInt(n.css("right"))-r)}else{clearInterval(i);a.one(".mui-mbar-animate-mask-bg")&&a.one(".mui-mbar-animate-mask-bg").remove();a.one(".mui-mbar-animate-box")&&a.one(".mui-mbar-animate-box").remove();a.isFunction(e.config.callback)&&e.config.callback()}},10)},500)})})},_imagesLoad:function(a,e,t){var i=this;t=t||0;if(a[t]){i._imgLoad(a[t],function(){i._imagesLoad(a,e,t+1)})}else{e(t)}},_imgLoad:function(a,e){var t=new Image;t.src=a;if(t.complete){a.Dom=t;e();return}t.onload=function(){a.Dom=t;e()};t.src=a.src}};window.catAnimate=o;return o},{requires:["node","event","dom","mui/mallbar/mallbar-guide.css"]});KISSY.add("mui/mallbar/plugin-prof",function(a,e,i,t,r,n,o,s,l,m,u,c){var b;var d;var p;var f={baby:{title:"\u6bcd\u5a74\u7279\u6743",mod:"muying"}};var v={};function g(a,e,i){var t=i.split("@");var r=v[t[1]];r[t[0]](a,e,i)}var h={tryLogin:function(){var a=this.mallbar;a.collapse(1);s.show(function(){O=true;a.expand({type:"prof"})},{needRedirect:false,check:false})},activateMember:function(){a.use("mui/tobetmaller/index",function(a,e){var i=h.mallbar;i.collapse(1);e.config({success:function(){m.sendLog(l.ARR.PROF_VIP_ACTIVATE_SUCCESS);O=true;$();i.expand({type:"prof"})}});m.sendLog(l.ARR.PROF_VIP_ACTIVATE_SHOW);e.show()})},mustActivate:function(a){if(!this.isMember){a.preventDefault();m.sendLog(l.ARR.PROF_VIP_ACTIVATE_BUTTON);this.showPopup({body:"\u60a8\u8fd8\u4e0d\u662f\u5929\u732b\u4f1a\u5458\uff0c\u6682\u65f6\u65e0\u6cd5\u4eab\u53d7\u6b64\u7279\u6743",action:'<button data-action="activateMember@member">\u7acb\u5373\u6fc0\u6d3b</button><button class="mui-mbarp-prof-cancel" data-action="closePopup@member">\u53d6\u6d88</button>'});return true}return false},showPopup:function(e){var i='<div class="mui-mbarp-prof-body">';if(a.isString(e)){i+=e+"</div>"}else{i+=e.body+"</div>";i+='<div class="mui-mbarp-prof-action">'+e.action+"</div>"}b.html(i);b.css("visibility","visible");p=true;_()},hidePopup:function(){p=false;b.css("visibility","hidden");d.css("visibility","hidden")},loopList:function(e,i,t){var r=a.isArray(e)?e.length:0;var n=function(a){return!a||a._looped};var o=[];var s=0;t=a.isFunction(t)?t:function(){};for(var l=0;l<r;l++){var m=e[l];if(n(m)){continue}t(m);o.push(m);m._looped=true;s++;if(s>=i){return o}}if(r>i){s=i-s;a.each(e,function(a){if(a){if(s>0){t(a);o.push(a);s--}else{a._looped=false}}})}return o},formatPrice:function(e,i){if(!a.isNumber(e)){e=e-0}if(i){e/=100}return e.toFixed(2)},formatImg:function(a,e){a=a||"";if(e){a=a.replace(/_(\d+x\d+|sum|m|b|300|q\d+)(q\d+)?\.jpg$/,"")+e}return a},bindMagnify:function(e,i){if(!e||!e.length){return}i=a.merge({trigger:".mui-mbarp-prof-img",root:".mui-mbarp-prof-item",img:"img"},i);e.all(i.trigger).on("mouseenter",function(){var a=t.parent(this,i.root);var e=t.get("div.mui-mbarp-prof-magnify",a);if(!e){var r=t.get(i.img,this).src;e=t.create('<div class="mui-mbarp-prof-magnify"></div>',{html:'<img src="'+h.formatImg(r,"_210x210.jpg")+'" width="198" />'});t.append(e,a)}t.addClass(a,"mui-mbarp-prof-magnify-open")}).on("mouseleave",function(){var a=t.parent(this,i.root);t.removeClass(a,"mui-mbarp-prof-magnify-open")})},replaceSCM:function(a,e){if(-1===a.indexOf("?")){return a+"?scm="+e}return a.replace(/\bscm=[\d\.]+&?/i,"")+"&scm="+e}};function _(){var a=d.parent();var e=a.outerWidth();var i=a.scrollTop();d.css({width:e,height:i+a.outerHeight(),visibility:"visible"});b.css({left:(e-b.outerWidth())/2,top:i+(t.viewportHeight()-b.outerHeight())*4/9})}var T=new c(['<div class="mui-mbarp-prof-tip mui-mbarp-prof-tip-login"></div>','<a class="mui-mbarp-prof-login-close"></a>','<div class="mui-mbar-arr mui-mbarp-prof-arr mui-mbarp-prof-arr-login">\u25c6</div>'].join(""));var A="mui-mbarp-prof-tip";var I=160;var C="";TB.Global.loginStatusReady(function(a){C=a.tbToken});var E={birthday:"60c",returned:"60e",brand:"602",ftry:"600",fenqi:"606",speedReturned:"60a",wuyou:"604",firstSerive:"608"};var B={birthday:"1048.1.2.14",returned:"1048.1.2.15",brand:"1048.1.2.16",ftry:"1048.1.2.19",fenqi:"1048.1.2.18",speedReturned:"1048.1.2.17",wuyou:"1048.1.2.13"};var L=2;var R=2;var S=2;var w=4;var O=true;var N={empty:true};var M={};var k={};var U={coupon:{def:"\u4f18\u60e0\u5238",member:"\u4e13\u4eab\u4f18\u60e0\u5238"},brand:{def:"\u54c1\u724c\u7279\u6743",member:"\u4e13\u4eab\u54c1\u724c\u7279\u6743"},item:{def:"\u4f18\u60e0\u5546\u54c1",member:"\u4e13\u4eab\u4f18\u60e0\u5546\u54c1"},act:{def:"\u4f18\u60e0\u4f1a\u573a",member:"\u4e13\u4eab\u4f18\u60e0\u4f1a\u573a"}};a.config({modules:{"mui/tobetmaller/index":{requires:["mui/overlay/dialog"]}},packages:{"mui/tobetmaller":{debug:true,ignorePackageNameInUri:true,version:"3.0.5",path:"//g.alicdn.com/mui/tobetmaller/3.0.5/",group:"tm"}}});var y="//equity."+(l.IS_DAILY?"daily.tmall.net":"vip.tmall.com");var P=function(a){var e=this;P.superclass.constructor.call(e,a);h.mallbar=e.get(l.K.MALLBAR_ITEM).get(l.K.MALLBAR);v.member=e;e.init()};a.extend(P,i,{init:function(){var e=this;var i=e.mallbarItem=e.get(l.K.MALLBAR_ITEM);var r=i.get(l.K.MALLBAR);var n=r.get(l.K.ROOT);var o=i.get(l.K.TAB);var u=a.all('<div class="mui-mbarp-prof"></div>').appendTo(n);var c=i.getUserInfo();e.userInfo=c;this.prof=u;e.itemId=r.get("itemId")||"";e.sellerId=r.get("sellerId")||"";e.shopId=r.get("shopId")||"";e.bizId=r.get("bizId")||"";var b=o.one(".mui-mbar-tab-tip");function d(){if(c.isLogin){var e=i.getUid();if(e){var t=m.fm(l.AVATAR,e,I);var r=new Image;r.onload=function(e){o.one(".mui-mbar-tab-logo-prof-def").hide();a.one(m.fm('<div class="mui-mbar-tab-logo-prof-nick-bd"><img class="mui-mbar-tab-logo-prof-nick" src="{0}" /></div>',t)).insertBefore(b)};a.one(m.fm('<div class="mui-mbar-tab-logo-prof-def"></div>')).insertBefore(b);r.src=t}}}d();o.on("mouseleave",function(e){var i=a.one(e.toElement||e.relatedTarget);if(i){if(!t.hasClass(i,"mui-mbar-tabs-shadow")){if(!i.parent(".mui-mbarp-prof")){u.hide()}}}});p();function p(){e.on(l.E.PROF_CHANGE,function(o){var b=n.one(".mui-mbar-tab-logo-"+o.pid);var p=a.DOM.height(b);var f=parseFloat(b.parent().offset().top-t.scrollTop())+p/3.8;var v=a.DOM.viewportHeight();if(v-f<272){f=f-272+p+1;u.addClass("mui-mbarp-prof-bottom-arrow")}else{u.removeClass("mui-mbarp-prof-bottom-arrow")}if(b){u.css({top:f});if(l.P.CART===o.pid&&l.S.MINI===r.get(l.K.STATUS)){u.css({left:-b.parent().width()+"px"})}else{u.css({left:0})}}if(o.toLogin||!c.isLogin){u.html(T.render());var g=u.one(".mui-mbarp-prof-login-close");u.one(".mui-mbarp-prof-tip").on("mouseleave",function(e){var i=a.one(e.toElement||e.relatedTarget);if(i){if(!t.hasClass(i,"mui-mbar-tabs-shadow")){if(!i.parent(".mui-mbarp-prof")){u.hide()}}}});g.on("click",function(a){u.hide()});s.show(function(){u.hide();TB.Global.loginStatusReady(function(a){TB.Global.memberInfoReady(function(a){m.log("minilogin memberInfoReady",a);c=m.deepMerge(c,a);c.isLogin=true;i.setUserInfo(c);o.success&&o.success();r.broadcast(l.E.LOGIN_SUCCESS);d();if(l.P.PROF===o.pid){e.fire(l.E.PROF_CHANGE,{pid:l.P.PROF})}c.isLogin&&r.expand({type:o.pid})})})},{insert:"."+A,needRedirect:false,check:false});m.sendLog(l.ARR.PROF_LOGIN);u.show()}else{u.css("display")==="none"&&m.sendLog(l.ARR.PROF)}})}e.showBubble();var f=true;e.on(l.E.VISIBILITY_CHANGE,function(a){if(a.visible&&f){e.showContent()}if(!a.visible){H()}});e.on(l.E.DATA_CHANGE,function(a){f=true;O=true;if(i.get(l.K.EXPAND)){e.showContent()}});e.get(l.K.CONTAINER).on("click",function(a){var e=a.target;do{if(e===this){return}var i=t.attr(e,"data-action");if("^"===i){return}if(i){return g(e,a,i)}if(!e||!e.parentNode){return}e=e.parentNode}while(true)})},showBubble:function(){var e=this;var i=e.mallbarItem=e.get(l.K.MALLBAR_ITEM);var t=i.get(l.K.MALLBAR);var r=m.getSysId();e.isDetail=r=="detail";e.isShop=r=="shop";var n=e.userInfo.memberInfo.activeStatus||"";e.nick="";!!e.userInfo.nick&&(e.nick=m.sub(e.userInfo.nick,13));if(e.userInfo.isLogin){t.getCueMsgInfo(function(a){if(!a){return}if(a.bm&&(a.bm.v||a.bm.n)){if(e.isShop&&a.bm.v){s(a)}else{if(e.isDetail&&a.bm.n){o(a)}else{if(a.vip&&a.vip.vp){d(a.vip.vp)}else{if(n>0){c()}}}}}else{if(a.vip&&a.vip.vp){d(a.vip.vp)}else{if(n>0){c()}}}})}else{}function o(a){u.get({k:"mui/mbarp/prof/detailVipBubble/"+i.getUid()+"/"+e.shopId,success:function(t){if(t){return}var r={nick:e.nick||"",specialClass:"mui-mbarp-prof-vip-bubble-detail",showTwo:true,discribe:"\u8be5\u5e97\u94fa\u6709\u65e0\u95e8\u69db\u4f18\u60e0</br>\u5238\u53ef\u9886\uff01",showArr:l.ARR.PROF_VIP_BUBBLE_DETAIL_SHOW,clickArr:l.ARR.PROF_VIP_BUBBLE_DETAIL_CLICK};r.rmb='<p class="mui-mbarp-prof-vip-bubble-p3" >'+"<span >\uffe5</span>"+'<span class="mui-mbarp-prof-vip-bubble-rmb">'+a.bm.n+"</span></p>";if(a.bm.s){r.action=a.bm.s+"\u79ef\u5206\u9886\u53d6"}else{r.action="\u7acb\u5373\u9886\u53d6"}r.clicked=function(){u.set({k:"mui/mbarp/prof/detailVipBubble/"+i.getUid()+"/"+e.shopId,v:1,expires:1})};b(r)}})}function s(t){var r={};u.get({k:"mui/mbarp/prof/shopVipBubble/"+i.getUid()+"/"+e.shopId,success:function(n){if(n){return}var o=a.one("#shopExtra");!!o&&(t.bm.t=o.one(".slogo-shopname").one("strong").html()||"");if(!t.bm.t){return}r={nick:e.nick||"",specialClass:"mui-mbarp-prof-vip-bubble-shop",discribe:'<span title="'+t.bm.t+'">'+m.sub(t.bm.t,18)+"</span></br> \u4e3a\u60a8\u51c6\u5907\u4e86\u4e13\u5c5e\u7279\u6743\uff01",action:"\u7acb\u5373\u67e5\u770b",showArr:l.ARR.PROF_VIP_BUBBLE_SHOP_SHOW,clickArr:l.ARR.PROF_VIP_BUBBLE_SHOP_CLICK};r.clicked=function(){u.set({k:"mui/mbarp/prof/shopVipBubble/"+i.getUid()+"/"+e.shopId,v:1,expires:1})};b(r)}})}function c(){if(!e.isDetail&&!e.isShop){m.getStaticConf({cb:function(a){if(a.closeDefaultVipBubble){return}u.get({k:"mui/mbarp/prof/defaultVipBubble/"+i.getUid(),success:function(a){if(a){return}var t={nick:e.nick||"",discribe:"\u67e5\u770b\u60a8\u7684\u4e13\u5c5e\u7279\u6743\uff01",action:"\u7acb\u5373\u67e5\u770b",showArr:l.ARR.PROF_VIP_BUBBLE_DEFAULT_SHOW,clickArr:l.ARR.PROF_VIP_BUBBLE_DEFAULT_CLICK,flag:5.1};t.clicked=function(){u.set({k:"mui/mbarp/prof/defaultVipBubble/"+i.getUid(),v:1,expires:1})};b(t)}})}})}}function b(e){var i='<div class="mui-mbarp-prof-vip-bubble mui-mbar-bubble {specialClass}">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr mui-mbar-asset-member-bubble-arr">\u25c6</div>'+'<div class="mui-mbarp-asset-member-bubble-top"></div>'+'<div class="mui-mbarp-prof-vip-bubble-content">'+'<p class="mui-mbarp-prof-vip-bubble-p1"> Hi\uff0c{nick}</p>'+'<p class="mui-mbarp-prof-vip-bubble-p2"> {discribe}</p>'+"{rmb}"+'<p class="mui-mbarp-prof-vip-bubble-action"><a>{action}</a></p>'+"</div>"+'<div class="mui-mbarp-asset-member-bubble-bottom"></div>'+"</div>";var r=a.substitute(i,e);t.bubble({show:true,content:r,customContentType:3,bubbleType:0,isNotTabFire:false,tab:"PROF",flag:e.flag||"",showTwo:e.showTwo||"",showed:function(){m.sendLog(e.showArr);!!e.showed&&e.showed()},clicked:function(){m.sendLog(e.clickArr);!!e.clicked&&e.clicked()}})}function d(r){var n='<div class="mui-mbarp-prof-vip-bubble mui-mbar-bubble mui-mbarp-prof-channel-bubble">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr mui-mbar-asset-member-bubble-arr">\u25c6</div>'+'<div class="mui-mbarp-asset-member-bubble-top"></div>'+'<div class="mui-mbarp-prof-vip-bubble-content">'+"<p > Hi\uff0c{u}</p>"+"<p > {h1}</p>"+"<p > {h2}</p>"+'<p class="mui-mbarp-prof-channel-bubble-h3"> {h3}</p>'+'<p class="mui-mbarp-prof-vip-bubble-action "><a>{a}</a></p>'+"</div>"+'<div class="mui-mbarp-asset-member-bubble-bottom"></div>'+"</div>";r.b=r.b||"";r.m=r.m||"";u.get({k:"mui/mbarp/prof/"+r.b+"/"+r.f+"/"+i.getUid(),success:function(o){if(o){return}t.set("currentProf",r.b);t.set("specialMark",r.m);if(!r.u){!!e.userInfo.nick&&(e.nick=m.sub(e.userInfo.nick,13));r.u=e.nick||""}if(!r.a){r.a="\u7acb\u5373\u67e5\u770b"}var s="";!!r.b&&(s=s.toUpperCase());if(r.h3){if(r.h3){if(r.h3=="shop"){var c=a.one("#shopExtra");!!c&&(r.h3=c.one(".slogo-shopname").one("strong").html()||"")}else{if(r.h3.indexOf("_")){r.h3=r.h3.substring(r.h3.indexOf("_")+1)}}}}var b=a.substitute(n,r);t.bubble({show:true,content:b,customContentType:3,bubbleType:0,isNotTabFire:false,tab:"PROF",flag:r.flag||"1.2",showTwo:1,showed:function(){m.sendLog(l.ARR.PROF_CHANNLE_BUBBLE_SHOW_BABY)},clicked:function(){u.set({k:"mui/mbarp/prof/"+r.b+"/"+r.f+"/"+i.getUid(),v:1,expires:1});m.sendLog(l.ARR.PROF_CHANNLE_BUBBLE_CLICK_BABY)}})}})}},showContent:function(){if(!O){return}O=false;var e=this;var i=e.get(l.K.CONTAINER);var t=h.mallbar.get("profList")||[];var n=h.mallbar.get("currentProf");h.profNum=t.length;var s=ae({mod:"member",title:"\u4e13\u4eab\u7279\u6743"});if(h.profNum){a.each(t,function(a){var e=f[a];if(e){s+=ae(e)}})}n=n in f?f[n].mod:"member";i.html('<div class="mui-mbarp-prof-user-wrap"></div><div class="mui-mbarp-prof-tabs '+(t.length?"":"mui-mbarp-prof-tabs-hide")+'">'+s+'</div><div class="mui-mbarp-prof-panels"></div><div class="mui-mbarp-prof-mask"></div><div class="mui-mbarp-prof-popup"></div>');b=i.one("div.mui-mbarp-prof-popup");d=i.one("div.mui-mbarp-prof-mask");b.parent().on("scroll",function(){if(p){_()}});o({url:"//vip."+(l.IS_DAILY?"daily.tmall.net":"tmall.com")+"/api/vip/user.do",dataType:"jsonp",complete:function(a){a=a||{};if(200===a.status){a=a.data;if(a.isLogin){N=a;h.isMember=!!a.level;i.one("div.mui-mbarp-prof-user-wrap").html(G(a));z(i)}else{m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.user.query.login","\u4e0d\u5728\u767b\u5f55\u72b6\u6001");h.tryLogin()}}else{m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.user.query.exception","\u7528\u6237\u67e5\u8be2\u4e0d\u6b63\u5e38")}},timeout:5});var u=i.one("div.mui-mbarp-prof-tabs");var c=i.one("div.mui-mbarp-prof-panels");var g;var T;var A=function(i){var t=i.attr("data-mod");var n="mui-mbarp-prof-"+t;var o=c.children("."+n);if(!o.length){o=r.all('<div class="mui-mbarp-prof-panel '+n+'"></div>').appendTo(c)}if(T){T.removeClass("mui-mbarp-prof-item-current")}T=i;T.addClass("mui-mbarp-prof-item-current");if(g){g.removeClass("mui-mbarp-prof-panel-show")}g=o;g.addClass("mui-mbarp-prof-panel-show");var s=h.mallbar.get("specialMark");h.mallbar.set("specialMark","");var l={jumpTo:s};if("member"===t){e.loadUserProf2(o)}else{a.use("mui/mallbar/prof-"+t,function(a,e){v[t]=e;e.init(o,l,h)})}};u.all("div.mui-mbarp-prof-item").on("click",function(){m.sendLog(l.ARR.PROF_VIP_CHANGE_PROF);A(r.one(this))});A(u.one("div.mui-mbarp-prof-tab-"+n))},loadUserProf2:function(e){if(e.data("loaded")){return}var i=this,t=i.userInfo,r=i.sellerId,n=h.mallbar,s="//ald.taobao.com/recommend2.htm?appId=",u;e.data("loaded",true);e.addClass("mui-mbarp-prof-loading");if(r){u=["03532","03485","03487"].join(",");s+=u+"&actSellerIds="+r}else{u=["03531","03484","03486"].join(",");s+=u+"&bizId="+i.bizId}o({url:s,dataType:"jsonp",jsonpCallback:"userProf",timeout:5,success:function(i,t,n){i=i||{};e.removeClass("mui-mbarp-prof-loading");if(r){M=a.merge({coupon:i["03487"],item:i["03485"],act:i["03532"]},i.data)}else{M=a.merge({coupon:i["03486"],item:i["03484"],act:i["03531"]},i.data)}if(M.coupon.data.length||M.item.data.length||M.act.data.length){e.html(j(M.coupon.data)+V(M.item.data)+X(M.act.data));try{m.sendLog(M.coupon.exposureParam)}catch(o){}try{m.sendLog(M.item.exposureParam)}catch(o){}try{m.sendLog(M.act.exposureParam)}catch(o){}z(e);h.bindMagnify(e.one("div.mui-mbarp-prof-item"))}else{e.html('<div class="mui-mbarp-prof-load-error">\u55b5~ \u8fd8\u6ca1\u6709\u7279\u6743\u4fe1\u606f </div>')}},error:function(){m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.recommendEquity."+(r?"shop":"normal")+".get.failure","\u83b7\u53d6\u63a8\u8350\u6570\u636e\u5931\u8d25");e.html('<div class="mui-mbarp-prof-load-error">\u55b5~ \u5c0f\u732b\u5fd9\u4e0d\u8fc7\u6765\u4e86\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01</div>')}})},loadUserProf:function(e){if(e.data("loaded")){return}var i=this;e.data("loaded",true);e.addClass("mui-mbarp-prof-loading");var t=h.mallbar;var r="item-2-5,coupon-2-5,brand-4-5";var n=i.sellerId;if(n){r="item-6-8,coupon-6-8";L=6;S=6}o({url:y+"/api/recommendEquity.do?param="+r+"&sellerId="+n+"&bizId="+i.bizId,dataType:"jsonp",complete:function(i){i=i||{};e.removeClass("mui-mbarp-prof-loading");if(200===i.status){M=a.merge({coupon:[],item:[],brand:[]},i.data);if(M.coupon.length||M.item.length||M.brand.length){e.html(j(M.coupon)+V(M.item)+W(M.brand));try{m.sendLog(M.brand[0].exposureParam)}catch(t){}try{m.sendLog(M.coupon[0].exposureParam)}catch(t){}try{m.sendLog(M.item[0].exposureParam)}catch(t){}try{m.sendLog(M.act[0].exposureParam)}catch(t){}z(e);h.bindMagnify(e.one("div.mui-mbarp-prof-item"))}else{e.html(h.profNum>1?'<div class="mui-mbarp-prof-load-error">\u55b5~ \u8fd8\u6ca1\u6709\u7279\u6743\u4fe1\u606f </div>':"")}}else{m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.recommendEquity."+(n?"shop":"normal")+".get.failure","\u83b7\u53d6\u63a8\u8350\u6570\u636e\u5931\u8d25");e.html('<div class="mui-mbarp-prof-load-error">\u55b5~ \u5c0f\u732b\u5fd9\u4e0d\u8fc7\u6765\u4e86\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01</div>')}},timeout:5})},activateMember:function(){h.activateMember()},clickFilter:function(a,e){h.mustActivate(e)},togglePriv:function(a){t.toggleClass(t.parent(a,".mui-mbarp-prof-privilege"),"mui-mbarp-prof-privilege-collapse")},renewal:function(a){var e=t.parent(a,"div.mui-mbarp-prof-block");if(!e){return}var i=t.attr(e,"data-name");var n=M[i].data;if(!n||!n.length){return}var o;if("coupon"===i){m.sendLog(l.ARR.PROF_VIP_COUPON_RENEWAL);o=j(n,true)}else if("item"===i){m.sendLog(l.ARR.PROF_VIP_ITEM_RENEWAL);o=V(n,true)}else if("brand"===i){m.sendLog(l.ARR.PROF_VIP_BRAND_RENEWAL);o=W(n,true)}else if("act"===i){m.sendLog(l.ARR.PROF_VIP_ACT_RENEWAL);o=X(n,true)}var s=t.get("div.mui-mbarp-prof-list",e);var u=r.one(s);if("item"===i){u.all("div.mui-mbarp-prof-img").detach("mouseenter").detach("mouseleave")}s.innerHTML=o;if("item"===i){h.bindMagnify(u)}},openVip:function(){window.open("//vip.tmall.com/?spm=3700.7045653.0.0.T0qI3H&signIn=true&scm=1048.1.2.23","_blank")},collectCoupon:function(a,e){if(h.mustActivate(e)){return}if(e&&"A"===e.target.nodeName){return}D({me:this,id:t.attr(a,"data-id"),isQuery:true,success:function(e){e.brandLogo=t.attr(a,"data-brandlogo");K(e)}})},collectCoupon2:function(a,e){var i=this;if(h.mustActivate(e)){return}var r=t.attr(a,"data-id")||"",n=t.attr(a,"data-url");n+="&_tb_token_="+C;o({url:n,dataType:"jsonp",success:function(a,t,n){if(a&&a.success){var o=h.mallbar;o.driving({type:"asset",e:e,bubble:true,callback:function(){setTimeout(function(){$();i.removeAndUpdateCoupon(r);h.hidePopup()},500)}});h.showPopup('<div class="mui-mbarp-prof-collect-success">\u606d\u559c\u60a8\uff0c\u5151\u6362\u6210\u529f\u4e86!</div>')}else{if(a.errorMsg){x(500,a.errorMsg)}else{x(500)}}}})},removeAndUpdateCoupon:function(e){var i=t.get("#J_ProfCoupon_"+e);var r={};var n=t.parent(i);t.remove(i);t.children(n,function(a){r[t.attr(a,"data-id")]=true});var o=[];var s=false;a.each(M.coupon.data,function(a){var i=""+a.spreadId;if(i==e){s=true;return}if(i in r){a._looped=false}o.push(a)});M.coupon.data=o;if(!o.length){t.remove(t.parent(n))}if(o.length<=S){t.remove(t.get("span.mui-mbarp-prof-renewal",t.parent(n)))}this.renewal(n)},closePopup:function(){h.hidePopup()},finishCollectCoupon:function(a,e){var i=this;var r=t.attr(a,"data-id");if("true"===t.attr(a,"data-fav")){var n=k[r];return o({url:y+"/api/fav_brand.do",data:{type:"fav",brandId:n.brandId,_tb_token_:C},dataType:"jsonp",complete:function(r){r=r||{};var n=r.status;if(200===n){t.attr(a,"data-fav","");return i.finishCollectCoupon(a,e)}if(401===n){m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.coupon.collect.login","\u4e0d\u5728\u767b\u5f55\u72b6\u6001");return h.tryLogin()}h.showPopup({body:"\u5173\u6ce8\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5~",action:'<button data-action="closePopup@member">\u786e\u5b9a</button>'});m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.coupon.collect.failure","\u4f18\u60e0\u5238\u9886\u53d6\u5931\u8d25_"+(n||""))},timeout:5})}D({me:i,id:r,isQuery:false,success:function(){var a=h.mallbar;a.driving({type:"asset",e:e,bubble:true,callback:function(){setTimeout(function(){$();i.removeAndUpdateCoupon(r);h.hidePopup()},500)}});h.showPopup('<div class="mui-mbarp-prof-collect-success">\u606d\u559c\u60a8\uff0c\u5151\u6362\u6210\u529f\u4e86!</div>')}})}});function D(e){o({url:y+"/api/tmallEquityCoupon.do",dataType:"jsonp",data:a.merge({_tb_token_:C,isQuery:e.isQuery},k[e.id]),complete:function(a){a=a||{};var i=a.status;if(200===i||612===i){e.success(a.data)}else{if(401===i){m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.coupon.query.login","\u4e0d\u5728\u767b\u5f55\u72b6\u6001");return h.tryLogin()}x(i);m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.coupon.query.failure","\u4f18\u60e0\u5238\u67e5\u8be2\u5931\u8d25_"+(i||""))}},timeout:5})}function x(a,e){var i="";var t='<button data-action="closePopup@member">\u786e\u5b9a</button>';if(601===a){i="\u5bf9\u4e0d\u8d77\uff0c\u60a8\u7684\u79ef\u5206\u4e0d\u591f\u5151\u6362\u6b64\u4f18\u60e0\u5238\uff0c\u9a6c\u4e0a\u53bb\u8d5a\u79ef\u5206\u5427\uff01";t='<button data-action="openVip@member">\u53bb\u8d5a\u79ef\u5206</button><button class="mui-mbarp-prof-minor" data-action="closePopup@member">\u518d\u901b\u4e00\u4e0b</button>'}else if(610===a){m.sendLog(l.ARR.PROF_VIP_ACTIVATE_BUTTON);i="\u55b5~ \u60a8\u5f53\u524d\u4e0d\u662f\u5929\u732b\u4f1a\u5458\uff0c\u8bf7\u5148\u6fc0\u6d3b\u518d\u8fdb\u884c\u5151\u6362";t='<button data="activateMember">\u7acb\u5373\u6fc0\u6d3b</button>'}else if(611===a){i="\u5bf9\u4e0d\u8d77\uff0c\u60a8\u672a\u8fbe\u5230\u4e13\u4eab\u4eba\u7fa4\u6761\u4ef6\uff0c\u6682\u65f6\u65e0\u6cd5\u9886\u53d6\u5594T_T"}else if(621===a){i="\u55b5~ \u521a\u6709\u4eba\u5148\u60a8\u4e00\u6b65\uff0c\u62a2\u8d70\u6700\u540e\u4e00\u5f20\u4f18\u60e0\u5238\uff01"}else if(622===a){i="\u55b5~ \u8fd9\u5f20\u4f18\u60e0\u5238\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u9886\u53d6\u5594T_T"}else if(623===a){i="\u55b5~ \u8fd9\u5f20\u4f18\u60e0\u5238\u5df2\u7ecf\u88ab\u9886\u5149\u4e86\uff0c\u8bf7\u518d\u901b\u901b\u5427\uff01"}else if(624===a){i="\u60a8\u5728\u8be5\u5e97\u94fa\u9886\u7528\u5f20\u6570\u5df2\u8fbe\u5230\u4e0a\u9650\u54e6\uff0c\u4e0b\u6b21\u518d\u6765\u9886\u5427\uff01"}else if(500===a){i="\u9886\u53d6\u4f18\u60e0\u5377\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01";if(e){i=e}}else{i="\u55b5~ \u5c0f\u732b\u5fd9\u4e0d\u8fc7\u6765\u4e86\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"}h.showPopup({body:i,action:t})}function K(a){var e=a.sellerBaseInfoVO;var i="";var t="\u5151\u6362";var r=e.couponPoint;var n=e.couponValue;i+='<p><img src="'+h.formatImg(a.brandLogo,"_90x90.jpg")+'" width="90" height="45" /></p>';if(e.needFav){i+="<p>\u60a8\u9700\u8981\u5173\u6ce8<strong>"+e.brandName+"</strong></p>";i+="<p>\u5e76\u4f7f\u7528"+r+"\u79ef\u5206\u5151\u6362"+n+"\u5143\u7684\u4f18\u60e0\u5238</p>";i+="<p>\u786e\u8ba4\u5151\u6362?</p>";t="\u5173\u6ce8\u5e76\u5151\u6362"}else{i+="<p>\u60a8\u5c06\u4f7f\u7528"+r+"\u79ef\u5206\u5151\u6362"+n+"\u5143\u7684\u4f18\u60e0\u5238\uff0c\u786e\u8ba4\u5151\u6362?</p>"}h.showPopup({body:i,action:'<button data-fav="'+e.needFav+'" data-id="'+a.spreadId+'" data-action="finishCollectCoupon@member">'+t+'</button><button class="mui-mbarp-prof-cancel" data-action="closePopup@member">\u53d6\u6d88</button>'})}function F(e){var i='<div class="mui-mbarp-prof-body">';if(a.isString(e)){i+=e+"</div>"}else{i+=e.body+"</div>";i+='<div class="mui-mbarp-prof-action">'+e.action+"</div>"}b.html(i);b.css("visibility","visible");p=true;_()}function _(){var a=d.parent();var e=a.outerWidth();var i=a.scrollTop();d.css({width:e,height:i+a.outerHeight(),visibility:"visible"});b.css({left:(e-b.outerWidth())/2,top:i+(t.viewportHeight()-b.outerHeight())*4/9})}function H(){p=false;b.css("visibility","hidden");d.css("visibility","hidden")}function G(e){var i='<div class="mui-mbarp-prof-user"><div class="mui-mbarp-avatar"><img src="'+e.avatar+'" width="80" height="80" /><a href="//i.taobao.com/user/baseInfoSet.htm?scm=1048.1.2.32" target="_blank">\u7f16\u8f91</a></div>';i+='<div class="mui-mbarp-meta">';i+='<p class="mui-mbarp-nick"><a href="//vip.tmall.com?scm=1048.1.2.31" target="_blank">Hi, '+e.nick+"</a></p>";var t=e.level;if(t){i+='<p class="mui-mbarp-level"><a href="//vip.tmall.com?scm=1048.1.2.31" target="_blank">\u60a8\u662f<strong>'+t+"</strong>\u5929\u732b\u4f1a\u5458</a></p>";i+='<p class="mui-mbarp-links">';i+='<a class="mui-mbarp-prof-first" href="//vip.tmall.com/point/game?scm=1048.1.2.23" target="_blank">\u62bd\u79ef\u5206</a>';i+='<a href="//ka.tmall.com/?scm=1048.1.2.24" target="_blank">\u9886\u70b9\u5238</a>';i+="</p>";i+='<span class="mui-mbarp-prof-badge">'+t+"</span>"}else{m.sendLog(l.ARR.PROF_VIP_ACTIVATE_BUTTON);i+='<p class="mui-mbarp-level"><span data-action="activateMember@member">\u6fc0\u6d3b\u6210\u4e3a\u5929\u732b\u4f1a\u5458</span></p>';i+='<span class="mui-mbarp-prof-badge" style="font-size:16px">?</span>'}i+="</div>";i+="</div>";var r=e.privileges||[];var n=r.length>3;i+='<div class="mui-mbarp-prof-privilege'+(n?" mui-mbarp-prof-privilege-collapse":"")+'">';i+='<div class="mui-mbarp-prof-list">';a.each(r,function(a){var e=a.name;i+='<a class="mui-mbarp-prof-item'+(a.enable?" mui-mbarp-prof-item-enable":"")+'" href="//vip.tmall.com/privilege/'+e+"?scm="+B[e]+'" target="_blank">';i+='<div class="mui-mbarp-prof-symbol">&#xe'+E[e]+";</div>";i+='<div class="mui-mbarp-prof-title" title="'+a.title+'">'+a.title+"</div>";var t=a.availableNum;if(t){i+='<span class="mui-mbarp-prof-availableNum">'+t+"</span>"}i+="</a>"});i+="</div>";if(n){i+='<div class="mui-mbarp-prof-trigger" data-action="togglePriv@member"></div>'}i+="</div>";return i}function j(a,e){var i="";h.loopList(a,S,function(a){var e="";var t=a.face;if(50<=t&&t<100){e="mui-mbarp-prof-item-yellow"}else if(t>=100){e="mui-mbarp-prof-item-red"}var r=a.spreadId;k[r]={id:r,sellerId:a.sellerId,brandId:a.brandId,point:a.point,level:a.level,startTime:q(a.from),endTime:q(a.to)};i+='<div id="J_ProfCoupon_'+r+'" class="mui-mbarp-prof-item '+e+'">';i+='<div class="mui-mbarp-prof-pbt"></div>';i+='<div class="mui-mbarp-prof-inner">';i+='<div class="mui-mbarp-prof-phead">';i+='<div class="mui-mbarp-prof-pleft">';i+='<p class="mui-mbarp-prof-shop"><a href="'+a.shopUrl+'" title="'+a.shopName+'" target="_blank">'+a.shopName+"</a></p>";i+='<p class="mui-mbarp-prof-price"><span class="mui-mbarp-prof-rmb">&yen;</span><strong>'+h.formatPrice(a.face,true)+"</strong></p>";i+="</div>";i+='<div class="mui-mbarp-prof-pright">';i+="<p>\u6709\u6548\u671f</p>";var n=Q(a.from,a.to);i+="<p>"+n.from+"</p>";i+="<p>"+n.to+"</p>";i+="</div>";i+="</div>";i+='<a data-action="collectCoupon2@member" data-id="'+r+'" data-brandlogo="'+a.brandLogo+'" data-url="'+a.couponUrl+'" class="mui-mbarp-prof-paction">';if(a.fulfill){i+="\u6ee1"+h.formatPrice(a.fulfill,true)+"\u5143\u4f7f\u7528"}else{i+="\u65e0\u4f7f\u7528\u95e8\u69db"}i+=" ";if(a.point){i+=a.point+"\u79ef\u5206\u9886\u53d6"}else{i+="\u514d\u8d39\u9886\u53d6"}i+="</a>";i+="</div>";i+='<div class="mui-mbarp-prof-pbb"></div>';i+="</div>"});if(e){return i}return Y("coupon",i,{isShowRenewal:a.length>S})}function V(a,e){var i="";h.loopList(a,L,function(a){i+='<a data-action="clickFilter@member" class="mui-mbarp-prof-item" title="'+a.title+'" href="'+a.itemUrl+'" target="_blank">';i+='<div class="mui-mbarp-prof-img"><img src="'+h.formatImg(a.pic,"_60x60.jpg")+'" width="60" height="60" /></div>';i+='<div class="mui-mbarp-prof-meta">';i+='<p class="mui-mbarp-prof-title" title="'+a.title+'">'+a.title+"</p>";i+='<p class="mui-mbarp-prof-macket-price"><span class="mui-mbarp-prof-rmb">&yen;</span>'+h.formatPrice(a.origin)+"</p>";if(a.price){i+='<p class="mui-mbarp-prof-price">\u4e13\u4eab\u4ef7<span class="mui-mbarp-prof-rmb">&yen;</span>'+h.formatPrice(a.price)+"</p>"}else{i+='<p class="mui-mbarp-prof-price">\u70b9\u51fb\u67e5\u770b\u4e13\u5c5e\u4ef7</p>'}i+="</div>";i+="</a>"});if(e){return i}return Y("item",i,{isShowRenewal:a.length>L})}function X(a,e){var i="";h.loopList(a,R,function(a){i+='<a data-action="clickFilter@member" class="mui-mbarp-prof-item" title="'+a.title+'" href="'+a.url+'" target="_blank">';i+='<div class="mui-mbarp-prof-img">'+'<p class="mui-mbarp-prof-title" title="'+a.title+'">'+a.title+"</p>"+'<img src="'+h.formatImg(a.pic,"_400x400q75.jpg")+'" width="200" height="200" />'+"</div>";i+="</a>"});if(e){return i}return Y("act",i,{isShowRenewal:a.length>R})}function W(a,e){var i="";h.loopList(a,w,function(a){i+='<a data-action="clickFilter@member" title="'+a.brandName+'" class="mui-mbarp-prof-item" href="'+a.url+'" target="_blank">';i+='<div class="mui-mbarp-prof-img"><img src="'+h.formatImg(a.pic,"_90x90.jpg")+'" width="90" height="45"/></div>';var e=a.delivery;i+='<div class="mui-mbarp-prof-desc">\u6b63\u5728'+("\u4f18\u60e0\u5238"===e?"\u53d1\u653e":"\u8fdb\u884c")+":<strong>"+a.target+"\u4e13\u4eab</strong><span>"+e+"</span></div>";i+="</a>"});if(e){return i}return Y("brand",i,{isShowRenewal:a.length>w,forceSpace:true})}function Y(a,e,i){if(!e){m.codeTracker.sendTrack(l.T.NUMLEV,"mallbar.prof.renderblock."+a+".empty","\u6ca1\u6709\u6570\u636e\u53ef\u4f9b\u6e32\u67d3");return i.forceSpace?'<div class="mui-mbarp-prof-space"></div>':""}i=i||{};var t='<div class="mui-mbarp-prof-block mui-mbarp-prof-member-'+a+'" data-name="'+a+'"><div class="mui-mbarp-prof-header">';if(i.isShowRenewal){t+='<span class="mui-mbarp-prof-renewal" data-action="renewal@member">\u6362\u4e00\u6279</span>'}if(N.empty){t+='<span class="mui-mbarp-prof-block-title" data-name="'+a+'">'+U[a].def+"</span>"}else{t+=J(a,N.level)}t+='</div><div class="mui-mbarp-prof-list">'+e+"</div></div>";return t}function z(a){var e=N.level;a.parent("div.mui-mbar-plugin-prof").all("span.mui-mbarp-prof-user-level").html(e);a.all("span.mui-mbarp-prof-block-title").each(function(a){a.html(J(a.attr("data-name"),e))})}function J(a,e){return U[a].member}function q(a){var e=new Date(a-0);return[e.getFullYear(),"/",e.getMonth()+1,"/",e.getDate()," ",e.getHours(),":",e.getMinutes(),":",e.getSeconds()].join("")}function Q(a,e){a=new Date(a-0);e=new Date(e-0);var i=a.getFullYear()-2e3;var t=Z(a.getMonth()+1);var r=Z(a.getDate());var n=a.getHours();var o=a.getMinutes();var s=a.getSeconds();var l=e.getFullYear()-2e3;var m=Z(e.getMonth()+1);var u=Z(e.getDate());var c=e.getHours();var b=e.getMinutes();var d=e.getSeconds();var p=i+"."+t+"."+r;var f=l+"."+m+"."+u;if(0===n+o+s&&23===c&&59===b&&59===d){return{from:p,to:f}}return{from:p+" "+Z(n)+":"+Z(o),to:f+" "+Z(c)+":"+Z(b)}}function Z(a){return(a<10?"0":"")+a}function $(){try{TB.Global.updateLoginInfo()}catch(a){}}function ae(a){var e=a.mod;var i=a.title.replace("{level}",'<span class="mui-mbarp-prof-user-level"></span>');return'<div class="mui-mbarp-prof-item mui-mbarp-prof-tab-'+e+'" data-mod="'+e+'">'+i+"</div>"}return P},{requires:["cookie","base","dom","node","event","ajax","mui/minilogin/index","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","xtemplate","mui/mallbar/plugin-prof.css"]});KISSY.add("mui/mallbar/plugin-asset",function(a,e,i,t,r,s,n,o,l){var m=window.location.href.indexOf("mock-tmallbao=1")>-1;var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};a.extend(u,e,{init:function(){var e=this;var i=e.mallbarItem=e.get(s.K.MALLBAR_ITEM);var t=e.userInfo=i.getUserInfo();e.token="";var r=n.getSysId();e.isList=r=="list";e.isDetail=r=="detail";e.isShop=r=="shop";e.bubbled=false;var o=i.get(s.K.MALLBAR);e.itemId=o.get("itemId")||"";e.sellerId=o.get("sellerId")||"";e.shopId=o.get("shopId")||"";if(t.isLogin){var u=a.unparam(window.location.search.substr(1));var c=u&&Number(u.gap)||36e5;p();f()}e.set("isDataChange",true);e.on(s.E.VISIBILITY_CHANGE,function(a){if(a.visible&&e.get("isDataChange")){e._getAssetData()}});i.on(s.E.LOGIN_SUCCESS,function(a){n.log(a.type);p();f()});e.on(s.E.DATA_CHANGE,function(a){e.set("isDataChange",true);if(i.get(s.K.EXPAND)){e._getAssetData()}});var b=e.get("mallbarItem").get("tab");var d=a.one(".mui-mbar");b.on("click",function(){if(d.hasClass("mui-mbar-status-expand")){n.sendLog(s.ARR.ASSETS_TAB_CLICK)}});function p(){if(!e.bubbled){e.bubbled=true;e.getPluginAssetTip()}}function f(){var a=e.get(s.K.MALLBAR_ITEM);var i=a.get(s.K.MALLBAR);var t=['<div class="mui-mbar-bubble mui-mbarp-bubble-asset-tmallbao" >','<div class="mui-mbar-arr mui-mbarp-bubble-asset-tmallbao-arr">\u25c6</div>','<a class="mui-mbarp-bubble-asset-tmallbao-bd" target="_blank" href="//chong.alipay.com/i/chong.htm?scm=1048.1.3.31">',"</a>","</div>"].join("");n.getStaticConf({cb:function(e){var r=i.get(s.K.MODEL).get(s.K.TIMESTAMP);if(e.tmallBaoBubble){var o=e.tmallBaoBubble;var u=o.s?o.s:"";var c=o.e?o.e:"";if(r>u&&r<c||m){l.get({k:"mui/mbarp/tmallbao/bubble/"+a.getUid(),success:function(e){if(e&&!m){return}i.bubble({show:true,content:t,customContentType:3,flag:4.1,height:150,bubbleType:0,isNotTabFire:true,tab:"ASSET",showTwo:true,showed:function(){n.sendLog(s.ARR.TMALLBAO_BUBBLE_SHOW);l.set({k:"mui/mbarp/tmallbao/bubble/"+a.getUid(),v:true,expires:1})},clicked:function(){n.sendLog(s.ARR.TMALLBAO_BUBBLE_CLICK)},dismiss:function(){}})}})}}}})}},_getCouldCoupon:function(){var e=this;var i=e.mallbarItem;var l=a.one("#mbarCouponAnchorCouldCoupon");if(l){l.hide();n.ajax({url:s.URL.GET_PLUGIN_ASSET_OBTAIN_COUPON_LIST,dataType:"jsonp",data:{sellerId:e.sellerId,itemId:e.itemId},timeout:5,success:function(i){if(i.s!==200){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.obtainCoupon.failure.bad-status-"+i.s,"\u83b7\u53d6\u53ef\u9886\u4f18\u60e0\u5238\u5f02\u5e38");return}if(!i.oci){return}e.token=i.t;var m=i.oci.c;if(m.length=="0"){return}l.html("\u5f53\u524d\u5e97\u94fa\u6709\u53ef\u9886\u4f18\u60e0\u5238\u54e6").show();var u=new o(['<div class="mui-mbarp-asset-coupon-title" style="height:0px" id="mbarCouponAnchorAbleCoupon">',"\u5f53\u524d\u5e97\u94fa\u53ef\u7528\u4f18\u60e0\u5238","</div>"].join(""));var c=['<a class="mui-mbarp-asset-coupon-item mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}} ','{{#if a>1}}mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}}-multi{{/if}}" href="javascript:;"',' data-s="{{s}}" data-l="{{l}}" data-activeId="{{sid}}" data-c="{{c}}" data-stretch="1" data-u="#" data-d="{{d}}" data-t="\u6709\u6548\u671f" data-n="{{n}}" data-nt="{{nts}}"  data-f="{{f}}" data-i={{i}}',">",'<div class="mui-mbarp-asset-coupon-border-top"></div>','<div class="mui-mbarp-asset-coupon-item-content">','<p class="mui-mbarp-asset-coupon-item-hd">','<span class="mui-mbarp-asset-coupon-item-name" title="{{n}}"> ',"{{#if f}}",'<span class="mui-mbarp-asset-tmgj-flag "> </span>',"{{/if}}","{{nt}}</span>","</p>",'<div class="mui-mbarp-asset-coupon-item-bd mui-mbarp-clearfix">','<div class="mui-mbarp-asset-coupon-item-bd-right mui-mbarp-asset-coupon-item-bd-right-could">',"<p>{{s}}</p>","<p>&nbsp;{{l}}</p>","</div>",'<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-coupon-item-rmb mui-mbarp-asset-coupon-item-rmb-could" {{#if i===1}}style="height:25px!important"{{/if}}>','\uffe5<span class="mui-mbarp-asset-coupon-item-rmb-rmb">',"{{d}}</span>","</p>",'<p class="mui-mbarp-asset-coupon-item-condition">\u6ee1{{c}}\u4f7f\u7528{{#if i===1}}</br>(\u90e8\u5206\u5546\u54c1){{/if}}</p>',"</div>","</div>","</div>",'<div class="mui-mbarp-asset-coupon-border-bottom"></div>','<div class="mui-mbarp-asset-coupon-could-act j_couldPull j_couldPullAct">','<div class="mui-mbarp-asset-coupon-could-act-icon j_couldActIcon mui-mbarp-asset-hide"></div>','<span class="mui-mbarp-asset-coupon-could-act-val j_couldActVal">\u7acb\u5373\u9886\u53d6</span>','<div class="mui-mbarp-asset-coupon-could-act-icon"><img src="//gtd.alicdn.com/tps/i4/T19yeaFDVfXXa94Hfd-32-32.png" width="16" height="16"/></div>',"</div>",'<div class="mui-mbarp-asset-coupon-could-act-fail j_couldCouponFail">','<div class="mui-mbarp-asset-could-act-fail-icon"><img src="//img.alicdn.com/tps/i4/T1UWUoFz4aXXXuPRLc-28-28.png" width="14"></div>','<div class="mui-mbarp-asset-could-act-fail-msg j_couldCouponFailMsg"></div>',"</div>",'<div class="mui-mbarp-asset-coupon-could-area j_couldPull j_couldPullBd">','<div class="mui-mbarp-asset-coupon-now-area-bg"></div>','<div class="mui-mbarp-asset-coupon-fail-area-bg"></div>',"</div>","</a>"];var b=new o(['<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-could-coupon">',"{{#each c}}",c.join(""),"{{/each}}","</div>"].join(""));n.log("::\u53ef\u9886\u53d6\u7684\u4f18\u60e0\u5238::",m);if(m&&m.length>0){if(!m[0].s){return}if(a.one(".mui-mbar-asset-no-coupon")){a.one(".mui-mbar-asset-no-coupon").css("visibility","hidden")}a.each(m,function(a){var e=/^\d{2}/;a.s=a.s.replace(e,"");a.l=a.l.replace(e,"");a.nt=a.n;a.nts=a.n;if(a.f){a.nts=n.sub(a.n,14);a.nt=n.sub(a.n,19)}});if(a.one("#mbarCouponAnchorCouldCoupon")){a.DOM.insertAfter(a.DOM.create(b.render(i.oci)),a.one("#mbarCouponAnchorCouldCoupon"));a.one("#mbarCouponAnchorCouldCoupon").show()}r.delegate(".j_mui-mbarp-asset-could-coupon","mouseenter",".mui-mbarp-asset-coupon-item",function(e){var i=a.one(e.currentTarget);if(i.attr("data-stretch")=="1"){t(i.one(".j_couldPullBd"),{right:"-183px"},.1,s.EASE).run();t(i.one(".mui-mbarp-asset-coupon-could-act"),{right:"8px"},.1,s.EASE).run()}});r.delegate(".j_mui-mbarp-asset-could-coupon","mouseleave",".mui-mbarp-asset-coupon-item",function(e){var i=a.one(e.currentTarget);if(i.attr("data-stretch")=="1"){t(i.one(".j_couldPullBd"),{right:"-198px"},.1,s.EASE).run();t(i.one(".mui-mbarp-asset-coupon-could-act"),{right:"0px"},.1,s.EASE).run()}});r.delegate(".j_mui-mbarp-asset-could-coupon","click",".mui-mbarp-asset-coupon-item",function(a){a.halt();d(a)});r.delegate(".mui-mbarp-asset-wrap","click",".j_couldPull",function(a){a.halt();d(a)});r.delegate(".j_mui-mbarp-asset-could-coupon","click",".j_couldCouponFail",function(e){var i=a.one(e.currentTarget).parent(".mui-mbarp-asset-coupon-item");i.slideUp(.5);e.halt()});function d(i){var r;if(a.one(i.currentTarget).hasClass(".mui-mbarp-asset-coupon-item")){r=a.one(i.currentTarget)}else{r=a.one(i.target).parent(".mui-mbarp-asset-coupon-item")}var o=.5,l=.5,m=s.EASE;n.ajax({url:s.URL.GET_PLUGIN_ASSET_OBTAIN_COUPON,data:{sellerId:e.sellerId,spreadId:r.attr("data-activeId"),_tb_token_:e.token},success:function(i){if(i.s=="-2"){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.counpon.get.failure","\u7528\u6237\u4f18\u60e0\u5238\u9886\u53d6\u5931\u8d25");return}if(i.s=="-1"){r.attr("data-stretch","0");if(i.m.length<12){r.one(".j_couldCouponFailMsg").css("line-height","48px")}else{r.one(".j_couldCouponFailMsg").css("padding-top","9px")}r.one(".j_couldCouponFailMsg").html(i.m);t(r.one(".j_couldCouponFail"),{right:"0px"},l,m,function(){r.one(".j_couldPullBd").one(".mui-mbarp-asset-coupon-now-area-bg").hide();r.one(".j_couldPullBd").one(".mui-mbarp-asset-coupon-fail-area-bg").css("width","198px")}).run();t(r.one(".j_couldPullBd"),{right:"0px"},l,m).run();t(r.one(".j_couldPullAct"),{right:"187px"},l-6e-5,m).run()}else if(i.s=="1"){r.one(".mui-mbarp-asset-coupon-could-act").css("top","18px");r.one(".j_couldActIcon").html("&#xe605;").show();r.one(".j_couldActVal").next().hide();r.one(".j_couldActVal").html("\u5df2\u9886").css("margin-top","0px");t(r,{height:"0px"},o,m,function(){r.hide();b();var i={};i.d=r.attr("data-d");i.u=r.attr("data-u");i.s="20"+r.attr("data-s");i.l="20"+r.attr("data-l");i.t=r.attr("data-t");i.n=r.attr("data-n");i.c=r.attr("data-c");i.f=!(r.attr("data-f")=="false");i.nt=r.attr("data-nt");i.i=r.attr("data-i");var s=e._couponTemp.render(i);a.one(s).prependTo(a.one(".j_mui-mbarp-asset-cur-coupon"));if(!a.one("#mbarCouponAnchorAbleCoupon")){a.all(u.render()).insertBefore(a.one(".j_mui-mbarp-asset-cur-coupon"));t(a.one("#mbarCouponAnchorAbleCoupon"),{height:"18px"},.1,m,function(){c(i.i)}).run()}else{c(i.i)}}).run()}}});function c(i){a.one(".j_mui-mbarp-asset-cur-coupon").all(".mui-mbarp-asset-coupon-item").each(function(r,s){if(s==0){if(a.one(".j_pushShopItems")){if(!e.isDetail&&i=="0"){t(a.one(".j_pushShopItems"),{height:"0px"},o,m,function(){a.one(".j_pushShopItems").css("overflow","hidden").insertAfter(a.one(r));t(a.one(r),{height:"90px"},o,m,function(){p();d()}).run()}).run()}else{t(a.one(r),{height:"90px"},o,m,function(){d()}).run()}}else{t(a.one(r),{height:"90px"},o,m,function(){if(!e.isDetail){a.one('<div class="mui-mbarp-asset-shop-push-items j_pushShopItems" style="height:0; overflow: hidden; zoom: 1px;"></div>').appendTo(a.one(".j_mui-mbarp-asset-cur-coupon"));if(i=="0"){e._getPullItems();p();b()}}d()}).run()}return false}})}function b(){var i=a.one("#mbarCouponAnchorAbleCoupon");var r=e.get(s.K.CONTAINER);if(i){var n=a.all(i).getDOMNode().offsetTop;t(r,{scrollTop:n},.5).run();e.set(s.K.COUPON_ANCHOR,"")}}function d(){var e=false;a.one(".j_mui-mbarp-asset-could-coupon").all("a").each(function(i){if(parseInt(a.one(i).css("height"))!=0){e=true}});if(e){a.one("#mbarCouponAnchorCouldCoupon").show()}else{a.one("#mbarCouponAnchorCouldCoupon").hide()}}function p(){t(a.one(".j_pushShopItems"),{height:"265px"},2,m,function(){a.one(".j_pushShopItems").css("overflow","visible")}).run()}}}},error:function(){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.obtainCoupon.get.failure","\u83b7\u53d6\u53ef\u9886\u4f18\u60e0\u5238\u5931\u8d25")}})}},_getPullItems:function(){var e=this;var i=e.mallbarItem;var l=a.one("#mbarCouponAnchorAbleCoupon");if(!e.isDetail){if(l){l.html("\u5f53\u524d\u5e97\u94fa\u53ef\u7528\u4f18\u60e0\u5238:");n.ajax({url:s.URL.GEI_PUSH_ITEMS,dataType:"jsonp",data:{appId:s.RECOMMEND_APPID,shopId:e.shopId},timeout:5,success:function(i){var l=new o(['<img src="{{acurl}}" class="mui-mbarp-asset-hide" /><div class="mui-mbarp-asset-shop-push-tip">\u63a8\u8350\u4ee5\u4e0b\u4eba\u6c14\u5b9d\u8d1d\u4eab\u7528\u4f18\u60e0\u5238\uff1a</div>',"<ul>","{{#each d}}",'<li class="mui-mbarp-asset-shop-push-item mui-mbarp-asset-shop-push-item{{xindex}}" data-url="{{linkUrl}}">','<a href="{{linkUrl}}" target="_blank">','   <div class="mui-mbarp-asset-shop-push-wrap">','       <span class="mui-mbarp-asset-shop-push-describe"><span class="mui-mbarp-asset-shop-push-a" title="{{title}}" target="_blank">{{title}}</span></span>','       <span class="mui-mbarp-asset-shop-push-price">\uffe5<b>{{price}}</b></span>','       <span class="mui-mbarp-asset-shop-push-sales">\u5df2\u552e\u51fa<b>{{sales}}</b>\u4ef6</span>',"   </div>",'   <div class="mui-mbarp-asset-hide mui-mbarp-asset-shop-push-166pic-arr"></div>','   <div class="mui-mbarp-asset-hide mui-mbarp-asset-shop-push-166pic"><img title="{{title}}" src="{{pic}}" width="198" height="198" style=""/></div>','   <img class="mui-mbarp-asset-shop-push-60pic" alt="{{title}}" src="{{pic}}" width="60" height="60"/>',"</a>","</li>","{{/each}}","</ul>",'<div class="mui-mbarp-clearfix mui-mbarp-asset-push-items-bg"></div>'].join(""));if(i.d&&i.d.length>0){if(a.one(".j_pushShopItems")){a.DOM.append(a.DOM.create(l.render(i)),a.one(".j_pushShopItems"))}a.all(".mui-mbarp-asset-shop-push-item").each(function(e){r.delegate(document,"mouseover",".mui-mbarp-asset-shop-push-60pic",function(e){var i=a.one(e.target).prev(),t=a.one(e.target).parent().one(".mui-mbarp-asset-shop-push-166pic-arr");i.css({display:"block"});t.css({display:"block"})});r.delegate(document,"mouseout",".mui-mbarp-asset-shop-push-60pic",function(e){var i=a.one(e.target).prev(),t=a.one(e.target).parent().one(".mui-mbarp-asset-shop-push-166pic-arr");i.css({display:"none"});t.css({display:"none"})});a.one(e).one("div.mui-mbarp-asset-hide").on("mouseout",function(e){var i=a.one(e.target).parent().one(".mui-mbarp-asset-shop-push-166pic-arr");a.one(e.target).css({display:"none"});i.css({display:"none"})})});r.delegate(".j_mui-mbarp-asset-cur-coupon","click",".mui-mbarp-asset-coupon-item",function(i){if(!e.isDetail){var r=a.one(".j_pushShopItems"),o=a.one(i.target).parent(".mui-mbarp-asset-coupon-item").next();if(o&&o.hasClass("j_pushShopItems")){return}t(r,{height:"0px"},.5,s.EASE,function(){n.log("i try clone");r.css("height","0px").insertAfter(a.one(i.target).parent(".mui-mbarp-asset-coupon-item"));t(r,{height:"265px"},2,s.EASE,function(){r.css("overflow","visible")}).run()}).run()}});a.one(".mui-mbarp-asset-shop-push-items").show()}else{a.one(".j_pushShopItems").hide()}},error:function(){a.one(".mui-mbarp-asset-shop-push-items").hide();n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.pushShopItems.get.failure","\u62c9\u53d6\u63a8\u8350\u5546\u54c1\u5931\u8d25")}})}}else{if(a.one(".j_pushShopItems")){a.one(".j_pushShopItems").css("height","0px")}}},_getAssetData:function(){var a=this;var e=a.mallbarItem;var i=e.get(s.K.MALLBAR);n.ajax({url:s.URL.GET_PLUGIN_ASSET,data:{sellerId:a.sellerId,itemId:a.itemId},timeout:4,jsonpCallback:"__mallbarGetMyAssets",success:function(t){n.log(t);if(t.s==401){e.fire(s.E.LOGIN,{success:function(){a.set("isDataChange",true);if(e.get(s.K.EXPAND)){a._getAssetData()}}});return}if(t.s!==200){e.fire(s.E.ERROR);n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.myAssets.failure.bad-status-"+t.s,"\u83b7\u53d6\u6211\u7684\u8d44\u4ea7\u5f02\u5e38");return}if(t){n.getStaticConf({cb:function(e){var r=i.get(s.K.MODEL).get(s.K.TIMESTAMP);t.inTmallbaoTime=false;if(e.tmallbaobannerTime){var o=e.tmallbaobannerTime;var l=o.s?o.s:"";var m=o.e?o.e:"";if(r>l&&(!m||r<m)){}if(e.tmallBaoDaily){if(r>e.tmallBaoDaily){t.showTmallBaoDaily=true}}t.tmallBaoDailyBanner=e.tmallBaoDailyBanner||"";t.tmallBaoLink=e.tmallBaoLink||""}t.inShowTime=r>e.closedStartShow&&r<e.closedEndTime;t.inActiveTime=r>e.closedStartTime&&r<e.closedEndTime;n.log("::plugin asset::\u8d44\u4ea7\u4e2d\u5c55\u793a\u4f18\u5148\u8d2d\u4e70\u8d77\u59cb\u65f6\u95f4",e.closedStartShow,e.closedStartTime,e.closedEndTime,t.inShowTime,t.inActiveTime);var u=function(){a._render(t);a._getCouldCoupon();if(t&&t.d&&t.d.c&&t.d.c.l&&t.d.c.l.length){var e=t.d.c.l.length;if(!t.d.c.l[e-1].i){a._getPullItems()}}a.set("isDataChange",false)};t.notNeedShopCard=true;var c=function(){if(t.notNeedShopCard){u()}else{n.ajax({url:s.URL.GET_SHOP_CARD,data:{sellerId:a.sellerId,itemId:a.itemId},timeout:4,jsonpCallback:"__mallbarGetShopCard",success:function(a){n.log("\u5e97\u94fa\u5361\u5185\u5bb9",a);if(a.success){t.shopCard=a.model}u()},error:function(){u()}})}};if(t.inShowTime){var b=a.userInfo.memberInfo.activeStatus||0;if(b==4){if(i.get("closeSaleNum")){c()}else{n.ajax({url:s.URL.GET_CLOSE_SALE_NUM,timeout:4,data:{itemId:i.get("itemId")},jsonpCallback:"__mallbarGetCloseSaleNum",success:function(a){if(a.s==200&&a.pec&&a.pec>0){i.set("closeSaleNum",a.pec);c()}else{c()}}})}}else{c()}}else{c()}}})}},error:function(){e.fire(s.E.ERROR);n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.myAssets.get.failure","\u83b7\u53d6\u6211\u7684\u8d44\u4ea7\u5931\u8d25")}})},renderCouldCoupon:function(a){var e=this,i;var t=e.mallbarItem;var r=t.get(s.K.MALLBAR);i=e._assetCouponBubbleTPL('<div class="mui-mbar-assets-disable-bubble mui-mbarp-assets-disable-bubble-couldCoupon" >\u8be5\u5e97\u94fa\u53ef\u9886\u4f18\u60e0\u5238<p class="mui-mbarp-asset-couldCouponBubble-click"><a>\u7acb\u5373\u9886\u53d6</a></p></div>');e.token=a.t;r.bubble({show:true,content:new o(i).render(),customContentType:3,isNotTabFire:false,bubbleType:0,tab:"ASSET",dismiss:function(){e.handleAbleBonusBubble()},showed:function(){n.sendLog(s.ARR.COUPON_COULD_SHOW)},clicked:function(){e.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorCouldCoupon");n.sendLog(s.ARR.COUPON_COULD_CLICK)}})},renderExpCoupon:function(e){var i=this,t="",r=i.handleExpCoupon(e),l=false,m={};if(r.n==1){var u=r.d[0];if(!u.isShow){l=true}else if(u.lastDay&&u.lastShow==false){l=true}var c=new Date(r.d[0].t);r.deadline=i.dateFormat(c,"yyyy-MM-dd");t='<div class="j_Asset_Bubble"><div class="mui-mbar-assets-disable-bubble">{{n}}\u5f20\u4f18\u60e0\u5238\u4e8e<br/>{{deadline}}\u8fc7\u671f</br>\u4ef7\u503c \uffe5{{t}}\u5143</div><p class="mui-mbar-bubble-href"><a>\u7acb\u5373\u67e5\u770b</a></p></div>';m.height="120px"}else{t='<div class="j_Asset_Bubble"><div class="mui-mbar-assets-disable-bubble">{{n}}\u5f20\u4f18\u60e0\u5238\u5373\u5c06\u8fc7\u671f</br>\u603b\u4ef7\u503c \uffe5{{t}}\u5143</div><p class="mui-mbar-bubble-href"><a>\u7acb\u5373\u67e5\u770b</a></p></div>';m.height="100px"}a.each(r.d,function(a){if(!a.isShow){l=true;return false}else if(a.lastDay&&a.lastShow==false){l=true;return false}});if(!l){i.getPluginAssetTip();return}i.mallbarItem.fire(s.E.BUBBLE_CHANGE,a.mix(m,{show:true,html:new o(t).render(r),dismiss:function(){i.getPluginAssetTip()},showed:function(){n.sendLog(s.ARR.COUPON_7_SHOW)},clicked:function(){i.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorExpCoupon");n.sendLog(s.ARR.COUPON_7_CLICK)}}))},dateFormat:function(a,e){var i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};if(/(y+)/.test(e)){e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))}for(var t in i){if(new RegExp("("+t+")").test(e)){e=e.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length))}}return e},handleExpCoupon:function(a){var e=this,i={},t=e.mallbarItem;if(a.isServer)a["server"]["serverSince"]=new Date*1;e.handleExpServiceData(a,i);l.set({k:"mui/mallbar/asset/"+t.getUid(),v:a.isServer?a["server"]:a["local"],success:function(a){}});return i},handleExpServiceData:function(e,i){var t=this;var r=new Date*1,s=e["server"],n=e["local"];if(n&&n.d){n.d=a.filter(n.d,function(e){if(s&&s.d){var i=false;a.each(s.d,function(a){if(a.i==e.i){i=true;return false}});return i}return true})}if(s){a.each(s.d,function(e){if(n){a.each(n.d,function(i){if(i.i==e.i){a.mix(e,i)}})}});a.mix(i,a.clone(s))}else{if(n){a.mix(i,a.clone(n))}}var o=s?s:n;a.each(o.d,function(a,e){if(t.dateFormat(new Date(a.t),"yyyy-MM-dd")==t.dateFormat(new Date(r),"yyyy-MM-dd")){i.d[e].lastDay=true;a.isShow=true;a.lastShow=true}else{a.isShow=true}})},getPluginAssetTip:function(){var a=this;var e=a.mallbarItem;var i=e.get(s.K.MALLBAR);i.getCueMsgInfo(function(e){if(e.s!=200){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.cueAssetMsg.failure.bad-status-"+e.s,"\u83b7\u53d6\u6211\u7684\u8d44\u4ea7\u6c14\u6ce1\u63d0\u9192\u5f02\u5e38");return false}a.token=e.t;if(e.b&&e.b.c>0&&e.b.a!=="0.0"){a.handleAbleBonusBubble(e);return}else if(e.m&&e.m.t){if(e.m.p&&e.m.p!=2){a.handleMemberCouponBubble(e)}return}else if(e.uci&&e.uci.d&&e.uci.d.length>0){a.handleAbleCouponBubble(e);return}else if(e.oci&&e.oci.c&&e.oci.c.length>0){a.renderCouldCoupon(e)}})},handleAbleBonusBubble:function(a){var e=this;var i=e.mallbarItem;var t=i.get(s.K.MALLBAR);if(!a){return}l.get({k:"mui/mallbar/asset/ableBonus/"+i.getUid(),success:function(r){if(r&&r.isShow){if(a.m&&a.m.t){if(a.m.p&&a.m.p!=2){e.handleMemberCouponBubble(a)}return}else if(a.uci&&a.uci.d&&a.uci.d.length>0){e.handleAbleCouponBubble(a);return}else if(a.oci&&a.oci.d&&a.oci.d.length>0){e.renderCouldCoupon(a)}}else{var m=["<div>","\u60a8\u5171\u6709{{c}}\u4e2a\u7ea2\u5305\u53ef\u7528","</div>","<div>","\u603b\u91d1\u989d{{a}}\u5143","</div>"].join("");var u=new o(m).render(a.b);t.bubble({show:true,content:u,customContentType:1,isNotTabFire:false,bubbleType:0,tab:"ASSET",showed:function(){n.sendLog(s.ARR.BONUS_AVAILABLE_BUB_SHOW)},dismiss:function(){e.handleAbleCouponBubble(a)},clicked:function(){n.sendLog(s.ARR.BONUS_AVAILABLE_BUB_CLICK)}});l.set({k:"mui/mallbar/asset/ableBonus/"+i.getUid(),v:{isShow:true}})}}})},handleAbleCouponBubble:function(e){var i=this;var t=i.mallbarItem;var r=t.get(s.K.MALLBAR);var l=["red","yellow","blue"];var m=["mui-mbarp-asset-ableCouponBubble-title-red","mui-mbarp-asset-ableCouponBubble-title-yellow","mui-mbarp-asset-ableCouponBubble-title-blue"];if(a.isUndefined(e.uci)){return}if(e.uci.d&&e.uci.d.length==0){return}var u=function(e){var i=e[0]?e[0]:e.data;var t=i.d;if(t.length==0){return}var r="";var s='<div class="mui-mbarp-asset-ableCouponBubble-content mui-mbar-bubble">';s+='<div class="mui-mbar-arr mui-mbar-bubble-arr">\u25c6</div>';s+='<div class="mui-mbarp-asset-bubble-top"></div>';a.each(t,function(a,e){var i=a.d;var n="mui-mbarp-asset-ableCouponBubble-title-denomination";if(e===0){s+='<div class="mui-mbarp-asset-ableCouponBubble-'+r+"_small mui-mbarp-asset-ableCouponBubble-"+r+"_big mui-mbarp-asset-ableCouponBubble-zindex-"+e+' mui-mbarp-asset-ableCouponBubble">';s+='<p class="mui-mbarp-asset-ableCouponBubble-title '+n+'">\u60a8\u6709'+t.length+"\u5f20\u4f18\u60e0\u5238</p>"+'<p class="mui-mbarp-asset-ableCouponBubble-trmb">';s+='<span class="mui-mbarp-asset-memberCouponBubble-rmb_icon">\uffe5</span>'+'<span class="mui-mbarp-asset-ableCouponBubble-rmb">'+i+"</span>"+"</p>"+'<p class="mui-mbarp-asset-ableCouponBubble-now_use"><a>\u7acb\u5373\u4f7f\u7528</a></p>'+"</div>";return}});s+='<div class="mui-mbarp-asset-bubble-bottom"></div>';s+="</div>";return s};var c=new o(u).render(e.uci);r.bubble({show:true,content:c,customContentType:3,bubbleType:s.B.FOREVER,isNotTabFire:false,tab:"ASSET",showed:function(){n.sendLog(s.ARR.COUPON_AVAILABLE_SHOW)},clicked:function(){i.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorAbleCoupon");n.sendLog(s.ARR.COUPON_AVAILABLE_CLICK)}})},handleMemberCouponBubble:function(e){var i=this;var t=i.mallbarItem;var r=t.get(s.K.MALLBAR);if(a.isUndefined(e.m)){return}var l="";var m='<div class="mui-mbarp-asset-memberCouponBubble-content mui-mbar-bubble">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr mui-mbar-asset-member-bubble-arr">\u25c6</div>'+'<div class="mui-mbarp-asset-member-bubble-top"></div>'+'<div class="mui-mbarp-asset-memberCouponBubble-zindex-0 mui-mbarp-asset-memberCouponBubble">'+' <p class="mui-mbarp-asset-memberCouponBubble-title mui-mbarp-asset-memberCouponBubble-title-denomination">'+"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>'+"{{/if}}"+"{{t}}</p>"+'<p class="mui-mbarp-asset-memberCouponBubble-trmb">'+"{{#if rt===2}}"+'<span class="mui-mbarp-asset-memberCouponBubble-rmb_icon">\uffe5</span>'+'<span class="mui-mbarp-asset-memberCouponBubble-rmb">{{m}}</span><span>\u73b0\u91d1\u5238</span></p>'+"{{/if}}"+"{{#if rt===1}}"+"{{b}}\u6298\u6263</p>"+"{{/if}}"+"{{#if rt===3}}"+"{{b}}\u8bd5\u7528</p>"+"{{/if}}";m+='<p class="mui-mbarp-asset-memberCouponBubble-now_use"><a>{{a}}</a></p>'+'<div class="mui-mbarp-asset-member-bubble-bottom"></div>'+"</div>";l=m;var u=new o(l).render(e.m);r.bubble({show:true,content:u,customContentType:3,bubbleType:s.B.FOREVER,isNotTabFire:false,tab:"ASSET",showed:function(){n.sendLog(s.ARR.COUPON_MEMBER_BUBBLE_A_SHOW)},clicked:function(){i.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorAbleCoupon");n.sendLog(s.ARR.COUPON_MEMBER_BUBBLE_A_CLICK)}})},_renderShopCard:function(e){var i="";var t='<li class="mui-mbarp-asset-shop-card-item mui-mbarp-asset-shop-card-item-{categoryTag}">                        <a class="mui-mbarp-asset-shop-card-link" href="//{shopUrl}" target="_blank">                            <h4>{shopTitle}</h4>                            <p><em>\u4f59\u989d\uff1a<span class="mui-price-font">&yen;</span><span class="mui-mbarp-asset-shop-cart-balance">{balance}</span></em></p>                            <p>\u8fdb\u5e97\u901b\u901b&gt;</p>                        </a>                        <a class="mui-mbarp-asset-shop-card-link-charge {hidden}" href="//shopcard.tmall.com/?sellerId={sellerId}&campaignId={campaignId}">\u5145{moneyBase}\u9001{moneyExtra}&gt;</a>                    </li>';a.each(e,function(e,r){if(r>2){return}if(e.moneyBase){e.moneyBase=parseInt(e.moneyBase,10)/100;e.moneyExtra=parseInt(e.moneyExtra,10)/100;e.hidden=""}else{e.hidden="hidden"}e.balance=(parseInt(e.balance,10)/100).toFixed(2);i=i+a.substitute(t,e)});i='<div class="mui-mbarp-asset-shop-cart-cont">                        <div class="mui-mbarp-asset-shop-cart-title">\u6211\u7684\u5e97\u94fa\u5361\uff1a</div>                    <ul class="mui-mbarp-asset-shop-cart-list">'+i+'</ul><a class="mui-mbar-more mui-mbar-asset-more" href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.4&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">\u67e5\u770b\u66f4\u591a<b></b></a></div>';return i},_renderCashCoupon:function(e){var i=this;var t="";if(e&&e.length>0){t="<div class='mui-mbarp-asset-cash-title'>\u5929\u732b\u8d2d\u7269\u5238\uff1a<a href='//www.tmall.com/market/yx/buycouponrule.php?scm=1048.1.3.32' target='_blank'>\u5982\u4f55\u4f7f\u7528?</a></div>";var r="<div class='mui-mbarp-asset-cash-item {cls}'>                    <div class='mui-mbarp-asset-cash-left'>                    <p class='mui-mbarp-asset-cash-money'><i>&yen;</i>{d}</p>                    <p class='mui-mbarp-asset-cash-condition'>\u6ee1{c}\u5143\u4f7f\u7528</p>                    </div>                    <div class='mui-mbarp-asset-cash-right'>                    {html}                    </div>                    </div>";a.each(e,function(e){if(e.t=="\u5373\u5c06\u8fc7\u671f"){var s=i._getDiffDay(e.l);e.cls="mui-mbarp-asset-cash-countdown";e.html="<p  class='mui-mbarp-asset-cash-count'>"+s+"\u540e\u8fc7\u671f</p>"}else{var n=e.l?e.l.substr(0,10):"";var o=e.s?e.s.substr(0,10):"";e.html="<p class='mui-mbarp-asset-cash-date '>\u6709\u6548\u671f</br>"+o+"</br>-"+n+"</p>"}t+=a.substitute(r,e)});t+='<a class="mui-mbar-more mui-mbar-asset-more" href="//taoquan.taobao.com/framework/got_bonus.htm?tabIndex=44&scm=1048.1.3.34" target="_blank">\u67e5\u770b\u66f4\u591a<b></b></a>'}return t},_render:function(e){var i=this;var t=i.mallbarItem=i.get(s.K.MALLBAR_ITEM);var r=t.get(s.K.MALLBAR);var l=i.get(s.K.CONTAINER);var m=e.d;m.alipayId=e.alipayId?e.alipayId:"";o.addCommand("formatInteral",function(a,e){return i._formatInteral(e.fn(a))});var u;if(e.d&&e.d.c&&e.d.c.ca){u=e.d.c.ca||"-"}else{u="-"}var c=['<div class="mui-mbarp-asset-overview mui-mbarp-clearfix">','<a href="//vip.tmall.com/point/all?scm=1048.1.3.19" target="_blank">','<div class="mui-mbarp-asset-integral-wrap">','<div class="mui-mbarp-asset-coupon-value">',i.getIntegral(),"</div>",'<div class="mui-mbarp-asset-coupon-text">\u79ef\u5206</div>',"</div>","</a>",'<a href="//mybrand.tmall.com/myCoupon.html?scm=1048.1.3.18" target="_blank">','<div class="mui-mbarp-asset-coupon-wrap">','<div class="mui-mbarp-asset-coupon-value">',"{{#with c}}{{a}}{{/with}}","</div>",'<div class="mui-mbarp-asset-coupon-text">\u4f18\u60e0\u5238</div>',"</div>","</a>",'<a href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.20&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">','<div class="mui-mbarp-asset-bonus-wrap">','<div class="mui-mbarp-asset-bonus-value">',"{{#with b}}",'<span class="mui-mbarp-asset-bonus-yen">&yen;</span>',"{{#if d}}{{d}}{{/if}}","{{^if d}}0{{/if}}","{{/with}}","</div>",'<div class="mui-mbarp-asset-bonus-text">\u7ea2\u5305({{#with b}}{{a}}{{/with}})</div>',"</div>","</a>",'<a href="//taoquan.taobao.com/framework/got_bonus.htm?tabIndex=44&scm=1048.1.3.33" target="_blank">','<div class="mui-mbarp-asset-shop-card-wrap">','<div class="mui-mbarp-asset-shop-card-value">',u,"</div>",'<div class="mui-mbarp-asset-shop-card-text">\u8d2d\u7269\u5238</div>',"</div>","</a>","</div>","{{#with p}}{{#if e}}",'<div class="mui-mbarp-asset-tips">',"{{#formatInteral}}{{e}}{{/formatInteral}}\u5929\u732b\u79ef\u5206\u4e8e{{d}}\u8fc7\u671f",'<span class="mui-mbarp-assets-tips-arrow">\u25c6</span>',"</div>","{{/if}}{{/with}}"];var b=['<div class="mui-mbarp-asset-bonus">',"{{#with b}}","{{#if b_l_len}}",'<div class="mui-mbarp-asset-line-h"></div>','<div class="mui-mbarp-asset-bonus-title">',"\u6211\u7684\u7ea2\u5305","</div>","{{/if}}","{{#each l}}","{{#if xindex<3}}",'<a href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.4&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">','<div class="mui-mbarp-asset-bonus-item mui-mbarp-clearfix">','<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-bonus-item-rmb">&yen;<span class="rmb">{{d}}</span></p>','<p class="mui-mbarp-asset-coupon-item-surplus">\u5269\u4f59\uff1a<span class="yen">&yen;</span>{{sp}}</p>',"</div>",'<div class="mui-mbarp-asset-bonus-item-right">',"<p>\u6709\u6548\u671f</p>","<p>{{s}}</p>","<p>-&nbsp;{{l}}</p>","</div>","</div>","</a>","{{/if}}","{{/each}}","{{/with}}","{{#with b}}","{{#if a>0}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.4&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","{{/with}}","</div>"];var d=['<a class="mui-mbarp-asset-coupon-item mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}} ','{{#if a>1}}mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}}-multi{{/if}}" href="{{^if curCoupon}}{{u}}" target="_blank"{{else}}javascript:;"{{/if}}>','<div class="mui-mbarp-asset-coupon-border-top"></div>','<div class="mui-mbarp-asset-coupon-item-content">','<p class="mui-mbarp-asset-coupon-item-hd">','<span class="mui-mbarp-asset-coupon-item-tips ','{{#if t==="\u5373\u5c06\u8fc7\u671f"}}mui-mbarp-asset-coupon-item-tips-will_expire{{/if}}" >','{{#if t==="\u5373\u5c06\u8fc7\u671f"}}',"<span >","<b>{{diffDay}}</b>\u540e\u8fc7\u671f</span>","{{else}}","{{t}}{{/if}}","</span>",'<span class="mui-mbarp-asset-coupon-item-name" title="{{n}}"> ',"{{#if f}}",'<span class="mui-mbarp-asset-tmgj-flag "> </span>',"{{/if}}","{{nt}}</span>","</p>",'<div class="mui-mbarp-asset-coupon-item-bd mui-mbarp-clearfix">','<div class="mui-mbarp-asset-coupon-item-bd-right">','{{#if t==="\u5373\u5c06\u8fc7\u671f"}}'," ","{{else}}","<p>{{s}}</p>","<p>-&nbsp;{{l}}</p>","{{/if}}","</div>",'<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-coupon-item-rmb">','\uffe5<span class="mui-mbarp-asset-coupon-item-rmb-rmb ','{{#if d>999}}mui-mbarp-asset-coupon-item-rmb-demotion{{/if}}">{{d}}</span>','{{#if a>1}} <span class="mui-mbarp-asset-coupon-x">x</span> <span class="mui-mbarp-asset-coupon-item-rmb-multi">{{a}}\u5f20</span>{{/if}}',"</p>",'<p class="mui-mbarp-asset-coupon-item-condition">\u6ee1{{c}}\u4f7f\u7528{{#if i===1}}</br>(\u90e8\u5206\u5546\u54c1\u53ef\u7528){{/if}}</p>',"</div>","</div>","</div>",'<div class="mui-mbarp-asset-coupon-border-bottom"></div>',"</a>"];var p=['<a class="mui-mbarp-asset-coupon-item mui-mbarp-asset-member-coupon-item " href="javascript:;">','<p class="mui-mbarp-asset-member-coupon-item-title">{{n}}</p>','<p class="mui-mbarp-asset-member-coupon-item-iconp" ><span class="mui-mbarp-asset-member-coupon-item-icon">',"{{#if v}}",'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>',"{{/if}}","{{r}}</span></p>",'<p class="mui-mbarp-asset-member-coupon-item-trmb" title="\uffe5{{cm}}\u73b0\u91d1\u5238"><span class="mui-mbarp-asset-member-coupon-item-rmb">\uffe5</span> <span class="mui-mbarp-asset-member-coupon-item-rmbn">{{cm}}</span><span>\u73b0\u91d1\u5238</span></p>','<p class="mui-mbarp-asset-member-coupon-item-time">\u6d3b\u52a8\u65f6\u95f4:{{t}}</p>',"</a>",'<div class="mui-mbarp-asset-coupon-border-bottom mui-mbarp-asset-member-coupon-item-border">',"</div>"].join("");
var f=[];if(e.inTmallbaoTime){var v="//gtms03.alicdn.com/tps/i3/TB19WTGGpXXXXXsXVXXSXBkHXXX-200-70.jpg";if(e.showTmallBaoDaily){v=e.tmallBaoDailyBanner}if(v){var g=e.tmallBaoLink||"//chong.alipay.com/i/chong.htm?scm=1048.1.3.29";f=['<div class="mui-mbarp-asset-tmall-bao"><a class="mui-mbarp-asset-tmall-bao-link" href="'+g+'" target="_blank">','<img src="'+v+'" width="200" height="70"/>',"</a></div>"]}}var _=r.get("closeSaleNum")||0;if(!e.inShowTime){_=0}var h=['<a class="mui-mbarp-asset-first-buy" href="//vip.tmall.com/privilege/vipfirst?scm=1048.1.3.30">','<p >\u4f1a\u5458\u4f18\u5148\u8d2d\u4e70\u5238<span class="mui-mbarp-asset-card-num">'+_+"</span>",'<div class="mui-mbarp-asset-card-time" >12\u670811\u65e509\u70b9\u81f320\u70b9\u6709\u6548</div>',"</p>","</a>"];var A="";if(!e.notNeedShopCard&&e.shopCard&&e.shopCard.list){A=i._renderShopCard(e.shopCard.list)}var T="";if(m&&m.c&&m.c.c){T=i._renderCashCoupon(m.c.c)}var C="";if(m.c.l.length==0&&m.c.j.length==0&&m.c.o.length==0&&m.c.m==0){C=['<div class="mui-mbarp-asset-wrap">',c.join(""),T,f.join(""),_?h.join(""):"",b.join(""),A,'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-cur-coupon">',"</div>",'<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorCouldCoupon">&nbsp;',"</div>",'<h2 class="mui-mbar-asset-no-coupon">\u55b5\uff01\u4f60\u8fd8\u6ca1\u9886\u53d6\u8fc7\u5929\u732b\u4f18\u60e0\u5238\uff01<br />\u5feb\u53bb\u9886\u53d6\u5427\uff01</h2>',"</div>"]}else{function E(a,e){if(!a){return}if(a.indexOf("?")==-1){a+="?scm="+e}else{a+="&scm="+e}return a}a.each(m.c.l,function(a){a.u=E(a.u,"1048.1.3.2");a.curCoupon=true;a.diffDay=i._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,14)}});a.each(m.c.j,function(a){a.u=E(a.u,"1048.1.3.5");a.diffDay=i._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,19)}});a.each(m.c.o,function(a){a.u=E(a.u,"1048.1.3.3");a.diffDay=i._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,14)}});a.each(m.c.g,function(a){a.u=E(a.u,"1048.1.3.6");a.diffDay=i._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,14)}});a.each(m.c.m,function(a){a.u=E(a.u,"1048.1.3.6");a.diffDay=i._getDiffDay(a.l)});function I(a,e){var i="";i+=['<div class="mui-mbarp-asset-wrap">',c.join(""),T,f.join(""),_?h.join(""):"",b.join(""),'<div class="mui-mbarp-asset-coupon">',"{{#with c}}"].join("");if(e||a){i+=['<div class="mui-mbarp-asset-line-h"></div>','<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorAbleCoupon">',"\u53ef\u7528\u4f18\u60e0\u5238","</div>",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-cur-coupon">'].join("");if(a){i+=["{{#each m}}",p,"{{/each}}"].join("")}if(e){i+=["{{#each l}}",d.join(""),"{{/each}}"].join("")}i+='<div class="mui-mbarp-asset-shop-push-items j_pushShopItems"></div>'}else{i+='<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-cur-coupon">'}i+=["</div>",'<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorCouldCoupon">&nbsp;',"</div>","{{#if j_len}}",'<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorExpCoupon">',"\u5373\u5c06\u8fc7\u671f\u4f18\u60e0\u5238","</div>","{{/if}}",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-exp-coupon">',"{{#each j}}",d.join(""),"{{/each}}","{{#if j_len}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="//mybrand.tmall.com/myCoupon.html?scm=1048.1.3.16#failcoupon" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","</div>","{{#if o_len}}",'<div class="mui-mbarp-asset-coupon-title">',"\u6211\u9886\u53d6\u7684\u4f18\u60e0\u5238","</div>","{{/if}}",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-oth-coupon">',"{{#each o}}","{{#if xindex<10}}",d.join(""),"{{/if}}","{{/each}}","{{#if o_len}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="//mybrand.tmall.com/myCoupon.html?scm=1048.1.3.17" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","</div>","{{#if g_len}}",'<div class="mui-mbarp-asset-coupon-title">',"\u5546\u5bb6\u8d60\u9001\u7684\u4f18\u60e0\u5238","</div>","{{/if}}",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-oth-coupon">',"{{#each g}}","{{#if xindex<3}}",d.join(""),"{{/if}}","{{/each}}","{{#if g_len}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="//mybrand.tmall.com/myCoupon.html?scm=1048.1.3.6" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","</div>","{{/with}}","</div>","</div>"].join("");return i}var B=!!m.c.m?m.c.m.length:0;var L=!!m.c.l?m.c.l.length:0;C=I(B,L)}if(m.b){m.b_l_len=0;a.each(m.b,function(a,e){if(typeof a!=="number"){if(e=="l"){m.b_l_len=a.length}}})}if(m.c){m.j_len=0;m.o_len=0;m.l_len=0;m.g_len=0;m.m_len=0;m.ableShow=0;a.each(m.c,function(a,e){if(typeof a!=="number"){switch(e){case"j":m.j_len=a.length;break;case"l":m.l_len=a.length;break;case"o":m.o_len=a.length;break;case"g":m.g_len=a.length;break;case"m":m.m_len=a.length;break}}})}if(a.isArray(C)){C=C.join("")}var S=new o(C).render(m);l.html(S);var O=a.one("#"+i.get(s.K.COUPON_ANCHOR));if(O){var R=O.offset().top-O.height()-10-a.one(window).scrollTop();l.scrollTop(R);i.set(s.K.COUPON_ANCHOR,"")}var N=l.one(".mui-mbar-asset-no-coupon");if(N){n.getStaticConf({cb:function(a){if(a.showZeroCoupon){N.html(n.fm('{0} <a class="mui-mbarp-asset-getCoupon" href="{1}" target="_blank">\u7acb\u5373\u9886\u53d6</a>',a.zeroCouponTxt,a.zeroCouponUrl))}}})}},cutStr:function(a,e){if(!a){return""}a=a.replace(/<a[^>]*?>([\w\W]+)<\/a>/gi,"$1");if(a.length<=e){return a}return a.substr(0,e)+"..."},getIntegral:function(){var e=this;var i=e.get(s.K.MALLBAR_ITEM);var t=i.getUserInfo();var r=t.memberInfo.availablePoints;r=a.isNumber(r)?r:s.DEGRADE;if(r==s.DEGRADE){return"-"}return e._formatInteral(r)},now:function(){var a=this;return a.get(s.K.MALLBAR_ITEM).getServerTime()},_getDiffDay:function(a){if(!a){return}var e,i,t,r,s=this;e=a.replace(/\./g,"/");i=new Date(e);t=new Date(s.dateFormat(s.now(),"yyyy/MM/dd"));r=parseInt(Math.abs(i-t)/1e3/60/60/24,10);if(r>0){return r+1+"\u5929"}else{var n=parseInt(Math.abs(i-s.now())/1e3/60/60)+1;var o="\u7a0d";if(n>0){o=n+"\u5c0f\u65f6"}return o}},_formatInteral:function(a){a=Number(a);if("NaN"==typeof a){throw Error("\u53c2\u6570\u7c7b\u578b\u9519\u8bef\uff0c\u8bf7\u4f20\u5165\u6570\u503c\u7c7b\u578b\u7684\u53c2\u6570")}if(a>=1e6){return parseInt(a/1e6,10)+"00\u4e07+"}else if(a>=1e7){return parseInt(a/1e7,10)+"000\u4e07+"}return a},_couponTemp:new o(['<a style="height:0; overflow: hidden;" class="mui-mbarp-asset-coupon-item mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}} ','{{#if a>1}}mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}}-multi{{/if}}" href="javascript:;" >','<div class="mui-mbarp-asset-coupon-border-top"></div>','<div class="mui-mbarp-asset-coupon-item-content">','<p class="mui-mbarp-asset-coupon-item-hd">','<span class="mui-mbarp-asset-coupon-item-tips ">',"{{t}}</span>",'<span class="mui-mbarp-asset-coupon-item-name" title="{{n}}">',"{{#if f}}",'<span class="mui-mbarp-asset-tmgj-flag "> </span>',"{{/if}}","{{nt}}</span>","</p>",'<div class="mui-mbarp-asset-coupon-item-bd mui-mbarp-clearfix">','<div class="mui-mbarp-asset-coupon-item-bd-right">',"<p>{{s}}</p>","<p>-&nbsp;{{l}}</p>","</div>",'<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-coupon-item-rmb">','\uffe5<span class="mui-mbarp-asset-coupon-item-rmb-rmb ','{{#if d>999}}mui-mbarp-asset-coupon-item-rmb-demotion{{/if}}">{{d}}</span>','{{#if a>1}} <span class="mui-mbarp-asset-coupon-x">x</span> <span class="mui-mbarp-asset-coupon-item-rmb-multi">{{a}}\u5f20</span>{{/if}}',"</p>",'<p class="mui-mbarp-asset-coupon-item-condition">\u6ee1{{c}}\u4f7f\u7528{{#if i===1}}</br>(\u90e8\u5206\u5546\u54c1\u53ef\u7528){{/if}}</p>',"</div>","</div>","</div>",'<div class="mui-mbarp-asset-coupon-border-bottom"></div>',"</a>"].join("")),_assetCouponBubbleTPL:function(a){var e;e='<div class="j_Asset_Bubble mui-mbarp-asset-coludCouponBubble-content mui-mbar-bubble">';e+='<div class="mui-mbar-arr mui-mbar-bubble-arr">\u25c6</div>';e+='<div class="mui-mbar-bubble-close"></div>';e+='<div class="mui-mbarp-asset-bubble-top"></div>';e+=a;e+='<div class="mui-mbarp-asset-bubble-bottom"></div>';e+="</div>";return e}});return u},{requires:["base","node","anim","event","mui/mallbar/conf","mui/mallbar/util","xtemplate","mui/mallbar/store","mui/mallbar/plugin-asset.css"]});KISSY.add("mui/mallbar/plugin-brand",function(a,e,i,t,r,s){var n=function(a){var e=this;e.showCoupon=false;n.superclass.constructor.call(e,a);e.init()};a.extend(n,e,{init:function(){var e=this;e.isAjaxMemberRight=false;var s=e.get(t.K.CONTAINER);var n=e.mallbarItem=e.get(t.K.MALLBAR_ITEM);var o=r.getSysId();e.isList=o=="list";e.isDetail=o=="detail";e.isShop=o=="shop";e.isAjaxMemberRight=e.isList;var l=n.get(t.K.MALLBAR);e.brandId=l.get("brandId")||"";var m={noBrands:'<h2 class="mui-mbar-brand-no">\u55b5\uff01\u4f60\u8fd8\u6ca1\u6709\u5173\u6ce8\u8fc7\u54c1\u724c\uff01<br />\u770b\u770b\u4e0b\u9762\u7684\u63a8\u8350\u54c1\u724c\u5427\uff01</h2>',myBrands:'<div class="mui-mbar-brand-list">{{#each m}}<div class="{{#if pic}}mui-mbar-brand-pic{{else}}mui-mbar-brand-box{{/if}}{{#if xindex<1}} mui-mbar-brand-first{{/if}}">                                {{#if pic}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}<b>{{name}}</b>{{/if}}</a>                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-i">{{#if tag}}<b class="mui-mbar-brand-tag-{{tag}}"></b>{{/if}}<img width="200" height="200" src="{{pic}}_250x250.jpg" alt="" /><b class="{{#if news}}mui-mbar-brand-desc{{else}}mui-mbar-brand-desc mui-mbar-brand-newsNo{{/if}}"><b class="mui-mbar-brand-news">{{news}}</b>\u4e2a\u54c1\u724c\u52a8\u6001</b></a>                                {{else}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}{{name}}{{/if}}</a>                                {{/if}}                                </div>                            {{/each}}</div>',aldBrands:'<h2 class="mui-mbar-brand-title mui-mbar-brand-ald">\u63a8\u8350\u54c1\u724c</h2>                            <div class="mui-mbar-brand-list">{{#each a}}<div class="{{#if pic}}mui-mbar-brand-pic{{else}}mui-mbar-brand-box{{/if}}{{#if xindex<1}} mui-mbar-brand-first{{/if}}">                                {{#if pic}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}<b>{{name}}</b>{{/if}}</a>                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-i">{{#if tag}}<b class="mui-mbar-brand-tag-{{tag}}"></b>{{/if}}<img width="200" height="200" src="{{pic}}_250x250.jpg" alt="" /><b class="{{#if news}}mui-mbar-brand-desc{{else}}mui-mbar-brand-desc mui-mbar-brand-newsNo{{/if}}"><b class="mui-mbar-brand-news">{{news}}</b>\u4e2a\u54c1\u724c\u52a8\u6001</b></a>                                {{else}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}{{name}}{{/if}}</a>                                {{/if}}                                </div>                            {{/each}}</div>',moreURL:'<a class="mui-mbar-brand-more" href="{{u}}" target="_blank">\u67e5\u770b\u66f4\u591a<b></b></a>'};function b(){var a=n.get(t.K.DATA);if(a.i1){r.ajax({url:t.URL.GET_PLUGIN_GET_BRAND,data:{},timeout:4,success:function(a){if(a.s!==200){r.codeTracker.sendTrack(t.T.NUMLEV,"mallbar.brand.brandContent.failure.bad-status-"+a.s,"\u83b7\u53d6\u6211\u5173\u6ce8\u7684\u54c1\u724c\u5185\u5bb9\u5f02\u5e38");return n.fire(t.E.ERROR)}var e='<div id="J_MuiMbarBrandBd" class="mui-mbar-brand-bd">                                 {{#if m&&m.length}} '+m.myBrands+"{{else}} "+m.noBrands+" {{/if}}                                 {{#if a&&a.length}} "+m.aldBrands+"{{/if}}                                 {{#if u}} "+m.moreURL+"{{/if}}                                 </div>";s.html(new i(e).render(a.m));if(a.mai){r.sendLog(a.mai)}c=false},jsonpCallback:"__mallbarBrand",error:function(){n.fire(t.E.ERROR);r.codeTracker.sendTrack(t.T.NUMLEV,"mallbar.brand.brandContent.get.failure","\u83b7\u53d6\u6211\u5173\u6ce8\u7684\u54c1\u724c\u5185\u5bb9\u5931\u8d25")}})}}var u=e.userInfo=n.getUserInfo();e.token="";e.bubbled=false;if(u.isLogin){d()}else{n.on(t.E.LOGIN_SUCCESS,function(a){r.log(a.type);d()})}var c=true;e.on(t.E.VISIBILITY_CHANGE,function(a){if(e.showCoupon){e.showMemberCoupon();e.showCoupon=false}else{if(a.visible&&c){n.fire(t.E.SUPTIP_CHANGE,{show:false});b()}}});e.on(t.E.DATA_CHANGE,function(a){c=true;if(n.get(t.K.EXPAND)){b()}});function d(){var i=n.get(t.K.MALLBAR);i.getCueMsgInfo(function(i){a.log(i);if(i.s!=200){r.codeTracker.sendTrack(t.T.NUMLEV,"mallbar.brand.cueAssetMsg.failure.bad-status-"+i.s,"\u83b7\u53d6\u6211\u5173\u6ce8\u7684\u54c1\u724c\u7684\u4f18\u60e0\u5238\u6c14\u6ce1\u63d0\u9192\u5f02\u5e38");return false}e.token=i.t;if(i.m&&i.m.p==2){e.memberRightType=!!i.m.rt?i.m.rt:0;e.handBrandBubble(i)}else if(i.mz&&i.mz.url){e.handTryBubble(i.mz)}})}},handBrandBubble:function(e){var s=this;var n=s.mallbarItem;var o=n.get(t.K.MALLBAR);var l=e.m;if(a.isUndefined(l)){return}var m="";var b='<div class="mui-mbarp-asset-memberCouponBubble-content mui-mbar-bubble {{#if rt!==2}} mui-mbarp-asset-memberCouponBubble-content-brand{{/if}}">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr mui-mbar-asset-member-bubble-arr">\u25c6</div>'+'<div class="mui-mbarp-asset-member-bubble-top"></div>'+'<div class="mui-mbarp-asset-memberCouponBubble-zindex-0 mui-mbarp-asset-memberCouponBubble {{#if rt!==2}}mui-mbarp-asset-memberCouponBubble-zindex-0-brand{{/if}}">'+' <p class="mui-mbarp-asset-memberCouponBubble-title mui-mbarp-asset-memberCouponBubble-title-denomination">'+"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>'+"{{/if}}"+"{{t}}</p>"+'<p class="mui-mbarp-asset-memberCouponBubble-trmb"{{#if rt!==2}} title="{{b}}" {{/if}} >'+"{{#if rt===2}}"+'<span class="mui-mbarp-asset-memberCouponBubble-rmb_icon">\uffe5</span>'+'<span class="mui-mbarp-asset-memberCouponBubble-rmb">{{m}}</span><span>\u73b0\u91d1\u5238</span></p>'+"{{/if}}"+"{{#if rt===1}}"+'{{bt}}</p><p class="mui-mbarp-asset-memberCouponBubble-brand">\u6298\u6263</p>'+"{{/if}}"+"{{#if rt===3}}"+'{{bt}}</p><p class="mui-mbarp-asset-memberCouponBubble-brand">\u8bd5\u7528</p>'+"{{/if}}";b+='<p class="mui-mbarp-asset-memberCouponBubble-now_use"><a>{{a}}</a></p>'+'<div class="mui-mbarp-asset-member-bubble-bottom"></div>'+"</div>";m=b;if(l.rt!=2){if(l.b){l.bt=r.sub(l.b,15)}}var u=new i(m).render(l);o.bubble({show:true,content:u,customContentType:3,bubbleType:t.B.FOREVER,isNotTabFire:false,tab:"BRAND",showed:function(){r.sendLog(t.ARR.COUPON_MEMBER_BUBBLE_B_SHOW)},clicked:function(){s.showCoupon=true;r.sendLog(t.ARR.COUPON_MEMBER_BUBBLE_B_CLICK)}})},showMemberCoupon:function(){var e=this;var s=['<div class="mui-mbarp-brand-member-coupon-div mui-mbarp-brand-member-coupon-div-margin">','<a class="mui-mbarp-brand-member-coupon-item" href="{{u}}" target="_blank">','<p class="mui-mbarp-brand-member-coupon-item-title">{{n}}</p>','<p class="mui-mbarp-brand-member-coupon-item-iconp" ><span class="mui-mbarp-brand-member-coupon-item-icon">',"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>',"{{/if}}","{{r}}</span></p>",'<p class="mui-mbarp-brand-member-coupon-item-trmb" title="\uffe5{{cm}}\u73b0\u91d1\u5238"><span class="mui-mbarp-brand-member-coupon-item-rmb">\uffe5</span> <span class="mui-mbarp-brand-member-coupon-item-rmbn">{{cm}}</span>\u73b0\u91d1\u5238</p>','<p class="mui-mbarp-brand-member-coupon-item-now_use"><span>{{a}}</span></p>','<p class="mui-mbarp-brand-member-coupon-item-time">\u6d3b\u52a8\u65f6\u95f4:{{t}}</p>',"</a>","</div>"].join("");var n=['<div class="mui-mbarp-brand-member-coupon-recom">','<a class="mui-mbarp-brand-member-coupon-item" href="{{u}}" target="_blank">','<img  class="mui-mbarp-brand-member-coupon-recom-img" src="{{tps}}" alt="{{n}}">','<p class="mui-mbarp-brand-member-coupon-recom-title" title="{{n}}">{{n}}</p>','<p class="mui-mbarp-brand-member-coupon-recom-rmb"><span class="mui-mbarp-brand-member-coupon-recom-rmb_1">\uffe5{{tp}}</span>','<p class="mui-mbarp-brand-member-coupon-recom-condition">\u9650\u91cf<span>{{tt}}</span>\u4efd</p>','<p class="mui-mbarp-brand-member-coupon-recom-apply">{{a}}</p>',"</a>","</div>"].join("");var o=['<div class="mui-mbarp-brand-member-coupon-div">','<a class="mui-mbarp-brand-member-coupon-item" href="{{u}}" target="_blank">','<p class="mui-mbarp-brand-member-coupon-item-title">{{n}}</p>','<p class="mui-mbarp-brand-member-coupon-item-iconp" ><span class="mui-mbarp-brand-member-coupon-item-icon">'+"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>'+"{{/if}}"+"{{r}}</span></p>",'<p class="mui-mbarp-brand-member-coupon-item-trmb"><span class="mui-mbarp-brand-member-coupon-item-discout">{{dr}}</span></p>','<p class="mui-mbarp-brand-member-coupon-item-now_use"><span >{{a}}</span></p>','<p class="mui-mbarp-brand-member-coupon-item-time">\u6d3b\u52a8\u65f6\u95f4:{{t}}</p>',"</a>","</div>","{{#if dit}}",'<div class="mui-mbarp-brand-member-coupon-vip-dis">','<div class="mui-mbar-arr mui-mbarp-brand-member-coupon-vip-dis-arr">\u25c6</div>','<p class="mui-mbarp-brand-member-coupon-vip-dis-p">\u4ee5\u4e0b\u5546\u54c1\u4e13\u4eab\u6298\u6263\u4ef7:</p>',"{{/if}}","<ul>","{{#each dit}}","<li>",'<a class="mui-mbarp-brand-member-coupon-item"href="{{diu}}" target="_blank">','<img src="{{dpu}}" class="mui-mbarp-brand-member-coupon-vip-dis-img60">','<div class="mui-mbarp-brand-member-coupon-vip-dis-div">','<p class="mui-mbarp-brand-member-coupon-vip-dis-title" title="{{din}}">{{din}}</p>','<p class="mui-mbarp-brand-member-coupon-vip-dis-icon"><span>T{{dil}}</span>\u4e13\u4eab{{did}}\u6298</p>',"</div>","</a>","</li>","{{/each}}","</ul>","</div>","{{#if dit}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="//brand.tmall.com/brandInfo.htm?brandId='+(!!e.brandId?e.brandId:"")+'&scm=1048.1.4.19" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}"].join("");var l=!!e.brandId?e.brandId:"";var m=!!e.memberRightType?e.memberRightType:0;if(e.isAjaxMemberRight){r.ajax({url:t.URL.GET_PLUGIN_MEMBER_RIGHT,data:{brandId:l,type:m},timeout:4,jsonpCallback:"__mallbarMemberRight",success:function(l){if(l.s!=200){e.mallbarItem.fire(t.E.ERROR);r.codeTracker.sendTrack(t.T.NUMLEV,"mallbar.brand.memberRight.failure.bad-status-"+l.s,"\u6211\u5173\u6ce8\u7684\u54c1\u724c\u83b7\u53d6\u4f1a\u5458\u6743\u76ca\u5238\u5f02\u5e38")}e.token=l.t;if(l.c&&l.c.length){var m=l.c,b=l.c.length,u="";for(var c=0;c<b;c++){var d="";var p=m[c];if(p[0].ty==2){u+='<p class="mui-mbarp-brand-member-coupon-recom-p">\u5f53\u524d\u54c1\u724c\u53ef\u7528\u4f18\u60e0\u5238</p>';a.each(p,function(a){!!a&&(a.u="//brand.tmall.com/brandInfo.htm?&brandId="+e.brandId);!!a.u&&(a.u=r.addSCM(a.u,"1048.1.99.1"))});for(var f=0;f<p.length;f++){u+=new i(s).render(p[f])}}else if(p[0].ty==1){u+='<p class="mui-mbarp-brand-member-coupon-recom-p">\u5f53\u524d\u54c1\u724c\u4e13\u4eab\u54c1\u724cVIP\u6298\u6263\u4ef7</p>';a.each(p,function(i){!!i&&(i.u="//brand.tmall.com/brandInfo.htm?&brandId="+e.brandId);!!i.u&&(i.u=r.addSCM(i.u,"1048.1.4.18"));if(!!i.dit){a.each(i.dit,function(a){!!a.diu&&(a.diu=r.addSCM("//detail.tmall.com/item.htm?id="+a.diu,"1048.1.99.2"));!!a.did&&(a.did=a.did/100)})}});for(var f=0;f<p.length;f++){u+=new i(o).render(p[f])}}else if(p[0].ty==3){u+='<p class="mui-mbarp-brand-member-coupon-recom-p">\u5f53\u524d\u54c1\u724c\u53ef\u7528\u8bd5\u7528\u4ea7\u54c1</p>';a.each(p,function(a){!!a.u&&(a.u=r.addSCM("//shiyong.tmall.com/try/payTryItem.htm?id="+a.u,"1048.1.99.3"))});for(var f=0;f<p.length;f++){u+=new i(n).render(p[f])}}}u+='<div class="mui-mbarp-brand-member-coupon-div-bottom"></div>';var v=e.get(t.K.CONTAINER);v.html(u)}},error:function(){e.mallbarItem.fire(t.E.ERROR);r.codeTracker.sendTrack(t.T.NUMLEV,"mallbar.brand.memberRight.get.failure","\u6211\u5173\u6ce8\u7684\u54c1\u724c\u83b7\u53d6\u4f1a\u5458\u6743\u76ca\u5238\u5931\u8d25")}})}},handTryBubble:function(e){if(!e.url){return}var i='<div class="mui-mbarp-brand-mz-bubble mui-mbar-bubble">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr ">\u25c6</div>'+'<div class="mui-mbarp-asset-bubble-top"></div>'+'<div class="mui-mbarp-brand-mz-bubble-content">'+"<p> Hi\uff0c{nick}</p>"+"<p> \u5feb\u6765\u9886\u53d6\u60a8\u7684\u4e13\u5c5e\u8bd5\u7528\u88c5\u54e6\uff01</p>"+'<p class="mui-mbarp-brand-mz-bubble-click"><a href="{url}" target="_blank">\u7acb\u5373\u67e5\u770b</a></p>'+"</div>"+'<div class="mui-mbarp-asset-bubble-bottom"></div>'+"</div>";var n=this;var o=n.mallbarItem;var l=o.get(t.K.MALLBAR);var m=o.getUserInfo();e.nick="";!!m.nick&&(e.nick=r.sub(m.nick,13));e.url=r.addSCM(e.url,"1048.1.4.20");var b=a.substitute(i,e);s.get({k:"mui/mbarp/brand/mz/tryBubble"+o.getUid(),success:function(a){if(a){return}var e=r.getSysId();l.bubble({show:true,content:b,customContentType:3,bubbleType:0,isNotTabFire:false,tab:"BRAND",flag:5.2,showed:function(){r.sendLog(t.ARR["BRAND_MZ_TRY_BUBBLE_SHOW"+(e?"_"+e.toUpperCase():"")]);r.sendLog(t.ARR.BRAND_MZ_TRY_BUBBLE_SHOW_ALL)},clicked:function(){r.sendLog(t.ARR["BRAND_MZ_TRY_BUBBLE_CLICK"+(e?"_"+e.toUpperCase():"")]);r.sendLog(t.ARR.BRAND_MZ_TRY_BUBBLE_CLICK_ALL);o.fire(t.E.BUBBLE_CHANGE,{show:false});s.set({k:"mui/mbarp/brand/mz/tryBubble"+o.getUid(),v:1,expires:1})}})}})}});return n},{requires:["base","xtemplate","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-brand.css"]});KISSY.add("mui/mallbar/plugin-live",function(a,e,i,t,r,n,s,o,l){var m=window.location.href.indexOf("mbar-debug=1")>-1;var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};var c='<div class="mui-mbarp-live-wrap"><p class="mui-mbarp-live-tab-p">'+'<span class="mui-mbarp-live-tab-title" id="mui-mbarp-live-tab-live-id">\u76f4\u64ad\u9891\u9053</span>'+'<span class="mui-mbarp-live-tab-title" id="mui-mbarp-live-tab-shop-id">\u5e97\u94fa\u9891\u9053</span>'+"</p>"+'<div class="mui-mbarp-live-tab-content-live"></div>'+'<div class="mui-mbarp-live-tab-content-shop"></div>'+"</div>";var b='<div class="mui-mbarp-live-wrap">'+'<div class="mui-mbarp-live-tab-content-live"></div>'+"</div>";var d=['<div class="mui-mbarp-live-msgs"></div>','<div class="mui-mbarp-live-load"></div>','<div class="mui-mbarp-live-more">\u67e5\u770b\u66f4\u591a<span class="mui-mbar-iconfont">&#xe601;</span></div>','<div class="mui-mbarp-live-more-nomsg">\u55b5\uff0c\u5df2\u7ecf\u662f\u6700\u540e\u7684\u6d88\u606f\u54af\uff01\uff01</div>'].join("");var p="mui/mallbar/live/show";var f="";var v=new r(["{{#each msgs}}",'<div class="mui-mbarp-live-msg {{#if d11}}mui-mbarp-live-msg-d11{{/if}}">',"  {{#if src}}",'  {{#if link}}<a target="_blank" href="{{link}}">{{/if}}','  <img class="mui-mbarp-live-img" src="{{src}}" title="{{desc}}"/>',"  {{#if link}}</a>{{/if}}","  {{/if}}",'  <div class="mui-mbarp-live-title {{#if src===""&&d11}}mui-mbarp-live-title-noimg{{/if}}">','    <a class="mui-mbarp-live-title-h" target="{{#if link}}_blank{{else}}_self{{/if}}" href="{{#if link}}{{link}}{{else}}javascript:;{{/if}}" title="{{t}}"> {{title}} </a>','    {{#if content}}<div class="mui-mbarp-live-content">{{{content}}}</div>{{/if}}',"  </div>",'  <div class="mui-mbarp-live-date"> <p>{{date}}</p> </div>',"</div>","{{/each}}"].join(""));var h="\u53cc11";var g=new r(['<div class="mui-mbarp-live-bub">','  <div class="mui-mbarp-live-msg {{#if d11}}mui-mbarp-live-msg-d11{{/if}}">','  <div class="mui-mbarp-live-msg-bub">',"  {{#if i}}",'  {{#if u}}<a target="_blank" href="{{u}}">{{/if}}','  <img class="mui-mbarp-live-img" src="{{i}}" title="{{t}}"/>',"  {{#if u}}</a>{{/if}}","  {{/if}}",'  <div class="mui-mbarp-live-close"></div>','  <div class="mui-mbarp-live-msg-bub-title {{#if i===""&&d11}}mui-mbarp-live-msg-bub-title-noimg{{/if}}">','    {{#if u}}<a target="_blank" href="{{u}}" title="{{t}}">{{/if}}',"    {{title}} ","    {{#if u}}</a>{{/if}}","  </div>","  </div>","  </div>","</div>"].join(""));var _=new r(['<div class="mui-mbar-bubble mui-mbarp-bubble-live-act">','<div class="mui-mbar-arr mui-mbarp-bubble-live-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-live-bubble-act-close"></div>','<div class="mui-mbarp-bubble-live-act-bd">',"  {{#if i}}",'  {{#if u}}<a target="_blank" href="{{u}}">{{/if}}','  <img class="mui-mbarp-live-bubble-img" src="{{i}}" title="{{t}}"/>',"  {{#if u}}</a>{{/if}}","  {{/if}}",'  <div class="mui-mbarp-live-msg-bubble-act-title  {{#if i===""&&d11}}mui-mbarp-live-msg-bub-title-noimg{{/if}}">','    {{#if u}}<a target="_blank" href="{{u}}" title="{{t}}">{{/if}}',"    {{title}} ","    {{#if u}}</a>{{/if}}","  </div>","</div>","</div>","</div>"].join(""));var T=new r(['<div class="mui-mbar-bubble mui-mbarp-bubble-live-shop" >','<div class="mui-mbar-arr mui-mbarp-bubble-shop-arr">\u25c6</div>','<div class="mui-mbarp-bubble-live-shop-bd">',"{danmuHtml}",'<div class="mui-mbarp-bubble-live-shop-chat"><div class="mui-mbarp-bubble-live-shop-logo"><span></span><span></span><span class="mui-mbarp-bubble-live-shop-logo-s"></span><span></span><span></span><span></span><span></span><span class="mui-mbarp-bubble-live-shop-logo-s"></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><p class="mui-mbarp-bubble-live-shop-chat-tips">{{#if n}}{{n}}\u4eba\u70ed\u804a\u4e2d{{/if}}</p><p class="mui-mbarp-bubble-live-shop-chat-p" title="{{a}}">{{a}}</p></div>','<p class="mui-mbarp-bubble-live-shop-act-more">{{t}}<span class="mui-mbarp-bubble-live-shop-left mui-mbar-iconfont">&#xe60b;&#xe60b;</span></p>','<div class="mui-mbarp-bubble-live-shop-ww" data-tribeid="{{groupId}}"></div>',"</div>","</div>"].join(""));var A=true;var C;a.extend(u,e,{init:function(){var e=this;o.getStaticConf({cb:function(i){var t=e.get(s.K.CONTAINER);var r=e.get(s.K.MALLBAR_ITEM);var n=r.get(s.K.MALLBAR);var u=r.get(s.K.TAB);var d=u.one(".mui-mbar-tab-sup");e.tip=d;var p=r.getUserInfo();var f=r.get(s.K.DATA);var v=n.get(s.K.MODEL);var h=v.get(s.K.BAR);function g(a){l.get({k:h.w.storeKey,success:function(i){if(!i){!!a&&(h.w.bubNum=a);e._showWWBubble(h.w)}else{e.tip.html('<div class="mui-mbar-iconfont mui-mbarp-live-reddot">&#xe603;</div>');e.tip.show()}},error:function(){!!a&&(allbarData.w.bubNum=a);e._showWWBubble(h.w)}})}if(h&&h.w&&h.w.id&&h.w.a){o.log("::plugin live::wwData",h.w);a.getScript(s.U.WW_MODULE,function(){if(window.TribeLight){TribeLight.openTribeWindow=function(a){window.location.href="aliim:tribevisit?tribeid="+a};TribeLight.unInstall=function(){a.use("mui/overlay/alert",function(a,e){var i=function(a){var i=new e({tip:'\u60a8\u8fd8\u672a\u5b89\u88c5\u65fa\u65fa\uff0c\u8bf7\u5148\u5b89\u88c5\u65fa\u65fa\u518d\u8fdb\u5165\u804a\u5929\u5ba4\uff01<a href="//wangwang.taobao.com/" target="_blank">\u70b9\u51fb\u4e0b\u8f7d\u65fa\u65fa</a>',skin:a,showCat:true});i.render();i.show()};i("red")})}}t.html(c);var i=true;e.isFirstShop=true;e.set("isHasChat",true);e.set("isShopLive",true);e.chatId=h.w.id||"";t.one("#mui-mbarp-live-tab-live-id").on("click",function(r){var n=a.one(r.target);t.all(".mui-mbarp-live-tab-title").removeClass("mui-mbarp-live-tab-title-clicked");n.addClass("mui-mbarp-live-tab-title-clicked");t.one(".mui-mbarp-live-tab-content-shop").hide();t.one(".mui-mbarp-live-tab-content-live").show();if(i){i=false;e._showTabLive()}});t.one("#mui-mbarp-live-tab-shop-id").on("click",function(i){var r=a.one(i.target);t.all(".mui-mbarp-live-tab-title").removeClass("mui-mbarp-live-tab-title-clicked");r.addClass("mui-mbarp-live-tab-title-clicked");t.one(".mui-mbarp-live-tab-content-live").hide();t.one(".mui-mbarp-live-tab-content-shop").show();if(e.isFirstShop){e.isFirstShop=false;e._showTabShop()}});if(h.w.a){var u=o.getSysId();e.isShop=u=="shop";r.fire(s.E.SUPTIP_CHANGE,{show:false});o.getStaticConf({cb:function(a){var i=h.w.groupInfo||"";var t=!a.groupNumLimit||a.groupNumLimit>i;e.set("groupNumOk",t);if(!a.notLiveChatBubble&&t){if(a.notDanmuMsg){!!h.w.wl&&(h.w.wl="")}h.w.storeKey="mui/mbarp/live/bubble/"+n.get("sellerId");if(m){e._showWWBubble(h.w)}else{if(a.danmuBubMax&&a.danmuBubExpire){var r=a.danmuBubMax;e.danmuBubExpire=a.danmuBubExpire;var s="mui/mbarp/live/danmu/all/num";e.danmuAllKey=s;l.get({k:s,success:function(a){if(!a){a=1;g(a)}else{a=a||0;if(a<r){a=a+1;g(a)}}},error:function(){g()}})}else{g()}}}}})}})}else{t.html(b);if(!p.isLogin||p.isLogin&&f.m>0){e._showActbubble(i)}}e.on(s.E.VISIBILITY_CHANGE,function(a){if(a.visible&&A){r.fire(s.E.SUPTIP_CHANGE,{show:false});if(e.get("isHasChat")){if(e.get("isShopLive")){t.one("#mui-mbarp-live-tab-shop-id").fire("click")}else{t.one("#mui-mbarp-live-tab-live-id").fire("click")}}else{e._showTabLive()}A=false}});e.on(s.E.DATA_CHANGE,function(a){A=true;if(r.get(s.K.EXPAND)){if(e.get("isHasChat")){if(e.get("isShopLive")){t.one("#mui-mbarp-live-tab-shop-id").fire("click")}else{t.one("#mui-mbarp-live-tab-live-id").fire("click")}}else{e._showTabLive()}}})}})},initDanmu:function(e){if(e&&e.length>0){var i=this;var t=i.get(s.K.MALLBAR_ITEM);var r='<p><img src="//assets.alicdn.com/apps/mytaobao/3.0/profile/defaultAvatar/ww-avatar-30.jpg" width="30" height="30"/><span style="margin-left: {1}px">\u201c'+"{0}"+"\u201d</span></p>";var n=['<div class="mui-mbarp-live-danmu-cont"><div class="mui-mbarp-live-danmu-box">'];a.each(e,function(a,e){n.push(o.fm(r,a))});n.push("</div></div>");return n.join("")}},_showWWBubble:function(e){var i=this;var t=i.get(s.K.MALLBAR_ITEM);var r=t.get(s.K.MALLBAR);var n=t.get(s.K.TAB);var m=t.get(s.K.BUBBLE);var u=e.bubNum||"";var c=e.a||"";!!c&&(c=c.split("|"));!!c.length&&(c=c[0].split(","));e.a=c[0];e.n=e.groupInfo||"";var b="";!!e.wl&&(e.wl=JSON.parse(e.wl));if(a.isArray(e.wl)&&e.wl.length){b=i.initDanmu(e.wl)||""}else{b=""}e.groupId=i.chatId;o.log("\u64cd\u4f5c\u7cfb\u7edf",a.UA.os);var d=a.UA.os;var p="";var f="";var v;if(b){v=160}if(d=="windows"){e.t="\u53bb\u804a\u5929\u5ba4\u770b\u66f4\u591a\u6d3b\u52a8";p=function(){o.sendLog(s.ARR.LIVE_CHAT_BUBBLE_CLICK_TO_WW);r.bubble({show:false,tab:"LIVE"});var e=a.one(".mui-mbarp-bubble-live-shop-ww").attr("data-tribeid");i._openww(e)}}else{e.t="\u67e5\u770b\u66f4\u591a\u5e97\u94fa\u6d3b\u52a8";p=function(){i.set("isShopLive",true);n.fire("click");o.sendLog(s.ARR.LIVE_CHAT_BUBBLE_CLICK_TO_LIVE)}}f=function(){if(b){i._initDanmuAnim()}};o.log("::plugin-live::\u5f39\u51fa\u5e97\u94fa\u5f39\u5e55\u6c14\u6ce1");var h=4.2;var g=o.getSysId();if(g=="detail"){h=4.2}else{h=.7}r.bubble({show:true,content:T.render(e).replace("{danmuHtml}",b),customContentType:3,flag:h,height:v,bubbleType:0,isNotTabFire:true,tab:"LIVE",showTwo:true,showed:function(){o.sendLog(s.ARR.LIVE_SHOP_CHAT_BUBBLE_SHOW);l.set({k:e.storeKey,v:1,expires:1/48});if(u&&u==1){l.set({k:i.danmuAllKey,v:1,expires:i.danmuBubExpire})}else if(u&&u>1){l.set({k:i.danmuAllKey,v:u})}!!f&&f()},clicked:function(){!!p&&p();m.html("")},dismiss:function(){m.html("")}})},_openww:function(a){if(window.TribeLight&&a){if(TribeLight.isInstalledWW()){a&&TribeLight.openTribeWindow(a)}else{TribeLight.unInstall()}}},_initDanmuAnim:function(){var e=a.one(".mui-mbarp-live-danmu-box");var i=e.one("span");var t=e.one("p");var r=e.all("p");function n(a){a.animate({"margin-left":-a.outerWidth()-15},{duration:4,complete:function(){a.hide();a.css("margin-left",0);e.append(a);a.show();n(e.one("span"))}})}function s(a){var i=a.one("span");var t=0;!!i&&(t=i.outerWidth()||"");function n(a){setTimeout(function(){a.animate({"margin-top":-a.outerHeight()},{duration:.5,complete:function(){a.hide();a.css("margin-top",0);i.css("margin-left",0);e.append(a);a.show();s(e.one("p"))}})},2e3)}if(t>140){var o=3*((t-140)/140);i.animate({"margin-left":-i.outerWidth()+140},{duration:o,complete:function(){if(r.length>1){n(a)}}})}else{if(r.length>1){n(a)}}}s(t)},_showActbubble:function(e){var i=this;var t=i.get(s.K.MALLBAR_ITEM);var r=t.get(s.K.MALLBAR);o.ajax({url:s.URL.GET_PLUGIN_LIVE_TIP,timeout:4,jsonpCallback:"__mallbarGetActiveMessage",success:function(t){if(t.s!==1||!t.t||!t.id){o.log("\u8bf7\u6c42\u6c14\u6ce1\u65f6\u670d\u52a1\u5668\u8fd4\u56de\u6709\u95ee\u9898");o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.activeMessage.failure.bad-status-"+t.s,"\u83b7\u53d6\u76f4\u64ad\u95f4\u6d3b\u52a8\u4fe1\u606f\u72b6\u6001\u5f02\u5e38");return}var n=t.id+"";l.get({k:p,success:function(m){var u=false;var c=e.liveBubMax;if(typeof m!="object"){m={};l.set({k:p,v:m})}a.each(m,function(a,e){if(e===n&&a>=c){u=true;return false}});if(u){return}t.d11=e.isLiveD11;t.title=i.toStr(t.t,10);t.u=t.u?o.addSCM(t.u,s.SCM.LIVE_BUB_LINK):"";r.bubble({show:true,content:_.render(t),customContentType:3,bubbleType:0,flag:4.3,isNotTabFire:false,tab:"LIVE",hideDelay:e.liveBubDur?e.liveBubDur*1e3:s.BUBBLE_HIDE_DELAY,showed:function(e){m=m||{};m[n]=m[n]||0;m[n]+=1;l.set({k:p,v:m});a.each(e.all("a"),function(e){a.one(e).on("click",function(a){o.sendLog(s.ARR.LIVE_BUB_LINK_CLICK);m=m||{};m[n]=c||0;l.set({k:p,v:m});a.stopPropagation()})});o.sendLog(s.ARR.LIVE_SHOW)},clicked:function(){m=m||{};m[n]=c||0;l.set({k:p,v:m});o.sendLog(s.ARR.LIVE_CLICK)},dismiss:function(){},colsedClicked:function(){o.sendLog(s.ARR.LIVE_BUBBLE_CLOSE_BOTTON_CLICK);m=m||{};m[n]=c||0;l.set({k:p,v:m})}})}})},error:function(){o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.activeMessage.get.failure","\u83b7\u53d6\u76f4\u64ad\u95f4\u6d3b\u52a8\u4fe1\u606f\u5931\u8d25");o.log("\u8bf7\u6c42\u6c14\u6ce1\u65f6\u670d\u52a1\u5668\u8d85\u65f6\u6216\u9519\u8bef")}})},_showTabLive:function(){var a=this;var e=a.get(s.K.CONTAINER);e.one(".mui-mbarp-live-tab-content-live").html(d);a._getLiveData();e.one(".mui-mbarp-live-more").on("click",function(){a._getLiveData();o.sendLog(s.ARR.FOOT_MORE_CLICK)})},_showTabShop:function(){var e='<ul class="mui-mbarp-live-shop-items">'+"{{#each itemList}}"+'<li ><a href="{{itemUrl}}" target="_blank" class="mui-mbarp-live-shop-item"><img src="{{itemPic}}_100x100" alt="{{itemTitle}}" title="{{itemTitle}}">'+"</a></li>"+"{{/each}}"+"</ul>";var i=this;var t=i.get(s.K.CONTAINER);var n=i.get(s.K.MALLBAR_ITEM);var l=n.get(s.K.MALLBAR);var m=t.one(".mui-mbarp-live-tab-content-shop");var u=n.get(s.K.BUBBLE);o.ajax({url:s.URL.GET_PLUGIN_LIVE_SHOP_INFO,jsonpCallback:"_mallbarLiveShopInfo",dataType:"jsonp",data:{groupNum:i.chatId,act:0},timeout:5,success:function(n){if(n.s!=200){m.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u597d\u50cf\u6709\u70b9\u95ee\u9898</div>');o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.shop.information.bad-status-"+n.s,"\u83b7\u53d6\u76f4\u64ad\u5e97\u94fa\u9891\u9053\u72b6\u6001\u5f02\u5e38");return}if(!n.d){m.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u6728\u6709\u83b7\u53d6\u5230</div>');return}if(!n.d.isEdited){m.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u5e97\u5bb6\u6728\u6709\u6d3b\u52a8\u54e6</div>');return}var l="";var u=i.get("groupNumOk");if(a.UA.os=="windows"&&u){l+='<div class="mui-mbarp-live-shop-tip"><a href="javascript:void(0);" data-tribeid="'+i.chatId+'">\u52a0\u5165\u5e97\u94fa\u804a\u5929\u5ba4\u5427<span class="mui-mbar-iconfont">&#xe601;</span></a></div>'}var c=n.d.adWords||"";var b="";if(c){c=c.split("|");a.each(c,function(a){var e=a.split(",");var i=e[0],t=e[1];if(i){if(t){t=o.addSCM(t,"1048.1.5.4");b+='<a class="mui-mbarp-live-shop-act-words   mui-mbarp-live-shop-act-words-underline" href="'+t+'" target="_blank">'+i+"</a>"}else{b+='<p class="mui-mbarp-live-shop-act-words " >'+i+"</p>"}}})}var d=n.d.banner||"";var p="";if(d){d=d.split("|");!!d&&d[0]&&(p+='<a class="mui-mbarp-live-shop-act-img" target="_blank" href="'+o.addSCM(d[1],"1048.1.5.5")+'"><img src="'+d[0]+'"></a>')}if(n.d.itemList){a.each(n.d.itemList,function(a){!!a&&(a.itemUrl=o.addSCM(a.itemUrl,"1048.1.5.6"))})}var f=new r(e).render(n.d);l+=b+p+f;m.html(l);if(t.one(".mui-mbarp-live-shop-tip")){t.one(".mui-mbarp-live-shop-tip").on("click",function(){o.sendLog(s.ARR.LIVE_EXPEND_TO_WW);var a=t.one(".mui-mbarp-live-shop-tip").one("a").attr("data-tribeid");i._openww(a)})}},error:function(){m.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u597d\u50cf\u6709\u70b9\u95ee\u9898</div>');o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.shop.information.get.failure","\u83b7\u53d6\u76f4\u64ad\u5e97\u94fa\u9891\u9053\u5931\u8d25")}})},_getLiveData:function(){var e=this;var i=e.get(s.K.CONTAINER);var t=i.one(".mui-mbarp-live-msgs");var r=i.one(".mui-mbarp-live-more");var n=i.one(".mui-mbarp-live-more-nomsg");var l=i.one(".mui-mbarp-live-load");var m=e.get(s.K.MALLBAR_ITEM);r.hide();l.show();o.ajax({url:s.URL.GET_PLUGIN_LIVE,data:{pageSize:10,lastId:f},timeout:4,jsonpCallback:"__mallbarReadRadiateMsg",success:function(i){l.hide();r.show();o.log("lastId",f);if(i.errorCode=="E01"){e.noMsg();return}if(i.errorCode!="E00"&&!f){e.noMsg();return}if(!i.msgs||!i.msgs.length){!f&&e.noMsg();if(f){r.hide();n.show()}return}o.getStaticConf({cb:function(r){f=i.msgs[i.msgs.length-1].id;a.each(i.msgs,function(a,i){a.d11=r.isLiveD11;var t=o.parseDate(a.date);a.date=o.fm("{0}\u6708{1}\u65e5\u7ed3\u675f",t.getMonth()+1,t.getDate());a.t=a.title;a.title=e.toStr(a.t,10);a.link="";a.src="";a.desc="";if(a.extras.pics.length>0){var n=a.extras.pics[0];a.link=n.link?o.addSCM(n.link,s.SCM.LIVE):"";a.src=n.src;a.desc=n.desc||n.t}});t.append(v.render(i));e.fixArrow(t)}})},error:function(){o.log("\u76f4\u64ad\u95f4\u6570\u636e\u8bf7\u6c42\u8d85\u65f6\u6216\u9519\u8bef");l.hide();r.show();if(!f){e.noMsg()}}})},noMsg:function(){var e=a.one(".mui-mbarp-live-tab-content-live");e.html('<h2 class="mui-mbarp-live-nomsg">\u55b5\uff01\u60a8\u6ca1\u6709\u65b0\u6d88\u606f\u54e6\uff01</h2>')},fixArrow:function(a){if(!a){return}},toStr:function(a,e){e=e||Number.MAX_VALUE;if(!a){return""}a=a.replace(/<a[^>]*?>([\w\W]+)<\/a>/gi,"");if(a.length<=e){return a}return a.substr(0,e)},dateToTips:function(a){if(!a){return"\u5df2\u7ed3\u675f"}var e=this;var i=e.get(s.K.MALLBAR_ITEM);var t=i.getServerTime();!!t&&(t=new Date(t)*1);var r=new Date(a)*1;var n="";if(t>r){return"\u5df2\u7ed3\u675f"}n=parseInt((r-t)/1e3/60/60/24)+1;return n+"\u5929\u540e\u7ed3\u675f"}});return u},{requires:["base","node","event","xtemplate","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","cookie","json","mui/mallbar/plugin-live.css"]});KISSY.add("mui/mallbar/plugin-foot",function(a,e,i,t,r,n,o,s,m,l){var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};var c="\u55b5\uff01\u770b\u8fc7\u7684\u60a8\u53ef\u80fd\u9519\u8fc7\u4e86\uff01\u8fd9\u91cc\u5e2e\u60a8\u8bb0\u5f55\u60a8\u67e5\u770b\u8fc7\u7684\u5b9d\u8d1d\u3002\u8fd9\u6b21\u522b\u518d\u9519\u8fc7\u4e86\u54e6\uff01";a.extend(u,e,{init:function(){var e=this;var i=o.ie==6||o.ie==7;var n=e.get(s.K.CONTAINER);var u=e.get(s.K.MALLBAR_ITEM);var b=u.getUserInfo();var d=s.IS_DAILY?/\/\/.*\.daily\.tmall\.net.*itemId=.*/:/\/\/detail\.tmall\.com.*(\?|\&)id=.*/;var p=10;var f=30;var v=0;var h=false;var g;var _=[];var T=false;var C=false;var A=false;var I=false;var E=7;var B=7;var L=20;var R=18;var S=96;var O=120;var N=105;var w=120;var M=["\u4eca\u5929","1\u5929\u524d","2\u5929\u524d","1\u5468\u524d"];var b=u.getUserInfo();var U=b.isLogin;var y=false;var k;var D=a.one(' <div id="J_mui-mbar-foot-dclear" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5~\u786e\u5b9a\u8981\u6e05\u7a7a\u6211\u770b\u8fc7\u7684\uff1f</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u60a8\u9489\u4f4f\u7684\u5546\u54c1\u4e0d\u4f1a\u88ab\u6e05\u7a7a</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dco" href="#">\u786e\u5b9a</a> <a class="mui-mbar-foot-dcc" href="#">\u53d6\u6d88</a> </div> </div> ');var P=a.one(' <div id="J_mui-mbar-foot-dos" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5\uff0c\u60a8\u5df2\u7ecf\u9489\u6ee1\u4e86~~</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u60a8\u6700\u591a\u53ef\u4ee5\u9489100\u4ef6\u5546\u54c1</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-doc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');var x=a.one(' <div id="J_mui-mbar-foot-dpf" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5\uff0c\u6ca1\u9489\u4e0a~~</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u8bf7\u7a0d\u540e\u518d\u8bd5\u54e6\uff1a\uff09</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dpc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');var K=a.one(' <div id="J_mui-mbar-foot-dupf" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5\uff0c\u5220\u9664\u5931\u8d25\u4e86~~</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u8bf7\u7a0d\u540e\u518d\u8bd5\u54e6\uff1a\uff09</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dupc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');var F=a.one(' <div id="J_mui-mbar-foot-dpt" class="mui-mbar-foot-dialog mui-mbar-foot-dptd"> <s class="outer-tri"></s>  <s class="shinning-pin"></s> <p class="mui-mbar-foot-dpthint">\u55b5~~\u60a8\u53ef\u4ee5\u5bf9\u91cd\u70b9\u5173\u6ce8\u7684\u5546\u54c1\u4f7f\u7528\u9489\u4f4f\uff0c\u7cfb\u7edf\u4f1a\u4e00\u76f4\u4fdd\u7559\u4f4f\u8be5\u5546\u54c1\u7684\u770b\u8fc7\u8bb0\u5f55\uff01\u9489\u4f4f\u7684\u5546\u54c1\u4e5f\u4f1a\u540c\u65f6\u52a0\u5165\u60a8\u7684\u6536\u85cf\u5939\u54e6\uff1a\uff09</p><div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dptc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');G();H();e.on(s.E.VISIBILITY_CHANGE,function(e){if(e.visible){C=true;setTimeout(function(){C=false},100);j()}if(e.first){var i=u.get(s.K.MALLBAR);n.delegate("click",".mui-mbarp-foot-favor-cancel",function(e){var t=a.one(e.currentTarget).parent(".mui-mbar-foot-hsitem");var r=t.attr("data-itemId");i._addFavor(r,e);m.sendLog(s.ARR.FOOT_ADD_FAVOR);e.halt()})}});e.on(s.E.DATA_CHANGE,function(a){m.log("Plugin",a.type);var e=u.get(s.K.EXPAND);if(e){j()}});e.on(s.E.PAGE_VISIBILITY_CHANGE,function(a){if(I){return}var e=u.get(s.K.EXPAND);if(e&&a.pageVisible&&!C){j()}});u.on(s.E.LOGIN_SUCCESS,function(){A=true});function G(){r.delegate(n,"click",".j_mui-mbar-foot-pfbtn",J)}function H(){l.get({k:"mui/mallbar/foot/historynum",success:function(a){var e;var i=window.location.href;e=a?a:[];var t=e.length;if(t>=f){return}var r;if(window.g_config&&window.g_config.itemId){r=window.g_config.itemId}if(r){var n=false;for(var o=0;o<e.length;o++){if(r==e[o]){n=true;break}}if(n){return}e.push(r);t++;if(t==p||t==f){m.log("GTE firstBubbleTipCount and Bubble it");u.fire(s.E.BUBBLE_CHANGE,{show:true,customContentType:1,bubbleType:0,isNotTabFire:false,html:"\u55b5\uff0c\u60a8\u770b\u8fc7\u7684\u5546\u54c1\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u54e6\uff1a\uff09",showed:function(){m.sendLog(s.ARR.FOOT_BUBBLE)},clicked:function(){m.sendLog(s.ARR.FOOT_BUBBLE_CLICK)}})}l.set({k:"mui/mallbar/foot/historynum",v:e,success:function(){}})}}})}function j(){n.html('<div id="J_MuiMbarHistoryBd" class="mui-mbar-foot-hisbd"><div class="mui-mbar-foot-hmask"></div></div><div id="J_MuiMbarPinBd" class="mui-mbar-foot-pinbd j_mui-mbar-foot-pinbd"></div>');a.one("#J_MuiMbarHistoryBd").parent(".mui-mbar-plugin-bd").css({overflow:"hidden",width:"235px"});m.noScroll(a.one("#J_MuiMbarHistoryBd"));m.log("Foot Visible");l.get({k:"mui/mallbar/foot/blacklist",success:function(a){if(a){_=a}V()}})}function X(){var e=a.one("#J_MuiMbarHistoryBd");var i=e.parent(".mui-mbar-plugin-bd").height();var t=a.one("#J_MuiMbarPinBd").height();e.height(i-t)}function V(){v=0;b=u.getUserInfo();m.log("updateContent",+new Date);new t({url:s.URL.GET_PLUGIN_FOOT_ITEMS,dataType:"jsonp",scriptCharset:"gbk",jsonpCallback:"__mallbarFootGetHistory",data:{type:1,t:+new Date},timeout:5,success:Z,error:function(){m.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.foot.footGetHistory.get.failure","\u83b7\u53d6\u6211\u7684\u8db3\u8ff9\u5386\u53f2\u5931\u8d25");u.fire(s.E.ERROR)}});new t({dataType:"jsonp",scriptCharset:"gbk",url:s.URL.GET_PLUGIN_FOOT_ITEMS2,jsonpCallback:"__mallbarFootGetPins",data:{type:2,t:+new Date},timeout:5,success:z,error:function(){m.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.foot.footGetPins.get.failure","\u83b7\u53d6\u6211\u7684\u8db3\u8ff9Pins\u5931\u8d25");u.fire(s.E.ERROR)}})}function Y(){var e='<a class="mui-mbar-foot-punfold j_mui-mbar-foot-pfbtn" href="#"></a>'+'<div class="mui-mbar-foot-pins j_mui-mbar-foot-pins">'+'<div class="mui-mbar-foot-plogin">'+'  <div class="mui-mbar-foot-phead" style="display:none">'+'    <div class="mui-mbar-foot-pstat">'+'      <p>\u6211\u9489\u4f4f\u7684 <span class="mui-mbar-foot-pstatn">0</span> \u4ef6</p>'+"      <s></s>"+"    </div>"+'    <div class="mui-mbar-foot-phint">'+'      <s class="outer-tri"></s>'+'      <a class="hint-close"  href="#"></a>'+"      <p>\u5feb\u6ee1\u4e86\uff0c\u60a8\u6700\u591a\u53ef\u4ee5\u9489100\u4ef6\u5546\u54c1\uff01</p>"+"    </div>"+"  </div>"+'  <div class="mui-mbar-foot-plhint">'+"  </div>"+'  <a href="#" class="mui-mbar-foot-plbtn">\u70b9\u51fb\u767b\u5f55</a>'+"</div>"+"</div>";a.one("#J_MuiMbarPinBd").html(e);var t=a.one(".mui-mbar-foot-hsitem");if(!(t&&t.length>0)){if(!i){a.one("#J_MuiMbarPinBd").css({height:0});T=true}}a.one(".mui-mbar-foot-plbtn").on("click",function(a){a.preventDefault();return u.fire(s.E.LOGIN,{success:function(){j()}})})}function W(){l.get({k:"mui/mallbar/foot/first",success:function(a){if(a){return}else{$(4)}}})}function z(e){m.log("::foot refreshPins::",e,+new Date);if(e.s&&e.s==-2){U=false;Y();X();return}U=true;var t=e["l"];var r=e["c"]?e["c"]:0;var n='<a class="mui-mbar-foot-punfold j_mui-mbar-foot-pfbtn" href="#"></a>'+'<div class="mui-mbar-foot-pins j_mui-mbar-foot-pins">'+'  <div class="mui-mbar-foot-phead">'+'    <div class="mui-mbar-foot-pstat">'+'      <p>\u6211\u9489\u4f4f\u7684 <span class="mui-mbar-foot-pstatn">'+r+"</span> \u4ef6</p>"+"      <s></s>"+"    </div>"+'    <div class="mui-mbar-foot-phint">'+'      <s class="outer-tri"></s>'+'      <a class="hint-close"  href="#"></a>'+"      <p>\u5feb\u6ee1\u4e86\uff0c\u60a8\u6700\u591a\u53ef\u4ee5\u9489100\u4ef6\u5546\u54c1\uff01</p>"+"    </div>"+"  </div>";if(t&&t.length>0){T=false;var o=t.length;var s=Math.ceil(o/2)*w;s=i?116:s;var l='<div class="mui-mbar-foot-pslist j_mui-mbar-foot-pslist" style="height:'+s+'px;">';for(var u=0;u<t.length;u++){var c=t[u];var b=Math.floor(u/2);var d=u%2;var p=d==0?100:99;var f=R+b*w;var v=L+d*N;var h=c.url.split("?");var g=h[0];var _=h[1];var C="";if(!_){C=g+"?acm=03200.1003.1.1&scm=1048.1.6.3"}else{var A=a.unparam(_);A.acm="03200.1003.1.1";A.scm="1048.1.6.3";var I=a.param(A);C=g+"?"+I}l+='<div class="mui-mbar-foot-psitem j_mui-mbar-foot-psitem" style="top:'+f+"px;left:"+v+"px;z-index:"+p+';" data-itemid="'+c.itemId+'">'+'  <a class="mui-mbar-foot-psilink" target="_blank" href="'+C+'"><img src="'+c.img+'_90x90.jpg" alt="'+c.desc+'" width="90" height="90" /></a>'+'  <a target="_blank" href="'+C+'" class="mui-mbar-foot-pprice">\uffe5'+c.price+"</a>"+'  <s class="mui-mbar-foot-ppin j_mui-mbar-foot-ppin" title="\u5220\u9664"></s>'+'  <div class="mui-mbar-foot-pdesc">'+'    <a href="'+C+'" target="_blank">'+c.desc+"</a>"+"  </div>"+"</div>"}l+="</div>";pinHintHtml='<div class="mui-mbar-foot-pinhint"></div>';n+=l+pinHintHtml+"</div>";a.one("#J_MuiMbarPinBd").append(n);a.all(".j_mui-mbar-foot-ppin").on("click",q)}else{W();var l='<div class="mui-mbar-foot-pslist j_mui-mbar-foot-pslist"></div>';pinHintHtml='<div class="mui-mbar-foot-pinohint"></div>';n+=l+pinHintHtml+"</div>";a.one("#J_MuiMbarPinBd").append(n);if(!i){a.one("#J_MuiMbarPinBd").css({height:0});T=true}a.one(".mui-mbar-foot-pstatn").html("0");a.one(".mui-mbar-foot-pslist").css({height:0})}X();m.noScroll(a.one(".mui-mbar-foot-pins"))}function J(e){e.preventDefault();if(A){I=true;A=false}else{I=false}m.log("Unfold Pins");m.log(e);var t=a.one(e.target);var r=a.one(e.target).parent(".mui-mbar-plugin-bd").height();var n=a.one(".mui-mbar-foot-pins").height();var o=a.one(".mui-mbar-foot-phead").height();var s=a.one("#J_MuiMbarHistoryBd");if(t.hasClass("mui-mbar-foot-pfold")){var l=n>156?156:n;var u=T?r:r-o-19-l;s.height(u);t.removeClass("mui-mbar-foot-pfold");t.addClass("mui-mbar-foot-punfold");if(T){a.one("#J_MuiMbarPinBd").animate({height:0},.3,"easeOut",function(){X()})}else{a.one("#J_MuiMbarPinBd").removeAttr("style");a.one(".mui-mbar-foot-pins").animate({height:l},.3,"easeOut",function(){X()});s.one(".mui-mbar-foot-hmask").css({height:0,display:"none"});a.one(".mui-mbar-foot-hisbd").css({overflow:"auto"})}if(i){var c=a.one(".mui-mbar-foot-pslist");c.css({height:116})}}else{t.removeClass("mui-mbar-foot-punfold");t.addClass("mui-mbar-foot-pfold");var b=r-134;if(T){a.one("#J_MuiMbarPinBd").animate({height:156},.3,"easeOut",function(){X()})}else{a.one("#J_MuiMbarPinBd").removeAttr("style");a.one(".mui-mbar-foot-pins").animate({height:b},.3,"easeOut",function(){X()});if(i){var c=a.one(".mui-mbar-foot-pslist");var d=c.all(".mui-mbar-foot-psitem").length;var p=Math.ceil(d/2);var f=p*w;var v=b-94;f=f<v?f:v;c.css({height:f})}s.one(".mui-mbar-foot-hmask").css({height:2e4,display:"block"});a.one(".mui-mbar-foot-hisbd").css({overflow:"hidden"})}}}function q(e){m.sendLog(s.ARR.FOOT_UNPIN_ITEM);e.preventDefault();var n=e.target;r.detach(e.target,"click");var o=a.one(e.target).parent(".j_mui-mbar-foot-psitem");var l=o.attr("data-itemid");new t({dataType:"jsonp",scriptCharset:"gbk",jsonpCallback:"__mallbarFootUnpinItem",url:s.URL.GET_PLUGIN_FOOT_PINITEM,data:{_tb_token_:g,pin:0,itemId:l,t:+new Date},timeout:5,success:function(e){g=e.t;if(e.s==-2){return u.fire(s.E.LOGIN)}if(e.s==-1){a.one(n).on("click",q);$(3);return}m.log("Unpin Successful");var t=a.one(o.parent(".mui-mbar-foot-pslist"));var r=o.parent(".mui-mbar-foot-pslist").all(".mui-mbar-foot-psitem");var l=r.length;var c=0;while(c<r.length){if(o[0]==r[c])break;c++}var b=parseInt(o.css("left"));var d=parseInt(o.css("top"));for(var p=c+1;p<r.length;p++){var f=a.one(r[p]);var v=parseInt(f.css("left"));var h=parseInt(f.css("top"));if(i){f.css({left:b,top:d})}else{f.animate({left:b,top:d},.5,"easeOut",function(){var a=f;var e=a.css("z-index");e=e==100?99:100;a.css({"z-index":e})})}b=v;d=h}var _=l-1;var T=Math.ceil(_/2);var C=T*w;if(!i){t.animate({height:C},.5,"easeOut")}var A=a.one(".mui-mbar-foot-pstatn");if(A&&A.length>0){var I=parseInt(A.html());var E=I-1;A.html(E)}if(i){o.remove()}else{o.fadeOut(.3,function(){o.remove()})}},error:function(){a.one(n).on("click",q);$(3)}})}function Z(e){m.log("::foot refreshHistory::",+new Date);g=e.t;m.log(e);if(e.s==-2){return u.fire(s.E.LOGIN)}var t=e["c"];var n=e["l"];if(n&&n.length>0){var o='  <div class="mui-mbar-foot-hhead">'+'    <p class="mui-mbar-foot-hstat j_mui-mbar-foot-hstat" href="#"><span class="mui-mbar-foot-hstatn">{{HITEMCOUNT}}</span>\u4ef6\u5546\u54c1</p>'+'    <a class="j_mui-mbar-foot-hclear mui-mbar-foot-hclear" href="#">\u6e05\u7a7a</a>'+"  </div>"+'<div class="mui-mbar-foot-history j_mui-mbar-foot-history">';for(var l=0;l<n.length;l++){category=n[l];o+=re(category)}o+="</div>";o=o.replace("{{HITEMCOUNT}}",v);if(v==0){a.one("#J_MuiMbarHistoryBd").prepend(m.fm('<div class="mui-mbar-foot-nohis"></div><p class="mui-mbar-foot-nohhint">{0}</p><div class="mui-mbar-foot-hmask"></div>',c));return}else{a.one("#J_MuiMbarHistoryBd").prepend(o)}a.all(".j_mui-mbar-foot-hpin").on("click",ae);a.all(".j_mui-mbar-foot-hclose").on("click",function(e){m.sendLog(s.ARR.FOOT_DELETE_ITEM);e.preventDefault();r.detach(e.target,"click");var i=a.one(e.target).parent(".j_mui-mbar-foot-hsitem");var t=i.attr("data-itemid");ie(t);te(e)});a.one(".j_mui-mbar-foot-hclear").on("click",function(a){a.preventDefault();$(0)});if(i){a.all(".mui-mbar-foot-hsitem").on("mouseover",function(e){var i=a.one(this);i.one(".mui-mbar-foot-hsibg").show();i.one(".mui-mbar-foot-hpin").show();i.one(".mui-mbar-foot-hclose").show()});a.all(".mui-mbar-foot-hsitem").on("mouseout",function(e){var i=a.one(this);i.one(".mui-mbar-foot-hsibg").hide();i.one(".mui-mbar-foot-hpin").hide();i.one(".mui-mbar-foot-hclose").hide()})}m.noScroll(a.one(".mui-mbar-foot-hisbd"))}else{a.one("#J_MuiMbarHistoryBd").prepend(m.fm('<div class="mui-mbar-foot-nohis"></div><p class="mui-mbar-foot-nohhint">{0}</p><div class="mui-mbar-foot-hmask"></div>',c))}}function Q(){m.sendLog(s.ARR.FOOT_CLEAR_HISTORY);m.log("Clear All Items");var e=[];var i=a.all(".mui-mbar-foot-hsitem");for(var t=0;t<i.length;t++){e.push(a.one(i[t]).attr("data-itemid"))}ie(e);var r=a.one("#J_MuiMbarHistoryBd").children();r.fadeOut(1,function(){r.remove();a.one("#J_MuiMbarHistoryBd").prepend(m.fm('<div class="mui-mbar-foot-nohis" style="display:none;"> </div><p class="mui-mbar-foot-nohhint" style="display:none">{0}</p><div class="mui-mbar-foot-hmask"></div>',c));a.one(".mui-mbar-foot-nohis").fadeIn(.5);a.one(".mui-mbar-foot-nohhint").fadeIn(.5)})}function $(e){if(e===undefined)return;if(e==0){var i=a.one(".mui-mbar-plugin-foot");var t=i.one("#J_mui-mbar-foot-dclear");if(t&&t.length>0){t.show();return}i.append(D);var t=i.one("#J_mui-mbar-foot-dclear");t.show();t.one(".mui-mbar-foot-dco").on("click",function(e){e.preventDefault();Q();u=a.one(".mui-mbar-foot-mask");u&&u.hide();t.hide()});t.one(".mui-mbar-foot-dcc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();t.hide()})}else if(e==1){var i=a.one(".mui-mbar-plugin-foot");var r=i.one("#J_mui-mbar-foot-dos");if(r&&r.length>0){r.show();return}i.append(P);var r=i.one("#J_mui-mbar-foot-dos");r.show();r.one(".mui-mbar-foot-doc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();r.hide()})}else if(e==2){var i=a.one(".mui-mbar-plugin-foot");var n=i.one("#J_mui-mbar-foot-dpf");if(n&&n.length>0){n.show();return}i.append(x);var n=i.one("#J_mui-mbar-foot-dpf");n.show();n.one(".mui-mbar-foot-dpc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();n.hide()})}else if(e==3){var i=a.one(".mui-mbar-plugin-foot");var o=i.one("#J_mui-mbar-foot-dupf");if(o&&o.length>0){o.show();return}i.append(K);var o=i.one("#J_mui-mbar-foot-dupf");o.show();o.one(".mui-mbar-foot-dupc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();o.hide()})}else if(e==4){var s=a.one(".mui-mbar-foot-hsitem");if(s&&s.length>0){var i=a.one(".mui-mbar-plugin-foot");var m=i.one("#J_mui-mbar-foot-dpt");if(m&&m.length>0){m.show();return}i.append(F);var m=i.one("#J_mui-mbar-foot-dpt");m.show();s.one(".mui-mbar-foot-hsibg").show();s.one(".mui-mbar-foot-hpin").show();s.one(".mui-mbar-foot-hclose").show();m.one(".mui-mbar-foot-dptc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();m.hide();s.one(".mui-mbar-foot-hsibg").attr("style","");s.one(".mui-mbar-foot-hpin").attr("style","");s.one(".mui-mbar-foot-hclose").attr("style","");l.set({k:"mui/mallbar/foot/first",v:1,success:function(){}})})}else{return}}var i=a.one(".mui-mbar-plugin-foot");var u=i.one(".mui-mbar-foot-mask");if(!u||u.length<=0){i.append('<div class="mui-mbar-foot-mask"></div>');var u=i.one(".mui-mbar-foot-mask")}u.css({height:i.height()});u.show()}function ae(e){m.sendLog(s.ARR.FOOT_PIN_ITEM);e.preventDefault();if(h)return;var i=e.target;r.detach(e.target,"click");m.log("Pin Item");m.log(e.target);var n=a.one(e.target).parent(".mui-mbar-foot-hsitem");var o=n.attr("data-itemid");new t({url:s.URL.GET_PLUGIN_FOOT_PINITEM,scriptCharset:"gbk",jsonpCallback:"__mallbarFootPinItem",data:{_tb_token_:g,pin:1,itemId:o,t:+new Date},dataType:"jsonp",timeout:5,success:function(t){g=t.t;if(t.s==-2){return u.fire(s.E.LOGIN)}if(t.s==-1){a.one(i).on("click",ae);m.log("Pin Fail");$(2);return}if(!U){j();return}h=true;var r=a.one("#J_MuiMbarPinBd");r.show();m.log("Pin Successful");var l=n.offset();var c=a.one(".mui-mbar-foot-pslist");var b=c.offset();var d=l.top-a.one(window).scrollTop();var p=l.left-a.one(".mui-mbar").offset().left-a.one(window).scrollLeft()-35;var f=99999999999999;var v=n.one("img").attr("src");var _=n.one(".mui-mbar-foot-hdtxt").html();var C=n.children(".mui-mbar-foot-hprice").html();var A=n.one(".mui-mbar-foot-hprice").attr("href");var I=A.split("?");var E=I[0];var B=I[1];var S="";if(!B){S=E+"?acm=03200.1003.1.1&scm=1048.1.6.3"}else{var O=a.unparam(B);O.acm="03200.1003.1.1";O.scm="1048.1.6.3";var N=a.param(O);S=E+"?"+N}var w='<div class="mui-mbar-foot-psia mui-mbar-foot-psitem j_mui-mbar-foot-psitem" style="top:'+d+"px;left:"+p+"px;z-index:"+f+';" data-itemid="'+o+'">'+'  <a class="mui-mbar-foot-psilink" target="_blank" href="'+S+'"><img src="'+v+'" alt="'+_+'" width="90" height="90" /></a>'+'  <a target="_blank" href="'+S+'" class="mui-mbar-foot-pprice" style="display:none;">'+C+"</a>"+'  <s class="mui-mbar-foot-ppin j_mui-mbar-foot-ppin" title="\u5220\u9664" style="display:none;"></s>'+'  <div class="mui-mbar-foot-pdesc">'+'    <a target="_blank" href="'+S+'">'+_+"</a>"+"  </div>"+"</div>";if(T){if(a.one("#J_MuiMbarPinBd").height()==0){a.one("#J_MuiMbarPinBd").animate({height:156},.3,"easeOut",function(){X()});b.top-=156}else{var M=a.one(".j_mui-mbar-foot-pfbtn");M.removeClass("mui-mbar-foot-pfold");M.addClass("mui-mbar-foot-punfold")}}T=false;a.one(".mui-mbar-plugin-foot").prepend(w);var y=a.one(".mui-mbar-foot-psia");y.one(".j_mui-mbar-foot-ppin").on("click",q);m.log("aniItem width:"+y.width()+" height: "+y.height());y.animate({left:p+20,top:d-20},.5,"easeIn",function(){y.animate({left:b.left-a.one(".mui-mbar").offset().left+L-a.one(window).scrollLeft()-35,top:b.top+R-a.one(window).scrollTop()},1,"easeIn",function(){c.prepend(y);y.one(".mui-mbar-foot-ppin").fadeIn(.5);y.one(".mui-mbar-foot-pprice").fadeIn(.5);h=false;y.removeClass("mui-mbar-foot-psia");y.css({left:L,top:R,"z-index":100})})});ee();n.fadeOut(1.5);setTimeout(function(){te(e)},1500);var k=a.one(".mui-mbar-foot-pstatn");if(k&&k.length>0){var D=parseInt(k.html());var P=D+1;k.html(P)}var x=a.one(".mui-mbar-foot-pinhint");if(x){x.removeClass(".mui-mbar-foot-pinhint");x.addClass(".mui-mbar-foot-pinohint")}},error:function(){a.one(i).on("click",ae);m.log("Pin Fail");$(2)}})}function ee(){var e=a.one(".mui-mbar-foot-pslist");var t=e.all(".mui-mbar-foot-psitem");var r=t.length;var n=Math.floor(r/2);var o=r%2;var s=w*(n+1);if(!i){e.height(s)}if(t&&t.length>0){var m=L+o*N;var l=R+n*w;for(var u=r-1;u>=0;u--){var c=a.one(t[u]);c.animate({left:m,top:l},.5,"easeOut",function(){var a=c;var e=a.css("z-index");e=e==100?99:100;a.css({"z-index":e})});m=parseInt(c.css("left"));l=parseInt(c.css("top"))}}else{var s=w*(n+1)}}function ie(a){l.get({k:"mui/mallbar/foot/blacklist",success:function(e){if(!e){var i;if(typeof a=="object"&&a instanceof Array){i=a}else{i=[a]}l.set({k:"mui/mallbar/foot/blacklist",v:i,success:function(a){m.log("New mbar_plugin_foot_storage")}})}else{var i;if(typeof a=="object"&&a instanceof Array){i=e.concat(a)}else{e.push(a);i=e}l.set({k:"mui/mallbar/foot/blacklist",v:i,success:function(a){m.log("Update foot/blacklist")}})}}})}function te(e){m.log("Delete Item");m.log(e.target);var t=a.one(e.target).parent(".mui-mbar-foot-hsitem");var r=t.attr("data-itemid");var n=a.one(t.parent(".mui-mbar-foot-hslist"));var o=t.parent(".mui-mbar-foot-hslist").children(".mui-mbar-foot-hsitem");var s=o.length;var l=0;while(l<s){if(t[0]==o[l])break;l++}var u=parseInt(t.css("left"));var c=parseInt(t.css("top"));for(var b=l+1;b<o.length;b++){var d=a.one(o[b]);var p=parseInt(d.css("left"));var f=parseInt(d.css("top"));if(i){d.css({left:u,top:c})}else{d.animate({left:u,top:c},.5,"easeOut",function(){var a=d;var e=a.css("z-index");e=e==100?99:100;a.css({"z-index":e})})}u=p;c=f}var v=a.one(".mui-mbar-foot-hstatn");if(v&&v.length>0){var h=parseInt(v.html());var g=h-1;v.html(g)}if(s==1){var _=t.parent(".mui-mbar-foot-hsection");var T=_;var C=a.all(".mui-mbar-foot-hsection");if(C&&C.length==1){var A=a.one("#J_MuiMbarHistoryBd").children();T=A}T&&T.fadeOut(1,function(){T.remove();var e=a.all(".mui-mbar-foot-hsection");if(e&&e.length>0)return;var i=a.one("#J_MuiMbarHistoryBd").prepend('<div class="mui-mbar-foot-nohis" style="display:none;"></div><p class="mui-mbar-foot-nohhint" style="display:none">\u55b5\uff01\u770b\u8fc7\u7684\u60a8\u53ef\u80fd\u9519\u8fc7\u4e86\uff01\u8fd9\u91cc\u5e2e\u60a8\u8bb0\u5f55\u60a8\u67e5\u770b\u8fc7\u7684\u5b9d\u8d1d\u3002\u8fd9\u6b21\u522b\u518d\u9519\u8fc7\u4e86\u54e6\uff01</p><div class="mui-mbar-foot-hmask"></div>');a.one(".mui-mbar-foot-nohis").fadeIn(.5);a.one(".mui-mbar-foot-nohhint").fadeIn(.5)});return}var I=s-1;var E=Math.ceil(I/2);var B=E*O;if(i){n.height(B)}else{n.animate({height:B},.5,"easeOut")}if(i){t.remove()}else{t.fadeOut(.3,function(){t.remove()})}}function re(e){var i=M[e.n];var t=e.d;var r=t.length;var n='<div class="mui-mbar-foot-hsection">'+'  <div class="mui-mbar-foot-hstitle">'+"    <p>"+i+"</p>"+"    <s></s>"+"  </div>"+'<div class="mui-mbar-foot-hslist j_mui-mbar-foot-hslist" style="height:{{LISTHEIGHT}}px;">';var o=0;for(var s=0;s<r;s++){var m=t[s];var l=false;for(var u=0;u<_.length;u++){if(""+m.itemId==_[u]){l=true;break}}if(l){continue}var c=Math.floor(o/2);var b=o%2;var d=b==0?100:99;var p=B+c*O;var f=E+b*S;var h=m.url.split("?");var g=h[0];var T=h[1];var C="";if(!T){C=g+"?acm=03200.1003.1.1&scm=1003.3.03200.0"}else{var A=a.unparam(T);A.acm="03200.1003.1.1";A.scm="1003.3.03200.0";var I=a.param(A);C=g+"?"+I}n+='<div class="mui-mbar-foot-hsitem j_mui-mbar-foot-hsitem" style="top:'+p+"px;left:"+f+"px;z-index:"+d+';" data-itemid="'+m.itemId+'">'+'<div class="mui-mbar-foot-hsibg"></div>'+'  <a class="mui-mbar-foot-hsilink" href="'+C+'" target="_blank"><img src="'+m.img+'_90x90.jpg" alt="'+m.desc+'" width="90" height="90"/></a>'+'  <a href="'+C+'" target="_blank" class="mui-mbar-foot-hprice">\uffe5'+m.price+"</a>"+'  <s class="mui-mbar-foot-hpin mui-mbarp-foot-favor-cancel" title="\u52a0\u5165\u6536\u85cf"></s>'+'  <s class="mui-mbar-foot-hclose j_mui-mbar-foot-hclose" title="\u5220\u9664\u8bb0\u5f55"></s>'+'  <div class="mui-mbar-foot-hdesc">'+'    <a href="'+C+'" target="_blank" class="mui-mbar-foot-hdtxt">'+m.desc+"</a>"+"  </div>"+"</div>";v++;o++}if(o==0){return""}n+="</div></div>";var L=Math.ceil(o/2)*O;n=n.replace("{{LISTHEIGHT}}",+L);return n}}});return u},{requires:["base","node","ajax","event","anim","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-foot.css"]});KISSY.add("mui/mallbar/plugin-top",function(a,e,i,t,r,o,n){var s=function(a){var e=this;s.superclass.constructor.call(e,a);e.init()};a.extend(s,e,{init:function(){var e=this;var i=e.get(r.K.MALLBAR_ITEM);var t=i.get(r.K.TAB);var n=a.one(window);n.on("scroll",a.buffer(function(a){var e=n.scrollTop();e>0?t.fadeIn(.2):t.fadeOut(.1)},100));n.fire("scroll");t.on("click",function(){o.log("top click");o.sendLog(r.ARR.BACKTOP_CLICK);s(0,0,300,"ease")});function s(e,i,t,r){if(!t){window.scrollTo(e,i)}else{a.one(window).animate({scrollLeft:e,scrollTop:i},t/1e3,r)}}}});return s},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-top.css"]});KISSY.add("mui/mallbar/plugin-ue",function(a,e,i,t,r,o,n){var s=function(a){var e=this;s.superclass.constructor.call(e,a);e.init()};a.extend(s,e,{init:function(){var e=this;var i=e.get(r.K.MALLBAR_ITEM);var t=i.get(r.K.TAB);var o="http://ur.taobao.com/survey/view.htm?id=";var n=i.getGConfig();if(n.ueId||n.ueUrl){if(n.ueUrl){o=n.ueUrl}else{o=o+n.ueId}a.one(".mui-mbar-tab-ue").show();a.all("<style>.mui-mbar .mui-mbar-tab-ue {display:block}</style>").appendTo("head");var s=t.one(".mui-mbar-tab-logo-ue");s.append('<a style="display:block;width: 35px;height: 35px;overflow: hidden;text-indent: -40px" href="'+o+'">UE</a>');var l=t.one(".mui-mbar-tab-tip");l.html('<a target="_blank" style="color:#fff;" href="'+o+'">\u7528\u6237\u53cd\u9988</a>')}}});return s},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-ue.css"]});KISSY.add("mui/mallbar/plugin-qrcode",function(a,e,i,t,r,o,n,s,l,m){var u="//gcodex.alicdn.com/web/doTransit.do?url=";var c="tmall://mobile.tmall.com/page/home";var b="//img.alicdn.com/tfscom/TB1W7rRIXXXXXbEXXXXwu0bFXXX.png";var d="http://m.laiwang.com/market/laiwang/tmall/app-download.php";var p=new m(['<div class="mui-mbarp-qrcode-tip">','   <div class="mui-mbarp-qrcode-hd mui-mbarp-qrcode-hd-d">','       <img src="'+b+'" />',"   </div>",'   <div class="mui-mbarp-qrcode-bd ">','       <img src="{{qrcodeDesc}}" />',"   </div>","</div>",'<div class="mui-mbar-arr mui-mbarp-qrcode-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-qrcode-bubble-close"></div>'].join(""));var f=['<div class="mui-mbar-bubble mui-mbarp-bubble-qrcode-cross" >','<div class="mui-mbar-arr mui-mbarp-bubble-cross-arr">\u25c6</div>',"</div>"].join("");var v=function(a){var e=this;v.superclass.constructor.call(e,a);e.init()};a.extend(v,e,{init:function(){var e=this;var t=e.mallbarItem=e.get(n.K.MALLBAR_ITEM);var r=t.get(n.K.MALLBAR);var o=r.get(n.K.ROOT);var m=t.getUserInfo();var c=t.get(n.K.TAB);var b=a.all('<div class="mui-mbarp-qrcode"></div>').appendTo(o);e.renderTpl=false;e.qrcodeSrc="";var v=s.getSysId();e.isDetail=v=="detail";e.isList=v=="list";e.isShop=v=="shop";e.isHalfSale=window.g_config.is1111HalfPriceItem;if(e.isDetail||e.isList||e.isShop){e.renderTpl=true}var g=m.memberInfo.activeStatus||"";var h=m.isLogin;var _=false;s.getStaticConf({cb:function(i){e.needCrossBubble=i.needCrossBubble||"";var t=i.primeStartTime||"";var o=i.primeEndTime||"";var l=r.get(n.K.MODEL).get(n.K.TIMESTAMP);e.qrcodeDesc=i.qrcodeDesc||"//img.alicdn.com/tps/i4/TB1f8SzHVXXXXaDXVXXbgvdFFXX-145-30.png";if(h){var m=a.Env.mods;if(!m["mui/mobilecross"]){var u=i.mobilecrossVersion||"1.0.1";a.config({modules:{"mui/mobilecross":{path:"//g.alicdn.com/mui/mobilecross/"+u+"/mobilecross.js"},"mui/mobilecross/mobilecross.css":{path:"//g.alicdn.com/mui/mobilecross/"+u+"/mobilecross.css"}}})}r.getCueMsgInfo(function(a){if(a.s!=200){s.codeTracker.sendTrack(n.T.NUMLEV,"mallbar.qrcode.cueAssetMsg.failure.bad-status-"+a.s,"\u83b7\u53d6\u6c14\u6ce1\u63a5\u53e3\u51fa\u9519");B();return}if(a.co&&a.co.pr){if(l>=t||_){C()}else{B()}}else{if(a.co&&(a.co.n||a.co.f)){T(a.co)}else{B()}}})}else{B()}}});function T(a){var e=['<div class="mui-mbar-bubble mui-mbarp-qrcode-bubble mui-mbarp-qrcode-bubble-{0}">','<div class="mui-mbar-arr mui-mbarp-qrcode-bubble-arr mui-mbarp-qrcode-bubble-arr-red">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-qrcode-bubble-close"></div>',"{1}","</div>"].join("");if(a.n){I(e,a)}else if(a.f){A(e,a)}else{B()}}function I(e,i){var i=i||{};var r={};r.html=s.fm(e,"new","");r.clicked=function(){s.sendLog(n.ARR.QRCODE_BUBBLE_NEW_QRCODE_CLICK);a.use("mui/mobilecross",function(a,e){var i=t.get("bubble");!!e&&e.cross({params:{url:"http://vip.tmall.com/mobile/home/mainPage.htm"},itemImg:"//img.alicdn.com/tps/i3/TB1RZ2.HXXXXXXWXVXXhoVtWXXX-175-176.png",relEl:i,resource:16,text:"\u55b5~\u6536\u523010\u5143\u65b0\u4eba\u4f18\u60e0\u5238\uff08\u5929\u732b\u8d85\u5e02\uff09\u4e00\u679a\uff0c\u70b9\u51fb\u83b7\u53d6\uff01",type:"link",tips:"\u55b5~\u65b0\u4eba\u4f18\u60e0\u5238\u5df2\u7ecf\u98de\u5411\u60a8\u7684\u624b\u673a\uff0c\u5feb\u53bb\u67e5\u770b\u5427\uff01",mmstat:"vip_ticket",token:TB.userInfo.tbToken||"",success:function(){}})})};r.showed=function(){s.sendLog(n.ARR.QRCODE_BUBBLE_NEW_QRCODE_SHOW)};E(r)}function A(e,i){var r={};r.html=s.fm(e,"lottery",'<p class="mui-mbarp-qrcode-bubble-tips">\u4f60\u8fd8\u6709<span>'+i.f+"</span>\u5c40\u62bd\u5956\u673a\u4f1a</p>");r.clicked=function(){s.sendLog(n.ARR.QRCODE_BUBBLE_OLD_QRCODE_CLICK);a.use("mui/mobilecross",function(a,e){var r=t.get("bubble");!!e&&e.cross({params:{url:"http://chaoshi.tmall.com/wap/oclottery/oclottery.htm"},itemImg:"//img.alicdn.com/tps/i2/TB1kqf9HXXXXXaAXVXXhoVtWXXX-175-176.png",relEl:r,resource:17,text:"\u55b5~\u4e3b\u4eba\u8fd8\u6709"+i.f+"\u5c40\u7ffb\u724c\u62bd\u5956\u672a\u4f7f\u7528\uff0c\u8d76\u7d27\u4f7f\u7528100%\u4e2d\u5956\uff01",type:"link",tips:"\u55b5~\u7a7f\u8d8a\u6210\u529f\uff01\u53ef\u4ee5\u6109\u5feb\u7684\u53bb\u624b\u673a\u62bd\u5956\u4e86\uff0c100%\u4e2d\u5956\u54df\uff01",token:TB.userInfo.tbToken||"",mmstat:"vip_lottery",success:function(){}})})};r.showed=function(){s.sendLog(n.ARR.QRCODE_BUBBLE_OLD_QRCODE_SHOW)};E(r)}function C(){var e="";if(window.g_config&&window.g_config.itemId){e=window.g_config.itemId}var i=['<div class="mui-mbar-bubble mui-mbarp-qrcode-bubble mui-mbarp-qrcode-bubble-2">','<div class="mui-mbar-arr mui-mbarp-qrcode-bubble-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-qrcode-bubble-close"></div>',"</div>"].join("");var o={};if(m.isLogin){o.html=i;o.height=175;o.clicked=function(){s.sendLog(n.ARR.QRCODE_BUBBLE_TUSER_QRCODE_CLICK);a.use("mui/mobilecross",function(a,e){var i=t.get("bubble");var o=a.DOM.attr(a.one("#J_ImgBooth"),"src");!!e&&e.cross({params:{itemId:r.get("itemId")},itemImg:o,relEl:i,resource:13,text:"\u55b5~\u6536\u5230\u7a7f\u8d8a\u800c\u6765\u7684\u5b9d\u8d1d\u4e00\u679a\uff0c\u624b\u673a\u4e0b\u5355\uff0c\u4e13\u4eab\u552e\u540e\u65e0\u5fe7\uff01",type:"item",tips:"\u55b5~\u5b9d\u8d1d\u5df2\u7a7f\u8d8a\uff0c\u4f7f\u7528\u624b\u673a\u5929\u732b\u6210\u529f\u4e0b\u5355\u4e13\u4eab\u552e\u540e\u65e0\u5fe7\uff01",mmstat:"prime_across",token:TB.userInfo.tbToken||"",success:function(){}})})};o.showed=function(){s.sendLog(n.ARR.QRCODE_BUBBLE_TUSER_QRCODE_SHOW)};E(o)}else{B()}}function E(a){if(!a.notNeedBubble){r.bubble({show:true,flag:.6,content:a.html,customContentType:3,bubbleType:a.bubbleType?0:1,height:a.height||175,tab:"QRCODE",isNotTabFire:true,showed:a.showed||"",clicked:a.clicked||"",dismiss:a.dismiss})}c.on("mouseenter",function(){e.mallbarItem.fire(n.E.BUBBLE_CHANGE,{show:true,html:a.html,showDelay:500,customContentType:3,bubbleType:1,height:a.height,tab:"QRCODE",isNotTabFire:true,tabMouseleave:true,showed:function(){},clicked:a.clicked||""})})}function B(){var a=window.g_config||{};var i=a.bizId=="vip"||a.bizId=="mallfp"||window.location.host=="vip.tmall.com";if(i&&e.needCrossBubble){l.get({k:"mui/mbarp/qrcode/point/bubble",success:function(a){if(!a){L()}else{L({notNeedBubble:1})}}})}else{R()}}function L(e){var e=e||{};e.html=f;e.height=71;e.bubbleType="no";e.showed=function(){s.sendLog(n.ARR.QRCODE_DEFAULT_BUBBLE_SHOW);l.set({k:"mui/mbarp/qrcode/point/bubble",v:1,expires:1})};e.clicked=function(){s.sendLog(n.ARR.QRCODE_DEFAULT_BUBBLE_CLICK);a.use("mui/mobilecross",function(a,e){var i=t.get("bubble");var r="//img.alicdn.com/tps/i3/TB1uQThHpXXXXaQXXXXVp31_pXX-111-72.png";!!e&&e.cross({params:{url:"http://www.tmall.com/go/market/promotion-act/crazypoint.php"},itemImg:r,relEl:i,resource:41,text:"\u624b\u673a\u5929\u732b\u6b63\u591a\u8fd42\u500d\u79ef\u5206\uff01\u70b9\u6211\uff01",type:"link",tips:"\u624b\u673a\u5929\u732b\u6b63\u591a\u8fd42\u500d\u79ef\u5206\uff01\u673a\u4f1a\u522b\u6d6a\u8d39\uff01",mmstat:"point_across",token:TB.userInfo.tbToken||"",success:function(){}})})};E(e)}function R(){var l="";if(e.isShop){var m=e.shopConfig=t.getShopConfig()||t.getGConfig()||{};e.sellerId=m.userId||m.sellerId;!!m.shopId&&(e.shopId=m.shopId);if(e.shopId||e.sellerId){l=d+"?iframe=1&a=1&biz=tmall&mmstat=mbar_shop&type=shop&key="+(!!e.shopId?e.shopId:"");e.qrcodeSrc=u+encodeURIComponent(l)}}if(e.isList){var f=a.unparam(s.segment(location.href).qs)||{};l=d+"?mmstat=mbar_list&type=list&key="+f.q;e.qrcodeSrc=u+encodeURIComponent(l)}if(e.isDetail){var v="";if(window.g_config&&window.g_config.itemId){v=window.g_config.itemId}if(v){l=d+"?mmstat=mbar_detail&type=detail&key="+v;e.qrcodeSrc=u+encodeURIComponent(l)}}b.html(p.render(e));b.hide();a.one(document).on("click",function(a){b.hide()});r.on(n.E.MALLBAR_STATUS_CHANGE,function(a){b.hide()});e.on(n.E.QRCODE_CHANGE,function(a){if(a.pid){var i=o.one(".mui-mbar-tab-logo-"+a.pid);if(i){b.css({top:i.parent().css("top")})}}else{b.css({top:c.css("top")})}if(n.S.STANDARD===r.get(n.K.STATUS)){b.css("display")==="none"&&s.sendLog(n.ARR.QRCODE);if(e.renderTpl){var t='<img src="'+e.qrcodeSrc+'" width="140" height="140"/>';b.one(".mui-mbarp-qrcode-hd").html(t);e.renderTpl=false}b.show()}});b.one(".mui-mbarp-qrcode-tip").on("mouseleave",function(t){var r=a.one(t.toElement||t.relatedTarget);if(i.hasClass(r,"mui-mbar-tabs-shadow")||i.hasClass(r,"mui-mbarp-qrcode-arr")){if(e.renderTpl){var o='<img src="'+e.qrcodeSrc+'" width="140" height="140"/>';b.one(".mui-mbarp-qrcode-hd").html(o);e.renderTpl=false}b.show()}else{b.hide()}});var g=false;c.on("mouseenter",function(i){g=true;a.later(function(){if(g){e.fire(n.E.QRCODE_CHANGE)}},400)}).on("mouseleave",function(e){g=false;var t=a.one(e.toElement||e.relatedTarget);if(t){if(!i.hasClass(t,"mui-mbar-tabs-shadow")){if(!t.parent(".mui-mbarp-qrcode")){b.hide()}}}}).on("click",function(){b.css("display")==="none"&&s.sendLog(n.ARR.QRCODE);if(e.renderTpl){var a='<img src="'+e.qrcodeSrc+'" width="140" height="140"/>';b.one(".mui-mbarp-qrcode-hd").html(a);e.renderTpl=false}b.show()})}}});return v},{requires:["base","dom","node","event","mui/minilogin/index","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","xtemplate","mui/mallbar/plugin-qrcode.css"]});KISSY.add("mui/mallbar/plugin-favor",function(a,e,i,t,r,n,s){var o="401";var l=function(a){return a.replace(/\.jpg_.+\.jpg/,".jpg")};var m=function(a){var e=this;m.superclass.constructor.call(e,a);e.init()};var u='<div class="mui-mbarp-favor-list"><i></i>{{content}}'+'<p class="mui-mbarp-favor-see-more"><a target="_blank" href="//shoucang.taobao.com/item_collect.htm">\u67e5\u770b\u5168\u90e8</a></p>'+"</div>";var c='<div class="mui-mbarp-favor-detail">            <div class="mui-mbarp-favor-detail-hd">                <h2>\u642d\u914d/\u540c\u6b3e</h2>                <span class="mui-mbarp-favor-detail-back">\u6211\u7684\u6536\u85cf</span>            </div>            <div class="mui-mbarp-favor-detail-bd">                <div class="mui-mbarp-favor-item-b">                </div>                <div class="mui-mbarp-favor-recommand-box">                    <ul class="mui-mbarp-favor-recommand-tab">                        <li class="mui-mbarp-favor-recommand-tab-item mui-mbarp-favor-recommand-tab-item-match" data-type="match">\u627e\u642d\u914d<b></b></li>                        <li class="mui-mbarp-favor-recommand-tab-item mui-mbarp-favor-recommand-tab-item-fx" data-type="fx">\u627e\u540c\u6b3e<b></b></li>                    </ul>                    <div class="mui-mbar-favor-recommand-content mui-mbar-favor-recommand-content-match"></div>                    <div class="mui-mbar-favor-recommand-content mui-mbar-favor-recommand-content-fx"></div>                </div>            </div>        </div>';var b='<li class="mui-mbarp-favor-recommand-item">                <a target="_blank" href="{itemUrl}">                    <img src="{picUrl}" width="100" height="100"/>                    <p><span class="mui-price-font">&yen;</span>{promotionPrice}</p>                </a></li>';var d=[1,2,3,4];var p=0;a.extend(m,e,{_itemListCache:{},init:function(){var e=this;var i=this;var t=e.get(n.K.CONTAINER);var r=e.get(n.K.TIP_CONTAINER);var o=e.get(n.K.MALLBAR_ITEM);var l=o.get(n.K.MALLBAR);e.mallbar=l||"";var m=o.get(n.K.BUBBLE);s.log(o,this);this._initBind();this._initDOMBind();a.later(function(){i._initRecommandDetail()},10)},_initDOMBind:function(){var e=this;var i=this.get(n.K.MALLBAR_ITEM);var t=i.get(n.K.MALLBAR);var r=this._pluginContainer=this._pluginContainer||a.one(".mui-mbar-plugin-favor");r.delegate("click",".mui-mbarp-favor-cancel",function(i){var r=a.one(i.currentTarget).parent("li");r.animate({opacity:0,width:0},{duration:.5,easing:"easeOut",complete:function(){r.remove();e._isDataChange=true}});var o=a.one(i.currentTarget).attr("data-itemId");t._deleteFavor(o,function(){});s.sendLog(n.ARR.FAVOR_DELETE);i.preventDefault()});r.delegate("mouseenter",".mui-mbarp-favor-item",function(e){var i=a.one(e.currentTarget);i.addClass("mui-mbarp-favor-item-hover")});r.delegate("mouseleave",".mui-mbarp-favor-item",function(e){var i=a.one(e.currentTarget);i.removeClass("mui-mbarp-favor-item-hover")});r.delegate("mouseenter mouseleave",".mui-mbarp-favor-item-sale",function(e){var i=a.one(e.currentTarget);i.toggleClass("mui-mbarp-favor-item-sale-hover")});this._bindDetail();this._initBindCateCheck()},_initBind:function(){var a=this;this.on("visibilityChange",function(e){var i=a.mallbar.get("favorRec");if(i){a.renderSingleRecommend(i);a.mallbar.set("favorRec",{});return}if(e.visible&&e.first||a.notGetFavorList){a._initContainer()}else if(!e.visible&&a._isDataChange){a._isDataChange=false;a._initContainer()}});this.on(n.E.DATA_CHANGE,function(e){s.log("Plugin",e.type);a._initContainer()})},_initContainer:function(){var e=this;e.notGetFavorList=false;a.later(function(){e._initFavorList()},10)},_initRecommandDetail:function(){var e=this;var i=this._pluginContainer||a.one(".mui-mbar-plugin-favor");i.append(c);a.later(function(){e._initDetailBind()},10)},_initDetailBind:function(){var e=this._favorDetail=a.one(".mui-mbarp-favor-detail");e&&s.noScroll(e.one(".mui-mbarp-favor-detail-bd"));var i=this._favorTabItems=a.all(".mui-mbarp-favor-recommand-tab-item");var t=this._favorTabContents=a.all(".mui-mbar-favor-recommand-content");var r=this;e.delegate("click",".mui-mbarp-favor-detail-back",function(a){r._switchBackToList();s.sendLog(n.ARR.FAVOR_BACK);a.halt()});e.delegate("click",".mui-mbarp-favor-recommand-tab-item",function(e){var r=a.one(e.currentTarget);i.removeClass("mui-mbarp-favor-recommand-tab-item-sellected");r.addClass("mui-mbarp-favor-recommand-tab-item-sellected");var n=r.attr("data-type");var s=a.one(".mui-mbar-favor-recommand-content-"+n);t.hide();s.show();e.halt()})},_initFavorList:function(){var a=this.get(n.K.MALLBAR_ITEM);var e=a.get(n.K.MALLBAR);var i=a.get(n.K.TAB);var t=this;var l=new r({dataType:"jsonp",scriptCharset:"gbk",type:"GET",url:n.URL.GET_PLUGIN_FAVOR_INFO,success:function(e){s.log("::favorList::",e);if(e.success&&e.status!=o){if(e.itemInfo&&e.cateInfo.length>1){if(e.cateInfo){t._initCateBox(e.cateInfo)}t._initItemListInner(e.itemInfo)}else{s.codeTracker.sendTrack(n.T.NUMLEV,"mallbar.favor.getFavorItem.data.empty","\u7528\u6237\u6536\u85cf\u5939\u4e3a\u7a7a");a.fire(n.E.ERROR,{tip:"\u54a6\uff0c\u4eb2\u8fd8\u6ca1\u6709\u6536\u85cf\u8fc7\u5546\u54c1\u54e6\uff01"})}}else{if(e.status==o){s.codeTracker.sendTrack(n.T.NUMLEV,"mallbar.favor.getFavorItem.user.not-login","\u7528\u6237\u767b\u9646\u8d85\u65f6")}else{s.codeTracker.sendTrack(n.T.NUMLEV,"mallbar.favor.getFavorItem.failure.bad-status-"+e.status,"\u6536\u85cf\u5939\u83b7\u53d6\u4fe1\u606f\u72b6\u6001\u5f02\u5e38")}a.fire(n.E.ERROR)}},error:function(){s.codeTracker.sendTrack(n.T.NUMLEV,"mallbar.favor.getFavorItem.data.error","\u6536\u85cf\u5939\u4fe1\u606f\u83b7\u53d6\u5931\u8d25");a.fire(n.E.ERROR)}})},_initCateBox:function(e){var i='<div class="mui-mbarp-favor-cate-trigger"><h3><i></i>\u5206\u7c7b</h3><div class="mui-mbarp-favor-cate-cont"><ul>{{content}}</ul></div></div>';var t='<li class="mui-mbarp-favor-cate-item" data-cateId="{cateId}"><a target="_blank" href="javascript:void(0);">{cateName}({number})</a></li>';var r=[];var n=a.one(".mui-mbarp-favor-cate-trigger");a.each(e,function(e,i){r.push(a.substitute(t,e))});if(n){n.one("ul").html(r.join(""))}else{i=i.replace("{{content}}",r.join(""));var s=a.one(".mui-mbar-plugin-favor").one(".mui-mbar-plugin-hd");s.append(i);a.later(function(){n=a.one(".mui-mbarp-favor-cate-trigger");n.on("mouseenter mouseleave",function(){n.toggleClass("mui-mbarp-favor-cate-trigger-hover")})},10)}},_initBindCateCheck:function(){var e=this;var i=this._pluginContainer;i.delegate("click",".mui-mbarp-favor-cate-item",function(i){var t=a.one(i.currentTarget);t.addClass("mui-mbar-favor-cate-item-sellected").siblings().removeClass("mui-mbar-favor-cate-item-sellected");var r=t.attr("data-cateId");var o=".mui-mbarp-favor-item-"+r;e._itemListAll=a.all(".mui-mbarp-favor-item");e._timeList.hide();if(r){e._itemListAll.hide();a.all(o).show();e._timeList.each(function(a){if(a.all(o).length>0){a.show()}})}else{a.all(".mui-mbarp-favor-item").show();e._timeList.show()}s.sendLog(n.ARR.FAVOR_CATE_CHECK);i.halt()})},_getPicHost:function(){var a=p++;if(a>3){a=0}return"//gtms0"+d[a]+".alicdn.com/tps/"},_initItemListInner:function(e){var i=this;var t=["lastWeek","oneWeekAgo","oneMonthAgo","twoMonthAgo"];var r={lastWeek:"\u6700\u8fd1\u4e03\u5929",oneWeekAgo:"\u4e00\u5468\u524d",oneMonthAgo:"\u4e00\u4e2a\u6708\u524d",twoMonthAgo:"\u4e24\u4e2a\u6708\u524d"};var n=[];a.each(t,function(a,t){e[a].desc=r[a];e[a].name=a;n.push(i._renderSingleTime(e[a]))});this._renderItemList(n.join(""))},_renderItemList:function(e){var i=this;var t=this.get(n.K.CONTAINER);var r=u.replace("{{content}}",e);t.html(r);a.later(function(){i._timeList=a.all(".mui-mbarp-favor-item-time")},10)},_bindDetail:function(){var a=this;var e=this._pluginContainer;e.delegate("click",".mui-mbarp-favor-to-detail",function(e){a._toItemDetail(e)})},_toItemDetail:function(e){var i=a.one(e.currentTarget);var t=i.parent(".mui-mbarp-favor-item");var r=i.attr("data-type");var o=t.attr("data-itemId");var l=this._itemListCache[o];l.recommandType=r;if(r=="match"){s.sendLog(n.ARR.FAVOR_TO_MATCH)}else{s.sendLog(n.ARR.FAVOR_TO_FX)}this._initItemDetail(l);this._switchToFavorDetail(t);e.halt()},_switchToFavorDetail:function(e){var t=e.attr("data-itemId");var r=this._itemListCache[t];r.itemPicBig=r.itemPic+"_240x240.jpg";if(!(a.UA.ie<9)){var n='<img class="mui-mbarp-favor-flayer" src="'+r.itemPicBig+'"/>';var s=e.offset();var o=this._pluginContainer;s.top=s.top-a.one(window).scrollTop();s.left=s.left-o.offset().left;var l={left:0,top:40};n=i(n);n.css(s);o.append(n);n.animate({left:l.left,top:l.top,width:235,height:235},{duration:.3,easing:"easeOut",complete:function(){n.animate({opacity:0},{duration:.2,easing:"easeOut",complete:function(){n.remove()}})}})}var m=this._favorDetail||a.one(".mui-mbarp-favor-detail");m.animate({right:0},{duration:.3,easing:"easeOut"})},_switchBackToList:function(){if(this.notGetFavorList){this._initContainer()}var e=this._favorDetail||a.one(".mui-mbarp-favor-detail");e.animate({right:-235},{duration:.3,easing:"easeOut"})},_initItemDetail:function(a){s.log("::to item Detail::",a);this._initFavorDetailBig(a);this._initRecommandList(a)},_initFavorDetailBig:function(e){var i='<a target="_blank" href="{itemUrl}" class="mui-mbarp-favor-detail-big">                    <img src="{itemPicBig}" width="235" height="235"/>                    <p class="mui-text-overflow">{itemTitle}</p>                </a>';e.itemPicBig=e.itemPic+"_240x240.jpg";var t=a.substitute(i,e);if(!this._favorItemBigCont){this._favorItemBigCont=a.one(".mui-mbarp-favor-item-b")}this._favorItemBigCont.html(t)},_initRecommandList:function(e){this._tabItemMatch=this._tabItemMatch||a.one(".mui-mbarp-favor-recommand-tab-item-match");this._tabItemFx=this._tabItemFx||a.one(".mui-mbarp-favor-recommand-tab-item-fx");this._tabContentMatch=this._tabContentMatch||a.one(".mui-mbar-favor-recommand-content-match");this._tabContentFx=this._tabContentFx||a.one(".mui-mbar-favor-recommand-content-fx");if(e.recommandType=="match"){this._tabItemMatch.addClass("mui-mbarp-favor-recommand-tab-item-sellected");this._tabItemFx.removeClass("mui-mbarp-favor-recommand-tab-item-sellected")}else{this._tabItemMatch.removeClass("mui-mbarp-favor-recommand-tab-item-sellected");this._tabItemFx.addClass("mui-mbarp-favor-recommand-tab-item-sellected")}this._favorTabContents.html("");this._initTabContent("match",e);this._initTabContent("fx",e)},_initTabContent:function(e,i){var t=this;var o;var m;if(e=="match"){o=this._tabContentMatch;m=n.URL.GET_PLUGIN_FAVOR_MATCH}else{o=this._tabContentFx;m=n.URL.GET_PLUGIN_FAVOR_FX}new r({url:m,dataType:"jsonp",type:"GET",scriptCharset:"gbk",data:{itemId:i.itemId,categoryId:i.categoryId||"",sellerId:i.sellerId||""},success:function(r){s.log("::favor item recommand::",r);var n=[];if(r&&r.data&&r.data.length){n.push("<ul>");a.each(r.data,function(e,i){if(i>11){return}e.picUrl=l(e.picUrl)+"_100x100.jpg";n.push(a.substitute(b,e))});n.push("</ul>");o.html(n.join(""));if(e==i.recommandType){t._favorTabContents.hide();o.show()}if(r.exposureParam){s.sendLog(r.exposureParam)}}else{s.codeTracker.sendTrack(20,"mallbar.favor.getFavorItemAld.data.empty","\u6536\u85cf\u5939\u5546\u54c1\u63a8\u8350\u4e3a\u7a7a")}},error:function(a){s.codeTracker.sendTrack(20,"mallbar.favor.getFavorItemAld.data.error","\u6536\u85cf\u5939\u5546\u54c1\u63a8\u8350\u83b7\u53d6\u5931\u8d25|"+e)}})},_renderSingleTime:function(e){var i=this;if(e.length){var t=[];var r='<li class="mui-mbarp-favor-item mui-mbarp-favor-item-{cateFrontId} mui-mbarp-favor-item-index-{isOdd}" data-itemId="{itemId}" data-sellerId="{sellerId}" data-categoryId="{categoryId}">                <a target="_blank" href="{itemUrl}">                    <img src="{itemPicSmall}" width="100" height="100"/>                    <div class="mui-mbarp-favor-item-info">                        <em class="mui-mbarp-favor-item-sale {isDown}">                            <div class="mui-mbarp-favor-item-sale-info">                                <div class="mui-mbarp-favor-item-sale-info-cont">                                    <b></b>                                    <p>\u6bd4\u6536\u85cf\u65f6\u76f4\u964d\uff1a<span class="mui-price-font">&yen;{priceDown}</span></p>                                    <p>\u52a0\u5165\u6536\u85cf\u65f6\u4ef7\u683c\uff1a<span class="mui-price-font">&yen;{itemCollectPrice}</span></p>                                </div>                            </div>                        </em>                        <span class="mui-price-font">&yen;{itemPrice}</span>                    </div>                    <div class="mui-mbarp-favor-item-relation">                        <span class="mui-mbarp-favor-item-match mui-mbarp-favor-to-detail" data-type="match">\u627e\u642d\u914d</span>                        <span class="mui-mbarp-favor-item-fx mui-mbarp-favor-to-detail" data-type="fx">\u627e\u540c\u6b3e</span>                    </div>                    <span class="mui-mbarp-favor-cancel mui-favor-delete" title="\u53d6\u6d88\u6536\u85cf" data-itemId="{itemId}"></span>                </a>                </li>';t.push('<div class="mui-mbarp-favor-item-time mui-mbarp-favor-item-list-'+e.name+'">');t.push('<div class="mui-mbarp-favor-item-time-box"><span class="mui-mbarp-favor-item-time-info">'+e.desc+"</span></div>");t.push('<div class="mui-mbarp-favor-item-list mui-fix-float">');a.each(e,function(s,o){if(o%20==0){t.push("<ul>")}s.isOdd=""+o%2;i._itemListCache[s["itemId"]]=s;s.itemUrl=s.itemUrl+"&scm="+n.SCM.FAVOR_ITEM;if(s.itemPic&&s.itemPrice){s.itemPic=l(s.itemPic);if(s.priceDown>0){s.isDown=""}else{s.isDown="hidden"}s.itemPicSmall=s.itemPic+"_100x100.jpg";t.push(a.substitute(r,s))}if(o%20==19||o+1==e.length){t.push("</ul>")}});t.push("</div></div>");return t.join("")}else{return""}},renderSingleRecommend:function(e){if(!e||!e.item){return}var i=e.type||"fx";var t=e.item;t.recommandType=i;this.notGetFavorList=true;this._initItemDetail(t);var r=this._favorDetail||a.one(".mui-mbarp-favor-detail");r.css({right:"0px"})}});return m},{requires:["base","node","event","ajax","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/plugin-favor.css"]});KISSY.add("mui/mallbar/plugin-charge",function(a,e,i,t,r,s){var n=function(a){var e=this;n.superclass.constructor.call(e,a);e.init()};a.extend(n,e,{init:function(){var e=this;var i=e.get(r.K.MALLBAR_ITEM);var t=i.get(r.K.MALLBAR);var s=e.get(r.K.CONTAINER);var n=i.get(r.K.TAB);var o=t.get(r.K.G_CONFIG);if(o.bizId=="mallfp"){n.show()}e.on("visibilityChange",function(e){if(e.visible&&e.first){a.use("mui/chongzhi/index,mui/chongzhi/dianquan",function(a,e,i){s.html('<div id="J_MbarPhoneCharge" class="mui-mbar-plugin-phone-charge"></div><div id="J_MbarDianquanCharge" class="mui-mbar-plugin-dianquan-charge"></div>');setTimeout(function(){var t=a.one("#J_MbarPhoneCharge");if(!t)return;e(t);var r=a.one("#J_MbarDianquanCharge");if(!r)return;new i(r,{})},0)})}})}});return n},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/plugin-charge.css"]});KISSY.add("mui/mallbar/plugin-promotion",function(a,e,i,t,r,n,o,s){var l=['<img class="mui-mbarp-promotion-logo mui-mbarp-promotion-logo-anim" src="{0}" />'].join("");var m=function(a){var e=this;m.superclass.constructor.call(e,a);e.init()};a.extend(m,e,{init:function(){var e=this;var i=e.get(n.K.CONTAINER);var t=e.mallbarItem=e.get(n.K.MALLBAR_ITEM);var r=t.get(n.K.MALLBAR);var l=t.get(n.K.TAB);function m(){i.one(".mui-mbarp-promotion-bd").height(i.height())}var u,c;var b=a.unparam(window.location.search.replace("?",""));function d(e){if(u&&c){e&&e({navUrl:u,navLogo:c})}else{window.__content_results=window.__content_results||[];new a.IO({url:"//delta.taobao.com/home/delivery/AllContentByPage.do",type:"GET",dataType:"script",scriptCharset:"utf-8",data:{resourceIds:20140703,wfType:b["wfType"],wfCode:b["wfCode"],_mock_:b["_mock_"]},success:function(){if(a.unparam(window.location.search.replace("?",""))["promotion-mock"]==1){__content_results=[{content:"//img.alicdn.com/tps/i1/TB1Ne73FFXXXXXEapXXXOXwIpXX-70-70.gif",link:"//www.tmall.com/go/rgn/promotion-act/public-block-toolbar.php",contentPicUrl:"//img.alicdn.com/tps/i3/TB1KrUZFFXXXXcoapXXF6kF2pXX-190-480.jpg",title:"\u590f\u65e5\u9017\u6bd45\u6298",rightDesc:"T100\u4e13\u4eab",actDesc:"\u5173\u6ce8\u54c1\u724c\u5373\u53ef\u4eab",noticeDesc:"\u5751\u7239\u7684\u6743\u76ca\u63cf\u8ff0\u4ecb\u7ecd\uff0c\u8fd9\u662f\u4f60\u7684\u4e13\u4eab\uff0c\u5c3d\u60c5\u4efb\u6027\u5427\uff01"}]}o.log("::content result::",__content_results);var i={};if(__content_results&&__content_results[0]&&__content_results[0].content&&__content_results[0].link){o.sendLog(n.ARR.PROMOTION_SHOW);o.sendLog(__content_results[0].exposureParam);i=__content_results[0];u=i.navUrl=__content_results[0].link;c=i.navLogo=__content_results[0].content;e&&e(i)}}})}}var p='<div class="mui-mbarp-promotion-bubble-cont">                    <div class="mui-mbarp-promotion-bubble-notice">                        <p>\u4eb2\u7231\u7684{nick}:</p>                        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{noticeDesc}</p>                    </div>                    <div class="mui-mbarp-promotion-bubble-brand">                        <img class="mui-mbarp-promotion-bubble-img" src="{navLogo}" width="90" height="45"/>                        <span class="mui-mbarp-promotion-bubble-get">\u7acb\u5373\u9886\u53d6</span>                    </div>                </div>';var f='<div class="mui-mbarp-promotion-content">                    <a class="mui-mbarp-promotion-content-link" href="{link}" target="_blank">                        <div class="mui-mbarp-promotion-content-img">                            <img src="{contentPicUrl}" width="200" height="360"/>                        </div>                        <div class="mui-mbarp-promotion-content-box">                        <h1 class="mui-mbarp-promotion-content-title" title="{title}">{title}</h1>                        <p class="mui-mbarp-promotion-content-desc">{actDesc}</p>                <p class="mui-mbarp-promotion-content-right"><span class="mui-mbarp-promotion-right"><i class="mui-mbar-iconfont">&#xe600;</i>{rightDesc}</span></p>                        <p class="mui-mbarp-promotion-content-brand-icon">                            <img src="{navLogo}" width="90" height="45"/>                        </p>                        <span class="mui-mbarp-promotion-content-button">\u7acb\u5373\u83b7\u53d6</span>                        </div>                    </a>                </div>';var v=a.one(".mui-mbar-tab-bubble-promotion");function g(t){d(function(m){if(m.navLogo){m.nick=t.nick;p=a.substitute(p,m);l.slideDown(.5);var u="mui/mbarp/promotion/"+m.acm;s.get({k:u,success:function(a){if(!a){r.bubble({show:true,content:p,customContentType:2,bubbleType:1,height:90,tab:"PROMOTION",showed:function(){o.sendLog(n.ARR.PROMOTION_BUBBLE_SHOW);s.set({k:u,v:1})},clicked:function(){l.fire("click");o.sendLog(n.ARR.PROMOTION_BUBBLE_CLICK)}})}}});e.on(n.E.VISIBILITY_CHANGE,function(e){if(m.navUrl){if(e.visible&&e.first){var t=a.substitute(f,m);i.html(t)}}})}})}o.getStaticConf({cb:function(){TB.Global.loginStatusReady(function(a){if(a.isLogin){g(a)}else{t.on(n.E.LOGIN_SUCCESS,function(e){g(a)})}})}})}});return m},{requires:["base","node","dom","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-promotion.css"]});KISSY.add("mui/mallbar/plugin-cart",function(a,e,i,t,r,s,n,o,l){var m=function(a){var e=this;m.superclass.constructor.call(e,a);e.init()};a.extend(m,e,{init:function(){var e=this;var i=e.get(r.K.CONTAINER);var t=e.get(r.K.MALLBAR_ITEM);var n=t.get(r.K.MALLBAR);var m=t.get(r.K.TAB);var u=t.getUserInfo();var b=a.all('<div class="mui-mbarp-tab-cart-border "></div>').appendTo(m);m.on("mouseenter",function(){b.hide()}).on("mouseleave",function(){if(!t.get(r.K.EXPAND)){b.show()}});if(!u.isLogin){m.one(".mui-mbar-tab-logo-cart").addClass(".mui-mbar-tab-logo-nologin-cart");m.one(".mui-mbarp-tab-cart-border").addClass("mui-mbarp-tab-cart-border-nologin");m.addClass("mui-mbar-tab-cart-nologin")}n.on(r.E.MALLBAR_STATUS_CHANGE,function(a){r.S.STANDARD===a.status?b.show():b.hide()});t.on(r.E.LOGIN_SUCCESS,function(a){m.one(".mui-mbar-tab-logo-cart").removeClass(".mui-mbar-tab-logo-nologin-cart");m.one(".mui-mbarp-tab-cart-border").removeClass("mui-mbarp-tab-cart-border-nologin");m.removeClass("mui-mbar-tab-cart-nologin");e._updateMiniCartNum(function(){})});l.set("_mallbarItem",t);l.set("_mallbarConf",r);e._bindCartModel();e._bindResize();e._updateMiniCartNum();e.on("visibilityChange",function(a){a.visible?b.hide():b.show();if(a.visible&&a.first){i.html('<div class="mui-mbarp-cart-wrap"><div id="J_MBarMiniCart" class="mui-mbarp-cart-bd"></div></div>');o.init("#J_MBarMiniCart")}else if(a.visible){o.strectch();e._resize()}if(a.visible){if(n.get("isBucket10")){s.sendLog(r.ARR.CART_TAB_CLICK_DOWN)}else{s.sendLog(r.ARR.CART_TAB_CLICK)}var t=e.total||0;if(t==0){l.record("tmalljy.2.5?action=open-with-size-zero")}}});e._contentReady(".tm-mcCartBtn",function(){var e=a.one(".tm-mcCartBtn");e.text("\u67e5\u770b\u5168\u90e8")});e.on("addCartItem",function(){e._updateMiniCartNum()});e.fire(r.E.ADD_CART_ITEM)},_contentReady:function(e,i){var t=false;setTimeout(function(){t=true},5e3);setTimeout(function(){var r=a.one(e);if(r&&r.children()){i()}else if(!t){setTimeout(arguments.callee,50)}},50)},_bindCartModel:function(){var a=this;var e=a.get(r.K.MALLBAR_ITEM);l.on("numChange",function(a){var i=e.getUserInfo();if(!i.isLogin){e.fire("suptipChange",{show:false});return}if(i&&i.isMallSeller){e.fire("suptipChange",{show:true,num:0});return}var t=l.get("totalSize");if(typeof t=="number"&&t!="-1"){e.fire("suptipChange",{show:true,num:t})}});l.on("numChangeCheckCount",function(){var a=e.getUserInfo();if(!a.isLogin){e.fire("suptipChange",{show:false});return}if(a&&a.isMallSeller){e.fire("suptipChange",{show:true,num:0});return}var i=l.get("__totalCount__");if(typeof i=="number"&&i!="-1"){e.fire("suptipChange",{show:true,num:i})}});l.on("mallBarMiniCartNum",function(i){var t=i.data;var r=t.callback;var s=l.getNum("total");a.total=s;var n=e.getUserInfo();if(!n.isLogin){e.fire("suptipChange",{show:false});return}if(n&&n.isMallSeller){e.fire("suptipChange",{show:true,num:0})}else{e.fire("suptipChange",{show:true,num:s})}if(!r){return}r(!n.isLogin&&0===s)})},needLogin:function(a){a()},disableExpand:function(){var a=this;var e=a.get(r.K.MALLBAR_ITEM);var i=e.getUserInfo();if(i&&i.isMallSeller){s.sendLog("//log.mmstat.com/tmalljy.2.5?action=openmini_v101");e.fire(r.E.BUBBLE_CHANGE,{show:true,customContentType:1,bubbleType:0,showDelay:100,html:"\u60a8\u662f\u5929\u732b\u5356\u5bb6\uff0c\u4e0d\u80fd\u4f7f\u7528\u8d2d\u7269\u8f66"});return true}return false},_bindResize:function(){var e=this;var t=e.get(r.K.MALLBAR_ITEM);var s=t.get(r.K.MALLBAR);i.delegate(document,"renderMiniCartList","#J_MBarMiniCart",function(){e._resize()});i.delegate(document,"miniCartEmpty","#J_MBarMiniCart",function(){a.later(function(){s.collapse({status:2})},2e3)})},_bindScroll:function(){var e=a.one(".mui-mbar-plugin-cart").one(".mui-mbar-plugin-bd");i.on(e,"scroll",a.buffer(function(i){var t=a.one(".mui-mbar-plugin-cart").one(".tm-mcHandler");var r=a.one(".mui-mbar-plugin-cart").one(".tm-mcTop");var s=e.height();t.css({position:"absolute",top:i.currentTarget.scrollTop+s-85});r.css({position:"absolute",top:i.currentTarget.scrollTop})},8>t.ie?150:-1))},_resize:function(){m();var e=a.one(".mui-mbar-plugin-cart");var i=e.one(".mui-mbar-plugin-bd");var t=e.one(".tm-mcHandler");var r=e.one(".tm-mcTop");var s=e.height();var n=a.one(".mui-mbarp-cart-bd").innerHeight();var o=t.height()+15;i.height(s);if(n>=s-o){if(l.get("quickSettlement")){a.one(".tm-mcListBox").css({"padding-bottom":o})}}else{m()}function m(){a.one(".tm-mcListBox").css({"padding-bottom":"0px"})}},_updateMiniCartNum:function(e){var i=this;var s=t.ie==6||t.ie==7;var n=i.get(r.K.MALLBAR_ITEM);var o=n.get(r.K.MALLBAR);var m=function(i){var t=i.uid;var r="TCART_234_"+t+"_q";var s=function(i){i=i||{};var t=a.isNumber(i[r]);l.setNum({normal:t?l.formatNum(i[r]):0,invalid:0});l.fire("mallBarMiniCartNum",{data:{callback:e}})};if(t){l.xhr({api:"num",data:{keys:r},complete:s})}else{s()}};TB.Global.loginStatusReady(function(e){if(e.isLogin){var i=a.later(m,5e3);TB.Global.memberInfoReady(function(a){i.cancel();var e=a.memberInfo;m({uid:e.cookies&&e.cookies.unb?e.cookies.unb.value:""})})}else{m({uid:e.trackId})}})}});return m},{requires:["base","event","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/minicart/minicart","mui/minicart/model","mui/mallbar/plugin-cart.css"]});KISSY.add("mui/minicart/minicart",function(t,a,e,i,n,r,s){var o={};var c=0;t.mix(o,{version:"%VERSION%",init:function(i,n){if(c){return}c++;var s=this;s.carttype=1;i=a.get(i);n=t.merge({},n);a.addClass(i,"tm-mCart");s.el=i;var o=function(){i.innerHTML='<div class="tm-mcRoot">'+'<div class="tm-mcListBox"><div class="tm-mcListInner"><div class="tm-mcList"></div></div><div class="tm-mcLoading"></div><div class="tm-mcMask"></div></div>'+'<div class="tm-mcHandler">'+'<div class="tm-mcApart"></div>'+'<div class="tm-mcGrace"></div>'+"</div>"+"</div>";s.handlerEl=a.get("div.tm-mcHandler",i);s.listBoxEl=a.get("div.tm-mcListBox",i);s.listInnerEl=a.get("div.tm-mcListInner",i);s.listEl=a.get("div.tm-mcList",i);s.rootEl=a.get("div.tm-mcRoot",i);s.graceEl=a.get("div.tm-mcGrace",i);s.apartEl=a.get("div.tm-mcApart",i);s.renderHandler();t.use("mui/minicart/fullext",function(){s.strectch()});e.on(s.rootEl,"click",function(t){t.stopPropagation();var e=t.target;do{if(e===this){return}var i=a.attr(e,"data-tmc");if("."===i){return}if(i){if("A"===e.nodeName){t.preventDefault()}return s[i](e)}e=a.parent(e)}while(true)});r.detach("numInit",o)};r.on("numInit",o);r.numInit();s.CartModel=r},login:function(a){var e=this;r.record("tmalljy.2.5?action=openmininotlogin_v102&ver="+e.carttype);var i=r.get("_mallbarItem");var n=r.get("_mallbarConf");if(i&&n){i.fire(n.E.LOGIN,{success:function(){r.set("_isLogin",true);if(t.isFunction(a)){return a()}if(TB&&TB.Global&&TB.Global.writeLoginInfo){TB._isMemberInfoReady=false;TB._isLoginStatusReady=false;TB.Global.writeLoginInfo()}}})}},cart:function(){window.open(r.getApi("bcart"),"_blank")},add:function(e,i,n){var s=this;s.addData={params:t.clone(e),success:i,error:n};var o=e.anim;delete e.anim;i=i||function(){};r.set("_cached",false);r.add({data:e,success:function(t){if(window.TB&&TB.Global&&TB.Global.mallbar){var n=o.startNode;var r=40;var s=40;TB.Global.mallbar.driving({e:{target:o.startNode,pageX:a.offset(n).left+(a.width(n)-r)/2,pageY:a.offset(n).top-s},type:"cart",flyer:o.img,width:r,height:s,params:e,speed:2,callback:function(){i(t)}})}},error:n||i})},invalidCache:function(){r.set("_cached",false)},loginThenAdd:function(){var t=this;t.login(function(){var a=t.addData;t.add(a.params,a.success,a.error)})},renderHandler:function(){var t=this;var e=r.getNum("total");var i="";if(r.get("_listFilled")&&!t.cartDegr){i+='<div class="tm-mcCashier-wrap">';i+=o();i+='<div class="tm-mcTotal clearfix">'+'<h3><span class="tm-e1">\u8d2d\u7269\u8f66</span><span class="tm-e2">\u5df2\u9009</span><strong class="tm-mcCartNumTotal">'+e+'</strong><strong class="tm-mcCheckedNum">'+(r.get("_checkedCount")||0)+'</strong><span class="tm-e2">\u4ef6</span></h3>'+'<span class="tm-mcTotalFeeWrap"><span class="tm-mcRmb">&yen;</span><strong class="tm-mcTotalFee">'+s.toMoney(r.get("_totalFee"))+"</strong></span>"+"</div>";i+='<div class="tm-mcCashier" data-tmc="go">';i+='<div class="tm-mcGo">\u7ed3 \u7b97<s></s></div>';i+="</div>";i+="</div>"}var n=t.handlerEl;a.remove(".tm-mcCashier-wrap",n);a.append(a.create(i),n);function o(){var t="";if(r.get("isDouble11Pre")){t='<div class="tianmaobao j_tianmaobao"><a href="//chong.alipay.com/i/chong.htm" title="\u5929\u732b\u5b9d"><img src="//gtms01.alicdn.com/tps/i1/TB1p6vmGpXXXXXPXFXXYZaeLVXX-280-46.png"/></a></div>'}return t}}});r.on("after_counterDownChange",function(t){a[t.newVal?"addClass":"removeClass"](o.el,"tm-mcCounterDown")});r.on("after_countMaxChange",function(t){a[t.newVal?"addClass":"removeClass"](o.el,"tm-mcCountMax")});window.MiniCartModel=r;window.TMiniCart=o;return o},{requires:["dom","event","anim","ua","mui/minicart/model","mui/minicart/util","mui/minicart/minicart.css"]});KISSY.add("mui/minicart/model",function(t,e,a,r,i,n,c){var s=function(){var e=false;var a=[];var r=new Image;window["_tmcr_"+t.now()]=r;r.onload=r.onerror=function(){e=false;i()};function i(){if(e){return}var i=a.shift();if(i){e=true;r.src="//gm.mmstat.com/"+i+(i.indexOf("?")>-1?"&":"?")+t.now()}}return function(t){if(t){a.push(t);i()}}}();function o(){var t=this;var e=location.hostname;var a=e.match(/\b(daily|com\.hk)\b/);var r=e.match(/\.hk\b/);var i=e.match(/\.95095/);var n=e.match(/\.95095\.daily\.etao\.net/);t.isDaily=a;var c=a?"daily.tmall.com.hk":"tmall.hk";var s=a?"daily.tmall.net":"tmall.com";var l=a?"daily.taobao.net":"taobao.com";var m=a?"yao.95095.daily.tmall.net":"yao.95095.com";if(n){m="yao.95095.daily.etao.net"}o.superclass.constructor.call(t);t.set("_checkedMax",50);t.set("_numDanger",50);var d=r?c:i?m:s;t.set("host:fbuy","//{hostprefix}fbuy."+d);t.set("host:cart","//{hostprefix}cart."+s);t.set("host:buy","//{hostprefix}buy."+s);t.set("host:buyYY","//{hostprefix}buy."+m);t.set("host:buyHK","//{hostprefix}buy."+c);t.set("api:num",(a?"//count.config-vip.taobao.net:8888":"//count.taobao.com")+"/counter6");t.set("api:list","{fbuy}/cart/mini/trailMiniCart.htm");t.set("api:add","{fbuy}/cart/addCartItems.do");t.set("api:del","{fbuy}/cart/mini/delMini.do");t.set("api:update","{fbuy}/cart/mini/updateMini.do");t.set("api:check","{fbuy}/cart/mini/checkMini.do");t.set("api:sss","//{hostprefix}cart."+l+"/sss.htm");t.set("api:bag","{fbuy}/auth/buyerRemoveReward.do");t.set("api:bcart","{cart}/cart/myCart.htm");t.set("api:buyTB","//{hostprefix}buy."+l+"/auction/order/confirm_order.htm");t.set("api:buy","{buy}/order/confirmOrder.htm");t.set("api:buyHK","{buyHK}/order/confirmOrder.htm");t.set("api:buyYY","{buyYY}/order/confirm_order.htm");t.set("api:checkLogin","{buy}/login/buy.do");t.set("api:checkLoginYY","{buyYY}/login/buy.do");t.set("api:checkLoginHK","{buyHK}/login/buy.do");var u=window.TB&&TB.Global&&TB.Global.setCartNum?TB.Global.setCartNum:function(){};t.on("numChange",function(){u(this.get("_counterDown")||this.get("_countMax")?false:this.getNum("total"))})}t.extend(o,a);t.augment(o,i.Target||t.EventTarget,{DATA:{},NUM:{total:0,normal:0,invalid:0,primitive:true},TYPE:{bundle:{child:"main"},main:{parent:"bundle",child:"order"},order:{parent:"main"}},setNum:function(e,a){var r={};var i=false;if(!t.isPlainObject(e)){r[e]=a}else{r=e}var n=this.NUM;t.each(r,function(t,e){if(e in n){if(t!==n[e]){i=true}n[e]=t}});n.total=n.normal+n.invalid;if(n.total>=this.get("_numDanger")){this.set("_countMax",true)}if(n.primitive){i=true;n.primitive=false}if(i){this.fire("numChange")}this.fire("updateNum")},getNum:function(e){var a=this.NUM;if(e){return a[e]}return t.clone(a)},numInit:function(){var e=this;var a=false;var r=function(){if(a){return}a=true;var r=e.get("uid");var i="TCART_234_"+r+"_q";var n=function(a){a=a||{};e.set("__totalCount__",a[i]);var r=t.isNumber(a[i]);if(!r){e.set("_counterDown",true)}e.setNum({normal:r?e.formatNum(a[i]):0,invalid:0});e.fire("numInit")};if(r){e.xhr({api:"num",data:{keys:i},complete:n})}else{n()}};TB.Global.loginStatusReady(function(a){if(a.isLogin){e.set("_isLogin",true);var i=t.later(r,5e3);TB.Global.memberInfoReady(function(t){i.cancel();var a=t.memberInfo;e.set("uid",a.cookies&&a.cookies.unb?a.cookies.unb.value:"");r()})}else{e.set("uid",a.trackId);r()}})},dump:function(){if(window.console){window.console.log(this.getAttrVals());window.console.log(this.NUM);window.console.log(this.DATA)}},getApi:function(e){var a=this;if(-1===e.indexOf(":")){e="api:"+e}var r=a.get(e);if(r){t.each(["fbuy","buy","buyHK","cart","buyYY"],function(t){r=r.replace("{"+t+"}",a.get("host:"+t)||"")});r=r.replace("{hostprefix}",a.get("host:prefix")||"")}return r},record:s,add:function(e){var a=this;var i=0;var s=1;e=a.mixParams(e);o(e.data);l();function o(t){t.add=r.stringify(t.add);var e=a.get("_tb_token_");if(e){t._tb_token_=e}}function l(r){if(r){o(r)}else{r=e.data}a.xhr({api:"add",data:r,success:function(t){a.set("totalSize",t.cartNum);a.setNum({normal:t.cartNum,invalid:0});e.success(t)},error:function(o){if(i>=s){return}if("CsrfCheckFail"===o.errorCode&&o.tk){i++;e.data._tb_token_=o.tk;a.set("_tb_token_",o.tk);return l()}if(!o.errorCode){o.errorCode="SERVER_BUSY";o.error="\u5ba2\u5b98\uff0c\u7f51\u7edc\u62e5\u5835\uff0c\u6dfb\u52a0\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}if(o.errorCode==="BuyerNeedLogin"){var m={check:false};if(r.proxyURL){m.proxyURL=r.proxyURL}c.show(function(){var c=r.getParams;if(o.tk){e.data._tb_token_=o.tk;a.set("_tb_token_",o.tk)}if(t.isFunction(c)){n.when(c(),function(t){i++;return l(t)})}else{i++;return l()}},m)}else{e.error(o)}}})}},xhr:function(a){var r=this;a=t.merge({data:{},type:"get",success:function(){},error:function(){},complete:function(){},wait:function(){},needMerge:false,timeout:5},a);var i=r.getApi(a.api);var n=t.later(function(){a.wait()},360);var c=function(e){n.cancel();a.responseData=e;r.onXhrResponse(a);var i=r.get("uid");if(a.api==="num"&&!i){t.each(e,function(t,e){if(t<0){r.record("tmalljy.2.5?action=tair-error")}})}};var s=a.data;var o=r.get("_tpId");if(o){s.tpId=o}a.data=s;if("get"===a.type){e({url:i,type:"get",scriptCharset:a.scriptCharset||"gbk",data:s,dataType:"jsonp",complete:c,timeout:a.timeout})}else{r.useProxy(function(t){t.post(i,s,c,a.timeout)})}},onXhrResponse:function(e){var a=this;var i=e.responseData;if(!t.isPlainObject(i)){i={success:false}}var n=i.globalData;var c;if(n){c=n.sss;a.set("_isLogin",n.login);if(!a.get("host:prefix")&&n.hostPrefix){a.set("host:prefix",n.hostPrefix+".")}if(n.cartUrl){a.set("api:bcart",n.cartUrl)}}try{c=c||r.parse(i.sss);if(t.isPlainObject(c)&&"quantity"in c){t.getScript(a.getApi("sss")+"?quantity="+c.quantity+"&tk="+c.token+"&"+t.now())}}catch(s){}if(i.success){if(e.needMerge){a.set(n);a.merge(i.list)}if(n&&n.bundRela){a.mergeBundleRelaPromo(n)}e.success(i);if(e.needMerge){a.calculate()}}else{e.error(i)}e.complete(i)},formatNum:function(t){t-=0;return t>0?t:0},read:function(t,e,a){if(!t){return null}var r;e=e.split("/");while(r=e.shift()){if(r in t){t=t[r]}else{return a}}return t},mixParams:function(e,a){return t.merge({success:function(){},error:function(){}},a,e)},useProxy:function(e){var a=this;t.use("mui/minicart/proxy",function(t,r){r.init(a.getApi("host:fbuy")+"/cart/mini/proxy.htm",function(){});if(e){e(r)}})}});return new o},{requires:["ajax","base","json","event","promise","mui/minilogin"]});KISSY.add("mui/minicart/util",function(t,e){var a={};t.mix(a,{toMoney:function(t){if("number"!==typeof t){t=t-0}t=t/100;return isNaN(t)?"":t.toFixed(2)},toWeight:function(t){if("number"!==typeof t){t=t-0}t/=1e3;return t||0},toTxt:function(t){var a=document.createElement("div");a.innerHTML=t;return e.text(a).replace(/\s+/g,"")},showLogin:function(e){t.use("mui/minilogin",function(t,a){a.show(e)})}});return a},{requires:["dom"]});KISSY.add("mui/mallbar/plugin-nav",function(a,e,i,t,r,n,s,o){var l=['<img class="mui-mbarp-nav-logo mui-mbarp-nav-logo-anim" src="{0}" />'].join("");var m="//gtd.alicdn.com/tps/i1/T19YwFFbVhXXcGUfcA-70-146.png";var u=[];var c='<img width="35" heigth="30" src="{0}" />';var b=function(a){var e=this;b.superclass.constructor.call(e,a);e.init()};a.extend(b,e,{init:function(){var a=this;var e=a.get(n.K.CONTAINER);var i=a.get(n.K.MALLBAR_ITEM);var t=i.get(n.K.TAB);var r=t.one(".mui-mbar-tab-txt");var o=t.one(".mui-mbar-tab-logo-nav");function l(){e.one(".mui-mbarp-nav-bd").height(e.height())}a.on(n.E.VISIBILITY_CHANGE,function(a){if(a.visible&&a.first){s.getStaticConf({cb:function(a){e.html(s.fm('<iframe src="{0}" class="mui-mbarp-nav-bd" frameborder="0"></iframe>',a.navUrl||n.U.NAV_TMS));l()}})}l()});s.getStaticConf({cb:function(a){a.navTxt&&r.html(a.navTxt);if(a.navTabLogo){o.append(s.fm(c,a.navTabLogo))}a.navBgColor&&t.css("background-color",a.navBgColor)}})}});return b},{requires:["base","node","ua","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-nav.css"]});KISSY.add("mui/mallbar/plugin-worth",function(a,e,i,t,r,o,n,s){var l=function(a){var e=this;l.superclass.constructor.call(e,a);e.init()};a.extend(l,e,{init:function(){var e=this;var i=e.get(r.K.CONTAINER);var l=e.mallbarItem=e.get(r.K.MALLBAR_ITEM);var m=l.get(r.K.MALLBAR);var u=l.get(r.K.TAB);var c=u.one(".mui-mbar-tab-sup");e.tip=c;var b=e.get("pluginHead");e.isDownShelf=false;var d=o.getSysId();e.isDetail=d=="detail";e.isShop=d=="shop";var p=l.getUserInfo();if(!e.isDetail&&!e.isShop){if(p.isLogin){n.get({k:"mui/mbarp/worth/bubble/"+l.getUid(),success:function(a){if(!a){f(2)}}})}else{f(4.4)}}function f(a){var e=['<div class="mui-mbar-bubble mui-mbarp-bubble-worth" >','<div class="mui-mbar-arr mui-mbarp-bubble-worth-arr">\u25c6</div>',"</div>"].join("");m.bubble({show:true,content:e,customContentType:3,flag:a,height:72,bubbleType:0,tab:"WORTH",isNotTabFire:true,showed:function(){o.sendLog(r.ARR.WORTH_BUBBLE_SHOW);if(p.isLogin){n.set({k:"mui/mbarp/worth/bubble/"+l.getUid(),v:1,expires:1})}},clicked:function(){!!u&&u.fire("click");o.sendLog(r.ARR.WORTH_BUBBLE_CLICK)},dismiss:function(){}})}var v=true;e.on(r.E.VISIBILITY_CHANGE,function(a){e.tip.hide();if(a.visible&&v){if(e.isDownShelf){h()}else{_()}}v=false});e.on(r.E.DATA_CHANGE,function(a){v=true;if(l.get(r.K.EXPAND)){e.tip.hide();if(e.isDownShelf){h()}else{_()}}});var g=window.TShop;if(g&&g.onProduct){g.onProduct(function(a){a.onLoad("isDownShelf",function(a){if(a){e.isDownShelf=true;c.html('<div class="mui-mbar-iconfont mui-mbarp-live-reddot">&#xe603;</div>');c.show()}})})}function h(){var e='<li class="mui-mbarp-worth-recommand-item">                <a target="_blank" href="{{itemUrl}}">                    <img src="{{pictUrl}}_100x100" width="100" height="100"/>                    <p><span class="mui-price-font">&yen;</span>{{promotionPrice}}</p>                </a></li>';var t=m.get("itemId")||"";var n=m.get("sellerId")||"";var u="";if(window.g_config&&window.g_config.categoryId){u=window.g_config.categoryId}var c="";o.ajax({url:r.URL.GET_PLUGIN_WORTH_RECOMMEND,jsonpCallback:"_mallbarWorthRecommend",dataType:"jsonp",data:{sellerId:n,itemId:t,categoryId:u},timeout:5,success:function(t){if(!t){l.fire(r.E.ERROR);o.codeTracker.sendTrack(r.T.NUMLEV,"mallbar.worth.downshelf.recommend.get.failure","\u83b7\u53d6\u503c\u5f97\u4e70\u5546\u54c1\u544a\u7f44\u63a8\u8350\u5546\u54c1\u5931\u8d25");return}var n=t.data||"";if(n&&n.length>0){c+='<div class="mui-mbarp-worth-recommend"><p class="mui-mbarp-worth-recommend-hd">\u770b\u770b\u5f53\u524d\u5546\u54c1\u76f8\u4f3c\u7684\u5546\u54c1\u5427</p><ul class="mui-mbarp-worth-recommend-ul">';a.each(n,function(a){c+=new s(e).render(a)});if(t.itemParam){c+='<a class="mui-mbarp-worth-recommend-more" target="_blank" href="//www.tmall.com/go/market/brand/worth.php?from=mybrand_block&scm=1048.1.13.1&invalidItems='+t.itemParam+'">\u67e5\u770b\u66f4\u591a<span class="mui-mbar-iconfont">&#xe601;</span></a>'}c+="</ul></div>";i.html(c);!!t.exposureParam&&o.sendLog(t.exposureParam)}else{l.fire(r.E.ERROR,{tip:"\u4eb2\uff0c\u6682\u65f6\u6ca1\u6709\u63a8\u8350\u7684\u5546\u54c1\u54e6\uff01"});o.codeTracker.sendTrack(r.T.NUMLEV,"mallbar.worth.downshelf.recommend.get.failure","\u83b7\u53d6\u503c\u5f97\u4e70\u5546\u54c1\u544a\u7f44\u63a8\u8350\u5546\u54c1\u5931\u8d25")}},error:function(){l.fire(r.E.ERROR);o.codeTracker.sendTrack(r.T.NUMLEV,"mallbar.worth.downshelf.recommend.get.failure","\u83b7\u53d6\u503c\u5f97\u4e70\u5546\u54c1\u544a\u7f44\u63a8\u8350\u5546\u54c1\u5931\u8d25")}})}function _(){var e=['<li class="mui-mbarp-worth-list-item {{^if show}}mui-mbarp-worth-hide  mui-mbar-worth-rest{{/if}}">','<a href="{{itemUrl}}" target="_blank">','   <div class="mui-mbarp-worth-list-item-wrap">','       <span class="mui-mbarp-worth-list-item-describe"><span class="mui-mbarp-worth-list-item-a" title="{{itemTitle}}" target="_blank">{{itemTitle}}</span></span>','       <span class="mui-mbarp-worth-list-item-price">\uffe5<b>{{promotionPrice}}</b></span>',"{{#if showNums}}",'<span class="mui-mbarp-worth-list-item-sales">{{tip}}</span>',"{{/if}}","   </div>",'   <div class="mui-mbarp-worth-hide mui-mbarp-worth-list-item-166pic-arr"></div>','   <div class="mui-mbarp-worth-hide mui-mbarp-worth-list-item-166pic"><img title="{{itemTitle}}" data-src="{{pictUrl}}_200x200" width="200" height="200" /></div>','   <img class="mui-mbarp-worth-list-item-60pic" alt="{{itemTitle}}" src="{{pictUrl}}_60x60" width="60" height="60"/>',"{{#if rank}}",'<span class="mui-mbarp-worth-list-number">{{rank}}</span>',"{{/if}}","</a>","</li>"].join("");var n="";var m="";if(window.g_config&&window.g_config.categoryId){m=window.g_config.categoryId}o.ajax({url:r.URL.GET_PLUGIN_WORTH_LISTS,dataType:"jsonp",jsonpCallback:"_mallbarWorthLists",data:m?{categoryId:m}:{},timeout:5,success:function(m){if(!m){l.fire(r.E.ERROR);o.codeTracker.sendTrack(r.T.NUMLEV,"mallbar.worth.lists.get.failure","\u83b7\u53d6\u503c\u5f97\u4e70\u5546\u54c1\u63a8\u8350\u5217\u8868\u5546\u54c1\u5931\u8d25")}var u=m.data;var c=m.tmall1111||"";var b=m.showNums||"";n+='<div class="mui-mbarp-worth-content">';if(u){if(u.length==0){l.fire(r.E.ERROR,{tip:"\u4eb2\uff0c\u6682\u65f6\u6ca1\u6709\u63a8\u8350\u7684\u5546\u54c1\u54e6\uff01"})}else if(u.length==1){var d="";var u=u[0];if(u.itemList&&u.itemList.length>0){u.categoryName=o.sub(u.categoryName,20);d='<p class="mui-mbarp-worth-list-hd">'+u.categoryName+"\u63a8\u8350\u699c</p>";d+='<div class="mui-mbarp-worth-list-bd">'+'<ul class="mui-mbarp-worth-list-ul">';for(var p=0,f=u.itemList.length;p<f;p++){var v=u.itemList[p];if(p<3){v.rank=p+1}v.show=true;if(c){v.tip="\u9500\u91cf"+v.nums+"\u4ef6"}else{v.tip="\u6708\u9500\u91cf"+v.nums+"\u4ef6"}if(b){v.showNums=true}var g=new s(e).render(v);d+=g}d+="</ul></div>";n+=d;if(m.moreLink){n+='<a class="mui-mbarp-worth-more" target="_blank" href="'+m.moreLink+'">\u67e5\u770b\u66f4\u591a<span class="mui-mbar-iconfont">&#xe601;</span></a>'}n+="</div>";i.html(n)}else{l.fire(r.E.ERROR,{tip:"\u4eb2\uff0c\u6682\u65f6\u6ca1\u6709\u63a8\u8350\u7684\u5546\u54c1\u54e6\uff01"})}!!m.exposureParam&&o.sendLog(m.exposureParam)}else if(u.length>1){var h=u,_=u.length;for(var p=0;p<_;p++){var d="";var T=h[p];if(T.itemList&&T.itemList.length){d='<p class="mui-mbarp-worth-list-hd">'+T.categoryName+"\u63a8\u8350\u699c</p>";d+='<div class="mui-mbarp-worth-list-bd">'+'<ul class="mui-mbarp-worth-list-ul">';for(var I=0,f=T.itemList.length;I<f;I++){var v=T.itemList[I];if(I<3){v.rank=I+1;v.show=true}if(c){v.tip="\u9500\u91cf"+v.nums+"\u4ef6"}else{v.tip="\u6708\u9500\u91cf"+v.nums+"\u4ef6"}if(b){v.showNums=true}var g=new s(e).render(v);d+=g}if(T.itemList.length>3){d+='<p class="mui-mbar-iconfont mui-mbarp-worth-list-item-more">&#xe60a;</p>'}d+="</ul></div>"}n+=d}if(m.moreLink){n+='<a class="mui-mbarp-worth-more" target="_blank" href="'+m.moreLink+'" >\u67e5\u770b\u66f4\u591a<span class="mui-mbar-iconfont">&#xe601;</span></a>'}n+="</div>";i.html(n);!!m.exposureParam&&o.sendLog(m.exposureParam);a.all(".mui-mbarp-worth-list-item-more").on("click",function(e){var i=a.one(e.target);if(!i.hasClass("mui-mbarp-worth-list-more-flag")){i.html("&#xe609;");i.parent().all(".mui-mbar-worth-rest").show();i.addClass("mui-mbarp-worth-list-more-flag")}else{i.html("&#xe60a;");i.parent().all(".mui-mbar-worth-rest").hide();i.removeClass("mui-mbarp-worth-list-more-flag")}})}a.all(".mui-mbarp-worth-list-item").each(function(e){t.delegate(".mui-mbarp-worth-list-bd","mouseenter",".mui-mbarp-worth-list-item-60pic",function(e){var i=a.one(e.target).prev(),t=a.one(e.target).parent().one(".mui-mbarp-worth-list-item-166pic-arr");if(!i.hasClass("mui-mbarp-worth-list-pic-flag")){i.addClass("mui-mbarp-worth-list-pic-flag");var r=a.DOM.attr(i.one("img"),"data-src");a.DOM.attr(i.one("img"),{src:r})}i.css({display:"block"});t.css({display:"block"})});t.delegate(".mui-mbarp-worth-list-bd","mouseleave",".mui-mbarp-worth-list-item-60pic",function(e){var i=a.one(e.target).prev(),t=a.one(e.target).parent().one(".mui-mbarp-worth-list-item-166pic-arr");i.css({display:"none"});t.css({display:"none"})});a.one(e).one("div.mui-mbarp-worth-hide").on("mouseleave",function(e){var i=a.one(e.target).parent().one(".mui-mbarp-worth-list-item-166pic-arr");a.one(e.target).css({display:"none"});i.css({display:"none"})})})}},error:function(){l.fire(r.E.ERROR);o.codeTracker.sendTrack(r.T.NUMLEV,"mallbar.worth.lists.get.failure","\u83b7\u53d6\u503c\u5f97\u4e70\u5546\u54c1\u63a8\u8350\u5217\u8868\u5546\u54c1\u5931\u8d25")}})}}});return l},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","xtemplate","sizzle","mui/mallbar/plugin-worth.css"]});