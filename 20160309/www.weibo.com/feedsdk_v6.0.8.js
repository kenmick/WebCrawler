~function(){function a(a,b){if(!STK)var STK=function(){var a={},b="theia",c=[],d=200,e;a[b]={IE:/msie/i.test(navigator.userAgent),E:function(a){return typeof a=="string"?document.getElementById(a):a},C:function(a){var b;a=a.toUpperCase();a=="TEXT"?b=document.createTextNode(""):a=="BUFFER"?b=document.createDocumentFragment():b=document.createElement(a);return b},log:function(){var a,b=arguments,f=b.length,g=[].slice.apply(b,[0,f]),h="error",i;while(g[--f])if(g[f]instanceof Error){a=g.splice(f,1)[0];break}if(!a){a=new Error;h="log"}i=[g,h,(new Date).getTime(),a.message,a.stack];if(e)try{e.apply(null,i)}catch(j){}else{c.length>=d&&c.shift();c.push(i)}},_regLogFn:function(a){e=a},_clearLogList:function(){return c.splice(0,c.length)}};var f=a[b];f.register=function(c,d,e){if(!e||typeof e!="string")e=b;a[e]||(a[e]={});var f=a[e],g=c.split("."),h=f,i=null;while(i=g.shift())if(g.length){h[i]===undefined&&(h[i]={});h=h[i]}else if(h[i]===undefined)try{if(e&&e!==b){if(c==="core.util.listener"){h[i]=a[b].core.util.listener;return!0}if(c==="core.util.connect"){h[i]=a[b].core.util.connect;return!0}}h[i]=d(f);return!0}catch(j){setTimeout(function(){console.log(j)},0)}return!1};f.unRegister=function(c,d){if(!d||typeof d!="string")d=b;var e=a[d],f=c.split("."),g=e,h=null;while(h=f.shift())if(f.length){if(g[h]===undefined)return!1;g=g[h]}else if(g[h]!==undefined){delete g[h];return!0}return!1};f.regShort=function(a,b){if(f[a]!==undefined)throw"["+a+"] : short : has been register";f[a]=b};f.shortRegister=function(c,d,e){if(!e||typeof e!="string")e=b;var f=a[e],g=c.split(".");if(!d)return!1;if(f[d])return!1;var h=f,i=null;while(i=g.shift())if(g.length){if(h[i]===undefined)return!1;h=h[i]}else if(h[i]!==undefined){if(f[d])return!1;f[d]=h[i];return!0}return!1};f.getPKG=function(c){if(!c||typeof c!="string")c=b;return a[c]};return f}();STK.register("core.ani.algorithm",function(a){var b={linear:function(a,b,c,d,e){return c*a/d+b},easeincubic:function(a,b,c,d,e){return c*(a/=d)*a*a+b},easeoutcubic:function(a,b,c,d,e){return(a/=d/2)<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeinoutcubic:function(a,b,c,d,e){e==undefined&&(e=1.70158);return c*(a/=d)*a*((e+1)*a-e)+b},easeinback:function(a,b,c,d,e){e==undefined&&(e=1.70158);return c*(a/=d)*a*((e+1)*a-e)+b},easeoutback:function(a,b,c,d,e){e==undefined&&(e=1.70158);return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeinoutback:function(a,b,c,d,e){e==undefined&&(e=1.70158);return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}};return{addAlgorithm:function(a,c){if(b[a])throw"[core.ani.tweenValue] this algorithm :"+a+"already exist";b[a]=c},compute:function(a,c,d,e,f,g,h){if(typeof b[a]!="function")throw"[core.ani.tweenValue] this algorithm :"+a+"do not exist";return b[a](e,c,d,f,g,h)}}});STK.register("core.func.empty",function(){return function(){}});STK.register("core.obj.parseParam",function(a){return function(a,b,c){var d,e={};b=b||{};for(d in a){e[d]=a[d];b[d]!=null&&(c?a.hasOwnProperty(d)&&(e[d]=b[d]):e[d]=b[d])}return e}});STK.register("core.ani.tweenArche",function(a){return function(b,c){var d,e,f,g,h,i,j,k;e={};d=a.core.obj.parseParam({animationType:"linear",distance:1,duration:500,callback:a.core.func.empty,algorithmParams:{},extra:5,delay:25},c);var l=function(){f=+(new Date)-g;if(f<d.duration){h=a.core.ani.algorithm.compute(d.animationType,0,d.distance,f,d.duration,d.extra,d.algorithmParams);b(h);i=setTimeout(l,d.delay)}else{k="stop";d.callback()}};k="stop";e.getStatus=function(){return k};e.play=function(){g=+(new Date);h=null;l();k="play";return e};e.stop=function(){clearTimeout(i);k="stop";return e};e.resume=function(){if(j){g+=+(new Date)-j;l()}return e};e.pause=function(){clearTimeout(i);j=+(new Date);k="pause";return e};e.destroy=function(){clearTimeout(i);j=0;k="stop"};return e}});STK.register("core.dom.getStyle",function(a){function b(){return"y"in b?b.y:b.y="filters"in a.C("div")}return function(a,c){if(!b()){c=="float"&&(c="cssFloat");try{var d=document.defaultView.getComputedStyle(a,"")}catch(e){}return a.style[c]||d?d[c]:null}switch(c){case"opacity":var f=100;try{f=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{f=a.filters("alpha").opacity}catch(e){}}return f/100;case"float":c="styleFloat";default:var g=a.currentStyle?a.currentStyle[c]:null;return a.style[c]||g}}});STK.register("core.util.browser",function(a){var b=navigator.userAgent.toLowerCase(),c=window.external||"",d,e,f,g,h,i=function(a){var b=0;return parseFloat(a.replace(/\./g,function(){return b++==1?"":"."}))};try{/windows|win32/i.test(b)?h="windows":/macintosh/i.test(b)?h="macintosh":/rhino/i.test(b)&&(h="rhino");if((e=b.match(/applewebkit\/([^\s]*)/))&&e[1]){d="webkit";g=i(e[1])}else if((e=b.match(/presto\/([\d.]*)/))&&e[1]){d="presto";g=i(e[1])}else if(e=b.match(/msie\s([^;]*)/)){d="trident";g=1;(e=b.match(/trident\/([\d.]*)/))&&e[1]&&(g=i(e[1]))}else if(/gecko/.test(b)){d="gecko";g=1;(e=b.match(/rv:([\d.]*)/))&&e[1]&&(g=i(e[1]))}/world/.test(b)?f="world":/360se/.test(b)?f="360":/maxthon/.test(b)||typeof c.max_version=="number"?f="maxthon":/tencenttraveler\s([\d.]*)/.test(b)?f="tt":/se\s([\d.]*)/.test(b)&&(f="sogou")}catch(j){}var k={OS:h,CORE:d,Version:g,EXTRA:f?f:!1,IE:/msie/.test(b),OPERA:/opera/.test(b),MOZ:/gecko/.test(b)&&!/(compatible|webkit)/.test(b),IE5:/msie 5 /.test(b),IE55:/msie 5.5/.test(b),IE6:/msie 6/.test(b),IE7:/msie 7/.test(b),IE8:/msie 8/.test(b),IE9:/msie 9/.test(b),IE10:/msie 10/.test(b),SAFARI:!/chrome\/([\d.]*)/.test(b)&&/\/([\da-f.]*) safari/.test(b),CHROME:/chrome\/([\d.]*)/.test(b),IPAD:/\(ipad/i.test(b),IPHONE:/\(iphone/i.test(b),ITOUCH:/\(itouch/i.test(b),MOBILE:/mobile/i.test(b)};return k});STK.register("core.dom.cssText",function(a){var b=function(a){var b=0,c=[],d="close",e=!1,f=null,g=function(d){c.push({type:"info",content:a.slice(0,b)});c.push({type:"sign",content:a.slice(b,b+1)});a=a.slice(b+1);b=0};while(a){var h=a.charAt(b);switch(h){case":":if(!e&&d==="close"){c.push({type:"attr",content:a.slice(0,b)});c.push({type:"sign",content:a.slice(b,b+1)});a=a.slice(b+1);b=0;d="open";break}b+=1;break;case";":if(!e){if(d==="open"){c.push({type:"info",content:a.slice(0,b)});c.push({type:"sign",content:a.slice(b,b+1)})}a=a.slice(b+1);b=0;d="close";break}b+=1;break;case'"':case"'":if(e){if(h===f){e=!e;f=null}}else{e=!e;f=h}b+=1;break;case" ":case"!":case",":case"(":case")":g(h);break;case"":c.push({type:"info",content:a.slice(0,b)});a="";b=0;break;default:b+=1}}return c},c=function(a){var b={},c;for(var d=0,e=a.length;d<e;d+=1)if(a[d].type==="attr"){c=a[d].content;b[c]=""}else{if(a[d].type==="sign"&&a[d].content===";"){c=null;continue}if(a[d].type==="sign"&&a[d].content===":")continue;c!==null&&(b[c]+=a[d].content)}return b},d={webkit:"-webkit-",presto:"-o-",trident:"-ms-",gecko:"-moz-"}[a.core.util.browser.CORE],e=["transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function"],f=function(a){for(var b=0,c=e.length;b<c;b+=1)if(a===e[b])return!0;return!1};return function(a){var e=c(b(a||"")),g=function(a,b){a=a.toLowerCase();e[a]=b;f(a)&&(e[d+a]=b);return h},h={push:g,remove:function(a){a=a.toLowerCase();e[a]&&delete e[a];f(a)&&e[d+a]&&delete e[d+a];return h},merge:function(a){var d=c(b(a||""));for(var e in d)g(e,d[e])},getCss:function(){var a=[];for(var b in e)a.push(b+":"+e[b]);return a.join(";")}};return h}});STK.register("core.func.getType",function(a){return function(a){var b;return((b=typeof a)=="object"?a==null&&"null"||Object.prototype.toString.call(a).slice(8,-1):b).toLowerCase()}});STK.register("core.arr.isArray",function(a){return function(a){return Object.prototype.toString.call(a)==="[object Array]"}});STK.register("core.arr.foreach",function(a){var b=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d+=1){var f=b(a[d],d);if(f===!1)break;f!==null&&(c[d]=f)}return c},c=function(a,b){var c={};for(var d in a){var e=b(a[d],d);if(e===!1)break;e!==null&&(c[d]=e)}return c};return function(d,e){return a.core.arr.isArray(d)||d.length&&d[0]!==undefined?b(d,e):typeof d=="object"?c(d,e):null}});STK.register("core.arr.indexOf",function(a){return function(a,b){if(b.indexOf)return b.indexOf(a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1}});STK.register("core.arr.inArray",function(a){return function(b,c){return a.core.arr.indexOf(b,c)>-1}});STK.register("core.dom.isNode",function(a){return function(a){return a!=undefined&&Boolean(a.nodeName)&&Boolean(a.nodeType)}});STK.register("core.json.merge",function(a){var b=function(b){return b===undefined?!0:b===null?!0:a.core.arr.inArray(typeof b,["number","string","function","boolean"])?!0:a.core.dom.isNode(b)?!0:!1},c=function(d,e,f){if(b(f))d[e]=f;else{if(a.core.arr.isArray(f)){a.core.arr.isArray(d[e])||(d[e]=[]);for(var g=0,h=f.length;g<h;g+=1)c(d[e],g,f[g]);return}if(typeof f=="object"){if(b(d[e])||a.core.arr.isArray(d[e]))d[e]={};for(var i in f)c(d[e],i,f[i]);return}}},d=function(a,b,d){var e={};if(d){for(var f in a)c(e,f,a[f]);for(var f in b)c(e,f,b[f])}else{for(var f in a)e[f]=a[f];for(var f in b)e[f]=b[f]}return e};return function(b,c,e){var f=a.core.obj.parseParam({isDeep:!1},e);return d(b,c,f.isDeep)}});STK.register("core.util.color",function(a){var b=/^#([a-fA-F0-9]{3,8})$/,c=/^rgb[a]?\s*\((\s*([0-9]{1,3})\s*,){2,3}(\s*([0-9]{1,3})\s*)\)$/,d=/([0-9]{1,3})/ig,e=/([a-fA-F0-9]{2})/ig,f=a.core.arr.foreach,g=function(a){var g=[],h=[];if(b.test(a)){h=a.match(b);h[1].length<=4?g=f(h[1].split(""),function(a,b){return parseInt(a+a,16)}):h[1].length<=8&&(g=f(h[1].match(e),function(a,b){return parseInt(a,16)}));return g}if(c.test(a)){h=a.match(d);g=f(h,function(a,b){return parseInt(a,10)});return g}return!1};return function(a,b){var c=g(a);if(!c)return!1;var d={};d.getR=function(){return c[0]};d.getG=function(){return c[1]};d.getB=function(){return c[2]};d.getA=function(){return c[3]};return d}});STK.register("core.ani.tween",function(a){var b=a.core.ani.tweenArche,c=a.core.arr.foreach,d=a.core.dom.getStyle,e=a.core.func.getType,f=a.core.obj.parseParam,g=a.core.json.merge,h=a.core.util.color,i=function(a){var b=/(-?\d\.?\d*)([a-z%]*)/i.exec(a),c=[0,"px"];if(b){b[1]&&(c[0]=b[1]-0);b[2]&&(c[1]=b[2])}return c},j=function(a){for(var b=0,c=a.length;b<c;b+=1){var d=a.charCodeAt(b);if(d>64&&d<90){var e=a.substr(0,b),f=a.substr(b,1),g=a.slice(b+1);return e+"-"+f.toLowerCase()+g}}return a},k=function(a,b,c){var f=d(a,c);if(e(f)==="undefined"||f==="auto"){c==="height"&&(f=a.offsetHeight);c==="width"&&(f=a.offsetWidth)}var g={start:f,end:b,unit:"",key:c,defaultColor:!1};if(e(b)==="number"){var j=[0,"px"];e(f)==="number"?j[0]=f:j=i(f);g.start=j[0];g.unit=j[1]}if(e(b)==="string"){var k,l;k=h(b);if(k){l=h(f);l||(l=h("#fff"));g.start=l;g.end=k;g.defaultColor=!0}}a=null;return g},l=null,m=function(){if(l!==null)return l;if("y"in m)return m.y;l=m.y="filters"in a.C("div");return l},n={opacity:function(a,b,c,d){var e=a*(c-b)+b,f={};m()?f.filter="alpha(opacity="+e*100+")":f.opacity=Math.max(Math.min(1,e),0);f.zoom=1;return f},defaultColor:function(a,b,c,d,e){var f=Math.max(0,Math.min(255,Math.ceil(a*(c.getR()-b.getR())+b.getR()))),g=Math.max(0,Math.min(255,Math.ceil(a*(c.getG()-b.getG())+b.getG()))),h=Math.max(0,Math.min(255,Math.ceil(a*(c.getB()-b.getB())+b.getB()))),i={};i[j(e)]="#"+(f<16?"0":"")+f.toString(16)+(g<16?"0":"")+g.toString(16)+(h<16?"0":"")+h.toString(16);return i},"default":function(a,b,c,d,e){var f=a*(c-b)+b,g={};g[j(e)]=f+d;return g}};return function(d,e){var h,i,j,l,m,o,p,q,r,s;e=e||{};i=f({animationType:"linear",duration:500,algorithmParams:{},extra:5,delay:25},e);i.distance=1;var t,u;i.callback=function(){u=e.end||a.core.func.empty;t=e.tween||a.core.func.empty;return function(){l(1);p();u(d)}}();j=g(n,e.propertys||{});o=null;m={};r=[];l=function(a){var b=[],e=c(m,function(b,c){var d;j[c]?d=j[c]:b.defaultColor?d=j.defaultColor:d=j["default"];var e=d(a,b.start,b.end,b.unit,b.key);for(var f in e)o.push(f,e[f]);try{t(a)}catch(g){}});d.style.cssText=o.getCss()};p=function(){var a;while(a=r.shift())try{a.fn();if(a.type==="play")break;if(a.type==="destroy")break}catch(b){}};s=b(l,i);var v=function(a){s.getStatus()!=="play"?d=a:r.push({fn:v,type:"setNode"})},w=function(b){if(s.getStatus()!=="play"){m=c(b,function(a,b){return k(d,a,b)});o=a.core.dom.cssText(d.style.cssText+(e.staticStyle||""));s.play()}else r.push({fn:function(){w(b)},type:"play"})},x=function(){if(s.getStatus()!=="play"){s.destroy();d=null;h=null;i=null;j=null;l=null;m=null;o=null;p=null;q=null;r=null}else r.push({fn:x,type:"destroy"})};h={};h.play=function(a){w(a);return h};h.stop=function(){s.stop();return h};h.pause=function(){s.pause();return h};h.resume=function(){s.resume();return h};h.finish=function(a){w(a);x();return h};h.setNode=function(a){v(a);return h};h.destroy=function(){x();return h};return h}});STK.register("core.dom.hasClassName",function(a){return function(a,b){return(new RegExp("(^|\\s)"+b+"($|\\s)")).test(a.className)}});STK.register("core.str.trim",function(a){return function(a){if(typeof a!="string")throw"trim need a string as parameter";var b=a.length,c=0,d=/(\u3000|\s|\t|\u00A0)/;while(c<b){if(!d.test(a.charAt(c)))break;c+=1}while(b>c){if(!d.test(a.charAt(b-1)))break;b-=1}return a.slice(c,b)}});STK.register("core.dom.addClassName",function(a){return function(b,c){b.nodeType===1&&(a.core.dom.hasClassName(b,c)||(b.className=a.core.str.trim(b.className)+" "+c))}});STK.register("core.dom.removeClassName",function(a){return function(b,c){b.nodeType===1&&a.core.dom.hasClassName(b,c)&&(b.className=b.className.replace(new RegExp("(^|\\s)"+c+"($|\\s)")," "))}});STK.register("core.evt.addEvent",function(a){return function(b,c,d){b=a.E(b);if(b==null)return!1;if(typeof d!="function")return!1;b.addEventListener?b.addEventListener(c,d,!1):b.attachEvent?b.attachEvent("on"+c,d):b["on"+c]=d;return!0}});STK.register("core.evt.removeEvent",function(a){return function(b,c,d){b=a.E(b);if(b==null)return!1;if(typeof d!="function")return!1;b.removeEventListener?b.removeEventListener(c,d,!1):b.detachEvent&&b.detachEvent("on"+c,d);b["on"+c]=null;return!0}});STK.register("core.evt.eventName",function(a){var b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return function(c){if(c==="mousewheel")return"onmousewheel"in document?"mousewheel":"DOMMouseScroll";if(c==="transitionend"){var d=a.C("div");for(var e in b)if(e in d.style)return b[e]}return c}});STK.register("core.ani.transition",function(a){var b=function(){var a=document.createElement("style"),b="STK_transition_"+ +(new Date),c=null,d={};a.setAttribute("type","text/css");a.setAttribute("id",b);document.head.appendChild(a);for(var e=0,f=document.styleSheets.length;e<f;e+=1)if(document.styleSheets[e].ownerNode.id===b){c=document.styleSheets[e];break}d.getCssSheet=function(){return c};d.addRule=function(a,b){var d=c.rules||c.cssRules;c.addRule?c.addRule(a,b,d.length):c.insertRule&&c.insertRule(a+" {"+b+"}",d.length)};d.destory=function(){document.head.removeChild(a);a=null;c=null;b=null};return d},c=a.core.evt.eventName("transitionend");return function(d,e){var f=a.core.obj.parseParam({target:"",duration:500,timingFn:[0,0,1,1],callback:function(){}},e),g="all "+f.duration+"ms cubic-bezier("+f.timingFn.join(",")+")",h=a.core.dom.cssText(d.style.cssText),i="test",j=b();h.merge(f.target);h.push("transition",g);j.addRule("."+i,h.getCss());a.core.evt.addEvent(d,c,function(){a.core.evt.removeEvent(d,c,arguments.callee);d.style.cssText=h.remove("transition").getCss();a.core.dom.removeClassName(d,i);j.destory();g=null;h=null;i=null;j=null;f.callback(d);f=null});a.core.dom.addClassName(d,i);d.style.cssText=""}});STK.register("core.arr.findout",function(a){return function(b,c){if(!a.core.arr.isArray(b))throw"the findout function needs an array as first parameter";var d=[];for(var e=0,f=b.length;e<f;e+=1)b[e]===c&&d.push(e);return d}});STK.register("core.arr.clear",function(a){return function(b){if(!a.core.arr.isArray(b))throw"the clear function needs an array as first parameter";var c=[];for(var d=0,e=b.length;d<e;d+=1)a.core.arr.findout([undefined,null,""],b[d]).length||c.push(b[d]);return c}});STK.register("core.arr.copy",function(a){return function(b){if(!a.core.arr.isArray(b))throw"the copy function needs an array as first parameter";return b.slice(0)}});STK.register("core.arr.hasby",function(a){return function(b,c){if(!a.core.arr.isArray(b))throw"the hasBy function needs an array as first parameter";var d=[];for(var e=0,f=b.length;e<f;e+=1)c(b[e],e)&&d.push(e);return d}});STK.register("core.arr.unique",function(a){return function(b){if(!a.core.arr.isArray(b))throw"the unique function needs an array as first parameter";var c=[];for(var d=0,e=b.length;d<e;d+=1)a.core.arr.indexOf(b[d],c)===-1&&c.push(b[d]);return c}});STK.register("core.dom.addHTML",function(a){return function(a,b){if(a.insertAdjacentHTML)a.insertAdjacentHTML("BeforeEnd",b);else{var c=a.ownerDocument.createRange();c.setStartBefore(a);var d=c.createContextualFragment(b);a.appendChild(d)}}});STK.register("core.dom.sizzle",function(a){function c(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){i=i[a];var j=!1;while(i){if(i.sizcache===c){j=d[i.sizset];break}if(i.nodeType===1&&!f){i.sizcache=c;i.sizset=g}if(i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}function b(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var j=d[g];if(j){j=j[a];var k=!1;while(j){if(j.sizcache===c){k=d[j.sizset];break}if(j.nodeType===1){if(!f){j.sizcache=c;j.sizset=g}if(typeof b!="string"){if(j===b){k=!0;break}}else if(i.filter(b,[j]).length>0){k=j;break}}j=j[a]}d[g]=k}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,g=!1,h=!0;[0,0].sort(function(){h=!1;return 0});var i=function(a,b,c,e){c=c||[];b=b||document;var g=b;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!a||typeof a!="string")return c;var h=[],l,m,o,p,r=!0,s=i.isXML(b),t=a,u,v,w,x;do{d.exec("");l=d.exec(t);if(l){t=l[3];h.push(l[1]);if(l[2]){p=l[3];break}}}while(l);if(h.length>1&&k.exec(a))if(h.length===2&&j.relative[h[0]])m=q(h[0]+h[1],b);else{m=j.relative[h[0]]?[b]:i(h.shift(),b);while(h.length){a=h.shift();j.relative[a]&&(a+=h.shift());m=q(a,m)}}else{if(!e&&h.length>1&&b.nodeType===9&&!s&&j.match.ID.test(h[0])&&!j.match.ID.test(h[h.length-1])){u=i.find(h.shift(),b,s);b=u.expr?i.filter(u.expr,u.set)[0]:u.set[0]}if(b){u=e?{expr:h.pop(),set:n(e)}:i.find(h.pop(),h.length===1&&(h[0]==="~"||h[0]==="+")&&b.parentNode?b.parentNode:b,s);m=u.expr?i.filter(u.expr,u.set):u.set;h.length>0?o=n(m):r=!1;while(h.length){v=h.pop();w=v;j.relative[v]?w=h.pop():v="";w==null&&(w=b);j.relative[v](o,w,s)}}else o=h=[]}o||(o=m);o||i.error(v||a);if(f.call(o)==="[object Array]")if(!r)c.push.apply(c,o);else if(b&&b.nodeType===1)for(x=0;o[x]!=null;x++)o[x]&&(o[x]===!0||o[x].nodeType===1&&i.contains(b,o[x]))&&c.push(m[x]);else for(x=0;o[x]!=null;x++)o[x]&&o[x].nodeType===1&&c.push(m[x]);else n(o,c);if(p){i(p,g,c,e);i.uniqueSort(c)}return c};i.uniqueSort=function(a){if(p){g=h;a.sort(p);if(g)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a};i.matches=function(a,b){return i(a,null,null,b)};i.find=function(a,b,c){var d;if(!a)return[];for(var e=0,f=j.order.length;e<f;e++){var g=j.order[e],h;if(h=j.leftMatch[g].exec(a)){var i=h[1];h.splice(1,1);if(i.substr(i.length-1)!=="\\"){h[1]=(h[1]||"").replace(/\\/g,"");d=j.find[g](h,b,c);if(d!=null){a=a.replace(j.match[g],"");break}}}}d||(d=b.getElementsByTagName("*"));return{set:d,expr:a}};i.filter=function(a,b,c,d){var e=a,f=[],g=b,h,k,l=b&&b[0]&&i.isXML(b[0]);while(a&&b.length){for(var m in j.filter)if((h=j.leftMatch[m].exec(a))!=null&&h[2]){var n=j.filter[m],o,p,q=h[1];k=!1;h.splice(1,1);if(q.substr(q.length-1)==="\\")continue;g===f&&(f=[]);if(j.preFilter[m]){h=j.preFilter[m](h,g,c,f,d,l);if(!h)k=o=!0;else if(h===!0)continue}if(h)for(var r=0;(p=g[r])!=null;r++)if(p){o=n(p,h,r,g);var s=d^!!o;if(c&&o!=null)s?k=!0:g[r]=!1;else if(s){f.push(p);k=!0}}if(o!==undefined){c||(g=f);a=a.replace(j.match[m],"");if(!k)return[];break}}if(a===e)if(k==null)i.error(a);else break;e=a}return g};i.error=function(a){throw"Syntax error, unrecognized expression: "+a};var j={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!/\W/.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&i.filter(b,a,!0)},">":function(a,b){var c=typeof b=="string",d,e=0,f=a.length;if(c&&!/\W/.test(b)){b=b.toLowerCase();for(;e<f;e++){d=a[e];if(d){var g=d.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++){d=a[e];d&&(a[e]=c?d.parentNode:d.parentNode===b)}c&&i.filter(b,a,!0)}},"":function(a,d,f){var g=e++,h=b,i;if(typeof d=="string"&&!/\W/.test(d)){d=d.toLowerCase();i=d;h=c}h("parentNode",d,g,a,i,f)},"~":function(a,d,f){var g=e++,h=b,i;if(typeof d=="string"&&!/\W/.test(d)){d=d.toLowerCase();i=d;h=c}h("previousSibling",d,g,a,i,f)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(/\\/g,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(/\\/g,"")},TAG:function(a,b){return a[1].toLowerCase()},CHILD:function(a){if(a[1]==="nth"){var b=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0;a[3]=b[3]-0}a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1].replace(/\\/g,"");!f&&j.attrMap[g]&&(a[1]=j.attrMap[g]);a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(a,b,c,e,f){if(a[1]==="not")if((d.exec(a[3])||"").length>1||/^\w/.test(a[3]))a[3]=i(a[3],null,null,b);else{var g=i.filter(a[3],b,c,!0^f);c||e.push.apply(e,g);return!1}else if(j.match.POS.test(a[0])||j.match.CHILD.test(a[0]))return!0;return a},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!i(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){return"text"===a.type},radio:function(a){return"radio"===a.type},checkbox:function(a){return"checkbox"===a.type},file:function(a){return"file"===a.type},password:function(a){return"password"===a.type},submit:function(a){return"submit"===a.type},image:function(a){return"image"===a.type},reset:function(a){return"reset"===a.type},button:function(a){return"button"===a.type||a.nodeName.toLowerCase()==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=j.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||i.getText([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,k=g.length;h<k;h++)if(g[h]===a)return!1;return!0}i.error("Syntax error, unrecognized expression: "+e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":while(d=d.previousSibling)if(d.nodeType===1)return!1;if(c==="first")return!0;d=a;case"last":while(d=d.nextSibling)if(d.nodeType===1)return!1;return!0;case"nth":var e=b[2],f=b[3];if(e===1&&f===0)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)d.nodeType===1&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return e===0?j===0:j%e===0&&j/e>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=j.attrHandle[c]?j.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=j.setFilters[e];if(f)return f(a,c,b,d)}}};i.selectors=j;var k=j.match.POS,l=function(a,b){return"\\"+(b-0+1)};for(var m in j.match){j.match[m]=new RegExp(j.match[m].source+/(?![^\[]*\])(?![^\(]*\))/.source);j.leftMatch[m]=new RegExp(/(^(?:.|\r|\n)*?)/.source+j.match[m].source.replace(/\\(\d+)/g,l))}var n=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(o){n=function(a,b){var c=b||[],d=0;if(f.call(a)==="[object Array]")Array.prototype.push.apply(c,a);else if(typeof a.length=="number")for(var e=a.length;d<e;d++)c.push(a[d]);else for(;a[d];d++)c.push(a[d]);return c}}var p;document.documentElement.compareDocumentPosition?p=function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition){a==b&&(g=!0);return a.compareDocumentPosition?-1:1}var c=a.compareDocumentPosition(b)&4?-1:a===b?0:1;c===0&&(g=!0);return c}:"sourceIndex"in document.documentElement?p=function(a,b){if(!a.sourceIndex||!b.sourceIndex){a==b&&(g=!0);return a.sourceIndex?-1:1}var c=a.sourceIndex-b.sourceIndex;c===0&&(g=!0);return c}:document.createRange&&(p=function(a,b){if(!a.ownerDocument||!b.ownerDocument){a==b&&(g=!0);return a.ownerDocument?-1:1}var c=a.ownerDocument.createRange(),d=b.ownerDocument.createRange();c.setStart(a,0);c.setEnd(a,0);d.setStart(b,0);d.setEnd(b,0);var e=c.compareBoundaryPoints(Range.START_TO_END,d);e===0&&(g=!0);return e});i.getText=function(a){var b="",c;for(var d=0;a[d];d++){c=a[d];c.nodeType===3||c.nodeType===4?b+=c.nodeValue:c.nodeType!==8&&(b+=i.getText(c.childNodes))}return b};(function(){var a=document.createElement("div"),b="script"+(new Date).getTime();a.innerHTML="<a name='"+b+"'/>";var c=document.documentElement;c.insertBefore(a,c.firstChild);if(document.getElementById(b)){j.find.ID=function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d?d.id===a[1]||typeof d.getAttributeNode!="undefined"&&d.getAttributeNode("id").nodeValue===a[1]?[d]:undefined:[]}};j.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}}c.removeChild(a);c=a=null})();(function(){var a=document.createElement("div");a.appendChild(document.createComment(""));a.getElementsByTagName("*").length>0&&(j.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c});a.innerHTML="<a href='#'></a>";a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(j.attrHandle.href=function(a){return a.getAttribute("href",2)});a=null})();document.querySelectorAll&&function(){var a=i,b=document.createElement("div");b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){i=function(b,c,d,e){c=c||document;if(!e&&c.nodeType===9&&!i.isXML(c))try{return n(c.querySelectorAll(b),d)}catch(f){}return a(b,c,d,e)};for(var c in a)i[c]=a[c];b=null}}();(function(){var a=document.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;j.order.splice(1,0,"CLASS");j.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])};a=null}})();i.contains=document.compareDocumentPosition?function(a,b){return!!(a.compareDocumentPosition(b)&16)}:function(a,b){return a!==b&&(a.contains?a.contains(b):!0)};i.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var q=function(a,b){var c=[],d="",e,f=b.nodeType?[b]:b;while(e=j.match.PSEUDO.exec(a)){d+=e[0];a=a.replace(j.match.PSEUDO,"")}a=j.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++)i(a,f[g],c);return i.filter(d,c)};return i});STK.register("core.dom.builder",function(a){return function(b,c){var d=typeof b=="string",e=b;if(d){e=a.C("div");e.innerHTML=b}var f,g;f={};if(c)for(j in selectorList)f[j]=a.core.dom.sizzle(c[j].toString(),e);else{g=a.core.dom.sizzle("[node-type]",e);for(var h=0,i=g.length;h<i;h+=1){var j=g[h].getAttribute("node-type");f[j]||(f[j]=[]);f[j].push(g[h])}}var k=b;if(d){k=a.C("buffer");while(e.childNodes[0])k.appendChild(e.childNodes[0])}return{box:k,list:f}}});STK.register("core.dom.setStyle",function(a){function b(){return"y"in b?b.y:b.y="filters"in a.C("div")}return function(a,c,d){if(b())switch(c){case"opacity":a.style.filter="alpha(opacity="+d*100+")";if(!a.currentStyle||!a.currentStyle.hasLayout)a.style.zoom=1;break;case"float":c="styleFloat";default:a.style[c]=d}else{c=="float"&&(c="cssFloat");a.style[c]=d}}});STK.register("core.dom.insertAfter",function(a){return function(a,b){var c=b.parentNode;c.lastChild==b?c.appendChild(a):c.insertBefore(a,b.nextSibling)}});STK.register("core.dom.insertBefore",function(a){return function(a,b){var c=b.parentNode;c.insertBefore(a,b)}});STK.register("core.dom.trimNode",function(a){return function(a){var b=a.childNodes;for(var c=b.length-1;c>=0;c-=1)b[c]&&(b[c].nodeType==3||b[c].nodeType==8)&&a.removeChild(b[c])}});STK.register("core.dom.removeNode",function(a){return function(b){b=a.E(b)||b;try{b.parentNode.removeChild(b)}catch(c){}}});STK.register("core.evt.fireEvent",function(a){return function(b,c){var d=a.E(b);if(d.addEventListener){var e=document.createEvent("HTMLEvents");e.initEvent(c,!0,!0);d.dispatchEvent(e)}else d.fireEvent("on"+c)}});STK.register("core.util.scrollPos",function(a){return function(a){a=a||document;var b=a.documentElement,c=a.body;return{top:Math.max(window.pageYOffset||0,b.scrollTop,c.scrollTop),left:Math.max(window.pageXOffset||0,b.scrollLeft,c.scrollLeft)}}});STK.register("core.dom.position",function(a){var b=function(b){var c,d,e,f,g,h;c=b.getBoundingClientRect();d=a.core.util.scrollPos();e=b.ownerDocument.body;f=b.ownerDocument.documentElement;g=f.clientTop||e.clientTop||0;h=f.clientLeft||e.clientLeft||0;return{l:parseInt(c.left+d.left-h,10)||0,t:parseInt(c.top+d.top-g,10)||0}},c=function(b,c){var d,e;d=[b.offsetLeft,b.offsetTop];e=b.offsetParent;if(e!==b&&e!==c)while(e){d[0]+=e.offsetLeft;d[1]+=e.offsetTop;e=e.offsetParent}if(a.core.util.browser.OPERA!=-1||a.core.util.browser.SAFARI!=-1&&b.style.position=="absolute"){d[0]-=document.body.offsetLeft;d[1]-=document.body.offsetTop}b.parentNode?e=b.parentNode:e=null;while(e&&!/^body|html$/i.test(e.tagName)&&e!==c){if(e.style.display.search(/^inline|table-row.*$/i)){d[0]-=e.scrollLeft;d[1]-=e.scrollTop}e=e.parentNode}return{l:parseInt(d[0],10),t:parseInt(d[1],10)}};return function(d,e){if(d==document.body)return!1;if(d.parentNode==null)return!1;if(d.style.display=="none")return!1;var f=a.core.obj.parseParam({parent:null},e);if(d.getBoundingClientRect){if(f.parent){var g=b(d),h=b(f.parent);return{l:g.l-h.l,t:g.t-h.t}}return b(d)}return c(d,f.parent||document.body)}});STK.register("core.dom.setXY",function(a){return function(b,c){var d=a.core.dom.getStyle(b,"position");if(d=="static"){a.core.dom.setStyle(b,"position","relative");d="relative"}var e=a.core.dom.position(b);if(e!=!1){var f={l:parseInt(a.core.dom.getStyle(b,"left"),10),t:parseInt(a.core.dom.getStyle(b,"top"),10)};isNaN(f.l)&&(f.l=d=="relative"?0:b.offsetLeft);isNaN(f.t)&&(f.t=d=="relative"?0:b.offsetTop);c.l!=null&&(b.style.left=c.l-e.l+f.l+"px");c.t!=null&&(b.style.top=c.t-e.t+f.t+"px")}}});STK.register("core.str.encodeHTML",function(a){return function(a){if(typeof a!="string")throw"encodeHTML need a string as parameter";return a.replace(/\&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\u00A0/g,"&nbsp;").replace(/(\u0020|\u000B|\u2028|\u2029|\f)/g,"&#32;")}});STK.register("core.str.decodeHTML",function(a){return function(a){if(typeof a!="string")throw"decodeHTML need a string as parameter";return a.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/&#32;/g," ").replace(/&amp;/g,"&")}});STK.register("core.dom.cascadeNode",function(a){return function(b){var c={},d=b.style.display||"";d=d==="none"?"":d;var e=[];c.setStyle=function(e,f){a.core.dom.setStyle(b,e,f);e==="display"&&(d=f==="none"?"":f);return c};c.insertAfter=function(d){a.core.dom.insertAfter(d,b);return c};c.insertBefore=function(d){a.core.dom.insertBefore(d,b);return c};c.addClassName=function(d){a.core.dom.addClassName(b,d);return c};c.removeClassName=function(d){a.core.dom.removeClassName(b,d);return c};c.trimNode=function(){a.core.dom.trimNode(b);return c};c.removeNode=function(){a.core.dom.removeNode(b);return c};c.on=function(d,f){for(var g=0,h=e.length;g<h;g+=1)if(e[g].fn===f&&e[g].type===d)return c;e.push({fn:f,type:d});a.core.evt.addEvent(b,d,f);return c};c.unon=function(d,f){for(var g=0,h=e.length;g<h;g+=1)if(e[g].fn===f&&e[g].type===d){a.core.evt.removeEvent(b,f,d);e.splice(g,1);break}return c};c.fire=function(d){a.core.evt.fireEvent(d,b);return c};c.appendChild=function(a){b.appendChild(a);return c};c.removeChild=function(a){b.removeChild(a);return c};c.toggle=function(){b.style.display==="none"?b.style.display=d:b.style.display="none";return c};c.show=function(){b.style.display==="none"&&(d==="none"?b.style.display="":b.style.display=d);return c};c.hidd=function(){b.style.display!=="none"&&(b.style.display="none");return c};c.hide=c.hidd;c.scrollTo=function(a,d){a==="left"&&(b.scrollLeft=d);a==="top"&&(b.scrollTop=d);return c};c.replaceChild=function(a,d){b.replaceChild(a,d);return c};c.position=function(c){c!==undefined&&a.core.dom.setXY(b,c);return a.core.dom.position(b)};c.setPosition=function(d){d!==undefined&&a.core.dom.setXY(b,d);return c};c.getPosition=function(c){return a.core.dom.position(b)};c.html=function(a){a!==undefined&&(b.innerHTML=a);return b.innerHTML};c.setHTML=function(a){a!==undefined&&(b.innerHTML=a);return c};c.getHTML=function(){return b.innerHTML};c.text=function(c){c!==undefined&&(b.innerHTML=a.core.str.encodeHTML(c));return a.core.str.decodeHTML(b.innerHTML)};c.ttext=c.text;c.setText=function(d){d!==undefined&&(b.innerHTML=a.core.str.encodeHTML(d));return c};c.getText=function(){return a.core.str.decodeHTML(b.innerHTML)};c.get=function(c){return c==="node"?b:a.core.dom.getStyle(b,c)};c.getStyle=function(c){return a.core.dom.getStyle(b,c)};c.getOriginNode=function(){return b};c.destroy=function(){for(var c=0,f=e;c<f;c+=1)a.core.evt.removeEvent(b,e[c].fn,e[c].type);d=null;e=null;b=null};return c}});STK.register("core.dom.contains",function(a){return function(a,b){if(a===b)return!1;if(a.compareDocumentPosition)return(a.compareDocumentPosition(b)&16)===16;if(a.contains&&b.nodeType===1)return a.contains(b);while(b=b.parentNode)if(a===b)return!0;return!1}});STK.register("core.dom.dir",function(a){var b={parent:"parentNode",next:"nextSibling",prev:"previousSibling"},c=function(c,d){d=a.core.obj.parseParam({dir:"parent",expr:undefined,endpoint:document,matchAll:!1},d);var e=b[d.dir],f=d.expr,g=d.endpoint,h=!!d.matchAll;if(!c)throw"core.dom.dir: el is undefined.";if(!e)throw"core.dom.dir: spec.dir is undefined.";var i=[],j=c[e];while(j){if(j.nodeType==1)if(!f||a.core.dom.sizzle.matches(f,[j]).length>0){i.push(j);if(!h)break}if(j==g)break;j=j[e]}return i};c.parent=function(a,b){b=b||{};b.dir="parent";return c(a,b)};c.prev=function(a,b){b=b||{};b.dir="prev";return c(a,b)};c.next=function(a,b){b=b||{};b.dir="next";return c(a,b)};return c});STK.register("core.dom.firstChild",function(a){var b=a.core.dom.dir;return function(a){if(a.firstElementChild)return a.firstElementChild;var c=a.firstChild;c&&c.nodeType!=1&&(c=b.next(c)[0]);return c}});STK.register("core.util.hideContainer",function(a){var b,c=function(){if(!b){b=a.C("div");b.style.cssText="position:absolute;top:-9999px;left:-9999px;";document.getElementsByTagName("head")[0].appendChild(b)}},d={appendChild:function(d){if(a.core.dom.isNode(d)){c();b.appendChild(d)}},removeChild:function(c){a.core.dom.isNode(c)&&b&&b.removeChild(c)}};return d});STK.register("core.dom.getSize",function(a){var b=function(b){if(!a.core.dom.isNode(b))throw"core.dom.getSize need Element as first parameter";return{width:b.offsetWidth,height:b.offsetHeight}},c=function(a){var c=null;if(a.style.display==="none"){a.style.visibility="hidden";a.style.display="";c=b(a);a.style.display="none";a.style.visibility="visible"}else c=b(a);return c};return function(b){var d={};if(!b.parentNode){a.core.util.hideContainer.appendChild(b);d=c(b);a.core.util.hideContainer.removeChild(b)}else d=c(b);return d}});STK.register("core.dom.insertHTML",function(a){return function(b,c,d){b=a.E(b)||document.body;d=d?d.toLowerCase():"beforeend";if(b.insertAdjacentHTML){switch(d){case"beforebegin":b.insertAdjacentHTML("BeforeBegin",c);return b.previousSibling;case"afterbegin":b.insertAdjacentHTML("AfterBegin",c);return b.firstChild;case"beforeend":b.insertAdjacentHTML("BeforeEnd",c);return b.lastChild;case"afterend":b.insertAdjacentHTML("AfterEnd",c);return b.nextSibling}throw'Illegal insertion point -> "'+d+'"'}var e=b.ownerDocument.createRange(),f;switch(d){case"beforebegin":e.setStartBefore(b);f=e.createContextualFragment(c);b.parentNode.insertBefore(f,b);return b.previousSibling;case"afterbegin":if(b.firstChild){e.setStartBefore(b.firstChild);f=e.createContextualFragment(c);b.insertBefore(f,b.firstChild);return b.firstChild}b.innerHTML=c;return b.firstChild;case"beforeend":if(b.lastChild){e.setStartAfter(b.lastChild);f=e.createContextualFragment(c);b.appendChild(f);return b.lastChild}b.innerHTML=c;return b.lastChild;case"afterend":e.setStartAfter(b);f=e.createContextualFragment(c);b.parentNode.insertBefore(f,b.nextSibling);return b.nextSibling}throw'Illegal insertion point -> "'+d+'"'}});STK.register("core.dom.insertElement",function(a){return function(b,c,d){b=a.E(b)||document.body;d=d?d.toLowerCase():"beforeend";switch(d){case"beforebegin":b.parentNode.insertBefore(c,b);break;case"afterbegin":b.insertBefore(c,b.firstChild);break;case"beforeend":b.appendChild(c);break;case"afterend":b.nextSibling?b.parentNode.insertBefore(c,b.nextSibling):b.parentNode.appendChild(c)}}});STK.register("core.dom.ready",function(a){var b=[],c=!1,d=a.core.func.getType,e=a.core.util.browser,f=a.core.evt.addEvent,g=function(){return!c&&document.readyState==="complete"?!0:c},h=function(){if(c!=!0){c=!0;for(var a=0,e=b.length;a<e;a++)if(d(b[a])==="function")try{b[a].call()}catch(f){}b=[]}},i=function(){if(g())h();else{try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,25);return}h()}},j=function(){g()?h():setTimeout(arguments.callee,25)},k=function(){f(document,"DOMContentLoaded",h)},l=function(){f(window,"load",h)};if(!g()){a.IE&&window===window.top&&i();k();j();l()}return function(a){g()?d(a)==="function"&&a.call():b.push(a)}});STK.register("core.dom.isDomReady",function(a){var b=!1;a.core.dom.ready(function(){b=!0});return function(){return b}});STK.register("core.dom.lastChild",function(a){var b=a.core.dom.dir;return function(a){if(a.lastElementChild)return a.lastElementChild;var c=a.lastChild;c&&c.nodeType!=1&&(c=b.prev(c)[0]);return c}});STK.register("core.dom.neighbor",function(a){function b(b,c){a.log("warning",b,c)}var c=function(b,c,d){return b&&a.core.dom.dir(b,{dir:c,expr:d})[0]},d=function(d){var e=d,f={getCurrent:function(){return e},setCurrent:function(a){a&&(e=a);return f},finish:function(){var a=e;e=null;return a},parent:function(a){var d=c(e,"parent",a);d?e=d:b("parent",a);return f},child:function(c){var d=c?a.core.dom.sizzle(c,e)[0]:a.core.dom.firstChild(e);d?e=d:b("child",c);return f},firstChild:function(){var c=a.core.dom.firstChild(e);c?e=c:b("firstChild");return f},lastChild:function(){var c=a.core.dom.lastChild(e);c?e=c:b("lastChild");return f},prev:function(a){var d=c(e,"prev",a);d?e=d:b("prev",a);return f},next:function(a){var d=c(e,"next",a);d?e=d:b("next",a);return f},destroy:function(){e=null}};return f};return d});STK.register("core.dom.next",function(a){return function(a){var b=a.nextSibling;while(b&&b.nodeType!==1)b=b.nextSibling;return b}});STK.register("core.dom.prev",function(a){return function(a){var b=a.previousSibling;while(b&&b.nodeType!==1)b=b.previousSibling;return b}});STK.register("core.dom.replaceNode",function(a){return function(a,b){if(a==null||b==null)throw"replaceNode need node as paramster";b.parentNode.replaceChild(a,b)}});STK.register("core.dom.selector",function(a){var b=function(b,c,d,e){var f=[];if(typeof b=="string"){var g=a.core.dom.sizzle(b,c,d,e);for(var h=0,i=g.length;h<i;h+=1)f[h]=g[h]}else if(a.core.dom.isNode(b))c?a.core.dom.contains(c,b)&&(f=[b]):f=[b];else if(a.core.arr.isArray(b))if(c)for(var h=0,i=b.length;h<i;h+=1)a.core.dom.contains(c,b[h])&&f.push(b[h]);else f=b;return f};return function(c,d,e,f){var g=b.apply(window,arguments);g.on=function(b,c){for(var d=0,e=g.length;d<e;d+=1)a.core.evt.addEvent(g[d],b,c);return g};g.css=function(b,c){for(var d=0,e=g.length;d<e;d+=1)a.core.dom.setStyle(g[d],b,c);return g};g.show=function(){for(var a=0,b=g.length;a<b;a+=1)g[a].style.display="";return g};g.hidd=function(){for(var a=0,b=g.length;a<b;a+=1)g[a].style.display="none";return g};g.hide=g.hidd;return g}});STK.register("core.dom.selectText",function(a){return function(a,b){var c=b.start,d=b.len||0;a.focus();if(a.setSelectionRange)a.setSelectionRange(c,c+d);else if(a.createTextRange){var e=a.createTextRange();e.collapse(1);e.moveStart("character",c);e.moveEnd("character",d);e.select()}}});STK.register("core.dom.setStyles",function(a){return function(b,c,d){if(!a.core.arr.isArray(b))var b=[b];for(var e=0,f=b.length;e<f;e++)a.core.dom.setStyle(b[e],c,d);return b}});STK.register("core.dom.textSelectArea",function(a){return function(a){var b={start:0,len:0};if(typeof a.selectionStart=="number"){b.start=a.selectionStart;b.len=a.selectionEnd-a.selectionStart}else if(typeof document.selection!="undefined"){var c=document.selection.createRange();if(a.tagName==="INPUT")var d=a.createTextRange();else if(a.tagName==="TEXTAREA"){var d=c.duplicate();d.moveToElementText(a)}d.setEndPoint("EndToStart",c);b.start=d.text.length;b.len=c.text.length;var e=0;d.moveEnd("character",a.value.length-b.start);d.moveStart("character",b.start);for(var f=b.start;f<a.value.length;f+=1){if(!(d.compareEndPoints("StartToStart",c)<0))break;d.moveStart("character",1);e+=2}b.start+=e;c=null;d=null}return b}});STK.register("core.dom.toggleClassName",function(a){return function(b,c){a.core.dom.hasClassName(b,c)?a.core.dom.removeClassName(b,c):a.core.dom.addClassName(b,c)}});STK.register("core.util.getUniqueKey",function(a){var b=(new Date).getTime().toString(),c=1;return function(){return b+c++}});STK.register("core.dom.uniqueID",function(a){return function(b){return b&&(b.uniqueID||(b.uniqueID=a.core.util.getUniqueKey()))}});STK.register("core.evt.custEvent",function(a){var b="__custEventKey__",c=1,d={},e=function(a,c){var e=typeof a=="number"?a:a[b];return e&&d[e]&&{obj:typeof c=="string"?d[e][c]:d[e],key:e}},f={},g=function(a,b,c,d,f){if(a&&typeof b=="string"&&c){var g=e(a,b);if(!g||!g.obj)throw"custEvent ("+b+") is undefined !";g.obj.push({fn:c,data:d,once:f});return g.key}},h=function(b,c,d,f){var g=!0,h=function(){g=!1};if(b&&typeof c=="string"){var i=e(b,c),j;if(i&&(j=i.obj)){d=typeof d!="undefined"&&[].concat(d)||[];for(var k=j.length-1;k>-1&&j[k];k--){var l=j[k].fn,m=j[k].once;if(l&&l.apply)try{l.apply(b,[{obj:b,type:c,data:j[k].data,preventDefault:h}].concat(d));m&&j.splice(k,1)}catch(n){a.log("[error][custEvent]"+n.message,n,n.stack)}}g&&a.core.func.getType(f)==="function"&&f();return i.key}}},i={define:function(a,e){if(a&&e){var f=typeof a=="number"?a:a[b]||(a[b]=c++),g=d[f]||(d[f]={});e=[].concat(e);for(var h=0;h<e.length;h++)g[e[h]]||(g[e[h]]=[]);return f}},undefine:function(a,c){if(a){var e=typeof a=="number"?a:a[b];if(e&&d[e])if(c){c=[].concat(c);for(var f=0;f<c.length;f++)c[f]in d[e]&&delete d[e][c[f]]}else delete d[e]}},add:function(a,b,c,d){return g(a,b,c,d,!1)},once:function(a,b,c,d){return g(a,b,c,d,!0)},remove:function(b,c,d){if(b){var f=e(b,c),g,h;if(f&&(g=f.obj)){if(a.core.arr.isArray(g))if(d){var i=0;while(g[i]){if(g[i].fn===d)break;i++}g.splice(i,1)}else g.splice(0,g.length);else for(var i in g)g[i]=[];return f.key}}},fire:function(a,b,c,d){return h(a,b,c,d)},hook:function(a,e,g){if(!(!a||!e||!g)){var j=[],k=a[b],l=k&&d[k],m,n=e[b]||(e[b]=c++),o;if(l){o=f[k+"_"+n]||(f[k+"_"+n]={});var p=function(a){var b=!0;h(e,o[a.type].type,Array.prototype.slice.apply(arguments,[1,arguments.length]),function(){b=!1});b&&a.preventDefault()};for(var q in g){var r=g[q];if(!o[q])if(m=l[q]){m.push({fn:p,data:undefined});o[q]={fn:p,type:r};j.push(r)}}i.define(e,j)}}},unhook:function(a,c,d){if(!(!a||!c||!d)){var e=a[b],g=c[b],h=f[e+"_"+g];if(h)for(var j in d){var k=d[j];h[j]&&i.remove(a,j,h[j].fn)}}},destroy:function(){d={};c=1;f={}}};return i});STK.register("core.json.queryToJson",function(a){return function(b,c){var d=a.core.str.trim(b).split("&"),e={},f=function(a){return c?decodeURIComponent(a):a};for(var g=0,h=d.length;g<h;g++)if(d[g]){var i=d[g].split("="),j=i[0],k=i[1];if(i.length<2){k=j;j="$nullName"}if(!e[j])e[j]=f(k);else{a.core.arr.isArray(e[j])!=!0&&(e[j]=[e[j]]);e[j].push(f(k))}}return e}});STK.register("core.evt.getEvent",function(a){return function(){return document.addEventListener?function(){var a=arguments.callee,b;do{b=a.arguments[0];if(b&&(b.constructor==Event||b.constructor==MouseEvent||b.constructor==KeyboardEvent))return b}while(a=a.caller);return b}:function(a,b,c){return window.event}}()});STK.register("core.evt.fixEvent",function(a){var b="clientX clientY pageX pageY screenX screenY".split(" ");return function(b){b=b||a.core.evt.getEvent();b.target||(b.target=b.srcElement||document);if(b.pageX==null&&b.clientX!=null){var c=document.documentElement,d=document.body;b.pageX=b.clientX+(c.scrollLeft||d&&d.scrollLeft||0)-(c.clientLeft||d&&d.clientLeft||0);b.pageY=b.clientY+(c.scrollTop||d&&d.scrollTop||0)-(c.clientTop||d&&d.clientTop||0)}!b.which&&b.button&&(b.button&1?b.which=1:b.button&4?b.which=2:b.button&2&&(b.which=3));b.relatedTarget===undefined&&(b.relatedTarget=b.fromElement||b.toElement);if(b.layerX==null&&b.offsetX!=null){b.layerX=b.offsetX;b.layerY=b.offsetY}return b}});STK.register("core.obj.isEmpty",function(a){return function(a,b){for(var c in a)if(b||a.hasOwnProperty(c))return!1;return!0}});STK.register("core.evt.delegatedEvent",function(a){var b=function(b,c){for(var d=0,e=b.length;d<e;d+=1)if(a.core.dom.contains(b[d],c))return!0;return!1};return function(c,d){if(!a.core.dom.isNode(c))throw"core.evt.delegatedEvent need an Element as first Parameter";d||(d=[]);a.core.arr.isArray(d)&&(d=[d]);var e={},f=function(b){var c=a.core.evt.fixEvent(b),d=c.target,e=b.type;g(d,e,c)},g=function(f,g,h){var i=null,j=function(){var b,d,e;b=f.getAttribute("action-target");if(b){d=a.core.dom.sizzle(b,c);d.length&&(e=h.target=d[0])}j=a.core.func.empty;return e},k=function(){var b=j()||f;return e[g]&&e[g][i]?e[g][i]({evt:h,el:b,box:c,data:a.core.json.queryToJson(b.getAttribute("action-data")||"")}):!0};if(b(d,f))return!1;if(!a.core.dom.contains(c,f))return!1;while(f&&f!==c){if(f.nodeType===1){i=f.getAttribute("action-type");if(i&&k()===!1)break}f=f.parentNode}},h={};h.add=function(b,d,g){if(!e[d]){e[d]={};a.core.evt.addEvent(c,d,f)}var h=e[d];h[b]=g};h.remove=function(b,d){if(e[d]){delete e[d][b];if(a.core.obj.isEmpty(e[d])){delete e[d];a.core.evt.removeEvent(c,d,f)}}};h.pushExcept=function(a){d.push(a)};h.removeExcept=function(a){if(!a)d=[];else for(var b=0,c=d.length;b<c;b+=1)d[b]===a&&d.splice(b,1)};h.clearExcept=function(a){d=[]};h.fireAction=function(b,d,f,g){var h="";g&&g.actionData&&(h=g.actionData);e[d]&&e[d][b]&&e[d][b]({evt:f,el:null,box:c,data:a.core.json.queryToJson(h),fireFrom:"fireAction"})};h.fireInject=function(b,d,f){var g=b.getAttribute("action-type"),h=b.getAttribute("action-data");g&&e[d]&&e[d][g]&&e[d][g]({evt:f,el:b,box:c,data:a.core.json.queryToJson(h||""),fireFrom:"fireInject"})};h.fireDom=function(a,b,c){g(a,b,c||{})};h.destroy=function(){for(var b in e){for(var d in e[b])delete e[b][d];delete e[b];a.core.evt.removeEvent(c,b,f)}};return h}});STK.register("core.evt.getActiveElement",function(a){return function(){try{var b=a.core.evt.getEvent();return document.activeElement?document.activeElement:b.explicitOriginalTarget}catch(c){return document.body}}});STK.register("core.evt.hasEvent",function(a){var b={};return function(c,d){if(typeof d!="string")throw new Error("[STK.core.evt.hasEvent] tagName is not a String!");d=d.toLowerCase();c="on"+c;if(b[d]&&b[d][c]!==undefined)return b[d][c];var e=a.C(d),f=c in e;if(!f){e.setAttribute(c,"return;");f=typeof e[c]=="function"}b[d]||(b[d]={});b[d][c]=f;e=null;return f}});STK.register("core.evt.hitTest",function(a){function b(b){var c=STK.E(b),d=a.core.dom.position(c),e={left:d.l,top:d.t,right:d.l+c.offsetWidth,bottom:d.t+c.offsetHeight};return e}return function(c,d){var e=b(c);if(d==null)d=a.core.evt.getEvent();else{if(d.nodeType==1){var f=b(d);return e.right>f.left&&e.left<f.right&&e.bottom>f.top&&e.top<f.bottom?!0:!1}if(d.clientX==null)throw"core.evt.hitTest: ["+d+":oEvent] is not a valid value"}var g=a.core.util.scrollPos(),h=d.clientX+g.left,i=d.clientY+g.top;return h>=e.left&&h<=e.right&&i>=e.top&&i<=e.bottom}});STK.register("core.evt.stopEvent",function(a){return function(b){b=b||a.core.evt.getEvent();if(b.preventDefault){b.preventDefault();b.stopPropagation()}else{b.cancelBubble=!0;b.returnValue=!1}return!1}});STK.register("core.evt.preventDefault",function(a){return function(b){b=b||a.core.evt.getEvent();b.preventDefault?b.preventDefault():b.returnValue=!1}});STK.register("core.evt.hotKey",function(a){var b=a.core.dom.uniqueID,c={reg1:/^keypress|keydown|keyup$/,keyMap:{27:"esc",9:"tab",32:"space",10:"enter",13:"enter",8:"backspace",145:"scrollclock",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"delete",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",191:"/",17:"ctrl",16:"shift",109:"-",107:"=",219:"[",221:"]",220:"\\",222:"'",187:"=",188:",",189:"-",190:".",191:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",110:".",111:"/"},keyEvents:{}};c.preventDefault=function(){this.returnValue=!1};c.handler=function(a){a=a||window.event;a.target||(a.target=a.srcElement||document);!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode)&&(a.which=a.charCode||a.keyCode);a.preventDefault||(a.preventDefault=c.preventDefault);var d=b(this),e,f;if(d&&(e=c.keyEvents[d])&&(f=e[a.type])){var g;switch(a.type){case"keypress":if(a.ctrlKey||a.altKey)return;a.which==13&&(g=c.keyMap[13]);a.which==32&&(g=c.keyMap[32]);a.which>=33&&a.which<=126&&(g=String.fromCharCode(a.which));break;case"keyup":case"keydown":c.keyMap[a.which]&&(g=c.keyMap[a.which]);g||(a.which>=48&&a.which<=57?g=String.fromCharCode(a.which):a.which>=65&&a.which<=90&&(g=String.fromCharCode(a.which+32)));if(g&&a.type=="keydown"){e.linkedKey+=e.linkedKey?">"+g:g;a.altKey&&(g="alt+"+g);a.shiftKey&&(g="shift+"+g);a.ctrlKey&&(g="ctrl+"+g)}}var h=/^select|textarea|input$/.test(a.target.nodeName.toLowerCase());if(g){var i=[],j=!1;if(e.linkedKey&&e.linkKeyStr)if(e.linkKeyStr.indexOf(" "+e.linkedKey)!=-1){if(e.linkKeyStr.indexOf(" "+e.linkedKey+" ")!=-1){i=i.concat(f[e.linkedKey]);e.linkedKey=""}j=!0}else e.linkedKey="";j||(i=i.concat(f[g]));for(var k=0;k<i.length;k++)i[k]&&(!i[k].disableInInput||!h)&&i[k].fn.apply(this,[a,i[k].key])}}};var d=function(b,d,e,f){var g={};if(!a.core.dom.isNode(b)||a.core.func.getType(e)!=="function")return g;if(typeof d!="string"||!(d=d.replace(/\s*/g,"")))return g;f||(f={});f.disableInInput||(f.disableInInput=!1);f.type||(f.type="keypress");f.type=f.type.replace(/\s*/g,"");if(!c.reg1.test(f.type)||f.disableInInput&&/^select|textarea|input$/.test(b.nodeName.toLowerCase()))return g;if(d.length>1||f.type!="keypress")d=d.toLowerCase();if(!/(^(\+|>)$)|(^([^\+>]+)$)/.test(d)){var h="";if(/((ctrl)|(shift)|(alt))\+(\+|([^\+]+))$/.test(d)){d.indexOf("ctrl+")!=-1&&(h+="ctr+");d.indexOf("shift+")!=-1&&(h+="shift+");d.indexOf("alt+")!=-1&&(h+="alt+");h+=d.match(/\+(([^\+]+)|(\+))$/)[1]}else if(!/(^>)|(>$)|>>/.test(d)&&d.length>2)g.linkFlag=!0;else return g;f.type="keydown"}g.keys=d;g.fn=e;g.opt=f;return g},e={add:function(f,g,h,i){if(a.core.arr.isArray(g))for(var j=0;j<g.length;j++)e.add(f,g[j],h,i);else{var k=d(f,g,h,i);if(!k.keys)return;g=k.keys;h=k.fn;i=k.opt;var l=k.linkFlag,m=b(f);c.keyEvents[m]||(c.keyEvents[m]={linkKeyStr:"",linkedKey:""});c.keyEvents[m].handler||(c.keyEvents[m].handler=function(){c.handler.apply(f,arguments)});l&&c.keyEvents[m].linkKeyStr.indexOf(" "+g+" ")==-1&&(c.keyEvents[m].linkKeyStr+=" "+g+" ");var n=i.type;if(!c.keyEvents[m][n]){c.keyEvents[m][n]={};a.core.evt.addEvent(f,n,c.keyEvents[m].handler)}c.keyEvents[m][n][g]||(c.keyEvents[m][n][g]=[]);c.keyEvents[m][n][g].push({fn:h,disableInInput:i.disableInInput,key:g})}},remove:function(f,g,h,i){if(a.core.arr.isArray(g))for(var j=0;j<g.length;j++)e.remove(f,g[j],h,i);else{var k=d(f,g,h,i);if(!k.keys)return;g=k.keys;h=k.fn;i=k.opt;var l=k.linkFlag,m=b(f),n,o,p,q=i.type;if(m&&(n=c.keyEvents[m])&&(o=n[q])&&n.handler&&(p=o[g])){for(var j=0;j<p.length;)p[j].fn===h?p.splice(j,1):j++;p.length<1&&delete o[g];var r=!1;for(var s in o){r=!0;break}if(!r){a.core.evt.removeEvent(f,q,n.handler);delete n[q]}l&&n.linkKeyStr&&(n.linkKeyStr=n.linkKeyStr.replace(" "+g+" ",""))}}}};return e});STK.register("core.func.bind",function(a){return function(b,c,d){d=a.core.arr.isArray(d)?d:[d];return function(){return c.apply(b,d)}}});STK.register("core.func.memorize",function(a){return function(a,b){if(typeof a!="function")throw"core.func.memorize need a function as first parameter";b=b||{};var c={};b.timeout&&setInterval(function(){c={}},b.timeout);return function(){var d=Array.prototype.join.call(arguments,"_");d in c||(c[d]=a.apply(b.context||{},arguments));return c[d]}}});STK.register("core.func.methodBefore",function(a){return function(){var b=!1,c=[],d={};d.add=function(d,e){var f=a.core.obj.parseParam({args:[],pointer:window,top:!1},e);f.top==!0?c.unshift([d,f.args,f.pointer]):c.push([d,f.args,f.pointer]);return!b};d.start=function(){var a,d,e,f,g;if(b!=!0){b=!0;for(a=0,d=c.length;a<d;a++){e=c[a][0];f=c[a][1];g=c[a][2];e.apply(g,f)}}};d.reset=function(){c=[];b=!1};d.getList=function(){return c};return d}});STK.register("core.func.timedChunk",function(a){var b={process:function(a){typeof a=="function"&&a()},context:{},callback:null,delay:25,execTime:50};return function(c,d){if(!a.core.arr.isArray(c))throw"core.func.timedChunk need an array as first parameter";var e=c.concat(),f=a.core.obj.parseParam(b,d),g=null,h=function(){var a=+(new Date);do f.process.call(f.context,e.shift());while(e.length>0&&+(new Date)-a<f.execTime);e.length<=0?f.callback&&f.callback(c):setTimeout(arguments.callee,f.delay)};g=setTimeout(h,f.delay)}});STK.register("core.io.getXHR",function(a){return function(){var a=!1;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(d){a=!1}}}return a}});STK.register("core.str.parseURL",function(a){return function(a){var b=/^(?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,c=["url","scheme","slash","host","port","path","query","hash"],d=b.exec(a),e={};for(var f=0,g=c.length;f<g;f+=1)e[c[f]]=d[f]||"";return e}});STK.register("core.json.jsonToQuery",function(a){var b=function(b,c){b=b==null?"":b;b=a.core.str.trim(b.toString());return c?encodeURIComponent(b):b};return function(a,c){var d=[];if(typeof a=="object")for(var e in a){if(e==="$nullName"){d=d.concat(a[e]);continue}if(a[e]instanceof Array)for(var f=0,g=a[e].length;f<g;f++)d.push(e+"="+b(a[e][f],c));else typeof a[e]!="function"&&d.push(e+"="+b(a[e],c))}return d.length?d.join("&"):""}});STK.register("core.util.URL",function(a){return function(b,c){var d=a.core.obj.parseParam({isEncodeQuery:!1,isEncodeHash:!1},c||{}),e={},f=a.core.str.parseURL(b),g=a.core.json.queryToJson(f.query),h=a.core.json.queryToJson(f.hash);e.setParam=function(a,b){g[a]=b;return this};e.getParam=function(a){return g[a]};e.setParams=function(a){for(var b in a)e.setParam(b,a[b]);return this};e.setHash=function(a,b){h[a]=b;return this};e.getHash=function(a){return h[a]};e.valueOf=e.toString=function(){var b=[],c=a.core.json.jsonToQuery(g,d.isEncodeQuery),e=a.core.json.jsonToQuery(h,d.isEncodeQuery);if(f.scheme!=""){b.push(f.scheme+":");b.push(f.slash)}if(f.host!=""){b.push(f.host);if(f.port!=""){b.push(":");b.push(f.port)}}b.push("/");b.push(f.path);c!=""&&b.push("?"+c);e!=""&&b.push("#"+e);return b.join("")};return e}});STK.register("core.json.strToJson",function($){var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;return function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)if(Object.prototype.hasOwnProperty.call(e,c)){d=walk(e,c);d!==undefined?e[c]=d:delete e[c]}return reviver.call(a,b,e)}if(window.JSON&&window.JSON.parse)return window.JSON.parse(text,reviver);var j;text=String(text);cx.lastIndex=0;cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}});STK.register("core.io.ajax",function($){return function(oOpts){var opts=$.core.obj.parseParam({url:"",charset:"UTF-8",timeout:3e4,args:{},onComplete:null,onTimeout:$.core.func.empty,uniqueID:null,onFail:$.core.func.empty,method:"get",asynchronous:!0,header:{},isEncode:!1,responseType:"json"},oOpts);if(opts.url=="")throw"ajax need url in parameters object";var tm,trans=$.core.io.getXHR(),cback=function(){if(trans.readyState==4){clearTimeout(tm);var data="";if(opts.responseType==="xml")data=trans.responseXML;else if(opts.responseType==="text")data=trans.responseText;else try{trans.responseText&&typeof trans.responseText=="string"?data=eval("("+trans.responseText+")"):data={}}catch(exp){data=opts.url+"return error : data error"}trans.status==200?opts.onComplete!=null&&opts.onComplete(data):trans.status!=0&&opts.onFail!=null&&opts.onFail(data,trans)}else opts.onTraning!=null&&opts.onTraning(trans)};trans.onreadystatechange=cback;opts.header["Content-Type"]||(opts.header["Content-Type"]="application/x-www-form-urlencoded");opts.header["X-Requested-With"]||(opts.header["X-Requested-With"]="XMLHttpRequest");if(opts.method.toLocaleLowerCase()=="get"){var url=$.core.util.URL(opts.url,{isEncodeQuery:opts.isEncode});url.setParams(opts.args);url.setParam("__rnd",(new Date).valueOf());trans.open(opts.method,url.toString(),opts.asynchronous);try{for(var k in opts.header)trans.setRequestHeader(k,opts.header[k])}catch(exp){}trans.send("")}else{trans.open(opts.method,opts.url,opts.asynchronous);try{for(var k in opts.header)trans.setRequestHeader(k,opts.header[k])}catch(exp){}trans.send($.core.json.jsonToQuery(opts.args,opts.isEncode))}opts.timeout&&(tm=setTimeout(function(){try{trans.abort();opts.onTimeout({},trans);opts.onFail({},trans)}catch(a){}},opts.timeout));return trans}});STK.register("core.io.scriptLoader",function(a){var b={},c={url:"",charset:"UTF-8",timeout:3e4,args:{},onComplete:a.core.func.empty,onTimeout:a.core.func.empty,isEncode:!1,uniqueID:null};return function(d){var e,f,g=a.core.obj.parseParam(c,d);if(g.url=="")throw"scriptLoader: url is null";var h=g.uniqueID||a.core.util.getUniqueKey();e=b[h];if(e!=null&&a.IE!=!0){a.core.dom.removeNode(e);e=null}e==null&&(e=b[h]=a.C("script"));e.charset=g.charset;e.id="scriptRequest_script_"+h;e.type="text/javascript";g.onComplete!=null&&(a.IE?e.onreadystatechange=function(){if(e.readyState.toLowerCase()=="loaded"||e.readyState.toLowerCase()=="complete"){try{clearTimeout(f);document.getElementsByTagName("head")[0].removeChild(e);e.onreadystatechange=null}catch(a){}g.onComplete()}}:e.onload=function(){try{clearTimeout(f);a.core.dom.removeNode(e)}catch(b){}g.onComplete()});e.src=a.core.util.URL(g.url,{isEncodeQuery:g.isEncode}).setParams(g.args).toString();document.getElementsByTagName("head")[0].appendChild(e);g.timeout>0&&(f=setTimeout(function(){try{document.getElementsByTagName("head")[0].removeChild(e)}catch(a){}g.onTimeout()},g.timeout));return e}});STK.register("core.io.jsonp",function(a){return function(b){var c=a.core.obj.parseParam({url:"",charset:"UTF-8",timeout:3e4,args:{},onComplete:null,onTimeout:null,responseName:null,isEncode:!1,varkey:"callback"},b),d=-1,e=c.responseName||"STK_"+a.core.util.getUniqueKey();c.args[c.varkey]=e;var f=c.onComplete,g=c.onTimeout;window[e]=function(a){if(d!=2&&f!=null){d=1;f(a)}};c.onComplete=null;c.onTimeout=function(){if(d!=1&&g!=null){d=2;g()}};return a.core.io.scriptLoader(c)}});STK.register("core.util.templet",function(a){return function(a,b){return a.replace(/#\{(.+?)\}/ig,function(){var a=arguments[1].replace(/\s/ig,""),c=arguments[0],d=a.split("||");for(var e=0,f=d.length;e<f;e+=1){if(/^default:.*$/.test(d[e])){c=d[e].replace(/^default:/,"");break}if(b[d[e]]!==undefined){c=b[d[e]];break}}return c})}});STK.register("core.io.getIframeTrans",function(a){var b='<iframe id="#{id}" name="#{id}" height="0" width="0" frameborder="no"></iframe>';return function(c){var d,e,f;e=a.core.obj.parseParam({id:"STK_iframe_"+a.core.util.getUniqueKey()},c);f={};d=a.C("DIV");d.innerHTML=a.core.util.templet(b,e);a.core.util.hideContainer.appendChild(d);f.getId=function(){return e.id};f.destroy=function(){d.innerHTML="";try{d.getElementsByTagName("iframe")[0].src="about:blank"}catch(b){}a.core.util.hideContainer.removeChild(d);d=null};return f}});STK.register("core.io.require",function(a){var b="http://js.t.sinajs.cn/STK/js/",c=function(a,b){var c=b.split("."),d=a,e=null;while(e=c.shift()){d=d[e];if(d===undefined)return!1}return!0},d=[],e=function(b){if(a.core.arr.indexOf(b,d)!==-1)return!1;d.push(b);a.core.io.scriptLoader({url:b,callback:function(){a.core.arr.foreach(d,function(a,c){if(a===b){d.splice(c,1);return!1}})}});return!1},f=function(d,f,g){var h=null;for(var i=0,j=d.length;i<j;i+=1){var k=d[i];typeof k=="string"?c(a,k)||e(b+k.replace(/\./ig,"/")+".js"):c(window,k.NS)||e(k.url)}var l=function(){for(var b=0,e=d.length;b<e;b+=1){var i=d[b];if(typeof i=="string"){if(!c(a,i)){h=setTimeout(l,25);return!1}}else if(!c(window,i.NS)){h=setTimeout(l,25);return!1}}clearTimeout(h);f.apply({},[].concat(g))};h=setTimeout(l,25)};f.setBaseURL=function(a){if(typeof a!="string")throw"[STK.kit.extra.require.setBaseURL] need string as frist parameter";b=a};return f});STK.register("core.io.ijax",function(a){return function(b){var c,d,e,f,g,h,i;c=a.core.obj.parseParam({url:"",form:null,args:{},uniqueID:null,timeout:3e4,onComplete:a.core.func.empty,onTimeout:a.core.func.empty,onFail:a.core.func.empty,asynchronous:!0,isEncode:!0,abaurl:null,responseName:null,varkey:"callback",abakey:"callback"},b);i={};if(c.url=="")throw"ijax need url in parameters object";if(!c.form)throw"ijax need form in parameters object";d=a.core.io.getIframeTrans();e=c.responseName||"STK_ijax_"+a.core.util.getUniqueKey();h={};h[c.varkey]=e;if(c.abaurl){c.abaurl=a.core.util.URL(c.abaurl).setParams(h);h={};h[c.abakey]=c.abaurl.toString()}c.url=a.core.util.URL(c.url,{isEncodeQuery:c.isEncode}).setParams(h).setParams(c.args);g=function(){window[e]=null;d.destroy();d=null;clearTimeout(f)};f=setTimeout(function(){try{c.onTimeout();c.onFail()}catch(a){}finally{g()}},c.timeout);window[e]=function(a,b){try{c.onComplete(a,b)}catch(d){}finally{g()}};c.form.action=c.url.toString();c.form.target=d.getId();c.form.submit();i.abort=g;return i}});STK.register("core.json.clone",function(a){function b(a){var c;if(a instanceof Array){c=[];var d=a.length;while(d--)c[d]=b(a[d]);return c}if(a instanceof Object){c={};for(var e in a)c[e]=b(a[e]);return c}return a}return b});STK.register("core.json.include",function(a){return function(a,b){for(var c in b)if(typeof b[c]=="object")if(b[c]instanceof Array){if(!(a[c]instanceof Array))return!1;if(b[c].length!==a[c].length)return!1;for(var d=0,e=b[c].length;d<e;d+=1)if(!arguments.callee(b[c][d],a[c][d]))return!1}else{if(typeof a[c]!="object")return!1;if(!arguments.callee(b[c],a[c]))return!1}else if(typeof b[c]=="number"||typeof b[c]=="string"){if(b[c]!==a[c])return!1}else if(b[c]!==undefined&&b[c]!==null){if(a[c]===undefined||a[c]===null)return!1;if(!b[c].toString||!a[c].toString)throw"json1[k] or json2[k] do not have toString method";if(b[c].toString()!==a[c].toString())return!1}return!0}});STK.register("core.json.compare",function(a){return function(b,c){return a.core.json.include(b,c)&&a.core.json.include(c,b)?!0:!1}});STK.register("core.json.jsonToStr",function(a){function d(a){return a<10?"0"+a:a}function c(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=i[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(a,d){var e,f,i,k,l=g,m,n=d[a];n&&typeof n=="object"&&typeof n.toJSON=="function"&&(n=n.toJSON(a));typeof j=="function"&&(n=j.call(d,a,n));switch(typeof n){case"string":return c(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";g+=h;m=[];if(Object.prototype.toString.apply(n)==="[object Array]"){k=n.length;for(e=0;e<k;e+=1)m[e]=b(e,n)||"null";i=m.length===0?"[]":g?"[\n"+g+m.join(",\n"+g)+"\n"+l+"]":"["+m.join(",")+"]";g=l;return i}if(j&&typeof j=="object"){k=j.length;for(e=0;e<k;e+=1){f=j[e];if(typeof f=="string"){i=b(f,n);i&&m.push(c(f)+(g?": ":":")+i)}}}else for(f in n)if(Object.hasOwnProperty.call(n,f)){i=b(f,n);i&&m.push(c(f)+(g?": ":":")+i)}i=m.length===0?"{}":g?"{\n"+g+m.join(",\n"+g)+"\n"+l+"}":"{"+m.join(",")+"}";g=l;return i}}if(typeof Date.prototype.toJSON!="function"){Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,h,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;return function(a,c,d){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(a,c,d);var e;g="";h="";if(typeof d=="number")for(e=0;e<d;e+=1)h+=" ";else typeof d=="string"&&(h=d);j=c;if(!c||typeof c=="function"||typeof c=="object"&&typeof c.length=="number")return b("",{"":a});throw new Error("JSON.stringify")}});STK.register("core.obj.beget",function(a){var b=function(){};return function(a){b.prototype=a;return new b}});STK.register("core.obj.cascade",function(a){return function(a,b){for(var c=0,d=b.length;c<d;c+=1){if(typeof a[b[c]]!="function")throw"cascade need function list as the second paramsters";a[b[c]]=function(b){return function(){b.apply(a,arguments);return a}}(a[b[c]])}}});STK.register("core.obj.clear",function(a){return function(a){var b,c={};for(b in a)a[b]!=null&&(c[b]=a[b]);return c}});STK.register("core.obj.cut",function(a){return function(b,c){var d={};if(!a.core.arr.isArray(c))throw"core.obj.cut need array as second parameter";for(var e in b)a.core.arr.inArray(e,c)||(d[e]=b[e]);return d}});STK.register("core.obj.sup",function(a){return function(a,b){var c={};for(var d=0,e=b.length;d<e;d+=1){if(typeof a[b[d]]!="function")throw"super need function list as the second paramsters";c[b[d]]=function(b){return function(){return b.apply(a,arguments)}}(a[b[d]])}return c}});STK.register("core.str.bLength",function(a){return function(a){if(!a)return 0;var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)}});STK.register("core.str.dbcToSbc",function(a){return function(a){return a.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u3000/g," ")}});STK.register("core.str.parseHTML",function(a){return function(a){var b=/[^<>]+|<(\/?)([A-Za-z0-9]+)([^<>]*)>/g,c,d,e=[];while(c=b.exec(a)){var f=[];for(d=0;d<c.length;d+=1)f.push(c[d]);e.push(f)}return e}});STK.register("core.str.leftB",function(a){return function(b,c){var d=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");b=b.slice(0,d.slice(0,c).replace(/\*\*/g," ").replace(/\*/g,"").length);a.core.str.bLength(b)>c&&c>0&&(b=b.slice(0,b.length-1));return b}});STK.register("core.str.queryString",function(a){return function(b,c){var d=a.core.obj.parseParam({source:window.location.search.substr(1),split:"&"},c),e=(new RegExp("(^|"+d.split+")"+b+"=([^\\"+d.split+"]*)(\\"+d.split+"|$)","gi")).exec(d.source),f;return(f=e)?f[2]:null}});STK.register("core.util.cookie",function(a){var b={set:function(b,c,d){var e=[],f,g,h=a.core.obj.parseParam({expire:null,path:"/",domain:null,secure:null,encode:!0},d);h.encode==!0&&(c=escape(c));e.push(b+"="+c);h.path!=null&&e.push("path="+h.path);h.domain!=null&&e.push("domain="+h.domain);h.secure!=null&&e.push(h.secure);if(h.expire!=null){f=new Date;g=f.getTime()+h.expire*36e5;f.setTime(g);e.push("expires="+f.toGMTString())}document.cookie=e.join(";")},get:function(a){a=a.replace(/([\.\[\]\$])/g,"\\$1");var b=new RegExp(a+"=([^;]*)?;","i"),c=document.cookie+";",d=c.match(b);return d?d[1]||"":""},remove:function(a,c){c=c||{};c.expire=-10;b.set(a,"",c)}};return b});STK.register("core.util.connect",function(a){var b={},c={},d=0,e=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},f=function(){return++d+""+(new Date).getTime()},g=function(b,d,f,g){if(!e(c,b))return!1;var h=c[b];if(!e(h.callback,d))return!1;var i=h.callback[d].onSuccess,j=h.callback[d].onError,k=a.core.json.jsonToStr(g||{});setTimeout(function(){var b=a.core.json.strToJson(k);if(f){b.type="error";j(b,d)}else i(b,d)},0);delete h.callback[d];return!0};b.request=function(b){var d=b.sid;if(!d||typeof d!="string")return-1;if(!e(c,d))return-1;var h=c[d],i=f(),j=a.core.json.jsonToStr(b.data||{});h.callback[i]={onSuccess:b.onSuccess||a.core.func.empty,onError:b.onError||a.core.func.empty};var k=function(a){g(d,i,a.error,a.data)};setTimeout(function(){h.handle(k,a.core.json.strToJson(j),i)},0);return i};b.create=function(b){if(!b)return!1;var d=b.sid;if(!d||typeof d!="string")return!1;if(e(c,d))return!1;var f=b.handle;if(typeof f!="function")return!1;c[d]={handle:f,onAbort:b.onAbort||a.core.func.empty,callback:{}};return!0};b.abort=function(a){if(!a)return!1;for(var b in c){var d=c[b];if(e(d.callback,a)){setTimeout(function(){d.onAbort(a)},0);delete d.callback[a];return!0}}return!1};b.destory=function(a){if(!a||typeof a!="string")return!1;if(!e(c,a))return!1;for(var b in c[a].callback)try{c[a].callback[b].onError({type:"destroy"},b)}catch(d){}delete c[a];return!0};return b});STK.register("core.util.drag",function(a){var b=function(a){a.cancelBubble=!0;return!1},c=function(b,c){b.clientX=c.clientX;b.clientY=c.clientY;b.pageX=c.clientX+a.core.util.scrollPos().left;b.pageY=c.clientY+a.core.util.scrollPos().top;return b};return function(d,e){if(!a.core.dom.isNode(d))throw"core.util.drag need Element as first parameter";var f=a.core.obj.parseParam({actRect:[],actObj:{}},e),g={},h=a.core.evt.custEvent.define(f.actObj,"dragStart"),i=a.core.evt.custEvent.define(f.actObj,"dragEnd"),j=a.core.evt.custEvent.define(f.actObj,"draging"),k=function(d){var e=c({},d);document.body.onselectstart=function(){return!1};a.core.evt.addEvent(document,"mousemove",l);a.core.evt.addEvent(document,"mouseup",m);a.core.evt.addEvent(document,"click",b,!0);if(d.preventDefault){d.preventDefault();d.stopPropagation()}a.core.evt.custEvent.fire(h,"dragStart",e);return!1},l=function(b){var d=c({},b);b.cancelBubble=!0;a.core.evt.custEvent.fire(h,"draging",d)},m=function(d){var e=c({},d);document.body.onselectstart=function(){return!0};a.core.evt.removeEvent(document,"mousemove",l);a.core.evt.removeEvent(document,"mouseup",m);a.core.evt.removeEvent(document,"click",b,!0);a.core.evt.custEvent.fire(h,"dragEnd",e)};a.core.evt.addEvent(d,"mousedown",k);g.destroy=function(){a.core.evt.removeEvent(d,"mousedown",k);f=null};g.getActObj=function(){return f.actObj};return g}});STK.register("core.util.easyTemplate",function(a){var b=function(a,c){if(!a)return"";if(a!==b.template){b.template=a;b.aStatement=b.parsing(b.separate(a))}var d=b.aStatement,e=function(a){a&&(c=a);return arguments.callee};e.toString=function(){return(new Function(d[0],d[1]))(c)};return e};b.separate=function(a){var b=/\\'/g,c=a.replace(/(<(\/?)#(.*?(?:\(.*?\))*)>)|(')|([\r\n\t])|(\$\{([^\}]*?)\})/g,function(a,c,d,e,f,g,h,i){if(c)return"{|}"+(d?"-":"+")+e+"{|}";if(f)return"\\'";if(g)return"";if(h)return"'+("+i.replace(b,"'")+")+'"});return c};b.parsing=function(a){var b,c,d,e,f,g,h,i=["var aRet = [];"];h=a.split(/\{\|\}/);var j=/\s/;while(h.length){d=h.shift();if(!d)continue;f=d.charAt(0);if(f!=="+"&&f!=="-"){d="'"+d+"'";i.push("aRet.push("+d+");");continue}e=d.split(j);switch(e[0]){case"+et":b=e[1];c=e[2];i.push('aRet.push("<!--'+b+' start-->");');break;case"-et":i.push('aRet.push("<!--'+b+' end-->");');break;case"+if":e.splice(0,1);i.push("if"+e.join(" ")+"{");break;case"+elseif":e.splice(0,1);i.push("}else if"+e.join(" ")+"{");break;case"-if":i.push("}");break;case"+else":i.push("}else{");break;case"+list":i.push("if("+e[1]+".constructor === Array){with({i:0,l:"+e[1]+".length,"+e[3]+"_index:0,"+e[3]+":null}){for(i=l;i--;){"+e[3]+"_index=(l-i-1);"+e[3]+"="+e[1]+"["+e[3]+"_index];");break;case"-list":i.push("}}}");break;default:}}i.push('return aRet.join("");');return[c,i.join("")]};return b});STK.register("core.util.htmlParser",function(a){var b=function(a){var b={},c=a.split(",");for(var d=0;d<c.length;d++)b[c[d]]=!0;return b},c=/^<(\w+)((?:\s+[\w-\:]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,d=/^<\/(\w+)[^>]*>/,e=/([\w|\-]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,f=b("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),g=b("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),h=b("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),i=b("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),j=b("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),k=b("script,style"),l=function(a,b){var l,m,n,o=[],p=a,q=function(c,d,k,l){if(g[d])while(o.last()&&h[o.last()])r("",o.last());i[d]&&o.last()==d&&r("",d);l=f[d]||!!l;l||o.push(d);var m=[];if(c==="textarea"){var n=a.match(/^(.*)<\/textarea[^>]*>/);m.push({name:"text",value:a.slice(0,n[0].length)});a=a.substring(n[0].length)}if(b.start&&typeof b.start=="function"){k.replace(e,function(a,b){var c=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:j[b]?b:"";m.push({name:b,value:c,escaped:c.replace(/(^|[^\\])"/g,'$1\\"')})});b.start(d,m,l)}},r=function(a,c){if(!c)var d=0;else for(var d=o.length-1;d>=0;d--)if(o[d]==c)break;if(d>=0){for(var e=o.length-1;e>=d;e--)b.end&&typeof b.end=="function"&&b.end(o[e]);o.length=d}};o.last=function(){return this[this.length-1]};while(a){m=!0;if(!o.last()||!k[o.last()]){if(a.indexOf("<!--")===0){l=a.indexOf("-->");if(l>=0){b.comment&&typeof b.comment=="function"&&b.comment(a.substring(4,l));a=a.substring(l+3);m=!1}}else if(a.indexOf("</")===0){n=a.match(d);if(n){a=a.substring(n[0].length);n[0].replace(d,r);m=!1}}else if(a.indexOf("<")===0){n=a.match(c);if(n){a=a.substring(n[0].length);n[0].replace(c,q);m=!1}}if(m){l=a.indexOf("<");var s=l<0?a:a.substring(0,l);a=l<0?"":a.substring(l);b.chars&&typeof b.chars=="function"&&b.chars(s)}}else{a=a.replace(new RegExp("(.*)</"+o.last()+"[^>]*>"),function(a,c){c=c.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1");b.chars&&typeof b.chars=="function"&&b.chars(c);return""});r("",o.last())}if(a==p)throw"Parse Error: "+a;p=a}r()};return l});STK.register("core.util.nameValue",function(a){return function(b){var c=b.getAttribute("name"),d=b.getAttribute("type"),e=b.tagName,f={name:c,value:""},g=function(b){b===!1?f=!1:f.value?f.value=[a.core.str.trim(b||"")].concat(f.value):f.value=a.core.str.trim(b||"")};if(!!b.disabled||!c)return!1;switch(e){case"INPUT":d=="radio"||d=="checkbox"?b.checked?g(b.value):g(!1):d=="reset"||d=="submit"||d=="image"?g(!1):g(b.value);break;case"SELECT":if(b.multiple){var h=b.options;for(var i=0,j=h.length;i<j;i++)h[i].selected&&g(h[i].value)}else g(b.value);break;case"TEXTAREA":g(b.value||b.getAttribute("value")||!1);break;case"BUTTON":default:g(b.value||b.getAttribute("value")||b.innerHTML||!1)}return f}});STK.register("core.util.htmlToJson",function(a){return function(b,c,d){var e={};c=c||["INPUT","TEXTAREA","BUTTON","SELECT"];if(!b||!c)return!1;var f=a.core.util.nameValue;for(var g=0,h=c.length;g<h;g++){var i=b.getElementsByTagName(c[g]);for(var j=0,k=i.length;j<k;j++){var l=f(i[j]);if(!l||d&&l.value==="")continue;e[l.name]?e[l.name]instanceof Array?e[l.name]=e[l.name].concat(l.value):e[l.name]=[e[l.name]].concat(l.value):e[l.name]=l.value}}return e}});STK.register("core.util.jobsM",function(a){return function(){var b=[],c={},d=!1,e={},f=function(b){var d=b.name,e=b.func,f=+(new Date);if(!c[d])try{e(a);e[d]=!0}catch(g){a.log("[error][jobs]"+d)}},g=function(b){if(b.length){a.core.func.timedChunk(b,{process:f,callback:arguments.callee});b.splice(0,b.length)}else d=!1};e.register=function(a,c){b.push({name:a,func:c})};e.start=function(){if(d)return!0;d=!0;g(b)};e.load=function(){};a.core.dom.ready(e.start);return e}()});STK.register("core.util.language",function(a){return function(a,b){var c=[];for(var d=2,e=arguments.length;d<e;d+=1)c.push(arguments[d]);return a.replace(/#L\{((.*?)(?:[^\\]))\}/ig,function(){var a=arguments[1],d;b&&b[a]!==undefined?d=b[a]:d=a;c.length&&(d=d.replace(/(\%s)/ig,function(){var a=c.shift();return a!==undefined?a:arguments[0]}));return d})}});STK.register("core.util.listener",function(a){return function(){var a={},b=[],c,d=function(){if(b.length!=0){clearTimeout(c);var a=b.splice(0,1)[0];try{a.func.apply(a.func,[].concat(a.data))}catch(e){}c=setTimeout(d,25)}};return{register:function(b,c,d){a[b]=a[b]||{};a[b][c]=a[b][c]||[];a[b][c].push(d)},fire:function(c,e,f){var g,h,i;if(a[c]&&a[c][e]&&a[c][e].length>0){g=a[c][e];g.data_cache=f;for(h=0,i=g.length;h<i;h++)b.push({channel:c,evt:e,func:g[h],data:f});d()}},remove:function(b,c,d){if(a[b]&&a[b][c])for(var e=0,f=a[b][c].length;e<f;e++)if(a[b][c][e]===d){a[b][c].splice(e,1);break}},list:function(){return a},cache:function(b,c){if(a[b]&&a[b][c])return a[b][c].data_cache}}}()});STK.register("core.util.pageletM",function(a){var b="",c="";if(typeof $CONFIG!="undefined"){b=$CONFIG.jsPath||b;c=$CONFIG.cssPath||c}var d=a.core.arr.indexOf,e={},f,g={},h={},i={},j={},k,l;if(a.IE){k={};l=function(){var b,c,d;for(b in k)if(k[b].length<31){d=a.E(b);break}if(!d){b="style_"+a.core.util.getUniqueKey(),d=document.createElement("style");d.setAttribute("type","text/css");d.setAttribute("id",b);document.getElementsByTagName("head")[0].appendChild(d);k[b]=[]}return{styleID:b,styleSheet:d.styleSheet||d.sheet}}}var m=function(b,c){i[b]={cssURL:c};if(a.IE){var d=l();d.styleSheet.addImport(c);k[d.styleID].push(b);i[b].styleID=d.styleID}else{var e=a.C("link");e.setAttribute("rel","Stylesheet");e.setAttribute("type","text/css");e.setAttribute("charset","utf-8");e.setAttribute("href",c);e.setAttribute("id",b);document.getElementsByTagName("head")[0].appendChild(e)}},n={},o=function(b,c){var d=a.E(b);if(d){c(d);n[b]&&delete n[b];for(var e in n)o(e,n[e])}else n[b]=c},p=function(b){if(a.IE){var c=i[b].styleID,f=k[c],g=a.E(c),h;if((h=d(b,f))>-1){(g.styleSheet||g.sheet).removeImport(h);f.splice(h,1)}}else a.core.dom.removeNode(a.E(b));delete e[i[b].cssURL];delete i[b]},q=function(b,d,e){for(var f in j)a.E(f)||delete j[f];j[b]={js:{},css:{}};if(e)for(var f=0,g=e.length;f<g;++f)j[b].css[c+e[f]]=1},r=function(){for(var a in i){var b=!1,c=i[a].cssURL;for(var d in j)if(j[d].css[c]){b=!0;break}b||p(a)}},s=function(a,b){var c=e[a]||(e[a]={loaded:!1,list:[]});if(c.loaded){b(a);return!1}c.list.push(b);return c.list.length>1?!1:!0},t=function(a){var b=e[a].list;if(b){for(var c=0;c<b.length;c++)b[c](a);e[a].loaded=!0;delete e[a].list}},u=function(b){var d=b.url,e=b.load_ID,f=b.complete,g=b.pid,h=c+d,i="css_"+a.core.util.getUniqueKey();if(!!s(h,f)){m(i,h);var j=a.C("div");j.id=e;a.core.util.hideContainer.appendChild(j);var k=3e3,l=function(){if(parseInt(a.core.dom.getStyle(j,"height"))==42){a.core.util.hideContainer.removeChild(j);t(h)}else if(--k>0)setTimeout(l,10);else{a.log(h+"timeout!");a.core.util.hideContainer.removeChild(j);t(h);p(i);m(i,h)}};setTimeout(l,50)}},v=function(c,d){var f=b+c;!s(f,d)||a.core.io.scriptLoader({url:f,onComplete:function(){t(f)},onTimeout:function(){a.log(f+"timeout!");delete e[f]}})},w=function(a,b){g[a]||(g[a]=b)},x=function(b){if(b)if(g[b])try{h[b]||(h[b]=g[b](a))}catch(c){a.log(b,c,c.stack)}else a.log("start:ns="+b+" ,have not been registed");else{var d=[];for(b in g)d.push(b);a.core.func.timedChunk(d,{process:function(b){try{h[b]||(h[b]=g[b](a))}catch(c){a.log(b,c,c.stack)}}})}},y=function(b){var c=1,d,e,f,g,h,i,j;b=b||{};e=b.pid;f=b.html;h=b.js?[].concat(b.js):[];g=b.css?[].concat(b.css):[];if(e==undefined)a.log("node pid["+e+"] is undefined");else{q(e,h,g);i=function(){--c>0||o(e,function(a){f!=undefined&&(a.innerHTML=f);h.length>0&&j();r()})};j=function(a){h.length>0&&v(h.shift(),j);if(a&&a.indexOf("/pl/")!=-1){var b=a.replace(/^.*?\/(pl\/.*)\.js\??.*$/,"$1").replace(/\//g,".");z(b);x(b)}};if(g.length>0){c+=g.length;for(var k=0,l;l=g[k];k++)u({url:l,load_ID:"js_"+l.replace(/^\/?(.*)\.css\??.*$/i,"$1").replace(/\//g,"_"),complete:i,pid:e})}i()}},z=function(b){if(b){if(h[b]){a.log("destroy:"+b);try{h[b].destroy()}catch(c){a.log(c,c.stack)}delete h[b]}}else{for(b in h){a.log("destroy:"+b);try{h[b]&&h[b].destroy&&h[b].destroy()}catch(c){a.log(b,c,c.stack)}}h={}}},A={register:w,start:x,view:y,clear:z,destroy:function(){A.clear();e={};h={};g={};f=undefined}};a.core.dom.ready(function(){a.core.evt.addEvent(window,"unload",function(){a.core.evt.removeEvent(window,"unload",arguments.callee);A.destroy()})});return A});STK.register("core.util.winSize",function(a){return function(a){var b,c,d;a?d=a.document:d=document;if(d.compatMode==="CSS1Compat"){b=d.documentElement.clientWidth;c=d.documentElement.clientHeight}else if(self.innerHeight){a?d=a.self:d=self;b=d.innerWidth;c=d.innerHeight}else if(d.documentElement&&d.documentElement.clientHeight){b=d.documentElement.clientWidth;c=d.documentElement.clientHeight}else if(d.body){b=d.body.clientWidth;c=d.body.clientHeight}return{width:b,height:c}}});STK.register("core.util.pageSize",function(a){return function(b){var c;b?c=b.document:c=document;var d=c.compatMode=="CSS1Compat"?c.documentElement:c.body,e,f,g,h;if(window.innerHeight&&window.scrollMaxY){e=d.scrollWidth;f=window.innerHeight+window.scrollMaxY}else if(d.scrollHeight>d.offsetHeight){e=d.scrollWidth;f=d.scrollHeight}else{e=d.offsetWidth;f=d.offsetHeight}var i=a.core.util.winSize(b);f<i.height?g=i.height:g=f;e<i.width?h=i.width:h=e;return{page:{width:h,height:g},win:{width:i.width,height:i.height}}}});STK.register("core.util.queue",function(a){return function(){var a={},b=[];a.add=function(c){b.push(c);return a};a.get=function(){return b.length>0?b.shift():!1};return a}});STK.register("core.util.timer",function(a){return function(){var a={},b={},c=0,d=null,e=!1,f=25,g=function(){for(var c in b)b[c].pause||b[c].fun();return a};a.add=function(d){if(typeof d!="function")throw"The timer needs add a function as a parameters";var e=""+(new Date).getTime()+Math.random()*Math.pow(10,17);b[e]={fun:d,pause:!1};c<=0&&a.start();c++;return e};a.remove=function(d){if(b[d]){delete b[d];c--}c<=0&&a.stop();return a};a.pause=function(c){b[c]&&(b[c].pause=!0);return a};a.play=function(c){b[c]&&(b[c].pause=!1);return a};a.stop=function(){clearInterval(d);d=null;return a};a.start=function(){d=setInterval(g,f);return a};a.loop=g;a.get=function(a){if(a==="delay")return f;if(a==="functionList")return b};a.set=function(a,b){a==="delay"&&typeof b=="number"&&(f=Math.max(25,Math.min(b,200)))};return a}()});STK.register("core.util.scrollTo",function(a){return function(b,c){if(!a.core.dom.isNode(b))throw"core.dom.isNode need element as the first parameter";var d=a.core.obj.parseParam({box:document.documentElement,top:0,step:2,onMoveStop:null},c);d.step=Math.max(2,Math.min(10,d.step));var e=[],f=a.core.dom.position(b),g;d.box==document.documentElement?g={t:0}:g=a.core.dom.position(d.box);var h=Math.max(0,(f?f.t:0)-(g?g.t:0)-d.top),i=d.box===document.documentElement?d.box.scrollTop||document.body.scrollTop||window.pageYOffset:d.box.scrollTop;while(Math.abs(i-h)>d.step&&i>=0){e.push(Math.round(i+(h-i)*d.step/10));i=e[e.length-1]}e.length||e.push(h);var j=a.core.util.timer.add(function(){if(e.length)d.box===document.documentElement?window.scrollTo(0,e.shift()):d.box.scrollTop=e.shift();else{d.box===document.documentElement?window.scrollTo(0,h):d.box.scrollTop=h;a.core.util.timer.remove(j);typeof d.onMoveStop=="function"&&d.onMoveStop()}})}});STK.register("core.util.stack",function(a){return function(){var a={},b=[];a.add=function(c){b.push(c);return a};a.get=function(){return b.length>0?b.pop():!1};return a}});STK.register("core.util.swf",function(a){function b(b,c){var d=a.core.obj.parseParam({id:"swf_"+parseInt(Math.random()*1e4,10),width:1,height:1,attrs:{},paras:{},flashvars:{},html:""},c);if(b==null)throw"swf: [sURL] ";var e,f=[],g=[];for(e in d.attrs)g.push(e+'="'+d.attrs[e]+'" ');var h=[];for(e in d.flashvars)h.push(e+"="+d.flashvars[e]);d.paras.flashvars=h.join("&");if(a.IE){f.push('<object width="'+d.width+'" height="'+d.height+'" id="'+d.id+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" ');f.push(g.join(""));f.push('><param name="movie" value="'+b+'" />');for(e in d.paras)f.push('<param name="'+e+'" value="'+d.paras[e]+'" />');f.push("</object>")}else{f.push('<embed width="'+d.width+'" height="'+d.height+'" id="'+d.id+'" src="'+b+'" type="application/x-shockwave-flash" ');f.push(g.join(""));for(e in d.paras)f.push(e+'="'+d.paras[e]+'" ');f.push(" />")}d.html=f.join("");return d}var c={};c.create=function(c,d,e){var f=a.E(c);if(f==null)throw"swf: ["+c+"] ";var g=b(d,e);f.innerHTML=g.html;return a.E(g.id)};c.html=function(a,c){var d=b(a,c);return d.html};c.check=function(){var b=-1;if(a.IE)try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");b=c.GetVariable("$version")}catch(d){}else navigator.plugins["Shockwave Flash"]&&(b=navigator.plugins["Shockwave Flash"].description);return b};return c});STK.register("core.util.storage",function(a){var b=window.localStorage;if(b)return{get:function(a){return unescape(b.getItem(a))},set:function(a,c,d){b.setItem(a,escape(c))},del:function(a){b.removeItem(a)},clear:function(){b.clear()},getAll:function(){var a=b.length,c=null,d=[];for(var e=0;e<a;e++){c=b.key(e);d.push(c+"="+b.getItem(c))}return d.join("; ")}};if(window.ActiveXObject){var c=document.documentElement,d="localstorage";try{c.addBehavior("#default#userdata");c.save("localstorage")}catch(e){}return{set:function(a,b){c.setAttribute(a,b);c.save(d)},get:function(a){c.load(d);return c.getAttribute(a)},del:function(a){c.removeAttribute(a);c.save(d)}}}return{get:function(a){var b=document.cookie.split("; "),c=b.length,d=[];for(var e=0;e<c;e++){d=b[e].split("=");if(a===d[0])return unescape(d[1])}return null},set:function(a,b,c){if(!(c&&c instanceof Date)){c=new Date;c.setDate(c.getDate()+1)}document.cookie=a+"="+escape(b)+"; expires="+c.toGMTString()},del:function(a){document.cookie=a+"=''; expires=Fri, 31 Dec 1999 23:59:59 GMT;"},clear:function(){var a=document.cookie.split("; "),b=a.length,c=[];for(var d=0;d<b;d++){c=a[d].split("=");this.deleteKey(c[0])}},getAll:function(){return unescape(document.cookie.toString())}}});(function(){var a=STK.core,b={tween:"core.ani.tween",tweenArche:"core.ani.tweenArche",arrCopy:"core.arr.copy",arrClear:"core.arr.clear",hasby:"core.arr.hasby",unique:"core.arr.unique",foreach:"core.arr.foreach",isArray:"core.arr.isArray",inArray:"core.arr.inArray",arrIndexOf:"core.arr.indexOf",findout:"core.arr.findout",domNext:"core.dom.next",domPrev:"core.dom.prev",isNode:"core.dom.isNode",addHTML:"core.dom.addHTML",insertHTML:"core.dom.insertHTML",setXY:"core.dom.setXY",contains:"core.dom.contains",position:"core.dom.position",trimNode:"core.dom.trimNode",insertAfter:"core.dom.insertAfter",insertBefore:"core.dom.insertBefore",removeNode:"core.dom.removeNode",replaceNode:"core.dom.replaceNode",Ready:"core.dom.ready",setStyle:"core.dom.setStyle",setStyles:"core.dom.setStyles",getStyle:"core.dom.getStyle",addClassName:"core.dom.addClassName",hasClassName:"core.dom.hasClassName",removeClassName:"core.dom.removeClassName",builder:"core.dom.builder",cascadeNode:"core.dom.cascadeNode",selector:"core.dom.selector",sizzle:"core.dom.sizzle",addEvent:"core.evt.addEvent",custEvent:"core.evt.custEvent",removeEvent:"core.evt.removeEvent",fireEvent:"core.evt.fireEvent",fixEvent:"core.evt.fixEvent",getEvent:"core.evt.getEvent",stopEvent:"core.evt.stopEvent",delegatedEvent:"core.evt.delegatedEvent",preventDefault:"core.evt.preventDefault",hotKey:"core.evt.hotKey",memorize:"core.func.memorize",bind:"core.func.bind",getType:"core.func.getType",methodBefore:"core.func.methodBefore",timedChunk:"core.func.timedChunk",funcEmpty:"core.func.empty",ajax:"core.io.ajax",jsonp:"core.io.jsonp",ijax:"core.io.ijax",scriptLoader:"core.io.scriptLoader",require:"core.io.require",jsonInclude:"core.json.include",jsonCompare:"core.json.compare",jsonClone:"core.json.clone",jsonToQuery:"core.json.jsonToQuery",queryToJson:"core.json.queryToJson",jsonToStr:"core.json.jsonToStr",strToJson:"core.json.strToJson",objIsEmpty:"core.obj.isEmpty",beget:"core.obj.beget",cascade:"core.obj.cascade",objSup:"core.obj.sup",parseParam:"core.obj.parseParam",bLength:"core.str.bLength",dbcToSbc:"core.str.dbcToSbc",leftB:"core.str.leftB",trim:"core.str.trim",encodeHTML:"core.str.encodeHTML",decodeHTML:"core.str.decodeHTML",parseURL:"core.str.parseURL",parseHTML:"core.str.parseHTML",queryString:"core.str.queryString",htmlToJson:"core.util.htmlToJson",cookie:"core.util.cookie",drag:"core.util.drag",timer:"core.util.timer",jobsM:"core.util.jobsM",listener:"core.util.listener",winSize:"core.util.winSize",pageSize:"core.util.pageSize",templet:"core.util.templet",queue:"core.util.queue",stack:"core.util.stack",swf:"core.util.swf",URL:"core.util.URL",scrollPos:"core.util.scrollPos",scrollTo:"core.util.scrollTo",getUniqueKey:"core.util.getUniqueKey",storage:"core.util.storage",pageletM:"core.util.pageletM"};for(var c in b)STK.shortRegister(b[c],c,"theia")})();
var $CONFIG=STK.core.json.merge({},window.$CONFIG);
(function(a){var b={},c=function(a){return b[a]},d=function(e){if(!b[e]){var g={exports:{}};try{a[e].call(g.exports,g,g.exports,d,c)}catch(h){}b[e]=g.exports}return b[e]};return d("/ui")})({"/ui":function(a,b,c,d){function h(a,b){function e(a){return g.notice(a.msg).on("hide",a.hideCallback)}function d(a){var b=g.tipConfirm(a.msg).on("hide",a.hideCallback).ok(a.okCallback).cancel(a.cancelCallback);return{setLayerXY:function(a){return b.beside(a)},aniShow:function(){},aniHide:function(){},destroy:function(){}}}function c(a){var b=g.tipAlert(a.msg).on("hide",a.hideCallback);return{setLayerXY:function(a){return b.beside(a)},aniShow:function(){},aniHide:function(){},destroy:function(){}}}switch(a){case"alert":return c(b);case"confirm":return d(b);case"lite":return e(b)}}var e=c("/css"),f=c("/helpers/toFunction"),g={mlayer:f(c("/Class_mlayer"),"mlayer"),layer:f(c("/Class_layer"),"layer"),dialog:f(c("/Class_dialog"),"dialog"),alert:f(c("/Class_alert"),"alert"),confirm:f(c("/Class_confirm"),"confirm"),notice:f(c("/Class_notice"),"notice"),bubble:f(c("/Class_bubble"),"bubble"),card:f(c("/Class_card"),"card"),tipAlert:f(c("/Class_tipAlert"),"tipAlert"),tipConfirm:f(c("/Class_tipConfirm"),"tipConfirm"),mask:c("/mask"),scrollView:c("/Widget_scrollView"),badge:c("/Widget_badge"),suggest:c("/Widget_suggest"),effect:e.effect};g.focusHistory=c("/core/utils/focusHistory");g.mod={layer:g.mlayer,suggest:c("/core/utils/suggest"),tab:c("/core/utils/tab")};g.tip=h;g.slider=c("/core/utils/slider");g.calendar=c("/calendar");typeof STK=="object"?STK&&STK.register("ui",function(){return g}):window.UI=g},"/css":function(a,b,c,d){function t(a,b,c,d,e){function h(b){i(a,x,h);clearTimeout(f);m(g,function(b){l(a,b)});d&&d()}var f,g,e=typeof arguments[arguments.length-1]=="boolean"?arguments[arguments.length-1]:!1;if(typeof c=="function"){d=c;c=undefined}if(!v)n(function(){d&&d()});else{c=c||"normal";b=b||"shake";g=["UI_animated","UI_speed_"+c,"UI_ani_"+b];j(a,x,h);f=setTimeout(h,p(c)+100);e===!0?n(function(){m(g,function(b){k(a,b)})}):m(g,function(b){k(a,b)})}}function s(a,b,c){a.insertRule?a.insertRule(b+" {"+c+"}",0):a.addRule(b,c,1)}function r(){var a=document.body.style,b=a.WebkitAnimation!==undefined?"-webkit-":a.webkitAnimation!==undefined?"-webkit-":a.MozAnimation!==undefined?"-moz-":a.OAnimation!==undefined?"-o-":a.msAnimation!==undefined?"-ms-":a.animation!==undefined?"":!1;return b}function q(){var a=g("div"),b=g("div"),c;a.style.cssText="width:40px;overflow:auto;height:30px;position:absolute;top:-100px;";b.style.cssText="height:35px;";document.body.insertBefore(a,document.body.firstChild).appendChild(b);c=a.offsetWidth-b.offsetWidth;h(a);a=b=null;q=function(){return c};return c}function p(a){return typeof a=="number"?a:{fast:200,normal:500,slow:1e3}[a]||500}var e=c("/$")[0],f=c("/$")[1],g=e.C,h=e.removeNode,i=e.removeEvent,j=e.addEvent,k=e.addClassName,l=e.removeClassName,m=e.foreach,n=f.setImmediate,o={".UI_frame":"position:fixed;top:0;left:0;right:0;bottom:0;overflow-y:scroll;-webkit-overflow-scrolling: touch;",".UI_freezed":"position:fixed;top:0;left:0;bottom:0;overflow:hidden;right:"+q()+"px;",".UI_autoHeight .UI_autoHeightCtnt":"overflow:hidden;height:0;",".UI_autoHeight.UI_autoHeight_animated":"-v-transition:top 0.2s ease",".UI_autoHeight.UI_autoHeight_animated .UI_autoResizeCtnt":"-v-transition:height 0.2s ease",".UI_autoHeight.UI_autoHeightCtnt":"overflow:hidden;height:0;",".UI_autoHeight.UI_autoHeight_animated.UI_autoResizeCtnt":"-v-transition:height 0.2s ease, top 0.2s ease",".UI_scrolling":"-v-user-select:none",".UI_scrollView .UI_scrollContainer":"overflow:hidden;width:100%;height:100%;position:relative;_background:url(about:blank);",".UI_scrollView .UI_scrollContent":"position:relative;height:100%;width:100%;overflow-y:scroll;overflow-x:hidden;-webkit-overflow-scrolling:touch;margin-right:-30px;padding-right:30px;",".UI_badge":"display:inline-block;vertical-align:middle;overflow:hidden;",".UI_animated":"-v-animation-fill-mode: both;",".UI_animated.UI_speed_normal":"-v-animation-duration:  0.5s;",".UI_animated.UI_speed_fast":"-v-animation-duration:  0.2s;",".UI_animated.UI_speed_slow":"-v-animation-duration:  1s;"},u=document.getElementsByTagName("head")[0].appendChild(g("style"));u=u.sheet?u.sheet:u.styleSheet;var v=r(),w=/\-v\-/g,x={"-webkit-":"webkitAnimationEnd","-moz-":"animationend","-o-":"OAnimationEnd","-ms-":"msAnimationEnd","":"animationend"}[v],y={"-webkit-":"webkitTransitionEnd","-moz-":"transitionend","-o-":"OTransitionEnd","-ms-":"msTransitionEnd","":"transitionend"}[v];for(var z in o)s(u,z,o[z].replace(w,v||""));b.transitionend=y;b.animationend=x;b.effectSuport=!!v;b.effect=t;b.scrollWidth=q},"/$":function(a,b,c,d){a.exports=[d("/core/theia")||STK,c("/core/utils/index")]},"/core/utils/index":function(a,b,c,d){a.exports={count:c("/core/utils/count"),cssText:c("/core/utils/cssText"),drag:c("/core/utils/drag"),extend:c("/core/utils/extend"),fix:c("/core/utils/fix"),language:c("/core/utils/language"),layoutPos:c("/core/utils/layoutPos"),merge:c("/core/utils/merge"),parseDOM:c("/core/utils/parseDOM"),proxy:c("/core/utils/proxy"),rects:c("/core/utils/rects"),smartInput:c("/core/utils/smartInput"),textareaUtils:c("/core/utils/textareaUtils"),textSelection:c("/core/utils/textSelection"),setImmediate:c("/core/utils/setImmediate")}},"/core/utils/count":function(a,b,c,d){function f(a){var b=41,c=140,d=20,f=a,g=a.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=e.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=b?k:k<=c?d:k-c+d:h+=k<=c?d:k-c+d;f=f.replace(g[i],"")}var l=Math.ceil((h+e.core.str.bLength(f))/2);return l}var e=d("/core/theia")||STK;a.exports=function(a){a=a.replace(/\r\n/g,"\n");return f(a)}},"/core/utils/cssText":function(a,b,c,d){var e=d("/core/theia")||STK,f=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};a.exports=function(a){a=a||"";var b=[],c={push:function(a,d){b.push(a+":"+d);return c},remove:function(a){for(var d=0;d<b.length;d++)b[d].indexOf(a+":")==0&&b.splice(d,1);return c},getStyleList:function(){return b.slice()},getCss:function(){return f(a,b.join(";"))}};return c}},"/core/utils/drag":function(a,b,c,d){var e=d("/core/theia")||STK;a.exports=function(a,b){var c,d,f,g,h,i,j,k,l=function(){m();n()},m=function(){c=e.parseParam({moveDom:a,perchStyle:"border:solid #999999 2px;",dragtype:null,actObj:{},pagePadding:[5,5,5,5]},b);f=c.moveDom;d={};g={};h=e.drag(a,{actObj:c.actObj});if(c.dragtype==="perch"){i=e.C("div");j=!1;k=!1;f=i}a.style.cursor="move"},n=function(){e.custEvent.add(c.actObj,"dragStart",o);e.custEvent.add(c.actObj,"dragEnd",p);e.custEvent.add(c.actObj,"draging",q)},o=function(b,d){document.body.style.cursor="move";var f=e.core.util.pageSize().page;g=e.core.dom.position(c.moveDom);g.pageX=d.pageX;g.pageY=d.pageY;g.height=c.moveDom.offsetHeight;g.width=c.moveDom.offsetWidth;g.pageHeight=f.height;g.pageWidth=f.width;if(c.dragtype==="perch"){var h=[];h.push(c.perchStyle);h.push("position:absolute");h.push("z-index:"+(c.moveDom.style.zIndex+10));h.push("width:"+c.moveDom.offsetWidth+"px");h.push("height:"+c.moveDom.offsetHeight+"px");h.push("left:"+g.l+"px");h.push("top:"+g.t+"px");i.style.cssText=h.join(";");k=!0;setTimeout(function(){if(k){document.body.appendChild(i);j=!0}},100)}a.setCapture!==undefined&&a.setCapture()},p=function(b,d){document.body.style.cursor="auto";a.setCapture!==undefined&&a.releaseCapture();if(c.dragtype==="perch"){k=!1;c.moveDom.style.top=i.style.top;c.moveDom.style.left=i.style.left;if(j){document.body.removeChild(i);j=!1}}},q=function(a,b){var d=g.t+(b.pageY-g.pageY),e=g.l+(b.pageX-g.pageX),h=d+g.height,i=e+g.width,j=g.pageHeight-c.pagePadding[2],k=g.pageWidth-c.pagePadding[1];if(h<j&&d>0)f.style.top=d+"px";else{var l;h>=j&&(l=j-g.height);if(d<0+c.pagePadding[3]||l<0+c.pagePadding[3])l=c.pagePadding[3];f.style.top=l+"px"}if(i<k&&e>0)f.style.left=e+"px";else{var m;i>=k&&(m=k-g.width);if(e<0+c.pagePadding[0]||m<0+c.pagePadding[0])m=c.pagePadding[0];f.style.left=m+"px"}};l();d.destroy=function(){document.body.style.cursor="auto";typeof f.setCapture=="function"&&f.releaseCapture();if(c.dragtype==="perch"){k=!1;if(j){document.body.removeChild(i);j=!1}}e.custEvent.remove(c.actObj,"dragStart",o);e.custEvent.remove(c.actObj,"dragEnd",p);e.custEvent.remove(c.actObj,"draging",q);h.destroy&&h.destroy();c=null;f=null;g=null;h=null;i=null;j=null;k=null};d.getActObj=function(){return c.actObj};return d}},"/core/utils/extend":function(a,b,c,d){function e(a){var b=arguments.length,c=1,d;while(c<b){d=arguments[c++];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a}a.exports=e},"/core/utils/fix":function(a,b,c,d){function j(a,b,c){if(!!h(a)){var d="fixed",g,i,j,k,l=a.offsetWidth,m=a.offsetHeight,n=e.core.util.winSize(),o=0,p=0,q=e.core.dom.cssText(a.style.cssText);if(!f){d="absolute";var r=e.core.util.scrollPos();o=g=r.top;p=i=r.left;switch(b){case"lt":g+=c[1];i+=c[0];break;case"lb":g+=n.height-m-c[1];i+=c[0];break;case"rt":g+=c[1];i+=n.width-l-c[0];break;case"rb":g+=n.height-m-c[1];i+=n.width-l-c[0];break;case"c":default:g+=(n.height-m)/2+c[1];i+=(n.width-l)/2+c[0]}j=k=""}else{g=k=c[1];i=j=c[0];switch(b){case"lt":k=j="";break;case"lb":g=j="";break;case"rt":i=k="";break;case"rb":g=i="";break;case"c":default:g=(n.height-m)/2+c[1];i=(n.width-l)/2+c[0];k=j=""}}if(b=="c"){g<o&&(g=o);i<p&&(i=p)}q.push("position",d).push("top",g+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");a.style.cssText=q.getCss()}}function i(a){a=e.core.arr.isArray(a)?a:[0,0];for(var b=0;b<2;b++)typeof a[b]!="number"&&(a[b]=0);return a}function h(a){return e.core.dom.getStyle(a,"display")!="none"}var e=d("/core/theia")||STK,f=!(e.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&e.IE),g=/^(c)|(lt)|(lb)|(rt)|(rb)$/;a.exports=function(a,b,c){var d,h,k=!0,l;if(e.core.dom.isNode(a)&&g.test(b)){var m={getNode:function(){return a},isFixed:function(){return k},setFixed:function(b){(k=!!b)&&j(a,d,h);return this},setAlign:function(b,c){if(g.test(b)){d=b;h=i(c);k&&j(a,d,h)}return this},destroy:function(){f||f&&e.core.evt.removeEvent(window,"scroll",n);e.core.evt.removeEvent(window,"resize",n);e.core.evt.custEvent.undefine(l)}};l=e.core.evt.custEvent.define(m,"beforeFix");m.setAlign(b,c);function n(b){b=b||window.event;e.core.evt.custEvent.fire(l,"beforeFix",b.type);k&&(!f||d=="c")&&j(a,d,h)}f||e.core.evt.addEvent(window,"scroll",n);e.core.evt.addEvent(window,"resize",n);return m}}},"/core/utils/language":function(a,b,c,d){var e=d("/core/theia")||STK;window.$LANG||(window.$LANG={});a.exports=function(a){var b=[].splice.call(arguments,1,arguments.length),c=[a,$LANG].concat(b),d=e.core.util.language.apply(this,c);return d}},"/core/utils/layoutPos":function(a,b,c,d){var e=d("/core/theia")||STK;a.exports=function(a,b,c){if(!e.isNode(b))throw"kit.dom.layerOutElement need element as first parameter";if(b===document.body)return!1;if(!b.parentNode)return!1;if(b.style.display==="none")return!1;var d,f,g,h,i,j,k,l;d=e.parseParam({pos:"left-bottom",offsetX:0,offsetY:0,appendTo:undefined},c);if(d.appendTo){j=e.getStyle(d.appendTo,"position");l=d.appendTo===document.body||j==="absolute"||j==="fixed"||j==="relative";l||(d.appendTo=undefined)}if(d.appendTo){f=d.appendTo;f.appendChild(a)}else{f=b;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=e.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed"){if(k==="false")continue;break}if(k==="true"&&j==="relative")break}f.appendChild(a)}g=e.position(b,{parent:f});h={w:b.offsetWidth,h:b.offsetHeight};i=d.pos.split("-");i[0]==="left"?a.style.left=g.l+d.offsetX+"px":i[0]==="right"?a.style.left=g.l+h.w+d.offsetX+"px":i[0]==="center"&&(a.style.left=g.l+h.w/2+d.offsetX+"px");i[1]==="top"?a.style.top=g.t+d.offsetY+"px":i[1]==="bottom"?a.style.top=g.t+h.h+d.offsetY+"px":i[1]==="middle"&&(a.style.top=g.t+h.h/2+d.offsetY+"px");return!0}},"/core/utils/merge":function(a,b,c,d){a.exports=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}},"/core/utils/parseDOM":function(a,b,c,d){a.exports=function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}},"/core/utils/proxy":function(a,b,c,d){function e(a,b){var c=[].slice.call(arguments,2);return function(){return a.apply(b,[].slice.call(arguments).concat(c))}}a.exports=e},"/core/utils/rects":function(a,b,c,d){var e=d("/core/theia")||STK,f=e.core.util.browser,g={},h=5,i=20,j={t:function(a,b){return a.t>b.h},b:function(a,b){return a.b>b.h},l:function(a,b){return a.l>b.w},r:function(a,b){return a.r>b.w}},k={domSize:function(a){var b=e.core.dom.getSize(a);return{w:Math.max(b.width,e.getStyle(a,"width").replace(/px|auto/gi,"")),h:Math.max(b.height,e.getStyle(a,"height").replace(/px|auto/gi,""))}},mouseXY:function(a){var b={x:a.pageX,y:a.pageY};if(f.IE6||f.IE7){var c=e.core.util.scrollPos();b.x=b.x+c.left;b.y=b.y+c.top}return b},getRows:function(a){var b=a.getClientRects();if(f.IE6||f.IE7){var c=[],d={},e;for(var g=0,h=b.length;g<h;g++){var i=b[g];d[i.top]||(d[i.top]=[]);d[i.top].push(i)}for(var j in d){var k=d[j],h=k.length,l=k[0];h>1&&(l.right=k[h-1].right);c.push(l)}b=c}return b},getTextRect:function(a,b){var c=e.parseParam({evt:""},b),d=e.core.util.scrollPos(),f;if(!a.getClientRects){var g=k.domSize(a);return{width:g.w,height:g.h,left:"",right:"",top:"",bottom:""}}var h={rows:k.getRows(a)},i=k.mouseXY(c.evt),j={x:i.x-d.left,y:i.y-d.top};for(var l=0,m=h.rows.length;l<m;l++){var n=h.rows[l];l==0&&(f=n);if(j.y>n.top&&j.y<n.bottom){f=n;break}}if(e.IE){var g=k.domSize(a);f=e.parseParam({width:g.w,height:g.h,left:"",right:"",top:"",bottom:""},f)}return f},getDistance:function(a,b){var c=e.core.util.winSize(),d=k.getTextRect(a,b);return{win:c,rect:d,w:d.width,h:d.height,t:d.top,l:d.left,r:c.width-d.right,b:c.height-d.bottom}},getSeat:function(a,b,c){var d=e.parseParam({distance:i,priority:"trbl"},c),f=k.getDistance(a,c),g=k.domSize(b);f.area="b";var h=d.priority.split("");for(var l=0,m=h.length;l<m;l++){var n=h[l];if(!j[n])throw'priority error, random use "tbrl" combination';if(j[n](f,g)){f.area=n;break}}return f},setArrow:function(a){var b=e.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"W_arrow_bor W_arrow_bor_b",css_r:"W_arrow_bor W_arrow_bor_l",css_b:"W_arrow_bor W_arrow_bor_t",css_l:"W_arrow_bor W_arrow_bor_r",offset:h,distance:0},a);if(!b.node)throw"target node is undefined";if(!b.layer)throw"layer node is undefined";if(!b.arrow)throw"arrow node is undefined";var c=k.getSeat(b.node,b.layer,b),d=c.area,f=c.rect;b.arrow.className=b["css_"+d];b.arrow.style.cssText="";var g=k.domSize(b.layer),i=e.winSize().width,j=e.winSize().height,l=e.scrollPos(),m=5,n=16,o,p,q,r,s,t,u=0;if(d=="t"||d=="b"){b.distance+=(f.right-f.left)/2;f.left<i/3?u=(.5-1/3)*g.w:f.left>i/3*2&&(u=(.5-2/3)*g.w);f.left+b.distance+g.w/2+u>i-m*2?q=l.left+i-m-g.w:f.left+b.distance-g.w/2+u<m?q=l.left+m:q=l.left+f.left+b.distance-g.w/2+u;d=="t"?r=f.top+l.top-b.offset-g.h:d=="b"&&(r=f.bottom+l.top+b.offset);s=f.left+l.left+b.distance-q-n/2}if(d=="l"||d=="r"){if(f.left<i/2){d="r";b.arrow.className=b["css_"+d]}else if(f.left>i/2){d="l";b.arrow.className=b["css_"+d]}b.distance+=(f.bottom-f.top)/2;f.top<j/3?u=(.5-1/3)*g.h:f.top>j/3*2&&(u=(.5-2/3)*g.h);f.top+b.distance+g.h/2+u>j-m*2?r=l.top+j-m-g.h:f.top+b.distance-g.h/2+u<m?r=l.top+m:r=f.top+l.top+b.distance-g.h/2+u;d=="l"?q=f.left+l.left-b.offset-g.w:d=="r"&&(q=f.right+l.left+b.offset);t=f.top+l.top+b.distance-r-n/2}b.layer.style.left=q+"px";b.layer.style.top=r+"px";if(s!=undefined){s<10&&(s=10);s>g.w-n-10&&(s=g.w-n-10);b.arrow.style.left=s+"px"}else if(t!=undefined){t<0&&(t=0);t>g.h&&(t=g.h);b.arrow.style.top=t+"px"}return d},setLayer:function(a){var b=e.parseParam({evt:"",node:"",layer:"",priority:"btrl",offsetX:0,offsetY:0},a);if(!b.node)throw"target node is undefined";if(!b.layer)throw"layer node is undefined";var c=k.getSeat(b.node,b.layer,b),d=c.area,f=c.rect,g=k.domSize(b.layer),h=e.scrollPos(),i,j,l,m=e.winSize().width,n=g.w;if(d=="t"||d=="b"){i=d=="t"?f.top+h.top-g.h+b.offsetY:f.bottom+h.top-b.offsetY;j=f.left+h.left+b.offsetX;l=f.right+h.left-n+b.distance;l>0&&j+n>m+h.left&&(j=l)}else{i=f.top+h.top+b.offsetY;j=d=="r"?f.right+h.left-b.offsetX:f.left+h.left-g.w+b.offsetX}b.layer.style.top=i+"px";b.layer.style.left=j+"px";return d}};g.getTextRect=k.getTextRect;g.getDistance=k.getDistance;g.getSeat=k.getSeat;g.setArrow=k.setArrow;g.setLayer=k.setLayer;a.exports=g},"/core/utils/smartInput":function(a,b,c,d){var e=d("/core/theia")||STK,f=c("/core/utils/textSelection");a.exports=function(a,b){var c,d,g,h,i,j,k,l,m,n="stop",o,p,q,r,s;c=e.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:!1,LazyInputDelay:200},b);d=e.cascadeNode(a);i=f(a);e.custEvent.define(d,"enter");e.custEvent.define(d,"ctrlEnter");e.custEvent.define(d,"lazyInput");g=function(){c.maxLength&&e.bLength(a.value)>c.maxLength&&(a.value=e.leftB(a.value,c.maxLength))};p=function(){if(a.value===c.notice){a.value="";c.noticeClass!=null&&e.removeClassName(a,c.noticeClass)}c.currentClass!=null&&e.addClassName(a.parentNode,c.currentClass)};q=function(){if(a.value===""){a.value=c.notice;c.noticeClass!=null&&e.addClassName(a,c.noticeClass)}c.currentClass!=null&&e.removeClassName(a.parentNode,c.currentClass)};h=function(){g();return a.value===c.notice?"":a.value};r=function(a){a.keyCode===13&&e.custEvent.fire(d,"enter",h())};s=function(a){(a.keyCode===13||a.keyCode===10)&&a.ctrlKey&&e.custEvent.fire(d,"ctrlEnter",h())};j=function(){if(n==="stop"){m=setInterval(l,c.LazyInputDelay);n="sleep"}};k=function(){clearInterval(m);n="stop"};l=function(){if(o===a.value)if(n==="weakup"){e.custEvent.fire(d,"lazyInput",a.value);n="sleep"}else n==="waiting"&&(n="weakup");else n="waiting";o=a.value};if(c.needLazyInput){e.addEvent(a,"focus",j);e.addEvent(a,"blur",k)}e.addEvent(a,"focus",p);e.addEvent(a,"blur",q);e.addEvent(a,"keyup",g);e.addEvent(a,"keydown",r);e.addEvent(a,"keydown",s);d.getValue=h;d.setValue=function(b){a.value=b;g();return d};d.setNotice=function(a){c.notice=a;return d};d.setNoticeClass=function(a){c.noticeClass=a;return d};d.setNoticeStyle=function(a){c.noticeStyle=a;return d};d.setMaxLength=function(a){c.maxLength=a;return d};d.restart=function(){q()};d.startLazyInput=j;d.stopLazyInput=k;d.setCursor=i.setCursor;d.getCursor=i.getCursor;d.insertCursor=i.insertCursor;d.insertText=i.insertText;d.destroy=function(){if(c.needLazyInput){e.removeEvent(a,"focus",p);e.removeEvent(a,"blur",q)}k();e.removeEvent(a,"focus",p);e.removeEvent(a,"blur",q);e.removeEvent(a,"keyup",g);e.removeEvent(a,"keydown",r);e.removeEvent(a,"keydown",s);e.custEvent.undefine(d,"enter");e.custEvent.undefine(d,"ctrlEnter");e.custEvent.undefine(d,"lazyInput");i.destroy();d=null};return d}},"/core/utils/textSelection":function(a,b,c,d){var e=d("/core/theia")||STK;a.exports=function(a,b){var c,d;c={};d=e.parseParam({},b);var f=function(b){return e.core.dom.selectText(a,b)},g=function(){a.__areaQuery=e.jsonToQuery(e.core.dom.textSelectArea(a))},h=function(){a.__areaQuery=!1};e.addEvent(a,"beforedeactivate",g);e.addEvent(a,"active",h);var i=function(){var b=null;try{b=e.core.dom.textSelectArea(a)}catch(c){b=e.queryToJson(a.__areaQuery)}b.start===0&&b.len===0&&a.__areaQuery&&(b=e.queryToJson(a.__areaQuery));b.start=parseInt(b.start,10);b.len=parseInt(b.len,10);return b},j=function(b,c){var d=a.value,e=c.start,f=c.len||0,g=d.slice(0,e),h=d.slice(e+f,d.length);a.value=g+b+h;d=null;g=null;h=null;var e=null,f=null};c.setCursor=function(a){f(a)};c.getCursor=function(){return i()};c.insertCursor=function(a){var b=i();j(a,b);b.len=a.length;f(b)};c.TempletCursor=function(b){var c,d,g;c=i();c.len>0?d=a.value.substr(c.start,c.len):d="";g=e.templet(b,{origin:d});j(g,c);c.start=c.start+b.indexOf("#{origin");c.len=g.length-b.replace(/#\{[origin].+?\}/,"").length;f(c)};c.insertText=j;c.destroy=function(){e.removeEvent(a,"beforedeactivate",g);e.removeEvent(a,"active",h);a=null};return c}},"/core/utils/textareaUtils":function(a,b,c,d){var e=d("/core/theia")||STK,f={},g=document.selection;f.selectionStart=function(a){if(!g)try{return a.selectionStart}catch(b){return 0}var c=g.createRange(),d,e,f=0,h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(f;h.compareEndPoints("StartToStart",c)<0;f++)h.moveStart("character",1);return f};f.selectionBefore=function(a){return a.value.slice(0,f.selectionStart(a))};f.selectText=function(a,b,c){a.focus();if(!g)a.setSelectionRange(b,c);else{var d=a.createTextRange();d.collapse(1);d.moveStart("character",b);d.moveEnd("character",c-b);d.select()}};f.insertText=function(a,b,c,d){a.focus();d=d||0;if(!g){var e=a.value,h=c-d,i=h+b.length;a.value=e.slice(0,h)+b+e.slice(c,e.length);f.selectText(a,i,i)}else{var j=g.createRange();j.moveStart("character",-d);j.text=b}};f.replaceText=function(a,b){a.focus();var c=a.value,d=f.getSelectedText(a),e=d.length;if(d.length==0)f.insertText(a,b,f.getCursorPos(a));else{var h=f.getCursorPos(a);if(!g){var j=h+d.length;a.value=c.slice(0,h)+b+c.slice(h+e,c.length);f.setCursor(a,h+b.length);return}var i=g.createRange();i.text=b;f.setCursor(a,h+b.length)}};f.getCursorPos=function(a){var b=0;if(e.core.util.browser.IE){a.focus();var c=null;c=g.createRange();var d=c.duplicate();d.moveToElementText(a);d.setEndPoint("EndToEnd",c);a.selectionStartIE=d.text.length-c.text.length;a.selectionEndIE=a.selectionStartIE+c.text.length;b=a.selectionStartIE}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};f.getSelectedText=function(a){var b="",c=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=c(a):b=g.createRange().text;return b};f.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange(b,b+c)};f.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};a.exports=f},"/core/utils/setImmediate":function(a,b,c,d){var e=d("/core/theia")||STK,f=function(){return window.setImmediate?window.setImmediate:"onreadystatechange"in document.createElement("script")?function(a){function b(){c.onreadystatechange=null;e.removeNode(c);a()}var c=document.createElement("script");c.onreadystatechange=b;document.documentElement.appendChild(c)}:window.postMessage?function(a){function c(d){if(d.data===b){window.removeEventListener("message",c,!0);a()}}var b="UI_setImmediate_"+e.getUniqueKey();window.addEventListener("message",c,!0);window.postMessage(b,"*")}:window.setTimeout}();a.exports=f},"/helpers/toFunction":function(a,b,c,d){function p(a,b){function c(c,d){return new a(o(b,c,d))}c.constructor=a;return c}function o(a,b,c){c=c||{};if(n(b)===m)return g(c,c);if(a==="alert"||a==="confirm"||a==="notice"||a==="tipAlert"||a==="tipConfirm"){if(n(b)===l)return g(c,b);c.notice=b;return c}if(n(b)===k&&(b=h(b))&&b.indexOf("<")!==0){c.id=b;c.node=i(b);return c}if(n(b)===k&&(b=h(b))&&b.indexOf("<")===0){c.template=b;return c}if(j(b)){c.node=b;return c}return n(b)===l&&!j(b)?g(c,b):c}function n(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}var e=c("/$")[0],f=c("/$")[1],g=e.core.json.merge,h=e.trim,i=e.E,j=e.isNode,k="string",l="object",m="undefined";a.exports=p},"/Class_mlayer":function(a,b,c,d){function N(a){var b=C(k(a));return{node:B(b.box),nodes:j(b.list)}}function M(a){var b=document.createDocumentFragment();b.appendChild(a);return{node:a,nodes:j(C(b).list)}}function L(a,b){a.style.top=b.top+"px";a.style.left=b.left+"px"}var e=c("/$")[0],f=c("/$")[1],g=c("/templates/layer.html"),h=c("/css"),i=f.layoutPos,j=f.parseDOM,k=f.language,l=f.fix,m=f.drag,n=f.extend,o=f.proxy,p=f.setImmediate,q=e.addEvent,r=e.removeEvent,s=e.stopEvent,t=e.fixEvent,u=e.addClassName,v=e.removeClassName,w=e.custEvent,x=e.core.json.merge,y=e.core.dom.position,z=e.core.dom.getSize,A=e.core.dom.setXY,B=e.core.dom.firstChild,C=e.builder,D=e.removeNode,E=e.contains,F=e.core.util.winSize,G=e.core.util.scrollPos,H=e.delegatedEvent,I=e.isNode,J="string",K="node-type",O=c("/Class_base").extend({init:function(a){O.__super__.init.apply(this,arguments);w.define(this,["show","shown","beforeShow","hide","hidden","beforeHide"]);var b=this._;b.node?n(b,M(b.node)):n(b,N(b.template));b.node.id=b.id;b.dEvent=H(b.node);if(b.draggable){var c=b.draggable===!0?b.node:this.getDomList(!0)[b.draggable];c&&(b.drag=m(c,{actObj:b.node,moveDom:b.node,pagePadding:b.draggPadding}))}if(b.stopClickPropagation){b.proxyStopClickPropagation=function(a){s(a)};q(b.node,"click",b.proxyStopClickPropagation)}b.proxyClickBlankToHide=o(function(a){a=t(a);try{b.node!=a.target&&!E(b.node,a.target)&&this.hide()}catch(a){}},this);if(b.heightWithAni){u(b.node,"UI_autoHeight");u(this.getDomList(!0).autoHeight||b.node,"UI_autoHeightCtnt")}},startBoxClose:function(){var a=this._;a.clickBlankToHide=!0;if(this.getState()){r(document,"click",a.proxyClickBlankToHide);q(document,"click",a.proxyClickBlankToHide)}},stopBoxClose:function(){var a=this._;a.clickBlankToHide=!1;r(document,"click",a.proxyClickBlankToHide)},on:function(a,b,c){arguments.length>2?this._.dEvent.add(a,b,c):O.__super__.on.apply(this,arguments);return this},off:function(a,b,c){arguments.length>2?this._.dEvent.remove(a,b,c):O.__super__.off.apply(this,arguments);return this},trigger:function(a,b,c){I(a)?this._.dEvent.fireDom(a,b,c):O.__super__.trigger.apply(this,arguments);return this},dEvent:function(){return this._.dEvent},autoHeight:function(a){if(this._.heightWithAni){function b(){r(c,h.transitionend,b);r(d,h.transitionend,b);clearTimeout(i);v(c,"UI_autoHeight_animated");v(d,"UI_autoHeight_animated")}var c=this._.node,d=this.getDomList(!0).autoHeight||c,e=d.offsetHeight,f;d.style.height="auto";f=d.offsetHeight;d.style.height="auto";d.style.height=e+"px";var g,i;switch(a){case"top":g=0;break;case"bottom":g=e-f;break;case"center":case"middle":default:g=(e-f)/2}setTimeout(function(){u(c,"UI_autoHeight_animated");u(d,"UI_autoHeight_animated");q(c,h.transitionend,b);q(d,h.transitionend,b);i=setTimeout(b,250);c.style.top=parseInt(c.style.top)+g+"px";d.style.height=f+"px"},10)}return this},show:function(a){var b=this._;if(!!b){a=I(a)?a:b.node;r(document,"click",b.proxyClickBlankToHide);this.trigger("beforeShow");delete b.hidding;b.appendTo.appendChild(a);this.trigger("show");if(b.showWithAni){var c=b.showWithAni.split(":");h.effect(b.node,c[0],c[1],o(function(){this.trigger("shown")},this))}else this.trigger("shown");if(b.heightWithAni){var d=this.getDomList(!0).autoHeight||b.node;if(d){d.style.height="auto";d.style.height=d.offsetHeight+"px"}}b.clickBlankToHide&&setTimeout(o(function(){q(document,"click",b.proxyClickBlankToHide)},this),100);return this}},hide:function(a){var b=this._;if(!!b){a=I(a)?a:b.node;this.trigger("beforeHide");b.hidding=!0;var c=o(function(){if(b.hidding===!0){D(a);delete b.hidding}this.trigger("hidden")},this);if(b.hideWithAni){var d=b.hideWithAni.split(":");h.effect(b.node,d[0],d[1],c);this.trigger("hide")}else{this.trigger("hide");p(c)}b.clickBlankToHide&&r(document,"click",b.proxyClickBlankToHide);b.autoRelease&&setTimeout(o(this.destroy,this),5e3);return this}},setTop:function(a){return this.show(a)},getDomList:function(a){var b=this._;if(a){var c=b.node.getAttribute(K),d=C(b.node).list;c&&(d[c]===undefined?d[c]=[b.node]:d[c].push(b.node));b.nodes=j(d)}return b.nodes},getState:function(){return!!this._&&E(document.body,this._.node)&&this._.node.style.visibility!="hidden"},getID:function(){return this._.node.id},getOuter:function(){return this._.node},getBox:function(){return this._.node},html:function(a,b){b=b||this._.node;b.innerHTML="";typeof a===J?b.innerHTML=a||"":b.appendChild(a);return this},setPosition:function(a){a.top=a.t=a.top||a.t||0;a.left=a.l=a.left||a.l||0;this._.node.parentNode===document.body?L(this._.node,a):A(this._.node,a);return this},getPosition:function(a){var b=this._,c=z(b.node),d=y(b.node);switch(a){case"topright":d.l=d.left=d.left+c.width;break;case"bottomleft":d.t=d.top=d.top+c.height;break;case"bottomright":d.l=d.left=d.left+c.width;d.t=d.top=d.top+c.height;break;default:}return d},setLayoutPos:function(a,b){i(this._.node,a,b);return this},beside:function(a,b){b=b||{};var c=b.pos||"bottom-middle",d=c.split("-"),e=this.getSize(),f=d[0],g=d[1],h=b.offsetX||0,i=b.offsetY||0;switch(f){case"top":i-=e.height;break;case"left":h-=e.width}switch(g){case"right":if(f==="top"||f==="bottom")h-=e.width;break;case"bottom":if(f==="left"||f==="right")i-=e.height;break;case"middle":if(f==="left"||f==="right")i-=e.height/2;if(f==="top"||f==="bottom")h-=e.width/2}c={"top-left":"left-top","top-right":"right-top","top-middle":"center-top","top-center":"center-top","right-top":"right-top","right-bottom":"right-bottom","right-middle":"right-middle","right-center":"right-middle","bottom-left":"left-bottom","bottom-right":"right-bottom","bottom-middle":"center-bottom","bottom-center":"center-bottom","left-top":"left-top","left-bottom":"left-bottom","left-middle":"left-middle","left-center":"left-middle"}[c];return this.setLayoutPos(a,{pos:c,offsetX:h,offsetY:i,appendTo:b.appendTo})},setMiddle:function(){var a=F(),b=this.getSize(),c=G(),d=Math.max((a.height-b.height)/2,0)+c.top,e=Math.max((a.width-b.width)/2,0)+c.left;return this.setPosition({top:d,left:e})},setAlign:function(a){a=x({type:"c",offset:[0,0]},a);this._.domFix=l(this._.node,a.type,a.offset);return this},getSize:function(){return z(this._.node)},setIndex:function(a){this._.node.style.zIndex=a;return this},destroy:function(){var a=this._;if(a){a.node&&D(a.node);a.dEvent&&a.dEvent.destroy();a.domFix&&a.domFix.destroy();a.drag&&a.drag.destroy();this._.proxyStopClickPropagation&&r(a.node,"click",this._.proxyStopClickPropagation);this._.proxyClickBlankToHide&&r(document,"click",this._.proxyClickBlankToHide);a.domFix=a.drag=a.dEvent=null;O.__super__.destroy.apply(this,arguments)}}});O.defalutOpts=n({},O.defalutOpts,{id:"layer_"+e.core.util.getUniqueKey(),node:null,template:g,appendTo:document.body,draggable:!1,draggPadding:[5,5,5,5],showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",heightWithAni:!1,stopClickPropagation:!1,clickBlankToHide:!1,autoRelease:!1});a.exports=O},"/templates/layer.html":function(a,b,c,d){a.exports='<div class="W_layer WB_outReset"></div>'},"/Class_base":function(a,b,c,d){function k(){this.init.apply(this,arguments)}function j(a,b){var c=this,d;a&&a.hasOwnProperty("constructor")?d=a.constructor:d=function(){return c.apply(this,arguments)};h(d,c,b);var e=function(){this.constructor=d};e.prototype=c.prototype;d.prototype=new e;a&&h(d.prototype,a);d.__super__=c.prototype;return d}var e=c("/$")[0],f=c("/$")[1],g=e.core.json.merge,h=f.extend,i=e.custEvent;h(k.prototype,{init:function(a){this._=g(this.constructor.defalutOpts,a)},destroy:function(){i.undefine(this);this._=null}},{on:function(a,b){i.define(this,a);i.add(this,a,b);return this},once:function(a,b){i.define(this,a);i.once(this,a,b);return this},off:function(a,b){i.remove(this,a,b);return this},trigger:function(a,b){i.fire(this,a,b);return this}});k.extend=j;k.defalutOpts={};a.exports=k},"/Class_layer":function(a,b,c,d){function F(){q(w,y)}function E(){p(w,y)}function D(){return r(w,y)}function C(a,b){return a===w?x.scrollTop=w.scrollTop=b:a.scrollTop=b}function B(a){return a===w?Math.max(window.pageYOffset,x.scrollTop,w.scrollTop):a.scrollTop}function A(){var a;while(a=v[v.length-1]){if(a&&a.getState())return a;a.pop()}return null}var e=c("/$")[0],f=c("/$")[1],g=c("/mask"),h=c("/css"),i=e.C,j=e.builder,k=e.core.dom.firstChild,l=e.scrollPos,m=e.removeNode,n=e.foreach,o=e.arrIndexOf,p=e.addClassName,q=e.removeClassName,r=e.core.dom.hasClassName,s=e.hotKey,t=f.extend,u=f.proxy,v=[],w=document.body,x=document.documentElement,y="UI_freezed",z="px";s.add(document.documentElement,"esc",function(){var a=A();a&&a.hide()},{type:"keyup",disableInInput:!0});var G=c("/Class_mlayer").extend({init:function(){G.__super__.init.apply(this,arguments);this.on("show",u(function(){this._.showWithSetMiddle&&this.setMiddle();this._.needMask&&g.showUnderNode(this._.node)},this));this.on("beforeShow",function(){this._.lastFocus=document.activeElement});this.on("hidden",function(){this._.lastFocus.focus();delete this._.lastFocus})},show:function(){G.__super__.show.apply(this,arguments);if(!this._.focusNode){this._.focusNode=i("div");this._.focusNode.setAttribute("tabIndex","0")}this._.node.firstChild?this._.node.insertBefore(this._.focusNode,this._.node.firstChild).focus():this._.node.appendChild(this._.focusNode).focus();v.push(this);return this},hide:function(){var a=this.getState();G.__super__.hide.apply(this,arguments);if(a){this._.needMask&&g.back();v.splice(o(this,v),1)}return this},setTop:function(){return G.__super__.setTop.apply(this,[this._.frame])},isFreeze:function(){return r(this._.frame,y)},freeze:function(){var a=this._.frame;if(this.isFreeze()!==!0&&!$IE6){a.style.top=-B(a)+z;p(a,y);C(a,0);return this}},unfreeze:function(){var a=this._.frame,b;if(this.isFreeze()!==!1&&!$IE6){b=-parseInt(a.style.top);q(a,y);a.style.top="";C(a,b);return this}}});G.defalutOpts=t({},G.defalutOpts,{needMask:!0,showWithAni:"bounceIn:fast",hideWithAni:"bounceOut:fast",showWithSetMiddle:!0});a.exports=G},"/mask":function(a,b,c,d){function r(a){var b;(b=a.getAttribute(m))||a.setAttribute(m,b=e.getUniqueKey());return">"+a.tagName.toLowerCase()+"["+m+'="'+b+'"]'}function q(){i=e.C("div");var a='<div node-type="outer">';e.core.util.browser.IE6&&(a+='<div style="position:absolute;width:100%;height:100%;"></div>');a+="</div>";i=e.builder(a).list.outer[0];document.body.appendChild(i);l=!0;k=g(i,"lt");var b=function(){var a=e.core.util.winSize();i.style.cssText=e.core.dom.cssText(i.style.cssText).push("width",a.width+"px").push("height",a.height+"px").getCss()};p.add(k,"beforeFix",b);b()}var e=c("/$")[0],f=c("/$")[1],g=f.fix,h,i,j=[],k,l=!1,m="STK-Mask-Key",n=e.core.dom.setStyle,o=e.core.dom.getStyle,p=e.core.evt.custEvent,s={getNode:function(){return i},show:function(a,b){clearTimeout(h);if(l){a=e.core.obj.parseParam({opacity:.3,background:"#000000"},a);i.style.background=a.background;n(i,"opacity",a.opacity);i.style.display="";k.setAlign("lt");b&&b()}else{q();s.show(a,b)}return s},hide:function(){h=setTimeout(function(){i.style.display="none"},10);j=[];return s},showUnderNode:function(a,b){e.isNode(a)&&s.show(b,function(){n(i,"zIndex",o(a,"zIndex"));var b=r(a),c=e.core.arr.indexOf(b,j);c!=-1&&j.splice(c,1);j.push(b);e.core.dom.insertElement(a,i,"beforebegin")});return s},back:function(){if(j.length<1)return s;var a,b;j.pop();if(j.length<1)s.hide();else if((b=j[j.length-1])&&(a=e.sizzle(b,document.body)[0])){n(i,"zIndex",o(a,"zIndex"));e.core.dom.insertElement(a,i,"beforebegin")}else s.back();return s},resetSize:function(){var a=e.core.util.winSize();i.style.cssText=e.core.dom.cssText(i.style.cssText).push("width",a.width+"px").push("height",a.height+22+"px").getCss();return s},destroy:function(){p.remove(k);i.style.display="none"}};a.exports=s},"/Class_dialog":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.IE,h=f.extend,i=c("/templates/dialog.html"),j=f.proxy,k=e.addEvent,l=e.removeEvent,m=e.core.json.merge,n=e.core.dom.insertElement,o=c("/Class_layer").extend({init:function(a){o.__super__.init.apply(this,arguments);this._.title&&this.setTitle(this._.title);this._.content&&this.setContent(this._.content);this._.proxyClose=j(this.hide,this);this.getDomList().close&&k(this.getDomList().close,"click",this._.proxyClose)},setTitle:function(a){return this.html(a||"",this.getDomList(!0).title)},setContent:function(a){return this.html(a||"",this.getDomList(!0).inner)},appendChild:function(a){this.getDomList(!0).inner.appendChild(a);return this},insertElement:function(a,b){n(this.getDomList(!0).inner,a,b);return this},hide:function(){if(this.getState()&&typeof this._.beforeHideFn=="function"&&this._.beforeHideFn()===!1)return!1;return o.__super__.hide.apply(this,arguments)},clearContent:function(){return this.setContent("")},setBeforeHideFn:function(a){this._.beforeHideFn=a;return this},clearBeforeHideFn:function(){this._.beforeHideFn=null;return this},rebindClose:function(){this.getDomList().close&&l(this.getDomList().close,"click",this._.proxyClose);if(this.getDomList(!0).close){l(this.getDomList().close,"click",this._.proxyClose);k(this.getDomList().close,"click",this._.proxyClose)}return this},destroy:function(){if(this._){this.getDomList(!0).close&&this._.proxyClose&&l(this.getDomList().close,"click",this._.proxyClose);return o.__super__.destroy.apply(this,arguments)}}});o.defalutOpts=h({},o.defalutOpts,{template:i,draggable:"title"});a.exports=o},"/templates/dialog.html":function(a,b,c,d){a.exports='<div class="W_layer WB_outReset">\n\t<div class="content" node-type="autoHeight">\n\t\t<div node-type="title" class="W_layer_title"></div>\n\t\t<div class="W_layer_close"><a node-type="close" href="javascript:void(0);" class="W_ficon ficon_close S_ficon">X</a></div>\n\t\t<div node-type="inner"></div>\n\t</div>\n</div>'},"/Class_alert":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.foreach,h=e.funcEmpty,i=e.custEvent,j=f.language,k=f.proxy,l=f.extend,m=c("/templates/alert.html"),n=c("/jsons/icons.json"),o=c("/helpers/render"),p=c("/Class_dialog").extend({init:function(a){p.__super__.init.apply(this,arguments);i.define(this,["ok"]);this._.textSmall&&(this._.notice=[this._.notice,this._.textSmall]);this._.notice=[].concat(this._.notice);this.setTitle(this._.title);this.setNotice(this._.notice);this.setIcon(this._.icon);this.ok(this._.okText,this._.OK);this.on("ok","click",k(function(){this._.alertIsOK=!0;this.hide()},this));this.show()},setNotice:function(a){var b="";g([].concat(a),function(a,c){var d=c===0?"S_txt1":"S_txt2";b+=o('<p class="{className}">{text}</p>',{className:d,text:a||""})});this.getDomList(!0).text.innerHTML=b;return this},setIcon:function(a){this.getDomList(!0).icon.innerHTML=n[a]||"";return this},ok:function(a,b){if(typeof a=="function"){b=a;a=undefined}typeof a=="string"&&(this._.okText="<span>"+a+"</span>");this.getDomList(!0).ok.innerHTML=this._.okText;this.on("ok",b||h);return this},show:function(){var a=p.__super__.show.apply(this,arguments);this.getDomList(!0).ok.focus();return a},hide:function(){this._.alertIsOK&&this.trigger("ok");p.__super__.hide.apply(this,arguments);setTimeout(k(this.destroy,this),2e3);return this}});p.defalutOpts=l({},p.defalutOpts,{template:m,title:j(""),okText:j(""),icon:"succB"});a.exports=p},"/templates/alert.html":function(a,b,c,d){a.exports='<div class="W_layer WB_outReset">\n\t<div class="content">\n\t\t<div node-type="title" class="W_layer_title"></div>\n\t\t<div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div>\n\t\t<div node-type="inner">\n\t\t\t<div class="layer_point" >\n\t\t\t\t<dl class="point clearfix">\n\t\t\t\t\t<dt node-type="icon"></dt>\n\t\t\t\t\t<dd node-type="text"></dd>\n\t\t\t\t</dl>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="W_layer_btn S_bg1">\n\t\t\t<a href="javascript:void(0);" class="W_btn_b btn_34px" action-type="ok" node-type="ok"></a>\n\t\t</div>\n\t</div>\n</div>'},"/jsons/icons.json":function(a,b,c,d){a.exports={succ:'<span class="W_icon icon_succ"></span>',succM:'<span class="W_icon icon_succM"></span>',succB:'<span class="W_icon icon_succB"></span>',delS:'<span class="W_icon icon_delS"></span>',delM:'<span class="W_icon icon_delM"></span>',delB:'<span class="W_icon icon_delB"></span>',errorS:'<span class="W_icon icon_errorS"></span>',errorM:'<span class="W_icon icon_errorM"></span>',errorB:'<span class="W_icon icon_errorB"></span>',askS:'<span class="W_icon icon_askS"></span>',questionM:'<span class="W_icon icon_questionM"></span>',questionB:'<span class="W_icon icon_questionB"></span>',warnS:'<span class="W_icon icon_warnS"></span>',warnM:'<span class="W_icon icon_warnM"></span>',warnB:'<span class="W_icon icon_warnB"></span>',rederrorS:'<span class="W_icon icon_rederrorS"></span>',rederrorM:'<span class="W_icon icon_rederrorM"></span>',rederrorB:'<span class="W_icon icon_rederrorB"></span>'}},"/helpers/render":function(a,b,c,d){function e(a,b){return a.replace(/\{([0-9a-zA-Z_]+)\}/g,function(a,c){return b[c]})}a.exports=e},"/Class_confirm":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.foreach,h=e.custEvent,i=e.funcEmpty,j=f.language,k=f.proxy,l=f.extend,m=c("/templates/confirm.html"),n=c("/jsons/icons.json"),o=c("/helpers/render"),p=c("/Class_dialog").extend({init:function(){p.__super__.init.apply(this,arguments);h.define(this,["ok","cancel"]);this._.textSmall&&(this._.notice=[this._.notice,this._.textSmall]);this._.notice=[].concat(this._.notice);this.setTitle(this._.title);this.setNotice(this._.notice);this.setIcon(this._.icon);this.ok(this._.okText,this._.OK);this.cancel(this._.cancelText,this._.cancel);this.on("ok","click",k(function(){this._.confirmIsOK=!0;this.hide()},this));this.on("cancel","click",k(this.hide,this));this.show()},setNotice:function(a){var b="";g([].concat(a),function(a,c){var d=c===0?"S_txt1":"S_txt2";b+=o('<p class="{className}">{text}</p>',{className:d,text:a||""})});this.getDomList(!0).text.innerHTML=b;return this},setIcon:function(a){this.getDomList(!0).icon.innerHTML=n[a]||"";return this},ok:function(a,b){if(typeof a=="function"){b=a;a=undefined}typeof a=="string"&&(this._.okText="<span>"+a+"</span>");this.getDomList(!0).ok.innerHTML=this._.okText;this.on("ok",b||i);return this},cancel:function(a,b){if(typeof a=="function"){b=a;a=undefined}typeof a=="string"&&(this._.cancelText="<span>"+a+"</span>");this.getDomList(!0).cancel.innerHTML=this._.cancelText;this.on("cancel",b||i);return this},show:function(){var a=p.__super__.show.apply(this,arguments);this.getDomList(!0).ok.focus();return a},hide:function(){this._.confirmIsOK?this.trigger("ok"):this.trigger("cancel");p.__super__.hide.apply(this,arguments);setTimeout(k(this.destroy,this),2e3);return this}});p.defalutOpts=l({},p.defalutOpts,{template:m,title:j(""),okText:j(""),cancelText:j(""),icon:"questionB"});a.exports=p},"/templates/confirm.html":function(a,b,c,d){a.exports='<div class="W_layer WB_outReset">\n\t<div class="content">\n\t\t<div node-type="title" class="W_layer_title"></div>\n\t\t<div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div>\n\t\t<div node-type="inner">\n\t\t\t<div class="layer_point" >\n\t\t\t\t<dl class="point clearfix">\n\t\t\t\t\t<dt node-type="icon"></dt>\n\t\t\t\t\t<dd node-type="text"></dd>\n\t\t\t\t</dl>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="W_layer_btn S_bg1">\n\t\t\t<a href="javascript:void(0);" class="W_btn_a btn_34px" node-type="ok" action-type="ok"></a>\n\t\t\t<a href="javascript:void(0);" class="W_btn_b btn_34px" node-type="cancel" action-type="cancel"></a>\n\t\t</div>\n\t</div>\n</div>\n'},"/Class_notice":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.foreach,h=e.funcEmpty,i=f.language,j=f.proxy,k=f.extend,l=c("/jsons/icons.json"),m=c("/templates/notice.html"),n=c("/helpers/render"),o=c("/Class_layer").extend({init:function(a){o.__super__.init.apply(this,arguments);if(this._textLarge||this._textSmall)this._.notice=[this._textLarge,this._textSmall];this._.notice=[].concat(this._.notice);this.setNotice(this._.notice);this.setIcon(this._.icon);this.show().setMiddle();setTimeout(j(this.hide,this),this._.hideDelay)},setNotice:function(a){var b="";g([].concat(a),function(a,c){var d=c===0?"S_txt1":"S_txt2";b+=n('<p class="{className}">{text}</p>',{className:d,text:a||""})});this.getDomList(!0).text.innerHTML=b;return this},setIcon:function(a){this.getDomList(!0).icon.innerHTML=l[a]||"";return this},hide:function(){o.__super__.hide.apply(this,arguments);setTimeout(j(this.destroy,this),2e3);return this}});o.defalutOpts=k({},o.defalutOpts,{template:m,icon:"succB",hideDelay:1e3});a.exports=o},"/templates/notice.html":function(a,b,c,d){a.exports='<div class="W_layer WB_outReset">\n\t<div class="content">\n\t\t<div node-type="inner">\n\t\t\t<div class="layer_point" >\n\t\t\t\t<dl class="point clearfix">\n\t\t\t\t\t<dt node-type="icon"></dt>\n\t\t\t\t\t<dd node-type="text"></dd>\n\t\t\t\t</dl>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'},"/Class_bubble":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.C,h=e.replaceNode,i=e.core.dom.getSize,j=e.isNode,k=e.funcEmpty,l=e.getStyle,m=e.position,n=e.contains,i=e.core.dom.getSize,o=e.core.dom.insertElement,p=e.removeEvent,q=e.addEvent,r=f.proxy,s=f.extend,t=c("/templates/bubble.html"),u=14,v=c("/Class_mlayer").extend({init:function(){v.__super__.init.apply(this,arguments);this._.proxyClose=r(this.hide,this);this.getDomList().close&&q(this.getDomList().close,"click",this._.proxyClose);this.on("show",r(function(){this._.showWithSetWidth&&!this.getBox().style.width.length&&this.fixWidth()},this))},setContent:function(a){return this.html(a||"",this.getDomList(!0).inner)},fixWidth:function(){var a=this.getBox();if(n(document.body,a)){var b=e.C("span");h(b,a);document.body.appendChild(a);this.getBox().style.width="";this.getBox().style.width=this.getBox().offsetWidth+1+"px";h(a,b)}},appendChild:function(a){this.getDomList(!0).inner.appendChild(a);return this},insertElement:function(a,b){o(this.getDomList(!0).inner,a,b);return this},clearContent:function(){return this.setContent("")},setArrow:function(a,b,c){var d,e,f=this.getDomList(!0).arrow,g=this.getSize(),h={left:"right",top:"bottom",right:"left",bottom:"top"};switch(a){case"top":d="W_arrow_bor W_arrow_bor_t";e="left";break;case"right":d="W_arrow_bor W_arrow_bor_r";e="top";break;case"bottom":d="W_arrow_bor W_arrow_bor_b";e="left";break;case"left":d="W_arrow_bor W_arrow_bor_l";e="top"}if(d){f.className=d;if(b!==undefined){g=g[{left:"width",top:"height"}[e]];b=parseFloat(b);f.style.top=f.style.right=f.style.bottom=f.style.left="";c&&(e=h[e]);f.style[e]=Math.min(Math.max(b,0),g-u)+"px";f.style[h[e]]="auto"}}return this},beside:function(a,b){b=b||{};var c=b.pos||"top-middle",d=c.split("-"),e=b.offsetX||0,f=b.offsetY||0,g,h,i=this.getSize();switch(d[0]){case"top":g="bottom";f-=u;switch(d[1]){case"left":h=10;break;case"right":h=-10;break;case"middle":h=(i.width-u)/2}break;case"right":g="left";e+=u;switch(d[1]){case"top":h=10;break;case"bottom":h=-10;break;case"middle":h=(i.height-u)/2}break;case"bottom":g="top";f+=u;switch(d[1]){case"left":h=10;break;case"right":h=-10;break;case"middle":h=(i.width-u)/2}break;case"left":g="right";e-=u;switch(d[1]){case"top":h=10;break;case"bottom":h=-10;break;case"middle":h=(i.height-u)/2}}this.setArrow(g,Math.abs(h),h<0);v.__super__.beside.apply(this,[a,{pos:c,offsetX:e,offsetY:f,appendTo:b.appendTo}]);return this},setAlignPos:function(a,b,c){var d=this.getBox(),e=this.getDomList(!0).arrow;c=s({offset:{left:0,top:0},arrowOffset:0,align:"left",fail:r(function(){this.beside(a,{pos:"bottom-middle"})},this)},c);if(!!j(a)&&!!j(b)){var f=a,g;while(f!==document.body){f=f.parentNode;g=l(f,"position");if(g==="absolute")break}f.appendChild(d);g=m(f);g||(g={l:0,t:0});var h=m(b),k=m(a),n=i(a),o=6,p,q,t,v=c.offset,w=c.arrowOffset,x=i(d),y=i(b),z=2;if(c.align==="left"){if(x.width<k.l-h.l+Math.ceil(n.width/2)){c.fail();return}}else if(h.l+y.width-k.l-Math.ceil(n.width/2)>x.width){c.fail();return}c.align==="left"?p=h.l-z:p=h.l+y.width-x.width+z;q=k.t+n.height+o;t=k.l+Math.ceil((n.width-u)/2)-p;q-=g.t;p-=g.l;q+=v.top;p+=v.left;t+=w;d.style.left=p+"px";d.style.top=q+"px";e&&(e.style.left=t+"px");return this}},rebindClose:function(){this.getDomList().close&&p(this.getDomList().close,"click",this._.proxyClose);if(this.getDomList(!0).close){p(this.getDomList().close,"click",this._.proxyClose);q(this.getDomList().close,"click",this._.proxyClose)}return this},destroy:function(){if(this._){this.getDomList(!0).close&&this._.proxyClose&&p(this.getDomList().close,"click",this._.proxyClose);return v.__super__.destroy.apply(this,arguments)}}});v.defalutOpts=s({},v.defalutOpts,{template:t,showWithAni:"fadeInUp:fast",hideWithAni:"fadeOutDown:fast",showWithSetWidth:!0});a.exports=v},"/templates/bubble.html":function(a,b,c,d){a.exports='<div class="W_layer W_layer_pop WB_outReset">\n\t<div class="content">\n\t<div class="W_layer_close"><a href="javascript:void(0)" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div>\n\t\t<div node-type="inner">\n\t\t\t<div class="layer_point"></div>\n\t\t</div>\n\t\t<div class="W_layer_arrow">\n\t\t\t<span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span>\n\t\t<div>\n\t</div>\n</div>'},"/Class_card":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=f.rects,h=f.setImmediate,i=f.proxy,j=f.extend,k=c("/css"),l={t:["showWithAniOnTop","hideWithAniOnTop"],r:["showWithAniOnRight","hideWithAniOnRight"],b:["showWithAniOnBottom","hideWithAniOnBottom"],l:["showWithAniOnLeft","hideWithAniOnLeft"]},m=c("/Class_bubble").extend({showByTarget:function(a,b){this._.lastTarget=a;var c=this.getState(),d,e;this._.showWithAni=null;this.show();this._.lastPos=d=g.setArrow({evt:b,node:a,layer:this.getBox(),arrow:this.getDomList(!0).arrow,priority:this._.priority});e=l[d]&&l[d][0];e=(this._[e]||"").split(":");c||e[0]&&e[0].length&&k.effect(this._.node,e[0],e[1]);return this},hide:function(){var a=l[this._.lastPos]&&l[this._.lastPos][1];this._.hideWithAni=this._[a];m.__super__.hide.apply(this,arguments)},setPriority:function(a){this._.priority=a;return this},lastTarget:function(a){return this._.lastTarget}});m.defalutOpts=j({},m.defalutOpts,{lastPos:null,lastTarget:null,priority:"tbrl",showWithAniOnTop:"fadeInUp:fast",showWithAniOnRight:"fadeInRight:fast",showWithAniOnBottom:"fadeInDown:fast",hideWithAniOnLeft:"fadeOutLeft:fast",hideWithAniOnTop:"fadeOutDown:fast",hideWithAniOnRight:"fadeOutLeft:fast",hideWithAniOnBottom:"fadeOutUp:fast",hideWithAniOnLeft:"fadeOutRight:fast"});a.exports=m},"/Class_tipAlert":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.foreach,h=e.funcEmpty,i=e.core.dom.uniqueID,j=f.language,k=f.proxy,l=f.extend,m=c("/templates/tipAlert.html"),n=c("/jsons/icons.json"),o=c("/helpers/render"),p={},q=c("/Class_bubble").extend({init:function(a){q.__super__.init.apply(this,arguments);if(this._textLarge||this._textSmall)this._.notice=[this._textLarge,this._textSmall];this._.notice=[].concat(this._.notice);this.setNotice(this._.notice);this.setIcon(this._.icon);this._.autoHide&&setTimeout(k(this.hide,this),this._.hideDelay);this.show()},setNotice:function(a){var b="";g([].concat(a),k(function(a,c){c===0?this.getDomList().text.innerHTML=a+(this._.autoHide?"":' <a node-type="close" href="javascript:void(0);" class="W_ficon ficon_close S_ficon">X</a>'):b+=o('<p class="sub_txt S_txt2">{text}</p>',{text:a||""})},this));this.getDomList().otherText.innerHTML=b;this.rebindClose();this.fixWidth();return this},beside:function(a){var b=i(a);this._.besideDOM=b;if(p[b])try{p[b].hide()}catch(c){}p[b]=this;return q.__super__.beside.apply(this,arguments)},setIcon:function(a){this.getDomList(!0).icon.innerHTML=n[a]||"";return this},hide:function(){p[this._.besideDOM]===this&&delete p[this._.besideDOM];q.__super__.hide.apply(this,arguments);setTimeout(k(this.destroy,this),2e3);return this}});q.defalutOpts=l({},q.defalutOpts,{template:m,icon:"succ",autoHide:!0,stopClickPropagation:!0,hideDelay:1e3});a.exports=q},"/templates/tipAlert.html":function(a,b,c,d){a.exports='<div class="W_layer W_layer_pop WB_outReset">\n\t<div class="content layer_mini_info">\n\t\t<p class="main_txt">\n\t\t\t<span node-type="icon"></span>\n\t\t\t<span node-type="text"></span>\n\t\t</p>\n\t\t<div node-type="otherText"></div>\n\t\t\n\t\t<div class="W_layer_arrow">\n\t\t\t<span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span>\n\t\t<div>\n\t</div>\n</div>'},"/Class_tipConfirm":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1],g=e.foreach,h=e.funcEmpty,i=e.core.dom.uniqueID,j=e.custEvent,k=f.language,l=f.proxy,m=f.extend,n=c("/templates/tipConfirm.html"),o=c("/jsons/icons.json"),p=c("/helpers/render"),q={},r=c("/Class_bubble").extend({init:function(a){r.__super__.init.apply(this,arguments);j.define(this,["ok","cancel"]);if(this._textLarge||this._textSmall)this._.notice=[this._textLarge,this._textSmall];this._.notice=[].concat(this._.notice);this.setNotice(this._.notice);this.setIcon(this._.icon);this.ok(this._.okText,this._.ok);this.cancel(this._.cancelText,this._.cancel);this.on("ok","click",l(function(){this._.confirmIsOK=!0;this.hide()},this));this.on("cancel","click",l(this.hide,this));this.show()},setNotice:function(a){var b="";g([].concat(a),l(function(a,c){c===0?this.getDomList(!0).text.innerHTML=a:b+=p('<p class="sub_txt S_txt2">{text}</p>',{text:a||""})},this));this.getDomList(!0).otherText.innerHTML=b;this.fixWidth();return this},ok:function(a,b){if(typeof a=="function"){b=a;a=undefined}typeof a=="string"&&(this._.okText="<span>"+a+"</span>");this.getDomList(!0).ok.innerHTML=this._.okText;this.on("ok",b||h);this.fixWidth();return this},cancel:function(a,b){if(typeof a=="function"){b=a;a=undefined}typeof a=="string"&&(this._.cancelText="<span>"+a+"</span>");this.getDomList(!0).cancel.innerHTML=this._.cancelText;this.on("cancel",b||h);this.fixWidth();return this},setIcon:function(a){this.getDomList(!0).icon.innerHTML=o[a]||"";return this},show:function(){var a=r.__super__.show.apply(this,arguments);setTimeout(l(function(){this.getDomList(!0).ok.focus()},this),100);return a},beside:function(a){var b=i(a);this._.besideDOM=b;if(q[b])try{q[b].hide()}catch(c){}q[b]=this;return r.__super__.beside.apply(this,arguments)},hide:function(){q[this._.besideDOM]===this&&delete q[this._.besideDOM];this._.confirmIsOK?this.trigger("ok"):this.trigger("cancel");r.__super__.hide.apply(this,arguments);setTimeout(l(this.destroy,this),2e3);return this}});r.defalutOpts=m({},r.defalutOpts,{template:n,icon:"askS",okText:k(""),cancelText:k(""),stopClickPropagation:!0});a.exports=r},"/templates/tipConfirm.html":function(a,b,c,d){a.exports='<div class="W_layer W_layer_pop WB_outReset">\n\t<div class="content layer_mini_opt">\n\t\t<p class="main_txt">\n\t\t\t<span node-type="icon"></span>\n\t\t\t<span node-type="text"></span>\n\t\t</p>\n\t\t<div node-type="otherText"></div>\n\t\t<p class="btn">\n\t\t\t<a href="javascript:void(0);" node-type="ok" action-type="ok" class="W_btn_a"></a>\n\t\t\t<a href="javascript:void(0);" node-type="cancel" action-type="cancel" class="W_btn_b"></a>\n\t\t</p>\n\t\t<div class="W_layer_arrow">\n\t\t\t<span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span>\n\t\t<div>\n\t</div>\n</div>'},"/Widget_scrollView":function(a,b,c,d){function t(a){function D(){m(b.content,"scroll",C);m(b.barContainer,"mousedown",y);m(document,"mousemove",z);m(document,"mouseup",A);n(b.container);n(b.barContainer);clearInterval(h);while(t=b.container.firstChild)a.appendChild(t)}function C(){try{var a=g.scrollWidth();q&&B(b.content)&&(a=0);b.content.style.width=b.container.offsetWidth+a+"px";b.barContent.style.height=w()/v()*100+"%";b.barContent.style.top=u()/v()*100+"%";b.barContainer.style.visibility=v()<=w()?"hidden":""}catch(c){}}function B(a){return e.getStyle(a,"position")==="absolute"?!0:a===document.body?!1:a.parentNode?B(a.parentNode):!1}function A(a){d=!1;j(document.body,"UI_scrolling")}function z(a){a=o(a);d===!0&&u((a.clientY-f)/b.barContainer.offsetHeight*v())}function y(a){a=o(a);var c=a.target;if(a.which===1){i(document.body,"UI_scrolling");if(c===b.barContent){d=!0;f=a.clientY-parseInt(b.barContent.style.top,10)/100*b.barContainer.offsetHeight}else b.barContent.getBoundingClientRect().top<a.clientY?u(u()+v()*.1):u(u()-v()*.1)}}function x(a){a=o(a);var b=-a.wheelDelta;isNaN(b)&&(b=a.deltaY);var c=b<0,d=b>0;(c&&u()<=0||d&&v()-u()-w()<=0)&&p(a)}function w(){return b.content.offsetHeight}function v(){return b.content.scrollHeight}function u(a){return arguments.length>0?b.content.scrollTop=a:b.content.scrollTop}var b=r(k(s).list),c,d=!1,f,h;for(c in b)b.hasOwnProperty(c)&&b[c].removeAttribute("node-type");var t;while(t=a.firstChild)b.content.appendChild(t);i(a,"UI_scrollView");a.appendChild(b.container);a.appendChild(b.barContainer);l(b.content,"scroll",C);l(b.barContainer,"mousedown",y);l(document,"mousemove",z);l(document,"mouseup",A);l(b.content,"mousewheel",x);l(b.content,"DOMMouseScroll",x);h=setInterval(function(){try{b.container.scrollLeft=0}catch(a){}},1e3);C();return{reset:C,destroy:D,scrollHeight:v,scrollTop:u,offsetHeight:w,scrollEl:b.content}}var e=c("/$")[0],f=c("/$")[1],g=c("/css"),h=e.C,i=e.addClassName,j=e.removeClassName,k=e.builder,l=e.addEvent,m=e.removeEvent,n=e.removeNode,o=e.fixEvent,p=e.stopEvent,q=e.core.util.browser.IE6||e.core.util.browser.IE7,r=f.parseDOM,s=c("/templates/scrollview.html");a.exports=t},"/templates/scrollview.html":function(a,b,c,d){a.exports='<div class="UI_scrollContainer" node-type="container">\n\t<div class="UI_scrollContent" node-type="content"></div>\n</div>\n<div class="UI_scrollBar W_scroll_y S_bg1" node-type="barContainer"><div class="bar S_txt2_bg" node-type="barContent" style="top:0%; height:0;"></div></div>'},"/Widget_badge":function(a,b,c,d){function m(a,b,c){if(h.effectSuport){var d=a.innerHTML,e=b;c&&(d=[e,e=d][0]);var f=parseInt(g(a,"line-height")),m=i(l(k,{oldValue:d,newValue:e,height:(f||a.offsetHeight)-1})),n=m.list.t[0],o=m.box;a.innerHTML="";a.appendChild(o);n.style.lineHeight=n.parentNode.offsetHeight+"px";h.effect(n,c?"badgeDown":"badgeUp","fast",function(){j(a,n)&&(a.innerHTML=b)})}else a.innerHTML=b}var e=c("/$")[0],f=c("/$")[1],g=e.getStyle,h=c("/css"),i=e.builder,j=e.contains,k=c("/templates/badge.html"),l=c("/helpers/render");a.exports=m},"/templates/badge.html":function(a,b,c,d){a.exports='<span class="UI_badge" style="height:{height}px"><span class="UI_badge" node-type="t">{oldValue}<br/>{newValue}</span></span>'},"/Widget_suggest":function(a,b,c,d){function z(a){var b=a.length;while(b--)if(l(a[b],"cur"))return a[b];return null}var e=c("/$")[0],f=c("/$")[1],g=c("/Class_mlayer"),h=c("/css"),i=e.C,j=e.addClassName,k=e.removeClassName,l=e.core.dom.hasClassName,m=e.addEvent,n=e.removeEvent,o=e.builder,p=e.foreach,q=e.fixEvent,r=e.preventDefault,s=e.stopEvent,t=e.getUniqueKey,u=e.custEvent,v=f.parseDOM,w=f.extend,x=f.proxy,y={ENTER:13,ESC:27,UP:38,DOWN:40,LEFT:37,RIGHT:39},A=c("/Class_mlayer").extend({init:function(){A.__super__.init.apply(this,arguments);u.define(this,["suggest","submit"]);var a=this._,b=a.input,c=a.proxyShow=x(this.show,this),d=a.proxyHide=x(this.hide,this),e=a.proxyKey=x(function(a){a=q(a);var c,d;if((c=this.getDomList().list.childNodes)&&c.length){d=z(c);switch(a.keyCode){case y.ENTER:d&&(b.value=decodeURIComponent(d.getAttribute("value")));b.blur();this.trigger("submit",[b.value]);r(a);break;case y.ESC:b.blur();s(a);break;case y.UP:var e=d?d.previousSibling:c[c.length-1];d&&k(d,"cur");e&&j(e,"cur");b.value=e?decodeURIComponent(e.getAttribute("value")):b._value;s(a);break;case y.DOWN:var e=d?d.nextSibling:c[0];d&&k(d,"cur");e&&j(e,"cur");b.value=e?decodeURIComponent(e.getAttribute("value")):b._value;s(a);break;case y.LEFT:case y.RIGHT:break;default:setTimeout(function(){b._value=b.value})}}},this),f=a.proxyOnkeydownIE9=x(function(){var a=window.event.keyCode;(a==8||a==46)&&c},this);m(b,"focus",c);m(b,"blur",d);m(b,"keydown",e);window.addEventListener?b.addEventListener("input",c,!1):b.attachEvent("onpropertychange",c);if(window.VBArray&&window.addEventListener){b.attachEvent("onkeydown",f);b.attachEvent("oncut",c)}this.on("select","click",x(function(a){b.value=decodeURIComponent(a.el.getAttribute("value"));this.trigger("submit",[b.value])},this));b.setAttribute("autocomplete","off");b._value=b.value},html:function(a){return A.__super__.html.apply(this,[a,this.getDomList().list])},show:function(){function b(b,c){if(this._.input!=document.activeElement)return this.hide();if(c!=this._.lastkey)return this;if(!b||b.length<=0)return this.hide();var d="";p(b,function(a,b){a=[].concat(a);a[1]=a[1]||a[0];d+='<li action-type="select" value="'+encodeURIComponent(a[1])+'"><a href="javascript:void(0);">'+a[0]+"</a></li>"});A.__super__.show.apply(this,a);this.beside(this._.input,{pos:this._.pos,offsetX:this._.offsetX,offsetY:this._.offsetY});var e=this._.width||this._.input.offsetWidth-6;this._.node.style.cssText+=";min-width:"+e+"px;_width:"+e+"px;";this.html(d);j(this._.node,"UI_autoHeight");this.autoHeight();return this}var a=arguments;if(this._.input!=document.activeElement)return this;this.trigger("suggest",[this._.input.value,x(b,this,this._.lastkey=t())]);return this},hide:function(){this.getBox().style.height="";setTimeout(x(function(){this.html("");A.__super__.hide.apply(this,arguments)},this),200);return this},destroy:function(){var a=this._,b=a.input;n(b,"focus",a.proxyShow);n(b,"blur",a.proxyHide);n(b,"keydown",a.proxyKey);window.addEventListener?b.removeEventListener("input",a.proxyShow,!1):b.detachEvent("onpropertychange",a.proxyShow);if(window.VBArray&&window.addEventListener){b.detachEvent("onkeydown",a.proxyOnkeydownIE9);b.detachEvent("oncut",a.proxyShow)}return A.__super__.destroy.apply(this,arguments)}});A.defalutOpts=w({},A.defalutOpts);A.defalutOpts.template='<div class="layer_menu_list" style="overflow:hidden;"><ul node-type="list"></ul></div>';A.defalutOpts.pos="bottom-left";A.defalutOpts.offsetX=0;A.defalutOpts.offsetY=0;A.defalutOpts.width=!1;A.defalutOpts.showWithAni=null;A.defalutOpts.hideWithAni=null;A.defalutOpts.heightWidthAni=!0;a.exports=function(a,b){b=b||{};a&&(b.input=a);return new A(b)}},"/core/utils/focusHistory":function(a,b,c,d){var e=d("/core/theia")||STK;a.exports=function(a,b){var c=[],d=function(a){if(!a||a==document.body)return!1;if(a.getAttribute("action-history")){var b=e.core.json.queryToJson(a.getAttribute("action-history"));if(b&&b.rec&&b.rec==1)return a}return arguments.callee(a.parentNode)},f=function(a){var a=e.fixEvent(a),b=d(a.target);b&&g.push(b)},g={push:function(a){c.push(a);c.length>3&&c.shift()},focusback:function(a){var b=c.pop();if(!!b){b.getAttribute("tabIndex")||b.setAttribute("tabIndex","0");setTimeout(function(){b.focus()},200)}},destroy:function(){e.removeEvent(document.body,"click",f);c=null}},h=function(){e.addEvent(document.body,"click",f)};h();return g}},"/core/utils/suggest":function(a,b,c,d){var e=d("/core/theia")||STK,f=null,g=e.custEvent,h=g.define,i=g.fire,j=g.add,k=e.addEvent,l=e.removeEvent,m=e.stopEvent,n=[],o={},p={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9},q=function(a){var b=-1,c=[],d=a.textNode,f=a.uiNode,g=e.core.evt.delegatedEvent(f),n=h(d,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);n.setFlag=o;var o=function(b){a.flag=b},q=function(){return e.sizzle(["[action-type=",a.actionType,"]"].join(""),f)},r=function(){b=-1;l(d,"keydown",s);g.destroy()},s=function(c){var f,g;if(!!(f=c)&&!!(g=f.keyCode)){if(g==p.ENTER){i(n,"onSelect",[b,d,a.flag]);e.preventDefault()}if(g==p.UP){m();var h=q().length;b=b<1?h-1:b-1;i(n,"onIndexChange",[b]);return!1}if(g==p.DOWN){m();var h=q().length;b=b==h-1?0:b+1;i(n,"onIndexChange",[b]);return!1}if(g==p.ESC){m();r();i(n,"onClose");return!1}if(g==p.TAB){r();i(n,"onClose");return!1}}},t=function(b){i(n,"onSelect",[e.core.arr.indexOf(b.el,q()),d,a.flag])},u=function(a){b=e.core.arr.indexOf(a.el,q());i(n,"onIndexChange",[e.core.arr.indexOf(a.el,q())])};j(n,"open",function(b,c){d=c;r();k(c,"keydown",s);g.add(a.actionType,"mouseover",u);g.add(a.actionType,"click",t);i(n,"onOpen",[a.flag])});j(n,"openSetFlag",function(a,b){o(b)});j(n,"close",function(){r();i(n,"onClose",[a.flag])});j(n,"indexChange",function(c,d){b=d;i(n,"onIndexChange",[b,a.flag])});return n},r=function(a){var b=a.textNode,c=e.core.arr.indexOf(b,n);if(!o[c]){n[c=n.length]=b;o[c]=q(a)}return o[c]};a.exports=function(a){if(!!a.textNode&&!!a.uiNode){a=e.parseParam({textNode:f,uiNode:f,actionType:"item",actionData:"index",flag:""},a);return r(a)}}},"/core/utils/tab":function(a,b,c,d){var e=d("/core/theia")||STK;a.exports=function(a){var b={},c,d,f,g,h,i={},j=null,k={selectTab:function(a){if(!i[a]){e.custEvent.fire(m,"tabInit",a);i[a]=!0}k.showTab(a);j&&e.custEvent.fire(m,"tabOut",j);e.custEvent.fire(m,"tabIn",a);j=a},showTab:function(a){if(j){d[j][0].className=b.defaultClassName;d[j][1]&&e.core.dom.setStyle(d[j][1],"display","none")}d[a][0].className=b.currentClassName;d[a][1]&&e.core.dom.setStyle(d[a][1],"display","")}},l={tabSwitch:function(a){var b=a.el,c=b.getAttribute("node-type")||"";c!=j&&k.selectTab(c)}},m={getOuter:function(){return g},getDEvent:function(){return h},getDom:function(a){return d[a]?d[a]:null},setContent:function(a,b){typeof b=="string"?d[a].innerHTML=b:e.isNode(b)&&d[a].appendChild(b)},destroy:function(){h.destroy();i=null}},n={init:function(){n.pars();n.build();n.bind();k.selectTab(b.currentTab)},pars:function(){b=e.core.obj.parseParam({templete:"",currentTab:"tab1",eventType:"click",currentClassName:"pftb_lk current S_line5 S_txt1 S_bg5",defaultClassName:"pftb_lk S_line5 S_txt1 S_bg1"},a||{})},build:function(){c=e.core.dom.builder(b.templete);d=c.list;f=d.content[0];g=c.list.tabs[0]},bind:function(){e.custEvent.define(m,["tabInit","tabIn","tabOut"]);h=e.core.evt.delegatedEvent(g);h.add("tab",b.eventType,l.tabSwitch)}};n.init();return m}},"/core/utils/slider":function(a,b,c,d){var e=d("/core/theia")||STK,f=c("/core/utils/children"),g=c("/core/utils/parseDOM");a.exports=function(a,b){e.core.dom.isNode(a)||e.log("[kit.extra.slider]: node is not a Node!");var c={},d={},h,i,j,k,l,m,n=!1,o=!1,p=e.core.dom.setStyle,q={isMouseLeaveOrEnter:function(a,b){if(a&&a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},onMouseover:function(a){q.isMouseLeaveOrEnter(a,i)&&clearInterval(l)},onMouseout:function(a){q.isMouseLeaveOrEnter(a,i)&&(!n||b.autoRun)&&(l=setInterval(t.autoSlideLeft,b.speed_banner))}},r={choice:function(a){var d=a.data;n=!0;o=!0;var g=f(i),h=a.el;e.core.arr.foreach(g,function(a,c){if(a!=h)e.core.dom.removeClassName(a,b.className);else if(e.hasClassName(a,b.className)){e.core.dom.removeClassName(a,b.className);n=!1;o=!1}else e.core.dom.addClassName(a,b.className)});e.core.evt.custEvent.fire(c,"choice",d)},clickLeft:function(){d.newTime=new Date;d.stepTime=d.newTime-d.oldTime;d.stepTime>300?d.stepTime=b.speed_tween_fast:d.stepTime=50;d.oldTime=d.newTime;clearInterval(l);t.handleSlideRight(d.stepTime);if(!n||b.autoRun==0)l=setInterval(t.autoSlideLeft,b.speed_banner)},clickRight:function(){d.newTime=new Date;d.stepTime=d.newTime-d.oldTime;d.stepTime>300?d.stepTime=b.speed_tween_fast:d.stepTime=50;d.oldTime=d.newTime;clearInterval(l);t.autoSlideLeft(d.stepTime);if(!n||b.autoRun==0)l=setInterval(t.autoSlideLeft,b.speed_banner)}},s={slideDot:function(a,c){clearInterval(l);var d=c.toPage-c.currentPage>0?c.toPage-c.currentPage:c.totalPage-c.currentPage+c.toPage,f=(b.eleWidth+b.eleMargin)*Math.abs(d),g=c.speed||b.speed_tween;k=e.core.ani.tween(i,{animationType:b.tween_algorithm,duration:g,end:function(){for(var a=0,b=d;a<b;a++){var c=e.core.dom.firstChild(i);e.core.dom.insertElement(i,c,"beforeend")}p(i,"left","0px")}}).play({left:-f});l=setInterval(t.autoSlideLeft,b.speed_banner)}},t={autoSlideLeft:function(a){t.animate("left",function(){for(var a=0,c=b.num_everyTurn;a<c;a++){var d=e.core.dom.firstChild(i);e.core.dom.insertElement(i,d,"beforeend")}p(i,"left","0px")},a);e.core.evt.custEvent.fire(c,"left")},handleSlideRight:function(a){for(var d=0,f=b.num_everyTurn;d<f;d++){var g=e.core.dom.lastChild(i);e.core.dom.insertElement(i,g,"afterbegin")}p(i,"left",-(m-b.fix_right)+"px");t.animate("right",function(){},a);e.core.evt.custEvent.fire(c,"right")},animate:function(a,c,d){a=a=="left"?m:0;d=d||b.speed_tween;k=e.core.ani.tween(i,{animationType:b.tween_algorithm,duration:d,end:c}).play({left:-a})}},u={init:function(){u.pars();u.build();u.bind();if(b.num_all>b.num_everyTurn){if(b.num_all<2*b.num_everyTurn){var a=2*b.num_everyTurn-b.num_all;for(var c=0,d=a;c<d;c++){var g=f(i)[c],h=g.cloneNode(!0);e.core.dom.insertElement(i,h,"beforeend")}var j=(b.eleWidth+b.eleMargin)*2*b.num_everyTurn+b.fix;p(i,"width",j+"px")}b.autoRun&&(l=setInterval(t.autoSlideLeft,b.speed_banner))}},pars:function(){b=e.core.obj.parseParam({speed_banner:3e3,speed_tween:500,speed_tween_fast:300,tween_algorithm:"easeoutcubic",num_everyTurn:1,eleMargin:0,fix:0,fix_right:0,actionType:"choice",className:"current",autoRun:!0},b||{});h=g(e.builder(a).list);i=h.innerSlide;b.num_all=f(i).length;b.eleWidth=e.core.dom.firstChild(i).offsetWidth;d.oldTime=new Date},build:function(){i.style.left||p(i,"left","0px");p(i,"position","relative");var a=(b.eleWidth+b.eleMargin)*b.num_all+b.fix;p(i,"width",a+"px");m=(b.eleWidth+b.eleMargin)*b.num_everyTurn},bind:function(){e.addEvent(i,"mouseover",q.onMouseover);e.addEvent(i,"mouseout",q.onMouseout);j=e.core.evt.delegatedEvent(a);j.add("prev","click",r.clickLeft);j.add("next","click",r.clickRight);b.actionType&&j.add(b.actionType,"click",r.choice);e.core.evt.custEvent.define(c,["left","right","choice","changePage"]);e.core.evt.custEvent.add(c,"changePage",s.slideDot)},destroy:function(){clearInterval(l);k.destroy();e.removeEvent(i,"mouseover",q.onMouseover);e.removeEvent(i,"mouseout",q.onMouseout);e.core.evt.custEvent.remove(c);j.destroy()}};u.init();c.destroy=u.destroy;return c}},"/core/utils/children":function(a,b,c,d){var e=d("/core/theia")||STK;a.exports=function(a){if(!e.core.dom.isNode(a))throw"Parameter must be an HTMLEelement!";var b=[];for(var c=0,d=a.childNodes.length;c<d;c++)a.childNodes[c].nodeType==1&&b.push(a.childNodes[c]);return b}},"/calendar":function(a,b,c,d){var e=c("/$")[0],f=c("/$")[1].language,g=c("/Class_mlayer"),h=c("/templates/calendar.html");a.exports=function(a){var b={},c,d={id:"",data:{},chooseDate:"",source:null,calNode:null,layer:null,today:{},showDate:{},start:null,end:null,count:null,firstWeek:null,format:[],years:[],changeDom:{},defaultStartDate:new Date(2009,7,16,0,0,0,0),daysOfMonth:[31,28,31,30,31,30,31,31,30,31,30,31],dateOfMonth:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]},i={close:function(){e.core.evt.stopEvent();e.removeEvent(document.body,"click",i.close);d.layer.hide()},changeYear:function(a){a=e.fixEvent(a);var b=a.target,c=b.value;if(c!=d.showDate.year){d.showDate.year=c;c==d.start.year&&(d.showDate.month=d.start.month);c==d.end.year&&(d.showDate.month=d.end.month);k.getCurrentMonthInfo(d.data.hidePastMonth);l.drawCal()}},changeMonth:function(a){a=e.fixEvent(a);var b=a.target,c=b.value;if(c!=d.showDate.month){d.showDate.month=c*1;k.getCurrentMonthInfo(d.data.hidePastMonth);l.drawCal()}}},j={date:function(a){var c=a.el.title;c=c.replace(/(\d+)/g,function(a,b){return b.length==1?"0"+b:b});d.chooseDate=c;e.custEvent.fire(b,"choose",{date:c});if(d.callback&&typeof d.callback=="function"){var f={};f.start=d.data.start;f.end=d.data.end;d.callback(c,f)}}},k={parseDate:function(a){var b,c,d,e,f=/^(\d{4})[-\/](\d{1,2})[-\/](\d{1,2})$/,g,h;if(!a)b=new Date;else if(typeof a=="string"&&f.test(a)){b=a.match(f);c=b[1]*1;d=b[2]*1-1;e=b[3]*1;b=new Date(c,d,e,0,0,0,0)}else a.constructor==Date?b=a:typeof a=="object"?b=new Date(a.year,a.month,a.date,0,0,0,0):typeof a=="string"?b=new Date(a):b=new Date;h={year:b.getFullYear(),month:b.getMonth(),date:b.getDate()};g=k.getMaxDays(h.year,h.month);h.max=g;return h},getMaxDays:function(a,b){return b==1?a%4==0&&a%100!=0||a%400==0?29:28:d.daysOfMonth[b]},getStartAndEndDays:function(a){if(a){d.start=a.start!=null?a.start:d.defaultStartDate;d.end=a.end!=null?a.end:new Date;d.start.toString().indexOf("-")!=-1&&(d.start=d.start.replace(/-/g,"/"));d.end.toString().indexOf("-")!=-1&&(d.end=d.end.replace(/-/g,"/"));d.defaultStartDate=new Date(d.start)}else{d.start=d.defaultStartDate;d.end=new Date}d.start=k.parseDate(d.start);d.end=k.parseDate(d.end)},getCurrentMonthInfo:function(){var a=d.showDate,b=a.year,c=a.month,f=a.date,g=new Date(b,c,1,0,0,0,0);d.count=k.getMaxDays(b,c);d.firstWeek=g.getDay();var h=e.core.arr.copy(d.dateOfMonth),i=d.firstWeek==0?[]:Array(d.firstWeek).join().split(",");d.format=i.concat(h.splice(0,d.count))},drawYear:function(){var a=$CONFIG!=null&&$CONFIG.timeDiff!=null?$CONFIG.timeDiff:0;a=isNaN(a-1)?0:a;var b=d.defaultStartDate.getFullYear(),c=(new Date((new Date(d.end.year,d.end.month,d.end.date)).getTime()-a)).getFullYear(),e=c-b,f=0;d.years=[];while(f<=e){d.years.push(b+f);f++}},getDate:function(){return d.chooseDate},getDateOffset:function(a){var b=a;return(new Date(b.year,b.month,b.date)).getTime()}},l={drawCal:function(a){d.data={today:d.today,showDate:d.showDate,start:d.start,end:d.end,dates:d.format,years:d.years,hidePastMonth:a,currDate:k.getMaxDays()};d.data.showDateOffset=k.getDateOffset(d.showDate);d.data.startOffset=k.getDateOffset(d.start);d.data.endOffset=k.getDateOffset(d.end);d.data.datesOffset=[];for(var b=0,c=d.data.dates.length;b<c;b++){var i={year:d.showDate.year,month:d.showDate.month,date:d.data.dates[b]};d.data.datesOffset.push({d:d.data.dates[b],dOffset:k.getDateOffset(i)})}if(!d.layer){var j=new g({id:"calendar_layer"+e.getUniqueKey(),showWithAni:null,hideWithAni:null});j.html(f(e.core.util.easyTemplate(h,d.data).toString()));d.calNode=j.getBox();d.calNode.className="pc_caldr W_layer";d.layer=j;l.bind();l.bindMonthYear()}else{d.layer.html(f(e.core.util.easyTemplate(h,d.data).toString()));l.removeMonthYear();l.bindMonthYear()}e.core.evt.stopEvent()},show:function(a,c){e.core.evt.stopEvent();d.layer.show();d.layer.beside(a,c);e.addEvent(document.body,"click",i.close);return b},hide:function(){e.removeEvent(document.body,"click",i.close);d.layer.hide();return b},state:function(){return d.layer.getState()},bind:function(){c=e.delegatedEvent(d.calNode);c.add("date","click",j.date);e.custEvent.define(b,["choose"])},bindMonthYear:function(){var a=d.layer.getDomList(!0);d.changeDom.year=a.year;d.changeDom.month=a.month;e.addEvent(d.changeDom.year,"change",i.changeYear);e.addEvent(d.changeDom.month,"change",i.changeMonth)},removeMonthYear:function(){d.changeDom&&d.changeDom.year&&e.removeEvent(d.changeDom.year,"change",i.changeYear);d.changeDom&&d.changeDom.month&&e.removeEvent(d.changeDom.month,"change",i.changeMonth)}},m={init:function(){m.pars();m.build();m.bind()},pars:function(){d.callback=a.callback;d.currentDate=a.currentDate},build:function(){d.today=k.parseDate();for(var b in d.today)d.showDate[b]=d.today[b];k.getStartAndEndDays(a);k.getCurrentMonthInfo();k.drawYear();l.drawCal(a.hidePastMonth)},bind:function(){e.addEvent(d.calNode,"click",function(){e.core.evt.stopEvent()})},destroy:function(){d.layer&&d.layer.destroy();d.layer=null;l.removeMonthYear()}};m.init();b.show=l.show;b.hide=l.hide;b.state=l.state;b.getDate=k.getDate;b.destroy=m.destroy;return b}},"/templates/calendar.html":function(a,b,c,d){a.exports='<#et userlist data>\n\t<div class="selector">\n\t\t<select node-type="month" class="month htc_select">\n\t\t<#if (data.hidePastMonth)>\n\t\t\t<#if (!(data.start.year == data.showDate.year&& data.currDate.month>0))><option value="0" ${data.showDate.month==0?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>1)||(data.end.year == data.showDate.year&& data.currDate.month<1)))><option value="1" ${data.showDate.month==1?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>2)||(data.end.year == data.showDate.year&& data.currDate.month<2)))><option value="2" ${data.showDate.month==2?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>3)||(data.end.year == data.showDate.year&& data.currDate.month<3)))><option value="3" ${data.showDate.month==3?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>4)||(data.end.year == data.showDate.year&& data.currDate.month<4)))><option value="4" ${data.showDate.month==4?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>5)||(data.end.year == data.showDate.year&& data.currDate.month<5)))><option value="5" ${data.showDate.month==5?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>6)||(data.end.year == data.showDate.year&& data.currDate.month<6)))><option value="6" ${data.showDate.month==6?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>7)||(data.end.year == data.showDate.year&& data.currDate.month<7)))><option value="7" ${data.showDate.month==7?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>8)||(data.end.year == data.showDate.year&& data.currDate.month<8)))><option value="8" ${data.showDate.month==8?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>9)||(data.end.year == data.showDate.year&& data.currDate.month<9)))><option value="9" ${data.showDate.month==9?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!((data.start.year == data.showDate.year&& data.currDate.month>10)||(data.end.year == data.showDate.year&& data.currDate.month<10)))><option value="10" ${data.showDate.month==10?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t\t<#if (!(data.end.year == data.showDate.year&& data.currDate.month<11))><option value="11" ${data.showDate.month==11?\\\'selected=""\\\':\\\'\\\'}>#L{}</option></#if>\n\t\t<#else>\n\t\t\t<option value="0"  ${data.showDate.month==0?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="1"  ${data.showDate.month==1?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="2"  ${data.showDate.month==2?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="3"  ${data.showDate.month==3?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="4"  ${data.showDate.month==4?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="5"  ${data.showDate.month==5?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="6"  ${data.showDate.month==6?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="7"  ${data.showDate.month==7?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="8"  ${data.showDate.month==8?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="9"  ${data.showDate.month==9?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="10" ${data.showDate.month==10?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t\t<option value="11" ${data.showDate.month==11?\\\'selected=""\\\':\\\'\\\'}>#L{}</option>\n\t\t</#if>\n\t\t</select>\n\t\t<select node-type="year" class="year htc_select">\n\t\t\t<#list data.years as year>\n\t\t\t\t<option value="${year}"${(data.showDate.year==year)?\\\' selected=""\\\':""}>${year}</option>\n\t\t\t</#list>\n\t\t</select>\n\t</div>\n\t<ul class="weeks">\n\t\t<li>#L{}</li><li>#L{}</li><li>#L{}</li><li>#L{}</li><li>#L{}</li><li>#L{}</li><li>#L{}</li>\n\t</ul>\n\t<ul class="days">\n\t<#list data.datesOffset as list>\n\t\t<li>\n\t\t<#if (list!="")>\n\t\t\t<#if (data.startOffset <= list.dOffset && list.dOffset <=data.endOffset)>\n\t\t\t\t<a action-type="date" href="#date" onclick="return false;" \n\t\t\t\t\ttitle="${data.showDate.year}-${data.showDate.month+1}-${list.d}"\n\t\t\t\t\tyear="${data.showDate.year}" month="${data.showDate.month+1}" day="${list.d}"\n\t\t\t\t\t${(data.today.year==data.showDate.year&&data.today.month==data.showDate.month&&list.d==data.showDate.date)?\\\' class="day"\\\':\\\'\\\'}><strong>${list.d}</strong></a>\n\t\t\t<#else>\n\t\t\t\t${list.d}\n\t\t\t</#if>\n\t\t</#if> \n\t\t</li>\n\t</#list>\n\t</ul>\n</#et>'}});
STK.foreach(["uid","nick","sex","lang","interactiveUrl","loadingUrl","relationUrl","usercard"],function(a){$CONFIG[a]=b.getAttribute?b.getAttribute("config-"+a):b["config-"+a]});STK.register("lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b){var c=[].splice.call(arguments,1,arguments.length),d=[b,$LANG].concat(c),e=a.core.util.language.apply(this,d);return e}});
STK.register("lib.feed.imageLikeWhiteList",function(a){return function(){return!0}});
STK.register("lib.feed.feedTemps",function(a){var b=a.lib.kit.extra.language,c=$CONFIG.imgPath+"/style/images/common/loading.gif",d=a.lib.feed.imageLikeWhiteList();return{loadingIMG:b('<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>#L{}...</p> </div> </div> </div>'),loadingHTML:b('<div class="WB_cardwrap WB_notes" requestType="[n]"><span class="wrap"><i class="W_loading"></i>#L{}</span></div>'),loadErrorRetryHTML:b('<div class="WB_cardwrap WB_notes"><a action-type="feed_list_retry" requestType="[n]" href="javascript:void(0)"><i class="W_icon icon_rederrorS"></i>#L{}</a></div>'),loadErrorEndHTML:b('<div class="WB_cardwrap WB_notes"><span class="wrap"><i class="W_loading"></i>#L{}</span></div>'),mediaIMGTEMP:b('<#et temp data><p class="medis_func S_txt3"><a action-type="feed_list_media_toSmall"  href="javascript:void(0);" class="retract" <#if (data.suda && data.suda.retract)>suda-data="${data.suda.retract}"</#if>><em class="W_ico12 ico_retract"></em>#L{}</a><i class="W_vline">|</i><a action-type="feed_list_media_toLeft" href="javascript:void(0);" class="turn_left" <#if (data.suda && data.suda.left)>suda-data="${data.suda.left}"</#if>><em class="W_ico12 ico_turnleft"></em>#L{}</a><i class="W_vline">|</i><a action-type="feed_list_media_toRight" <#if (data.suda && data.suda.right)>suda-data="${data.suda.right}"</#if> href="javascript:void(0);" class="turn_right"><em class="W_ico12 ico_turnright"></em>#L{}</a></p><div class="smallcursor"  action-type="feed_list_media_bigimgDiv" <#if (data.suda && data.suda.big)>suda-data="${data.suda.big}"</#if>><img dynamic-id="${data.uniqueId}"   action-type="feed_list_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}"/></div></#et>'),mediaIMGTEMPwithBtn:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnright S_ficon">n</i>#L{}</a></span></li></ul></div></div><div action-type="feed_list_media_bigimgDiv" class="WB_media_view"><div class="media_show_box"><ul class="clearfix"><li class="smallcursor"><div class="artwork_box"><img dynamic-id="${data.uniqueId}"   action-type="feed_list_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}"/><span style="display:none;" action-type="feed_list_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}"><#if (data.is_liked)><a href="javascript:;" class="W_btn_alpha" title="#L{}"><i class="icon_praised"></i><span node-type="count">(${data.count})</span></a></div><#else><a href="javascript:;" class="W_btn_alpha" title="#L{}"><i class="icon_praise"></i><span node-type="count">(${data.count})</span></a></#if></span></li></ul></div></div></div></#et>'),mediaVideoMusicTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i></a></span></li><#if (data.title)><li><span class="line S_line1"><a target="_blank" href="${data.full_url}" class="S_txt1"><i class="W_ficon ficon_arrow_bigimg S_ficon">l</i>${data.title}</a></span></li></#if></ul></div></div><div node-type="feed_list_media_big${data.type}Div" class="WB_app_view"><img class="loading_gif" src="'+c+'"/>'+"</div>"+"</div>"+"</#et>"),mediaVideoMusicFloatTEMP:b('<#et temp data><div node-type="outer" class="W_layer WB_outReset" style=""><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content"><div class="title"><h3>${data.title}</h3></div><a href="javascript:void(0);" onclick="return false;" node-type="close" class="W_close"></a><div node-type="mediaContent" style="text-align:center;width:440px;"><img style="margin:10px;" class="loading_gif" src="'+c+'"/></div>'+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"+"</#et>"),widgetTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i></a></span></li><#if (data.title && data.full_url)><li><span class="line S_line1"><a target="_blank" target="_blank" href="${data.full_url}" class="S_txt1"><i class="W_ficon ficon_arrow_bigimg S_ficon">l</i>${data.title}</a></span></li></#if></ul></div></div><div node-type="feed_list_media_widgetDiv" class="WB_app_view"><img class="loading_gif" src="'+c+'"/>'+"</div>"+"</div>"+"</#et>"),qingTEMP:b('<#et temp data><p class="medis_func S_txt3"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract"><em class="W_ico12 ico_retract"></em>#L{}</a><i class="W_vline">|</i><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank"><em class="W_ico12 ico_showbig"></em>${data.title}</a></p><div node-type="feed_list_media_qingDiv"><img class="loading_gif" src="'+c+'"/></div>'+"</#et>"),commonMediaTEMP:b('<#et temp data><p class="medis_func S_txt3"><a href="javascript:void(0);" action-type="common_list_media_hide" action-data="type=${data.type}&id=${data.id}" suda-data="key=tblog_activity_click&value=fold_play" class="retract"><em class="W_ico12 ico_retract"></em>#L{}</a><i class="W_vline">|</i><a href="${data.url}"  action-type="feed_list_url" title="${data.title}" class="show_big" target="_blank" suda-data="key=tblog_activity_click&value=url_click"><em class="W_ico12 ico_showbig"></em>${data.title}</a><#if (data.tofloat)><i class="W_vline">|</i><a action-type="common_list_media_toFloat" action-data="title=${data.title}&type=${data.type}&id=${data.id}" href="javascript:void(0);" class="turn_right" suda-data="key=tblog_activity_click&value=bomb_play">#L{}</a></#if></p><div node-type="common_list_media_Div" style="text-align:center;min-height:18px;"><img class="loading_gif" src="'+c+'"/></div>'+"</#et>"),translateTEMP:b('<#et temp data><div class="layer_tips" node-type="feed_translate" style="position:absolute;"><a class="W_ico12 icon_close" href="javascript:void(0)" suda-data="key=tblog_bowen_translate&value=close_button" action-type="feed_translate_close"></a><div class="S_txt2">#L{}:</div><div node-type="translate_rs">${data.text}</div><div class="copyright S_txt2"><span class="cr_l">#L{}<a href="http://weibo.com/youdaocidian" target="_blank" suda-data="key=tblog_bowen_translate&value=click_youdao_link" title="#L{}">#L{}</a>#L{}</span> <a href="javascript:void(0)" suda-data="key=tblog_bowen_translate&value=click_i_translate" action-type="feed_translate_by_me" action-data="${data.bymedata}">#L{}</a></div></div></#et>')}});
STK.register("lib.kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("lib.kit.dom.lastChild",function(a){var b=a.core.dom.prev;return function(a){var c=a.lastChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("lib.kit.dom.children",function(a){return function(b){if(!a.core.dom.isNode(b))throw"Parameter must be an HTMLEelement!";var c=[];for(var d=0,e=b.childNodes.length;d<e;d++)b.childNodes[d].nodeType==1&&c.push(b.childNodes[d]);return c}});
STK.register("lib.kit.dom.parentAttr",function(a){return function(a,b,c){var d;if(a&&b){c=c||document.body;while(a&&a!=c&&!(d=a.getAttribute(b)))a=a.parentNode}return d}});
STK.register("lib.kit.extra.parseURL",function(a){return function(){return STK.historyM&&STK.historyM.parseURL?STK.historyM.parseURL():a.core.str.parseURL(location.href)}});
STK.register("lib.feed.API",function(a){function h(b,c){function g(){var b=!0;a.foreach(d,function(a){(a.naturalHeight||a.height)==0&&(b=!1)});b&&f()}function f(){clearTimeout(e);a.foreach(d,function(b){a.removeEvent(b,"load",g)});c&&c()}var d=a.sizzle("img",b),e;a.foreach(d,function(b){a.addEvent(b,"load",g)});e=setTimeout(f,2e3)}var b=a.lib.feed.feedTemps,c=a.lib.kit.dom.firstChild,d=a.lib.kit.dom.lastChild,e=a.lib.kit.dom.children,f=a.core.dom.insertElement,g=a.lib.kit.extra.language,i={getMid:function(a,b){var c=i.getFeedNode(a,b);return c?c.getAttribute("mid"):null},getFeedNode:function(b,c){return a.core.dom.dir(b,{expr:"[action-type=feed_list_item]",endpoint:c||document.body})[0]},getFeeds:function(b,c){return a.sizzle("["+c+"]",b)},preventDefault:function(b){a.preventDefault();return!1}},j=function(b){a.custEvent.fire(b,"clearTips","base")},k=function(d,e){var f;switch(d){case"waiting":f=b.loadingHTML;break;case"retry":f=b.loadErrorRetryHTML;break;case"end":f=b.loadErrorEndHTML}return c(a.builder(f.replace("[n]",e)).box)};return function(b,c){a.isNode(b)||a.log("baseFeedList : parameter node is not a document node!");b.getAttribute("node-type")!="feed_list"&&(b=a.sizzle('div[node-type="feed_list"]',b)[0]);c=a.parseParam({end_id:""},c);var d={},g={},l=a.core.evt.delegatedEvent(b),m,n,o=Math.max(g.page|0,1),p=!1,q={},r=g.end_id;l.add("feed_list_retry","click",function(c){j(b);var d=c.el.getAttribute("requestType"),e=q[d].location;e=="top"?t("waiting",d):u("waiting",d);a.custEvent.fire(w,"request",[d,q[d].data]);return i.preventDefault(c.evt)});var s=function(){if(o<2){var c,d={};if(c=a.sizzle("div[node-type=feedsincemaxid]",b)[0])r=a.queryToJson(c.getAttribute("action-data")||"").end_id;else{var e=w.getFirstFeed();e&&(r=e.getAttribute("mid"))}}},t=function(a,c){p=!0;w.removeTopNode();f(b,m=k(a,c),"afterbegin")},u=function(a,c){w.removeBottomNode();b.appendChild(n=k(a,c))},v=!0,w={extra:{},extraData:{},getNode:function(){return b},getRecommend:function(){return a.sizzle('[node-type="feed_list_recommend"]',b)},removeRecommend:function(){var b=w.getRecommend();if(b&&b.length>0)for(var c in b)a.core.dom.removeNode(b[c])},getNodeList:function(){var c=a.sizzle('div[action-type="feed_list_item"]',b);return c.length?c:!1},getDEvent:function(){return l},removeTopNode:function(){a.removeNode(m);m=null},setTopNode:function(a){m=a},removeBottomNode:function(){a.removeNode(n);n=null},setBottomNode:function(a){n=a},getEndId:function(){return r},isTopWaiting:function(){return p},getCurrentPage:function(){var b=a.lib.kit.extra.parseURL(),c=a.core.json.queryToJson(b.query);o=c.page||1;return o},setCurrentPage:function(a){o=a},getFeedCount:function(){return i.getFeeds(b,'action-type="feed_list_item"').length},setRequestAction:function(b,c){d[b]=a.parseParam({top:!1,center:!1,bottom:!1},c)},setRequestData:function(a,b){q[a]={data:b,time:0}},getExtraData:function(a){return w.extraData[a]},setExtraData:function(a,b){w.extraData[a]=b},setExtraFunction:function(a,b){w.extra[a]=b},regCustEvent:function(b,c){a.custEvent.define(w,b);a.custEvent.add(w,b,c)},getFirstFeed:function(){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])",b);return c[0]},getLastFeed:function(){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])",b);return c[c.length-1]},getFirstFeedId:function(){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])",b),d=c[0];return d?d.getAttribute("mid"):""},getLastFeedId:function(){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])",b),d=c[c.length-1];return d?d.getAttribute("mid"):""},getFirstFeedAttr:function(c){var d=a.sizzle("[action-type=feed_list_item]:not([feedtype])",b),e=d[0];return e?e.getAttribute(c):""},getLastFeedAttr:function(c){var d=a.sizzle("[action-type=feed_list_item]:not([feedtype])",b),e=d[d.length-1];return e?e.getAttribute(c):""},showZeroTip:function(){var c=a.sizzle('div[node-type="feed_list_zero"]',b)[0];c&&(c.style.display="")},hideZeroTip:function(){var c=a.sizzle('div[node-type="feed_list_zero"]',b)[0];c&&(c.style.display="none")},insertFakeFeed:function(c){setTimeout(function(){if(typeof c!="string")a.log("insertFakeFeed feedHtml is not String!");else{w.hideZeroTip();var d=a.C("div");d.innerHTML=c;var e=a.C("div"),f,g;e.className="WB_feed_type_box_t";e.appendChild(a.sizzle('div[action-type="feed_list_item"]',d)[0]);m&&a.contains(document.body,m)?a.core.dom.insertAfter(e,m):a.core.dom.insertElement(b,e,"afterbegin");g=e.offsetHeight;if(b.getBoundingClientRect().top-60>0){e.style.cssText+="height:0;opacity:0;-webkit-transition:height .15s ease-out;-moz-transition:height .15s ease-out;-o-transition:height .15s ease-out;transition:height .15s ease-out;";h(e,function(){setTimeout(function(){e.style.height=e.scrollHeight+"px"});setTimeout(function(){e.style.opacity=1;a.ui.effect(e,"fadeInDownSmall","fast",function(){setTimeout(function(){while(f=e.firstChild){a.insertBefore(f,e);f.setAttribute("feedtype","fake")}a.removeNode(e)})})},300)})}else{while(f=e.firstChild)a.insertBefore(f,e);a.removeNode(e);document.body.scrollTop=document.documentElement.scrollTop=a.scrollPos().top+g+10}var i=a.sizzle('[node-type="empty_module"]',b);i&&i[0]&&(i[0].style.display="none");setTimeout(function(){if(a.IE){var b=a.sizzle(".WB_main_c")[0];b.style.visibility?b.style.visibility="":b.style.visibility="inherit"}})}},200)},updateFeed:function(c,d,g){if(c&&d){w.hideZeroTip();var i=a.C("div");i.innerHTML=c;var j=a.C("div"),k=a.sizzle("[action-type=feed_list_item]",i)[0],l;k&&k.parentNode?l=e(k.parentNode):l=[i];var n;while(n=l.shift())j.appendChild(n);j.className="WB_feed_type_box_t";if(d=="top"){p=!1;a.foreach(a.sizzle("[action-type=feed_list_item][feedtype=fake]",b),function(b){a.removeNode(b)});m&&a.contains(document.body,m)?a.core.dom.insertAfter(j,m):a.core.dom.insertElement(b,j,"afterbegin");j.style.cssText+="height:0;opacity:0;-webkit-transition:height .15s ease-out;-moz-transition:height .15s ease-out;-o-transition:height .15s ease-out;transition:height .15s ease-out;";h(j,function(){setTimeout(function(){j.style.height=j.scrollHeight+"px"});setTimeout(function(){w.removeTopNode();j.style.opacity="1";a.ui.effect(j,"fadeInDownSmall","fast",function(){setTimeout(function(){while(n=j.firstChild)a.insertBefore(n,j);a.removeNode(j);a.custEvent.fire(w,"updateFeed",[g,c]);s()})})},300)})}else if(d=="bottom"){w.removeBottomNode();f(b,j,"beforeend");a.ui.effect(j,"fadeInDown","normal",function(){while(n=j.firstChild)a.insertBefore(n,j);a.removeNode(j);a.custEvent.fire(w,"updateFeed",[g,c]);s()})}setTimeout(function(){if(a.IE){var b=a.sizzle(".WB_frame_c")[0];b.style.visibility?b.style.visibility="":b.style.visibility="inherit"}})}},showWait:function(c,d,e){c=="top"?t("waiting",d):c=="bottom"&&u("waiting",d);if(c=="center"){m&&a.core.util.hideContainer.appendChild(m);n&&a.core.util.hideContainer.appendChild(n);b.innerHTML="";m&&b.appendChild(m);n&&b.appendChild(n)}q[d]={data:e,time:0,location:c}},showError:function(b,c){if(b&&d[b]){var e=q[b],f;if(e.time>=3){e.time=0;f="end"}else{e.time++;f="retry"}b=="top"?t(f,c):b=="bottom"&&u(f,c);a.custEvent.fire(w,"showError",c)}},utils:i},x=function(){a.custEvent.define(w,["request","updateFeed","clearTips","updateEndId","showError","inView","smartSort","showRecommendTip","stopRecommendTip","inter"]);a.custEvent.add(w,"updateEndId",s);!r&&s()};x();w.destroy=function(){l.destroy();a.custEvent.undefine(w)};return w}});
STK.register("lib.dialog.loginLayer",function(a){var b,c="http://tjs.sjs.sinajs.cn/t5/register/js/page/remote/loginLayer.js";return function(d){d=a.core.obj.parseParam({lang:"zh-cn",loginSuccessUrl:encodeURIComponent(window.location.href)},d||{});if(window.WBtopGlobal_loginLayer)WBtopGlobal_loginLayer(d);else{if(b)return;b=!0;a.core.io.scriptLoader({url:c,onComplete:function(){b=!1;window.WBtopGlobal_loginLayer(d)},timeout:1e4,onTimeout:function(){b=!1}})}}});
STK.register("lib.kit.io.cssLoader",function(a){var b="",c="http://img.t.sinajs.cn/t4/",d="http://timg.sjs.sinajs.cn/t4/";if(typeof $CONFIG!="undefined"){c=$CONFIG.cssPath||c;b=$CONFIG.version||""}var e={};return function(f,g,h,i,j){i=i||b;h=h||function(){};var k=function(a,b){var c=e[a]||(e[a]={loaded:!1,list:[]});if(c.loaded){b(a);return!1}c.list.push(b);return c.list.length>1?!1:!0},l=function(a){var b=e[a].list;for(var c=0;c<b.length;c++)b[c](a);e[a].loaded=!0;delete e[a].list};if(!!k(f,h)){var m;j?m=d+f:m=c+f+"?version="+i;var n=a.C("link");n.setAttribute("rel","Stylesheet");n.setAttribute("type","text/css");n.setAttribute("charset","utf-8");n.setAttribute("href",m);document.getElementsByTagName("head")[0].appendChild(n);var o=a.C("div");o.id=g;a.core.util.hideContainer.appendChild(o);var p=3e3,q=function(){if(parseInt(a.core.dom.getStyle(o,"height"))==42){a.core.util.hideContainer.removeChild(o);l(f)}else if(--p>0)setTimeout(q,10);else{a.log(f+"timeout!");a.core.util.hideContainer.removeChild(o);delete e[f]}};setTimeout(q,50)}}});
STK.register("lib.dialog.authentication",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.core.util.browser;b=a.parseParam({src:"http://weibo.com/a/verify/realname?stage=home_verification",icon:"warn",isHold:!0,width:"380px",height:"240px",title:c("#L{}")},b||{});var e={},f,g,h=!1,i="tblog_checkfailed_reform",j={init:function(){f=a.ui.dialog(b);var c=[];c.push('<iframe id="account_authentication" name="account_authentication" node-type="frame" width="'+b.width+'" height="'+b.height+'" allowtransparency="true" scrolling="no" frameborder="0" src=""></iframe>');var d=a.builder(c.join(""));f.setTitle(b.title);f.setContent(d.box);var e=f.getDomList()},show:function(){try{window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_box")}catch(c){}h||a.lib.kit.io.cssLoader("style/css/module/layer/layer_check_identity.css","js_style_css_module_layer_check_identity",function(){h=!0});f.show().setMiddle();g=a.E("account_authentication");var d=decodeURIComponent(b.src)+"&rnd=";g.attachEvent?g.attachEvent("onload",function(){g.height=b.height;f.setMiddle()}):g.onload=function(){g.height=b.height;f.setMiddle()};g.src=d+a.core.util.getUniqueKey()},destroy:function(){},hook:function(a,b){try{a=="100000"?j.verifySucc():j.verifyFail()}catch(c){}},verifySucc:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_success");f.hide();var b={title:c("#L{}"),icon:"success",OK:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_play");history.go(0)},OKText:c("#L{}"),msg:c("#L{}")},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})},verifyFail:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_twotimes");f.hide();var b={title:c("#L{}"),icon:"warn",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_triple");j.show()},OKText:c("#L{}"),msg:c("#L{<br/>}")+'<a class="S_spetxt" suda-data="key=tblog_checkfailed_reform&value=checkfailed_havealook" href="http://weibo.com">'+c("#L{>>}")+"</a>"},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})}};j.init();e.destroy=j.destory;e.show=j.show;window.App=window.App||{};window.App.checkRealName=j.hook;return e}});
STK.register("lib.dialog.memberDialog",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt1" node-type="textComplex"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" class="W_btn_b" node-type="OK"></a><a href="javascript:void(0);" class="W_btn_a" node-type="cancel"></a><a href="http://vip.weibo.com/paycenter?pageid=byebank" class="W_btn_a" node-type="member"><span><em class="W_icon icon_member"></em>#L{}</span></a></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.lib.kit.extra.language,e=function(e,f){var g,h,i,j,k,l;g=a.parseParam({title:d("#L{}"),icon:"warn",textLarge:e,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{}"),cancel:a.funcEmpty,cancelText:d("#L{}")},f);g.icon=c[g.icon];h={};i=a.ui.dialog();i.setContent(d(b));l=i.getDomList(!0);l.icon.className=g.icon;l.textLarge.innerHTML=g.textLarge;l.textComplex.innerHTML=g.textComplex;l.textSmall.innerHTML=g.textSmall;l.OK.innerHTML="<span>"+g.OKText+"</span>";l.cancel.innerHTML="<span>"+g.cancelText+"</span>";i.setTitle(g.title);var m=function(){j=!0;k=a.htmlToJson(l.textComplex);i.hide()};a.addEvent(l.OK,"click",m);a.addEvent(l.cancel,"click",i.hide);a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);a.removeEvent(l.OK,"click",m);a.removeEvent(l.cancel,"click",i.hide);j?g.OK(k):g.cancel(k)});i.show().setMiddle();h.dia=i;return h};return function(b){b=a.parseParam({type:"follow",errortype:"1"},b);var c,f,g={textLarge:d("#L{}"),textComplex:d('#L{}<a href="http://vip.weibo.com/privilege">#L{}</a>#L{}'),textSmall:d('#L{}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{}</a>#L{10}'),OKText:d("#L{}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/whisper"}},h={textLarge:d("#L{}"),textComplex:d('#L{}<a href="http://vip.weibo.com/privilege">#L{}</a>#L{}'),textSmall:d('#L{}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{}</a>#L{2000}'),OKText:d("#L{}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/follow"}};if(b.type=="quiet"){switch(parseInt(b.errortype,10)){case 2:g.textLarge=d("#L{}");g.textSmall="";g.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{}</a>');break;case 1:g.textLarge=d("#L{}");g.textSmall="";g.textComplex=d('#L{}<a href="http://vip.weibo.com/privilege">#L{}</a>#L{}');break;case 3:g.textLarge=d("#L{}");g.textComplex=d('#L{}<a href="http://vip.weibo.com/privilege">#L{}</a>#L{}');g.textSmall=d('#L{}<a href="http://vip.weibo.com/paycenter">#L{}</a>#L{10}')}c=g}else{switch(parseInt(b.errortype,10)){case 2:h.textLarge=d("#L{}");h.textSmall="";h.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{}</a>');break;case 1:h.textLarge=d("#L{}");h.textSmall="";h.textComplex=d('#L{}<a href="http://vip.weibo.com/privilege">#L{}</a>#L{}');break;case 3:h.textLarge=d("#L{}");h.textComplex=d('#L{}<a href="http://vip.weibo.com/privilege">#L{}</a>#L{}');h.textSmall=d('#L{}<a href="http://vip.weibo.com/paycenter">#L{}</a>#L{2000}')}c=h}f=e("",c);parseInt(b.errortype,10)==2?f.dia.getDomList().member.style.display="none":f.dia.getDomList().cancel.style.display="none"}});
STK.register("lib.dialog.ioError",function(a){var b=a.lib.kit.extra.language,c,d;return function(d,e,f){var g={},h,i,j=function(){},k={init:function(){k.data()},data:function(){i=a.parseParam({auto:!0,call:j,ok:j,cancel:j,beside:null},f);h=a.parseParam({location:"",title:b("#L{}"),OKText:b("#L{ }"),cancelText:b("#L{ }"),suda:""},e.data);h.msg=e.msg||b("#L{}");h.OK=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.ok||{};window.SUDA&&SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.ok();h.location&&(window.location.href=h.location)};h.cancel=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.cancel||{};window.SUDA&&SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.cancel()}},run:function(){var a=l[e.code]||l[100001];return a()||i.call(h,e)},destroy:function(){c&&c.destroy()}},l={100001:function(){i.beside?a.ui.tipAlert(h.msg,a.core.json.merge(h,{autoHide:!1,icon:"warnS"})).beside(i.beside):a.ui.alert(h.msg.split("\\n"),a.core.json.merge(h,{icon:"warnB"}))},100002:function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})},100003:function(){i.beside?a.ui.tipConfirm(h.msg,h).beside(i.beside):a.ui.confirm(h.msg.split("\n"),h)},100004:function(){c||(c=a.lib.dialog.authentication());c.show()},100005:function(){h.type=e.data&&(e.data.type?e.data.type:"follow");h.errortype=e.data&&(e.data.errortype||"1");return a.lib.dialog.memberDialog(h||{})},100008:function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})}};k.init();g.getdata=function(){return h};g.getAction=function(a){return a?l[a]:l};g.getCode=function(){return e.code||""};g.run=k.run;i.auto&&k.run();return g}});
STK.register("lib.kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b.args;e.__rnd&&delete e.__rnd;(new Image).src="http://weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d;(new Image).src="http://s1.sinaedge.com/whb.gif?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d={},e=[],f=null,g=!1,h=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},c);h.onComplete=function(a){g=!1;c.onComplete(a,h.args);setTimeout(i,0)};h.onFail=function(a){g=!1;if(typeof c.onFail=="function")try{c.onFail(a,h.args)}catch(d){}setTimeout(i,0);try{b(h)}catch(d){}};h.onTimeout=function(a){try{b(h);c.onTimeout(a)}catch(d){}};var i=function(){if(!!e.length){if(g===!0)return;g=!0;h.args=e.shift();if(h.method.toLowerCase()=="post"){var b=a.core.util.URL(h.url);b.setParam("__rnd",+(new Date));h.url=b.toString()}f=a.ajax(h)}},j=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d.request=function(a){a||(a={});c.noQueue&&j();if(!c.uniqueRequest||!f){e.push(a);a._t=0;i()}};d.abort=j;return d}});
STK.register("lib.kit.io.jsonp",function(a){return function(b){var c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b),d=[],e={},f=!1,g=function(){if(!!d.length){if(f===!0)return;f=!0;e.args=d.shift();e.onComplete=function(a){f=!1;c.onComplete(a,e.args);setTimeout(g,0)};e.onFail=function(a){f=!1;c.onFail(a);setTimeout(g,0)};a.jsonp(a.core.json.merge(c,{args:e.args,onComplete:function(a){e.onComplete(a)},onFail:function(a){try{e.onFail(a)}catch(b){}}}))}},h={};h.request=function(a){a||(a={});d.push(a);a._t=1;g()};h.abort=function(a){while(d.length)d.shift();f=!1;e=null};return h}});
STK.register("lib.kit.io.ijax",function(a){return function(b){var c=a.parseParam({url:"",timeout:3e4,isEncode:!0,abaurl:null,responseName:null,varkey:"callback",abakey:"callback"},b),d=[],e=null,f=!1;c.onComplete=function(a,d){f=!1;b.onComplete(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};c.onFail=function(a,d){f=!1;b.onFail(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};var g=function(){var b;if(!!d.length){if(f===!0)return;f=!0;b=d.shift();c.args=b.args;c.form=b.form;e=a.ijax(c)}},h=function(a){while(d.length)d.shift();f=!1;if(e)try{e.abort()}catch(b){}e=null},i={};i.request=function(c,e){if(!a.isNode(c))throw"[lib.kit.io.ijax.request] need a form as first parameter";e||(e={});b.noQueue&&h();d.push({form:c,args:e});g()};i.abort=h;return i}});
STK.register("lib.kit.io.inter",function(a){var b=a.core.json.merge;return function(){var c={},d={},e={},f=function(a,b){return function(c,d){try{b.onComplete(c,d)}catch(f){}try{c.code==="100000"?b.onSuccess(c,d):b.onError(c,d)}catch(f){}for(var g in e[a])try{e[a][g](c,d)}catch(f){}}},g=function(a,b,c){return function(d){try{b.onComplete(d,c)}catch(f){}try{d.code==="100000"?b.onSuccess(d,c):b.onError(d,c)}catch(f){}for(var g in e[a])try{e[a][g](d,c)}catch(f){}}};c.register=function(a,b){if(typeof d[a]!="undefined")throw a+" registered";b.url&&(b.url+=b.url.indexOf("?")>=0?"&ajwvr=6":"?ajwvr=6");d[a]=b;e[a]={}};c.addHook=function(b,c){var d=a.core.util.getUniqueKey();e[b][d]=c;return d};c.rmHook=function(a,b){e[a]&&e[a][b]&&delete e[a][b]};c.getTrans=function(c,e){var g=b(d[c],e);g.onComplete=f(c,e);var h=d[c].requestMode,i="ajax";if(h==="jsonp"||h==="ijax")i=h;return a.lib.kit.io[i](g)};c.request=function(c,e,f){var h=b(d[c],e);h.onComplete=g(c,e,f);h=a.core.obj.cut(h,["noqueue"]);h.args=f;var i=d[c].requestMode;return i==="jsonp"?a.jsonp(h):i==="ijax"?a.ijax(h):a.ajax(h)};return c}});
STK.register("conf.trans.feed.feed",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.domain?"?domain="+$CONFIG.domain:"",e=$CONFIG.interactiveUrl,f=$CONFIG.loadingUrl;c("publish",{url:e+"?fajtype=mblog_add",method:"post"});c("delete",{url:e+"?fajtype=mblog_del",method:"post"});c("forward",{url:e+"?fajtype=mblog_forward",method:"post"});c("getfeed",{url:f+"?fajtype=mbloglist",method:"get"});c("mediaShow",{url:"http://api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("widget",{url:e+"?fajtype=mblog_showinfo",method:"post"});c("third_rend",{url:e+"?fajtype=mblog_renderfeed",method:"post"});return b});
STK.register("lib.kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("lib.feed.inter",function(a){var b=window.$CONFIG||{},c=a.core.json.merge,d=function(b){var c=a.C("div");c.innerHTML=b;window.WBEXP&&window.WBEXP.start(c);c=null};return function(b,e){if(!b)a.log("inter : need object of the baseFeedList Class");else{var f=b.getNode(),g=a.conf.trans.feed.feed,h=a.core.obj.parseParam({loadFeedTransKey:"getfeed",plNode:null},e);a.custEvent.define(b,"inter");var i={request:function(){var a=arguments,e;if(a.length<3)throw new Error("[comp.content.homeFeed]:bindCustEvt()-custom event 'success' should supply enough arguments.");e=a[1];var f=a[2]||{},i={};switch(e){case"lazyload":var j=c(i,{pre_page:b.getCurrentPage(),page:b.getCurrentPage(),max_id:b.getLastFeedId(),end_id:b.getEndId(),max_msign:b.getLastFeedAttr("msign"),filtered_min_id:b.getLastFeedAttr("filtered_min_id")});g.request(h.loadFeedTransKey,{onSuccess:function(a){b.updateFeed(a.data,"bottom","lazyload");d(a.data)},onFail:function(a){b.showError("bottom","lazyload")},onError:function(a){b.showError("bottom","lazyload")}},c(j,f));break;case"newFeed":var j=c(i,{since_id:b.getEndId()});g.request(h.loadFeedTransKey,{onSuccess:function(a){b.updateFeed(a.data,"top","newFeed");d(a.data)},onFail:function(a){b.showError("top","newFeed")},onError:function(a){b.showError("top","newFeed")}},c(j,f))}}},j=function(){a.custEvent.add(b,"request",i.request)};j();return{destroy:function(){}}}}});
STK.register("lib.feed.base",function(a){return function(b,c){a.isNode(b)||a.log("feed.base : parameter node is not a document node!");var d={},c=c||{},e=a.lib.feed.API(b,c);for(var f in e)!d[f]&&(d[f]=e[f]);var g=a.lib.feed.inter(d,c),h=function(){e.destroy&&e.destroy();g.destroy&&g.destroy()};d.destroy=h;return d}});
STK.register("conf.trans.feed.comment",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("smallList",{url:d+"?fajtype=small_comment",method:"get"});c("add",{url:d+"?fajtype=add_comment",method:"post"});c("delete",{url:d+"?fajtype=del_comment",method:"post"});c("privateNoMore",{url:d+"?fajtype=bubble_close",method:"get"});c("cfilter",{url:d+"?fajtype=small_comment",method:"get"});c("isComment",{url:d+"?fajtype=comment_privacy",method:"get"});c("dialogue",{url:d+"?fajtype=comment_conversation",method:"get"});return b});
STK.register("lib.kit.extra.getDiss",function(a){return function(){var b={},c=0,d={location:$CONFIG.location};arguments[0]&&!a.core.dom.isNode(arguments[0])&&(b=arguments[c++]);b=a.lib.kit.extra.merge(b,d);if(!arguments[c])return b;b=a.lib.kit.extra.merge(b,a.core.json.queryToJson(a.lib.kit.dom.parentAttr(arguments[c++],"diss-data",arguments[c])||""));return b}});
STK.register("lib.kit.extra.setPlainHash",function(a){return function(b){try{var c=window.$CONFIG;c&&c.bigpipe==="true"&&a.historyM?a.historyM.setPlainHash(b):window.location.hash=b}catch(d){}}});
STK.register("lib.kit.extra.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"lib.kit.extra.listener.define: ";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"lib.kit.extra.listener.define: ";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: ";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("conf.channel.feed",function(a){var b=["forward","publish","comment","delete","refresh","reply","feedTagUpdate","feedTagMoreUpdate","qfaceAdd","qfaceCount","timeFeedPublish"];return a.lib.kit.extra.listener.define("conf.channel.feed",b)});
STK.register("conf.trans.validateCode",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("checkValidate",{url:"/aj/pincode/verified?_wv=5",method:"post"});return b});
STK.register("lib.dialog.validateCode",function(a){var b=window.$LANG,c=a.lib.kit.extra.language,d="/aj/pincode/pin?_wv=5&type=rule&lang="+$CONFIG.lang+"&ts=",e={dialog_html:'<div class="layer_veriyfycode"><div class="v_image"><img height="50" width="450" class="yzm_img" /></div><p class="v_chng"><a href="#" onclick="return false;" class="yzm_change" action-type="yzm_change">#L{}</a></p><p class="v_ans_t">#L{}</p><p class="v_ans_i"><input type="text" class="W_inputStp v_inp yzm_input ontext" action-type="yzm_input"/><div class="M_notice_del yzm_error" style="display:none;"><span class="icon_del"></span><span class="txt"></span></div></p><p class="v_btn"><a class="W_btn_a yzm_submit" href="#" action-type="yzm_submit"><span>#L{}</span></a><a class="W_btn_b yzm_cancel" href="#" action-type="yzm_cancel" action-data="value=frombtn"><span>#L{}</span></a></p></div>'},f;return function(){if(f)return f;var b={},g={},h,i,j,k,l=function(){g.yzm_error.innerHTML="";g.yzm_error.parentNode.style.display="none"},m=function(a){g.yzm_error.innerHTML=a;g.yzm_error.parentNode.style.display=""},n=function(){a.lib.kit.io.cssLoader("style/css/module/layer/layer_verifycode.css","js_style_css_module_layer_layer_verifycode",function(){h||o();l();h.setTop();h.show();t.changesrc();h.setMiddle();g.input_text.value="";a.hotKey.add(document.documentElement,["esc"],t.closeDialog,{type:"keyup",disableInInput:!0})})},o=function(){h=a.ui.dialog({isHold:!0});h.setTitle(c("#L{}"));h.setContent(c(e.dialog_html));var b=h.getBox();s(b);u()},p=function(b){a.conf.trans.validateCode.request("checkValidate",{onError:function(){m(c("#L{}"));t.changesrc();j=!1;g.input_text.value=""},onFail:function(){m(c("#L{}"));t.changesrc();g.input_text.value="";j=!1},onSuccess:function(b,c){var d=b.data.retcode;l();g.input_text.value="";h.hide();var e=i.requestAjax,f=a.lib.kit.extra.merge(i.param,{retcode:d});e.request(f);j=!1}},b)},q=function(){},r=function(){},s=function(b){g.vImg=a.core.dom.sizzle("img.yzm_img",b)[0];g.yzm_change=a.core.dom.sizzle("a.yzm_change",b)[0];g.yzm_submit=a.core.dom.sizzle("a.yzm_submit",b)[0];g.yzm_cancel=a.core.dom.sizzle("a.yzm_cancel",b)[0];g.input_text=a.core.dom.sizzle("input.yzm_input",b)[0];g.yzm_error=a.core.dom.sizzle("div.yzm_error span.txt",b)[0];g.close_icon=h.getDomList().close},t={enter:function(){a.fireEvent(g.yzm_submit,"click")},changesrc:function(){var b=d+a.getUniqueKey();g.vImg.setAttribute("src",b);try{g.yzm_change.blur()}catch(c){}},checkValidateCode:function(){l();var b=a.core.str.trim(g.input_text.value);if(!b)m(c("#L{}"));else if(!j){j=!0;p({secode:b,type:"rule"})}try{g.yzm_submit.blur()}catch(d){}},closeDialog:function(b){typeof b=="object"&&b.el&&h.hide();typeof i=="object"&&i.onRelease&&typeof i.onRelease=="function"&&i.onRelease();a.hotKey.remove(document.documentElement,["esc"],t.closeDialog,{type:"keyup"});try{a.preventDefault()}catch(c){}},onFocus:function(b){b=a.core.evt.getEvent();var c=b.target||b.srcElement,d=c.value;d||l()}},u=function(){var b=h.getBox();k=a.core.evt.delegatedEvent(b);k.add("yzm_change","click",function(){t.changesrc();a.preventDefault()});k.add("yzm_submit","click",function(){t.checkValidateCode();a.preventDefault()});k.add("yzm_cancel","click",t.closeDialog);a.core.evt.addEvent(g.close_icon,"click",t.closeDialog);a.core.evt.addEvent(g.input_text,"focus",t.onFocus);a.core.evt.addEvent(g.input_text,"blur",t.onFocus);a.hotKey.add(g.input_text,["enter"],t.enter,{type:"keyup"})},v=function(){if(h){k.destroy();a.core.evt.removeEvent(g.close_icon,"click",t.closeDialog);a.core.evt.removeEvent(g.input_text,"focus",t.onFocus);a.core.evt.removeEvent(g.input_text,"blur",t.onFocus);h&&h.destroy&&h.destroy()}h=f=null},w=function(a,b,c){if(a.code=="100027"){i=c;n()}else if(a.code==="100000")try{var d=c.onSuccess;d&&d(a,b)}catch(e){}else try{var d=c.onError;d&&d(a,b)}catch(e){}};r();r=null;b.destroy=v;b.validateIntercept=w;b.addUnloadEvent=function(){h&&a.core.evt.addEvent(window,"unload",v)};f=b;return b}});
STK.register("lib.kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("conf.trans.comment",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("smallList",{url:d+"?fajtype=small_comment",method:"get"});c("add",{url:d+"?fajtype=add_comment",method:"post"});c("delete",{url:d+"?fajtype=del_comment",method:"post"});c("privateNoMore",{url:d+"?fajtype=bubble_close",method:"get"});c("cfilter",{url:d+"?fajtype=small_comment",method:"get"});c("isComment",{url:d+"?fajtype=comment_privacy",method:"get"});c("dialogue",{url:d+"?fajtype=comment_conversation",method:"get"});return b});
STK.register("lib.dialog.commentPrivateSetting",function(a){var b=1,c=0,d={},e,f,g=0,h,i={},j=0,k=0,l=a.lib.kit.extra.language,m=function(){var d=a.getUniqueKey,f=a.core.util.easyTemplate,g=a.lib.kit.dom.parseDOM,i={id1:"key"+d(),id2:"key"+d(),id3:"key"+d(),showType:b,set:c},j='<#et privateSetting data><div class="detail layer_setup_privacy" node-type="content"><div class="W_tips tips_warn clearfix"><p class="icon"><span class="icon_warnS"></span></p><p class="txt">#L{}</p></div><p class="privacy_title">#L{}</p><ul class="privacy_repliable">\t<li><label for="${data.id1}"><input type="radio" class="W_radio" value="0" name="comment" id="${data.id1}" action-type="choose" <#if (data.showType == 1)>checked="checked"</#if><#if (data.showType==2 && data.set==0)>checked="checked"</#if>/>&nbsp;#L{}<span class="S_txt2">#L{}</span></label></li>  <li><label for="${data.id2}"><input type="radio" class="W_radio" value="2" name="comment" id="${data.id2}" action-type="choose" <#if (data.showType==2 && data.set==2)>checked="checked"</#if>/>&nbsp;#L{}<span class="S_txt2">#L{}</span></label></li>  <li><label for="${data.id3}"><input type="radio" class="W_radio" value="1" name="comment" id="${data.id3}" action-type="choose" <#if (data.showType==2 && data.set==1)>checked="checked"</#if>/>&nbsp;#L{}</label></li></ul><div class="btn"><a href="javascript:void(0)" class="W_btn_d" action-type="OK" node-type="OK" style="visibility:hidden;"><span>#L{}</span></a><#if (data.showType==1)><a href="javascript:void(0)" class="W_btn_b" action-type="cancel" node-type="noMore"><span>#L{}</span></a></#if><#if (data.showType==2)><a href="javascript:void(0)" class="W_btn_b" action-type="hide" node-type="hide"><span>#L{}</span></a></#if></div></div></#et>';e=a.ui.dialog();e.setTitle(l("#L{}"));e.setContent(f(l(j),i).toString());h=g(a.builder(e.getOuter()).list)},n={chooseItem:function(d){g=d.el.value;b==1?a.setStyle(h.OK,"visibility",g==0?"hidden":"visible"):a.setStyle(h.OK,"visibility",g==c?"hidden":"visible")},save:function(b){g=parseInt(g,10);if(g>-1){if(j)return;j=1;a.conf.trans.comment.request("privateSetting",{onSuccess:o.saveSuccess,onError:o.saveError},{comment:g})}return a.preventDefault(b.evt)},cancel:function(b){if(!k){k=1;s();e.hide();a.conf.trans.comment.request("privateNoMore",{onSuccess:o.noMoreSuccess,onError:o.noMoreError},{bubbletype:5,time:604800});return a.preventDefault(b.evt)}},hide:function(b){s();e.hide();return a.preventDefault(b.evt)}},o={getSetErr:function(){a.ui.alert(l("#L{}"))},getAlert:function(b,c,d){var f=a.ui.tip({showCallback:function(){setTimeout(function(){f&&f.anihide()},500)},hideCallback:function(){f&&f.destroy();b?setTimeout(function(){d&&d();s();e.hide()},200):d&&d()},msg:c,type:b?undefined:"del"});return f},saveSuccess:function(b,c){e.hide();a.ui.tip("lite",{msg:l("#L{}"),type:"succM",timer:"1000",hideCallback:function(){window.location.reload()}})},saveError:function(){var a=o.getAlert(!1,l("#L{}"),function(){j=0});a.setLayerXY(h.OK);a.aniShow()},noMoreSuccess:function(){k=0},noMoreError:function(b){k=0;a.lib.dialog.ioError(b.code,b)}},p=function(){g=0;k=0;f=a.delegatedEvent(h.content);f.add("choose","click",n.chooseItem);f.add("OK","click",n.save);f.add("cancel","click",n.cancel);f.add("hide","click",n.hide)},q=function(){},r=function(a){if(a){a.data&&a.data.set&&(c=a.data.set);b=!c?1:2}q();m();p();e.show();e.setMiddle()},s=function(){f&&f.destroy()};d.show=r;return d});
STK.register("lib.comment.inter",function(a){var b=null,c=function(){},d=a.ui.alert,e,f=a.lib.dialog.commentPrivateSetting,g=a.lib.kit.extra.language,h=function(b,c){if(b&&b.code){b.code!="100000"&&b.code!="100005"&&a.lib.dialog.ioError(b.code,b);c(b)}};return function(f,i){e=a.lib.dialog.validateCode();var j={},k=0,l=a.conf.trans.feed.comment;f=a.parseParam({delete_success:c,delete_fail:c,delete_error:c,add_success:c,add_fail:c,add_error:c,smallList_success:c,smallList_fail:c,smallList_error:c},f||{});j.conf=a.parseParam({act:b,mid:b,cid:b,uid:$CONFIG.uid,page:b,forward:b,isroot:b,content:b,type:b,is_block:b,appkey:b},i);j.merge=function(b){b=a.lib.kit.extra.merge(j.conf,b);return a.core.obj.clear(b)};j.request=function(b,c){if(!k){k=1;var i=j.merge(c),m=l.getTrans(b,{onComplete:function(c,j){if(b=="add"){var l={onSuccess:function(a,c){h(a,function(a){f[b+(a.code=="100000"?"_success":"_fail")](a,i)})},onError:function(c,e){f[b+"_error"](c,i);c.code=="100005"?d(g("#L{}"),{textSmall:g("#L{}")+'<a href="http://account.weibo.com/settings/mobile" target="_blank">'+g("#L{}")+"</a>"}):a.lib.dialog.ioError(c.code,c)},param:i,requestAjax:m};e.validateIntercept(c,j,l)}else h(c,function(c){if(c.code=="100000")f[b+"_success"](c,i);else{var d=f[b+"_fail"];typeof d=="function"?f[b+"_fail"](c,i):f[b+"_success"](c,i);a.ui.ioError(c.code,c)}});k=0},onFail:function(b){k=0;a.lib.dialog.ioError(b.code,b)}});m.request(i)}};j.load=function(a){j.request("smallList",a)};j.del=function(a){j.request("delete",a)};j.post=function(a){a.location=$CONFIG.location;a.pdetail=$CONFIG.page_id;j.request("add",a)};e.addUnloadEvent();return j}});
STK.register("conf.channel.at",function(a){var b=["open","close"];return a.lib.kit.extra.listener.define("conf.channel.at",b)});
STK.register("lib.kit.dom.autoHeightTextArea",function(a){var b=a.core.util.browser.MOZ,c=a.core.util.browser.IE6||a.core.util.browser.IE7||a.core.util.browser.IE8,d=function(d){var e=a.core.dom.getStyle,f;d.defaultHeight||(d.defaultHeight=parseInt(e(d,"height"),10)||parseInt(d.offsetHeight,10)||20);if(c){var g=parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10);f=Math.max(d.scrollHeight-g,d.defaultHeight)}else{var g=b?0:parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10),h=a.E("_____textarea_____");if(!h){h=a.C("textarea");h.id="_____textarea_____";document.body.appendChild(h)}if(h.currentTarget!=d){var i=[];i.push("width:"+e(d,"width"));i.push("font-size:"+e(d,"fontSize"));i.push("font-family:"+e(d,"fontFamily"));i.push("line-height:"+e(d,"lineHeight"));i.push("padding-left:"+e(d,"paddingLeft"));i.push("padding-right:"+e(d,"paddingRight"));i.push("padding-top:"+e(d,"paddingTop"));i.push("padding-bottom:"+e(d,"paddingBottom"));i.push("top:-1000px");i.push("height:0px");i.push("position:absolute");i.push("overflow:hidden");i.push("");i=i.join(";");h.style.cssText=i}h.value=d.value;f=Math.max(h.scrollHeight-g,d.defaultHeight);h.currentTarget=d}return f};return function(b){function j(b){var c=a.core.dom.getStyle,d,e=[];e.push("width:"+c(b,"width"));e.push("font-size:"+c(b,"fontSize"));e.push("font-family:"+c(b,"fontFamily"));e.push("line-height:"+c(b,"lineHeight"));e.push("padding-left:"+c(b,"paddingLeft"));e.push("padding-right:"+c(b,"paddingRight"));e.push("padding-top:"+c(b,"paddingTop"));e.push("padding-bottom:"+c(b,"paddingBottom"));e.push("top:-1000px");e.push("height:0px");e.push("position:absolute");e.push("overflow:hidden");e.push("");e=e.join(";");return e}var c=b.textArea,e=b.maxHeight,f=b.inputListener,g=c.style,h;(h=function(){typeof f=="function"&&f();setTimeout(function(){var a=d(c),b;e=e||a;var f=a>e;b=f?e:a;g.overflowY=f?"auto":"hidden";g.height=Math.min(e,a)+"px"},0)})();if(!a.core.util.browser.IE)try{a.conf.channel.at.register("open",function(){a.E("_____textarea_____").style.cssText=j(c)})}catch(i){a.log(i)}if(!c.binded){a.addEvent(c,"keyup",h);a.addEvent(c,"focus",h);a.addEvent(c,"blur",h);c.binded=!0;c.style.overflow="hidden"}}});
STK.register("lib.editor.plugin.count",function(a){function e(a,b){if(!a.textEl)throw"[editor plugin count]: plz check nodeList"}function d(a,b){var d=c(a),e=Math.abs(b-d),f;d>b||d<1?f={wordsnum:d,vnum:e,overflow:!0}:d==0?f={wordsnum:d,vnum:e,overflow:!0}:f={wordsnum:d,vnum:e,overflow:!1};return f}function c(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList,g,h=c.opts,i=a.lib.kit.extra.language;b=h.limitNum;e(f);a.core.evt.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl,k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value,e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);b.length>=0&&j.focus?f.overflow&&f.wordsnum!=0?k.innerHTML=(e?i(e):"")+i("#L{%s}",'<span class="S_error">'+f.vnum+"</span>"):k.innerHTML=(e?i(e):"")+i("#L{%s}","<span>"+f.vnum+"</span>"):b.length===0&&(k.innerHTML=(e?i(e):"")+i("#L{%s}","<span>"+f.vnum+"</span>"));a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("conf.trans.at",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("followList",{url:d+"?fajtype=mblog_attention",method:"post"});c("topicList",{url:d+"?fajtype=mblog_topic",method:"post"});return b});
STK.register("lib.kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"lib.kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("lib.kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStartIE=e.text.length-d.text.length;a.selectionEndIE=a.selectionStartIE+d.text.length;b=a.selectionStartIE}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange&&a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("lib.kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("lib.kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("lib.editor.at",function(a){var b=a.lib.kit.dom.cssText,c=a.lib.kit.dom.isTurnoff,d=a.lib.kit.extra.textareaUtils,e=window,f=document,g=a.core.util.browser,h="",i=d.selectionStart,j,k,l,m,n,o=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',h,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',h,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),p=function(){var c=[],d=j.textEl.style.cssText,e;a.foreach(["margin","padding","border"],function(b){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;b!="border"?e=c.push(b,"-",d.toLowerCase(),":",a.getStyle(j.textEl,b+d),";"):a.foreach(["Style","Width"],function(e){c.push(b,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(j.textEl,[b,d,e].join("")),";")})})});c.push("font-size:"+a.getStyle(j.textEl,"fontSize")+";");return b([d,c.join(""),h,"\n\t\tword-wrap: break-word;\n\t\tline-height: 18px;\n\t\toverflow-y:auto;\n\t\toverflow-x:hidden;\n\t\toutline:none;\n\t"].join("")).getCss()},q=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,c=b.wrap[0],d=b.flag[0],e=b.after[0],h=b.before[0],i=0,k,l,m,q=function(a){return g.MOZ?-2:g.MOBILE&&g.SAFARI&&(g.IPAD||g.ITOUCH||g.IPHONE)?-2:0};return{bind:function(){if(l!==j.textEl){n=a.position(j.textEl);var b=["left:",n.l,"px;top:",n.t+20,"px;"].join("");l=j.textEl;var d=p();l.style.cssText=d;m=[b,d,"\n\t\t\t\tposition:absolute;\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0;\n\t\t\t\tz-index:-1000;\n\t\t\t"].join("");c.style.cssText=m;if(!i){i=1;f.body.appendChild(c)}}},content:function(b,f,g,i){c.style.cssText=[m,"\n\t\t\t\twidth:",(parseInt(a.getStyle(l,"width"))||l.offsetWidth)+q(),"px;\n\t\t\t\theight:",parseInt(a.getStyle(l,"height"))||l.offsetHeight,"px;\n\t\t\t\toverflow-x:hidden;\n\t\t\t\toverflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(l,"overflowY"),";\n\t\t\t"].join("");h.innerHTML=o(b);d.innerHTML=o(f)||"&thinsp;";e.innerHTML=o([g,i].join(""));clearTimeout(k);k=setTimeout(function(){var b=a.position(d);a.custEvent.fire(j.eId,"at",{t:b.t-l.scrollTop-n.t,l:b.l-n.l,fl:b.l,key:g,flag:f,textarea:j.textEl})},30)},hide:function(){c.style.display="none"},show:function(){c.style.display=""}}}(),r=function(){if(c(j.textEl))clearInterval(k);else{var b=j.textEl.value.replace(/\r/g,""),d=i(j.textEl);if(d<0||d==m)return;m=d;var e=b.slice(0,d),f=e.match(new RegExp(["(",j.flag,")([a-zA-Z0-9-_-]{0,20})$"].join("")));if(!f){a.custEvent.fire(j.eId,"hidden");return}var g=b.slice(d);e=e.slice(0,-f[0].length);q.content(e,f[1],f[2],g)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!j){clearInterval(k);a.removeEvent(j.textEl,"blur",c);q.hide()}},d=function(){c();j=b;m=null;q.bind();q.show();k=setInterval(r,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("lib.editor.plugin.at",function(a){var b=a.lib.kit.extra.language,c='<div style="" class="layer_menu_list"><ul node-type="suggestWrap"></ul></div>',d={"@":{normalTitle:b("#L{}"),moreTitle:b("#L{@}"),noTilte:b("#L{}")},"#":{normalTitle:b("#L{}")}},e={"@":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.screen_name}" value="${list.screen_name}"><a href="#">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'},f,g,h,i,j,k,l=!1,m,n,o={"@":"followList","#":"topicList"},p=0,q=function(){setTimeout(function(){a.custEvent.fire(f,"close")},200)},r=function(){j.style.display="none"},s=function(){a.custEvent.add(f,"onIndexChange",function(a,b){y(b)});a.custEvent.add(f,"onSelect",function(b,c,d,e){p=0;a.core.evt.stopEvent();var g=n[c].getAttribute("value")+"";g=g.replace(/\(.*\)/,"");try{d.focus()}catch(h){}var i=a.lib.kit.extra.textareaUtils;i.replaceText(d,"");var j=i.selectionStart(d)*1,k=new RegExp(e+"([a-zA-Z0-9-_-]{0,20})$"),l=d.value.replace(/\r+/g,"").slice(0,j).match(k),m=d.value.slice(j,j+1);l=l&&l[1]?l[1].length:0;e=="#"?typeof m!="undefined"&&m!=e&&(g=g+e+" "):g=g+" ";i.insertText(d,g,j,l);var o=i.getCursorPos(d);if(e=="#"&&m==e){i.setCursor(d,o+1);i.insertText(d," ",o+1,0)}o=i.getCursorPos(d);var q=i.getSelectedText(d),r=q==""||q==null?0:q.length;d.setAttribute("range",o+"&"+r);a.custEvent.fire(f,"close")});a.addEvent(h.textEl,"blur",q);a.custEvent.add(f,"onClose",r);a.custEvent.add(f,"onOpen",function(b,c){i.style.display="";j.style.display="";l=!0;setTimeout(function(){a.custEvent.fire(f,"indexChange",0)},100)})},t=function(b){a.custEvent.remove(b);a.removeEvent(h.textEl,"blur",q)},u=function(b,c,f){b=="@"?c.data&&c.data.length>0?c.title=f==""?d[b].moreTitle:d[b].normalTitle:c.title=d[b].noTilte:c.title=d[b].normalTitle;var g=a.core.util.easyTemplate(e[b],c);return g},v=function(){a.core.evt.custEvent.add(g,"hidden",function(b,c){a.custEvent.fire(f,"close")});a.core.evt.custEvent.add(g,"at",function(b,c){k=c.key;var d=c.flag;if(k.length==0&&d!="@"&&d!="#"||c.textarea&&!c.textarea.value)a.custEvent.fire(f,"close");else var e=a.conf.trans.at.request(o[d],{onSuccess:function(b,e){var g=u(d,b,k);a.custEvent.fire(f,"openSetFlag",d);a.custEvent.fire(f,"open",c.textarea);var h=a.core.dom.builder(g),l=h.box;i.innerHTML=l;j.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");var m=c.l;document.body.clientWidth<c.fl+a.core.dom.getSize(j).width&&c.fl>a.core.dom.getSize(j).width&&(m=c.l-a.core.dom.getSize(j).width);var n=0;a.winSize().height-c.textarea.getBoundingClientRect().bottom<300?n=-i.offsetHeight-4:n=c.t;a.lib.kit.dom.layoutPos(j,c.textarea,{pos:"left-top",offsetX:m,offsetY:n})},onError:function(){a.custEvent.fire(f,"close")}},{q:k})})},w=function(){m=h.textEl;g=a.lib.editor.at({textEl:m,flag:"@|#"})},x=function(b){p=0;j&&(j.style.display="none");j&&(j.innerHTML="");a.removeNode(j);j=STK.C("div");document.body.appendChild(j);if(j.innerHTML.length==0){j.innerHTML=c;i=a.core.dom.sizzle('[node-type="suggestWrap"]',j)[0];j.style.display="none"}if(f){a.custEvent.fire(f,"close");t(f)}f=a.ui.mod.suggest({textNode:b,uiNode:i,actionType:"item",actionData:"value",flag:"@"});s()},y=function(b){n=a.sizzle("li[class!=suggest_title]",i);n&&n[0]&&a.core.dom.removeClassName(n[p],"cur");a.core.dom.addClassName(n[b],"cur");p=b};return function(a,b){h=a.nodeList;var c={};c.init=function(){w();x(h.textEl);v()};return c}});
STK.register("lib.editor.plugin.sucTip",function(a){return function(b,c){var d=b.nodeList,e={},f=function(c){var c=c||{},e=a.core.obj.parseParam({className:"send_succpic",innerHTML:"",delay:2},c);d.successTip.className=e.className;d.successTip.innerHTML=e.innerHTML;a.core.evt.custEvent.fire(b,"setSucTipDelay",e.delay)},g=function(a){if(!a||!a.getTime)a=new Date;var b={year:a.getFullYear(),mouth:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds()};return b},h={theEnd:function(a,b){var c=g(b.time);if(c.year==2012&&c.mouth==12&&c.date==21&&c.hours>=10){var d=!1;c.seconds%5==0&&(d=!0);b.text.indexOf("")!=-1&&(d=!0);b.text.indexOf("")!=-1&&(d=!0);b.text.indexOf("")!=-1&&(d=!0);d?f({className:"send_success_over2",innerHTML:'<a target="_blank" href="http://huati.weibo.com/z/2013/"></a>',delay:3}):f()}else c.year==2012&&c.mouth==12&&c.date==22&&c.hours<=14?f({className:"send_success_over1",innerHTML:'<a target="_blank" href="http://huati.weibo.com/z/2013/"></a>',delay:3}):f({})}},i=function(){a.core.evt.custEvent.define(b,"theEnd");a.core.evt.custEvent.add(b,"theEnd",h.theEnd)},j=function(){i()};e.init=j;return e}});
STK.register("conf.trans.publisher",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=window.$CONFIG||{},e=d.domain?"?domain="+d.domain:"";c("publish",{url:"/aj/mblog/add"+e,method:"post"});c("publishPro",{url:"/aj/mblog/add?_wv=5",method:"post"});c("interactive",{url:"/aj/mblog/interactive?_wv=5",method:"post"});c("timingPublish",{url:"/aj/mblog/addtime?_wv=5",method:"post"});c("getpublish",{url:"/p/aj/v6/publish?_wv=5",method:"get"});c("reviewadd",{url:"/p/aj/review/add?_wv=5",method:"post"});c("follow",{url:"/aj/f/followed?_wv=5",method:"post"});c("proxy",{url:"/p/aj/proxy?_wv=5",method:"post"});return b});
STK.register("lib.publisher.source.formdata",function(a){return function(b){function g(){var c={},d=a.sizzle("[name]",b);for(var e in d){var f=d[e].getAttribute("name"),g=d[e].getAttribute("value");f&&g&&(c[f]=g)}return c}function f(c){var d=a.sizzle('[name="'+c+'"]',b);d[0]&&a.removeNode(d[0])}function e(c,d){var e=a.sizzle('[name="'+c+'"]',b);e[0]&&e[0].setAttribute("value",d)}function d(c){var d=a.sizzle('[name="'+c+'"]',b);return d[0]?d[0].getAttribute("value"):"ABSENT"}if(!b)return!1;var c={},b=b;c={get:d,set:e,del:f,read:g,node:b};return c}});
STK.register("lib.kit.extra.refreshpl",function(a){return function(b,c){function g(c,e){var g=f(b);if(!!g){var h=FM.getURL().path,i=a.queryToJson(FM.getURL().query);i.pids=g;var j=a.jsonToQuery(i),k="";if(d){i=i?i:"";k=h+"?"+j+"#_0";FM.setState(k,e)}else{k=h+"?"+i;window.location.href=k}}}function f(b){var c=[];a.foreach(a.sizzle(b),function(a,b){c.push(e(a))});return c[0]?c.join("|"):!1}function e(a){return!a||a==document.body?!1:a.id?a.id:e(a.parentNode)}var d=$CONFIG.bigpipe==="true";g(c||{})}});
STK.register("lib.editor.plugin.score",function(a){return function(b,c){if(!!(b&&b.nodeList&&b.nodeList.score)){var d={},e=b.nodeList.reviewadd,f=a.core.dom.getSize(e),g=b.nodeList.scorecontrol.style.width,h=a.delegatedEvent(b.nodeList.score),i=a.lib.publisher.source.formdata(b.nodeList.extradata),j=a.lib.kit.extra.language,k={1:j("#L{}"),2:j("#L{}"),3:j("#L{}"),4:j("#L{}"),5:j("#L{}")},l={reviewadd:function(c){var c=a.fixEvent(c),d=a.position(e);if(c.pageY>d.t&&c.pageY<d.t+f.height&&c.pageX>d.l&&c.pageX<d.l+f.width){var h=c.pageX-d.l,i=Math.floor(h/f.width*5+1);b.nodeList.scorecontrol.style.width=i*20+"%";b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=k[i])}else{b.nodeList.scorecontrol.style.width=g;b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=k[g.replace("%","")*5/100]||"")}},mouseout:function(a){b.nodeList.scorecontrol.style.width=g},add:function(c){var d=a.position(e),h=c.data,j=c.evt.pageX-d.l;h.score=Math.floor(j/f.width*5+1);a.conf.trans.publisher.getTrans("reviewadd",{onSuccess:function(c){g=h.score*20+"%";b.nodeList.scorecontrol.style.width=g;b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=c.data.score_title);i.set("score",h.score);c.data.prefixtext&&i.set("prefixtext",c.data.prefixtext);a.lib.kit.extra.refreshpl('[node-type="refreshafterscore"]')},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(){}}).request(h)}},m=function(){a.addEvent(document.body,"mousemove",l.reviewadd);h.add("reviewadd","click",l.add)},n=function(){m()};n();return d}}});
STK.register("conf.trans.face",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("face",{url:d+"?fajtype=mblog_face&type=face"});return b});
STK.register("lib.face.face",function(a){function f(b){if(d.length){b(d);return!0}a.conf.trans.face.request("face",{onSuccess:function(a,c){d=[];a.data.usual.norm&&d.push({name:e,map:a.data.usual.norm});for(var f in a.data.more)a.data.more.hasOwnProperty(f)&&d.push({name:f,map:a.data.more[f]});b(d)},onError:function(b,c){a.lib.dialog.ioError(b.code,b)}},{});return!1}var b=a.lib.kit.extra.language,c='<div class="W_layer W_layer_pop WB_outReset"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_faces"><div class="WB_minitab"><ul class="minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li></ul><ul class="W_fr minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_more S_line1" node-type="prev" action-type="prev"> <a href="javascript:void(0);" class="minitb_lk S_txt1"><i class="W_ficon ficon_arrow_left_lite S_ficon">j</i></a></li><li class="minitb_more S_line1" node-type="next" action-type="next"> <a href="javascript:void(0);" class="minitb_lk S_txt1"><i class="W_ficon ficon_arrow_right_lite S_ficon">i</i></a></li></ul></div><div class="faces_list_box"><div class="faces_list" node-type="scrollView"><ul node-type="list"></ul></div></div></div><div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',d=[],e=b("#L{}");return function(b,d){var e=a.ui.bubble(c,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});a.custEvent.define(e,"insert");var g=e.getDomList(!0).list,h=[].concat(e.getDomList(!0).tab),i,j=0,k=0;f(function(b){function c(){a.foreach(h,function(c,d){d=d+k;a.removeClassName(c,"current");if(b[d]){if(d===j){a.addClassName(c,"current");c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1 S_bg2" action-type="tab" action-data="index='+d+'">'+b[d].name+'</a><span class="cur_block"></span>'}else c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1" action-type="tab" action-data="index='+d+'">'+b[d].name+'</a><span class="cur_block"></span>';c.title=b[d].name}else{c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1"></a><span class="cur_block"></span>';c.title=""}c.offsetWidth});k<=0?a.addClassName(e.getDomList().prev,"W_btn_b_disable"):a.removeClassName(e.getDomList().prev,"W_btn_b_disable");k>=b.length-5?a.addClassName(e.getDomList().next,"W_btn_b_disable"):a.removeClassName(e.getDomList().next,"W_btn_b_disable")}e.on("tab","click",function(c){j=c.data.index|0;a.foreach(h,function(b,c){a.removeClassName(b,"current");a.removeClassName(b.firstChild,"S_bg2")});a.addClassName(c.el.parentNode,"current");a.addClassName(c.el,"S_bg2");var d="";a.foreach([].concat(b[j].map),function(a){d+='<li action-type="select" action-data="insert='+encodeURIComponent(a.phrase)+'" title="'+a.phrase.replace(/\[|\]/g,"")+'" ><img src="'+a.icon+'"/></li>'});g.innerHTML=d;g.offsetWidth;i||(i=a.ui.scrollView(e.getDomList(!0).scrollView));setTimeout(function(){i.reset();i.scrollTop(0)})});e.on("prev","click",function(a){k=Math.max(k-5,0);c()});e.on("next","click",function(a){k=Math.min(k+5,b.length-5);c()});e.on("select","click",function(a){e.trigger("insert",{value:decodeURIComponent(a.data.insert)}).hide()});e.on("hide",function(){if(i){i.destroy();i=null}});c();e.trigger(h[0].firstChild,"click",null)});e.getBub=function(){return e};d.refer?e.show().setArrow("top").setAlignPos(b,d.refer,d):e.show().beside(b,d);return e}});
STK.register("lib.publisher.widget.face",function(a){var b=a.lib.face.face;return function(c,d){var e={},f,g;d=a.core.json.merge({t:0,l:-15,refer:c.nodeList.textEl,useAlign:!0,arrowOffset:2},d||{});var h=function(a,b){var d=c.API.getCurrentLogType();c.API.addShortUrlLog(d);c.API.insertText(b.value);f.getBub().hide()},i=function(){a.core.evt.preventDefault();var g,i=a.fixEvent(a.getEvent()).target;g=i;f=b(g,d);a.custEvent.add(f,"insert",h);a.custEvent.define(c,"close");a.custEvent.add(c,"close",e.hide);a.custEvent.add(f,"hide",function(){a.custEvent.remove(f,"hide",arguments.callee);a.custEvent.remove(f,"insert",h);a.custEvent.remove(c,"close",e.hide)})};e.init=function(b,d,e){c=b;g=d;a.addEvent(b.nodeList[g],"click",i)};e.show=i;e.hide=function(){f&&f.getBub().hide()};e.destroy=function(){c=null};return e}});
STK.register("conf.trans.imageUploadBubble",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("cartoon",{url:"/aj/mblog/face?type=cartoon&_wv=5"});return b});
STK.register("lib.kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128)b+=String.fromCharCode(d);else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",b;typeof b=="undefined"&&(b=0);var e=0,f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;i<0&&(i=4294967296+i);return i}});
STK.register("lib.kit.extra.imageURL",function(a){return function(b,c){function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};if(typeof b=="string"){d=a.core.obj.parseParam(d,c);var e=d.size,g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690",thumb180:"&690",mw1024:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large",thumb180:"thumb180",mw690:"mw690",mw1024:"mw1024"}},h=b.charAt(9)=="w",i=b.charAt(21)=="g"?".gif":".jpg",j=h?a.lib.kit.extra.crc32(b)%4+1:f(b.substr(19,2))%16+1,k="http://"+(h?"ww":"ss")+j+".sinaimg.cn/"+(h?g.ww[e]:e)+"/"+b+(h?i:"")+(h?"":g.ss[e]);return k}}});
STK.register("conf.trans.watermark",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("waterMark",{url:"/aj/account/watermark?_wv=5"});return b});
STK.register("lib.image.watermark",function(a){var b={trans:null,conf:null,success:function(a,c){b.conf=a.data}},c=[];return function(d){if(typeof d=="function"){c.push(d);if(b.conf)for(var e=0;e<c.length;e++){c[e]&&c[e](b.conf);c[e]=null}else{b.trans||(b.trans=a.conf.trans.watermark.getTrans("waterMark",{onSuccess:function(){b.success.apply(null,arguments);for(var a=0;a<c.length;a++){c[a]&&c[a](b.conf);c[a]=null}},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(b){a.lib.dialog.ioError(b.code,b)}}));b.trans.abort();b.trans.request()}}}});
STK.register("lib.kit.extra.upload",function(a){var b=a.lib.kit.extra.language;return function(c){var d={},e=window.location.href,f;c=a.parseParam({type:"common",form:null,base64Str:"",imgName:"",uploadArgs:{}},c);a.custEvent.define(d,["uploadError","uploadSucc"]);var g={base64form:null,upload:function(b){var d,e=b,h="weibo.com/",i=window.$CONFIG,j=c.type;if(j==="common")d=c.form;else if(j==="base64"){d=a.C("form");g.base64form=d;d.method="POST";var k=a.C("input");k.name="b64_data";k.type="hidden";k.value=c.base64Str;d.appendChild(k);document.body.appendChild(d)}var l={marks:1,app:"miniblog",s:"rdxt"};c.type==="common"||c.type==="base64"?l=a.lib.kit.extra.merge({url:e.domain=="1"?h+(i&&i.watermark||i.domain):0,markpos:e.position||"",logo:e.logo||"",nick:e.nickname=="1"?"@"+(i&&i.nick):0},l):c.type==="custom"&&(l=a.lib.kit.extra.merge(c.uploadArgs,l));j==="base64"&&(l=a.lib.kit.extra.merge({mime:"image/jpeg",data:"base64"},l));f=a.core.io.ijax({url:"http://picupload.service.weibo.com/interface/pic_upload.php",form:d,abaurl:"http://"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",timeout:18e5,onComplete:g.handle,onTimeout:g.handle,args:l})},sendError:function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),f=window.$CONFIG,g=a.lib.kit.extra.merge(b,{ua:d,rnd:(new Date).getTime(),uid:f?f.uid:0,referer:encodeURIComponent(e)});g=a.core.json.jsonToQuery(g);g="http://ww1.sinaimg.cn/do_not_delete/fc.html?"+g;c.setAttribute("src",g)},handle:function(e){a.removeNode(g.base64form);g.base64form=null;var f=Math.abs(e.ret);if(!e||e.ret<0){var h="";switch(f){case 1:h="#L{}";break;case 4:case 9:h="#L{5MJPGGIFPNG}";break;default:h="#L{}"}e?g.sendError({ret:e.ret}):g.sendError({ret:"none"});a.custEvent.fire(d,"uploadError",{code:f,msg:b(h)})}else{var i=new Date,j=function(a){return a<10?"0"+a:a},k;if(c.type==="common")k=c.imgName;else if(c.type==="base64"){var l=[i.getFullYear(),j(i.getMonth()+1),j(i.getDate()),j(i.getHours()),j(i.getMinutes()),j(i.getSeconds())].join("");k=b("#L{}")+l+".jpg"}a.custEvent.fire(d,"uploadSucc",{pid:e.pid,imgName:k})}},init:function(){c.type==="common"||c.type==="base64"?a.lib.image.watermark(function(a){g.upload(a)}):g.upload()},destroy:function(){a.custEvent.undefine(d);a.removeNode(g.base64form)}};g.init();d.destroy=g.destroy;d.abort=function(){if(f)try{f.abort()}catch(a){}};return d}});
STK.register("lib.kit.extra.getFlashVersion",function(a){return function(){var a="1",b=navigator;if(b.plugins&&b.plugins.length){for(var c=0;c<b.plugins.length;c++)if(b.plugins[c]&&b.plugins[c].name&&b.plugins[c].name.indexOf("Shockwave Flash")!=-1){a=b.plugins[c].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var c=10;c>=2;c--)try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);if(d){a=c+".0";break}}catch(e){}return parseInt(a.split(".")[0])}});
STK.register("lib.kit.extra.installFlash",function(a){var b=a.lib.kit.extra.language;return function(c){c=a.parseParam({onHide:a.funcEmpty},c);var d='<div class="layer_version_upgrade"><dl class="point clearfix"><dt><span class="icon_versionup"></span></dt><dd><p class="S_txt1">#L{FlashFlash}</p></dd></dl><div class="versionup_btn"><a class="btn_l" href="http://get.adobe.com/cn/flashplayer/" target="_blank"><img width="16" height="16" class="icon_install" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{}</span></a><a class="btn_r" href="javascript:void(0);" onclick="window.location.reload()">'+' <img width="16" height="16" class="icon_refreshpage" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{}</span></a></div>'+"</div>";a.lib.kit.io.cssLoader("style/css/module/layer/layer_version_upgrade.css","js_style_css_module_layer_layer_version_upgrade",function(){var e=a.ui.dialog();e.setTitle(b("#L{}"));var f=a.C("div");f.innerHTML=b(d);e.setContent(f);f=null;e.show();e.setMiddle();a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);setTimeout(function(){c.onHide()},0)})})}});
STK.register("lib.kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!!y){var c=b?"visible":"hidden";u&&Q(a)?Q(a).style.visibility=c:U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(!z.ie||!z.mac){var g=j.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0&&(w=j.styleSheets[j.styleSheets.length-1]);x=h}z.ie&&z.win?w&&typeof w.addRule==c&&w.addRule(b,d):w&&typeof j.createTextNode!=a&&w.appendChild(j.createTextNode(b+" {"+d+"}"))}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT")if(z.ie&&z.win){b.style.display="none";(function(){b.readyState==4?P(a):setTimeout(arguments.callee,10)})()}else b.parentNode.removeChild(b)}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312)return g;if(h){typeof b.id==a&&(b.id=e);if(z.ie&&z.win){var i="";for(var j in b)b[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=b[j]:j.toLowerCase()=="styleclass"?i+=' class="'+b[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+b[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b)b[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",b[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,b[n]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&N(m,p,d[p]);h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie)b.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&b.appendChild(e[g].cloneNode(!0))}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(L(a),a)}function J(b,c,d,e){v=!0;s=e||null;t={success:!1,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null,e=Q(b);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(c)[0];f&&(d=f)}return d}function G(){var b=n.length;if(b>0)for(var c=0;c<b;c++){var d=n[c].id,e=n[c].callbackFn,f={success:!1,id:d};if(z.pv[0]>0){var g=Q(d);if(g)if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,!0);if(e){f.success=!0;f.ref=H(d);e(f)}}else if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";g.getAttribute("class")&&(h.styleclass=g.getAttribute("class"));g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));J(h,i,d,e)}else{K(g);e&&e(f)}}else{V(d,!0);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=!0;f.ref=m}e(f)}}}}function F(){var b=j.getElementsByTagName("body")[0],d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else if(g<10){g++;setTimeout(arguments.callee,10);return}b.removeChild(d);e=null;G()})()}else G()}function E(){l?F():G()}function D(b){if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof j.addEventListener!=a)j.addEventListener("load",b,!1);else if(typeof i.attachEvent!=a)S(i,"onload",b);else if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else i.onload=b}function C(a){u?a():m[m.length]=a}function B(){if(!u){try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=!0;var c=m.length;for(var d=0;d<c;d++)m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=!1,m=[E],n=[],o=[],p=[],q,r,s,t,u=!1,v=!1,w,x,y=!0,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&(typeof k.mimeTypes==a||!k.mimeTypes[f]||!!k.mimeTypes[f].enabledPlugin)){l=!0;p=!1;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof i.ActiveXObject!=a)try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=!0;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!!z.w3){(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body))&&B();if(!u){typeof j.addEventListener!=a&&j.addEventListener("DOMContentLoaded",B,!1);if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});i==top&&function(){if(!u){try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()}}()}z.wk&&function(){if(!u){if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()}}();D(B)}}}(),X=function(){z.ie&&z.win&&window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++)p[c][0].detachEvent(p[c][1],p[c][2]);var d=o.length;for(var e=0;e<d;e++)O(o[e]);for(var f in z)z[f]=null;z=null;for(var g in b)b[g]=null;b=null})}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(z.w3)return H(a)},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,!1);C(function(){e+="";f+="";var n={};if(k&&typeof k===c)for(var o in k)n[o]=k[o];n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c)for(var q in j)p[q]=j[q];if(i&&typeof i===c)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(T(g)){var s=M(n,p,d);n.id==d&&V(d,!0);m.success=!0;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}V(d,!0)}l&&l(m)})}else l&&l(m)},switchOffAutoHideShow:function(){y=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){return z.w3?M(a,b,c):undefined},showExpressInstall:function(a,b,c,d){z.w3&&I()&&J(a,b,c,d)},removeSWF:function(a){z.w3&&O(a)},createCSS:function(a,b,c,d){z.w3&&U(a,b,c,d)},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return W(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return W(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,!0);z.ie&&z.win&&(q.style.display="block")}s&&s(t)}v=!1}}}}();return b});
STK.register("lib.image.imgUpload",function(a){var b=document.documentElement,c=document.body,d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}},e=function(a){var b={cn:"zh_CN",tw:"zh_TW"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG.version,swf_path:$CONFIG.jsPath+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"},h={},i,j,k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){a.IE||(m.getFlash(g.id_swf).height=b)},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}},l={version:g.version,language:e($CONFIG.lang),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"},m={init:function(){if(!!b.id){i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";m.getFlash(g.id_swf)||m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!c[a]&&!!c[a][b]},bindEvt:function(a){for(var b in a)k[a[b]]&&!m.checkAction(g.channel,a[b])&&STK.core.util.listener.register(g.channel,a[b],k[a[b]])},build:function(){var c=b.baseDir?b.baseDir+"/":"",d={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path+c},e={id:b.id};m.bindEvt(l);a.lib.kit.extra.swfobject.embedSWF(g.swf_path+c+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,d,e)},getFlash:function(){return a.lib.kit.extra.swfobject.getObjectById(b.id)},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px");m.autoScroll(j.t,j.t+(c-f))},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++)e[f]=h=h/2;clearInterval(d);d=setInterval(function(){e.length?window.scrollTo(0,b+e.shift()):clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){for(var b in l)k[l[b]]&&STK.core.util.listener.remove(g.channel,l[b],k[l[b]]);i.innerHTML="";a.removeNode(i)};m.init();return h}});
STK.register("lib.browser.plugin.plugInstallState",function(a){return function(b,c,d,e){var f={},g=a.core.util.browser,h=window.navigator,i=a.IE,j=g.MOZ,k=g.OPERA,l=g.SAFARI,m=g.CHROME,n=g.Version,o=c.embedId,p=c.embedType,q=b.pluginName,r=b.activeXName;f.instance=e;var s=function(){var a;for(a=0;a<d.length;a++)if(!(d.param[a]in f.instance))break;return a<d.length-1?!1:!0};f.getInstallState=function(){if(i){var b;if(!f.instance)try{f.instance=new ActiveXObject(r);b=!0}catch(c){f.instance=null}if(f.instance){if(s())return"ieinstalled";if(!b)try{f.instance=new ActiveXObject(r)}catch(c){f.instance=null}return f.instance?s()?"ieinstalled":"ieneedUpdate":"ieneedInstall"}return"ieneedInstall"}var d=h.plugins,e;if(d&&d.length)for(var g=0,j=d.length;g<j;g++){var k=d[g];if(k&&k.name&&k.name===q){e=!0;break}}if(e){if(!f.instance){var l=a.C("embed");l.id=o;l.type=p;l.setAttribute("hidden",!0);document.body.appendChild(l);f.instance=l}return"installed"}f.instance=null;return"needInstall"};return f}});
STK.register("lib.browser.plugin.screenCapture",function(a){var b=a.core.util.browser,c=a.lib.kit.extra.language,d=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},e=a.IE,f=b.MOZ,g=b.OPERA,h=b.SAFARI,i=b.CHROME,j=b.Version,k="weibo_screen_grab_download",l={pluginName:"npScreenGrab Plugin",activeXName:"ScreenGrab.ScreenGrabCom.1"},m={embedId:"weibo_screen_grab_embed",embedType:"application/x-screengrab-sina"},n={param1:"OnGrapContent",param2:"CloseScreenGrabCtrlWnd",param3:"onmsgfireevent"},o,p={spec:null,setCurrentSpec:function(a){p.spec=a},setup:function(){if(typeof o.OnGrapContent!="function"){o.OnGrapContent=function(a,b,c,d){var e=p.spec;q.focusWindow();if(a===2){if(e.captureType==="base64")e.captureSuccess(c);else if(e.captureType==="pid"){e.beforeUpload();e.upload(c)}}else if(a===3){q.focusWindow();e.captureCancel()}};o.onmsgfireevent=function(a,b){if(b===2){q.focusWindow();spec.captureCancel()}};a.addEvent(window,"unload",function(){a.removeEvent(window,"unload",arguments.callee);if(o)try{o.CloseScreenGrabCtrlWnd();o.onmsgfireevent=null;o.OnGrapContent=null;o=null}catch(b){}})}}},q={};q.isSupport=function(){return b.OS==="windows"?e?!0:f?j>=3.6?!0:!1:g?!1:h?!1:i?j>=4?!0:!1:!1:!1};q.focusWindow=function(){window.focus()};q.hide=function(){o&&o.CloseScreenGrabCtrlWnd()};q.screenCapture=function(b){var g,h={uploadSucc:function(a,c){q.focusWindow();b.captureSuccess(c)},uploadErr:function(a,c){b.captureError(c)}},j=function(b){g&&g.destroy();g=a.lib.kit.extra.upload({type:"base64",base64Str:b});a.custEvent.add(g,"uploadSucc",h.uploadSucc);a.custEvent.add(g,"uploadError",h.uploadErr)},r=function(){b.upload=function(a){j(a)};p.setup();p.setCurrentSpec(b);if(a.isArray(b.showPos)){var c=b.showPos;o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(typeof b.showPos=="function"){var c=b.showPos();a.isArray(c)&&o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(b.showPos==="center"){var d=a.scrollPos(),e=200,f=200,g=a.winSize(),h=Math.floor(d.top+(g.height-e)/2),i=Math.floor(d.left+(g.width-f)/2);o.ShowControlWnd(window.screenLeft+i,window.screenTop+h,f,e)}else b.showPos==="default"&&o.ShowControlWnd(-1,-1,-1,-1)},s=function(b,e){var f="http://desktop.weibo.com/download.php?source=jietu",g='<#et screentip data><div class="layer_screenshot_tips"><p class="tip" style="width:338px"><span class="icon_warnM"></span>${data.titletip}</p><div><a href="http://desktop.weibo.com" target="_blank"><img src="${data.imgsrc}" width="338" height="147"/></a></div></div></#et>',h={imgsrc:(window.$CONFIG&&window.$CONFIG.imgPath||"http://img.t.sinajs.cn/t6/")+"style/images/layer/pic_screenshot.png?version="+(window.$CONFIG&&window.$CONFIG.version||""),titletip:b==="IE"?"#L{}":"#L{}"+(b==="FF"?"#L{}":""),downloadTitle:"#L{}"},i=a.ui.dialog();i.setTitle(c("#L{}"));i.setContent(c(a.core.util.easyTemplate(g,h).toString()));i.show();i.setMiddle();var j=i.getDomList(!0),l=function(){i.hide();d("tblog_image_cut","cancel_download")},m=function(b){var c=a.E(k);if(!c){c=a.C("iframe");c.id=k;c.style.display="none";a.core.util.hideContainer.appendChild(c)}c.src=f;d("tblog_image_cut","download");i.hide()};a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);e()})},t=function(){b.beforeSupportTip();a.ui.alert(c("#L{WindowsIEIE6IE360Firefox3.6Chrome4.0Chronium360}"),{title:c("#L{}"),OK:function(){setTimeout(function(){b.supportTipOk()},0)}});d("tblog_image_cut","not_support_browser")},u=function(){var c=e?"IE":f?"FF":i?"CHROME":"";b=a.parseParam({captureType:"base64",captureSuccess:a.funcEmpty,captureCancel:a.funcEmpty,captureError:a.funcEmpty,beforeUpload:a.funcEmpty,showPos:"default",beforeSupportTip:a.funcEmpty,supportTip:t,supportTipOk:a.funcEmpty,beforeIeInstallTip:a.funcEmpty,ieInstallTip:function(){b.beforeIeInstallTip();s(c,b.ieInstallTipOk)},ieInstallTipOk:a.funcEmpty,beforeInstallTip:a.funcEmpty,installTip:function(){b.beforeInstallTip();s(c,b.installTipOk)},installTipOk:a.funcEmpty},b||{});var d=q.isSupport();if(!d)b.supportTip();else{var g=a.lib.browser.plugin.plugInstallState(l,m,n,o),h=g.getInstallState();o=g.instance;h==="installed"||h==="ieinstalled"?r():h==="ieneedUpdate"||h==="ieneedInstall"?b.ieInstallTip():h==="needInstall"&&b.installTip()}};return{doit:u,hide:q.hide,focusWindow:q.focusWindow,abort:function(){try{g&&g.abort()}catch(a){}}}};return q});
STK.register("lib.image.uploadBubble",function(a){var b=window.$CONFIG,c=[];(function(){b&&b.bigpipe==="true"&&a.historyM&&a.historyM.onpopstate(function(b,d){if(d){a.foreach(c,function(a){a()});c=[]}})})();var d=a.conf.trans.imageUploadBubble;return function(e,f){var g,h,i=a.lib.browser.plugin.screenCapture,j=a.lib.kit.extra.language,k='<div node-type="outer"><div class="layer_send_pic" node-type="wrap"><div node-type="inner"><div node-type="tabs"><div class="profile_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a class="pftb_lk current S_line5 S_txt1 S_bg5" href="javascript:void(0);" node-type="tab1" action-type="tab">#L{}</a></li><li class="pftb_itm pftb_itm_lst S_line1"><a  class="pftb_lk S_line5 S_txt1 S_bg1" href="javascript:void(0);" node-type="tab2" action-type="tab">#L{}</a></li></ul></div></div><div node-type="content"></div></div><div node-type="uploaded" style="display:none"><div class="laPic_tit"><span node-type="pName"></span><span class="right"></span></div><div node-type="picWrap" class="laPic_Pic"></div><div class="lapic_edit"><a class="beautify" href="javascript:void(0);" node-type="beautify" action-type="beautify" suda-data="key=meitu&value=v4||publish||editor"><span class="W_ico12 icon_edit"></span>#L{}</a><a class="delete" href="javascript:void(0);" action-type="delete"><span class="W_ico12 ico_del"></span>#L{}</a></div></div><div node-type="flashPanel"></div>',l='<#et uppic data><div node-type="uppic">    <div class="laPic_btnBox clearfix">        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" node-type="inputCover">                <span><em class="ico_one"></em>#L{}</span>                <form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action="">                    <input class="input_f" type="file" hidefoucs="true" style="" node-type="fileBtn" name="pic1"/>                </form></a>        </div>        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="more" suda-data="key=meitu&value=v4||publish||more">                <span><em class="ico_ones"></em>#L{}</span>            </a>        </div>        <#if (data.supportCapture)><div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="screen_window" suda-data="key=tblog_image_cut&value=open_image_cut">                <span><em class="ico_screenshot"></em>#L{}</span>            </a>        </div></#if>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="face_sticker">               <span><em class="ico_bigface"></em>#L{  }</span>           </a>       </div>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="upload_album">               <span><em class="ico_toalbum"></em>#L{}</span>           </a>       </div>    </div></div><div node-type="loading"  style="width:230px;display:none"><div class="laPic_con"><div><i class="W_loading"></i> <span>#L{}...</span></div></div><div class="laPic_btn"><a href="javascript:void(0);" class="W_btn_b" action-type="cancel"><span>#L{}</span></a></div></div></#et>',m='<p class="tab_kind S_link2"><span class="right"><a class="pre_d" action-type="prev" node-type="prev" href="javascript:void(0);"></a><a class="next" action-type="next" node-type="next" href="javascript:void(0);"></a></span><em node-type="categorys"></em></p><div node-type="loading"></div><div class="detail"><ul node-type="list" class="faces_magic_list clearfix"></ul><div node-type="page" class="W_pages_minibtn"></div></div>',n='<div><i class="W_loading"></i> <span>...</span></div>',o='<a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{item}">#{item}</a>',p='<a href="javascript:void(0);"  onclick="return false;" action-type="category" action-data="category=#{item}" class="current S_txt1">#{item}</a>',q='<li><a action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}" class="img" href="javascript:void(0);"><img src="#{thumb}" original="#{original}" title="#{value}" alt="#{phrase}" /></a><span title="#{value}"  action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}">#{phrase}</span></li>',r='<a action-type="page" class="page S_bg1" action-data="num=#{number}" href="javascript:void(0);" >#{label}</a>',s='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);"  class="page S_txt1"  onclick="return false;">#{label}</a>',t="",u=j("#L{}"),v="#L{}",w="##L{}#",x=5,y="weibo.com/",z,A,B,C,D,E,F,G,H,I,J,K,L={},M={page:0,cache:null,cPoniter:0,categorys:[],currentCategory:u,itemNumber:10},N,O,P=a.core.dom.position,Q=a.core.evt.addEvent,R=a.core.evt.removeEvent,S=function(){B=T;a.custEvent.define(L,["uploaded","hide","insert","deletePIC","picLoad"]);a.custEvent.add(g,"hide",function(b){return function(){T.abortUpload();T.hideCapture();a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(L,"hide",{});H=0}}(g));h=a.ui.mod.tab({templete:z,eventType:"click"});a.custEvent.add(h,"tabOut",function(a,b){b=="tab1"?U.init():b=="tab2"&&T.init()});K=a.core.evt.delegatedEvent(z);T.bind()},T={abortUpload:function(){E&&E.abort();F&&F.abort()},init:function(){B=T;T.initDom();T.bind()},initDom:function(){var b;N.wrap.className="layer_send_pic";var c={supportCapture:!0};N.content.innerHTML=j(a.core.util.easyTemplate(l,c).toString());N.close=a.builder(g.getBox()).list.close[0];b=a.lib.kit.dom.parseDOM(a.core.dom.builder(z).list);N=a.lib.kit.extra.merge(N,b);T.exchangeInput()},bind:function(){Q(N.fileBtn,"change",V.upload);Q(N.fileBtn,"click",T.hideCapture);K.add("delete","click",T.deletePic);K.add("cancel","click",T.cancelUpload);K.add("more","click",T.morePic);K.add("beautify","click",T.beautify);K.add("screen_window","click",T.captureWindow);K.add("face_sticker","click",T.faceSticker);K.add("upload_album","click",T.uploadAblum)},destroy:function(){N.fileBtn&&R(N.fileBtn,"click",T.hideCapture);N.fileBtn&&R(N.fileBtn,"change",V.upload)},handleError:function(b){T.stopUpload();g.stopBoxClose();T.resetInput();a.ui.alert(j(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){g.startBoxClose()},0)}})},handleSucc:function(a){T.rendSucc(a);T.stopUpload()},rendLoad:function(){g.stopBoxClose();N.uppic.style.display="none";N.loading.style.display=""},rendSucc:function(b){var c=a.lib.kit.extra.imageURL(b.pid),d=[],e,f;J=J||b.pid;d=J.split(/\/|\\/);e=d[d.length-1];d=e.split(".");if(d.length>1&&a.bLength(d[0])>20){d[0]=a.leftB(d[0],20);f=[d[0],"...",d[1]].join("")}else f=e;D=b.pid;V.loadPic({url:c,value:f,pid:b.pid});N.beautify&&(N.beautify.style.display="")},deletePic:function(){a.preventDefault();N.close.style.display="";N.inner.style.display="";N.wrap.style.width="";N.uploaded.style.display="none";N.picWrap.innerHTML="";B.destroy();B.init();g.startBoxClose();a.custEvent.fire(L,"deletePIC",{text:j(I)});H=0},stopUpload:function(){N.loading.style.display="none";N.uppic.style.display=""},cancelUpload:function(){T.abortUpload();T.stopUpload();T.resetInput();g.startBoxClose()},exchangeInput:function(){var b=N.fileBtn,c=b.parentNode,d=b.className,e=b.name,f=a.C("input");f.className=d;f.name=e;f.type="file";f.hideFocus="true";N.fileBtn=f;c.removeChild(b);c.appendChild(f)},resetInput:function(){R(N.fileBtn,"click",T.hideCapture);R(N.fileBtn,"change",V.upload);T.exchangeInput();Q(N.fileBtn,"change",V.upload);Q(N.fileBtn,"click",T.hideCapture)},beautifySucess:function(a){J=a;T.handleSucc({pid:a})},faceStickerSucess:function(a){H=1;J=a;T.handleSucc({pid:a})},morePic:function(){T.uploadWaterMarkFlash({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:T.beautifySucess})},faceSticker:function(){T.uploadWaterMarkFlash({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:T.faceStickerSucess})},uploadWaterMarkFlash:function(c){a.preventDefault();T.hideCapture();g.stopBoxClose();if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash({onHide:function(){g.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",f=b&&b.nick||"",h="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(f?encodeURIComponent("@"+f):""):"")+(d.domain=="1"?"&url="+y+(b&&b.watermark||b.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",i={id:c.id,pos:g.getPosition(),service:h,sucess:c.sucess,h:c.height,w:c.width,swf:c.swf,baseDir:c.baseDir||""};a.lib.image.imgUpload(i,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){g.startBoxClose()},100)}}).show()};a.lib.image.watermark(function(a){d(a)})}},beautify:function(){a.preventDefault();if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash();else{var b={id:"photo_editor",pos:g.getPosition(),service:"http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:T.beautifySucess,h:385,w:528,swf:"PhotoEditor.swf"};a.lib.image.imgUpload(b,{init:function(b,c){b.setPars(a.lib.kit.extra.imageURL(D,{size:"large"}))},close:function(a,b){}}).show()}},hideCapture:function(){F&&F.hide()},captureWindow:function(){a.preventDefault();if(!F){var b=function(){g.stopBoxClose()},c=function(){g.startBoxClose()};F=i.screenCapture({captureType:"pid",beforeUpload:T.beforeCaptureUpload,captureSuccess:T.captureSuccess,captureError:T.handleError,beforeSupportTip:b,supportTipOk:c,beforeIeInstallTip:b,ieInstallTipOk:c,beforeInstallTip:b,installTipOk:c})}F.doit()},beforeCaptureUpload:function(){T.rendLoad()},captureSuccess:function(a){J=a.imgName;G=1;T.handleSucc(a)},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},U={init:function(){B=U;T.abortUpload();T.hideCapture();var b;N.wrap.className="layer_faces";T.destroy();N.content.innerHTML=j(m);b=a.lib.kit.dom.parseDOM(a.core.dom.builder(z).list);N=a.lib.kit.extra.merge(N,b);N.loading.innerHTML=j(n);U.cartoonStart();U.bind()},bind:function(){K.add("insertSmiley","click",function(a){STK.core.evt.preventDefault();N.beautify&&(N.beautify.style.display="none");var b=a.data.url,c=a.data.pid,d=a.data.value;V.loadPic({url:b,value:d,pid:c})});K.add("category","click",function(a){M.page=0;M.currentCategory=a.data.category;U.rend();setTimeout(function(){U.rendCategory(M);U.rendPage(M)},0)});K.add("prev","click",function(b){a.preventDefault(b.evt);var c=M.cPoniter;if(c<=0)return!1;M.cPoniter-=x;U.rendCategory(M)});K.add("next","click",function(b){a.preventDefault(b.evt);var c=M.cPoniter,d=M.categorys;if(c>=d.length-x)return!1;M.cPoniter+=x;U.rendCategory(M)});K.add("page","click",function(a){M.page=parseInt(a.data.num,10);U.rend();setTimeout(function(){U.rendPage(M)},0);return STK.preventDefault(a.evt)})},cartoonStart:function(){d.request("cartoon",{onSuccess:function(a,b){M.cache=a.data.more||{};M.categorys=[u];for(var c in M.cache)M.categorys.push(c);M.cache[u]=a.data.usual.norm;U.cartoonStart=function(){M.page=0;M.cPoniter=0;M.currentCategory=u;U.rend();U.rendCategory(M);U.rendPage(M)};U.cartoonStart()},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{})},rend:function(b,c){var d=M.currentCategory,e=M.cache[d],f=M.page,g=M.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){a.bLength(b.phrase)>8&&(b.phrase=[a.leftB(b.phrase,6),"..."].join(""));return a.templet(j(q),b)});N.loading.innerHTML="";N.list.innerHTML=e.join("")},rendCategory:function(b){var c=b.cPoniter,d=b.categorys,e=b.currentCategory,f=d.slice(c,c+x);f=a.foreach(f,function(b,c){return e===b?a.templet(j(p),{item:b}):a.templet(j(o),{item:b})});N.categorys.innerHTML=f.join(t);c+6>=d.length?N.next.className="next_d":N.next.className="next";c<=0?N.prev.className="pre_d":N.prev.className="pre"},rendPage:function(b){var c=b.page,d=b.cache[b.currentCategory],e=d.length/b.itemNumber,f=[];for(var g=0;g<e;g+=1)c==g?f.push(a.templet(j(s),{number:g,label:g+1})):f.push(a.templet(j(r),{number:g,label:g+1}));N.page.innerHTML=f.join("")},destroy:function(){}},V={trans:function(){E&&E.destroy();E=a.lib.kit.extra.upload({type:"common",form:N.form,imgName:J});a.custEvent.add(E,"uploadSucc",function(a,b){T.handleSucc(b)});a.custEvent.add(E,"uploadError",function(a,b){T.handleError(b)})},upload:function(){J=N.fileBtn.value;if(a.core.str.trim(J)!==""){T.rendLoad();V.trans()}},loadPic:function(b){N.picWrap.innerHTML="";var c=b.url,d=N.close,e=a.C("img");b.value&&(N.pName.innerHTML=b.value);G&&(e.onload=function(){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_image_cut","succeed_image_cut")});G=0;e.src=c;g.stopBoxClose();I=H?w:v;a.core.evt.custEvent.fire(L,"uploaded",{text:j(I),pid:b.pid});N.wrap.style.display="";N.wrap.className="layer_send_pic";N.wrap.style.width="240px";N.inner.style.display="none";N.uploaded.style.display="";d.style.display="none";N.picWrap.appendChild(e)}},W={};L={};L.getBub=function(){return g};if(!a.isNode(e))throw"common.bubble.image need el as first parameter!";O=window.location.href;N=a.lib.kit.dom.parseDOM(a.core.dom.builder(j(k)).list);z=N.outer;g=a.ui.bubble();T.initDom();if(f&&f.pid){var X=a.lib.kit.extra.imageURL(f.pid);V.loadPic({url:X,pid:f.pid})}S();g.setContent(z);f.fail=function(){g.setLayout(e,{offsetX:-24,offsetY:5})};g.setAlignPos(e,f.refer,f);L.bubble=g;g.show();c.push(function(){g&&g.hide()});return L}});
STK.register("lib.publisher.widget.image",function(a){return function(b){var c={},d,e,f,g,h=!1,i=function(a,c){var e=b.API.getImageLogType();b.API.addShortUrlLog(e);b.API.insertText(c.value);d.getBub().hide()},j=function(a,c){var d=b.API.getImageLogType();b.API.addShortUrlLog(d);h=!0;var e=b.API.getWords();e.length==0&&b.API.insertText(c.text);b.API.addExtraInfo(c.pid);f=!0},k=function(a,c){h=!1;b.API.delWords(c.text);b.API.addExtraInfo("");clearInterval(g);f=!1},l=function(e){if(!f){a.core.evt.preventDefault();var l,m=a.fixEvent(a.getEvent()).target;l=m;var n=b.nodeList.textEl;if(typeof e=="string"){d=a.lib.image.uploadBubble(l,{pid:e,refer:n});g=setInterval(function(){var a={fail:function(){d.bubble.setLayout(l,{offsetX:-29,offsetY:5})}};d.bubble.setAlignPos(l,n,a)},200)}else d=a.lib.image.uploadBubble(l,{refer:n});a.custEvent.add(d,"uploaded",j);a.custEvent.add(d,"insert",i);a.custEvent.add(d,"deletePIC",k);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"uploaded",j);a.custEvent.remove(d,"insert",i);a.custEvent.remove(d,"deletePIC",k);a.custEvent.remove(d,"changeType");a.custEvent.remove(b,"close",c.hide);b.API.addExtraInfo("");h=!1;f=!1})}};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",l);f&&f.pid&&l(f.pid)};c.show=l;c.hide=function(b,c){if(h&&d){var e=d.getBub();if(e){var f=a.builder(e.getBox()).list.close[0];a.isNode(f)&&a.setStyle(f,"display","")}}a.core.util.listener.fire("photo_merge_channel","closeEditor",[]);a.core.util.listener.fire("photo_editor_channel","closeEditor",[]);c&&c.type&&c.type=="publish"?d&&d.getBub().hide():h||d&&d.getBub().hide()};c.resetBubble=function(a){if(d){var c={fail:function(){d.bubble.setLayout(a,{offsetX:-29,offsetY:5})}};d.bubble.setAlignPos(a,b.nodeList.textEl,c)}};c.destroy=function(){b=null};return c}});
STK.register("lib.image.mUpload",function(a){var b=$CONFIG.jsPath+"home/static/swf/",c="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&data=1",d,e="";$CONFIG&&$CONFIG.uid&&(e=$CONFIG.uid||"");var f='<form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action=""><input type="file" hidefoucs="true" node-type="fileBtn" name="pic1"/></form>',g={};return function(h,i){var j={},k={},l,m,n,o=a.lib.kit.extra.getFlashVersion()<10?!0:!1,p=function(){var d=a.core.dom.getSize(h);k=a.core.obj.parseParam({service:c,swf:b+"MultiFilesUpload.swf?version="+$CONFIG.version,exp_swf:b+"img/expressInstall.swf?version="+$CONFIG.version,h:d.height,w:d.width,version:"10.0.0",type:"*.png;*.jpg;*.gif;*.jpeg;",size:20971520,number:9,globalFun:"fcb_"+a.getUniqueKey(),callback:t,init:function(){},uploaded:function(){},uploading:function(){},error:function(){},extra:function(){}},i);k.id="swf_upbtn_"+a.getUniqueKey();k.channel=k.id+"_channel"},q={uploading:function(a){k.uploading({data:[{fid:a.fid,name:a.name}]})},uploaded:function(a){k.uploaded({data:{pid:a.pid},fid:a.fid})},error:function(a){var b="defaultErr",c="";if(a.code==9){b="singleError";c="A20001"}k.error({type:b,fid:a.fid,data:{sourceData:{code:c}}})}},r=function(){var b=a.getUniqueKey(),c=m.value;g[b]=a.lib.kit.extra.upload({type:"common",form:n,imgName:c,app:1001});q.uploading({fid:b,name:c});m.value="";a.custEvent.add(g[b],"uploadSucc",function(a,c){var d=c.pid;q.uploaded({fid:b,pid:c.pid})});a.custEvent.add(g[b],"uploadError",function(a,c){q.error({code:c.code,fid:b})})},s=function(){var b=a.C("div"),c=a.C("div");c.setAttribute("id",k.id);var d="position:absolute;left:0;top:0;display:block;overflow:hidden;background-color:#000;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;";d+="width:"+k.w+"px;"+"height:"+k.h+"px;";b.style.cssText=d;h.appendChild(b);h.style.position="relative";var g={swfid:k.id,uploadAPIs:encodeURIComponent(k.service),maxFileSize:k.size,maxFileNum:k.number,jsHandler:"STK."+k.globalFun,channel:k.channel,areaInfo:"0-0-"+k.w+"-"+k.h,fExt:k.type,fExtDec:":*.jpg, *.jpeg, *.gif, *.png",uid:e},i={menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"opaque"};if(o){var j=a.builder(f).list;m=j.fileBtn[0];n=j.form[0];m.style.cssText="width:"+k.w+"px;"+"height:"+k.h+"px;";b.appendChild(n)}else{b.appendChild(c);a.lib.kit.extra.swfobject.embedSWF(k.swf,k.id,k.w,k.h,k.version,k.exp_swf,g,i,k.id,u)}},t=function(a,b,c){switch(c.type){case"flashInit":k.init(c);break;case"uploading":k.uploading(c);break;case"singleSuccess":k.uploaded(c);break;case"fileNumErr":return k.error(c);case"singleError":k.error(c);break;case"fileSizeErr":k.error(c);break;default:k.extra(c)}},u=function(a){l=a.ref},v=function(){o?a.core.evt.addEvent(m,"change",r):STK[k.globalFun]=t},w=function(){a.lib.image.watermark(function(b){var e=b,f="weibo.com/",g=window.$CONFIG,h=e.nickname!="0"||e.logo!="0"||e.domain!="0",i={marks:h?1:0};d=a.lib.kit.extra.merge({url:e.domain=="1"?f+(g&&g.watermark||g.domain):0,markpos:e.position||"",logo:e.logo||"",nick:e.nickname=="1"?encodeURIComponent("@"+(g&&g.nick)):0},i);c+="&"+a.jsonToQuery(d);p();s();v()})};w();var x=function(){return k.id},y=function(){return l},z=function(a){if(o){g[a]&&g[a].abort();m.value=""}else try{mUpload&&mUpload.getswf&&mUpload.getswf()&&mUpload.getswf().removeFileById&&mUpload.getswf().removeFileById(a)}catch(b){}},A=function(){delete STK[k.globalFun]};j.getId=x;j.destroy=A;j.getswf=y;j.removeFile=z;return j}});
STK.register("lib.kit.touch.cantouch",function(a){return STK.core.util.browser.IPAD});
STK.register("lib.image.multiimage.index",function(a){var b='<div class="W_layer W_layer_pop WB_outReset"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_pic" node-type="inner"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2" suda-data="key=tblog_new_image_upload&value=fast_upload"><a href="javascript:void(0);" class="W_btn_l" node-type="mUpload"><span class="btn_45px"><em class="W_ficon ficon_add_pic S_ficon"></em>#L{/}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" node-type="inputCover" action-type="more" suda-data="key=tblog_new_image_upload&value=pin_upload"><span class="btn_45px"><em class="W_ficon ficon_puzzle S_ficon"></em>#L{}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" action-type="capture" suda-data="key=tblog_new_image_upload&value=screenshot_upload"><span class="btn_45px"><em class="W_ficon ficon_screenshot S_ficon"></em>#L{}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" action-type="uploadAblum" suda-data="key=tblog_new_image_upload&value=upload_albums"><span class="btn_45px"><em class="W_ficon ficon_upload_album S_ficon"></em>#L{}</span></a></li></ul></div></div><div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div>',c,d,e;return function(f,g){var h={},i,j="weibo.com/",k=$CONFIG||{},l=a.lib.browser.plugin.screenCapture,m,n,o=a.lib.kit.extra.language,p=function(b){if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash({onHide:function(){c.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",f=$CONFIG&&$CONFIG.nick||"",g="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(f?encodeURIComponent("@"+f):""):"")+(d.domain=="1"?"&url="+j+(k&&k.watermark||k.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",h={id:b.id,pos:c.getPosition(),service:g,sucess:b.sucess,h:b.height,w:b.width,swf:b.swf,baseDir:b.baseDir||""};n=a.lib.image.imgUpload(h,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){c.startBoxClose()},100)}});n.show()};a.lib.image.watermark(function(a){d(a)})}},q=function(b){c.startBoxClose();var b=b.pid||b,d=a.getUniqueKey();e.uploading({data:[{fid:d}]});e.uploaded({data:{pid:b},fid:d})},r={hideCapture:function(){m&&m.hide()},handleError:function(b){c.stopBoxClose();a.ui.alert(o(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){c.startBoxClose()},0)}})},captureWindow:function(){a.preventDefault();if(!m){var b=function(){c.stopBoxClose()},d=function(){c.startBoxClose()};m=l.screenCapture({captureType:"pid",beforeUpload:r.beforeCaptureUpload,captureSuccess:q,captureError:r.handleError,beforeSupportTip:b,supportTipOk:d,beforeIeInstallTip:b,ieInstallTipOk:d,beforeInstallTip:b,installTipOk:d})}m.doit()},beforeCaptureUpload:function(){c.stopBoxClose()},captureSuccess:function(a){imgName=a.imgName;captureFlag=1;r.handleSucc(a)}},s={splice:function(){p({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:function(a){q(a)}});c.hide()},face_sticker:function(){p({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:function(){}});c.hide()},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},t=function(){function h(){c.stopBoxClose();c.getBox().style.marginLeft="-2000px"}c&&c.destroy();c=a.ui.bubble({template:o(b),clickBlankToHide:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",showWithSetWidth:!1});c.show().setArrow("top").setAlignPos(f,g.refer,g);c.getBox().style.zIndex=9999;var i=a.sizzle('a[node-type="mUpload"]',c.getBox());e=g.editor.getPreview();a.lib.image.mUpload(i[0],{w:194,h:45,uploading:e.uploading,uploaded:e.uploaded,error:e.error,extra:e.extra});a.custEvent.add(e,"loading",function(){h()});a.custEvent.add(e,"hide",function(){h()});d=a.delegatedEvent(c.getBox());d.add("more","click",s.splice);d.add("capture","click",r.captureWindow);d.add("uploadAblum","click",s.uploadAblum)},u=function(){t()};u();h.getPreview=function(){return e};h.hide=function(){c.hide()};h.getBub=function(){return c};h.destroy=function(){c.destroy();d.destroy();c=null};return h}});
STK.register("lib.publisher.widget.multiimage",function(a){return function(b){var c={},d,e,f,g,h=!1,i,j={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a)},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},k=function(a,c){var e=b.API.getImageLogType();b.API.addShortUrlLog(e);b.API.insertText(c.value);d.getBub().hide()},l=function(a,c){h=!0;b.API.addExtraInfo(c.pids);f=!0;if(c.pids=="")b.API.delWords(c.text);else{var d=b.API.getWords();d.length==0&&b.API.insertText(c.text)}},m=function(e){if(!f){a.core.evt.preventDefault();var g,k=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,k)?g=k:g=b.nodeList.more;var l=b.nodeList.textEl,m=j.restore();d=a.lib.image.multiimage.index(g,{refer:l,editor:b});i=b.getPreview();a.custEvent.add(i,"loading",function(){h=!0;f=!0});a.custEvent.add(b,"close",c.hide);a.custEvent.add(i,"hide",function(){h=!1;a.custEvent.remove(i,"hide",arguments.callee);a.custEvent.remove(i,"changeType");a.custEvent.remove(b,"close",c.hide);f=!1});if(!i.getNumInfo()&&m&&m!=""){f=!0;var n=m.split(" "),o=[];for(var p=0;n[p];p++)o.push({fid:a.getUniqueKey(),pid:n[p]});if(!o[0])return;i.uploading({data:o});for(var p=0;o[p];p++)i.uploaded({fid:o[p].fid,data:o[p]})}}};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",m);f&&f.pid&&m(f.pid)};c.show=m;c.hide=function(b,c){i&&i.hide();a.core.util.listener.fire("photo_merge_channel","closeEditor",[]);a.core.util.listener.fire("photo_editor_channel","closeEditor",[]);if(c&&c.type&&c.type=="publish"){d&&d.getBub().hide();f=!1}else d&&d.getBub().hide()};c.destroy=function(){d.destroy();b=null};return c}});
STK.register("widget.module.component",function(a){return function(){var b={};b.initParam=a.core.func.empty;b.initEvent=a.core.func.empty;b.destroyParam=a.core.func.empty;b.destroyEvent=a.core.func.empty;b.init=function(){b.initParam();b.initEvent()};b.destroy=function(){b.destroyEvent();b.destroyParam()};return b}});
STK.register("widget.parse",function(a){var b="http://js.t.sinajs.cn/t5/page/js/",c="STK.",d=["destroy","part_destroy","part_flush"],e=1,f=typeof $CONFIG=="undefined"?e:$CONFIG.version;return function(e,g){var h=a.widget.module.component(),i=a.core.obj.sup(h,["init","destroy"]),j={},k,l;h.handler={getMethod:function(b){b=b.split(".");var c,d=a;while(c=b.shift())if(!(d=d[c]))break;return d},extract:function(a){var b=h.handler.getMethod(a.ns);if(b){j[a.uniqueID]={info:a,entity:b(a)};j[a.uniqueID].entity.init()}},getDomInfo:function(b){return{dom:b,top:h.entity.dom,ns:b.getAttribute("component"),uniqueID:a.core.dom.uniqueID(b),data:a.queryToJson(b.getAttribute("component-data")||""),param:a.queryToJson(b.getAttribute("component-param")||"")}},loadComponent:function(b){var c=h.handler.getDomInfo(b),d=[{url:[k.baseURL,c.ns.replace(/\./g,"/"),".js?version=",f].join(""),NS:k.baseNS+c.ns}];a.core.io.require(d,h.handler.extract,c)}};h.accept={partDestroy:function(b,c){var d=c.dom;for(var e in j)if(a.contains(d,j[e].info.dom)){j[e].entity.destroy();delete j[e].info;delete j[e].entity;delete j[e]}},partFlush:function(b,c){a.foreach(a.sizzle("[component]",c.dom),h.handler.loadComponent)}};h.initParam=function(){h.entity={dom:e};l=a.custEvent.define(h.entity.dom,d);k=a.parseParam({baseURL:b,baseNS:c},g);j={}};h.destroyParam=function(){k=null;j=null};h.initEvent=function(){a.custEvent.add(l,"part_destroy",h.accept.partDestroy);a.custEvent.add(l,"part_flush",h.accept.partFlush)};h.destroyEvent=function(){a.custEvent.remove(l,"part_destroy",h.accept.partDestroy);a.custEvent.remove(l,"part_flush",h.accept.partFlush)};h.destroy=function(){for(var a in j){j[a].entity.destroy();delete j[a].info;delete j[a].entity;delete j[a]}i.destroy()};h.init=function(){i.init();a.foreach(a.sizzle("[component]",h.entity.dom),h.handler.loadComponent)};return h}});
STK.register("lib.connect.iframe",function(a){var b={},c={},d=function(c,d,e,f){try{var g=a.jsonToStr({cid:d,call:e,rs:f});b[c]&&b[c].contentWindow&&b[c].contentWindow.postMessage?b[c].contentWindow.postMessage(g,"*"):window.navigator["STK_IFRAME_CONNECT_"+c]&&window.navigator["STK_IFRAME_CONNECT_"+c](g)}catch(h){}},e=function(e){try{var f=a.strToJson(e.data);if(f.iid in c){a.custEvent.define(c[f.iid],[f.cmd]);a.custEvent.fire(c[f.iid],f.cmd,[b[f.iid],f.param,function(a,b){return d(f.iid,f.cid,a,b)}])}}catch(g){}};window.postMessage?a.addEvent(window,"message",e):window.navigator.STK_IFRAME_CONNECT_OUT=function(a){e({data:a})};return function(e){if(!e)return!1;e.contentWindow.name=e.name=e.name||"iframe_"+a.getUniqueKey();if(e.name in b){if(b[e.name]!=e)throw"iframe:"+e.name+" is existed! "}else{b[e.name]=e;c[e.name]={};e.src=e.getAttribute("_src");e.removeAttribute("_src");e.contentWindow.name=e.name}return{trigger:function(a,b){d(e.name,"_EVENT_",a,b)},on:function(b,d){a.custEvent.define(c[e.name],b);a.custEvent.add(c[e.name],b,d)},off:function(b,d){a.custEvent.remove(c[e.name],b,d)},destroy:function(){a.custEvent.undefine(c[e.name]);delete b[e.name];delete c[e.name]}}}});
STK.register("lib.sandbox.publishPluginBubble",function(a){var b={},c=a.lib.kit.extra.language,d='<div class="W_layer W_layer_pop WB_outReset"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div node-type="inner"></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';return function(e){var f={},g=function(){e.insert(arguments[0],arguments[1]);i.remove(b.ishow)},h=1,i={add:function(a){if(!b[a.id]){b[a.id]={};b[a.id].box=i.build(a)}b.ishow=a.id;return b[a.id]},has:function(a){return b[a.id]},remove:function(c){if(b[c]){a.custEvent.remove(b[c].layer.getInner(),"bridge",g);try{b[c].wbml.destroy&&b[c].wbml.destroy()}catch(d){}try{b[c].iframe.destroy&&b[c].iframe.destroy()}catch(d){}b[c].box.destroy&&b[c].box.destroy();b[c].layer.destroy&&b[c].layer.destroy();var e=b[c].layer.getOuter();e.parentNode.removeChild(e);delete b[c]}},build:function(f){var i=a.ui.bubble(d,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0,showWithSetWidth:!1});h++;i.setContent(f.html).rebindClose();b[f.id].layer=i;var j=i.getDomList().inner;b[f.id].wbml=a.widget.parse(j);b[f.id].wbml.init();a.custEvent.define(j,"bridge");a.custEvent.add(j,"bridge",g);a.custEvent.once(i,"show",function(){setTimeout(function(){var d=a.builder(i.getBox()).list,g=d.iframe&&d.iframe[0],h;if(g){b[f.id].iframe=h=a.lib.connect.iframe(g);h.on("insertIntoPublishTop",function(a,b,d,f){function g(a){return typeof a=="string"||a&&typeof a.substr=="function"}g(d)&&(d={text:d});e.insert("",{text:d.text,tip:d.tip||c("#L{}")})});h.on("setHeight",function(a,b,c,d){b.style.height=c+"px"});h.on("setWidth",function(a,b,c,d){b.style.width=c+"px"});h.on("close",function(a,b,c,d){i.hide();d("callback")});h.on("setTittle",function(b,c,d,e){var f=a.sizzle("div",i.getDomList().inner)[0]||null;f&&(f.innerHTML=d)});a.custEvent.add(i,"hide",function(){h.trigger("close")})}},10)});return i},destroy:function(){for(var a in b)i.remove(a)}};f.layers=b;f.add=i.add;f.remove=i.remove;f.destroy=i.destroy;return f}});
STK.register("lib.publisher.widget.plugin",function(a){var b=a.conf.trans.publisher;return function(c,d){d=a.parseParam({widget:c.nodeList.widget},d||{});var e={},f,g,h,i=!1,j={init:function(){f=a.delegatedEvent(d.widget);f.add("plugin","click",j.show)},show:function(b){c.API.setCurrentLogType(b.data.log);a.preventDefault();if(!i){i=!0;var d=a.fixEvent(a.getEvent()).target;a.contains(c.nodeList.widget,d)?h=d:h=c.nodeList.more;j.asynShow(b)}},asynShow:function(d){i=!1;g||(g=a.lib.sandbox.publishPluginBubble({insert:j.insert}));var e=function(){g.layers[f].layer.setArrow("top").show().setAlignPos(h,c.nodeList.textEl);setTimeout(function(){a.custEvent.add(c,"close",g.layers[f].layer.hide)},0)},f=d.data.type;g.layers[f]?e():b.request("interactive",{onSuccess:function(b){var c=a.lib.kit.extra.merge({html:b.data.html,id:f},d.data);g.add(c);e()},onError:function(b){a.lib.dialog.ioError(b.code,b)}},d.data)},insert:function(b,d){var e=c.API.getCurrentLogType();c.API.addShortUrlLog(e);c.API.insertText(d.text);a.ui.tip("lite",{msg:d.tip,type:"succ",timer:1e3})}};j.init();e.delegatedEvent=f;e.show=j.show;e.destroy=function(){f.destroy()};return e}});
STK.register("lib.image.uploadLog",function(a){return function(){var b={},c=function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),e=window.$CONFIG,f=a.lib.kit.extra.merge({cl:d,rnd:(new Date).getTime(),uid:e?e.uid:0,referer:encodeURIComponent(location),tm:+(new Date),ip:"",t:0},b);f.ret=="none"&&(f.err="10003");f=a.core.json.jsonToQuery(f);f="http://stats.t.sinaimg.cn/do_not_delete/fc.html?"+f;c.setAttribute("src",f)},d=function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),e=window.$CONFIG,f=a.lib.kit.extra.merge({rnd:(new Date).getTime(),uid:e?e.uid:0,cl:d,tm:+(new Date),ip:"",t:2,sz:0},b);f=a.core.json.jsonToQuery(f);f="http://stats.t.sinaimg.cn/do_not_delete/fc.html?"+f;c.setAttribute("src",f)};b.sendSucc=d;b.sendError=c;b.destroy=function(){};return b}});
STK.register("conf.trans.image",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("recmodlayer",{url:"/aj/photo/recomlayer?_wv=5",method:"get"});c("waterfall",{url:"http://photo.weibo.com/page/waterfall",method:"get",varkey:"callback",requestMode:"jsonp"});c("recmodlayer_new",{url:"/aj/v6/photo/morepic?_wv=5",method:"get"});c("hidetip",{url:"/aj/bubble/closebubble?_wv=5",method:"get"});c("followList",{url:"/aj/mblog/attention?_wv=5"});c("tagtopicList",{url:"/aj/photo/tag/recomtopic?_wv=5"});c("getTags",{url:"/aj/photo/tag/phototag?_wv=5"});c("viewTags",{url:"/aj/photo/tag/getphototag?_wv=5"});return b});
STK.register("lib.image.multiimage.taglist",function(a){var b='<div style="position:absolute;z-index:10000;" class="layer_menu_list" node-type="layer_outer"><ul node-type="suggestWrap"></ul></div>',c={"@":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" action-data="value=${list.screen_name}" value="${list.screen_name}" objid="1042:${list.uid}"><a href="javascript:;">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" suda-data="key=tblog_associate&value=list_${list_index+1}"action-data="value=${list.topic}" value="${list.topic}" objid="${list.object_id}"><a href="javascript:;">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'};return function(d,e){var f={},g,h,i,j=a.lib.kit.extra.language,k=a.conf.trans.image,l=0,m,n,o=a.parseParam({flag:"@"},e),p=d.value,q={"@":"followList","#":"tagtopicList"},r={"@":{normalTitle:j("#L{}"),moreTitle:j("#L{@}"),noTilte:j("#L{}"),tagTitle:j("#L{@}")},"#":{normalTitle:j("#L{}"),tagTitle:j("#L{}")}},s={rendHtml:function(b,d,e){d.title=r[b].tagTitle;var f=a.core.util.easyTemplate(c[b],d);return f},getList:function(){k.getTrans(q[o.flag],{onSuccess:function(b){var c=s.rendHtml(o.flag,b);a.custEvent.fire(i,"open",d);h.innerHTML=c}}).request({q:p});g.style.display="";s.setPos(g)},setPos:function(b){var c=a.position(d);b.style.top=c.t+30+"px";b.style.left=c.l-12+"px";b.style.display=""},checkValue:function(){if(a.trim(d.value)!=p){p=a.trim(d.value);s.getList()}}},t=function(){var c=a.core.dom.builder(b);g=c.list.layer_outer[0];document.body.appendChild(g);h=c.list.suggestWrap[0];i=a.ui.mod.suggest({textNode:d,uiNode:h,actionType:"item",actionData:"value"})},u={item:function(){},blur:function(){clearInterval(n);n=null;setTimeout(function(){a.custEvent.fire(i,"close")},200)},focus:function(){s.getList();!n&&(n=setInterval(function(){s.checkValue()},200))},enterkey:function(b){if(!!a.trim(d.value)){a.custEvent.fire(f,"createTag",{content:d.value,flag:o.flag,tag_object_id:0});i&&i.hide&&i.hide();d.value="";if(n){clearInterval(n);n=null}g.style.display="none";a.preventDefault(b)}},change:function(){var a=30;o.flag=="#"&&(a=100);d.value!=STK.core.str.leftB(d.value,a)&&(d.value=STK.core.str.leftB(d.value,a))}},v=function(){d.focus()},w=function(){a.custEvent.define(f,["createTag"]);a.custEvent.add(i,"onIndexChange",function(b,c){m=a.sizzle("li[class!=suggest_title]",h);m&&m[0]&&a.core.dom.removeClassName(m[l],"cur");a.core.dom.addClassName(m[c],"cur");l=c});a.custEvent.add(i,"onSelect",function(b,c,e,h){if(c==-1)u.enterkey();else{l=0;if(m[0]){var i=m[c].getAttribute("value")+"",j=m[c].getAttribute("objid");d.value=i}else var i=d.value,j=0;d.value="";if(n){clearInterval(n);n=null}g.style.display="none";a.custEvent.fire(f,"createTag",{content:i,flag:o.flag,tag_object_id:j})}});a.custEvent.add(i,"onClose",function(){if(n){clearInterval(n);n=null}g.style.display="none"});a.addEvent(d,"focus",u.focus);a.addEvent(d,"blur",u.blur);a.addEvent(d,"keydown",u.change);a.core.evt.hotKey.add(d,["enter"],u.enterkey)},x=function(){t();w()};x();f.show=v;f.destroy=function(){a.removeEvent(d,"focus",u.focus);a.removeEvent(d,"blur",u.blur);a.core.evt.hotKey.remove(d,["enter"],u.enterkey);g.style.display="none";i&&i.destroy&&i.destroy()};return f}});
STK.register("lib.image.multiimage.hastags",function(a){var b={};return function(){return{add:function(a){if(!!a){_tags=a.split(",");for(var c in _tags)b[_tags[c]]=!0}},check:function(a){return!!b[a]}}}});
STK.register("lib.image.multiimage.showtag",function(a){var b='<#et temp data><a  title="${data.content}" node-type="tag"  action-type="tag" <#if (data.url)>target="_blank" href="${data.url}" class="tag_showpic${data.offset}"<#else>href="javascript:void(0);" onclick="return false;" class="tag_showpic${data.offset} tag_disable"</#if> style="left:${data.left}px;top:${data.top}px;white-space: nowrap;"><span <#if (data.tag_uid)>usercard="id=${data.tag_uid}"</#if> class="inner"><#if (data.flag == "#")><i class="codetag">#</i><em class="W_autocut">${data.content}</em><i class="codetag">#</i></#if><#if (data.flag == "@")><i class="codetag">@</i><em <#if (data.tag_uid)>usercard="id=${data.tag_uid}"</#if> class="W_autocut">${data.content}</em></#if><#if (data.isshow != 1)><span action-type="removeTag" class="W_ficon ficon_close S_ficon" title="">X</span></span></a></#if></#et>',c={};return function(d){function l(b,c){if(!b)return!1;var e,f=0,g=b.getAttribute("src"),h=a.C("img");h.onload=function(){e=setInterval(function(){f++;f>10&&e&&clearInterval(e);b||e&&clearInterval(e);if(b.parentNode){e&&clearInterval(e);d.container=b.parentNode;c&&c()}},100)};g&&(h.src=g)}var e={},f=a.conf.trans.image,g=[],h=!0,i=function(a,b){if(!a||a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},j={getRPos:function(b,c,d){var e=a.position(b),f=a.position(c),g=a.core.dom.getSize(c),h={left:f.l-e.l+g.width*d.x-5,top:f.t-e.t+g.height*d.y-15};h={left:h.left>0?h.left:0,top:h.top>0?h.top:0};h.offset=d.x>.5?"R":"L";return h},offsetTar:function(b,c){if(c=="R"){var d=a.core.dom.getSize(b);b.style.marginLeft=0-d.width+12+"px"}else b.style.marginLeft=""},createTag:function(c,e){if(!!h){var f=a.core.util.easyTemplate(b,e).toString(),i=a.lib.kit.dom.parseDOM(a.builder(f).list);d.container.appendChild(i.tag);j.offsetTar(i.tag,e.offset);i.tag.setAttribute("tag-id",c);g.push(i.tag);d.from!="add"&&a.addEvent(i.tag,"click",j.stopEvent)}},fixData:function(b){for(var c in b){var e=j.getRPos(d.container,d.img,{x:b[c].pos_x,y:b[c].pos_y});e.flag={user:"@",topic:"#"}[b[c].tag_type]||"@";e.content=a.encodeHTML(b[c].tag_name);e.url=b[c].url;!d.fromLayer&&e.flag=="@"&&b[c].url&&(e.tag_uid=b[c].tag_id.replace("1042:",""));e.isshow=1;j.createTag(c,e)}j.bindEvent()},showtags:function(a){if(!!i(a||window.event,d.container)){if(d.img.style.cssText.toLowerCase().indexOf("filter")!=-1&&!d.fromLayer)return;if(d.container!=d.img.parentNode){j.hidetags();return}for(var b in g)g[b].style.display=""}},hidetags:function(a){if(!!i(a||window.event,d.container))for(var b in g)g[b].style.display="none"},bindEvent:function(){a.addEvent(d.container,"mouseover",j.showtags);a.addEvent(d.container,"mouseout",j.hidetags)},removetags:function(){var b=a.sizzle('[node-type="tag"]',d.container);for(var c in b)b[c]&&a.removeNode(b[c])},stopEvent:function(b){b=a.fixEvent(b);b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation()}},k=function(){},m=function(){if(!d.container){if(!d.img)return;d.container=d.img.parentNode}if(!d.tags){if(c[d.postdata.pid]){l(d.img,function(){j.fixData(c[d.postdata.pid])});return}if(!a.lib.image.multiimage.hastags().check(d.postdata.pid)&&!d.fromLayer)return;f.getTrans("viewTags",{onSuccess:function(a){for(var b in a.data){c[d.postdata.pid]=a.data[b].pic_tags;l(d.img,function(){j.fixData(a.data[b].pic_tags)})}},onError:function(a){c[d.postdata.pid]=[]}}).request(d.postdata)}else for(var b in d.tags)j.createTag(b,d.tags[b])};m();var n=function(){a.removeEvent(d.container,"mouseover",j.showtags);a.removeEvent(d.container,"mouseout",j.hidetags);j.hidetags();j.removetags();h=null;g=null};e.rend=k;e.destroy=n;return e}});
STK.register("lib.image.multiimage.addtags",function(a){var b=$CONFIG.imgPath,c='<div node-type="box"><div class="W_layer_title"></div><div class="layer_add_tag"><p class="tip"><em node-type="tagsCount" class="num">5</em></p><div node-type="container" class="need_pic addtag_cur"><img node-type="target" src="'+b+'style/images/common/loading.gif" alt="">'+'<span node-type="tag_menu" class="tag_addpic" style="display:none;z-index:10002;"><a href="javascript:;" action-type="at" class="inner_call" title="TA">@</a><a href="javascript:;" action-type="topic" class="inner_topic" title="">#</a></span>'+'<a href="javascript:void(0);" node-type="topic" class="tag_editpicL" style="display:none;z-index:10002;">#<input type="text" node-type="topicinput" class="" value="">#</a>'+'<a href="javascript:void(0);" node-type="at"  class="tag_editpicL" style="display:none;z-index:10002;">@<input node-type="atinput" type="text" class="" value=""></a>'+"</div>"+"</div>"+'<div class="W_layer_btn S_bg1">'+'<a href="javascript:;" action-type="ok" class="W_btn_a btn_34px"></a>'+'<a href="javascript:;" action-type="cancle" class="W_btn_b btn_34px"></a>'+"</div>"+"</div>"+"",d='<#et temp data><a node-type="tag" action-type="tag" href="javascript:void(0);" class="tag_showpic${data.offset}" style="left:${data.left}px;top:${data.top}px;white-space: nowrap;"><span class="inner"><#if (data.flag == "#")>#<em class="W_autocut">${data.content}</em>#</#if><#if (data.flag == "@")>@<em class="W_autocut">${data.content}</em></#if><span action-type="removeTag" class="W_ficon ficon_close S_ficon" title="">X</span></span></a></#et>';return function(b,e){var f={},g=a.conf.trans.image,h,i,j,k,l,m,n={},o=5,p={"#":"topic","@":"user"},q={getRPos:function(b,c,d){var e=a.position(b),f=a.position(c),g=a.core.dom.getSize(c),h={left:f.l-e.l+g.width*d.x-5,top:f.t-e.t+g.height*d.y-15};h={left:h.left>0?h.left:0,top:h.top>0?h.top:0};h.offset=d.x>.5?"R":"L";return h},panelHide:function(){i.at.style.display="none";i.tag_menu.style.display="none";i.topic.style.display="none"},offsetTar:function(b,c){if(c=="R"){b.style.marginLeft="-1000px";var d=a.core.dom.getSize(b);b.style.marginLeft=0-d.width+12+"px"}else b.style.marginLeft=""},createTag:function(b,c){var e=a.queryToJson(i.tag_menu.getAttribute("action-data"));e.content=c.content||"";e.tag=e.content;e.flag=c.flag;e.tag_type=p[c.flag];e.pos={x:e.x,y:e.y};e.tag_object_id=c.tag_object_id;var f=a.core.util.easyTemplate(d,e).toString(),g=a.lib.kit.dom.parseDOM(a.builder(f).list);q.panelHide();i.container.appendChild(g.tag);q.offsetTar(g.tag,e.offset);var h="tag_"+a.getUniqueKey();g.tag.setAttribute("tag-id",h);n[h]=e;q.getTagsCount()},setTags:function(b){a.custEvent.fire(f,"setTags",[n,b])},getTagsCount:function(){var a=0;for(var b in n)a++;i.tagsCount.innerHTML=o-a;return a}},r={topic:function(){var b=a.queryToJson(i.tag_menu.getAttribute("action-data"));i.topic.style.left=b.left+"px";i.topic.style.top=b.top+"px";i.topic.className="tag_editpic"+b.offset;q.offsetTar(i.topic,b.offset);q.panelHide();i.topic.style.display="";if(!m){m=a.lib.image.multiimage.taglist(i.topicinput,{flag:"#"});a.custEvent.add(m,"createTag",q.createTag)}m.show()},at:function(b){var c=a.queryToJson(i.tag_menu.getAttribute("action-data"));i.at.style.left=c.left+"px";i.at.style.top=c.top+"px";i.at.className="tag_editpic"+c.offset;q.offsetTar(i.at,c.offset);q.panelHide();i.at.style.display="";if(!l){l=a.lib.image.multiimage.taglist(i.atinput,{flag:"@"});a.custEvent.add(l,"createTag",q.createTag)}l.show()},tapimg:function(b){b=a.fixEvent(b);if(!(q.getTagsCount()>=o)){var c=a.position(b.target),d=a.core.dom.getSize(b.target),e={x:((b.pageX-c.l+11)/d.width).toFixed(2),y:((b.pageY-c.t+2)/d.height).toFixed(2)},f=q.getRPos(i.container,i.target,e);f.x=e.x;f.y=e.y;i.tag_menu.style.left=f.left+"px";i.tag_menu.style.top=f.top+"px";i.tag_menu.className="tag_addpic"+f.offset;q.offsetTar(i.tag_menu,f.offset);i.tag_menu.setAttribute("action-data",a.jsonToQuery(f));q.panelHide();i.tag_menu.style.display="";m&&m.hide&&m.hide();l&&l.hide&&l.hide()}},cancle:function(){k.hide();x()},removeTag:function(b){var c=a.core.dom.dir(b.el,{dir:"parent",expr:'[node-type="tag"]'})[0],d=c.getAttribute("tag-id");delete n[d];a.removeNode(c);q.getTagsCount();return!1},tag:function(a){i.container.appendChild(a.el)},ok:function(b){var c={};c[e.pid]=[];for(var d in n){var f=a.parseParam({tag:"",tag_type:"",tag_object_id:"",pos:{}},n[d]);c[e.pid].push(f)}if(!c[e.pid][0]){q.setTags(c);v()}else{var h={photo_tag:encodeURIComponent(a.jsonToStr(c))};g.getTrans("getTags",{onSuccess:function(a){q.setTags(a.data);v()},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(h)}}},s=function(){a.addEvent(i.target,"click",r.tapimg);j.add("at","click",r.at);j.add("topic","click",r.topic);j.add("cancle","click",r.cancle);j.add("removeTag","click",r.removeTag);j.add("tag","click",r.tag);j.add("ok","click",r.ok);a.custEvent.define(f,["setTags"])},t=function(){h=a.core.dom.builder(c);i=a.lib.kit.dom.parseDOM(h.list);j=a.core.evt.delegatedEvent(i.box);!k&&(k=a.ui.bubble());k.setContent("");k.setContent(i.box);k.setArrow("top").setAlignPos(b,e.refer,e);k.getOuter().style.zIndex=1e4},u=function(b,c){var d=a.lib.kit.extra.imageURL(b,{size:"bmiddle"});i.target.setAttribute("src",d);k.show();k.stopBoxClose()},v=function(){k.hide()},w=function(){t();s();u(e.pid);if(e.tags){var b=e.tags.split("|");for(var c in b){var d=a.getUniqueKey();n[d]=a.queryToJson(b[c]);n[d].pos={x:n[d].x,y:n[d].y}}a.lib.image.multiimage.showtag({container:i.container,img:i.img,tags:n,from:"add"});q.getTagsCount()}};w();var x=function(){a.removeEvent(i.target,"click",r.tapimg);j.remove("at","click",r.at);j.remove("topic","click",r.topic);j.remove("cancle","click",r.cancle);m&&m.destroy();l&&l.destroy();k.destroy();f=null};f.show=u;f.hide=v;f.destroy=x;return f}});
STK.register("lib.image.multiimage.preview",function(a){var b=$CONFIG.imgPath,c='<div class="" node-type="box"><div class="W_layer_title"></div>\t<div class="layer_pic_list clearfix">\t\t<div class="pic_list_count" node-type="picsInfo"></div>\t\t<ul class="drag_pic_list clearfix" node-type="preList">\t\t\t<li class="add" node-type="uploadBtn"><a href="javascript:;" title="">+</a></li>\t\t</ul>\t</div><div node-type="tagtip" class="layer_tips_version layer_tips_intro" style="display:none; left:-165px; top:56px;z-index:9999"><div class="layer_tips_bg"><a class="W_ico12 icon_close" action-type="hideTip" href="javascript:;"></a><div class="layer_tips_cont"><p><i class="ico_showtag"></i></p></div><span class="arrow_right"></span></div></div></div>',d='<#et image data><img src="${data.src}" alt=""><a action-type="editImg" href="javascript:;" class="ico_editpic"></a><a href="javascript:;" action-type="deleteImg" class="ico_delpic"></a><span class="tag"><a suda-data="key=pub_pic_upload&value=main_pub_tag" action-type="addTag" href="javascript:;" ></a></span><i style="display:none;" class="hastag"></i></#et>',e='<#et loading data><span class="txt S_txt1"><img class="picloading" src="'+b+'style/images/common/loading.gif">${data.filename}</span>'+'<a href="javascript:;" action-type="deleteImg"  title="" class="ico_delpic"></a>'+"</#et>",f='<#et image data><li class="loading" node-type="${data.type}">'+e+"</li>"+"</#et>",g='<#et err data><span class="txt S_txt1">${data.text}</span><span class="txt2 S_txt1">${data.filename}</span><a href="javascript:;" title="" action-type="deleteImg" class="ico_delpic"></a></#et>',h='<#et retry data><span class="txt S_txt1"><a class="W_btn_b" href="javascript:;" action-type="retryLoad" action-data="fid=${data.fid}"><span></span></a></span><a href="javascript:;" title="" action-type="deleteImg" class="ico_delpic"></a></#et>';return function(b,i){var j=a.parseParam({templete:c},i),k=9,l={},m,n,o,p,q,r,s={},t=a.lib.kit.extra.language,u=a.lib.image.uploadLog(),v={},w={init:function(){z.setNumInfo()},uploading:function(b,c){a.custEvent.fire(l,"loading");(!o||!o.getState())&&C();var d=b.data,e={},g=d.length;for(var h=0;h<g;h++){var i=z.getFileName(d[h].name);s[d[h].fid]={name:i};e[d[h].fid]={name:i}}var j="";for(var k in e)j+=a.core.util.easyTemplate(f,{type:k,filename:e[k].name||""});var m=a.builder(j),p=a.lib.kit.dom.parseDOM(m.list);for(var h in p)s[h].imgnode=p[h];a.insertBefore(m.box,n.uploadBtn);z.setNumInfo();x()},uploaded:function(b){var c=a.lib.kit.extra.imageURL(b.data.pid,{size:"square"});s[b.fid].pid=b.data.pid;var e=a.C("img");e.onload=function(){e.onload=null;if(s[b.fid]){s[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(d,{src:c});s[b.fid].imgnode.className="pic"}};e.src=c;s[b.fid].imgnode.setAttribute("action-data",b.data.pid);z.setExtra()},error:function(b){if(b.type=="singleError"){b.data.sourceData&&b.data.sourceData.code=="A20001"?s[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(g,{text:t("#L{}"),filename:s[b.fid].name||""}):s[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h,{fid:b.fid});s[b.fid].imgnode.className="opt";s[b.fid].err=1;z.setNumInfo()}if(b.type=="fileNumErr")return z.getReFileNum();b.type=="fileSizeErr"&&setTimeout(function(){var c=b.data.sizeErrAry.length;for(var d=0;d<c;d++){var e=a.getUniqueKey();w.uploading({data:[{fid:e,name:b.data.sizeErrAry[d]||""}]});s[e].imgnode.innerHTML=a.core.util.easyTemplate(g,{text:t("#L{20M}"),filename:s[e].name||""});s[e].imgnode.className="opt";s[e].err=1}z.setNumInfo()},30);if(b.type=="defaultErr"){s[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(g,{text:t("#L{}"),filename:s[b.fid].name||""});s[b.fid].imgnode.className="opt";s[b.fid].err=1;z.setNumInfo()}},extra:function(a){a.type=="beclicked"&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_new_image_upload","fast_upload")}},x=function(){q||(q=a.lib.image.mUpload(n.uploadBtn,{h:80,w:80,number:z.getReFileNum(),init:w.init,uploading:w.uploading,uploaded:w.uploaded,error:w.error,extra:w.extra}))},y={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a)},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},z={getExtraInfo:function(a,b){var c=z.getImgNode(a);return c?c.getAttribute(b):null},getImgNode:function(a){if(a==document.body)return null;if(a.tagName.toLowerCase()=="li")return a;a=a.parentNode;return arguments.callee(a)},setExtra:function(){var b="";for(var c in s){if(s[c]&&!s[c].pid&&!s[c].err)return;s[c]&&s[c].pid&&(b+=s[c].pid+" ")}y.store(b);a.custEvent.fire(l,"setExtra",{pids:b,text:t("#L{}")})},getNumInfo:function(){var a=0;for(var b in s)s[b]&&!s[b].err&&a++;return a},setNumInfo:function(){var a=z.getNumInfo();if(a<k){n.uploadBtn.style.cssText="";n.picsInfo.innerHTML=t('#L{%s%s}<em class="S_txt2">#L{ctrl}</em>',a,k-a)}else{n.uploadBtn.style.cssText="margin-left:-10000px;";n.picsInfo.innerHTML=t('<em class="error_txt">#L{9}</em>')}try{q&&q.getswf()&&q.getswf().resetFileNum&&q.getswf().resetFileNum(k);q&&q.getswf()&&q.getswf().resetFileNum&&q.getswf().resetUploadedFileNum(z.getNumInfo())}catch(b){}},getReFileNum:function(){var a=z.getNumInfo();return k-a>0?k-a:0},getFileName:function(b,c){var b=b||"",c=c||8,d=b.length,e=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**"),f=e.slice(e.length-c-1,e.length).replace(/\*\*/g," ").replace(/\*/g,"").length;if(e.length>c&&c>0&&d-f-1>0){b=b.slice(d-f-1,d);b="..."+b}return a.encodeHTML(b)}},A={editImg:function(b){a.preventDefault();var c=z.getExtraInfo(b.el,"node-type"),d=z.getExtraInfo(b.el,"action-data"),e=function(a){w.uploaded({data:{pid:a},fid:c})};if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash();else{var f={id:"photo_editor",pos:o.getPosition(),service:"http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:e,h:385,w:528,swf:"PhotoEditor.swf"};a.lib.image.imgUpload(f,{init:function(b,c){b.setPars(a.lib.kit.extra.imageURL(d,{size:"large"}))},close:function(a,b){}}).show()}},deleteImg:function(b){var c=z.getImgNode(b.el),d=c.getAttribute("node-type"),e=c.getAttribute("action-data");s&&s[d]&&(s[d]=null);z.setExtra();z.setNumInfo();a.removeNode(c);q.removeFile(d);u.sendError({t:1,err:1008,app:1001});delete v[e];a.custEvent.fire(l,"setTags",{tags:a.jsonToStr(v)})},retryLoad:function(b){var c=b.data.fid;s[c].imgnode.innerHTML=a.core.util.easyTemplate(e,{filename:s[c].name||""});s[c].imgnode.className="loading";q&&q.getswf()&&q.getswf().reuploadById&&q.getswf().reuploadById(c)},close:function(){o.hide()},sendData:function(){u.sendError({t:1,err:1008,app:1001})},addTag:function(c){var d=z.getExtraInfo(c.el,"action-data");i.pid=d;i.tags=c.el.getAttribute("tags");addTag=a.lib.image.multiimage.addtags(b,i);a.custEvent.add(addTag,"setTags",function(b,e,f){var g=[];for(var h in e){e[h].pid=d;g.push(a.jsonToQuery(e[h]))}c.el.setAttribute("tags",g.join("|"));if(g[0]){c.el.innerHTML=t('<i class="icon_imgtag"></i>#L{}');var i=a.core.dom.dir(c.el.parentNode,{dir:"next",expr:"i.hastag"});i[0]&&(i[0].style.display="")}else{c.el.innerHTML=t("#L{}");var i=a.core.dom.dir(c.el.parentNode,{dir:"next",expr:"i.hastag"});i[0]&&(i[0].style.display="none")}for(var h in f){v[h]=f[h];f[h][0]||delete v[h]}a.custEvent.fire(l,"setTags",{tags:a.jsonToStr(v)})});A.hideTip()},hideTip:function(){n.tagtip.style.display="none";a.conf.trans.image.getTrans("hidetip",{onSuccess:function(){n.tagtip.style.display="none"},onError:function(){}}).request({bid:55})}},B=function(){p.add("editImg","click",A.editImg);p.add("deleteImg","click",A.deleteImg);p.add("retryLoad","click",A.retryLoad);p.add("addTag","click",A.addTag);p.add("hideTip","click",A.hideTip);a.addEvent(r,"click",A.sendData);a.custEvent.define(l,["setTags","setExtra","hide","insert","deletePIC","picLoad","loading"]);a.custEvent.add(o,"hide",function(){for(var b in s)try{s[b]&&s[b].imgnode&&a.removeNode(s[b].imgnode);q.removeFile(b);s[b]=null}catch(c){}v={};a.custEvent.fire(l,"setTags",{tags:a.jsonToStr(v)});s={};z.setExtra();a.custEvent.fire(l,"hide",{});dragRank&&dragRank.destroy();dragRank=null})},C=function(){if(o)o.setArrow("top").setAlignPos(b,i.refer,i);else{o=a.ui.bubble({showWithAni:null,hideWithAni:null});o.setContent(n.box);o.setArrow("top").setAlignPos(b,i.refer,i);r=o.getDomList().close;a.custEvent.add(o,"hide",function(){for(var b in s)try{s[b]&&s[b].imgnode&&a.removeNode(s[b].imgnode);q.removeFile(b);s[b]=null}catch(c){}s={};z.setExtra();a.custEvent.fire(l,"hide",{})})}},D=function(){m=a.core.dom.builder(j.templete);n=a.lib.kit.dom.parseDOM(m.list);p=a.core.evt.delegatedEvent(n.box)},E=function(){o&&o.setAlignPos(b,i.refer,i)},F=function(){o.show()},G=function(){o.startBoxClose();o.hide()},H=function(){D();B()},I=function(){},J=function(){},K=function(){var a=z.getNumInfo();return a<k?!1:!0},L=function(a){return n[a]||null};H();var M=function(){o.hide();o.destroy&&o.destroy();p.destroy();a.removeEvent(r,"click",A.sendData);s=null;o=null};l.destroy=M;l.uploading=w.uploading;l.uploaded=w.uploaded;l.error=w.error;l.extra=w.extra;l.show=F;l.hide=G;l.isOutstanding=K;l.getNumInfo=z.getNumInfo;l.getDomList=L;return l}});
STK.register("lib.publisher.widget.imgPreview",function(a){return function(b){var c,d={},e={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a||"")},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},f=function(a,c){var d=b.API.getImageLogType();b.API.addShortUrlLog(d);b.API.insertText(c.value);image.getBub().hide()},g=function(a,c){b.API.addExtraInfo(c.pids);e.store(c.pids);if(c.pids=="")b.API.delWords(c.text);else{var d=b.API.getWords();d.length==0&&b.API.insertText(c.text)}},h=function(a,c){c.tags=="{}"?b.nodeList.textEl.removeAttribute("tags"):b.nodeList.textEl.setAttribute("tags",encodeURIComponent(c.tags))},i=function(){var d=a.sizzle('a[action-type="multiimage"]',b.nodeList.widget);if(!!d[0]){var e=b.nodeList.textEl;c=a.lib.image.multiimage.preview(d[0],{refer:e});j();b.getPreview=function(){return c}}},j=function(){a.custEvent.add(c,"setExtra",g);a.custEvent.add(c,"insert",f);a.custEvent.add(c,"setTags",h)};i();var k=function(){if(c){a.custEvent.remove(c,"setExtra",g);a.custEvent.remove(c,"insert",f);c.destroy()}};d.destroy=k;return d}});
STK.register("lib.publisher.widget.widgetloader",function(a){var b=a.lib.publisher.widget;return function(c,d){d=a.parseParam({widget:c.nodeList.widget,devent:""},d||{});var e={},f,g,h,i={list:["face","image","multiimage"],entity:{},widgetList:{},func:function(a){return function(d){d.data.isimage?c.API.setImageLogType(d.data.log):c.API.setCurrentLogType(d.data.log);i.widgetList[a]||(i.widgetList[a]=b[a](c));i.widgetList[a].show()}}},j={init:function(){j.bind()},bind:function(){a.custEvent.define(c,"close");f=d.devent?d.devent:a.delegatedEvent(d.widget);for(var e=0,j=i.list.length;e<j;e++){var k=i.list[e];i.entity[k]=i.func(k);f.add(k,"click",i.entity[k])}g=b.plugin(c,d);h=b.imgPreview(c)},close:function(){a.custEvent.fire(c,"close",{type:"publish"})},destroy:function(){for(var a=0,b=i.list.length;a<b;a++){var c=i.list[a];f.remove(c,"click",i.entity[c])}for(var d in i.widgetList)i.widgetList[d].destroy&&i.widgetList[d].destroy();g.destroy();h.destroy()}};j.init();e.close=j.close;e.destroy=j.destroy;return e}});
STK.register("lib.editor.plugin.morePlugin",function(a){var b=a.lib.kit.extra.language;return function(b){var c={},d,e,f,g,h=!1,i={number:4,defNumber:2},j={list:[],data:{},add:function(a){var b=a.type;j.data[b]=a},destroy:function(){j.list=[];j.data={}}},k,l={init:function(){var c=a.queryToJson(b.nodeList.widget.getAttribute("node-data")||"");i=a.parseParam(i,c);l.buildMenu()},showMenu:function(b){e.style.display="";e.style.zIndex="10000";var c=a.position(b),d=a.core.dom.getSize(b);a.core.dom.setXY(e,{t:c.t+d.height+3,l:c.l-5});a.ui.effect(e,"fadeInDown","fast");window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("tblog_home_edit",'unfold_more"')},hideMenu:function(){a.ui.effect(e,"fadeOutUp","fast",function(){e.style.display="none"})},buildMenu:function(){e=b.nodeList.morePlugin;if(!!e){document.body.appendChild(e);e.style.position="absolute";a.lib.publisher.widget.widgetloader(b,{widget:e});l.menuEvt()}},menuEvt:function(){a.addEvent(e,"click",l.hideMenu)},destroy:function(){a.removeEvent(e,"click",l.hideMenu);d&&d.destroy()}};l.init();c.menu=e;c.show=l.showMenu;c.hide=l.hideMenu;c.destroy=l.destroy;return c}});
STK.register("lib.kit.dom.hover",function(a){function b(b,c){var d=c.length;while(d--)if(c[d]===b||a.contains(c[d],b))return!0;return!1}var c={};return a.lib.kit.touch.cantouch?function(d){var e=d.act,f=d.extra||[],g=function(a){d.onmouseover.apply(e,[a])},h=function(a){d.onmouseout.apply(e,[a])},i=function(c,d){b(a.fixEvent(d).target,[e].concat(f))?g(d):h(d)};if(!("inited"in c)){c.inited=!0;a.custEvent.define(c,["tap"]);a.addEvent(document.body,"tap",function(b){a.custEvent.fire(c,"tap",b)})}a.custEvent.add(c,"tap",i);return{destroy:function(){a.removeEvent(document.body,"tap",i)}}}:function(b){var c=b.delay||300,d=b.moutDelay||c,e=b.isover||!1,f=b.act,g=b.extra||[],h=null,i=function(a){e&&b.onmouseover.apply(f,[a])},j=function(a){e||b.onmouseout.apply(f,[a])},k=function(a){e=!0;h&&clearTimeout(h);h=setTimeout(function(){i(a)},c)},l=function(a){e=!1;h&&clearTimeout(h);h=setTimeout(function(){j(a)},d)};a.core.evt.addEvent(f,"mouseover",k);a.core.evt.addEvent(f,"mouseout",l);for(var m=0,n=g.length;m<n;m+=1){a.core.evt.addEvent(g[m],"mouseover",k);a.core.evt.addEvent(g[m],"mouseout",l)}var o={};o.destroy=function(){a.core.evt.removeEvent(f,"mouseover",k);a.core.evt.removeEvent(f,"mouseout",l);for(var b=0,c=g.length;b<c;b+=1){a.core.evt.removeEvent(g[b],"mouseover",k);a.core.evt.removeEvent(g[b],"mouseout",l)}};return o}});
STK.register("lib.editor.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return b(a)}});
STK.register("lib.editor.editor",function(a){var b=a.addEvent,c=a.removeEvent,d=a.custEvent,e=a.getStyle,f=a.setStyle,g=a.lib.kit.dom.parseDOM,h=a.lib.kit.extra.textareaUtils,i=a.lib.editor.count;return function(e,f){var j={},f=f,k={},l="",m="",n="",o={reset:function(){k.textEl.value="";d.fire(j,"changed");k.textEl.removeAttribute("extra");l=m=n=""},delWords:function(a){var b=o.getWords();if(!(b.indexOf(a)>-1))return!1;k.textEl.value="";q.textInput(b.replace(a,""))},getWords:function(){return a.core.str.trim(k.textEl.value)},getExtra:function(){var b,c=k.textEl.getAttribute("extra")||"";c!=null&&(b=a.core.str.trim(c));return b},focus:function(a,b){if(typeof a!="undefined")h.setCursor(k.textEl,a,b);else{var c=k.textEl.value.length;h.setCursor(k.textEl,c)}p.cacheCurPos()},blur:function(){k.textEl.blur()},addExtraInfo:function(a){typeof a=="string"&&k.textEl.setAttribute("extra",a)},disableEditor:function(a){c(k.textEl,"mouseup",p.cacheCurPos);if(a===!0)k.textEl.setAttribute("disabled","disabled");else{b(k.textEl,"mouseup",p.cacheCurPos);k.textEl.removeAttribute("disabled")}},getCurPos:function(){var a=k.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(k.textEl.value).length==0?a.core.str.trim(k.textEl.value):k.textEl.value;return i(b)},addShortUrlLog:function(b){b=b&&a.trim(b);if(b){var c=new RegExp("^"+b+"$|"+"_"+b+"$|^"+b+"_|"+"_"+b+"_");c.test(l)||(l?l=l+"_"+b:l=b)}},getShortUrlLog:function(){return l},setCurrentLogType:function(a){m=a},getCurrentLogType:function(){return m},setImageLogType:function(a){n=a},getImageLogType:function(){return n}},p={textElFocus:function(){k.recommendTopic&&a.core.dom.setStyle(k.recommendTopic,"display","none");d.fire(j,"focus");k.num&&a.core.dom.setStyle(k.num,"display","");o.getWords()==f.tipText&&o.delWords(f.tipText)},textElBlur:function(){setTimeout(function(){if(k.textEl.value.length===0){k.recommendTopic&&a.core.dom.setStyle(k.recommendTopic,"display","");k.num&&k.recommendTopic&&a.core.dom.setStyle(k.num,"display","none");typeof f.tipText!="undefined"&&(k.textEl.value=f.tipText)}d.fire(j,"blur")},50)},cacheCurPos:function(){var b=h.getSelectedText(k.textEl),c=b==""||b==null?0:b.length,d=a.core.dom.textSelectArea(k.textEl).start,e=d+"&"+c;k.textEl.setAttribute("range",e)}},q={textChanged:function(){d.fire(j,"keyUpCount")},textInput:function(a,b){var c=o.getCurPos(),b=c[0],e=c[1];o.getWords()==f.tipText&&a!=f.tipText&&o.delWords(f.tipText);h.unCoverInsertText(k.textEl,a,{rcs:c[0],rccl:c[1]});p.cacheCurPos();d.fire(j,"changed")}},r={},s=function(){v();w()},t=function(){x();z();A();u()},u=function(){f.storeWords?k.textEl.value.length==0&&q.textInput(f.storeWords):f.tipText&&(k.textEl.value=f.tipText)},v=function(){if(!e)throw"node is not defined in module editor"},w=function(){var b=a.core.dom.builder(e).list;k=g(b);if(!k.widget)throw"can not find nodes.widget in module editor"},x=function(){var a=k.textEl;b(a,"focus",p.textElFocus);b(a,"blur",p.textElBlur);b(a,"mouseup",p.cacheCurPos);b(a,"keyup",p.cacheCurPos)},y=function(){d.define(j,["changed","focus","blur"])},z=function(){y();d.add(j,"changed",q.textChanged)},A=function(){},B=function(){d.remove(j);d.undefine(j);var a=k.textEl;c(a,"focus",p.textElFocus);c(a,"blur",p.textElBlur);c(a,"mouseup",p.cacheCurPos);c(a,"keyup",p.cacheCurPos)};s();var C={reset:o.reset,getWords:o.getWords,getExtra:o.getExtra,delWords:o.delWords,focus:o.focus,blur:o.blur,insertText:q.textInput,check:q.textChanged,addExtraInfo:o.addExtraInfo,disableEditor:o.disableEditor,getCurPos:o.getCurPos,count:o.count,textElFocus:p.textElFocus,cacheCurPos:p.cacheCurPos,addShortUrlLog:o.addShortUrlLog,getShortUrlLog:o.getShortUrlLog,setCurrentLogType:o.setCurrentLogType,getCurrentLogType:o.getCurrentLogType,setImageLogType:o.setImageLogType,getImageLogType:o.getImageLogType};j.destroy=B;j.API=C;j.nodeList=k;j.init=t;j.opts=f;return j}});
STK.register("lib.editor.base",function(a){var b=a.lib.editor.service,c=a.lib.editor.plugin,d;return function(b,e){var f={},g,h,i,j;e=a.lib.kit.extra.merge({limitNum:140},e);var k=function(b){var c=a.fixEvent(b).target;if(a.contains(i.nodeList.more,c)||c==i.nodeList.more){l.showMenu();var d=a.lib.kit.dom.firstChild(i.nodeList.more);d&&a.addClassName(d,"W_arrow_turn")}else{l.hideMenu();var d=a.lib.kit.dom.firstChild(i.nodeList.more);d&&a.removeClassName(d,"W_arrow_turn")}},l={init:function(){l.build();l.bind()},build:function(){i=a.lib.editor.editor(b,e);d=i.nodeList;j=c.at(i,e);(typeof e.count=="undefined"||e.count=="enable")&&c.count(i);var f=c.sucTip(i,e),g=c.score(i,e);h=c.morePlugin(i,e);j.init();i.init();f.init()},bind:function(){i.nodeList.more&&a.addEvent(document.body,"click",k)},showMenu:function(){h.show(i.nodeList.more)},hideMenu:function(){h.hide()},destroy:function(){i.destroy&&i.destroy();j.destroy&&j.destroy();h.destroy()},closeWidget:function(){}};l.init();f.editor=i;f.nodeList=d;f.destroy=l.destroy;f.closeWidget=l.closeWidget;return f}});
STK.register("lib.comment.commentMsg",function(a){return{noPhoneReplyMsg:'#L{}<br><a href="http://account.weibo.com/settings/mobile" target="_blank">#L{}</a>#L{}',noPowerReplyMsg:"#L{}"}});
STK.register("lib.comment.commentTemp",function(a){function b(b){var b="LAB_"+a.getUniqueKey();return'<div node-type="commentwrap" class="WB_repeat_in S_bg2"><div class="WB_feed_publish clearfix"><div class="WB_publish"> <div class="p_input"><textarea node-type="textEl" class="W_input"></textarea></div><div class="p_opt clearfix"> <div class="btn W_fr"><a node-type="btnText" action-type="doReply" href="javascript:;" class="W_btn_a W_btn_a_disable">#L{}</a></div> <div node-type="widget" class="opt clearfix"> <span class="ico"><a node-type="smileyBtn" href="javascript:;"><i class="W_ficon ficon_face">o</i></a></span> <ul class="ipt"><li><label class="W_label" for="'+b+'"><input node-type="forward" name="" type="checkbox" value="" class="W_checkbox" id="'+b+'"><span>#L{}</span></label></li>'+" </ul>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+""}return{reply:b("LAB_"+a.getUniqueKey()),getReply:b}});
STK.register("lib.kit.extra.keySubmit",function(a){function f(c,e){var f=a.core.dom.uniqueID(c);if(f in b){var g=a.core.arr.indexOf(e,b[f]);g>=0&&b[f].splice(g,1);if(b[f].length==0){delete b[f];a.removeEvent(c,"keydown",d)}}}function e(c,e){var f=a.core.dom.uniqueID(c);if(f in b)a.core.arr.inArray(e,b[f])||b[f].push(e);else{b[f]=[e];a.addEvent(c,"keydown",d)}}function d(d){d=a.fixEvent(d);var e=a.core.dom.uniqueID(d.target),f=d.keyCode===13||d.keyCode===10;f&&(c&&d.metaKey||!c&&d.ctrlKey)&&b[e]&&a.foreach(b[e],function(a){a(d)})}var b={},c=a.core.util.browser.OS==="macintosh";return{on:e,off:f}});
STK.register("lib.comment.reply",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.comment,d=a.core.dom.setStyle,e=a.core.dom.getStyle,f=a.core.evt.preventDefault,g=a.lib.kit.extra.setPlainHash,h=[],i={},j={reply:b("#L{}"),alert:b("#L{}"),success:b("#L{}"),block:b("#L{}")},k=new RegExp(["^",j.reply,"@([^:]*):"].join("")),l=function(a,c){!a||(c=="normal"?a.innerHTML=b("#L{}"):a.innerHTML=b("#L{...}"))},m=function(b,c){var e={},f,h,i,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;a.custEvent.define(e,["reply"]);var D=a.core.evt.delegatedEvent(b),E={add_success:function(c){A=0;p.className="W_btn_a btn_noloading";l(r,"normal");h.API.reset();h.API.insertText(v);h.API.blur();d(b,"display","none");c.forward=s;a.custEvent.fire(e,"reply",[c]);a.ui.tip("lite",{msg:j.success,type:"succM",timer:"500"})},add_fail:function(a){A=0;p.className="W_btn_a btn_noloading";l(r,"normal")},add_error:function(a){A=0;p.className="W_btn_a btn_noloading";l(r,"normal")}},F=function(){t=a.core.str.trim(o.value);t==v||t==""?!a.hasClassName(p,"W_btn_a_disable")&&a.addClassName(p,"W_btn_a_disable"):a.hasClassName(p,"W_btn_a_disable")&&a.removeClassName(p,"W_btn_a_disable")},G=function(b){if(!A){A=1;a.core.evt.preventDefault();s=n.checked?1:0;t=a.core.str.trim(o.value);w=t.match(k);if(t==v||t==""){a.ui.tipAlert(j.alert,{icon:"rederrorS"}).beside(o);A=0;o.focus();!a.hasClassName(p,"W_btn_a_disable")&&a.addClassName(p,"W_btn_a_disable")}else{if(!w||!w[1]||w[1]!=u)c.cid=u=null;t=a.leftB(t,280);c.content=t;x=a.lib.kit.extra.getDiss(a.lib.kit.extra.merge(c,{act:"reply",content:t,forward:s,isroot:0}),b.el);b&&b.el?b.el.className="W_btn_a W_btn_a_disable":p&&(p.className="W_btn_a W_btn_a_disable");l(r,"loading");g("_rnd"+(+(new Date)).toString());i=a.lib.comment.inter(E,x);x=a.lib.kit.extra.merge(b.data,x);i.post(x)}}};n=a.sizzle('[node-type="forward"]',b)[0];o=a.sizzle('[node-type="textEl"]',b)[0];p=a.sizzle('[action-type="doReply"]',b)[0];r=a.sizzle('[node-type="btnText"]',b)[0];C=a.sizzle('[node-type="smileyBtn"]',b)[0];z=a.core.json.jsonToQuery(c);p.setAttribute("action-data",z);u=c.content;v=[j.reply,"@",u,":"].join("");try{f=a.lib.editor.base(b,{count:"disable"});h=f.editor;a.custEvent.define(h,"close");var B=a.lib.publisher.widget.face(h)}catch(H){console.log(H)}y=h.API.getWords();y==""?h.API.insertText(v):h.API.insertText("");D.add("doReply","click",G);a.addEvent(C,"click",B.show);a.lib.kit.extra.keySubmit.on(o,G);m=setInterval(function(){F()},200);a.lib.kit.dom.autoHeightTextArea({textArea:o,maxHeight:9999,inputListener:function(){var b=a.trim(o.value);a.bLength(b)>280&&(o.value=a.leftB(b,280))}});e.focus=function(){h.API.insertText("")};e.destroy=function(){a.removeEvent(C,"click",B.show);D&&D.destroy&&D.destroy();clearInterval(m);a.lib.kit.extra.keySubmit.off(o,G)};return e},n=function(b,c){var d=a.core.arr.indexOf(b,h);if(!i[d]){h[d=h.length]=b;i[d]=m(b,c)}return i[d]};return function(b,c){(!c||!c.mid)&&a.log("lib.comment/reply.js-------mid is not defined");return n(b,c)}});
STK.register("lib.comment.comment",function(a){var b=a.lib.comment.commentMsg,c=a.lib.comment.commentTemp,d=a.lib.kit.extra.setPlainHash,e=a.lib.comment.reply,f="",g=[],h={},i=a.ui.alert,j=a.lib.kit.extra.language,k=a.custEvent,l=k.fire,m=null,n=null,o=a.conf.trans.feed.comment,p={content:j("#L{}"),"delete":j("#L{}"),reply:j("#L{}"),blcok:j("#L{}"),unReply:j(b.noPhoneReplyMsg),unPower:j(b.noPowerReplyMsg)},q=function(b,g){var h,i,q=g.mid,r,s,t,u,v,w,x,y,z,A,B,C,D=new RegExp(["^",p.reply,"@([^:]*):(.*)"].join("")),E=a.core.str,F={},G,H=g.isMain,I=function(c){var e=a.trim(v.value),i=e.match(D);if(e==""||i&&a.trim(i[2])==""){a.ui.tipAlert(p.content,{icon:"rederrorS"}).beside(v);v.focus()}else{if(!i||!i[1]||i[1]!=u)s=u=null;var k;c&&c.el?k=c.el:k=a.sizzle('[action-type="post"]',b)[0];f=k.innerHTML;k.className="W_btn_a W_btn_a_disable";k.innerHTML=j("#L{...}");d("_rnd"+(+(new Date)).toString());var l=a.lib.kit.extra.getDiss({act:i?"reply":"post",cid:s,content:E.leftB(e,280),isroot:y&&y.checked?"1":"0",forward:w&&w.checked?"1":"0",appkey:g.appkey,mark:g.mark},c.el);l=a.core.json.merge(l,c.data);h.post(l)}},J=function(b){var d=b.el,f=b.data.cid,g=b.data.nick,h=a.core.dom.dir(d,{dir:"parent",expr:'[node-type="replywrap"]',matchAll:!1})[0],i=a.core.dom.dir(d,{dir:"parent",expr:"li",matchAll:!1})[0],k=d.getAttribute("status"),l=F[f]&&F[f].DOM,m=l?a.core.dom.contains(document.body,l):!1;if(l&&a.getStyle(l,"display")!="none"&&m){a.setStyle(l,"display","none");i&&a.removeClassName(i,"curr")}else{if(!l||!m){l=a.builder(j(c.getReply())).list.commentwrap[0];if(b.data.feed_type==="sub_feed"){a.removeClassName(l,"S_bg2");a.addClassName(l,"S_bg1")}h.appendChild(l);F[f]={handle:e(l,a.lib.kit.extra.merge(b.data,{mid:q,cid:f,content:g,module:"scommlist"})),DOM:l};w&&a.core.dom.dir.parent(w,{expr:"li"})[0].style.display==="none"&&(a.core.dom.neighbor(l).child("[node-type=forward]").parent("li").finish().style.display="none");a.custEvent.add(F[f].handle,"reply",function(){i&&a.removeClassName(i,"curr");L.apply(null,arguments)})}i&&a.addClassName(i,"curr");a.setStyle(l,"display","");F[f]&&F[f].handle.focus()}},K=a.core.evt.delegatedEvent(b);K.add("post","click",I);K.add("reply","click",function(b){var c=b.el;if(a.core.dom.hasClassName(c,"unclick_rep")){if(m){m.aniHide&&m.aniHide();m.destroy&&m.destroy();m=null}var d=c.getAttribute("isPhone");d?m=a.ui.tip("alert",{msg:p.unReply,type:"warn"}):m=a.ui.tip("alert",{msg:p.unPower,type:"warn"});m.setLayerXY(c);m.aniShow();n&&window.clearTimeout(n);n=window.setTimeout(function(){m.aniHide&&m.aniHide();m.destroy&&m.destroy();m=null},3e3)}else b.data&&b.data.ispower=="1"?o.request("isComment",{onComplete:function(d){if(d.code=="100000"){var e,f,g;(e=b.data)&&(f=e.nick)&&J(b)}else{if(m){m.aniHide&&m.aniHide();m.destroy&&m.destroy();m=null}if(d.code=="100022")m=a.ui.tip("alert",{msg:p.unPower,type:"warn"});else if(d.code=="100001"){c&&c.setAttribute("isphone","1");m=a.ui.tip("alert",{msg:p.unReply,type:"warn"})}else m=a.ui.tip("alert",{msg:d.msg,type:"warn"});m.setLayerXY(c);m.aniShow();a.addClassName(c,"unclick_rep");n&&window.clearTimeout(n);n=window.setTimeout(function(){m.aniHide&&m.aniHide();m.destroy&&m.destroy();m=null},3e3)}}},b.data):J(b)});K.add("delete","click",function(b){var c=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',p.blcok,"</label>"].join(""):"",d=a.ui.tipConfirm([p["delete"],c]).ok(function(a){var c=d.getDomList(!0).block_user&&d.getDomList(!0).block_user.checked,e,f;(e=b.data)&&(f=e.cid)&&h.del({act:"delete",cid:f,is_block:c?"1":"0"})}).beside(b.el)});a.conf.channel.feed.register("reply",function(a){a.cid==t&&M(a.ret)});var L=function(a,b){M(b)},M=function(c){var d=c.data;if(!d)return!1;s=u=null;r+=1;typeof H=="undefined"&&d.comment&&z&&a.insertHTML(z,d.comment,"afterend");l(i,"count",r);l(i,"comment",{count:r,html:d.comment});if(d.feed){l(i,"feed");a.conf.channel.feed.fire("forward",{html:d.feed})}N.changeSubmitBtn();a.removeNode(a.sizzle(".WB_empty",b)[0]);return!0},N={changeSubmitBtn:function(){var c=a.sizzle("[node-type='btnText']",b)[0],d=a.sizzle("a[action-type='post']",b)[0];d.className="W_btn_a btn_noloading";f&&(c.innerHTML=f)},add_success:function(a,b){if(M(a)){v.value="";v.focus()}},add_fail:function(){N.changeSubmitBtn()},add_error:function(){N.changeSubmitBtn()},delete_success:function(c,d){r=Math.max(r-1,0);l(i,"count",r);var e=a.sizzle(["[comment_id=",d.cid,"]"].join(""),b)[0];e&&e.parentNode.removeChild(e);l(i,"del",{commont_id:d.cid})},delete_fail:function(a,b){},checkIsEmpty:function(){var c=new RegExp(["^",p.reply,"@([^:]*):(.*)"].join("")),d=a.sizzle("[node-type='btnText']",b)[0],e=a.trim(v.value),f=e.match(c);d&&(e==""||f&&a.trim(f[2])==""?!a.hasClassName(d,"W_btn_a_disable")&&a.addClassName(d,"W_btn_a_disable"):a.hasClassName(d,"W_btn_a_disable")&&a.removeClassName(d,"W_btn_a_disable"))},smallList_success:function(c,d){d.focus=d.focus||!0;var e=c.data;if(!!e){e.html&&(b.innerHTML=e.html);d.filter!==4?l(i,"count",[r=e.count*1||0]):l(i,"count",[r=d.count*1||0]);v=a.sizzle("textarea",b)[0];setTimeout(function(){v&&a.lib.kit.dom.autoHeightTextArea({textArea:v,maxHeight:9999,inputListener:function(){var b=a.trim(v.value);E.bLength(b)>280&&(v.value=E.leftB(b,280))}});if(v)try{A=a.lib.editor.base(b,f);B=A.editor;a.custEvent.define(B,"close");var c=a.lib.publisher.widget.face(B),e=a.sizzle('[node-type="smileyBtn"]',b)[0];a.addEvent(e,"click",c.show);x=setInterval(function(){N.checkIsEmpty()},200);d.focus&&a.core.dom.selectText(v,{start:0});d.focus&&v.focus()}catch(g){}},25);w=a.sizzle("input[name=forward]",b)[0];y=a.sizzle("input[name=isroot]",b)[0];z=a.sizzle("div[node-type=commentList]",b)[0];a.lib.kit.extra.keySubmit.on(v,I);var f={count:"disabled"}}},smallList_error:function(a,b){l(i,"requesterror")}};h=a.lib.comment.inter(N,g);i=k.define(h,["count","feed","comment","del","requesterror"]);h.destroy=function(){if(G){K.remove("qface_send","click",G.send);G.destroy();G=undefined}a.foreach(F,function(b){a.custEvent.remove(b.handle);b.DOM=null;b.handle=null});x&&clearInterval(x);a.lib.kit.extra.keySubmit.off(v,I);n&&window.clearTimeout(n);m&&m.anihide&&m.anihide();m&&m.destroy&&m.destroy();m=null};return h},r=function(b,c){var d=a.core.arr.indexOf(b,g);if(!h[d]){g[d=g.length]=b;h[d]=q(b,c)}return h[d]};return function(a,b){if(!a||!a.mid)throw"mid is not defined";var c=r(b,a);if(b.firstChild){b.innerHTML="";b.style.display="none";c.destroy()}else if(a){a.act="list";c.load(a);b.style.display=""}return c}});
STK.register("lib.dialog.commentDialogue",function(a){var b=a.lib.comment.commentMsg,c=a.lib.kit.extra.language,d={TITLE:c("#L{}"),FRAME:c('<div class="layer_dialogue_v5"><div class="WB_empty" node-type="topbox" style="display:none;"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="subtext" style="display:none;" node-type="more"></p></div>\t\t\t\t\t</div>\t\t\t</div><div class="WB_feed_repeat" node-type="scrollView"><!----><div class="WB_repeat"><div class="repeat_list"><div class="list_box"><div class="list_ul" node-type="repeat_list"></div></div></div></div></div>  </div>'),MOREAREA:{LOADING:c('<span>&nbsp;<i class="W_loading"></i>#L{...}</span>'),DELETEED:c("#L{}"),RETRY:c('#L{}<a action-type="older" href="javascript:void(0)" onclick="return false;">#L{}</a>#L{}'),DEFAULT:c('<a action-type="older" href="javascript:void(0)" onclick="return false;"><span class="more_arrow">&laquo;</span>#L{}</a>')}},e={unReply:c(b.noPhoneReplyMsg),unPower:c(b.noPowerReplyMsg)},f=a.conf.trans.comment,g=a.ui.dialog({isHold:!0}),h=null,i=null,j=a.conf.trans.comment,k,l=!1;return function(){var b,c,m,n,o,p,q,r=!0,s=!1,t=[],u,v=function(){g.setTitle(d.TITLE);g.setContent(d.FRAME);var b=g.getDomList().inner;k=a.lib.kit.dom.parseDOM(a.builder(b).list);k.outer=g.getBox();k.inner=b;u=a.ui.scrollView(k.scrollView);w();l=!0},w=function(){q=a.core.evt.delegatedEvent(k.outer);q.add("older","click",b.getDialogueList);q.add("replycomment","click",x.show);a.custEvent.add(g,"hide",b.reset)},x={show:function(b){var c=b.el;{if(!a.core.dom.hasClassName(c,"unclick_rep")){b.data&&b.data.ispower=="1"?j.request("isComment",{onComplete:function(d){if(d.code=="100000")x.showReply(b);else{if(h){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null}if(d.code=="100022")h=a.ui.tip("alert",{msg:e.unPower,type:"warn"});else if(d.code=="100001"){c&&c.setAttribute("isphone","1");h=a.ui.tip("alert",{msg:e.unReply,type:"warn"})}else h=a.ui.tip("alert",{msg:d.msg,type:"warn"});h.setLayerXY(c);h.aniShow();a.addClassName(c,"unclick_rep");i&&window.clearTimeout(i);i=window.setTimeout(function(){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null},3e3)}}},b.data):x.showReply(b);return a.preventDefault(b.evt)}if(h){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null}var d=c.getAttribute("isPhone");d?h=a.ui.tip("alert",{msg:e.unReply,type:"warn"}):h=a.ui.tip("alert",{msg:e.unPower,type:"warn"});h.setLayerXY(c);h.aniShow();i&&window.clearTimeout(i);i=window.setTimeout(function(){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null},3e3)}},showReply:function(b){var c=b.el,d,e,f;while(c.className.toLowerCase()!="list_con")c=c.parentNode;d=a.sizzle('[node-type="commentwrap"]',c)[0];var g=b.el;e=g.getAttribute("status");var h=a.core.dom.dir(g,{expr:"li"});if(a.core.dom.getStyle(d,"display")!="none"&&e=="true"){g.setAttribute("status","false");a.core.dom.setStyle(d,"display","none");h[0]&&a.removeClassName(h[0],"curr")}else{g.setAttribute("status","true");a.core.dom.setStyle(d,"display","");h[0]&&a.addClassName(h[0],"curr");f&&f.focus()}if(!e){f=a.lib.comment.reply(d,b.data);f.liNode=h[0];x.funcs.add(f)}u.reset()},reply:function(b,c){a.conf.channel.feed.fire("reply",{obj:b,ret:c,cid:n});c.data&&c.data.content&&x.newDialogue(c.data.content)},newDialogue:function(b){a.core.dom.insertHTML(k.repeat_list,b,"beforeend")},funcs:{add:function(b){var c=x.funcs.get(b);if(!t[c]){t.push(b);a.custEvent.add(b,"reply",x.reply);a.custEvent.add(b,"reply",function(){b.liNode&&a.removeClassName(b.liNode,"curr")})}},remove:function(b){if(t[b]){a.custEvent.remove(b);t[b]=null;delete t[b]}},get:function(a){var b,c=!1;for(var d=0;d<t.length;d++){var e=t[d];if(e==a){b=d;c=!0;break}}return b},destroy:function(){for(var a=0;a<t.length;a++)x.funcs.remove(a)}}};b={show:function(a){!l&&v();r=!0;c=a.data.cid;m=a.data.ouid;n=c;o=a.data.cuid;p=a.data.type||"small";b.display();b.getDialogueList()},getCid:function(){var d=!1,e=a.lib.kit.dom.firstChild(k.repeat_list);if(e)var d=e.getAttribute("cid");if(d){c=d;b.moreArea.show()}else b.moreArea.hide()},getDialogueList:function(){var e={cid:c,type:p,ouid:m,cuid:o};r&&(e.is_more=1);if(!s){b.loading.start();f.request("dialogue",{onComplete:function(c){b.loading.end();if(c.code=="100000"){c.data&&c.data.html&&b.addContent(c.data.html);r=!1;b.getCid();b.moreArea.setContent(c.msg?c.msg:d.MOREAREA.DEFAULT)}else if(c.code=="100001"){b.moreArea.setContent(d.MOREAREA.RETRY);b.moreArea.show()}else if(c.code=="100011"){b.moreArea.setContent(d.MOREAREA.DELETEED);b.moreArea.show()}else a.lib.dialog.ioError(c.code,c);u.reset()}},e)}u.reset()},getOldDialogueList:function(){var e={cid:c,type:p,ouid:m,cuid:o};r&&(e.is_more=1);if(!s){b.loading.start();f.request("dialogue",{onComplete:function(c){b.loading.end();if(c.code=="100000"){c.data&&c.data.html&&b.loadmore(c.data.html);r=!1;b.getCid();b.moreArea.setContent(c.msg?c.msg:d.MOREAREA.DEFAULT)}else if(c.code=="100001"){b.moreArea.setContent(d.MOREAREA.RETRY);b.moreArea.show()}else if(c.code=="100011"){b.moreArea.setContent(d.MOREAREA.DELETEED);b.moreArea.show()}else a.lib.dialog.ioError(c.code,c);u.reset()}},e)}u.reset()},loading:{start:function(){s=!0;b.moreArea.setContent(d.MOREAREA.LOADING)},end:function(){s=!1;b.moreArea.setContent(d.MOREAREA.DEFAULT)}},addContent:function(b){a.core.dom.insertHTML(k.repeat_list,b,"afterbegin")},loadmore:function(b){var c=a.sizzle('[node-type="commentconversation"]',k.repeat_list)[0];a.core.dom.insertHTML(c,b,"afterbegin")},moreArea:{show:function(){a.setStyle(k.more,"display","");a.setStyle(k.topbox,"display","")},hide:function(){a.setStyle(k.more,"display","none");a.setStyle(k.topbox,"display","none")},setContent:function(a){k.more.innerHTML=a}},display:function(){b.clear();g.show();g.setMiddle();a.setStyle(k.outer,"top",parseInt(a.getStyle(k.outer,"top"))-30+"px")},clear:function(){k.repeat_list.innerHTML=""},reset:function(){r=!0;b.moreArea.show();b.clear();x.funcs.destroy()},destroy:function(){b=null,x=null;x.funcs.destroy();i&&window.clearTimeout(i);h&&h.aniHide&&h.aniHide();h&&h.destroy&&h.destroy();h=null}};return b}});
STK.register("lib.feed.plugins.comment",function(a){var b=a.core.dom.uniqueID,c=a.lib.feed.feedTemps,d={},e=a.lib.kit.extra.language,f=e("#L{}"),g=e("#L{}"),h=a.conf.trans.feed.comment,i=a.lib.kit.extra.setPlainHash;return function(j,k){var l=j.utils,m=!1,n=null,o=null,p={};if(!j)a.log("comment : need object of the baseFeedList Class");else{var q=a.core.obj.parseParam({trans:h},k),r=j.getNode(),s={},t=!1,u=function(b,c,d,e){var f=a.core.dom.dir(b,{expr:"ul"})[0],g=!1,h=c.split(" "),i;if(!a.core.dom.hasClassName(b,c)){i=a.core.dom.sizzle("."+e,f)[0];for(var j=0;j<h.length;j++)a.core.dom.removeClassName(i,h[j]);a.core.dom.addClassName(i,d);a.core.dom.addClassName(b,c);a.core.dom.removeClassName(b,d);g=!0}b.blur();return g},v=function(h){t=!1;var k=h.el,n=b(k),q=d[n],s=l.getMid(k,r),v=l.getFeedNode(k,r),w=a.sizzle('[node-type="feed_list_repeat"]',v)[0],x=a.sizzle('[node-type="feed_merge_lists"]',v)[0],y=a.sizzle('[node-type="cmtarrow"]',v),z=a.sizzle('div[node-type="commentBox"]',v);z=z[0]?z[0]:null;var A=k.dataset&&k.dataset.mark||k.getAttribute("data-mark")||"",B={};A&&(B=a.queryToJson(A));if(!w)a.log("feedList.plugins.comment: ");else{if(!q){z&&(z.style.display="none");y[0]&&(y[0].style.display="");a.addClassName(a.core.dom.dir.parent(h.el,{expr:"li"})[0],"curr");i((+(new Date)).toString());q=d[n]=a.lib.comment.comment(a.lib.kit.extra.getDiss(a.core.json.merge(a.core.json.merge({mid:s,appkey:h.data.appkey,isMain:!0},h.data),B),h.el),w);a.custEvent.add(q,"count",function(b,c){parseInt(c)<1?c="":c=" "+c;a.sizzle(">span",k).length?k.innerHTML='<span class="pos"><span class="line S_line1">'+f+c+"</span></span>":k.innerHTML=f+c});a.custEvent.add(q,"comment",function(b,c){o=a.sizzle('a[node-type="feed_list_commentTabAll"]',v)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',v)[0],f=c.html,g=parseInt(c.count),h=a.sizzle('[node-type="feed_list_commentListNum"]',v)[0];parseInt(g)>0&&h&&(h.innerHTML=e("#L{}")+g+e("#L{}"));if(!o)f&&a.insertHTML(d,f,"afterbegin");else if(!p[s])f&&a.insertHTML(d,f,"afterbegin");else{d.innerHTML=p[s];u(o,"current S_txt1","S_func1","S_txt1");m=!1;f&&a.insertHTML(d,f,"afterbegin")}p[s]=d.innerHTML});a.custEvent.add(q,"requesterror",function(){a.removeClassName(a.core.dom.dir.parent(h.el,{expr:"li"})[0],"curr");a.custEvent.remove(q);q.destroy();delete d[n];w.on=0;w.innerHTML="";w.style.display="none";x&&(x.style.display="");a.custEvent.fire(j,"commentHide",k);z&&(z.style.display="")});a.custEvent.add(q,"feed",function(){var b=a.sizzle('a[action-type="fl_forward"]',k.parentNode)[0];if(!b)a.log("feedList.plugins.comment: ");else{var c=b.innerHTML.match(/\(([\d]*)\)/);b.innerHTML=g+"("+(c?parseInt(c[1])+1:1)+")"}});a.custEvent.add(q,"del",function(b,c){o=a.sizzle('a[node-type="feed_list_commentTabAll"]',v)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',v)[0];if(p[s])if(!m)d&&(p[s]=d.innerHTML);else{var e=document.createElement("div");e.innerHTML=p[s];a.core.util.hideContainer.appendChild(e);var f=a.sizzle(["dl[comment_id=",c.cid,"]"].join(""),e)[0];f&&f.parentNode.removeChild(f);p[s]=e.innerHTML;a.core.util.hideContainer.removeChild(e);e=null}else o&&(p[s]=d.innerHTML)});w.innerHTML=c.loadingIMG;w.style.display="";x&&(x.style.display="none");a.custEvent.fire(j,"commentShow",k)}else{a.removeClassName(a.core.dom.dir.parent(h.el,{expr:"li"})[0],"curr");a.custEvent.remove(q);q.destroy();delete d[n];w.on=0;w.innerHTML="";w.style.display="none";x&&(x.style.display="");a.custEvent.fire(j,"commentHide",k);z&&(z.style.display="")}return l.preventDefault()}},w=function(b){a.core.evt.preventDefault();if(!t){t=!0;v(b)}},x={getListByType:function(b,c){var d=b.data,f=d.mid,g=b.el,j=l.getFeedNode(g,r),k=u(b.el,"S_txt1 curr","S_txt1","curr");if(!k)return l.preventDefault();i((+(new Date)).toString());h.request("cfilter",{onSuccess:function(b){c.innerHTML=b.data.html;m||(p[f]=b.data.html);var d=a.sizzle('[node-type="feed_list_commentListNum"]',j)[0];d&&b.data&&typeof b.data.count!="undefined"&&(d.innerHTML=e("#L{}")+b.data.count+e("#L{}"));j=null},onFail:function(b){a.lib.dialog.ioError(b.code,b);j=null},onError:function(b){a.lib.dialog.ioError(b.code,b);j=null}},d);return!1}},y=function(b){a.preventDefault();var c=b.data.mid;m=b.el.getAttribute&&b.el.getAttribute("node-type")=="feed_list_commentTabAll"?!1:!0;var d=b.el,e=l.getFeedNode(d,r),f=b.data,g=a.sizzle('[node-type="feed_list_commentList"]',e)[0];p[c]||(p[c]=g.innerHTML);g?x.getListByType(b,g):a.log("feedList.plugins.comment: ")},z=function(b){var c=l.getFeedNode(b.el,r),d=a.sizzle('[action-type="feed_list_commentSearch"]',c);for(var e=0;d[e];e++){var f=a.queryToJson(d[e].getAttribute("action-data"));if(b.data.filter==f.filter){b.el=d[e];y(b);return}}};j.getDEvent().add("feed_list_commentSearch","click",y);j.getDEvent().add("fl_comment","click",w);j.getDEvent().add("anotherSearchTab","click",z);j.getDEvent().add("feed_private_tipclose","click",function(b){var c=b.data&&b.data.type,d=l.getFeedNode(b.el,r),e=a.sizzle("[node-type='feed_privateset_tip']",d),f=e.length&&e[0];f&&a.setStyle(f,"display","none");h.request("privateNoMore",{onSuccess:function(){c&&(window.location.href=b.el.getAttribute("href"))},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{bubbletype:7,time:604800});return l.preventDefault()});var A=a.lib.dialog.commentDialogue(),B=function(a){A.show(a)};j.getDEvent().add("commentDialogue","click",B);j.regCustEvent("showComment",function(a,b){w(b)});s.destroy=function(){for(var a in d)d[a].destroy();o=null;p=null;d={};n=null};return s}}});
STK.register("conf.trans.feed.favorite",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("add",{url:d+"?fajtype=fav_mblog_add",method:"post"});c("del",{url:d+"?fajtype=fav_mblog_del",method:"post"});c("alter",{url:d+"?fajtype=fav_tag_alter",method:"post"});return b});
STK.register("lib.feed.plugins.favorite.favorite",function(a){var b=a.lib.kit.extra.language,c=b("#L{}!"),d=b("#L{}!"),e=b("#L{}"),f=b("#L{}"),g=b("#L{}"),h,i="",j=b("#L{}"),k=b("#L{}"),l=b("#L{!}");TipInfoDel=b("#L{}");var m=function(b,c,d){if(!!b){h=a.ui.tip("alert",{showCallback:function(){setTimeout(function(){h&&h.aniHide()},d?1500:600)},hideCallback:function(){h&&h.destroy();h=null},msg:b,type:d?"del":undefined});h.setLayerXY(c);h.aniShow()}},n,o,p,q=function(b){return a.ui.tip("confirm",{msg:TipInfoDel,okCallback:function(){n&&n()},hideCallback:function(){o&&o()}})};return function(b){var i={},j=a.conf.trans.feed.favorite;b=a.parseParam({showTip:!0,mid:null,node:null,bubbleEl:null,mark:"",trans:j},b);if(!b.mid||!b.node)a.log("opts.mid, opts.node !");else{a.custEvent.define(i,["success","showForward","fail","error","cancel"]);var k=function(g,h,i,j,k,l,n){var o=j=="add"?f:e;b.trans.request(j,{onSuccess:function(b){m(o+c,n||i);a.custEvent.fire(g,"success",b)},onFail:function(b){m(o+d,n||i,!0);a.custEvent.fire(g,"fail")},onError:function(b){if(b.code==100002||b.code==100008){a.lib.dialog.ioError(b.code,b);a.custEvent.fire(g,"error",b)}else{m(b.msg||o+d,i,!0);a.custEvent.fire(g,"error",b)}}},a.lib.kit.extra.getDiss({mid:h,mark:l},i))};i.add=function(){k(i,b.mid,b.node,"add",b.showTip,b.mark,b.bubbleEl)};i.del=function(){n=function(){k(i,b.mid,b.node,"del",b.showTip,b.mark,b.bubbleEl)};o=function(){a.custEvent.fire(i,"cancel")};p=p||q();p.setLayerXY(b.bubbleEl||b.node);p.aniShow()};i.hideTip=function(){h&&h.hide()};i.aniHideTip=function(){h&&h.aniHide()};i.msgTipDetroy=function(){h&&h.destroy();h=null};i.destroy=function(){h&&h.destroy();a.custEvent.undefine(i);i=b=h=p=null};i.showSuccTip=function(a){m(g+c,a)};i.showErrTip=function(a,b){m(b,a,!0)};return i}}});
STK.register("lib.feed.plugins.favorite.items.DataController",function(a){return function(b){var c={},d={},e=[],f=0;a.custEvent.define(c,["DispItem","DeletedItem","ItemSuggest"]);c.addItems=function(b){a.isArray(b)||(b=[b]);for(var c=0,g=b.length;c<g;c++){var h=b[c];if(!d[h.id]){f++;d[h.id]={data:h,index:e.length};e.push(h)}}};c.removeItems=function(b){a.isArray(b)||(b=[b]);for(var c=0,g=b.length;c<g;c++){var h=b[c];if(d[h.id]){f>0&&f--;var i=d[h.id].index;delete d[h.id];e[i]=null}}};c.getResult=function(){var a=[];for(var b=0,c=e.length;b<c;b++)e[b]&&a.push(e[b]);return a};c.getResultLength=function(){return f};c.hasKey=function(a){return d[a.id]};c.destroy=function(){a.custEvent.undefine(c);c=d=e=f=undefined};return c}});
STK.register("lib.feed.plugins.favorite.items.DispItem",function(a){return function(b){if(typeof b!="object")throw"DispItem need param object";if(typeof b.custObj!="object")throw"DispItem need custObj custEvent depute";if(typeof b.chosenTpl!="string")throw"DispItem need chosenTpl param";if(typeof b.unChosenTpl!="string")throw"DispItem need unChosenTpl param";if(!a.isNode(b.nodeList))throw"DispItem need nodeList to depute dom";if(typeof b.limitCount!="undefined"&&typeof b.DataController=="undefined")throw"DispItem need DataController when set limitCount";var c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=a.lib.kit.dom.firstChild,f=a.lib.kit.extra.merge,g={},h;g.addItems=function(e,f){a.isArray(e)||(e=[e]);var g=c(d(f.type=="chosen"?b.chosenTpl:b.unChosenTpl),e).toString();a.insertHTML(b.nodeList,g,"beforeend")};g.removeItems=function(c,d){a.isArray(c)||(c=[c]);for(var e=0,f=c.length;e<f;e++){var g=a.sizzle("[itemid='"+(d?c[e].id:c[e])+"']",b.nodeList);g.length&&a.removeNode(g[0])}};var i=function(f,g){a.isArray(f)||(f=[f]);for(var h=0,i=f.length;h<i;h++){var j=a.sizzle("[itemid='"+f[h].id+"']",b.nodeList);if(j.length){var k=a.C("DIV"),l=c(d(g?b.chosenTpl:b.unChosenTpl),[f[h]]).toString();k.innerHTML=l;a.replaceNode(e(k),j[0])}}},j=function(){if(b.limitCount){var a=b.DataController.getResultLength();return a>=b.limitCount?!0:!1}return!1};g.setCheckedItems=function(a){i(a,!0)};g.setUncheckedItems=function(a){i(a,!1)};h=a.delegatedEvent(b.nodeList);h.add("check","click",function(c){setTimeout(function(){if(!j()){var d=f(c.data,{data:c.el.getAttribute("action-data")});g.setCheckedItems(d);a.custEvent.fire(b.custObj,"DispItem",{type:"check",data:d})}else a.custEvent.fire(b.custObj,"DispItem",{type:"focusInput",data:{}})},0)});h.add("uncheck","click",function(c){setTimeout(function(){var d=f(c.data,{data:c.el.getAttribute("action-data")});g.setUncheckedItems(d);a.custEvent.fire(b.custObj,"DispItem",{type:"uncheck",data:d})},0)});g.destroy=function(){h&&h.destroy();c=d=e=f=g=h=i=j=undefined};return g}});
STK.register("lib.feed.plugins.favorite.items.DeletedItem",function(a){return function(b){if(typeof b!="object")throw"DeletedItem need param object";if(typeof b.custObj!="object")throw"DeletedItem need custObj custEvent depute";if(typeof b.template!="string")throw"DeletedItem need template to display";if(!a.isNode(b.nodeList))throw"DeletedItem need nodeList to depute dom";if(!a.isNode(b.insertBeforeNode))throw"DeletedItem need insertBeforeNode to insert dom";var c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=a.lib.kit.extra.merge,f={},g;f.addItems=function(e){a.isArray(e)||(e=[e]);var f=c(d(b.template),e).toString();a.insertHTML(b.insertBeforeNode,f,"beforebegin")};f.removeItems=function(c,d){a.isArray(c)||(c=[c]);for(var e=0,f=c.length;e<f;e++){var g=a.sizzle("[itemid='"+(d?c[e].id:c[e])+"']",b.nodeList);g.length&&a.removeNode(g[0])}};g=a.delegatedEvent(b.nodeList);g.add("remove","click",function(c){setTimeout(function(){var d=e(c.data,{data:c.el.getAttribute("action-data")});f.removeItems(d,!0);a.custEvent.fire(b.custObj,"DeletedItem",{type:"remove",data:d})},0)});f.destroy=function(){g&&g.destroy();c=d=e=g=f=undefined};return f}});
STK.register("lib.feed.plugins.favorite.items.dynamicInputWidth",function(a){return function(b,c){c=c||{};var d={},e,f,g,h=a.core.dom.getSize,i=a.core.dom.setStyle,j,k;a.custEvent.define(d,"textChange");var l=function(){if(!e){e=1;var b=a.core.dom.cssText("");b.push("width","1000px");b.push("height","55px");b.push("position","absolute");b.push("left","-10000px");b.push("top","-10000px");b.push("visibility","hidden");var c=b.getCss();e=1;var d='<div node-type="wrap" style="'+c+'">'+'<span node-type="before"></span>'+"</div>",h=a.core.dom.builder(d);g=h.box;f=a.lib.kit.dom.parseDOM(h.list);document.body.appendChild(g)}},m={focus:function(){clearTimeout(k);k=setTimeout(m.focusFun,200)},focusFun:function(){var e=b.value;if(c.limitWords){var g=a.bLength(e);g>c.limitWords&&(b.value=e=a.leftB(e,c.limitWords))}if(e==j)m.focus();else{j=e;l();f.before.innerHTML=a.encodeHTML(e);var k=h(f.before),n=k.width+20;c.maxInputWidth&&n>c.maxInputWidth&&(n=c.maxInputWidth);i(b,"width",n+"px");m.focus();a.custEvent.fire(d,"textChange",e)}},blur:function(){clearTimeout(k)}},n=function(){a.addEvent(b,"focus",m.focus);a.addEvent(b,"blur",m.blur)},o=function(){a.removeEvent(b,"focus",m.focus);a.removeEvent(b,"blur",m.blur);d=null},p={custObj:d,destroy:o};n();return p}});
STK.register("lib.feed.plugins.favorite.items.ItemSuggest",function(a){return function(b){if(typeof b!="object")throw"ItemSuggest need object params";if(typeof b.textEl=="undefined")throw"ItemSuggest need textEl";if(typeof b.uiNode=="undefined")throw"ItemSuggest need uiNode";if(typeof b.suggestConf=="undefined")throw"ItemSuggest need suggestConf";if(typeof b.custObj=="undefined")throw"ItemSuggest need custObj";var c=a.lib.kit.dom.parseDOM(a.builder(b.uiNode).list),d,e,f;b=a.lib.kit.extra.merge({actionType:"suggestItem",actionData:"index",suggestType:"local"},b);var g={},h=a.ui.mod.suggest({textNode:b.textEl,uiNode:b.uiNode,actionType:b.actionType,actionData:b.actionData}),i={BACKSPACE:8,SPACE:32},j=a.core.util.easyTemplate,k=a.lib.kit.extra.language,l=a.core.dom.getSize,m={hideSuggest:function(){a.setStyle(b.uiNode,"display","none");a.custEvent.fire(h,"close",{})},keyboardSubmit:function(){a.custEvent.fire(b.custObj,"ItemSuggest",{type:"keyboardSubmit",data:{}})},addOneItem:function(){var c=a.trim(b.textEl.value),e=b.suggestConf.regexp;if(c)if(e(c)){a.custEvent.fire(b.custObj,"ItemSuggest",{type:"addItem",data:{id:c}});a.setStyle(b.textEl,"width","20px");b.textEl.value="";m.hideSuggest();d=null}else a.custEvent.fire(b.custObj,"ItemSuggest",{type:"inputError",data:{value:c}})},localSearch:function(a){var c=b.suggestConf.data,d=b.suggestConf.searchKey,e=[],f=b.suggestConf.suggestMaxCount,g=0;for(var h=0,i=c.length;h<i;h++)if(c[h][d]&&c[h][d].indexOf(a)==0)if(f){if(!(g<f))break;g++;e.push(c[h])}else e.push(c[h]);return e},setLayerPos:function(){a.lib.kit.dom.layoutPos(b.uiNode,b.textEl)},getTemplate:function(d){var e=j(k(b.suggestConf.template),d);c.suggestContent.innerHTML=e;m.setLayerPos();if(d.length){a.setStyle(b.uiNode,"display","");a.custEvent.fire(h,"open",b.textEl)}else m.hideSuggest()},reqSucc:function(b,c){a.isArray(b.data)?m.getTemplate(b.data):m.getTemplate([])},reqFail:function(a,b){m.getTemplate([])},buildTrans:function(){e=b.suggestConf.trans.getTrans(b.suggestConf.transName,{onSuccess:m.reqSucc,onError:m.reqFail,onFail:m.reqFail})},textChange:function(c,d){d&&(d=a.trim(d));if(!d)m.hideSuggest();else if(b.suggestType==="local"){var e=m.localSearch(d);m.getTemplate(e)}else if(b.suggestType==="net"){clearTimeout(f);f=setTimeout(function(){m.sendRequest(d)},100)}a.custEvent.fire(b.custObj,"ItemSuggest",{type:"textChange",data:{value:d}})},sendRequest:function(a){e||m.buildTrans();e.abort();e.request({q:a})},removeJudge:function(){var c=b.textEl.value;c==""&&a.custEvent.fire(b.custObj,"ItemSuggest",{type:"remove",data:{}})},onSpace:function(b){b=a.fixEvent();var c=b.keyCode||b.which;if(c==i.SPACE){m.addOneItem();a.preventDefault()}},onKeyDown:function(b){b=a.fixEvent();var c=b.keyCode||b.which;if(c==i.BACKSPACE)m.removeJudge();else if(c==13||c==10){m.hideSuggest();m.keyboardSubmit()}},blur:function(){var a=m.hideSuggest;setTimeout(function(){a();a=undefined},150)},changeCurrent:function(c,e){var f=b.suggestConf.currentClass;d&&a.removeClassName(d,f);var g=a.sizzle(b.suggestConf.itemTagName,b.uiNode);if(g[e]){a.addClassName(g[e],f);d=g[e]}else d=null},selectItem:function(c,e){c=a.fixEvent();if(!c.ctrlKey){var f=a.sizzle(b.suggestConf.itemTagName,b.uiNode);if(f[e]){a.setStyle(b.textEl,"width","20px");b.textEl.value="";var g=f[e].getAttribute("action-data");a.custEvent.fire(b.custObj,"ItemSuggest",{type:"select",data:g});m.hideSuggest();try{b.textEl.focus()}catch(h){}d=null}}}},n=a.lib.feed.plugins.favorite.items.dynamicInputWidth(b.textEl,{maxInputWidth:b.maxInputWidth,limitWords:b.limitWords});a.custEvent.add(n.custObj,"textChange",m.textChange);a.addEvent(b.textEl,"blur",m.blur);a.addEvent(b.textEl,"keypress",m.onSpace);a.addEvent(b.textEl,"keydown",m.onKeyDown);a.custEvent.add(h,"onIndexChange",m.changeCurrent);a.custEvent.add(h,"onSelect",m.selectItem);g.destroy=function(){a.custEvent.fire(h,"close",{});n&&a.custEvent.undefine(n.custObj);n&&n.destroy();a.removeEvent(b.textEl,"blur",m.blur);a.removeEvent(b.textEl,"keypress",m.onSpace);a.removeEvent(b.textEl,"keydown",m.onKeyDown);c=d=e=f=g=h=i=j=k=l=m=n=undefined};return g}});
STK.register("lib.feed.plugins.favorite.items.DataItemPicker",function(a){return function(b){var c=a.core.dom.getSize,d=a.lib.kit.extra.merge,e={},f,g,h,i,j,k,l,m,n=0,o=!1,p=function(){if(typeof b!="object")throw"DataItemPicker need params object";if(!a.isNode(b.container))throw"DataItemPicker need container(node)";if(typeof b.DispItem=="undefined")throw"DataItemPicker need DispItem(boolean)";if(typeof b.DispItemConf!="object")throw"DataItemPicker need DispItemConf";if(typeof b.DeletedItem=="undefined")throw"DataItemPicker need DeleteItem(boolean)";if(typeof b.DeletedItemConf!="object")throw"DataItemPicker need DeletedItemConf";if(typeof b.ItemSuggest=="undefined")throw"DataItemPicker need DeleteItem(boolean)";if(typeof b.ItemSuggestConf!="object")throw"DataItemPicker need ItemSuggestConf";k=b.DispItem;l=b.DeletedItem;m=b.ItemSuggest;o=b.resetHeight},q=function(){f=a.lib.kit.dom.parseDOM(a.builder(b.container).list)},r=function(){if(m){a.addEvent(f.container,"click",u.focusInput);a.addEvent(f.suggestInput,"focus",u.suggestFocus);a.addEvent(f.suggestInput,"blur",u.suggestBlur)}},s=function(){g=a.lib.feed.plugins.favorite.items.DataController({custObj:e});k&&(h=a.lib.feed.plugins.favorite.items.DispItem({custObj:g,limitCount:b.limitCount,DataController:g,nodeList:f.dispItemList,chosenTpl:b.DispItemConf.chosenTpl,unChosenTpl:b.DispItemConf.unChosenTpl}));l&&(i=a.lib.feed.plugins.favorite.items.DeletedItem({custObj:g,template:b.DeletedItemConf.template,nodeList:f.container,insertBeforeNode:f.suggestInput}));m&&(j=a.lib.feed.plugins.favorite.items.ItemSuggest({textEl:f.suggestInput,uiNode:b.ItemSuggestConf.suggestList,suggestType:b.ItemSuggestConf.suggestType,suggestConf:b.ItemSuggestConf.suggestConf,maxInputWidth:b.ItemSuggestConf.maxInputWidth,limitWords:b.ItemSuggestConf.limitWords,regexp:b.ItemSuggestConf.regexp,custObj:g}));k&&a.custEvent.add(g,"DispItem",function(b,c){if(c.type=="check"){if(!u.getLimitReach()){g.addItems(c.data);i.addItems(c.data);a.custEvent.fire(e,"checkedDespItem",{data:c})}u.resetHeight();u.focusInput()}else if(c.type=="uncheck"){g.removeItems(c.data);i.removeItems(c.data,!0);u.resetHeight();u.focusInput()}else c.type=="focusInput"&&u.focusInput()});l&&a.custEvent.add(g,"DeletedItem",function(b,c){if(c.type=="remove"){g.removeItems(c.data);h.setUncheckedItems(c.data);u.resetHeight();a.custEvent.fire(e,"DeletedItemRemove",{DataController:g})}});m&&a.custEvent.add(g,"ItemSuggest",function(b,c){if(c.type=="remove"){var j=a.sizzle("[action-type='remove']:last",f.container);if(j.length){var k=a.queryToJson(j[0].getAttribute("action-data"));k=d(k,{data:j[0].getAttribute("action-data")});g.removeItems(k);i.removeItems(k,!0);h.setUncheckedItems(k);u.resetHeight()}a.custEvent.fire(e,"backspaceKey",{})}else if(c.type=="select"){var l=c.data,k=a.queryToJson(l);k=d(k,{data:l});var m=g.hasKey(k);if(!m){if(!u.getLimitReach()){g.addItems(k);i.addItems(k);h.setCheckedItems(k)}u.resetHeight()}}else if(c.type=="textChange"){u.resetHeight();a.custEvent.fire(e,"textChange",c.data)}else if(c.type=="inputError")a.custEvent.fire(e,"inputError",c.data);else if(c.type=="addItem"){var n=c.data.id,k={id:n,data:"id="+n+"&text="+n,text:n},m=g.hasKey(k);if(!m){if(!u.getLimitReach()){g.addItems(k);i.addItems(k);h.setCheckedItems(k);a.custEvent.fire(e,"spaceAddItem",c.data)}u.resetHeight()}}else c.type=="keyboardSubmit"&&a.custEvent.fire(e,"keyboardSubmit",c.data)})},t=function(){a.custEvent.define(e,["resultChange","textChange","inputError","keyboardSubmit","backspaceKey","DeletedItemRemove","spaceAddItem","checkedDespItem"])},u={suggestFocus:function(){n=1},suggestBlur:function(){n=0},getLimitReach:function(){if(b.limitCount){var a=g.getResultLength();return a>=b.limitCount?!0:!1}return!1},focusInput:function(){if(!n){a.lib.kit.extra.textareaUtils.setCursor(f.suggestInput);n=1}},resetHeight:function(){if(!!o){var d=g.getResultLength();if(d){var e=a.position(f.suggestInput),h=a.position(f.container),i=c(f.suggestInput),j=e.t+i.height-h.t+3,k=c(f.container).height;k!=j&&a.setStyle(f.container,"height",j+"px")}else a.setStyle(f.container,"height",b.containerMinHeight+"px")}}},v=function(){p();q();r();s();t()};v();e.getDispItem=function(){return h};e.getDeletedItem=function(){return i};e.getDataController=function(){return g};e.focusInput=u.focusInput;e.resetHeight=u.resetHeight;e.destroy=function(){g.destroy();k&&h&&h.destroy();l&&i&&i.destroy();if(m){j&&j.destroy();a.removeEvent(f.container,"click",u.focusInput);a.removeEvent(f.suggestInput,"focus",u.suggestFocus);a.removeEvent(f.suggestInput,"blur",u.suggestBlur)}e=f=g=h=i=j=undefined;c=d=k=l=m=n=v=u=undefined};return e}});
STK.register("lib.feed.plugins.favorite.borderedInput",function(a){return function(b,c){c=a.parseParam({addClass:"W_input_focus",removeClass:"W_input_focus",findEl:null},c);var d={};if(!a.isNode(b))return{destroy:a.funcEmpty};var e=function(){var a;c.findEl?a=c.findEl(b):a=b;return a},f=function(){var b=e();a.addClassName(b,c.addClass)},g=function(){var b=e();a.removeClassName(b,c.removeClass)};a.addEvent(b,"focus",f);a.addEvent(b,"blur",g);d.destroy=function(){a.removeEvent(b,"focus",f);a.removeEvent(b,"blur",g)};return d}});
STK.register("lib.feed.plugins.favorite.rectsPosition",function(a){var b=a.core.util.browser,c={},d=5,e=20,f={t:function(a,b){return a.t>b.h},b:function(a,b){return a.b>b.h},l:function(a,b){return a.l>b.w},r:function(a,b){return a.r>b.w}},g={domSize:function(b){var c=a.core.dom.getSize(b);return{w:Math.max(c.width,a.getStyle(b,"width").replace(/px|auto/gi,"")),h:Math.max(c.height,a.getStyle(b,"height").replace(/px|auto/gi,""))}},mouseXY:function(c){var d={x:c.pageX,y:c.pageY};if(b.IE6||b.IE7){var e=a.core.util.scrollPos();d.x=d.x+e.left;d.y=d.y+e.top}return d},getRows:function(a){var c=a.getClientRects();if(b.IE6||b.IE7){var d=[],e={},f;for(var g=0,h=c.length;g<h;g++){var i=c[g];e[i.top]||(e[i.top]=[]);e[i.top].push(i)}for(var j in e){var k=e[j],h=k.length,l=k[0];h>1&&(l.right=k[h-1].right);d.push(l)}c=d}return c},getTextRect:function(b,c){var d=a.parseParam({evt:""},c),e=a.core.util.scrollPos(),f;if(!b.getClientRects){var h=g.domSize(b);return{width:h.w,height:h.h,left:"",right:"",top:"",bottom:""}}var i={rows:g.getRows(b)},j=g.mouseXY(d.evt),k={x:j.x-e.left,y:j.y-e.top};for(var l=0,m=i.rows.length;l<m;l++){var n=i.rows[l];l==0&&(f=n);if(k.y>n.top&&k.y<n.bottom){f=n;break}}if(a.IE){var h=g.domSize(b);f=a.parseParam({width:h.w,height:h.h,left:"",right:"",top:"",bottom:""},f)}return f},getDistance:function(b,c){var d=a.core.util.winSize(),e=g.getTextRect(b,c);return{win:d,rect:e,w:e.width,h:e.height,t:e.top,l:e.left,r:d.width-e.right,b:d.height-e.bottom}},getSeat:function(b,c,d){var h=a.parseParam({distance:e,priority:"trbl"},d),i=g.getDistance(b,d),j=g.domSize(c);i.area="b";var k=h.priority.split("");for(var l=0,m=k.length;l<m;l++){var n=k[l];if(!f[n])throw'priority error, random use "tbrl" combination';if(f[n](i,j)){i.area=n;break}}return i},setArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];var j=g.domSize(c.layer),k=a.scrollPos(),l,m;if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance}else{l=i.top+k.top-c.distance;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px"},setLayer:function(b){var c=a.parseParam({evt:"",node:"",layer:"",priority:"btrl",offsetX:0,offsetY:0},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";var d=g.getSeat(c.node,c.layer,c),e=d.area,f=d.rect,h=g.domSize(c.layer),i=a.scrollPos(),j,k;if(e=="t"||e=="b"){j=e=="t"?f.top+i.top-h.h+c.offsetY:f.bottom+i.top-c.offsetY;k=f.left+i.left+c.offsetX}else{j=f.top+i.top+c.offsetY;k=e=="r"?f.right+i.left-c.offsetX:f.left+i.left-h.w+c.offsetX}c.layer.style.top=j+"px";c.layer.style.left=k+"px"}};c.getTextRect=g.getTextRect;c.getDistance=g.getDistance;c.getSeat=g.getSeat;c.setArrow=g.setArrow;c.setLayer=g.setLayer;return c});
STK.register("lib.feed.plugins.favorite.tagBubble",function(a){var b=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)};return function(c){var d,e,f,g,h,i,j,k,l={},m=0,n,o,p,q=a.lib.kit.extra.language,r=a.core.util.easyTemplate,s={ADD:{text:q("#L{}"),className:"W_tips tips_warn clearfix",classNameS:"icon_warnS W_icon"},DEFAULT:{text:q("#L{}"),className:"W_tips tips_warn clearfix",classNameS:"icon_warnS W_icon"},ERROR:{text:q("#L{_}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"},MAX:{text:q("#L{}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"},SAME:{text:q("#L{}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"}},t=function(){if(typeof c=="undefined")throw"tagBubble need params";if(!a.isNode(c.el))throw"tagBubble need el to show";if(typeof c.mid=="undefined")throw"tagBubble need mid to commit";if(typeof c.serverData=="undefined")throw"tagBubble need serverData to show"},u=function(){d=(c.serverData.my_tags||"").split(" ");d.length==1&&d[0]==""&&(d.length=0);e=c.serverData.mblog_tags||[];var b=x.getLabel(),h={labelText:b.text,labelClass:b.className,labelClassS:b.classNameS,uniqueId:a.getUniqueKey()},i='<#et favouriteBubble data><div class="W_layer W_layer_pop WB_outReset"><div class="content" node-type="inner"><div node-type="eventnode"><div class="W_layer_title"><div class="W_layer_close"><a node-type="close" href="javascript:;" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_favor_addtags"><div class="addbox"><div node-type="tipState" class="W_tips S_txt2 clearfix"><p class="icon"><i node-type="tipStateS" class="W_icon icon_errorS"></i></p><p node-type="labelText" class="txt"></p></div><div node-type="container" class="input_outer W_input_focus"><input name="${data.uniqueId}" id="${data.uniqueId}" node-type="suggestInput" autocomplete="off" type="text" class="W_input" style="width: 20px;"></div><div node-type="dispItemList" class="tags"></div></div></div><div class="W_layer_btn S_bg1"><a action-type="commitBtn" node-type="commitBtn" href="javascript:;" class="W_btn_a"></a><a  action-type="cancelBtn" href="javascript:;" class="W_btn_b"></a></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div><div node-type="suggestList" class="layer_menu_list" style="position:absolute;z-index:10000;display:none;"><ul node-type="suggestContent"></ul></div></#et>',j=r(q(i),h).toString();g=a.ui.bubble({template:j,clickBlankToHide:!0});f=a.lib.kit.dom.parseDOM(a.builder(g.getBox()).list)},v=function(){j=a.delegatedEvent(f.eventnode);j.add("commitBtn","click",x.commitBtn);j.add("cancelBtn","click",x.cancelBtn);p=a.lib.feed.plugins.favorite.borderedInput(f.suggestInput,{addClass:"W_input_focus",removeClass:"W_input_focus",findEl:function(a){return f.container}})},w=function(){var b=[];d.length&&(b=b.concat(x.buildItems(d)));e.length&&(b=b.concat(x.buildItems(e)));var c={};for(var i=0,j=b.length;i<j;i++)c[b[i].id]=b[i];b.length=0;for(var k in c)b[b.length]=c[k];h=a.lib.feed.plugins.favorite.items.DataItemPicker({resetHeight:!1,limitCount:2,container:g.getBox(),DispItem:!0,DeletedItem:!0,ItemSuggest:!0,DispItemConf:{chosenTpl:'<#et chosenTpl data><#list data as list><span action-type="uncheck" action-data="${list.data}" itemid="${list.id}" class="W_btn_b W_btn_tag W_btn_tag_cur"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg1_br"></em></span><a href="javascript:void(0);" class="S_txt1">${list.text}</a></span></#list></#et>',unChosenTpl:'<#et unChosenTpl data><#list data as list><span action-type="check" action-data="${list.data}" itemid="${list.id}" class="W_btn_b W_btn_tag"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="S_txt1">${list.text}</a></span></#list></#et>'},DeletedItemConf:{template:function(){return'<#et deleteList data><#list data as list><span itemid="${list.id}" class="W_btn_b W_btn_tag"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span>${list.text}<a href="javascript:void(0);" action-type="remove" action-data="${list.data}" class="W_ficon ficon_close S_ficon">X</a></span></#list></#et>'}()},ItemSuggestConf:{suggestType:"none",suggestList:f.suggestList,suggestConf:{regexp:function(a){return a===""||a===""||a===""?!1:/^[a-zA-Z0-9\u4e00-\u9fa5\-_]+$/.test(a)?!0:!1},suggestMaxCount:5,itemTagName:"li",currentClass:"cur",template:'<#et suggest data><#list data as list><li action-type="suggestItem" action-data="${list.data}"><a href="javascript:void(0)">${list.text}</a></li></#list></#et>',data:b,searchKey:"text"},maxInputWidth:200,limitWords:12},containerMinHeight:22})},x={deletedItemRemove:function(b,c){var d=a.trim(f.suggestInput.value);x.regExpTest({},{value:d})},commitSucc:function(){a.custEvent.fire(l,"success",{})},commitError:function(b,c){a.custEvent.fire(l,"error",{msg:b.msg})},commitFail:function(){a.custEvent.fire(l,"error",{msg:q("#L{}")})},getResultStr:function(){var a=i.getResult(),b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c].id);return b.join(" ")},cancelBtn:function(b){a.preventDefault(b.evt);g.hide()},realSubmit:function(b){var d=x.getResultStr();b&&(d?d+=" "+b:d=b);if(!d)g.hide();else{var e={mid:c.mid,tags:d};e=a.lib.kit.extra.getDiss(e);m=1;try{f.suggestInput.blur()}catch(h){}a.conf.trans.feed.favorite.request("alter",{onSuccess:x.commitSucc,onError:x.commitError,onFail:x.commitFail},e);g.hide()}},inArray:function(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].id==a)return!0;return!1},commit:function(){x.commitSuda();var b=a.trim(f.suggestInput.value);if(b){var c=i.getResult();if(c.length>=2){x.setLabel("max");h.focusInput()}else if(!/^[a-zA-Z0-9\u4e00-\u9fa5\-_]+$/.test(b)){x.setLabel("error");h.focusInput()}else{var d=x.inArray(b,c);if(d){x.setLabel("same");h.focusInput()}else x.realSubmit(b)}}else x.realSubmit()},commitBtn:function(b){a.preventDefault(b.evt);m||x.commit()},getLabel:function(){return d.length?s.ADD:s.DEFAULT},buildItems:function(a){var b=[];for(var c=0,d=a.length;c<d;c++){var e=a[c];b.push({id:e,data:"id="+e+"&text="+e,text:e})}return b},regExpTest:function(a,b){var c=b.value;if(c==""||/^[a-zA-Z0-9\u4e00-\u9fa5\-_]+$/.test(c)){var d=i.getResultLength();d?x.setLabel("add"):x.setLabel("default")}},backSpaceKey:function(){x.regExpTest({},{value:""})},setLabel:function(a,b){if(a=="right"){var c=x.getLabel();f.labelText.innerHTML=c.text;f.tipState.className=c.className;f.tipStateS.className=c.classNameS}else{var c=s[a.toUpperCase()];f.labelText.innerHTML=b||c.text;f.tipState.className=c.className;f.tipStateS.className=c.classNameS}},inputError:function(a,b){b.value===""||b.value===""||b.value===""?x.setLabel("error",q("#L{}")):x.setLabel("error")},bubbleHide:function(){m||x.closeSuda();A();a.custEvent.remove(g,"hide",arguments.callee)},showFavSucc:function(){m||a.custEvent.fire(l,"success",{blankNoTag:!0});m=undefined;a.custEvent.remove(g,"hide",arguments.callee)},setPos:function(){var b=a.position(c.el);if(!o||o.l!=b.l||o.t!=b.t){o=b;var d=a.builder(g.getBox()).list;g.beside(c.el)}},spaceAddItemSuda:function(){b("favor","input_tag")},checkedDespItemSuda:function(){b("favor","click_tag")},closeSuda:function(){b("favor","identify_cancel")},commitSuda:function(){b("favor","identify_do")}},y=function(){a.custEvent.define(l,["success","error"]);a.custEvent.add(h,"textChange",x.regExpTest);a.custEvent.add(h,"inputError",x.inputError);a.custEvent.add(h,"keyboardSubmit",x.commit);a.custEvent.add(h,"backspaceKey",x.backSpaceKey);a.custEvent.add(h,"DeletedItemRemove",x.deletedItemRemove);a.custEvent.add(h,"spaceAddItem",x.spaceAddItemSuda);a.custEvent.add(h,"checkedDespItem",x.checkedDespItemSuda)},z=function(){var b=h.getDispItem(),f=x.buildItems(d.slice(0,5));b.addItems(f,{type:"unChosen"});var j=h.getDeletedItem(),k=x.buildItems(e);j.addItems(k);b.setCheckedItems(k);i=h.getDataController();i.addItems(k);document.body.appendChild(g.getBox());g.show();a.custEvent.add(g,"hidden",x.showFavSucc);a.custEvent.add(g,"hidden",x.bubbleHide);x.setPos();o=a.position(c.el);n=setInterval(x.setPos,1e3);h.resetHeight();h.focusInput()},A=function(){p&&p.destroy&&p.destroy();clearInterval(n);j&&j.destroy();h&&h.destroy();a.removeNode(g.getBox());g&&g.destroy();a.custEvent.undefine(h);d=e=h=i=j=k=n=o=undefined;f=n=q=r=s=x=z=B=A=p=undefined},B=function(){t();u();v();w();y();a.lib.kit.touch.cantouch||z()};B();l.destroy=A;return l}});
STK.register("lib.feed.plugins.favorite.init",function(a){var b=a.lib.kit.extra.language,c,d=b('<span class="pos"><span class="line S_line1">#L{}</span></span>'),e=b('<span class="pos"><span class="line S_line1">#L{}</span></span>'),f=b("#L{}"),g=b("#L{}"),h,i,j=function(){window.location.href="/fav";return},k=function(i,k,l,m,n,o,p,q){h&&h.destroy();var r=!0;n===!1&&o===!0&&(r=!1);h=a.lib.feed.plugins.favorite.favorite({showTip:r,mid:m,node:k,bubbleEl:q,mark:p});if(!h)a.log("favoriteObj is undefined!");else{var s=a.sizzle(">span",k).length?d:f;a.custEvent.add(h,"success",function(d,e){if(n&&!o){h&&h.destroy();l.style.height=l.offsetHeight+"px";l.innerHTML="";var f=a.tween(l,{end:function(){f.destroy();a.removeNode(l);k=l=null;var b=a.lib.kit.extra.parseURL(),c=a.core.json.queryToJson(b.query),d="";b.path=="fav"&&(d="page");a.custEvent.fire(i,"request",[d,c]);i.getFeedCount()<1&&j()}}).play({height:0})}else{k.innerHTML=s;k.setAttribute("favorite",o?"1":"0");if(o&&e.data&&e.data.ispower){k.setAttribute("tagBubble","1");try{var g=a.lib.feed.plugins.favorite.tagBubble({mid:m,el:q||k,serverData:e.data||{}})}catch(p){console.log(p)}a.custEvent.add(g,"success",function(b,c){a.custEvent.undefine(g);g=undefined;c.blankNoTag||h.showSuccTip(q||k);k.removeAttribute("tagBubble")});a.custEvent.add(g,"error",function(c,d){a.custEvent.undefine(g);g=undefined;h.showErrTip(q||k,d.msg||b("#L{}"));k.removeAttribute("tagBubble")})}}c=null});a.custEvent.add(h,"fail",function(){c=null});a.custEvent.add(h,"error",function(){c=null});a.custEvent.add(h,"cancel",function(){c=null});if(o)h.add();else{s=a.sizzle(">span",k).length?e:g;h.del()}}},l=function(a,b,d,e,f,g){var j=b.el,l=i.getMid(j,d),m=b.data.mark,n=i.getFeedNode(j,d);if(c!=l){j.getAttribute("tagBubble")&&setTimeout(function(){h&&h.msgTipDetroy()},0);c=l;var o=j.getAttribute("favorite")!="1";k(a,j,n,l,e,o,m,g)}};return function(b,c){if(!b)a.log("favorite : need object of the baseFeedList Class");else{c=a.parseParam({isFavoritePage:!1},c);i=b.utils;var d=b.getNode(),e={};a.custEvent.define(e,"showForward");var f=function(f){a.custEvent.fire(b,"clearTips","favorite");var g=f.el,h=g.dataset&&g.dataset.mark||g.getAttribute("data-mark")||"",j={};h&&(j=a.queryToJson(h));f.data=a.core.json.merge(f.data,j);l(b,f,d,c.isFavoritePage,e,f.bubbleEl);return i.preventDefault(f.evt)};b.getDEvent().add("fl_favorite","click",f);b.regCustEvent("fl_favorite_plus",function(a,b){f(b)});e.hideTip=function(a){h&&(a?h.hideTip():h.anihideTip());setTimeout(function(){h&&h.msgTipDetroy()},0)};e.destroy=function(){h&&h.destroy()};return e}}});
STK.register("lib.kit.dom.rotateImage",function(a){var b={},c=function(c){var d=a.core.dom.uniqueID(c);return b[d]||(b[d]={})},d={0:0,90:1,180:2,270:3},e=function(a,b){a=((b||0)+a)%360;a<0&&(a=360+a);var c=Math.PI*a/180,d=Math.round(Math.cos(c)*Math.pow(10,15))/Math.pow(10,15),e=Math.round(Math.sin(c)*Math.pow(10,15))/Math.pow(10,15);return{sin:e,cos:d,M11:d,M12:-e,M21:e,M22:d,angle:a,rotation:c}},f=function(b,c,f,g){f=f||440;var h=e(c,g.oldAngle);c=g.oldAngle=h.angle;b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+h.M11+",M12="+h.M12+",M21="+h.M21+",M22="+h.M22+",SizingMethod='auto expand')";a.setStyle(b.parentNode,"position","relative");if(d[c]%2==0){b.width=g.originalWidth;b.height=g.originalHeight;a.setStyle(b.parentNode,"height",b.height+"px");a.setStyle(b,"position","static")}else if(d[c]%2==1){b.height=g.originalHeight>f?f:g.originalHeight;b.width=b.height*g.originalWidth/g.originalHeight;a.setStyle(b.parentNode,"height",b.width+"px");a.setStyle(b,"position","absolute");a.setStyle(b,"left",Math.abs((b.parentNode.offsetWidth-b.height)/2)+"px");a.setStyle(b,"top","0")}},g=function(a,b,c,d){var e=a;d.oldAngle=e.angle=((e.angle==undefined?0:e.angle)+b)%360;if(e.angle>=0)var f=Math.PI*e.angle/180;else var f=Math.PI*(360+e.angle)/180;var g=Math.cos(f),h=Math.sin(f),i=document.createElement("canvas");e.oImage?i.oImage=e.oImage:i.oImage=e;var j=new Image;j.onload=function(){i.style.width=i.width=Math.abs(g*j.width)+Math.abs(h*j.height);i.style.height=i.height=Math.abs(g*j.height)+Math.abs(h*j.width);if(i.width>c){i.style.width=c+"px";i.style.height=c*j.width/j.height+"px"}var a=i.getContext("2d");a.save();f<=Math.PI/2?a.translate(h*j.height,0):f<=Math.PI?a.translate(i.width,-g*j.height):f<=1.5*Math.PI?a.translate(-g*j.width,i.height):a.translate(0,-h*j.width);a.rotate(f);try{a.drawImage(j,0,0,j.width,j.height)}catch(b){}a.restore();i.angle=e.angle;e.parentNode.replaceChild(i,e);i.id=e.id;j.onload=null};j.src=i.oImage.src;return i},h=function(){var a=["transform","MozTransform","webkitTransform","OTransform"],b=0,c=document.createElement("div").style;while(a[b]&&!(a[b]in c))++b;return a[b]}(),i=function(b,c,f,g){var i=e(c,g.oldAngle),j;c=g.oldAngle=i.angle;if(!g.rotated){g.rotated=!0;j=a.C("div");j.style.position="relative";g.textAlign=j.style.textAlign=a.getStyle(b.parentNode,"textAlign");b.parentNode.insertBefore(j,b);j.appendChild(b);b.style.position="absolute"}else j=b.parentNode;if(d[c]%2==0){g.originalWidth>f?g.imgViewWidth=b.width=f:g.imgViewWidth=b.width=g.originalWidth;g.imgViewHeight=b.height=g.originalHeight}else if(d[c]%2==1){g.originalHeight>f?g.imgViewWidth=b.height=f:g.imgViewWidth=b.height=g.originalHeight;g.imgViewHeight=b.width=b.height*g.originalWidth/g.originalHeight}j.style.height=g.imgViewHeight+"px";f>j.offsetWidth&&(j.style.width=f+"px");b.style[h]="matrix("+i.M11+","+i.M21+","+i.M12+","+i.M22+", 0, 0)";var k=(g.imgViewHeight-g.imgViewWidth)/2,l=(g.imgViewWidth-g.imgViewHeight)/2;if(d[c]%2==0){b.style.top="0px";g.textAlign=="center"?b.style.left=(j.offsetWidth-g.imgViewWidth)/2+"px":b.style[g.textAlign=="right"?"right":"left"]="0px"}else{b.style.top=k+"px";g.textAlign=="center"?b.style.left=l+(j.offsetWidth-g.imgViewWidth)/2+"px":b.style[g.textAlign=="right"?"right":"left"]=l+"px"}},j=function(b,d,e){var j=c(b);if(!("originalWidth"in j)){j.originalWidth=b.width;j.originalHeight=b.height}e||(e=j.originalWidth);h?i(b,d,e,j):"getContext"in a.C("canvas")?g(b.canvas?b.canvas:b,d,e,j):"filters"in a.C("div")&&f(b,d,e,j)},k={rotateRight:function(a,b,c){j(a,b==undefined?90:b,c)},rotateLeft:function(a,b,c){j(a,b==undefined?-90:-b,c)},rotateDefault:function(a){var b=c(a);b.oldAngle&&j(a,360-b.oldAngle,b.originalWidth)},removeDataCache:function(c){var d=a.uniqueID(c),e;if(h)if(e=c.parentNode&&c.parentNode.parentNode){c.parentNode.parentNode.insertBefore(c,e);a.removeNode(e)}b[d]&&delete b[d]},destroy:function(){b={}}};return k});
STK.register("lib.kit.dom.fix",function(a){function f(c,e,f){if(!!d(c)){var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.core.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){h<o&&(h=o);i<p&&(i=p)}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++)typeof b[c]!="number"&&(b[c]=0);return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=!0,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){b||b&&a.core.evt.removeEvent(window,"scroll",n);a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);k&&(!b||i=="c")&&f(d,i,j)}b||a.core.evt.addEvent(window,"scroll",n);a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("lib.face.destroyFlash",function(a){var b=a.core.util.browser,c=function(a){if(a){for(var b in a)typeof a[b]=="function"&&(a[b]=null);a.parentNode.removeChild(a)}};return function(d){if(!!a.isNode(d)&&d&&d.nodeName==="OBJECT")if(a.IE&&b.OS==="windows"){d.style.display="none";(function(){d.readyState===4?c(d):setTimeout(arguments.callee,10)})()}else d.parentNode.removeChild(d)}});
STK.register("lib.face.magic",function(a){var b=a.core.util.swf,c=a.ui.mask,d,e,f,g,h,i,j,k=(new Date).getTime()+"",l=(Math.random()+"").replace(".",""),m="STK_flash_"+k+l,n=function(b){if(!d){d=a.C("div");if(!b)d.style.cssText="display:none;width:440px;height:360px;z-index:100000;";else{var c=a.core.util.winSize();d.style.cssText="display:none;width:"+c.width+"px;height:"+c.height+"px;z-index:100000;"}e=a.core.dom.uniqueID(d);h=function(b){b=a.fixEvent(b||window.event);b.target.getAttribute("name")!=e&&o.hide()};document.body.appendChild(d)}},o=function(k,l,p){j=typeof l=="function"?l:a.funcEmpty;p=a.parseParam({isV5update:!1},p);n(p.isV5update);if(!f){f=!0;c.showUnderNode(d);a.addEvent(c.getNode(),"click",h);c.getNode().title="";d.style.display="";if(!p.isV5update){g?g.setAlign("c"):g=a.lib.kit.dom.fix(d,"c");d.innerHTML=b.html(k,{id:e,width:440,height:360,paras:{allowScriptAccess:"never",wmode:"transparent"},attrs:{name:e},flashvars:{playMovie:"true"}})}else{g?g.setAlign("lb"):g=a.lib.kit.dom.fix(d,"lb");_closeFun=function(){o.hide()};d.innerHTML=b.html(k,{id:e,width:"100%",height:"100%",paras:{menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"transparent",base:"http://flashcrossdomain.mps.weibo.com/t5/home/static/upgrade/v5/"},attrs:{name:e},flashvars:{closeAPI:m,v:$CONFIG.version,bgMusic:"http://service.weibo.com/staticjs/v5/bg001.mp3"}})}clearInterval(i);i=setInterval(function(){var a=document[e]||window[e],b=0;if(a&&a.PercentLoaded()==100){clearInterval(i);i=setInterval(function(){var c=a.CurrentFrame(),d;try{d=a.TotalFrames()}catch(e){d=a.TotalFrames}c<0||(c<d&&b<=c?b=c:o.hide())},80)}},100)}};o.hide=function(){clearInterval(i);if(d){d.style.display="none";a.lib.face.destroyFlash(a.sizzle("embed,object",d)[0]);d.innerHTML=""}a.removeEvent(c.getNode(),"click",h);c.getNode().title="";c.back();f=!1;setTimeout(function(){typeof j=="function"&&j()},0);return o};o.destroy=function(){o.hide();g&&g.destroy();a.removeNode(d);i=d=e=f=g=h};window[m]=function(){o.hide()};return o});
STK.register("lib.feed.widget",function(a){var b={};return{add:function(c,d){if(!b[c]){b[c]=a.widget.parse(d);b[c].init()}},clear:function(a){if(b[a]){b[a].destroy();delete b[a]}},destroy:function(){for(var a in b){b[a].destroy();delete b[a]}}}});
STK.register("lib.kit.extra.actionData",function(a){return function(b){return{set:function(c,d){if(!!a.isNode(b)){var e=a.queryToJson(b.getAttribute("action-data")||"")||{};e[c]=d;b.setAttribute("action-data",a.jsonToQuery(e))}},del:function(c){if(!!a.isNode(b)){var d=a.queryToJson(b.getAttribute("action-data")||"")||{};delete d[c];b.setAttribute("action-data",a.jsonToQuery(d))}},get:function(c){if(!a.isNode(b))return"";var d=a.queryToJson(b.getAttribute("action-data")||"")||{};return d[c]||""}}}});
STK.register("conf.trans.feed.attitude",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.interactiveUrl;c("miniadd",{url:d+"?fajtype=like_add",method:"post"});c("minismall",{url:d+"?fajtype=like_small",method:"get"});c("minidel",{url:d+"?fajtype=like_del",method:"post"});c("objLike",{url:d+"?fajtype=like_objectlike",method:"post"});c("cmtLike",{url:d+"?fajtype=like_commentlike",method:"get"});c("cmtLikeMore",{url:d+"?fajtype=like_cmtlikemore",method:"get"});return b});
STK.register("lib.feed.plugins.like.likestatus",function(a){var b={},c={},d=a.conf.trans.feed.attitude,e=function(a,c,e){d.getTrans("likeStatus",{onSuccess:function(c){var d=c.data.count,f=c.data.exists;for(var g in d){!b[g]&&(b[g]={});b[g].count=d[g]}for(var g in f)b[g].exits=f[g];e(b[a],b)},onError:function(){},onFail:function(){}}).request({object_ids:c})};return e});
STK.register("lib.kit.extra.feedControlHash",function(a){var b=$CONFIG.g_mathematician||0;return function(){var c=Math.random();c<=b&&a.lib.kit.extra.setPlainHash("_rnd"+(+(new Date)).toString())}});
STK.register("lib.feed.plugins.media",function(a){var b,c=a.lib.feed.feedTemps,d=a.core.util.easyTemplate,e=a.lib.kit.extra.language,f=e("#L{}!"),g=e("#L{}"),h=e("#L{}"),i=a.core.util.browser.IE,j=60,k=a.conf.trans.feed.feed,l=450,m=function(b,c){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},n=function(e,f,g,h){var i=e.el,j=e.data,k=decodeURIComponent(j.pic_objects||""),n=k.split("|");if(!i.loading){i.tagName.toLowerCase()!=="img"&&(i=a.sizzle("img",i)[0]);i.loading=1;var o=/\/(thumbnail|wap180|thumb180)\/.+(?=\.\w+)/.exec(i.src);o&&(o=o[0].replace(/\/(thumbnail|wap180|thumb180)\//,""));var p=i.src.replace(/\/(thumbnail|wap180|thumb180)\//,"/bmiddle/"),q="http://photo.weibo.com/"+j.uid+"/wbphotos/large/photo_id/"+j.mid+"?refer=weibofeedv5",r=b.getFeedNode(i,f),s=r.getAttribute("isForward")?1:"",t=b.getMid(i,f),u="pid="+(j.pid?j.pid:o)+"&mid="+j.mid+"&uid="+j.uid+"&pic_objects="+j.pic_objects,v,w;if(!r){a.log("parents attribute mid node is undefined!");return}r.isForward=s;var x=m(r,s);if(!x||!x.prev||!x.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return}if(g.voteObj[t]){g.voteObj[t].destroy();delete g.voteObj[t]}var y=function(){i.loading=0;if(v){i.bigImgWidth=v.width;v.onload=null}w&&(w.style.display="none");x.prev.style.display="none";x.disp.innerHTML="";x.disp.appendChild(a.builder(d(c.mediaIMGTEMPwithBtn,{notForward:!s,uniqueId:a.core.util.getUniqueKey(),bigSrc:p,acdata:u,notShowLikeBtn:k!="",pid:j.pid?j.pid:o,mid:j.mid,is_liked:+n[1],count:n[2]||0,object_id:n[3],bigWidth:i.bigImgWidth>l?l:i.bigImgWidth,suda:{retract:"key=feed_image_click&value=image_zoomout",showBig:"key=tblog_newimage_feed&value=single_larger_image",left:"key=feed_image_click&value=image_turnlift",right:"key=feed_image_click&value=image_turnright",big:"key=feed_image_click&value=image_zoomout"}}).toString()).box);x.disp.style.display="";var b=a.sizzle('[node-type="count"]',x.disp)[0];b&&b.innerHTML=="(0)"&&a.removeNode(b);var e=a.sizzle('[action-type="feed_list_image_like"]',r)[0];if(j.object_ids){var f=decodeURIComponent(j.object_ids);a.lib.feed.plugins.like.likestatus(f,f,function(a){a.exits==!0?innerHTML='<a class="W_btn_alpha" title="" href="javascript:"><i class="icon_praised"></i>'+(a.count?"<span>("+a.count+")</span>":"")+"</a>":innerHTML='<a class="W_btn_alpha" title="" href="javascript:"><i class="icon_praise"></i>'+(a.count?"<span>("+a.count+")</span>":"")+"</a>";e.innerHTML=innerHTML;e.setAttribute("action-data","object_id="+f+"&mid="+j.mid+"&photo_id="+(j.pid?j.pid:o)+"&count="+a.count);e.style.display=""})}else e.style.display="none";var g=a.sizzle('[action-type="feed_list_media_bigimg"]',r)[0];a.lib.image.multiimage.showtag({container:"",img:g,postdata:{mid:j.mid,pid:j.pid?j.pid:o}})};if(i.bigImgWidth)y();else{var z=i.offsetWidth,A=parseInt(i.offsetHeight/2-8);(w=a.core.dom.next(i)).style.cssText="margin:"+A+"px "+parseInt(z/2-8)+"px "+A+"px -"+parseInt(z/2+8)+"px;";(v=new Image).onload=y;v.src=p}}},o=function(c,d,e){var f=c.el;if(!!e||!!/(img)|(canvas)/.test(c.evt.target.tagName.toLowerCase())){var g=b.getFeedNode(f,d);if(!g){a.log("parents attribute mid is undefined!");return}g.disp="";var h=m(g,g.isForward);if(!h||!h.prev||!h.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return}a.position(h.disp).t<a.scrollPos().top&&g.scrollIntoView();h.prev.style.display="";h.disp.style.display="none";h.disp.innerHTML=""}},p=function(c,d,e){var f=c.el,g=b.getFeedNode(f,d);if(!f.parentNode.uid){var h=a.sizzle('img[action-type="feed_list_media_bigimg"]',g)[0];f.parentNode.uid="rotate_img_"+a.core.dom.uniqueID(h);h.setAttribute("id",f.parentNode.uid)}a.lib.kit.dom.rotateImage.rotateRight(a.E(f.parentNode.uid),e,l)},q=function(e,g,h,l){var n=e.el,o=e.data,p=b.getFeedNode(n,g),q=p.getAttribute("isForward")?"1":"",r=b.getMid(n,g),t=m(p,q);if(!t||!t.prev||!t.disp)a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');else{if(p.disp==o.short_url)return;if(l.voteObj[r]){l.voteObj[r].destroy();delete l.voteObj[r]}p.disp=o.short_url;p.isForward=q;t.prev.style.display="none";var u=decodeURIComponent(o.title),v=a.bLength(u)>71?a.leftB(u,70)+"...":u;u=a.bLength(u)>24?a.leftB(u,23)+"...":u;t.disp.innerHTML="";t.disp.appendChild(a.builder(d(c.mediaVideoMusicTEMP,{notForward:!q,short_url:decodeURIComponent(o.short_url),full_url:decodeURIComponent(o.full_url),title:u,fTitle:v,type:h}).toString()).box);t.disp.style.display="";var w=a.sizzle('div[node-type="feed_list_media_big'+h+'Div"]',t.disp)[0];if(!w){a.log('media: node-type="feed_list_media_big'+h+'Div" is not be found in feed_list_media_disp node!');return}l.dispContentNode[r]=w;var x="default";try{i?x="object":navigator.plugins["Shockwave Flash"]?x="embed":x="html5"}catch(y){}var z=function(){w.innerHTML=f},A=function(b){if(!b.result||b.error_code||b.error)z();else{var c=l.dispContentNode[r];c.mediaData=b.result;c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);s&&s.setFixed(!0)}};k.request("mediaShow",{onComplete:A,onFail:z},{vers:3,lang:$CONFIG.lang,mid:r,short_url:o.short_url.replace(/http\:\/\/(t|sinaurl)\.cn\//,""),template_name:x,source:"3818214747"});if(h==="video"){a.scrollTo(t.disp,{step:1,top:j});setTimeout(function(){($CONFIG.islogin=="2"||$CONFIG.islogin=="0")&&a.lib.dialog.loginLayer()},1e3)}}},r,s,t=function(e,f,g){r&&a.fireEvent(r,"click");var h=e.el,i=e.data.title,j=b.getMid(h,f),k=g.dispContentNode[j],l=k.mediaData,m=a.builder(d(c.mediaVideoMusicFloatTEMP,{title:a.encodeHTML(i)}).toString()),n=m.list.outer[0],p=m.list.mediaContent[0];r=m.list.close[0];document.body.appendChild(n);s=a.lib.kit.dom.fix(n,"rb");if(l){p.innerHTML="";p.appendChild(a.builder(l).box);s.setFixed(!0)}else g.dispContentNode[j]=p;a.addEvent(r,"click",function(){a.removeEvent(r,"click",arguments.callee);s&&s.destroy();if(a.IE){var b=a.sizzle("object",n);for(var c=0,d=b.length;c<d;c++){var e=b[c];e&&(e=e.parentNode)&&(e.innerHTML="")}}a.removeNode(n);s=m=n=r=null});o(e,f,!0)},u=function(){r&&a.fireEvent(r,"click")},v=function(e,g,h){var i=e.el,j=b.getMid(i,g),l=e.data,n=b.getFeedNode(i,g),o=n.getAttribute("isForward")?"1":"",p=m(n,o);if(n.disp!=l.short_url&&!!p.disp){p.disp.innerHTML="";a.lib.feed.widget.clear(j);p.disp.appendChild(a.builder(d(c.widgetTEMP,{notForward:!o,short_url:decodeURIComponent(l.short_url),full_url:decodeURIComponent(l.full_url),title:decodeURIComponent(l.title),suda:decodeURIComponent(l.suda||"")}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var q=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',p.disp)[0];k.request("widget",{onSuccess:function(b){b=b.data;if(!!b.html){q.innerHTML=b.html;a.lib.feed.widget.add(j,p.disp)}},onFail:function(a){q.innerHTML=a&&a.msg||f},onError:function(a){q.innerHTML=a&&a.msg||f}},{short_url:decodeURIComponent(l.short_url),isforward:o,mid:j});n.disp=l.short_url;n.isForward=o}},w=function(a){return a==document.body?!1:a.getAttribute("feedtype")=="ad"?a:arguments.callee(a.parentNode)},x=function(e,g,h){var i=e.el,j=b.getMid(i,g),l=e.data,n=b.getFeedNode(i,g),o=n.getAttribute("isForward")?"1":"",p=m(n,o);if(n.disp!=a.jsonToStr(l)){p.disp.innerHTML="";a.lib.feed.widget.clear(j);p.disp.appendChild(a.builder(d(c.widgetTEMP,{notForward:!o,short_url:l.short_url&&decodeURIComponent(l.short_url),full_url:l.full_url&&decodeURIComponent(l.full_url),title:l.title&&decodeURIComponent(l.title),suda:decodeURIComponent(l.suda||"")}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var q=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',p.disp)[0],r=w(i);if(r){var s=r.getAttribute("data-mark");s=a.queryToJson(s)||{};l=a.lib.kit.extra.merge(l,s)}k.request("third_rend",{onSuccess:function(b){b=b.data;if(!!b.html){q.innerHTML=b.html;a.lib.feed.widget.add(j,p.disp)}},onFail:function(a){q.innerHTML=a&&a.msg||f},onError:function(a){q.innerHTML=a&&a.msg||f}},a.lib.kit.extra.merge({isforward:o,mid:j},l));n.disp=a.jsonToStr(l);n.isForward=o}},y=function(e,f,h){var i=e.el,k=b.getMid(i,f),l=e.data,n=b.getFeedNode(i,f),o=n.getAttribute("isForward")?"1":"",p=m(n,o);if(n.disp!=l.short_url){p.disp.innerHTML="";a.lib.feed.widget.clear(k);p.disp.appendChild(a.builder(d(c.qingTEMP,{notForward:!o,short_url:decodeURIComponent(l.short_url),full_url:decodeURIComponent(l.full_url),title:decodeURIComponent(l.title),suda:decodeURIComponent(l.suda||"")}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var q=a.sizzle('div[node-type="feed_list_media_qingDiv"]',p.disp)[0],r=function(b){var c=b.code;if(c+""=="1"){b=b.data;if(!b.result)return;q.innerHTML=b.result;a.lib.feed.widget.add(k,p.disp)}else s(b)},s=function(a){q.innerHTML=g},t=l.template_name;t?t=="video"&&(a.IE?t="object":navigator.plugins&&navigator.plugins["Shockwave Flash"]?t="embed":t="html5"):t="";b.getTrans("qingShow",{onComplete:r,onFail:s}).request({short_url:l.short_url,lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn",mid:k,vers:3,template_name:t});n.disp=l.short_url;n.isForward=o;a.scrollTo(p.disp,{step:1,top:j})}};return function(c,d){if(!c)a.log("media : need object of the baseFeedList Class");else{var f=c.getNode(),g=c.getDEvent();b=c.utils;var h={},i=!0,j={dispContentNode:{},voteObj:{}},k=function(){a.custEvent.fire(c,"clearTips","media")};g.add("feed_list_media_toSmall","click",function(c){a.lib.feed.widget.clear(b.getMid(c.el,f));k();o(c,f,!0);return b.preventDefault(c.evt)});g.add("feed_list_media_img","click",function(c){k();a.lib.image.multiimage.hastags().add(c.data.photo_tag_pids);a.lib.kit.extra.feedControlHash();n(c,f,j,d);return b.preventDefault(c.evt)});g.add("feed_list_media_bigimgDiv","click",function(a){k();o(a,f);return b.preventDefault(a.evt)});g.add("feed_list_media_toRight","click",function(a){k();p(a,f,90);return b.preventDefault(a.evt)});g.add("feed_list_media_toLeft","click",function(a){k();p(a,f,-90);return b.preventDefault(a.evt)});g.add("feed_list_media_video","click",function(a){k();q(a,f,"video",j);return b.preventDefault(a.evt)});g.add("feed_list_media_music","click",function(b){a.preventDefault();k();q(b,f,"music",j);return});g.add("feed_list_media_toFloat","click",function(d){k();a.custEvent.fire(c,"clearToFloat");t(d,f,j);return b.preventDefault(d.evt)});a.custEvent.define(c,"clearToFloat");a.custEvent.add(c,"clearToFloat",u);g.add("feed_list_media_magic","click",function(c){k();c.data.swf?a.lib.face.magic(c.data.swf):a.log(": nodeaction-data swf!");return b.preventDefault(c.evt)});g.add("feed_list_media_v5update","click",function(c){k();c.data.swf?a.lib.face.magic(decodeURIComponent(c.data.swf),undefined,{isV5update:!0}):a.log(": nodeaction-data swf!");return b.preventDefault(c.evt)});g.add("feed_list_media_widget","click",function(c){var d=a.fixEvent(c.evt),e=d.target,g=b.getFeedNode(e,f),h=a.lib.kit.dom.parseDOM(a.builder(g).list),i=h.feed_list_pulishMood;if(i){a.isArray(i)||(i=[i]);for(var l=0,m=i.length;l<m;l++){var n=i[l];if(e==n||a.core.dom.contains(n,e))return}}k();v(c,f,j);return b.preventDefault(c.evt)});g.add("feed_list_third_rend","click",function(a){k();x(a,f,j);return b.preventDefault(a.evt)});g.add("feed_list_media_qing","click",function(a){k();y(a,f,j);return b.preventDefault(a.evt)});g.add("feed_list_url","click",function(a){var c=a.el,d=b.getMid(c,f),e=b.getFeedNode(c,f),g="";e&&(g=e.getAttribute("minfo")?"&"+e.getAttribute("minfo"):"");var h=e.dataset&&e.dataset.mark||e.getAttribute("data-mark")||"";h?window.open(c.href+"?u="+$CONFIG.oid+"&m="+d+"&cu="+$CONFIG.uid+"&"+h+g):window.open(c.href+"?u="+$CONFIG.oid+"&m="+d+"&cu="+$CONFIG.uid+g);return b.preventDefault()});g.add("vote_toSmallInfo","click",function(c){var d=c.el,e=b.getFeedNode(d,f),g=a.lib.kit.dom.parseDOM(a.builder(e).list);g.vote_bigInfo&&(g.vote_bigInfo.style.display="none");g.vote_smallInfo&&(g.vote_smallInfo.style.display="");return a.preventDefault(c.evt)});g.add("vote_toBigInfo","click",function(c){var d=c.el,e=b.getFeedNode(d,f),g=a.lib.kit.dom.parseDOM(a.builder(e).list);g.vote_smallInfo&&(g.vote_smallInfo.style.display="none");g.vote_bigInfo&&(g.vote_bigInfo.style.display="");return a.preventDefault(c.evt)});g.add("vote_refresh_code","click",function(b){var c=b.el,d=c.src.replace(/ts=.+/,"")+"ts="+a.getUniqueKey();c.src=d;return a.preventDefault(b.evt)});g.add("feed_list_image_like","click",function(c){if(!!i){i=!1;var d=c.el,g=a.core.json.merge(c.data,{location:$CONFIG.location,object_type:"pic",ref:"feed"});a.conf.trans.feed.attitude.getTrans("objLike",{onSuccess:function(c,g){var h=c.data.is_del?!0:!1,j=g.count;h?j--:j++;var k=j>0?j:0,l;h?l=k!=0?e('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praise"></i><span>('+k+")</span></a>"):e('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praise"></i></a>'):l=k!=0?e('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praised"></i><span>('+k+")</span></a>"):e('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praised"></i></a>');d.innerHTML=l;var n=a.lib.kit.extra.actionData(d);n.set("count",k);n.set("is_liked",h?0:1);var o=b.getFeedNode(d,f),p=o.getAttribute("isForward")?1:"",q=m(o,p),r=a.sizzle('[action-type="feed_list_media_img"]',q.prev)[0],s=a.lib.kit.extra.actionData(r),t=decodeURIComponent(s.get("pic_objects")),u=t.split("|");u[1]=h?0:1;u[2]=k;s.set("pic_objects",encodeURIComponent(u.join("|")));var v=a.sizzle('[action-type="widget_photoview"]',q.disp)[0],w=a.lib.kit.extra.actionData(v);w.set("pic_objects",encodeURIComponent(u.join("|")));i=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);i=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);i=!0}}).request(g)}});g.add("fl_url_addparams","click",function(a){var c=a.el,d=b.getMid(c,f),e=b.getFeedNode(c,f),g="";e&&(g=e.getAttribute("tbinfo")?"&"+e.getAttribute("tbinfo"):"");var h=e.getAttribute("omid")||"",i=e.getAttribute("data-mark");i=i?"&"+i:"";var j="mid="+d+(h?"&omid="+h:"")+g+i;window.open(c.href.indexOf("?")>-1?c.href+"&"+j:c.href+"?"+j);return b.preventDefault()});window.playCompleted=function(){$CONFIG.islogin=="1"&&location.href.indexOf("spr_sinamkt_buy_baiduv_weibouv_v001")!=-1&&a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})};h.destroy=function(){s&&s.destroy();f=g=undefined;a.lib.feed.widget.destroy();a.custEvent.remove(c,"clearToFloat",u);window.playCompleted=null};return h}}});
STK.register("lib.image.multiimages",function(a){var b=a.lib.feed.imageLikeWhiteList(),c=$CONFIG.imgPath,d='<div style="top:0px;left:0px;display:none;" node-type="recLayer" class="W_layer WB_outReset"></div>',e='<#et recimg data><ul class="pic_list clearfix"><#list data.recimgs as list><li><a target="_blank" href="${list.imgsrc}"><img src="${list.img}"></a></li></#list></ul></#et>',f='<#et images data><div node-type="imagesBox" class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><#if (data.toSmall == 1)><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{}</a></span></li></#if><li><span class="line S_line1"><a action-type="turnLeft" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{}</a></span></li><li><span class="line S_line1"><a action-type="turnRight" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnright S_ficon">n</i>#L{}</a></span></li></ul></div></div><div class="WB_media_view"><div class="media_show_box">          <ul class="clearfix" node-type="picShow"><!--leftcursorrightcursor,smallcursor--><li node-type="imgBox" class="leftcursor"><div class="artwork_box"><div node-type="imgSpanBox"><img node-type="imgShow" src="${data.currentUrl}"></div><span node-type="multi_image_like" style="display:none;" action-type="multi_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}"><a href="" class="W_btn_alpha" title=""><i class="icon_praise"></i><span></span></a><a href="" class="W_btn_alpha" title=""><i class="icon_praised"></i><span>(3220000)</span></a></span></div><i node-type="loading" style="display: none;" class="W_loading"></i></li></ul>'+d+"</div>"+'<div class="pic_choose_box clearfix">'+'<a href="javascript:;" node-type="prev" action-type="prev" class="arrow_left_small S_bg2 arrow_dis" title=""><i class="W_ficon ficon_arrow_left S_ficon">b</i></a>'+'<div class="stage_box">'+'<ul node-type="picChoose" class="choose_box clearfix">'+"<#list data.picChoose as picChoose>"+'<li><a href="javascript:;"<#if (picChoose.pid == data.currentPid)> class="current"</#if> node-type="thumbItem" action-type="thumbItem" action-data="pid=${picChoose.pid}"><img class="S_line2" src="${picChoose.url}" alt=""></a></li>'+"</#list>"+"</ul>"+"</div>"+'<a href="javascript:;" node-type="next" action-type="next" class="arrow_right_small arrow_dis S_bg2" title="#L{}"><i class="W_ficon ficon_arrow_right S_ficon">a</i></a>'+"</div>"+" </div>"+"</div>"+"</#et>";return function(b){var c={},d,e,g="",h=0,i=0,j="",k,l,m={},n=450,o=!1,p=!1,q=!1,r=a.lib.kit.extra.language,s=[],t,u="",v=a.parseParam({currentPid:"",pids:[],object_ids:"",pic_objects:"",picShowWidth:440,sum:7,thumbWidth:59,mid:"",uid:"",isForward:0,toSmall:1},b),w=[],x=[],y=[],z=[],A=!0,B,C={pic:[3,7],rec:[1,8.6]},D={getIndex:function(a,b){var c=0;for(var d=0;a[d];d++)if(a[d]==b){c=d;break}return c},setPic:function(b,c){var e=b.pid;if(!(!e&&(j=e)||e==j)){var f=a.lib.kit.extra.imageURL(e,{size:"bmiddle"}),g=a.C("img");m[e]=g;j=e;d.loading.style.display="";g.onload=function(){g.onload=null;D.setpid();d.loading.style.display="none";var c=a.core.ani.tween(d.imgSpanBox,{duration:150,end:function(){d.imgSpanBox.innerHTML="";a.setStyle(d.imgSpanBox,"height","");d.imgSpanBox.appendChild(g);a.tween(d.imgSpanBox,{duration:100,animationType:"easeoutcubic"}).play({opacity:1}).destroy();D.setLikeStatus(b)}});c.play({opacity:.3}).destroy();setTimeout(function(){var b=g;a.lib.image.multiimage.showtag({container:"",img:b,postdata:{mid:v.mid,pid:e}})},0)};g.src=f;for(var h=0;s[h];h++)s[h].onload=null;s.push(g)}},setIndex:function(b){switch(b){case"min":h--;break;case"add":h++;break;default:h=b}h<0&&(h=0);if(h>i-1){q?h=i:h=i-1;D.showRec()}a.position(d.imagesBox).t<a.scrollPos().top&&a.scrollTo(d.imagesBox,{top:120,step:10});h>i-3&&D.getRecPics();D.setCurrentThumb();D.scrollList()},setLikeStatus:function(a){var b=d.multi_image_like;if(b){a.is_liked?b.innerHTML=+a.count!=0?r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praised"></i><span >('+a.count+")</span></a>"):r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praised"></i></a>'):b.innerHTML=+a.count!=0?r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praise"></i><span>('+a.count+")</span></a>"):r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praise"></i></a>');b.setAttribute("action-data","mid="+v.mid+"&photo_id="+a.pid+"&is_liked="+a.is_liked+"&count="+a.count+"&object_id="+a.object_id);a.object_id?b.style.display="":b.style.display="none"}},showRec:function(){if(!!q){var b=a.core.dom.getSize(d.picShow),c=a.core.dom.getSize(d.recLayer);b.height<c.height&&(d.picShow.style.height=c.height+"px");var e=t||(b.height-c.height)/2;e=e-c.height/2;e>b.height-c.height&&(e=b.height-c.height);e<0&&(e=0);d.imgSpanBox.innerHTML=reclayerHTML;d.multi_image_like.style.display="none";o=!0;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pic_recommend","recommend_exposure")}},scrollList:function(){return function(a,b){var c=Math.floor(v.sum/2),e=h;b&&(e=a);var f=i;if(f>v.sum){var g=e-c;if(g<=0){g=0;d.prev.className!="arrow_left_small arrow_dis S_bg2"&&(d.prev.className="arrow_left_small arrow_dis S_bg2")}else d.prev.className!="arrow_left_small S_bg2"&&(d.prev.className="arrow_left_small S_bg2");if(g>=f-v.sum){g=f-v.sum;d.next.className!="arrow_right_small arrow_dis S_bg2"&&(d.next.className="arrow_right_small arrow_dis S_bg2")}else d.next.className!="arrow_right_small S_bg2"&&(d.next.className="arrow_right_small S_bg2");var j=0-v.thumbWidth*g;l.play({marginLeft:j})}}}(),setCurrentThumb:function(){for(var b in d.thumbItem)a.removeClassName(d.thumbItem[b],"current");d.thumbItem[h]&&a.addClassName(d.thumbItem[h],"current")},rotateImg:function(b,c){var e=b.el,f=a.sizzle("img",d.imgSpanBox)[0];!f&&(f=document.getElementById(u));e.parentNode.uid=a.core.dom.uniqueID(f)+"_"+a.core.util.getUniqueKey();u=e.parentNode.uid;f.setAttribute("id",e.parentNode.uid);a.lib.kit.dom.rotateImage.rotateRight(a.E(e.parentNode.uid),c,n)},getImgsrc:function(a,b,c){var d="http://photo.weibo.com/"+a+"/wbphotos/large/mid/"+b+"/pid/"+c+"?refer=weibofeedv5";return d},setpid:function(){var a="pid="+j+"&mid="+v.mid+"&uid="+v.uid+"&pic_objects="+B},getRecPics:function(){}},E=function(){B=v.pic_objects;var b=decodeURIComponent(v.pic_objects);b=b.split(",");var c=decodeURIComponent(v.object_ids);c=c.split(",");if(c&&c[0]&&c[0]!=""){w=v.pids||[];z=c;a.lib.feed.plugins.like.likestatus(z[h],z.join(","),function(a,b){for(var c=0,d=z.length;c<d;c++){x.push(b[z[c]].exits);y.push(b[z[c]].count)}var e=[];for(var c=0,d=w.length;c<d;c++)e.push(w[c]+"|"+x[c]+"|"+y[c]+"|"+z[c]);B=encodeURIComponent(e.join(","));D.setLikeStatus({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]});D.setpid()})}else for(var e=0,g=b.length;e<g;e++){var m=b[e];m=m.split("|");w.push(m[0]);x.push(m[1]);y.push(m[2]);z.push(m[3])}var n=w.length==1&&w[0]==""?v.pids:w;j=v.currentPid||n[0];i=n.length;h=D.getIndex(n,j);var o=[],p=[];for(var e=0;e<i;e++)p.push({pid:n[e],url:a.lib.kit.extra.imageURL(n[e],{size:"square"})});var q=a.core.util.easyTemplate(r(f),{picShow:o,picChoose:p,currentPid:n[h],currentUrl:a.lib.kit.extra.imageURL(n[h],{size:"bmiddle"}),isForward:v.isForward,toSmall:v.toSmall,pic_objects:v.pic_objects,notShowLikeBtn:v.pic_objects!="",is_liked:+x[h],count:y[h]||0,object_id:z[h],mid:v.mid,pid:n[h]}).toString(),s=a.builder(q);d=a.lib.kit.dom.parseDOM(s.list);b&&b[0]&&b[0]!=""&&(d.multi_image_like.style.display="");k=a.delegatedEvent(d.imagesBox);d.picChoose.style.marginLeft="1px";var t=d.count;t&&t.innerHTML=="(0)"&&a.removeNode(t);l=a.core.ani.tween(d.picChoose,{duration:150});D.setIndex(h);D.setpid();setTimeout(function(){var b=d.imgShow;a.lib.image.multiimage.showtag({container:"",img:b,postdata:{mid:v.mid,pid:n[h]}})},0)},F={gesture:function(b){b=a.fixEvent(b);var c=b.clientX-a.position(d.picShow).l,e=C.pic;o&&(e=C.rec);if(c<v.picShowWidth*e[0]/10)if(h==0)if(v.toSmall==1){d.imgBox.className="clearfix smallcursor";g="small"}else{d.imgBox.className="clearfix";g=""}else{d.imgBox.className="clearfix leftcursor";g="left"}else if(c<v.picShowWidth*e[1]/10)if(v.toSmall==1&&!o){d.imgBox.className="clearfix smallcursor";g="small"}else{d.imgBox.className="clearfix";g=""}else if(c>v.picShowWidth*e[1]/10)if(o)if(v.toSmall==1){d.imgBox.className="clearfix smallcursor";g="small"}else{d.imgBox.className="clearfix";g=""}else{d.imgBox.className="clearfix rightcursor";g="right"}},left:function(){if(!a.inArray(document.activeElement.tagName.toUpperCase(),["TEXTAREA","INPUT","SELECT"])){var b=a.position(d.imagesBox).t,c=a.core.dom.getSize(d.imagesBox).height,e=a.scrollPos().top,f=a.winSize().height;if(e>b+c)return;if(e+f<b)return;D.setIndex("min");D.setPic({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]},!0)}},right:function(){if(!a.inArray(document.activeElement.tagName.toUpperCase(),["TEXTAREA","INPUT","SELECT"])){var b=a.position(d.imagesBox).t,c=a.core.dom.getSize(d.imagesBox).height,e=a.scrollPos().top,f=a.winSize().height;if(e>b+c)return;if(e+f<b)return;D.setIndex("add");D.setPic({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]})}},gestureClick:function(b){var c=a.fixEvent(b);if(c.target.tagName.toLowerCase()!="a"&&c.target.parentNode.tagName.toLowerCase()!="a")switch(g){case"left":o&&F.closeRecLayer();F.left();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed","image_feed_next");break;case"small":F.tosmall();break;case"right":b=a.fixEvent(b);t=b.pageY-a.position(d.picShow).t;F.right();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed","image_feed_next")}},prev:function(){var a=h-7;D.scrollList(a,!0)},next:function(){var a=h+7;D.scrollList(a,!0)},tosmall:function(b){v.toSmall!=0&&a.custEvent.fire(c,"tosmall")},thumbItem:function(a){o&&F.closeRecLayer();var b=a.data.pid,c=D.getIndex(v.pids,b),d=c<h?!0:!1;D.setIndex(c);D.setPic({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]},d);window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed","image_feed_next")},turnRight:function(a){o||D.rotateImg(a,90)},turnLeft:function(a){o||D.rotateImg(a,-90)},closeRecLayer:function(){o=!1},like:function(b){var b=a.fixEvent(b);a.core.evt.stopEvent(b);if(!!A){A=!1;var e=d.multi_image_like,f=a.queryToJson(e.getAttribute("action-data"));f=a.core.json.merge(f,{location:$CONFIG.location,object_type:"pic",ref:"feed"});a.conf.trans.feed.attitude.getTrans("objLike",{onSuccess:function(b,d){var f=b.data.is_del?!0:!1,g=d.count;f?g--:g++;var h=g>0?g:0,i;f?i=h!=0?r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praise"></i><span>('+h+")</span></a>"):r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praise"></i></a>'):i=h!=0?r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praised"></i><span>('+h+")</span></a>"):r('<a class="W_btn_alpha" title="#L{}" href="javascript:"><i class="icon_praised"></i></a>');e.innerHTML=i;var j=a.lib.kit.extra.actionData(e);j.set("count",h);j.set("is_liked",f?0:1);for(var k=0,l=z.length;k<l;k++)if(z[k]==d.object_id){x[k]=f?"0":"1";y[k]=h;break}a.custEvent.fire(c,"rewritedata",{isDel:f,count:h,object_id:d.object_id});A=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);A=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);A=!0}}).request(f)}}},G=function(){d.picShow.style.backgroundImage="url(about:blank)";a.addEvent(d.picShow,"mousemove",F.gesture);a.addEvent(d.picShow,"click",F.gestureClick);a.lib.kit.touch.cantouch&&a.addEvent(d.picShow,"swipeLeft",F.right);a.lib.kit.touch.cantouch&&a.addEvent(d.picShow,"swipeRight",F.left);d.multi_image_like&&a.addEvent(d.multi_image_like,"click",F.like);k.add("tosmall","click",F.tosmall);k.add("thumbItem","click",F.thumbItem);k.add("prev","click",F.prev);k.add("next","click",F.next);k.add("turnLeft","click",F.turnLeft);k.add("turnRight","click",F.turnRight);k.add("closeRecLayer","click",F.closeRecLayer);a.core.evt.hotKey.add(document.body,["ctrl+Left"],F.left);a.core.evt.hotKey.add(document.body,["ctrl+Right"],F.right);a.custEvent.define(c,["tosmall","rewritedata"])},H=function(){E();G()};H();var I=function(){a.removeEvent(d.picShow,"mousemove",F.gesture);a.removeEvent(d.picShow,"click",F.gestureClick);a.lib.kit.touch.cantouch&&a.removeEvent(d.picShow,"swipeLeft",F.right);a.lib.kit.touch.cantouch&&a.removeEvent(d.picShow,"swipeRight",F.left);d.multi_image_like&&a.removeEvent(d.multi_image_like,"click",F.like);a.core.evt.hotKey.remove(document.body,["ctrl+Left"],F.left);a.core.evt.hotKey.remove(document.body,["ctrl+Right"],F.right);k.destroy();a.removeNode(d.imagesBox)},J=function(){return d.imagesBox};c.destroy=I;c.getOuter=J;return c}});
STK.register("lib.image.inImagesList",function(a){return function(){var a={1652503967:!0,1591509437:!0,1143373133:!0,1764389994:!0,1280811967:!0,1729169932:!0,1651510284:!0,1617764514:!0,1946554430:!0,1285469314:!0,1262112935:!0,1676636885:!0,1708288973:!0,1400565967:!0,1495295187:!0,1402678221:!0,1739933965:!0,1570387057:!0,2189475170:!0,1934174435:!0,1957919150:!0,1591319844:!0,1688756227:!0,1210454405:!0,1650751185:!0,1056937372:!0,1727194535:!0,1659551324:!0,2722504223:!0,1809031027:!0,1549063143:!0,1650555225:!0,1151306150:!0,1596771247:!0,1418859182:!0,1005343850:!0,1111681197:!0,1650555225:!0,1514267615:!0,1984946117:!0,1382274984:!0,1674710384:!0,1833036301:!0,1790518657:!0,1680967943:!0,1862732053:!0,1396386905:!0,1708062733:!0,1787875513:!0,2355472515:!0,1161646031:!0,2306169161:!0,1980500411:!0,1663593323:!0,1767645900:!0,2394143903:!0,2126255307:!0,2425455271:!0,1385892075:!0,1233463251:!0,1729076850:!0,1605275581:!0,1957375697:!0,1798857424:!0,2790784425:!0,2016713117:!0,1787355915:!0,1928349275:!0,1658790201:!0,2407023267:!0,1984946117:!0,1970683355:!0},b=$CONFIG.uid.split("");return a[$CONFIG.uid]?!0:(b.pop()||!0)&&b.pop()==4?!0:!1}});
STK.register("lib.feed.plugins.images",function(a){var b=$CONFIG.imgPath;return function(b,c){if(!b)a.log("images : need object of the baseFeedList Class");else{var d=a.lib.image.multiimages,e=b.getNode(),f=b.getDEvent(),g=b.utils,h={},i,j={getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getActionData:function(a,b){return a.tagName.toLowerCase=="body"?null:a.getAttribute("node-type")==b?a.getAttribute("action-data"):arguments.callee(a.parentNode,b)}},k={fl_pics:function(b){var c=g.getFeedNode(b.el,e);if(c.getAttribute("isimgloading")!=="true"){c.setAttribute("isimgloading","true");if(!i){i=a.C("i");i.className="W_loading"}var f=b.data||{};b.el.parentNode.appendChild(i);i.style.display="";var h=a.C("img"),k=j.getPDNodes(c),l=a.core.json.queryToJson(j.getActionData(b.el,"fl_pic_list"));a.lib.image.multiimage.hastags().add(l.photo_tag_pids);var m=l.pic_ids.split(","),n=l.uid,o=l.mid?l.mid:g.getMid(b.el,e),p=f.pic_id||m[0],q=l.pic_objects||"";h.onload=function(){h.onload=null;i.style.display="none";a.removeNode(i);i=null;k.prev.style.display="none";var b=d({pids:m,pic_objects:q,object_ids:l.object_ids||"",currentPid:p,mid:o,uid:n});k.disp.appendChild(b.getOuter());k.disp.style.display="";c.removeAttribute("isimgloading");a.custEvent.add(b,"tosmall",function(d,e){a.position(k.disp).t<a.scrollPos().top&&c.scrollIntoView();k.disp.style.display="none";k.prev.style.display="";b.destroy()});a.custEvent.add(b,"rewritedata",function(b,c){var d=a.sizzle('[node-type="fl_pic_list"]',k.prev)[0],e=a.lib.kit.extra.actionData(d),f=decodeURIComponent(e.get("pic_objects"));f=f.split(",");var g=f.length,h=[],i=[],j=[],l=[];for(var m=0,n=g;m<n;m++){var o=f[m];o=o.split("|");if(o[3]==c.object_id){o[1]=c.isDel?"0":"1";o[2]=c.count}h.push(o[0]);i.push(o[1]);j.push(o[2]);l.push(o[3])}var p=[];for(var m=0,n=g;m<n;m++)p.push(h[m]+"|"+i[m]+"|"+j[m]+"|"+l[m]);e.set("pic_objects",encodeURIComponent(p.join(",")));var q=a.sizzle('[node-type="tobig"]',k.disp)[0],r=a.lib.kit.extra.actionData(q);r.set("pic_objects",encodeURIComponent(p.join(",")))})};var r=a.lib.kit.extra.imageURL(p,{size:"bmiddle"});h.src=r;a.lib.kit.extra.feedControlHash()}}},l=function(){f.add("fl_pics","click",k.fl_pics)},m=function(){l()};m();return h}}});
STK.register("lib.feed.plugins.like.commentLike",function(a){return function(b,c){var d={},e,f,g=1,h=a.conf.trans.feed.attitude,i=!1,j,k=1,l,m,n,o=function(){n=a.lib.kit.extra.language},p={TITLE:"#L{%s}",MAIN:{LOADING:['<div class="quick_reply_list S_line1" node-type="diaContent">','<ul class="clearfix" node-type="commentLikeList">',"#L{...}","</ul>","</div>"].join("")}},q={moreLike:function(b){var c=b.el,d=b.data;h.getTrans("cmtLikeMore",{onSuccess:function(a){var b=a.data.like_counts||0,c=a.data.html;c=n(c);k=parseInt(a.data.page.totalpage);q.newDialog(b,c);q.dialogEvtInit()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)},setLoading:function(){l&&(l.innerHTML=n("#L{...}"))},newDialog:function(b,c){j&&j.destroy&&j.destroy();j=a.ui.dialog("likeDialog_"+a.getUniqueKey());j.setTitle(n(p.TITLE,b));j.setContent(c||"");j.show();j.setMiddle();j.setBeforeHideFn(q.beforeHide);l=a.sizzle("[node-type=commentLikeList]",j.getBox())[0]},getPageData:function(b,c){i=!0;q.setLoading();h.getTrans("cmtLikeMore",{onSuccess:function(a){var b=a.data.html;q.setContent(b);i=!1;c&&c()},onFail:function(b){a.lib.dialog.ioError(b.code,b);i=!1},onError:function(b){a.lib.dialog.ioError(b.code,b);i=!1}}).request(b)},listNextPage:function(a){if(!i){var b=a.data;q.getPageData(b)}},listPrevPage:function(a){if(!i){var b=a.data;q.getPageData(b)}},setContent:function(a){j&&j.setContent&&j.setContent(a)},beforeHide:function(){g=1;q.dialogEvtDestroy();i=!1},dialogEvtInit:function(){f=a.delegatedEvent(j.getBox());f.add("nextPageOfLike","click",q.listNextPage);f.add("prevPageOfLike","click",q.listPrevPage);f.add("like_del","click",c)},dialogEvtDestroy:function(){f&&f.destroy()}},r=function(){e=b;e.add("moreCommentLike","click",q.moreLike)},s=function(){o();r()};s();d.destroy=function(){e&&e.destroy();j&&j.destroy&&j.destroy();l=null;m=null};return d}});
STK.register("conf.channel.like",function(a){var b=["like","unlike"];return a.lib.kit.extra.listener.define("conf.channel.like",b)});
STK.register("lib.feed.plugins.like.init",function(a){return function(b){var c=a.conf.trans.feed.attitude,d=a.lib.kit.extra.language,e=b.getNode(),f=!1,g,h,i={},j=[],k=b.utils,l=b.getDEvent(),m,n=!0,o=[],p={},q,r=null,s,t,u,v,w=600,x=350,y='<div class="W_layer W_layer_pop WB_outReset" style="display:none" node-type="outer"><div class="content"><div class="layer_emotion" node-type="inner"><ul class="emotion_list clearfix" node-type="faceList"></ul></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t" style="right:20px;"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';g=a.lib.kit.dom.parseDOM(a.builder(y).list);document.body.appendChild(g.outer);u=a.delegatedEvent(g.outer);var z,A,B={go:function(b){if(!$CONFIG||!$CONFIG.islogin||$CONFIG.islogin!="2"){A=b.el;var c=a.sizzle("em",b.el)[0];z=parseInt(c.innerHTML)||0;f=!0;if(a.core.dom.contains(b.el,b.evt.relatedTarget)||g&&g.outer.style.display!="none"&&b.data.mid==q&&b.data.object_id==r){D();return}B.stop(b,!0);a.lib.kit.touch.cantouch||(v=setTimeout(function(){B.trans(b)},w))}},fill:function(b){A=b.el;if(!!n){n=!1;var e=a.core.json.merge(b.data,{location:$CONFIG.location}),f="miniadd";b.data.object_type&&b.data.object_type==="comment"&&(f="objLike");c.request(f,{onSuccess:function(c){var f=a.sizzle("em",b.el)[0];z=parseInt(f.innerHTML)||0;var h=c.data.is_del?!0:!1;a.conf.channel.like.fire(h?"unlike":"like",e);var i="W_icon icon_praised_b"+(h?"":"c"),j=h?"":"S_link1";h?z>0&&z--:z++;var k=a.sizzle('[node-type="like_status"]',b.el);z=z<=0?"":z;k[0]&&(k[0].innerHTML='<i node-type="fl_like_icon" class="'+i+'"></i> <em>'+z+"</em>");var l=a.sizzle("[node-type=fl_like_icon]",k[0])[0];h||l&&a.ui.effect(l,"bounce","slow",function(){setTimeout(function(){n=!0},1e3)});if(!h&&c.data.html&&g){m&&(m.style.display="none");b.el.title=d("#L{}");a.insertHTML(g.faceList,c.data.html,"afterbegin")}else{b.el.title=d("#L{}");a.removeNode(a.sizzle('[uid="'+$CONFIG.uid+'"]',g.faceList)[0]);m&&(m.style.display="");a.sizzle("[uid]",g.faceList).length<=0&&B.stop(b,!0)}var o=a.sizzle('[node-type="faceMore"]',g.faceList)[0];z>4?o&&o.style.display=="none"&&(o.style.display=""):o&&o.style.display!="none"&&(o.style.display="none");setTimeout(function(){n=!0},1e3)},onFail:function(b){a.lib.dialog.ioError(b.code,b);n=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);n=!0}},e)}},isTransing:!1,trans:function(b){if(!B.isTransing){B.isTransing=!0;g&&g.outer&&(g.outer.style.display="none");var d="minismall",e="faceList",f={};if(b.data.object_type&&b.data.object_type==="comment"){d="cmtLike";e="likeList"}f=b.data;f.location=$CONFIG.location;c.request(d,{onSuccess:function(c){D();var d=c.data.total_number||c.data.like_counts||0;if(d!="0"){z=d;q=b.data.mid;r=b.data.object_id;g.object_id=b.data.object_id;var f=a.sizzle("em",b.el)[0];f.innerHTML=d;var h=a.lib.kit.dom.parseDOM(a.builder(c.data.html).list);g.faceList.innerHTML=h[e].innerHTML;var i=a.sizzle("[uid]",g.faceList);a.sizzle('[uid="'+$CONFIG.uid+'"]',g.faceList)[0]||(m=i[3]);g.mid=b.data.mid;document.body.appendChild(g.outer);g.outer.style.display="";var j=a.position(b.el);a.setXY(g.outer,{t:j.t+b.el.offsetHeight+6,l:j.l+b.el.offsetWidth/2-36});B.checkPosition(b.el);B.isTransing=!1}},onFail:function(a){B.isTransing=!1},onError:function(a){B.isTransing=!1}},f)}},stop:function(a,b){f=!1;if(b)C();else{D();j.push(setTimeout(C,x))}},checkPosition:function(b){p=a.position(g.outer);clearInterval(o);o=setInterval(function(){var c=a.position(b);(p.l!=parseInt(c.l+b.offsetWidth/2-36)||p.t!=parseInt(c.t+b.offsetHeight+6))&&B.stop()},500)},cancelLike:function(b){a.preventDefault();z--;a.removeNode(a.core.dom.neighbor(b.el).parent("li").getCurrent());var e=a.sizzle('[action-type="like_del"]',g.faceList);e[0]&&a.removeNode(a.core.dom.neighbor(e[0]).parent("li").getCurrent());A.title=d("#L{}");var f=a.sizzle('[node-type="like_status"]',A);f[0]&&(f[0].innerHTML='<i class="W_icon icon_praised_b"></i> <em> '+(z||"")+"</em>");m&&(m.style.display="");a.sizzle("[uid]",g.faceList).length<=0&&(g.outer.style.display="none");var h="minidel";b.data.object_type&&b.data.object_type=="comment"&&(h="objLike");c.request(h,{onSuccess:a.core.func.empty,onError:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)}},C=function(){clearTimeout(v);D();clearInterval(o);g&&(g.outer.style.display="none");p=undefined},D=function(){while(j.length)clearTimeout(j.pop())},E=!1,F=function(b){if(!E){E=!0;var e=a.core.json.merge(b.data,{location:$CONFIG.location});c.request(e.object_type&&e.object_type==="status"?"miniadd":"objLike",{onSuccess:function(c){var f=c.data.is_del?!0:!1;a.conf.channel.like.fire(f?"unlike":"like",e);var g="W_icon icon_praised_b"+(f?"":"c"),h=f?"":"S_link1",i=f?d("#L{}"):d("#L{}"),j=a.sizzle("em",b.el)[0];count=j?parseInt(j.innerHTML||0):0;f?count--:count++;var k=count>0?count:"";b.data&&b.data.hide_num==1&&(k="");count=count<=0?"":count;b.el.innerHTML='<span class="btn_26px btn_inborder"><i node-type="fl_like_icon" class="'+g+'"></i>'+'<em class="'+h+'" node-type="fl_like_count">'+count+"</em></span>";var l=a.sizzle("i",b.el)[0];f?E=!1:l&&a.ui.effect(l,"bounce","slow",function(){E=!1});b.el.title=i},onFail:function(b){a.lib.dialog.ioError(b.code,b);E=!1},onError:function(b){a.lib.dialog.ioError(b.code,b);E=!1}},e)}},G=function(b){c.request("minidel",{onSuccess:function(c){var d=k.getFeedNode(b.el,e);d.style.height=d.offsetHeight+"px";d.innerHTML="";var f=a.tween(d,{end:function(){f.destroy();a.removeNode(d);el=d=null}}).play({height:0})},onError:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)},H=function(){l.add("fl_like","mouseover",B.go);l.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",B.fill);l.add("fl_like","mouseout",B.stop);u.add("like_del","click",B.cancelLike);l.add("object_like","click",F);l.add("fl_remove_like","click",G);if(s){s.add("fl_like","mouseover",B.go);s.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",B.fill);s.add("fl_like","mouseout",B.stop);s.add("object_like","click",F)}if(t){t.add("forward_like","mouseover",B.go);t.add("forward_like","click",B.fill);t.add("forward_like","mouseout",B.stop);t.add("object_like","click",F)}},I=function(){var b=a.sizzle('div[node-type="comment_detail"]')[0]||null,c=a.sizzle('div[node-type="forward_detail"]')[0]||null;b&&(s=a.delegatedEvent(b));c&&(t=a.delegatedEvent(c));h=a.lib.feed.plugins.like.commentLike(u,B.cancelLike);H();a.addEvent(g.outer,"mouseover",function(){clearTimeout(j)});a.addEvent(g.outer,"mouseout",function(){B.stop()})};I();i.destroy=function(){h.destroy&&h.destroy();l.remove("fl_like","mouseover",B.go);l.remove("fl_like",a.lib.kit.touch.cantouch?"tap":"click",B.fill);l.remove("fl_like","mouseout",B.stop);l.remove("object_like","click",F);l.remove("fl_remove_like","click",G);u.destroy();s&&s.destroy();t&&t.destroy();a.removeEvent(g.outer,"mouseover");a.removeEvent(g.outer,"mouseout")};return i}});
STK.register("conf.channel.window",function(a){return a.lib.kit.extra.listener.define("conf.channel.window",["scroll"])});
STK.register("lib.feed.plugins.lazyload.lazyload",function(a){function f(){clearTimeout(c);c=setTimeout(e,300)}function e(){var b=a.core.util.scrollPos(),c=a.core.util.pageSize(),d={scrollLeft:b.left,scrollTop:b.top,winWidth:c.win.width,winHeight:c.win.height,pageWidth:c.page.width,pageHeight:c.page.height};a.conf.channel.window.fire("scroll",d)}function d(b,c,d,e){var f,g,h,i=b.length,j=new Date;if(b.length>0)for(var k=b.length-1;k>=0;k--){f=b[k];h=d.parent?f.parentNode:f;g=a.core.dom.position(h).t;if(g>e.top&&g<e.bottom){b.splice(k,1);c(f)}}}var b=!1,c;return function(c,e,g){if(b==!1){b=!0;a.addEvent(window,"scroll",f);a.addEvent(window,"resize",f);f()}var h=function(b){var f={type:"",threshold:600,parent:!1,over:!1};f=a.core.obj.parseParam(f,g);d(c,e,g,{top:f.over?0:b.scrollTop,bottom:parseInt(b.scrollTop+b.winHeight+f.threshold,10)})};a.conf.channel.window.register("scroll",h);var i={destroy:function(){a.conf.channel.window.remove("scroll",h)}};return i}});
STK.register("lib.feed.plugins.lazyload.init",function(a){return function(b,c){if(!b)a.log("lazyload : need object of the baseFeedList Class");else{var d={},e=b.getNode(),f,g=0,h=function(){f&&f.destroy();var c=a.sizzle('div[node-type="lazyload"]',e)[0];if(!!c){b.setBottomNode(c);f=a.lib.feed.plugins.lazyload.lazyload([c],function(){var d=a.queryToJson(c.getAttribute("action-data")||"");b.showWait("lazyload");a.custEvent.fire(b,"request",["lazyload",d]);f.destroy();f=undefined},{threshold:a.winSize().height*1.5})}};b.regCustEvent("lazyload",function(){g=0;h()});a.custEvent.add(b,"updateFeed",function(a,b){if(b=="lazyload"){g=g==0?1:0;h()}});h();d.destroy=function(){f&&f.destroy();a.custEvent.remove(b,"lazyload");d=b=e=f=undefined};return d}}});
STK.register("lib.feed.plugins.jumpurl",function(a){return function(b){if(!b)a.log("quote : need object of the baseFeedList Class");else{var c=b.utils,d=b.getNode(),e=function(a,b){return a==b||a==document.body||!a?!1:a.tagName.toUpperCase()=="A"?!0:e(a.parentNode,b)},f=function(a){var b=a.evt,c=a.el,d=a.data,f=decodeURIComponent(d.url),g=d.target;e(b.target,a.el)||(g=="_blank"?window.open(f):location.href=f)},g=function(a){var b=c.getMid(a.el,d);if(a.data.short_url){var e=a.data.short_url+"?mid="+b+"&uid="+$CONFIG.uid;window.open(e)}},h=b.getDEvent();h.add("fl_jumpurl","click",f);h.add("fl_objjumpurl","click",g);var i={};i.destroy=function(){h.destroy()};return i}}});
STK.register("lib.feed.plugins.rightmenu",function(a){var b=a.lib.kit.extra.language;return function(b,c){if(!b)a.log("rightmenu : need object of the baseFeedList Class");else{var d,e={},f=b.getNode(),g=b.getDEvent(),h=b.utils,i,j=function(b){var c=h.getFeedNode(b),d=a.sizzle('[node-type="fl_menu_right"]',c);return d[0]?d[0]:!1},k=function(a){return!a||a==document.body?!1:a.getAttribute&&a.getAttribute("action-type")=="fl_menu"?a:arguments.callee(a.parentNode)},l=function(b){d=j(b.el);i&&i!=d&&i.style.display!="none"&&~function(b){a.ui.effect(b,"fadeOutUp",100,function(){b.style.display="none"})}(i);if(d.style.display=="none"){d.style.display="";a.ui.effect(d,"fadeInDown",100)}else a.ui.effect(d,"fadeOutUp",100,function(){d.style.display="none"});i=d},m=function(b){var c=a.fixEvent();!k(c.target)&&i&&i.style.display!="none"&&a.ui.effect(i,"fadeOutUp",100,function(){i.style.display="none"})},n=function(){g.add("fl_menu","click",l);a.addEvent(document.body,"click",m)};n();var o=function(){g.destroy();a.removeEvent(document.body,"click",m)};return e}}});
STK.register("conf.trans.publishTo",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("list",{url:"/aj/f/group/list?_wv=5",method:"get"});return b});
STK.register("lib.publisher.widget.keyboardCapture",function(a){var b={13:"enter",27:"esc",32:"space",38:"up",40:"down",9:"tab"};return function(c,d){d=d||{};var e={},f,g={keydown:function(c){d.stopScroll&&a.stopEvent();var f,g;!!(f=c)&&!!(g=f.keyCode)&&b[g]&&a.custEvent.fire(e,b[g])}},h={init:function(){h.pars();h.bind()},pars:function(){},bind:function(){for(var b in g)a.addEvent(c,b,g[b])},getKey:function(a){return b[a]},destroy:function(){for(var b in g)a.removeEvent(c,b,g[b])}};h.init();e.getKey=h.getKey;e.destroy=h.destroy;return e}});
STK.register("lib.publisher.source.publishTo",function(a){var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.core.util.easyTemplate,e;return function(c){var d,f,g=c&&c.editorWrapEl,h=c&&c.textEl,i=c&&c.trans||a.conf.trans.publishTo,j=c&&c.transName||"list",k={},l=[],m,n={},o=c.isforward,p,q,r,s=function(){if(!a.isNode(g))throw"publishTo need a wrapper node to parseDOM"},t=a.getUniqueKey(),u=function(a){var b=[],c;b.push('<div style="position: absolute;display:none;z-index:29999;outline:none;" hideFocus="true" node-type="publishTo" class="layer_menu_list" tabindex="10">');b.push('<ul id="'+t+'">');b.push('<li rank="0"><a title="#L{-}" suda-data="key=tblog_edit_exposure&value=edit_public" href="javascript:void(0)" action-data="rank=0&text=#L{}&rankid=" action-type="publishTo"><i class="W_icon icon_type_public"></i>#L{}</a></li>');b.push('<li rank="6"><a title="#L{-}" href="javascript:void(0)" action-data="rank=6&text=#L{}&rankid=" action-type="publishTo"><i class="W_icon icon_type_friends"></i>#L{}</a></li>');b.push('<li rank="1"><a title="#L{-}" suda-data="key=tblog_edit_exposure&value=edit_private" href="javascript:void(0)" action-data="rank=1&text=#L{}&rankid=" action-type="publishTo"><i class="W_icon icon_type_self"></i>#L{}</a></li>');b.push('<li class="line"></li>');b.push('<li><a action-type="more" href="javascript:void(0);"><i class="W_icon icon_type_group"></i>#L{}</a></li>');b.push("</ul></div>");return b.join("")},v=function(a){var b=[],c=a.length,d;c>8?b.push('<ul class="scroll_bar W_scroll" id="'+t+'">'):b.push('<ul class="scroll_bar W_scroll" id="'+t+'">');for(var e=0;e<c;e++){d=a[e];b.push('<li><a action-type="publishTo" action-data="rank=3&text='+d.gname+"&rankid="+d.gid+'" title="'+d.gname+'" href="javascript:void(0);" onclick="return false;"><i class="W_icon icon_type_group"></i>'+d.gname+"</a></li>")}b.push("</ul>");b.push('<ul><li class="line"></li>');b.push('<li class="opt"><a href="javascript:void(0)" onclick="return false;" action-type="back">#L{}</a></li>');b.push("</ul>");return b.join("")},w=function(){f=a.lib.kit.dom.parseDOM(a.builder(g).list);f.wrap||(f.wrap=g);q=f.wrap.className;f.submit&&(r=f.submit.innerHTML)},x=function(){d=function(){var c={},d,k,n,o,s=f.showPublishTo;k=d=s&&s.getAttribute("action-data")&&a.core.json.queryToJson(s.getAttribute("action-data"))||{rank:"all",rankid:""};c.node=a.core.evt.delegatedEvent(g);var w=!1,x={hotKeyChangeRank:function(c,f){var g=f.match(/\d+/);if(g&&g[0]){var h=parseInt(g[0],10)-1,i=[{rank:0,rankid:"",text:b("#L{}"),title:b("#L{-}")},{rank:6,rankid:"",text:b("#L{}"),title:b("#L{-}")},{rank:1,rankid:"",text:b("#L{}"),title:b("#L{-}")}],j=function(){a.foreach(k,function(a){a.rank=3;a.rankid=a.gid;a.text=a.gname;a.title=a.gname});i=i.concat(k);var b=window.$CONFIG&&window.$CONFIG.miyou=="1";b||i.splice(1,1);if(i[h]){d=i[h];C.btnContent(d.text);C.btnTitle(d.title);w=!1;a.custEvent.fire(C,"changeRank",d)}},k=function(){if(e)return a.core.arr.copy(e);D.group.request(function(b){k=a.core.arr.copy(b);j()});return null}();k&&j()}}},y=function(){c.node.add("showPublishTo","click",C.show)},z=function(){D.normal.bind();D.group.bind();A.bind()},A={keyboardManager:null,keyTypes:["up","down","esc","enter"],getIndex:function(b){var c=A.getList(),d=A.lastCur,e;a.foreach(c,function(a,b){if(d===a){e=b;return!1}});b>0?e++:e--;e>=c.length?e=0:e<0&&(e=c.length-1);return e},up:function(){var a=A.getIndex(-1),b=A.getList()[a];A.setCur(b,a)},down:function(){var a=A.getIndex(1),b=A.getList()[a];A.setCur(b,a)},enter:function(){var b=A.lastCur;b.getAttribute("action-type")||(b=a.sizzle("[action-type]",b)[0]);b&&c.layer.fireDom(b,"click",null)},esc:function(){C.hide()},bind:function(){A.keyboardManager=a.lib.publisher.widget.keyboardCapture(f.publishTo,{stopScroll:!0});a.custEvent.define(A.keyboardManager,A.keyTypes);for(var b=0,c=A.keyTypes.length;b<c;b++){var d=A.keyTypes[b];a.custEvent.add(A.keyboardManager,d,A[d])}},list:null,lastCur:null,focusPublishTo:function(){f.publishTo.focus();var b=this.getList(!0),c=a.sizzle('li[rank="'+d.rank+'"]',f.publishTo)[0];this.setCur(c||b[0],0)},setCur:function(b,c){this.lastCur&&a.removeClassName(this.lastCur,"cur");a.addClassName(b,"cur");this.lastCur=b;var d=a.E(t);if(a.contains(d,b)){var e=function(b){return a.core.dom.getSize(b).height+(parseFloat(a.core.dom.getStyle(b,"marginTop"))||0)+(parseFloat(a.core.dom.getStyle(b,"marginBottom"))||0)},f=c+1,g=Math.max(e(b),e(a.sizzle("a",b)[0]));f>7?d.scrollTop=(f-7)*g:d.scrollTop=0}},getList:function(b){if(b||!this.list){var c=a.sizzle("li",f.publishTo),d=[];a.foreach(c,function(b){a.getStyle(b,"display")!="none"&&b.className!="line"&&d.push(b)});this.list=d}return this.list}},B={setPos:function(){var b=a.core.dom.getSize;document.body.appendChild(f.publishTo);var c=b(f.showPublishTo).width-b(f.publishTo).width;a.lib.kit.dom.layoutPos(f.publishTo,f.showPublishTo,{offsetX:c+2,offsetY:2})},init:function(){c.layer=a.core.evt.delegatedEvent(f.publishTo);c.closeFriend=a.core.evt.delegatedEvent(f.publishTo)},setArrow:function(a){},show:function(){var b=a.getStyle(f.publishTo,"display")!="none";a.setStyle(f.publishTo,"display","");B.setPos();A.focusPublishTo();b||a.ui.effect(f.publishTo,"fadeInDown","fast");if(!m){m=1;B.bindBodyEvt()}return!1},hide:function(){!f.publishTo||a.ui.effect(f.publishTo,"fadeOutUp","fast",function(){a.setStyle(f.publishTo,"display","none");w=!1;if(m){m=0;B.removeBodyEvt()}})},autoHide:function(b){b=a.core.evt.fixEvent(b);f.showPublishTo!==b.target&&!a.core.dom.contains(f.showPublishTo,b.target)&&!a.core.dom.contains(f.publishTo,b.target)&&C.hide()},content:function(a){if(typeof a=="undefined")return f.publishTo.innerHTML;f.publishTo.innerHTML=a},bindBodyEvt:function(){a.addEvent(document.body,"click",B.autoHide)},removeBodyEvt:function(){a.removeEvent(document.body,"click",B.autoHide)}},C={enable:function(){f.showPublishTo.setAttribute("action-type","showPublishTo")},disable:function(){f.showPublishTo.setAttribute("action-type","")},miYouStyle:function(a,c){var d="2",e=$CONFIG.lang=="zh-cn"?"":"_CHT";d==c.rank?f.submit.innerHTML=b('<span class="btn_30px">#L{}</span>'):f.submit.innerHTML=r},show:function(){var b=function(){a.custEvent.fire(C,"show");w?D.group.show():D.normal.show()};if(f.publishTo){var c=a.getStyle(f.publishTo,"display");if(c==="none")b();else{a.setStyle(f.publishTo,"display","none");w=!1}}else b();a.preventDefault()},btnContent:function(a){a&&(n.innerHTML=a)},btnTitle:function(a){a&&f.showPublishTo.setAttribute("title",a)},hide:function(){B.hide()},toggle:function(){w||(f.publishTo.style.display=="none"?C.show():C.hide())},rank:function(){return d},reset:function(){C.enable();f.wrap.className=q;f.submit.innerHTML=r;C.btnContent(o.content);C.btnTitle(o.title);d=null;w=!1;d=k},destroy:function(){try{for(var b in c)c[b].destroy()}catch(d){}l.length&&a.hotKey.remove(h,l,x.hotKeyChangeRank);a.removeNode(f.publishTo);a.custEvent.undefine(C);if(A.keyboardManager){A.keyboardManager.destroy();a.custEvent.undefine(A.keyboardManager,A.keyTypes)}},changeRank:function(b){b=b>0?b-1:0;var c=a.sizzle('a[action-type="publishTo"]',f.publishTo)[b];if(c){D.normal.changeRank({el:c,data:a.core.json.queryToJson(c.getAttribute("action-data")||"")});var d=c.getAttribute("suda-data");if(d){var e=d.match(/key=(.+?)&value=(.+)/);e&&e.length===3&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(e[1],e[2])}}},getDomHeight:function(){return f.publishTo.style.display=="none"?{width:0,heigth:0}:a.core.dom.getSize(f.publishTo)},bindAltKey:function(){if(a.isNode(h)){var b=a.core.util.browser.OS==="macintosh";if(b)for(var c=1;c<=9;c++)l.push("ctrl+"+c);else for(var c=1;c<=9;c++)l.push("alt+"+c);a.hotKey.add(h,l,x.hotKeyChangeRank)}}},D={normal:{bind:function(){c.layer.add("publishTo","click",D.normal.changeRank);c.layer.add("more","click",D.normal.more)},getList:function(){B.content(p)},more:function(){D.group.show();w=!0;a.core.evt.stopEvent()},show:function(){var a=function(){if(!f.publishTo){E();B.init();z()}D.normal.getList();B.show()};e?a():D.group.request(a)},changeRank:function(c){try{a.preventDefault(c.evt)}catch(e){}d=c.data;var g=c.data.text;C.btnContent(g);C.btnTitle(c.el.getAttribute("title"));d.rank=="group"?D.group.show():C.hide();a.custEvent.fire(C,"changeRank",d);c.data.rank=="6"?f.submit.innerHTML=b("#L{}"):f.submit.innerHTML=b("#L{}")}},group:{request:function(b){i.request(j,{onSuccess:function(a){var c=a.data.length;for(var d=0;d<c;d++)a.data[d].index=d+1;e=a.data;b&&b(e)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{})},bind:function(){c.layer.add("back","click",D.group.back)},getList:function(){if(!D.group.cache){var a=b(v(e));D.group.cache=a;B.content(D.group.cache)}else B.content(D.group.cache)},show:function(){D.group.getList();B.show()},back:function(){var b=a.core.evt.fixEvent();a.core.evt.stopEvent(b);w=!1;D.normal.show()}}},E=function(c){var d=b(u(c));f.publishTo=a.insertHTML(document.body,d,"beforeend");p=f.publishTo.innerHTML},F=function(){if(!a.isNode(f.showPublishTo))return 0;n=f.publishTotext;o={content:n.innerHTML,title:f.showPublishTo.getAttribute("title")};y();return 1},G=F();a.custEvent.define(C,["show","hide","changeRank"]);return G?C:null}();d&&d.bindAltKey&&d.bindAltKey()},y=function(){s();w();x()};y();return d}});
STK.register("lib.kit.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
STK.register("conf.trans.forward",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.domain?"?domain="+$CONFIG.domain:"",e=$CONFIG.interactiveUrl;c("toMicroblog",{url:e+"?fajtype=mblog_forward",method:"post"});c("detailForwardLinks",{url:e+"?fajtype=small_repost",method:"get"});c("importMiyou",{url:e+"?fajtype=closefriends_recom",method:"get"});c("toMiyouCircle",{url:e+"?fajtype=mblog_forwardmiyou",method:"post"});c("create",{url:e+"?fajtype=add_message",method:"post"});return b});
STK.register("lib.forward.source.API",function(a){var b={checkAtNum:function(a){var b=a.match(/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g),c=a.match(/\/\/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g);b=b?b.length:0;c=c?c.length:0;return b-c},preventDefault:function(b){a.core.evt.preventDefault(b);return!1}};return b});
STK.register("lib.forward.plugin.report",function(a){return function(b){window.open("http://weibo.com/complaint/complaint.php?url="+a.lib.kit.extra.parseURL().url);a.core.evt.preventDefault(b.evt);return!1}});
STK.register("lib.kit.extra.toFeedText",function(a){var b=function(a){return/^http\:\/\/(t\.cn|sinaurl\.cn)/.test(a)};return function(c){if(typeof c!="string")throw"[lib.kit.extra.toFeedText]:need string as first parameter";var d=a.core.str.parseHTML(c),e=[],f=!1;for(var g=0,h=d.length;g<h;g+=1)if(!d[g][2])f===!1&&e.push(d[g][0]);else if(d[g][2].toLowerCase()==="img"){var i=d[g][3].match(/(?:alt\s*=\s*["|']?([^"|'|\s]+)["|']?)/),j=d[g][3].match(/(?:brand_face\s*=\s*["|']?([^"|'|\s]+)["|']?)/);j?e.push(j[1]):i&&e.push(i[1])}else if(d[g][2].toLowerCase()==="a")if(d[g][1]==="/")f=!1;else{var k=d[g][3].match(/(?:href\s*=\s*["|']?([^"|'|\s]+)["|']?)/);if(k&&k[1]&&b(k[1])){e.push(" "+k[1]+" ");f=!0}if(d[g][3].indexOf("shorthref")){var l=d[g][3].match(/(?:shorthref\s*=\s*["|']?([^"|'|\s]+)["|']?)/);if(l&&l[1]){e.push(" http://t.cn/"+l[1]+" ");f=!0}}}return e.join("")}});
STK.register("lib.forward.source.like",function(a){return function(b){var c=a.conf.trans.feed.attitude,d=!1,e,f={},g=[],h=a.delegatedEvent(b),i,j=!0,k,l=null,m,n,o=600,p=350,q='<div class="W_layer W_layer_pop WB_outReset" style="display:none" node-type="outer"><div class="content"><div class="layer_emotion" node-type="inner"><ul class="emotion_list clearfix" node-type="faceList"></ul></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t" style="right:20px;"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';e=a.lib.kit.dom.parseDOM(a.builder(q).list);document.body.appendChild(e.outer);m=a.delegatedEvent(e.outer);var r,s,t={go:function(b){s=b.el;r=a.sizzle('[node-type="forward_like_count"]',s)[0];r=r&&r.innerHTML||0;d=!0;if(a.core.dom.contains(b.el,b.evt.relatedTarget)||e&&e.outer.style.display!="none"&&b.data.mid==k&&b.data.object_id==l)v();else{t.stop(b,!0);n=setTimeout(function(){t.trans(b)},o)}},fill:function(b){if(!!j){j=!1;var d=a.core.json.merge(b.data,{location:$CONFIG.location}),f="miniadd";c.getTrans(f,{onSuccess:function(c){r=a.sizzle('[node-type="forward_like_count"]',s)[0];r=r&&r.innerHTML||0;var d=a.sizzle("em",b.el)[0],f=c.data.is_del?!0:!1,g="W_icon icon_praised_b"+(f?"":"c");f?r>0&&r--:r++;b.el.innerHTML='<em class="'+g+'"></em><em node-type="forward_like_count">'+r+"</em>";if(!f&&c.data.html&&e){i&&(i.style.display="none");b.el.title=a.lib.kit.extra.language("#L{}");a.insertHTML(e.faceList,c.data.html,"afterbegin")}else{b.el.title=a.lib.kit.extra.language("#L{}");a.removeNode(a.sizzle('[uid="'+$CONFIG.uid+'"]',e.faceList)[0]);i&&(i.style.display="");a.sizzle("[uid]",e.faceList).length<=0&&t.stop(b,!0)}var h=a.sizzle('[node-type="faceMore"]',e.faceList)[0];r>4?h&&h.style.display=="none"&&(h.style.display=""):h&&h.style.display!="none"&&(h.style.display="none");j=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);j=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);j=!0}}).request(d)}},trans:function(b){e&&e.outer&&(e.outer.style.display="none");var d="minismall",f="faceList",g={mid:b.data.mid,location:$CONFIG.location};c.getTrans(d,{onSuccess:function(c){v();var d=c.data.total_number||c.data.like_counts||0;if(d!="0"){r=d;k=b.data.mid;l=b.data.object_id;var g=a.sizzle('[node-type="forward_like_count"]',b.el)[0];g&&(g.innerHTML=d?d:"");var h=a.lib.kit.dom.parseDOM(a.builder(c.data.html).list);e.faceList.innerHTML=h[f].innerHTML;var j=a.sizzle("[uid]",e.faceList);a.sizzle('[uid="'+$CONFIG.uid+'"]',e.faceList)[0]||(i=j[3]);e.mid=b.data.mid;document.body.appendChild(e.outer);e.outer.style.display="";var m=a.position(b.el);a.setXY(e.outer,{t:m.t+b.el.offsetHeight+6,l:m.l+b.el.offsetWidth/2-36})}},onFail:function(){},onError:function(){}}).request(g)},stop:function(a,b){d=!1;if(b)u();else{v();g.push(setTimeout(u,p))}},cancelLike:function(b){a.preventDefault();r--;a.removeNode(a.core.dom.neighbor(b.el).parent("li").getCurrent());var d=a.sizzle('[action-type="like_del"]',e.faceList);d[0]&&a.removeNode(a.core.dom.neighbor(d[0]).parent("li").getCurrent());s.title=a.lib.kit.extra.language("#L{}");s.innerHTML='<em class="W_icon icon_praised_b"></em><em node-type="forward_like_count">'+r+"</em>";i&&(i.style.display="");a.sizzle("[uid]",e.faceList).length<=0&&(e.outer.style.display="none");var f="minidel";c.getTrans(f,{onSuccess:a.core.func.empty,onError:a.core.func.empty}).request(b.data)}},u=function(){clearTimeout(n);v();e&&(e.outer.style.display="none")},v=function(){while(g.length)clearTimeout(g.pop())},w=function(){h.add("forward_like","mouseover",t.go);h.add("forward_like","click",t.fill);h.add("forward_like","mouseout",t.stop);m.add("like_del","click",t.cancelLike)},x=function(){w();a.addEvent(e.outer,"mouseover",function(){v()});a.addEvent(e.outer,"mouseout",function(){t.stop()})};x();f.destroy=function(){h.destroy();m.destroy();a.removeEvent(e.outer,"mouseover");a.removeEvent(e.outer,"mouseout");a.removeNode(e.outer)};return f}});
STK.register("lib.forward.source.forwardLink",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.forward,d=a.lib.kit.dom.parseDOM,e=a.lib.kit.extra.actionData,f,g={on:b('#L{}<span class="W_arrow" title="#L{}" href="javascript:;" onclick="return false;" action-type="show" action-data="id=2"><em></em></span>'),off:b('#L{}<span class="W_arrow" title="#L{}" href="javascript:;" onclick="return false;" action-type="show" action-data="id=1"><em></em></span>')},h;return function(b,i){h=b;var j=i.flNode,k=i.mid,l=i.data,m={},n,o,p,q=!1,r,s,t=a.parseParam({forward_link_status:"on",inDialog:!0,mid:""},l);if(typeof t.mid!="string"&&typeof t.mid!="number")throw new Error("forward.forwardLlink: need string (or number) as mid");var u=function(b){r=r||d(a.builder(f).list);if(!!r.forward_link_more){b.el.innerHTML=g[o];if(o=="on"){r.forward_link_more.style.display="";a.addClassName(b.el,"W_arrow_turn");e(b.el).set("id","2");r.check_more_link&&(r.check_more_link.style.display="")}else if(o=="off"){r.forward_link_more.style.display="none";a.removeClassName(b.el,"W_arrow_turn");e(b.el).set("id","1");r.check_more_link&&(r.check_more_link.style.display="none")}}},v=function(){q=!0;c.request("detailForwardLinks",{onSuccess:function(b,c){if(!b.data.num)a.removeNode(f.parentNode);else{o=o=="on"?"off":"on";f.innerHTML=b.data.html||"";a.custEvent.fire(h,"resetComment",[b]);a.custEvent.fire(h,"updateNum",[b.data]);w(f)}},onError:function(){f.innerHTML=""},onFail:function(){f.innerHTML=""}},{mid:k,d_expanded:p,expanded_status:q?o==="on"?1:2:""})},w=function(b){var c=a.sizzle("div.list_ul",b)[0];if(!!c){c.style.marginTop=-a.core.dom.getSize(c).height+"px";setTimeout(function(){c.style.webkitTransition="margin-top 0.4s";c.style.mozTransition="margin-top 0.4s";c.style.msTransition="margin-top 0.4s";c.style.transition="margin-top 0.4s";c.style.marginTop="0px"},0)}},x=function(b){var c=a.core.dom.dir.parent(b.el,{expr:'[node-type="forward_link_item"]'})[0],d=b.data,e,f,g,i;if(c){e=a.sizzle('[node-type="forward_again"]',c)[0];i=d.name;if(e){var j="//@"+i+": "+a.trim(e.innerHTML.replace(/[\r|\n|\t]/g,""));a.custEvent.fire(h,"forwardAgain",[d,j])}}},y=function(){f=a.C("div");f.className="list_box";s=a.delegatedEvent(f);j.innerHTML="";j.appendChild(f);s.add("show","click",function(a){o=a.data.id*1==1?"on":"off";switch(t.forward_link_status){case"off":v(a);break;case"on":default:u(a)}});s.add("forward_again","click",x);p=a.core.util.storage.get("forward_link_status");if(p=="null"||!p)p=t.forward_link_status;o=p;v()};a.custEvent.define(m,["switch"]);a.custEvent.add(m,"switch",function(a,b){if(b.node){var c=f.innerHTML;b.node.innerHTML="";b.node.appendChild(f);f.innerHTML=c}b.base&&(h=b.base)});m.destroy=function(){s.destroy();a.custEvent.undefine(m);a.removeNode(f);f=null};if(f&&t.forward_link_status==n){n=t.forward_link_status;j.innerHTML="";j.appendChild(f)}else y();return m}});
STK.register("lib.forward.source.toMicroblog",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.extra.toFeedText,d=a.lib.kit.extra.textareaUtils,e=a.lib.kit.extra.shine,f=a.lib.kit.dom.parseDOM,g=null,h,i=a.lib.dialog.validateCode(),j=b('<#et userlist data><div node-type="toMicroblog_client"><#if (data.isDialog == true)><div class="WB_text S_bg1" node-type="content"><#if (data.showArrow == true)><a href="javascript:void(0);" action-type="origin_all" class="W_ficon ficon_arrow_down_lite S_ficon">g</a></#if><span class="con S_txt2">${data.content}</span></div></#if><div class="WB_feed_repeat forward_rpt1"><div class="WB_repeat"><div class="WB_feed_publish clearfix"><div class="WB_publish"><div class="p_input p_textarea"><textarea class="W_input" name="" rows="" cols="" title="#L{}#L{}" node-type="textEl">${data.reason}</textarea><span class="tips S_txt2" node-type="num"></span><div class="send_succpic" node-type="success_tip" style="display:none"><span class="W_icon icon_succB"></span><span class="txt">#L{}</span></div></div><div class="p_opt clearfix"><div class="btn W_fr"><div class="limits" style="position:relative;" layout-shell="true"><a action-data="rank=0" title="" class="S_txt1" href="javascript:void(0)" action-type="showPublishTo" node-type="showPublishTo" title=#L{-}><span class="W_autocut" node-type="publishTotext">#L{}</span> <i class="W_ficon ficon_arrow_down S_ficon" node-type="publish_to_arrow">c</i></a></div><a href="javascript:void(0)" node-type="submit" class="W_btn_a">#L{}</a></div><div class="opt clearfix" test=1 node-type="widget"><span class="ico"><a href="javascript:void(0)" title="#L{}" node-type="smileyBtn"><i class="W_ficon ficon_face">o</i></a></span><ul class="ipt" node-type="cmtopts"><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label for="forward_comment_opt_forwardLi" class="W_label"><input node-type="forwardInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_forwardLi"><span>#L{} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label for="forward_comment_opt_originLi" class="W_label"><input node-type="originInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_originLi"><span><#if (data.forwardNick)> #L{} <#else>#L{}</#if> ${data.originNick}</span></label></li></#if></ul></div></div></div></div><#if (data.isDialog == true)><div node-type="forward_link" class="repeat_list S_line1"></div></#if></div></div></#et>'),k={notice:"#L{}",defUpdate:"#L{}",netError:"#L{}",success:"#L{}!",off:"#L{}",on:"#L{}"},l={limitNum:140,tipText:b(k.notice),count:"disable"},m=function(a,c){c=="normal"?a.innerHTML=b("#L{}"):a.innerHTML=b('<i class="W_loading"></i>#L{...}')};return function(n,o,p){if(n==null||o==null)throw new Error("[common.forward.toMicroblog]Required parameter client is missing");var q,r=p.data,s=56,t=!1,u=r.originNick?"@"+r.originNick:"",v=c(r.origin.replace(/<[^>]+>/gi,""));v=a.trim(v);r.content=v+"";if(a.bLength(a.core.str.decodeHTML(c(v+u)))>s){r.content=a.leftB(v,s-a.bLength(u))+"...";t=!0}else r.content=r.origin;u?u='<a class="S_txt1" href="/'+(r.domain||r.rootuid||r.uid)+'" target="_blank">'+u+"</a>:":u="";r.content=u+r.content;var w=r.reason||"",x=r.forwardNick?"//@"+r.forwardNick+":"+" ":"",y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=!1,N=!1,O,P,Q=a.lib.forward.source.API,R,S,T={};T.client=n;T.opts=p.data||{};T.isInit=!1;A=a.parseParam({appkey:"",styleId:"1",mark:"",module:"",page_module_id:"",refer_sort:"",pic_src:"",extra:""},T.opts);a.custEvent.define(T,["forward","hide","center","count","updateNum","forwardAgain","resetComment"]);var U=function(){if(B)C==="error"&&a.lib.kit.extra.shine(z.textEl);else{var c=a.trim(y.API.getWords()||"");c===b(k.notice)&&(c="");B=!0;C="loading";z.submit.className="W_btn_a W_btn_a_disable";m(z.submit,"loading");var d={};d.pic_src=A.pic_src;d.appkey=A.appkey;d.mid=o;d.style_type=A.styleId;d.mark=A.mark;d.reason=c||b(k.defUpdate);d.location=$CONFIG.location;d.pdetail=$CONFIG.page_id;d.module=A.module;d.page_module_id=A.page_module_id;d.refer_sort=A.refer_sort;z.originInput&&z.originInput.checked&&(d.is_comment_base="1");if(z.forwardInput&&z.forwardInput.checked){d.is_comment="1";M=!0}!z.forwardInput&&d.is_comment_base=="1"&&(M=!0);R&&R.disable();if(R){var e=R.rank();d.rank=e.rank;d.rankid=e.rankid}d=a.lib.kit.extra.getDiss(d,z.submit);if(r.postdata){var f=r.postdata.split(";");for(var h=0;f[h];h++){var i=f[h].split(",");i[0]&&i[0]&&(d[i[0]]=i[1])}}g=d;if(Q.checkAtNum(c)>5){a.ui.confirm(b("#L{@ }"),{OK:function(){D.request(d)},cancel:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal")}});return}A.extra&&(d.ref=A.extra);D.request(d)}},V=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){y.API.blur();U()}},W=function(){var a=y.API.count(),b=l.limitNum-a,c=b>=0?!0:!1;if(c){B=!1;C="";c&&(z.num.innerHTML="<span>"+b+"</span>")}else{B=!0;C="error";z.num.innerHTML='<span class="S_error">'+b+"</span>"}},X=function(b,c){y.API.blur();z.success_tip.style.display="";var d=a.sizzle(".W_icon",z.success_tip)[0],e=a.sizzle(".txt",z.success_tip)[0];e.style.display="none";a.ui.effect(d,"flipInY","normal");setTimeout(function(){e.style.display="";a.ui.effect(e,"fadeInRight","normal")},50);y.API.reset();setTimeout(function(){B=!1;C="";g=null;z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");try{b.data.mid=c.mid;b.data.isComment=M;b.data.isToMiniBlog=!0;a.custEvent.fire(T,"forward",[b.data,c,p.inDialog]);a.conf.channel.feed.fire("forward",[b.data,c,p.inDialog])}catch(d){}a.custEvent.fire(T,"hide");M=!1;R&&R.reset();a.ui.effect(z.success_tip,"fadeOut","fast",function(){z&&z.success_tip&&(z.success_tip.style.display="none")})},1e3)},Y=function(c,d){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");c.msg=c.msg||b(k.netError);a.lib.dialog.ioError(c.code,c);M=!1;R&&R.enable()},Z=function(b,c){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");R&&R.enable();a.lib.dialog.ioError(b.code,b)},_=function(){H=a.builder(n);H=a.lib.kit.dom.parseDOM(H.list).toMicroblog_client;y=a.lib.editor.base(H,l);z=y.nodeList;y.API=y.editor.API;a.custEvent.define(y.editor,"close");S=a.lib.publisher.widget.face(y.editor);R=a.lib.publisher.source.publishTo({editorWrapEl:n,textEl:z.textEl,isforward:!0});a.addEvent(z.textEl,"focus",function(){O=setInterval(function(){try{W()}catch(a){}},200)});a.addEvent(z.textEl,"blur",function(){clearInterval(O)});y.API.insertText(x+a.trim(a.core.str.decodeHTML(c(w))));a.lib.kit.dom.autoHeightTextArea({textArea:z.textEl,maxHeight:145,inputListener:a.funcEmpty});if(L){q=a.lib.forward.source.like(H);h=a.lib.forward.source.forwardLink(T,{flNode:z.forward_link,mid:o,data:A})}},ba=function(){a.addEvent(z.submit,"click",U);a.lib.kit.extra.keySubmit.on(z.textEl,U);a.addEvent(z.smileyBtn,"click",S.show);if(L){K=a.delegatedEvent(H);K.add("origin_all","click",function(a){z.content.innerHTML='<span class="con S_txt2">'+u+r.origin+"</span>"});K.add("report","click",function(b){return a.lib.forward.plugin.report(b)});K.add("switch","click",function(c){var d={1:"on",2:"off"},e=d[c.data.id];setSwitchStatus(e);a.setStyle(c.el,"left",e=="on"?"23px":"0px");c.el.setAttribute("action-data",e=="on"?"id=2":"id=1");c.el.setAttribute("title",e=="on"?b(k.off):b(k.on))});K.add("show","click",function(a){J=a.data.id*1==1?"on":"off";getForwardInfo_more(a)});K.add("forward_again","click",bh)}},bb=function(b,g,h){w=h;y.API.reset();y.API.insertText(a.trim(a.core.str.decodeHTML(c(w))),0);d.setCursor(z.textEl,0,0);e(z.textEl);A=a.parseParam(A,g);o=g.mid;r=$merge(r,g);g.forwardNick=g.name;g.originNick=g.rootname;z.cmtopts.innerHTML=a.core.util.easyTemplate(bg,g).toString();z=$merge(z,f(a.builder(z.cmtopts).list))},bc=function(a,b){if(z.cmtopts&&b.data.permission&&b.data.permission.allowComment==0){z.cmtopts.style.display="none";z.cmtopts.innerHTML=""}else if(z.originLi&&b.data.permission&&b.data.permission.allowRootComment==0){z.originLi.style.display="none";z.originLi.innerHTML=""}},bd=function(){a.custEvent.add(T,"forwardAgain",bb);a.custEvent.add(T,"resetComment",bc)},be=function(a,b){J=J=="on"?"off":"on"},bf=function(b){a.lib.dialog.ioError(b.code,b)},bg=b('<#et cmt data><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_forwardLi"><input id="forward_comment_opt_forwardLi" type="checkbox" node-type="forwardInput" class="W_checkbox"  /><span>#L{} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_originLi"><input id="forward_comment_opt_originLi" type="checkbox" node-type="originInput" class="W_checkbox" /><span><#if (data.forwardNick)>#L{} <#else>#L{} </#if>${data.originNick}</span></label></li></#if>'),bh=function(b){var d=a.core.dom.dir.parent(b.el,{expr:"dl"})[0],e=b.data,f,g,h,i;if(d){f=a.sizzle('em[node-type="forward_again"]',d)[0];i=e.name;if(f){w="//@"+i+": "+a.trim(f.innerHTML.replace(/[\r|\n|\t]/g,""));y.API.reset();y.API.insertText(a.trim(a.core.str.decodeHTML(c(w))),0);a.lib.kit.extra.textareaUtils.setCursor(z.textEl,0,0);a.lib.kit.extra.shine(z.textEl);A=a.parseParam(A,e);o=e.mid;e.forwardNick=e.name;e.originNick=e.rootname;r=a.lib.kit.extra.merge(r,b.data);z.cmtopts.innerHTML=a.core.util.easyTemplate(bg,e).toString();z=a.lib.kit.extra.merge(z,a.lib.kit.dom.parseDOM(a.builder(z.cmtopts).list))}}},bi=function(){D=a.conf.trans.forward.getTrans("toMicroblog",{onComplete:function(a,b){var c={onSuccess:X,onError:Y,requestAjax:D,param:g,onRelease:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");M=!1;R&&R.enable()}};i.validateIntercept(a,b,c)},onFail:Z,onTimeout:Y});E=function(b){a.conf.trans.forward.request("setDefault",{onSuccess:be,onError:bf,onFail:bf},b)}},bj=function(){},bk=function(){bi();_();ba();bj();bd()},bl=function(b){if(T.isInit==!1){p.data.isDialog=b;L=b;p.data.showArrow=t;a.addHTML(n,a.core.util.easyTemplate(j,p.data));y||bk();T.isInit=!0}else{H&&a.setStyle(H,"display","");h&&a.custEvent.fire(h,"switch",[{node:z.forward_link,base:T}])}y.API.focus(0)},bm=function(){a.lib.kit.extra.shine(y.nodeList.textEl)},bn=function(){y.API.blur();H!=null&&a.setStyle(H,"display","none")},bo=function(){a.removeEvent(z.submit,"click",U);a.lib.kit.extra.keySubmit.off(z.textEl,U);a.custEvent.undefine(T);K&&K.remove("origin_all","click");K&&K.remove("report","click");K&&K.remove("switch","click");K&&K.remove("retry","click");K&&K.remove("show","click");K.destroy();K=null;h&&h.destroy&&h.destroy();i&&i.destroy&&i.destroy();R&&R.destroy&&R.destroy();q&&q.destroy&&q.destroy();y.closeWidget();O&&clearInterval(O);y=null;z=null;D=null;H=null;for(var b in T)delete T[b];T=null};T.show=bl;T.hide=bn;T.shine=bm;T.destroy=bo;return T}});
STK.register("lib.forward.source.toFriends",function(a){var b=a.lib.kit.extra.language,c=a.lib.editor.base,d=a.lib.publisher.widget.face,e=a.lib.kit.dom.autoHeightTextArea,f=a.lib.kit.extra.shine,g=a.lib.kit.extra.merge,h=a.lib.kit.extra.textareaUtils,i=a.conf.channel.feed,j=a.lib.kit.dom.parseDOM,k=a.conf.trans.forward,l=a.lib.forward.source.API,m=a.lib.kit.extra.report,n=a.lib.kit.extra.toFeedText,o=a.lib.kit.extra.getDiss,p=a.lib.dialog.ioError,q=a.lib.forward.source.forwardLink,r=null,s=a.lib.dialog.validateCode(),t=b('<#et userlist data><div node-type="toFriends_client"><div class="W_tips tips_warn clearfix"><p class="icon"><i class="W_icon icon_warnS"></i></p><p class="txt"></p></div><div class="WB_text S_bg1" node-type="content"><#if (data.showArrow == true)><a href="javascript:void(0);" action-type="origin_all" class="W_ficon ficon_arrow_down_lite S_ficon">g</a></#if><span class="con S_txt2">${data.content}</span></div><div class="WB_feed_repeat forward_rpt1"><div class="WB_repeat"><div class="WB_feed_publish clearfix"><div class="WB_publish"><div class="p_input p_textarea"><textarea class="W_input" name="" rows="" cols="" title="#L{}#L{}" node-type="textEl">${data.reason}</textarea><span class="tips S_txt2" node-type="num"></span><div class="send_succpic" node-type="success_tip" style="display:none"><span class="W_icon icon_succB"></span><span class="txt">#L{}</span></div></div><div class="p_opt clearfix"><div class="btn W_fr"><a href="javascript:void(0)" node-type="submit" class="W_btn_a"></a><!--<a href="" class="W_btn_a W_btn_a_disable"><i class="W_loading"></i></a>--></div><div class="opt clearfix" test=1 node-type="widget"><span class="ico"><a href="javascript:void(0)" title="#L{}" node-type="smileyBtn"><i class="W_ficon ficon_face">o</i></a></span><ul class="ipt" node-type="cmtopts"><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label for="forward_comment_opt_forwardLi_f" class="W_label"><input node-type="forwardInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_forwardLi_f"><span>#L{} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label for="forward_comment_opt_originLi_f" class="W_label"><input node-type="originInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_originLi_f"><span><#if (data.forwardNick)>#L{} <#else>#L{} </#if>${data.originNick}</span></label></li></#if></ul></div></div></div></div><div node-type="forward_link" class="repeat_list S_line1"></div></div></div></div>'),u=b('<#et cmt data><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_forwardLi_f"><input id="forward_comment_opt_forwardLi_f" type="checkbox" node-type="forwardInput" class="W_checkbox"  /><span>#L{} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_originLi_f"><input id="forward_comment_opt_originLi_f" type="checkbox" node-type="originInput" class="W_checkbox" /><span><#if (data.forwardNick)>#L{} <#else>#L{} </#if>${data.originNick}</span></label></li></#if>'),v={notice:"#L{}",defUpdate:"#L{}",netError:"#L{}",success:"#L{}!",off:"#L{}",on:"#L{}"};return function(o,w,x){(o==null||w==null)&&a.log("[common.forward.toMiyouCircle]Required parameter client is missing");var y=a.parseParam({limitNum:140,tipText:b(v.notice),count:"disable"},x||{}),z,A,B,C,D=!0,E,F=x.data,G=56,H=!1,I=F.originNick?"@"+F.originNick:"",J=n(F.origin.replace(/<[^>]+>/gi,""));F.content=a.trim(J)+"";if(a.bLength(a.core.str.decodeHTML(n(J+I)))>G){F.content=a.leftB(J,G-a.bLength(I))+"...";H=!0}else F.content=F.origin;I?I='<a class="S_func1" href="/'+(F.domain||F.rootuid||F.uid)+'" target="_blank">'+I+"</a>:":I="";F.content=I+F.content;var K=a.trim(F.reason.replace(/[\r|\n|\t]/g,""))||"",L=F.forwardNick?"//@"+F.forwardNick+":"+" ":"",M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ba=!1,bb=!1,bc,bd,be=l,bf,bg={};bg.client=o;bg.opts=x.data||{};bg.isInit=!1;O=a.parseParam({appkey:"",styleId:"1",mark:"",module:"",page_module_id:"",refer_sort:"",forward_link_status:"on"},bg.opts);a.custEvent.define(bg,["forward","hide","center","count","forwardAgain","resetComment","updateNum"]);var bh={changeBtnText:function(c,d){if(d=="normal"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{}")}else{a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{...}')}},canForward:function(){if(!!M&&!!M.API){var a=M.API.count(),b=y.limitNum-a,c=b>=0?!0:!1;if(c){P=!1;Q="";c&&(N.num.innerHTML="<span>"+b+"</span>")}else{P=!0;Q="error";N.num.innerHTML='<span class="S_error">'+b+"</span>"}}}},bi={updateForward:function(c){if(P)Q==="error"&&f(N.textEl);else{var d=a.trim(M.API.getWords()||"");d===b(v.notice)&&(d="");P=!0;Q="loading";a.addClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"loading");var e={};e.appkey=O.appkey;e.mid=w;e.style_type=O.styleId;e.mark=O.mark;e.reason=d||b(v.defUpdate);N.originInput&&N.originInput.checked&&(e.is_comment_base="1");if(N.forwardInput&&N.forwardInput.checked){e.is_comment="1";ba=!0}e.rank=2;e.rankid="";e.group_source="group_all";e.module=O.module;e.page_module_id=O.page_module_id;e.refer_sort=O.refer_sort;r=e;if(be.checkAtNum(d)>5){a.ui.confirm(b("#L{@ }"),{OK:function(){R.request(e)},cancel:function(){P=!1;Q="";a.removeClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"normal")}});return}R.request(e)}},putAside:function(){N.putAside.style.display="none";N.submit.innerHTML=b("#L{}");N.submit.removeAttribute("suda-data")},ctrlUpdateForward:function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){M.API.blur();bi.updateForward()}}},bj=function(){X=a.core.util.storage.get("forward_link_status");if(X=="null"||!X)X=O.forward_link_status;Y=X},bk=function(b,c){M.API.blur();N.success_tip.style.display="";M.API.reset();setTimeout(function(){P=!1;Q="";r=null;a.removeClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"normal");try{b.data.mid=c.mid;b.data.isComment=ba;b.data.isToMiniBlog=!0;a.custEvent.fire(bg,"forward",[b.data,c,x.inDialog]);i.fire("forward",[b.data,c,x.inDialog])}catch(d){}a.custEvent.fire(bg,"hide");bi.putAside();ba=!1},500)},bl=function(a,c){P=!1;Q="";bh.changeBtnText(N.submit,"normal");a.msg=a.msg||b(v.netError);p(a.code,a);ba=!1},bm=function(b,c){P=!1;Q="";a.removeClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"normal");p(b.code,b)},bn=function(b,c,d){K=d;M.API.reset();M.API.insertText(a.trim(a.core.str.decodeHTML(n(K))),0);h.setCursor(N.textEl,0,0);f(N.textEl);O=a.parseParam(O,c);w=c.mid;F=g(F,c);c.forwardNick=c.name;c.originNick=c.rootname;N.cmtopts.innerHTML=a.core.util.easyTemplate(u,c).toString();N=g(N,j(a.builder(N.cmtopts).list))},bo=function(a,b){if(N.cmtopts&&b.data.permission&&b.data.permission.allowComment==0){N.cmtopts.style.display="none";N.cmtopts.innerHTML=""}else if(N.originLi&&b.data.permission&&b.data.permission.allowRootComment==0){N.originLi.style.display="none";N.originLi.innerHTML=""}},bp=function(){a.custEvent.add(bg,"forwardAgain",bn);a.custEvent.add(bg,"resetComment",bo)},bq=function(){R=k.getTrans("toMiyouCircle",{onComplete:function(a,b){var c={onSuccess:bk,onError:bl,requestAjax:R,param:r,onRelease:function(){P=!1;Q="";bh.changeBtnText(N.submit,"normal");ba=!1}};s.validateIntercept(a,b,c)},onFail:bm,onTimeout:bl},F)},br=function(){W=a.builder(o);W=j(W.list).toFriends_client;M=c(W,y);M.API=M.editor.API;a.custEvent.define(M.editor,"close");C=d(M.editor);N=M.nodeList;a.addEvent(N.textEl,"focus",function(){bc=setInterval(function(){bh.canForward()},200)});a.addEvent(N.textEl,"blur",function(){clearInterval(bc)});M.API.insertText(L+a.core.str.decodeHTML(n(K)));e({textArea:N.textEl,maxHeight:145,inputListener:a.funcEmpty});if(_){z=a.lib.forward.source.like(W);A=q(bg,{flNode:N.forward_link,mid:w,data:O})}},bs=function(){a.addEvent(N.submit,"click",bi.updateForward);a.addEvent(N.putAside,"click",bi.putAside);a.lib.kit.extra.keySubmit.on(N.textEl,bi.updateForward);a.addEvent(N.smileyBtn,"click",C.show);if(_){Z=a.delegatedEvent(W);Z.add("origin_all","click",function(b){N.content.innerHTML='<span class="con S_txt2">'+I+a.trim(F.origin)+"</span>"});Z.add("report","click",function(a){return m(a)})}},bt=function(){bj();bp();bq();br();bs()},bu=function(b){if(bg.isInit==!1){x.data.isDialog=b;_=b;x.data.showArrow=H;a.addHTML(o,a.core.util.easyTemplate(t,x.data));M||bt();bg.isInit=!0}else{W&&a.setStyle(W,"display","");a.custEvent.fire(A,"switch",[{node:N.forward_link,base:bg}])}M.API.focus(0)},bv=function(){a.lib.extra.shine(M.nodeList.textEl)},bw=function(){M.API.blur();W!=null&&a.setStyle(W,"display","none")},bx=function(){a.removeEvent(N.submit,"click",bi.updateForward);a.removeEvent(N.putAside,"click",bi.putAside);a.lib.kit.extra.keySubmit.off(N.textEl,bi.updateForward);a.custEvent.undefine(bg);Z&&Z.remove("origin_all","click");Z&&Z.remove("report","click");Z&&Z.remove("switch","click");Z&&Z.remove("retry","click");Z&&Z.remove("show","click");Z=null;A&&A.destroy&&A.destroy();s&&s.destroy&&s.destroy();z&&z.destroy&&z.destroy();M.closeWidget();bc&&clearInterval(bc);M=null;N=null;R=null;W=null;for(var b in bg)delete bg[b];bg=null};bg.show=bu;bg.hide=bw;bg.shine=bv;bg.destroy=bx;return bg}});
STK.register("conf.trans.global",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=window.$CONFIG||{},e=d.domain?"?domain="+d.domain:"",f=d.interactiveUrl;c("language",{url:"/aj/user/lang?_wv=5",method:"post"});c("followList",{url:f+"?fajtype=mblog_attention",method:"post"});c("topicList",{url:f+"?fajtype=mblog_topic",method:"post"});c("myFollowList",{url:f+"?fajtype=mblog_attention",method:"post"});c("closetipsbar",{url:"/aj/tipsbar/closetipsbar?_wv=5",method:"post"});c("weiqunnew",{url:"/ajm/weiqun?action=aj_remindunread"});c("quiet_suggest",{url:"/aj/f/lenovo?ct=10&_wv=5",method:"get"});c("like_object",{url:"/p/aj/like/update"+e,method:"post"});c("like_weibo",{url:"/p/aj/like/set"+e,method:"post"});c("take",{url:"/p/aj/general/button?_wv=5",method:"get"});c("pageTabDelete",{url:"/p/aj/tab/delete"+e,method:"post"});c("getenvelope",{url:"/p/aj/proxy",method:"get"});c("rss",{url:"/p/aj/proxy",method:"get"});return b});
STK.register("conf.channel.flashUpload",function(a){var b=["uploading","uploaded","uploadfail","nofile","complete","deleteFile"];return a.lib.kit.extra.listener.define("conf.channel.flashUpload",b)});
STK.register("lib.message.upload.start",function(a){var b=a.lib.kit.extra.language,c=b('<#et userlist data><div class="img_mod W_fl" fid=${data.fid}><div class="mod_top S_bg1"><p class="prompt S_txt2" node-type="imgLoading_${data.fid}"><i class="W_loading"></i></p><img style="display:none;" width="92" height="92" node-type="imgUrl_${data.fid}" src="${data.url}" alt="${data.fileName}" class="send_img bigcursor"></div><div class="mod_btm clearfix"><span class="W_autocut S_txt2 W_fl">${data.fileName}</span><a href="javascript:void(0);" class="W_fr" node-type="deleteImg_${data.fid}" action-type="cancelImg" action-data="fid=${data.fid}">#L{}</a></div></div>'),d=b('<#et userlist data><div class="files clearfix" fid=${data.fid}><div class="private_file_mod W_fl W_autocut"><span class="mes_acc_icon ${data.fileTypeClass}" node-type="fileType_${data.fid}"></span><span class="W_autocut name S_txt2" node-type="fileName_${data.fid}">${data.fileName} </span> </div><div class="state_mod W_fr"><i class="W_loading" node-type="uploading_icon_${data.fid}"></i><span class="state S_txt1" node-type="uploading_${data.fid}">#L{}</span><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon" node-type="deleteFile_${data.fid}" action-type="cancelFile" action-data="fid=${data.fid}">X</a></div></div></#et>'),e=a.core.util.easyTemplate,f={img:8,file:38};return function(b){var g={};if(!b.target)return g;var h=a.E(b.target),i,j,k=b.fileName,l=b.fileName.toString().replace(/.*\.(\S{1,8})$/,"$1"),m=h.getAttribute("fileType");if(m=="img"){h.parentNode.style.display="";i=c}else{h.style.display="";i=d}j="acc_icon_"+l;f[m]&&a.core.str.bLength(k)>=f[m]&&(k=a.core.str.leftB(k,f[m]-3)+"...");var n=e(i,{fid:b.fid,fileName:k,fileTypeClass:j}).toString();a.insertHTML(h,n,"beforeend");a.conf.channel.flashUpload.fire("uploading",{fid:b.fid,fileName:b.fileName});return g}});
STK.register("lib.message.upload.complete",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.extra.actionData,d={1e3:"K",1e6:"M",1e9:"G"};return function(b,d){var e={};if(!b.target)return e;var f,g=a.E(b.target),h=a.lib.kit.dom.parseDOM(a.builder(g).list),i=b.fid,j=b.data.vfid,k=b.data.tovfid,l=b.fileSize,m=b.fileName,n=b.data.thumbnail_120+"&source=209678993",o=b.data.thumbnail_180+"&source=209678993",p=function(){if(l<1024)return l+" B";if(l<1048576)return parseInt(l/102.4)/10+" K";if(l<1073741824)return parseInt(l/104857.6)/10+" M"}();if(g.getAttribute("fileType")=="file"){f=g;a.removeNode(h["uploading_"+i]);a.removeNode(h["uploading_icon_"+i]);h["fileName_"+i].innerHTML=m+" ("+p+")";c(h["deleteFile_"+i]).set("fileSize",l);h["deleteFile_"+i].setAttribute("action-type","deleteFile")}else{f=g.parentNode;a.removeNode(h["imgLoading_"+i]);h["imgUrl_"+i].style.display="";h["imgUrl_"+i].setAttribute("src",n);h["imgUrl_"+i].setAttribute("action-type","imgEnlarge");h["imgUrl_"+i].setAttribute("action-data","s="+n+"&l="+o+"&size=120");c(h["deleteImg_"+i]).set("fileSize",l);h["deleteImg_"+i].setAttribute("action-type","deleteImg")}f.setAttribute("fids",(f.getAttribute("fids")||"")+","+i);f.setAttribute("tovfids",(f.getAttribute("tovfids")||"")+","+k);f.setAttribute("vfids",(f.getAttribute("vfids")||"")+","+j);a.conf.channel.flashUpload.fire("uploaded",b);return e}});
STK.register("lib.message.upload.init",function(a){return function(){}});
STK.register("lib.message.upload.error",function(a){var b=a.lib.kit.extra.language,c=b('<p class="prompt S_txt2">#L{}</p>'),d=b("#L{}");return function(e,f){if(e.code&&e.code==-1)return a.ui.alert(b("#L{}"));if(e.code&&e.code==-3)return a.ui.alert(b("#L{5}"));var g={};if(!e.target)return g;var h,i=a.E(e.target),j=a.lib.kit.dom.parseDOM(a.builder(i).list),k=e.fid,l=e.fileName,m=e.data.thumbnail_120+"&source=209678993",n=e.data.thumbnail_180+"&source=209678993";if(i.getAttribute("fileType")=="file"){h=i;a.removeNode(j["uploading_"+k]);j["fileName_"+k].innerHTML=l+" ("+d+")";j["deleteFile_"+k].setAttribute("action-type","deleteFile")}else{h=i.parentNode;j["imgUrl_"+k].parentNode.innerHTML=c;j["deleteImg_"+k].setAttribute("action-type","deleteImg")}h.setAttribute("fids",(i.getAttribute("fids")||"")+","+k);a.conf.channel.flashUpload.fire("uploadfail",e);return g}});
STK.register("lib.kit.extra.runFlashMethod",function(a){return function(a,b,c){var d,e,f,g=function(){if(a[b]){e=!0;clearTimeout(d);try{a.TotalFrames()}catch(h){a.TotalFrames}c()}else f=setTimeout(g,100)};g();d=setTimeout(function(){e||clearTimeout(f)},1e4);return{destroy:function(){clearTimeout(d);clearTimeout(f)}}}});
STK.register("lib.message.upload.loadSwf",function(a){var b=a.lib.kit.extra.language;return function(c,d){var e={},f,g=!1,h=a.C("span"),i,j;window._feedsdk_upload={start:STK.lib.message.upload.start,init:STK.lib.message.upload.init,complete:STK.lib.message.upload.complete,error:STK.lib.message.upload.error};var d=a.parseParam({fileListNode:null,fn_start:"window._feedsdk_upload.start",fn_init:"window._feedsdk_upload.init",fn_complete:"window._feedsdk_upload.complete",fn_error:"window._feedsdk_upload.error",uid:$CONFIG.uid,source:"209678993",uploadAPI:"http://upload.api.weibo.com/2/mss/upload.json",flashURL:"http://service.weibo.com/staticjs/tools/upload.swf",fileType:"file",maxFileSize:50,maxFileCount:5,flash_width:25,flash_height:20,areaInfo:"0-20|10-22",flashID:"uploadflash_id_"+a.getUniqueKey(),multiSelect:0,deleteConfirm:null,flashCssText:"",pasteEl:null},d||{});if(!d.fileListNode)throw new Error("message.upload.loadSwf:fileListNode");if(d.fileType=="img"){i=a.C("div");i.className="imgs clearfix";d.fileListNode.appendChild(i)}else i=d.fileListNode;var k=50,l=1,m={},n={},o=function(c,e){var f=window.$CONFIG&&window.$CONFIG.version||(new Date).getTime(),g={swfid:d.flashID,maxSumSize:d.maxFileSize,maxFileSize:d.maxFileSize,maxFileNum:d.maxFileCount,multiSelect:0,uploadAPI:encodeURIComponent(d.uploadAPI+"?source=209678993&tuid="+d.uid),initFun:d.fn_init,sucFun:d.fn_complete,errFun:d.fn_error,beginFun:d.fn_start,areaInfo:d.areaInfo,fExt:d.fileType=="img"?"*.jpg;*.gif;*.jpeg;*.png":"*",fExtDec:d.fileType=="img"?b("#L{}"):b("#L{}")},h=a.core.util.swf.create(c,d.flashURL,{width:d.flash_width,height:d.flash_height,paras:{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"",wmode:"transparent"},flashvars:g});return h},p=function(a){m[a.fid]={fileName:a.fileName,fileSize:a.fileSize}},q=function(b){n[b.fid]={fileName:b.fileName,fileSize:b.fileSize,vfid:b.data.vfid,tovfid:b.data.tovfid};a.custEvent.fire(e,"uploaded",[b.fid,n[b.fid]])},r=function(a,b){},s=function(b){var c=b.clipboardData,d,e,f;if(c){d=c.items;if(!d)return;f=d[0];e=c.types||[];for(var g=0;g<e.length;g++)if(e[g]==="Files"){f=d[g];break}if(f&&f.kind==="file"&&f.type.match(/^image\//i)){var h=f.getAsFile(),i=new FileReader;i.onload=function(b){a.lib.kit.extra.runFlashMethod(j,"screenCapture",function(){j.screenCapture(b.target.result.split(",")[1])})};i.readAsDataURL(h)}}},t=function(){var a=d.fileListNode.getAttribute("fids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},u=function(){var a=d.fileListNode.getAttribute("vfids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},v=function(){var a=d.fileListNode.getAttribute("tovfids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},w=function(){for(var a in m)if(!n[a])return!1;return!0},x=function(){a.lib.kit.extra.installFlash()},y=function(b){var c=a.sizzle('[fid="'+b+'"]',i)[0],f=n[b]||{},g=f.fileSize,h=f.vfid,k=f.tovfid;if(!c||!g)return a.log("");a.removeNode(c);var l=a.sizzle("[fid]",i);l.length||(d.fileListNode.style.display="none");z("fids",b);h&&z("vfids",h);k&&z("tovfids",k);a.lib.kit.extra.runFlashMethod(j,"removeFileBySize",function(){j.removeFileBySize(g)});a.custEvent.fire(e,"deleted",[b,n[b]]);delete m[b];delete n[b]},z=function(a,b){var c=d.fileListNode.getAttribute(a),e=c.replace(","+b,"");d.fileListNode.setAttribute(a,e)},A=function(){try{j.resetUploadedFileNum(0);j.resetUploadedFileSize(0)}catch(a){}d.fileListNode.style.display="none";i.innerHTML="";d.fileListNode.setAttribute("fids","");d.fileListNode.setAttribute("vfids","");d.fileListNode.setAttribute("tovfids","");m={};n={}},B=function(b){var c=b.data.fid,e=a.sizzle('[fid="'+c+'"]',i)[0],f=(n[c]||{}).fileSize;a.removeNode(e);var g=a.sizzle("[fid]",i);g.length||(d.fileListNode.style.display="none");delete m[c]},C=function(c){var e=c.data;typeof d.deleteConfirm!="function"?a.ui.confirm(b("#L{"+(d.fileType=="img"?"":"")+"}"),{OK:function(){y(e.fid)}}):d.deleteConfirm(e,c)},D=function(b){a.lib.kit.extra.runFlashMethod(j,"resetUploadAPI",function(){j.resetUploadAPI(b)})},E=function(){c.style.position="relative";h.style.cssText=d.flashCssText||"display:inline-block;position:absolute;left:0px;top:-2px;z-index:9999";c.appendChild(h);d.fileListNode.className="sendbox_"+(d.fileType=="img"?"img":"file")+" S_line2"},F=function(){f=a.delegatedEvent(d.fileListNode);f.add(d.fileType=="img"?"deleteImg":"deleteFile","click",C);f.add(d.fileType=="img"?"cancelImg":"cancelFile","click",B);a.custEvent.define(e,["deleteConfirm","uploading","uploaded","deleted"]);a.conf.channel.flashUpload.register("uploading",p);a.conf.channel.flashUpload.register("uploaded",q);a.conf.channel.flashUpload.register("uploading",r);d.fileType=="img"&&d.pasteEl&&d.pasteEl.addEventListener&&d.pasteEl.addEventListener("paste",s)},G=function(){f.destroy();a.custEvent.undefine(e,["deleteConfirm","uploading","uploaded","deleted"]);a.conf.channel.flashUpload.remove("uploading",p);a.conf.channel.flashUpload.remove("uploaded",q);a.removeNode(h)};e.resetUploadAPI=D;e.deleteFile=y;e.checkUploadComplete=w;e.getFids=t;e.getVfids=u;e.getTovfids=v;e.deleteAllFiles=A;e.destroy=G;E();F();if(a.lib.kit.extra.getFlashVersion()>=10){j=o(h);e.flashNode=j;if(i){i.setAttribute("id",d.flashID);i.setAttribute("fileType",d.fileType);i.setAttribute("swfid",j.getAttribute("id"))}}else a.addEvent(c,"click",x);return e}});
STK.register("lib.message.upload.mergeFileCount",function(a){return function(b,c){var d={};if(!b)return d;var e=c||{},f={},g=parseInt(e.count)||5,h=0,i=function(c,d,e){if(!f[d]&&!!e){h++;f[d]=e;a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetUploadedFileNum",function(){b.flashNode.resetUploadedFileNum(h)})})}},j=function(c,d,e){if(!!f[d]&&!!e){h--;delete f[d];a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetUploadedFileNum",function(){b.flashNode.resetUploadedFileNum(h)})})}};a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetFileNum",function(){b.flashNode.resetFileNum(g)});a.custEvent.add(b,"uploaded",i);a.custEvent.add(b,"deleted",j)})}});
STK.register("lib.message.upload.getFlash",function(a){return function(b){return a.sizzle('[flashobj="'+b+'"]')[0]}});
STK.register("lib.kit.dom.textSelection",function(a){return function(b,c){var d,e;d={};e=a.parseParam({},c);var f=function(c){return a.core.dom.selectText(b,c)},g=function(){b.__areaQuery=a.jsonToQuery(a.core.dom.textSelectArea(b))},h=function(){b.__areaQuery=!1};a.addEvent(b,"beforedeactivate",g);a.addEvent(b,"active",h);var i=function(){var c=null;try{c=a.core.dom.textSelectArea(b)}catch(d){c=a.queryToJson(b.__areaQuery)}c.start===0&&c.len===0&&b.__areaQuery&&(c=a.queryToJson(b.__areaQuery));c.start=parseInt(c.start,10);c.len=parseInt(c.len,10);return c},j=function(a,c){var d=b.value,e=c.start,f=c.len||0,g=d.slice(0,e),h=d.slice(e+f,d.length);b.value=g+a+h;d=null;g=null;h=null;var e=null,f=null};d.setCursor=function(a){f(a)};d.getCursor=function(){return i()};d.insertCursor=function(a){var b=i();j(a,b);b.len=a.length;f(b)};d.TempletCursor=function(c){var d,e,g;d=i();d.len>0?e=b.value.substr(d.start,d.len):e="";g=a.templet(c,{origin:e});j(g,d);d.start=d.start+c.indexOf("#{origin");d.len=g.length-c.replace(/#\{[origin].+?\}/,"").length;f(d)};d.insertText=j;d.destroy=function(){a.removeEvent(b,"beforedeactivate",g);a.removeEvent(b,"active",h);b=null};return d}});
STK.register("lib.kit.dom.smartInput",function(a){return function(b,c){var d,e,f,g,h,i,j,k,l,m="stop",n,o,p,q,r;d=a.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:!1,LazyInputDelay:200},c);e=a.cascadeNode(b);h=a.lib.kit.dom.textSelection(b);a.custEvent.define(e,"enter");a.custEvent.define(e,"ctrlEnter");a.custEvent.define(e,"lazyInput");f=function(){d.maxLength&&a.bLength(b.value)>d.maxLength&&(b.value=a.leftB(b.value,d.maxLength))};o=function(){if(b.value===d.notice){b.value="";d.noticeClass!=null&&a.removeClassName(b,d.noticeClass)}d.currentClass!=null&&a.addClassName(b.parentNode,d.currentClass)};p=function(){if(b.value===""){b.value=d.notice;d.noticeClass!=null&&a.addClassName(b,d.noticeClass)}d.currentClass!=null&&a.removeClassName(b.parentNode,d.currentClass)};g=function(){f();return b.value===d.notice?"":b.value};q=function(b){b.keyCode===13&&a.custEvent.fire(e,"enter",g())};r=function(b){(b.keyCode===13||b.keyCode===10)&&b.ctrlKey&&a.custEvent.fire(e,"ctrlEnter",g())};i=function(){if(m==="stop"){l=setInterval(k,d.LazyInputDelay);m="sleep"}};j=function(){clearInterval(l);m="stop"};k=function(){if(n===b.value)if(m==="weakup"){a.custEvent.fire(e,"lazyInput",b.value);m="sleep"}else m==="waiting"&&(m="weakup");else m="waiting";n=b.value};if(d.needLazyInput){a.addEvent(b,"focus",i);a.addEvent(b,"blur",j)}a.addEvent(b,"focus",o);a.addEvent(b,"blur",p);a.addEvent(b,"keyup",f);a.addEvent(b,"keydown",q);a.addEvent(b,"keydown",r);e.getValue=g;e.setValue=function(a){b.value=a;f();return e};e.setNotice=function(a){d.notice=a;return e};e.setNoticeClass=function(a){d.noticeClass=a;return e};e.setNoticeStyle=function(a){d.noticeStyle=a;return e};e.setMaxLength=function(a){d.maxLength=a;return e};e.restart=function(){p()};e.startLazyInput=i;e.stopLazyInput=j;e.setCursor=h.setCursor;e.getCursor=h.getCursor;e.insertCursor=h.insertCursor;e.insertText=h.insertText;e.destroy=function(){if(d.needLazyInput){a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p)}j();a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p);a.removeEvent(b,"keyup",f);a.removeEvent(b,"keydown",q);a.removeEvent(b,"keydown",r);a.custEvent.undefine(e,"enter");a.custEvent.undefine(e,"ctrlEnter");a.custEvent.undefine(e,"lazyInput");h.destroy();e=null};return e}});
STK.register("lib.forward.source.toMessage",function(a){var b=a.lib.kit.extra.language,c=a.lib.editor.base,d=a.lib.publisher.widget.face,e=a.lib.kit.dom.autoHeightTextArea,f=a.lib.kit.extra.shine,g=a.ui.tip,h=a.lib.kit.extra.getDiss,i=a.conf.channel.feed,j=a.lib.forward.source.API,k=a.conf.trans.forward,l=a.lib.kit.dom.smartInput,m=a.lib.dialog.validateCode,n=a.lib.message.upload.loadSwf,o=a.lib.message.upload.getFlash,p=a.lib.dialog.ioError,q=a.lib.kit.dom.parseDOM,r,s,t,u={limitNum:1e4,count:"disable"},v=b('<#et userlist data><div node-type="toMessage_client"><div class="WB_feed_repeat forward_rpt2" ><div class="WB_repeat"><!-----><div class="WB_feed_publish clearfix"><div class="WB_face W_fl"></div><div class="WB_publish"><div class="p_input"><textarea class="W_input" node-type="msgTo"></textarea></div></div></div><!-----><div class="WB_feed_publish clearfix"><div class="WB_face W_fl">   </div><div class="WB_publish"><div class="sendbox_mod sendbox_mod_down sendbox_mod_focus" node-type="uploadTd"><div class="sendbox_area S_bg2"><textarea node-type="textEl" name="" cols="" rows="" class="W_input W_f14" style=""> #L{}&#13; <#if (data.url)>${data.url}</#if></textarea></div><!--  --><div node-type="uploadList" class="sendbox_annex S_bg2 S_line3"><div class="sendbox_file S_line2" node-type="uploadFile" style="display:none;"></div><!--  --><!--  --><div class="sendbox_img S_line2" style="display:none;" node-type="uploadImg"></div></div><!--  --><div class="sendbox_bar clearfix"><div class="sendbox_menu W_fl" node-type="widget"><a href="javascript:void(0);" class="icon_send" node-type="smileyBtn"> <em class="W_ficon ficon_face">o</em></a><a href="javascript:void(0);" class="icon_send" node-type="picBtn"> <em class="W_ficon ficon_image">p</em></a><a href="javascript:void(0);" class="icon_send" node-type="attachBtn"><em class="W_ficon ficon_file">x</em></a></div><div class="sendbox_btn W_fr"><span class="prompt S_txt1" node-type="num">  <em>10000</em>  </span><a href="javascript:void(0);" node-type="submit" class="W_btn_a"></a></div></div></div></div><!--  --> </div><!--/---><#if (data.isDialog == true)></div></div></#if></div></#et>'),w={notice:"#L{}",nameNotice:"#L{}",defUpdate:"#L{}",netError:"#L{}",success:"#L{}!",retry:'#L{}<a href="#" onclick="return false;" action-type="retry" value="retry">#L{}</a>',off:"#L{}",on:"#L{}"},x=function(c,d){if(d=="normal"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{}")}else{a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{...}')}};return function(h,i,o){function U(){a.removeEvent(y.msgTo,"focus",U);sugg=$suggest({textNode:y.msgTo,callback:function(a){}});sugg.show()}var r=m();if(h==null||i==null)throw new Error("[lib.invoke.forward.publisher.toPrivateMsg]Required parameter client is missing");var t,y,z,A,B,C,D,E,F,G,H=j,I,J,K={};K.client=h;K.opts=o||{};K.isInit=!1;var L,M;a.custEvent.define(K,["forward","hide","center","updateNum"]);var N=function(){if(s){A=!1;B="";s=null;x(y.submit,"normal")}},O=function(){var c=t.API.getExtra();if(A)B==="error"&&f(y.textEl);else{var d=a.trim(t.API.getWords()||"");d===b(w.notice)&&(d="");var e=a.trim(y.msgTo.value);e===b(w.nameNotice)&&(e="");if(d===""){f(y.textEl);return}if(e===""){f(y.msgTo);return}A=!0;B="loading";x(y.submit,"loading");var g={};g.text=d||b(w.defUpdate);var h=L.getTovfids().concat(M.getTovfids());if(h.length!=0){g.fids=h.join(",");g.tovfids=h.join(",")}g.appkey=K.opts.data.appkey;g.id=i;g.screen_name=e;s=g;s.module=K.opts.data.module;s.page_module_id=K.opts.data.page_module_id;s.refer_sort=K.opts.data.refer_sort;V()}},P=function(b){if((b.keyCode===13||b.keyCode===10)&&b.ctrlKey){t.API.blur();a.core.evt.fireEvent(y.submit,"click")}},Q=function(){if(!!t&&!!t.API){var a=t.API.count(),c=u.limitNum-a,d=c>=0?!0:!1;if(d){A=!1;B="";if(d){y.num.innerHTML=b("#L{}<span>"+c+"</span> #L{}");y.num.style.display="none"}}else{A=!0;B="error";y.num.innerHTML=b('#L{}<span class="S_error">'+Math.abs(c)+"</span> #L{}");y.num.style.display=""}}},R=function(c,d){t.API.blur();s=null;A=!1;B="";x(y.submit,"normal");try{c.data.mid=d.mid;c.data.toPrivateMsg=!0;a.custEvent.fire(K,"forward",[c.data,d,o.inDialog])}catch(e){}a.custEvent.fire(K,"hide");g("lite",{msg:b(w.success),type:"succ",timer:"500"});t.API.reset();G.reset()},S=function(a,b){A=!1;s=null;B="";x(y.submit,"normal");p(a.code,a)},T=function(a,b){A=!1;B="";s=null;x(y.submit,"normal");p(a.code,a)},V=function(b){if(!L.checkUploadComplete()||!M.checkUploadComplete())setTimeout(function(){V(b)},100);else{s=a.lib.kit.extra.getDiss(s,y.submit);C.request(s)}},W=function(b,c){a.ui.confirm("",{OK:function(){L.deleteFile(c.fid,c.fileSize)}})},X=function(b,c){a.ui.confirm("",{OK:function(){M.deleteFile(c.fid,c.fileSize)}})},Y=function(){var b;D=a.builder(h);b=q(D.list);D=b.toMessage_client;t=c(D,u);t.API=t.editor.API;a.custEvent.define(t.editor,"close");J=d(t.editor);y=t.nodeList;L=n(b.picBtn,{fileType:"img",fileListNode:b.uploadImg,pasteEl:y.textEl});M=n(b.attachBtn,{fileType:"file",fileListNode:b.uploadFile});a.lib.message.upload.mergeFileCount([L,M]);a.addEvent(y.textEl,"focus",function(){a.addClassName(y.uploadTd,"sendbox_mod_focus");F=setInterval(function(){Q()},200)});a.addEvent(y.textEl,"blur",function(){a.removeClassName(y.uploadTd,"sendbox_mod_focus");clearInterval(F)});e({textArea:y.textEl,maxHeight:145,inputListener:a.funcEmpty})},Z=function(){a.addEvent(y.submit,"click",O);a.lib.kit.extra.keySubmit.on(y.textEl,O);a.addEvent(y.smileyBtn,"click",J.show)},_=function(){},ba=function(){C=k.getTrans("create",{onComplete:function(a,b){var c={onSuccess:R,onError:S,requestAjax:C,param:b,onRelease:function(){A=!1;s=null;B="";x(y.submit,"normal")}};r.validateIntercept(a,b,c)},onFail:T})},bb=function(){ba();Y();Z();_();I=l(y.msgTo,{notice:b(w.nameNotice)});I.restart();a.ui.suggest(y.msgTo).on("suggest",function(b,c,d){a.conf.trans.global.request("followList",{onSuccess:function(b){var c=[];a.foreach(b.data,function(a){var b=a.remark?"("+a.remark+")":"";c.push([a.screen_name+b,a.screen_name])});d(c)}},{q:c})})},bc=function(c){if(K.isInit==!1){E=c;o.data.msgTo=b(w.nameNotice);o.data.isDialog=c;o.data.origin=a.trim(o.data.origin);a.addHTML(h,a.core.util.easyTemplate(v,o.data));t||bb();K.isInit=!0}else D&&a.setStyle(D,"display","");t.API.focus(0)},bd=function(){t.API.blur();D!=null&&a.setStyle(D,"display","none")},be=function(){a.removeEvent(y.submit,"click",O);a.lib.kit.extra.keySubmit.off(y.textEl,O);a.custEvent.undefine(K);sugg&&sugg.destroy();t.closeWidget();s=null;F&&clearInterval(F);r&&r.destroy&&r.destroy();t=null;y=null;C=null;D=null;for(var b in K)delete K[b];L&&L.destroy&&L.destroy();M&&M.destroy&&M.destroy();K=null};K.show=bc;K.hide=bd;K.destroy=be;return K}});
STK.register("lib.forward.source.publisher",function(a){var b=a.lib.kit.extra.language,c=a.lib.forward.source,d=b('<#et userlist data><div class="froward_wrap"><div node-type="forward_tab" class="WB_minitab clearfix"><span class="txt">#L{}</span><ul class="minitb_ul S_line1 S_bg1 clearfix"><#list data.tab as list><li <#if (list.id==data.type)> class="minitb_item current S_line1" <#else> class="minitb_item S_line1" </#if>><a href="javascript:void(0);" action-type="tab_item" action-data="id=${list.id}"<#if (list.id==data.type)> class="minitb_lk S_txt1 S_bg2"<#else> class="minitb_lk S_txt1"</#if><#if (list.suda)> suda-data="key=tblog_tran_miyou&value=miyou_group_click"</#if>node-type="tab_item_bg">${list.name}<#if (list.id==3)><i title="#L{~}" class="W_icon icon_type_friends"></i></#if></a><span class="cur_block"></span></li></#list></ul></div><div node-type="forward_client"></div></div>'),e=[{id:1,name:b("#L{}"),first_one:!0}];e.push({id:3,name:b("#L{}"),suda:!0});e.push({id:2,name:b("#L{}"),last_one:!0});return function(f,g){if(f==null)throw new Error("[common.forward.publisher]Required parameter mid is missing");g=g||{type:1,styleId:"1"};var h={instances:{}},i=g.type,j,k,l,m,n,o,p=a.lib.kit.extra.toFeedText,q={1:c.toMicroblog,2:c.toMessage,3:c.toFriends},r={appkey:"",domInit:!1,forwardNick:"",originNick:"",origin:"",reason:"",url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",uid:"",rootuid:"",pid:"",domain:"",mark:"",page_module_id:"",module:"",refer_sort:"",pic_src:""},s=function(){if(g.domInit==!1)var b=a.core.util.easyTemplate(d),c=b({type:i,tab:e,tab_count:e.length}).toString(),f=a.builder(c);var h=a.lib.kit.dom.parseDOM(f.list);j=h.forward_tab;k=h.forward_client;return f.box};a.custEvent.define(h,["hide","center","forward","updateNum"]);var t=function(a){if(f==null)throw new Error("[common.forward.publisher]Required parameter inner is missing");l=a;v();x(i,{data:g,client:k})},u=function(b){if(m){a.removeClassName(m.parentNode,"current");a.removeClassName(m,"S_bg2")}m=b.el;a.addClassName(m.parentNode,"current");a.addClassName(m,"S_bg2");i=b.data.id||i;x(i,{data:g,client:k})},v=function(){m=a.sizzle('a[node-type="tab_item_bg"]',l);m=m.length>0?m[0]:null;var b=a.sizzle('div[node-type="forward_tab"]',l);b=b.length>0?b[0]:null;if(b){n=a.delegatedEvent(b);n.add("tab_item","click",function(a){i!=a.data.id&&u(a)})}},w=function(b){var c=function(a,b){return a[b]},d=b.split("."),e=a,f,g=0;while(d[g]){f=d[g];e=c(e,f);g++}return e},x=function(c,d){o!=null&&o.hide();!!k.offsetHeight;c=c.toString();var e;if(h.instances[c]==null){var g={},i;for(var j in r)g[j]=d.data[j];g.type=c;i={client:k,data:g,inDialog:!0};if(i.data.allowForward==="0"){i.data.originNick="";i.data.origin=b("#L{}")}i.data.reason=p(i.data.reason);e=q[c](k,f,i);h.instances[c]=e;a.custEvent.add(e,"hide",function(){a.custEvent.fire(h,"hide")});a.custEvent.add(e,"center",function(){a.custEvent.fire(h,"center")});a.custEvent.add(e,"updateNum",function(b,c){a.custEvent.fire(h,"updateNum",c)});a.custEvent.add(e,"forward",function(b,c){a.custEvent.fire(h,"forward",c)})}else e=h.instances[c];e.show(!0);o=e},y=function(){for(var b in h.instances){var c=h.instances[b];c&&c.destroy&&c.destroy();c=null}h.instances=null;a.custEvent.undefine(h);j=null;k=null;l=null;m=null;n&&n.remove("tab_item","click");n=null};h.getDom=s;h.init=t;h.destroy=y;return h}});
STK.register("lib.forward.source.init",function(a){var b={title:"#L{}",commentPerson:"#L{}",originPerson:"#L{}",notice:"#L{}",defUpdate:"#L{}"},c=a.lib.kit.extra.language;return function(d,e){var f={},g={},h,i,j,k=function(){g.cevt=["forward","hide","show","updateNum"];g.callbackCevt=["forward","hide","updateNum"];a.custEvent.define(g,g.cevt)},l=function(){},m=function(){a.custEvent.add(g,"hide",function(){g.destroy()})},n=function(d,e){if(typeof d!="string"&&typeof d!="number")throw new Error("$.common.dialog.forward.show need string (or number) as weiboId");mid=d;e.pic&&(e.pid=e.pic);var k=a.parseParam({appkey:"",type:1,origin:"",reason:"",originNick:"",forwardNick:"",title:c(b.title),domInit:!1,url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",module:"",page_module_id:"",refer_sort:"",pid:"",domain:"",mark:"",pic_src:""},e);i=a.ui.dialog();h=i.getDomList().inner;h.className="layer_forward";i.setTitle(k.title);i.show().setMiddle();j=new a.lib.forward.source.publisher(mid,k);h.appendChild(j.getDom());i.setBeforeHideFn(function(){});j.init(h);a.custEvent.add(j,"hide",function(){o()});a.custEvent.add(j,"updateNum",function(b,c){f.backnum=c.num;a.custEvent.fire(g,"updateNum",f)});a.custEvent.add(j,"center",function(){i.setMiddle()});a.custEvent.add(j,"forward",function(b,c){c=a.core.json.merge(c,f);c.cevtType=b.type;a.custEvent.fire(g,"forward",c)});a.custEvent.add(i,"hidden",function(){h.className="detail";j.destroy();i.clearBeforeHideFn();var b=arguments.callee;a.custEvent.remove(i,"hidden",b);i.clearContent();a.custEvent.fire(g,"hide",f)});i.setMiddle();var l=i._.node;l.style.top=parseInt(l.style.top)-80+"px";a.custEvent.fire(g,"show",{box:i});g.publisher=j},o=function(){i&&i.hide&&i.hide()};g.destroy=function(){o();j.destroy()};var p=function(){k();l();m()};p();g.show=n;return g}});
STK.register("lib.forward.forwardDialog",function(a){return function(b,c){var d=a.lib.forward.source.init();d.show(b,c);return d}});
STK.register("lib.feed.plugins.forward",function(a){var b=a.lib.kit.extra.language;return function(c){var d,e={},f=c.getDEvent(),g=function(c){var e=c.el,f=c.data,g=a.core.dom.neighbor(c.el).parent('[action-type="feed_list_item"]').finish(),i=c.el.getAttribute("error-msg");if(i){a.ui.alert(i);return a.preventDefault()}if(f.allowForward=="0"){a.ui.alert(b("#L{ }"));return a.preventDefault()}var j=g.getAttribute("mid")||c.data.mid,k={},l=a.sizzle('[node-type="feed_list_content"]',g)[0];k.uid=f.uid?f.uid:"";k.uid=f.rootuid?f.rootuid:"";k.url=(f||"")&&f.url;if(!l){a.log("forward : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return a.preventDefault()}var m=a.sizzle('[node-type="feed_list_reason"]',l)[0];if(!m){var n=a.sizzle("[nick-name]",g);n.length&&(k.originNick=n[0].getAttribute("nick-name"));k.reason=l.innerHTML}else{k.originNick=a.sizzle('[node-type="feed_list_originNick"]',l)[0].getAttribute("nick-name")||"";k.reason=(m.innerHTML||"").replace(/[\r\n]+/g,"")}var o=a.sizzle('[node-type="feed_list_forwardContent"]',g)[0];if(o){k.forwardNick=f.name||k.originNick;k.originNick=a.sizzle('[node-type="feed_list_originNick"]',o)[0].getAttribute("nick-name");var p=a.sizzle('[node-type="feed_list_reason"]',o)[0];if(!p){a.log("forward : there is not 'em' node in the feed_list_forwardContent node ");return a.preventDefault()}k.origin=p.innerHTML}else{k.origin=k.reason;delete k.reason}for(var q in f)k[q]=f[q];d=a.lib.forward.forwardDialog(j,k);a.custEvent.add(d,"forward",function(b,e){a.custEvent.remove(d,"forward",arguments.callee);!e.toPrivateMsg&&h(c.el,e)});a.custEvent.add(d,"updateNum",function(b,e){a.custEvent.remove(d,"updateNum",arguments.callee);h(c.el,e)})},h=function(c,d){var e=a.core.dom.neighbor(c).parent('[action-type="feed_list_item"]').finish(),f=a.sizzle('[node-type="forward_btn_text"]',c)[0]||c,g=a.sizzle('[node-type="comment_btn_text"]',e)[0]||a.sizzle('[action-type="fl_comment"]',e)[0];if(f){var h=d.backnum,i=f.innerHTML.match(/\s\d+/);i=i?parseInt(i[0]):0;var j=0;d.cevtType=="forward"&&(j=1);h&&h>i?f.innerHTML=b("#L{}")+" "+(h+j<=0?"":h+j):f.innerHTML=b("#L{}")+" "+(i+j<=0?"":i+j)}if(g&&d.isComment){var i=g.innerHTML.match(/\(([\d]*)\)/);g.innerHTML=b("#L{}")+" "+(i?parseInt(i[1])+1:1)}};f.add("fl_forward","click",g);e.destroy=function(){f.remove("fl_forward","click",g)};return e}});
STK.register("lib.feed.plugins.page",function(a){var b=typeof $CONFIG!="undefined"&&$CONFIG.bigpipe=="true";return function(b){if(!b)a.log("page : need object of the baseFeedList Class");else{var c={},d=b.getNode(),e=b.getDEvent(),f=b.utils,d,g,h,i,j,k,l=function(b){return a.core.dom.getSize(b).height+(parseFloat(a.core.dom.getStyle(b,"marginTop"))||0)+(parseFloat(a.core.dom.getStyle(b,"marginBottom"))||0)},m={pageMoreDisplay:function(b){if(j==undefined){i.style.display="";a.ui.effect(i,"fadeInUp","fast");b=a.fixEvent(b);var c=h.getAttribute("action-data");if(c){c=a.core.json.queryToJson(c);if(c.currentPage){var d=1*c.currentPage,e=a.lib.kit.dom.firstChild(i),g=1*(c.countPage||a.lib.kit.dom.children(i).length),k=(g-d-9)*(l(e)-1);k>0&&(i.scrollTop=k)}}}j=1;return f.preventDefault(b)},pageMoreOver:function(b){if(j==undefined){i.style.display="";a.ui.effect(i,"fadeInUp","fast")}j=1;return f.preventDefault(b)},pageMoreOut:function(b){j=0;clearTimeout(k);k=setTimeout(function(){j==0&&a.ui.effect(i,"fadeOutDown","fast",function(){i&&(i.style.display="none");j=undefined})},500);return f.preventDefault(b)}},n=function(){if(!!d&&(i=a.sizzle("div[action-type=feed_list_page_morelist]",d)[0])&&(h=a.sizzle("a[action-type=feed_list_page_more]",d)[0])){a.addEvent(h,"mouseover",m.pageMoreDisplay);a.addEvent(i,"mouseover",m.pageMoreOver);a.addEvent(h,"mouseout",m.pageMoreOut);a.addEvent(i,"mouseout",m.pageMoreOut)}},o=function(){if(d){clearTimeout(k);g&&g.destroy&&g.destroy();if(h){a.removeEvent(h,"mouseover",m.pageMoreOver);a.removeEvent(i,"mouseover",m.pageMoreOver);a.removeEvent(h,"mouseout",m.pageMoreOut);a.removeEvent(i,"mouseout",m.pageMoreOut)}h=i=j=undefined}},p=function(a,b){o();n()};a.custEvent.add(b,"updateFeed",p);n();c.destroy=function(){o()};return c}}});
STK.register("lib.feed.plugins.login",function(a){return function(b){var c=b.getDEvent();c.add("login","click",function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})});var d={};d.destroy=function(){c.destroy()};return d}});
STK.register("feed",function(a){return function(b,c){var d=[],e=a.lib.feed.base(b,{plNode:b});c=c||{};c.plNode=b;d.push(a.lib.feed.plugins.comment(e,c));d.push(a.lib.feed.plugins.favorite.init(e,a.core.json.merge(c,{isFavoritePage:!1})));d.push(a.lib.feed.plugins.media(e,c));d.push(a.lib.feed.plugins.images(e,c));d.push(a.lib.feed.plugins.like.init(e,c));d.push(a.lib.feed.plugins.lazyload.init(e,c));d.push(a.lib.feed.plugins.jumpurl(e,c));d.push(a.lib.feed.plugins.forward(e,c));d.push(a.lib.feed.plugins.rightmenu(e,c));d.push(a.lib.feed.plugins.page(e,c));d.push(a.lib.feed.plugins.login(e,c));var f=function(){for(var a in d)try{d[a].destroy&&d[a].destroy()}catch(b){}e=null};e.destroy=f;return e}});
STK.register("conf.trans.card",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("userCard",{url:"http://weibo.com/aj/v6/user/newcard",method:"get",requestMode:"jsonp",varkey:"callback"});c("userCard_abroad",{url:"http://www.weibo.com/aj/v6/user/newcard",method:"get",requestMode:"jsonp",varkey:"callback"});return b});
STK.register("lib.card.popcard",function(a){var b=400,c=200;return function(d){var e={},f,g,h,i=!1,j=a.core.json.merge({autoShow:!0,autoHide:!0,priority:"tbrl",attribute:"usercard",out:document.body,showWithAni:null,hideWithAni:null,showWithSetWidth:!1},d),k=a.ui.card(j);k.setContent('<div style="width:300px;height:120px;padding:10px;"></div>');var l=function(a,b){if(a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},m=function(c,d){clearTimeout(h);h=setTimeout(function(){a.custEvent.fire(e,"beforeShow",[c,d]);if(j.autoShow){k.showByTarget(c,d);a.custEvent.fire(e,"show",[c,d])}},b)},n=function(){if(i!=!1){clearTimeout(h);h=setTimeout(function(){a.custEvent.fire(e,"beforeHide");if(j.autoHide){k.hide();a.custEvent.fire(e,"hide")}},c)}};a.custEvent.define(e,["beforeShow","show","beforeHide","hide"]);var o=function(){i=!0},p=function(){i=!1},q=function(b){var c=a.fixEvent(b).target;g=c;if(f!=c){if(a.contains(k.getBox(),c)){clearTimeout(h);return}var d=c.getAttribute(j.attribute);d?m(c,b):n();f=c}},r=function(a){l(a||window.event,k.getBox())&&clearTimeout(h)},s=function(a){l(a||window.event,k.getBox())&&n()},t=function(b){var c=a.fixEvent(b).target;a.contains(k.getBox(),c)||n();var d=c.getAttribute&&c.getAttribute(j.attribute);d&&a.contains(j.out,c)&&m(c,b);f=c;g=c},u=function(b){b=a.fixEvent(b);var c=b.target;c.getAttribute(j.attribute)&&a.preventDefault(b)},v=function(b){var c=a.fixEvent(b).target;a.contains(k.getBox(),c)||k.hide()},w=function(){if(a.lib.kit.touch.cantouch){a.addEvent(document.body,"tap",t);a.addEvent(j.out,"click",u)}else{a.addEvent(j.out,"mousemove",q);a.addEvent(k.getBox(),"mouseover",r);a.addEvent(k.getBox(),"mouseout",s);a.addEvent(j.out,"click",v)}a.custEvent.add(k,"show",o);a.custEvent.add(k,"hide",p)},x=function(){w()},y=function(){if(a.lib.kit.touch.cantouch){a.addEvent(document.body,"tap",t);a.addEvent(j.out,"click",u)}else{a.removeEvent(out,"mousemove",r);a.removeEvent(k.getBox(),"mouseover",r);a.removeEvent(k.getBox(),"mouseout",s);a.removeEvent(j.out,"click",v)}a.custEvent.remove(k,"show",o);a.custEvent.remove(k,"hide",p);k.destroy()};x();e.card=k;e.attribute=j.attribute;e.mouseTarget=function(){return g};e.isShowCard=function(){return i};e.showCard=m;e.hideCard=n;e.destroy=y;return e}});
STK.register("lib.card.usercard.basecard",function(a){var b=a.lib.kit.extra.language,c=a.templet,d=a.lib.kit.extra.merge,e='<div class="W_layer W_layer_pop WB_outReset"><div class="content"><div class="layer_personcard" layout-shell="true" node-type="inner"></div><div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',f='<div style="width:360px;padding-top:15px;padding-bottom:15px;text-align:center"><span>#{msg}</span></div>',g='<div style="width:360px;padding-top:15px;padding-bottom:15px;text-align:center"><i class="W_loading"></i> <span>#L{}...</span></div>',h=3e5,i=document.domain==="www.weibo.com";return function(j){var k={};j=j||{};j.autoShow=!1;j.template=e;var l=a.lib.card.popcard(j),m=l.card,n=m.getBox(),o={},p=a.parseParam({trans:a.conf.trans.card,transName:i?"userCard_abroad":"userCard",temp_error:b(f),temp_loading:b(g),cacheDelay:h,extraData:""},j),q,r,s,t,u,v,w=function(a,b){return o[a]&&o[a][b]?o[a][b]:null},x=function(a,b,c){o[a]||(o[a]={});o[a][b]=c;return c},y=function(a){a?o[a]={}:o={}},z=function(b,c){var c=a.parseParam({success:a.funcEmpty,fail:a.funcEmpty},c),e=b.getAttribute(l.attribute)||"",f=a.queryToJson(e),g=f.id||f.name;f.name&&(f.name=encodeURIComponent(f.name));f.type==undefined&&(f.type=1);var h=f.type,i=w(g,h);i?c.success(b,i):p.trans.request(p.transName,{onComplete:function(a){a.code=="100000"?c.success(b,x(g,h,a.data)):c.fail(b,a.msg)}},d(f,a.queryToJson(p.extraData)))},A,B=500,C=function(d,e,f){t=e;var g=function(){var b=l.mouseTarget();return t==e&&a.contains(document.body,e)&&(b==e||a.contains(n,b))},h=!1;A=setTimeout(function(){if(g()){m.setContent(p.temp_loading).showByTarget(e,f);h=!0}},B);z(e,{success:function(b,c){clearTimeout(A);setTimeout(function(){if(g()){m.setContent(c).showByTarget(b,f);try{a.sizzle('[action-type="webim.conversation"]',m.getBox())[0].style.display="none"}catch(d){}h=!1;window.WBEXP&&window.WBEXP.collect({V6newcard:"card"})}},h?1e3:0)},fail:function(a,d){var e,i;clearTimeout(A);setTimeout(function(){if(g()){i={msg:d||b("#L{}")};e=c(p.temp_error,i);m.setContent(e).showByTarget(a,f);h=!1}},h?B:0)}})},D=function(){q=a.delegatedEvent(n);a.custEvent.add(l,"beforeShow",C);s=setInterval(y,h)},E=function(){r=a.builder(n).list},F=function(){E();D()},G=function(){q&&q.destroy();a.custEvent.remove(l,"beforeShow",C);clearInterval(s);l&&l.destroy()};F();k.devt=q;k.usercard=l;k.lastTarget=function(){return t};k.clearCache=y;k.destroy=G;return k}});
STK.register("conf.channel.follow",function(a){var b=["changeStatus"];return a.lib.kit.extra.listener.define("conf.channel.follow",b)});
STK.register("conf.trans.follow",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.relationUrl;c("follow",{url:d+"?fajtype=follow",method:"post"});c("unFollow",{url:d+"?fajtype=unfollow",method:"post"});c("block",{url:d+"?fajtype=delblack",method:"post"});return b});
STK.register("lib.follow.utils.follow",function(a){var b=a.lib.kit.extra.merge,c=a.conf.channel.follow;return function(d){var e={};d=a.parseParam({trans:a.conf.trans.follow,transNameFollow:"follow",transNameUnfollow:"unFollow",transNameBlock:"block",transNameUnBlock:"unBlock",transNameRemoveFans:"removeFans",refer_sort:"",refer_flag:""},d);var f=a.lib.kit.extra.merge,g=a.lib.dialog.validateCode(),h=function(b,c){a.lib.dialog.ioError(b.code,b)},i=function(e,h){var j=b({uid:undefined,objectid:undefined,f:0,extra:"",refer_sort:d.refer_sort,refer_flag:d.refer_flag,location:window.$CONFIG&&$CONFIG.location||"",oid:window.$CONFIG&&$CONFIG.oid||"",wforce:1,nogroup:!1},h),k=e+(j.objectid?"_object":"");if(e==="follow"){j.api&&(transtype="proxy");var l=d.trans.getTrans(k,{onComplete:function(b,d){var j={onSuccess:function(a,b){var d=f(h,a.data),g=h.onSuccessCb;typeof g=="function"&&g(d);c.fire("changeStatus",{uid:d.uid,objectid:d.objectid,action:e,both:d.relation&&d.relation.follow_me==1})},onError:function(b,c){b.code==100050?a.ui.confirm(b.msg,{OK:function(){h.wforce=0;i(e,h)}}):a.lib.dialog.ioError(b.code,b);var d=h.onFailCb;typeof d=="function"&&d()},requestAjax:l,param:d,onRelease:function(){var a=h.onFailCb;typeof a=="function"&&a()}};g.validateIntercept(b,d,j)}});l.request(j)}else d.trans.request(k,{onSuccess:function(a,b){var d=f(h,a.data),g=h.onSuccessCb;typeof g=="function"&&g(d);c.fire("changeStatus",{uid:d.uid,objectid:d.objectid,action:e,fan:d.relation&&d.relation.follow_me==1})},onError:function(b,c){a.lib.dialog.ioError(b.code,b);var d=h.onFailCb;typeof d=="function"&&d()}},j)};e.follow=function(a){i(d.transNameFollow,a)};e.unFollow=function(a){i(d.transNameUnfollow,a)};e.block=function(a){i(d.transNameBlock,a)};e.unBlock=function(a){i(d.transNameUnBlock,a)};e.removeFans=function(a){i(d.transNameRemoveFans,a)};return e}});
STK.register("conf.trans.setGroup",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.relationUrl;c("list",{url:d+"?fajtype=grouplist",method:"get"});c("update",{url:d+"?fajtype=groupupdate",method:"post"});c("add",{url:d+"?fajtype=groupadd",method:"post"});c("checkcloserelation",{url:d+"?fajtype=checkcloserelation",method:"post"});c("addCloseFriend",{url:d+"?fajtype=createcloserelation",method:"post"});c("batchSet",{url:"/aj3/attention/aj_group_batchupdate_v4.php",method:"post"});return b});
STK.register("lib.dialog.groupListPanel",function(a){var b=a.lib.kit.extra.language,c=b("#L{}");return function(c){var d={},e=a.C("div"),f={},g={},h,i=a.delegatedEvent(e),j=$CONFIG.imgPath+"style/images/common/transparent.gif",k=[{mode:"special",className:"W_ico16 i_conn_public",title:b("#L{}")},{mode:"normal",className:"W_ico16 i_conn_public",title:b("#L{}")}],l=function(a,b,c){if(!!a){c&&(c=c.toUpperCase());var d=a[b];while(d){if(d.nodeType==1&&(c?d.nodeName==c:!0))break;d=d[b]}return d}},m=c.multi?'style="display:none;"':'<#if (item.belong==1)><#else>style="display:none;"</#if>',n='<ul node-type="#{mode}" class="group_ul #{addOnClass} clearfix"></ul>',o=a.core.util.easyTemplate('<#et listItem gList><#list gList as item><li class="group_li" ><label for="${item.gid}"><input action-type="select" id="${item.gid}" type="checkbox"<#if (item.recom_join)> recom_join="1" </#if><#if (item.belong==1 || item.recom_join || item.gid == 0)>checked="checked"</#if> <#if (item.ogname)>ogname="${item.ogname}"</#if>class="W_checkbox" value="${item.gid}"><span class="group_name <#if (item.gid==0 || item.recom_join)>W_autocut</#if>"  node-type="gplist_${item.gid}_gname"><span><#if (item.ogname)>${item.ogname}<#elseif (item.gname)>${item.gname}</#if></span><#if (item.needIcon == 1)><span class="W_icon icon_askS" action-type="specialAttentionTip"></span><#elseif (item.gid == 0)><i class="new_group_tag">'+b("#L{}")+"</i></#if>"+"<#if (item.gid == 0)>"+'<em class="S_txt2">('+b("#L{}")+'</em></span><em class="S_txt2">)</em>'+"<#elseif (item.recom_join)>"+'<em class="S_txt2">('+b("#L{}")+'</em></span><em class="S_txt2">)</em>'+"</#if>"+"<#if (item.recom_add)>"+'<em class="S_txt2">('+b("#L{}")+'</em></span><em class="S_txt2">)</em>'+"</#if>"+"</label>"+"</li>"+"</#list>"+"</#et>"),p,q='<div class="W_layer W_layer_pop WB_outReset"><div class="content layer_mini_info"> <p class="main_txt"><i class="W_icon icon_succ"></i><span class="txt S_txt1">#L{Ta<br>}</span></p><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',r=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},s=function(){var b="";for(var d=0;d<k.length;d++){d!=k.length-1?k[d].addOnClass="spec":k[d].addOnClass="";b+=a.templet(n,k[d])}e.innerHTML=b;h=a.lib.kit.dom.parseDOM(a.core.dom.builder(e).list);c.data&&A(c.data)},t=function(){for(var b=0;b<k.length;b++){var d=k[b].mode;if(d=="system"&&f[d]){c.fromFollow&&a.foreach(f[d],function(a,b){a.fromFollow=1});var e=o(f[d]).toString(),g=c.fromFollow?h.special:h.normal;g&&a.insertHTML(g,e,"afterbegin")}else if(f[d]){var e=o(f[d]).toString();h[d].innerHTML+=e}}!f.special&&h.special&&(h.special.style.display="none")};lengthLimit=function(b){var c=a.fixEvent(b).target;a.bLength(c.value)>16&&(c.value=a.leftB(c.value,16))},onEnter=function(b){if(b.keyCode===13){var c=a.fixEvent(b).target;a.fireEvent(c,"blur")}};var u=function(b){var c=l(b,"parentNode","li");if(!!c){var d=a.sizzle('input[action-type="select"]',c)[0];g[d.id]||(g[d.id]={});return g[d.id]}},v={show:function(c){p=a.ui.bubble(b(q)).show().beside(c.el,{pos:"bottom-left",offsetX:-10,offsetY:2})},hide:function(){p.hide()}},w=function(){i.add("specialAttentionTip","mouseover",v.show);i.add("specialAttentionTip","mouseout",v.hide)},x=function(){s();w()},y=function(){return e},z=function(b){var c=b.mode||"normal";f[c]=f[c]||[];f[c].push(b);var d=o([b]).toString();a.insertHTML(h[c],d,"beforeend")},A=function(d){f={};if(a.isArray(d))for(var e=0,g=d.length;e<g;e++){d[e].gid=="0"||d[e].recom_join==1?d[e].mode="special":d[e].mode="normal";c.fromFollow&&d[e].gname==b("#L{}")&&(d[e].needIcon=1);var h=d[e].mode;f[h]=f[h]||[];f[h].push(d[e])}t()},B=function(){var b=[],c={suda:[],diss:{allGroup:0,autoSelect:0,gid:[],uid:$CONFIG.uid}},d=a.sizzle('input[action-type="select"]',e),f,g;c.diss.allGroup=d.length;for(var h=d.length;h--;){var i={};f=g=!1;if(d[h].checked){f=!0;var j=u(d[h]);if(j){i.gid=d[h].value;i.gid=="0"&&(i.ogname=d[h].getAttribute("ogname")||"");b.push(i)}}if(d[h].getAttribute("recom_join")){g=!0;c.diss.autoSelect++;c.diss.gid.push(d[h].value)}(g||f)&&c.suda.push(d[h].value+(g?"_a":"_b")+(f?"_1":"_0"))}b.suda_diss=c;return b},C=function(){t()},D=function(){f={};t()},E=function(){i.destroy();g=null;f=null;h=null;e=null},F=function(){var b=a.sizzle('input[action-type="select"]',e);return b.length};x();d.getOuter=y;d.length=F;d.add=z;d.setData=A;d.getData=B;d.reset=C;d.clear=D;d.destroy=E;return d}});
STK.register("lib.dialog.vipError",function(a){var b='<#et temp data><div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="${data.icon}" node-type="icon"></span></dt><dd node-type="inner">${data.info}</dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" <#if (data.lbtnStyle == 1)>class="W_btn_a"<#else if (data.lbtn == 0)>class="W_btn_b"</#if> node-type="lbtn"><span><#if (data.lbtnIcon == 1)><i class="W_icon icon_member"></i></#if>${data.lbtnText}</span></a><a href="javascript:void(0);" <#if (data.rbtnStyle == 1)>class="W_btn_a"<#else if (data.rbtn == 0)>class="W_btn_b"</#if> node-type="rbtn"><span><#if (data.rbtnIcon == 1)><i class="W_icon icon_member"></i></#if>${data.rbtnText}</span></a></div></#et>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.lib.kit.extra.language,e=function(e){var f,g,h;f=a.parseParam({title:d("#L{}"),icon:"warn",info:"",lbtnFunc:a.funcEmpty,lbtnStyle:0,lbtnIcon:0,lbtnText:d("#L{}"),rbtnFunc:a.funcEmpty,rbtnStyle:0,rbtnIcon:0,rbtnText:d("#L{}")},e);f.icon=c[f.icon];g=a.ui.dialog();g.setContent(a.core.util.easyTemplate(b,f).toString());h=g.getDomList(!0);g.setTitle(f.title);var i=function(){f.lbtnFunc();g.hide()},j=function(){f.rbtnFunc();g.hide()};a.addEvent(h.lbtn,"click",i);a.addEvent(h.rbtn,"click",j);a.custEvent.add(g,"hide",function(){a.custEvent.remove(g,"hide",arguments.callee);a.removeEvent(h.lbtn,"click",i);a.removeEvent(h.rbtn,"click",j)});g.show().setMiddle();return g};return function(a,b){if(a=="100096"||a=="100098"){b.lbtnStyle=0;b.lbtnIcon=0;b.lbtnText=d("#L{}");b.rbtnStyle=1;b.rbtnIcon=1;b.rbtnText=d("#L{}");b.rbtnFunc=function(){location.href="http://vip.weibo.com/paycenter?form=group"}}else if(a=="100097"){b.lbtnStyle=0;b.lbtnIcon=0;b.lbtnText=d("#L{}");b.rbtnStyle=0;b.rbtnIcon=0;b.rbtnText=d("#L{}")}return e(b)}});
STK.register("lib.dialog.setGroup",function(a){var b=30,c="http://rs.sinajs.cn/sgmark.gif",d=a.lib.kit.extra.language,e=a.lib.kit.extra.merge;return function(){function C(a){return s.extraPostData?e(a,typeof s.extraPostData=="function"?s.extraPostData():s.extraPostData):a}var f={},g=!1,h=0,i,j=6,k=a.ui.dialog(),l=a.ui.alert,m,n={groupBox:'<div class="layer_set_group" node-type="group_panel"><input type="hidden" node-type="uid" name="touid" ><div class="remark_set" node-type="remarkPanel"><label for=""><em class="W_fb">#L{}</em><input type="text" node-type="remarkInput" name="remark" class="W_input" value="#L{}"></label></div><div class="group_box"><h4 class="tit W_fb" node-type="message">#L{}</h4><div class="loading_box" node-type="loading"><i class="W_loading"></i><span class="S_txt1"></span></div><div class="choose_area"><div class="group_list" node-type="groupList"></div><div node-type="addGroupPanel"><div class="opt_area" node-type="showBtnBox"><a href="javascript:void(0);" class="W_btn_b" action-type="showBtn"><em class="W_ficon ficon_add S_ficon">+</em>#L{}</a></div><div style="display:block;" class="add_group clearfix" node-type="addGroupBox"><div class="W_fl"><input type="text" node-type="groupInput" class="W_input" value="#L{}"><a href="javascript:void(0);" class="W_btn_a" action-type="addGroup" node-type="addGroup">#L{}</a><a action-type="hideBtn" href="javascript:void(0);" action-type="hideBtn">#L{}</a></div></div></div></div><div class="reco_area" style="display:none;" node-type="samelist"><div class="WB_cardtitle_a" ><h4 class="obj_name"><span class="main_title W_fb">#L{Ta}</span></h4><div class="opt_box"><a href="javascript:void(0);"  suda-uatrack="key=V6addattenlayer&value=change" action-type="refresh" class="opt_change S_txt1" node-type="refreshbtn"><em class="W_ficon ficon_rotate W_f14 S_ficon">e</em>#L{}</a></div></div><ul class="pt_ul clearfix" node-type="userList"></ul></div></div></div><div class="W_layer_btn S_bg1" node-type="confirmBox"><a href="javascript:void(0);" suda-data="key=V6addattenlayer&value=save" class="W_btn_a btn_34px" action-type="submit" node-type="submit">#L{}</a><a href="javascript:void(0);" suda-data="key=V6addattenlayer&value=shutdown" class="W_btn_b btn_34px" action-type="cancel">#L{}</a></div>',checkBox:'<input type="checkbox" value="{value}" name="gid" class="W_checkbox" {checked} id="group_{groupId}"><label for="group_{groupId}">{name}</label>',userlist:'<#et data data><li class="picitems" uid="${data.uid}"><div class="midbox"><p class="pic_wrap"><span class="pic_box"><a href="${data.profile_url}" ><img src="${data.profile_image_url}" width="50" height="50" alt="${data.fnick}"  class="pic"></a><a href="${data.profile_url}"  class="icon_bed"><em class="W_icon  ${data.icon}"></em></a></span></p><p class="name W_tc" ><a href="${data.profile_url}"   class="S_txt1">${data.fnick}</a></p><p class="opt" node-type="widget_followBtnBox" action-data="uid=${data.uid}&fnick=${data.fnick}&template=2&nogroup=1&refer_sort=similar&refer_flag=similar&location=afterfollow_v6"><a href="javascript:;" action-type="follow"   class="W_btn_b btn_22px"><em class="W_ficon ficon_add S_ficon">+</em></a></p></div></li></#et>'},o={title:"#L{}",setGroupTitle:"#L{}",gEmpty:"#L{}",rEmpty:"#L{}",gMaxLen:"#L{16}",gDefVal:"#L{}",okLabel:"#L{}",rDefVal:"#L{}",message:'#L{   <span class="W_fb">%s</span>  }',repeat:"#L{}"},p=!1,q=[],r=!1,s,t,u,v,w,x,y,z,A,B,D=function(a){u.remarkInput.value=d(o.rDefVal);u.groupInput.value=d(o.gDefVal);u.showBtnBox.style.display="";u.addGroupBox.style.display="none";u.loading.style.display="";u.groupList.innerHTML=""},E=function(){},F=function(b,c){var e,f;if(b=="addGroup"){e=d("#L{}");f="addGroup"}else{e=d("#L{}");f="submit"}if(c=="normal"){a.addClassName(u[b],"btn_noloading");a.removeClassName(u[b],"W_btn_a_disable");u[f].innerHTML=e}else{a.addClassName(u[b],"W_btn_a_disable");a.removeClassName(u[b],"btn_noloading");u[f].innerHTML=d("#L{...}")}},G=function(b){D(b);s=a.parseParam({uid:"",fnick:"",sex:"m",hasRemark:!0,fromFollow:!1,groupList:[],recommend:[],title:d(o.setGroupTitle),successCb:function(){},cancelCb:function(){},extraPostData:{}},b);r=s.fromFollow;r&&(s.title=d(o.title));b.tarEl&&(s=a.lib.kit.extra.getDiss(s,b.tarEl));A=s.successCb;B=s.cancelCb;u.uid.value=s.uid;if(s.hasRemark){u.remarkInput.removeAttribute("disabled");u.remarkPanel.style.display=""}else{u.remarkInput.setAttribute("disabled","disabled");u.remarkPanel.style.display="none"}s.groupList.length?M(s.groupList):R.request({uid:s.uid});s.recommend.length?N(s.recommend):N([]);u.message.innerHTML=d(o.message,s.fnick);k.setTitle(s.title);k.getDomList().close.setAttribute("suda-uatrack","key=V6addattenlayer&value=shutdown");k.insertElement(u.group_panel,"beforeend");k.insertElement(u.confirmBox,"beforeend");s.fromFollow||(u.remarkPanel.style.display="none");k.show();window.WBEXP&&window.WBEXP.collect({V6addattenlayer:"addatten"})},H=function(b){if(!!b){if(s&&s.fromFollow!=!0)return;var d=parseInt(Math.random()*1e4),e=a.C("img");e.src=c+"?n="+b.allGroup+"_"+b.autoSelect+"&gid="+b.gid.join(",")+"&uid="+b.uid+"&rd="+d;document.body.appendChild(e);setTimeout(function(){e.parentNode.removeChild(e)},3e3)}},I=function(a){var a=a||{};k.hide()},J={defVal:d(o.gDefVal),check:function(b){var c="";b===""||b===this.defVal?c=o.gEmpty:a.core.str.bLength(b)>16&&(c=o.gMaxLen);return d(c)},checkRepeat:function(a){var b="";for(var c=q.length;c--;)if(a===q[c].gname){b=o.repeat;break}return d(b)},showError:function(b){m=a.ui.tipAlert('<span class="txt S_txt1">'+b+"</span>",{autoHide:!1,icon:"rederrorS"}).beside(u.groupInput,{pos:"top-middle"})},hideError:function(){m&&m.hide&&m.hide();m=undefined}},K={defVal:d(o.rDefVal),check:function(b){var c="";b===""?c=o.rEmpty:a.core.str.bLength(b)>16&&(c=o.gMaxLen);return d(c)},showError:function(a){},hideError:function(){}},L=function(b){var c=a.C("li"),d=n.checkBox.replace(/\{value\}/g,b.gid).replace(/\{groupId\}/g,b.gid).replace(/\{name\}/g,b.gname).replace(/\{checked\}/g,b.belong?"checked":"");c.innerHTML=d;return c},M=function(b){var c=b,d=b.recommend,e={data:c,fnick:s.fnick,uid:s.uid,fromFollow:r};t=a.lib.dialog.groupListPanel(e);u.groupList.appendChild(t.getOuter());u.loading.style.display="none";c.length>=20&&(u.addGroupPanel.style.display="none")},N=function(a){i=a;if(!!i){var b=i.length;if(b==0){u.samelist.style.display="none";u.userList.innerHTML="";return}var c=[];u.samelist.style.display="";u.refreshbtn.style.display=b>j?"":"none";P()}},O=function(a){a.icon="";a.verified?a.verified_type==0?a.icon="icon_pf_approve":a.verified_type>=1&&a.verified_type<=7&&(a.icon="icon_pf_approve_co"):a.verified_type==220&&(a.icon="icon_pf_club")},P=function(){var b,c=[],d=i.length;for(var e=0;e<d&&e<j;e++){h>=d&&(h=h-d);b=i[h];h++;O(b);var f=a.core.util.easyTemplate(n.userlist,b).toString();c.push(f)}u.userList.innerHTML=c.join("");window.WBEXP&&window.WBEXP.collect({V6addattenlayer:"similar"})},Q={errorCd:function(b,c){g=!1;if(b.code=="100096"||b.code=="100097"||b.code=="100098"){var d=a.lib.dialog.vipError(b.code,{info:b.data.html,lbtnFunc:function(){location.href=b.data.gurl}});a.custEvent.add(d,"hide",I)}else a.lib.dialog.ioError(b.code,b);F("submit","normal")},getGroupSuccess:function(a,b){M(a.data);i=a.data.recommend||[];N(i)},setGroupSuccess:function(b,c){g=!1;F("submit","normal");I();A(b,c);a.ui.tip("lite",{msg:d(o.okLabel),type:"succM",timer:"500"})},setGroupError:function(a,b){g=!1;J.showError(a.msg)},addGroupSuccess:function(a,b){F("addGroup","normal");var c=a.data,e;u.addGroupPanel.style.display=c.length>=20?"none":"";for(var f in c)if(c[f].belong===1){e=c[f];break}e&&q.push(e);t.add(e);W.hideAddPanel();u.groupInput.value=d(o.gDefVal);t.length()>=20&&(u.addGroupPanel.style.display="none")}},R=a.conf.trans.setGroup.getTrans("list",{onSuccess:Q.getGroupSuccess,onError:Q.errorCd}),S=function(b){a.conf.trans.setGroup.getTrans("update",{onSuccess:Q.setGroupSuccess,onError:Q.errorCd,onFail:Q.errorCd}).request(C(b))},T=a.conf.trans.setGroup.getTrans("batchSet",{onSuccess:Q.setGroupSuccess,onError:Q.errorCd}),U=function(b){a.conf.trans.setGroup.getTrans("add",{onSuccess:Q.addGroupSuccess,onError:function(b,c){F("addGroup","normal");a.lib.dialog.ioError(b.code,b)}}).request(b)},V=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},W={showAddPanel:function(){u.showBtnBox.style.display="none";u.addGroupBox.style.display="";u.groupInput.focus()},hideAddPanel:function(){u.showBtnBox.style.display="";u.addGroupBox.style.display="none";J.hideError();u.groupInput.value=J.defVal},addGroup:function(){var b=V(a.trim(u.groupInput.value)),c=J.check(b)||J.checkRepeat(b);if(c)J.showError(c);else{J.hideError();F("addGroup","loading");U({name:b,ispublic:""})}},submit:function(){if(!g){g=!0;var b={};p=!0;b.type="s";var c=t.getData(),e=[],f=u.remarkInput.value;f===d(o.rDefVal)&&(f="");b.remark=f;var h=u.uid.value;b.user=h;b.gid=a.jsonToStr(c);if(c.suda_diss&&s.fromFollow==!0){var i=c.suda_diss.suda,j=c.suda_diss.diss;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("group_aftermark","save:"+i.join(","))}F("submit","loading");S(b)}},followEnd:function(b){if(b.action=="follow"){var c=b.uid;if(!i)return;var d=i.length;for(var e=d-1;e>=0;e--)if(i[e].uid==c){i.splice(e,1);break}i.length<=j&&(u.refreshbtn.style.display="none");var f=a.sizzle("[uid="+c+"]",u.userList)[0];f&&a.tween(f,{end:function(){if(i.length>=j){var b=h-1;b>=i.length&&(b=0);O(i[b]);var c=a.core.util.easyTemplate(n.userlist,i[b]).toString();a.insertHTML(f,c,"afterend")}a.removeNode(f);f=null},duration:800}).play({opacity:0})}},cancel:function(){p=!1;I()},inputFocus:function(b){return function(c){var c=a.fixEvent(c),d=c.target,e=d.value;b.hideError();e===b.defVal&&(d.value="")}},inputBlur:function(b){return function(c){var c=a.fixEvent(c),d=c.target,e=a.trim(d.value);e||(d.value=b.defVal)}},inputMaxLen:function(c){var c=a.fixEvent(c),d=c.target,e=d.value,f=a.core.str.bLength(e);c.keyCode=="13"?W.submit():f>b&&(d.value=a.core.str.leftB(e,b))}},X=function(){_();Y();Z()},Y=function(){var b=k.getDomList().close;b&&b.setAttribute("suda-uatrack","key=group_aftermark&value=close");a.custEvent.define(f,["hide"]);v=a.core.evt.delegatedEvent(k.getDomList().inner);w=W.inputFocus(J);x=W.inputBlur(J);y=W.inputFocus(K);z=W.inputBlur(K);a.addEvent(u.remarkInput,"focus",y);a.addEvent(u.remarkInput,"blur",z);a.addEvent(u.groupInput,"focus",w);a.addEvent(u.groupInput,"blur",x);a.addEvent(u.remarkInput,"keyup",W.inputMaxLen);a.addEvent(u.groupInput,"keyup",W.inputMaxLen);v.add("showBtn","click",W.showAddPanel);v.add("hideBtn","click",W.hideAddPanel);v.add("addGroup","click",W.addGroup);v.add("submit","click",W.submit);v.add("cancel","click",W.cancel);v.add("refresh","click",P);a.conf.channel.follow.register("changeStatus",W.followEnd)},Z=function(){a.custEvent.add(k,"hide",function(){a.custEvent.fire(f,["hide"]);p||B();var b=t.getData();b&&b.suda_diss&&H(b.suda_diss.diss);J.hideError()})},_=function(){var b=a.core.dom.builder(d(n.groupBox));u=a.lib.kit.dom.parseDOM(b.list)},ba=function(){a.custEvent.undefine(f,["hide"]);a.removeEvent(u.remarkInput,"focus",y);a.removeEvent(u.remarkInput,"blur",z);a.removeEvent(u.groupInput,"focus",w);a.removeEvent(u.groupInput,"blur",x);a.removeEvent(u.remarkInput,"keyup",W.inputMaxLen);a.removeEvent(u.groupInput,"keyup",W.inputMaxLen);a.conf.channel.follow.remove("changeStatus",W.followEnd);w=null;x=null;y=null;z=null;v&&v.destroy();recommend&&recommend.destroy()};X();f.show=G;f.hide=I;f.destroy=ba;return f}});
STK.register("lib.follow.followButton",function(a){function i(c,d,e){a.foreach(h,function(b){a.removeClassName(c,b)});a.foreach([].concat(d[1]),function(b){a.addClassName(c,b)});e===!1?c.innerHTML=b(d[0]):a.ui.badge(c,b(d[0]));c.setAttribute("action-type",d[2])}var b=a.lib.kit.extra.language,c=a.templet,d=a.conf.channel.follow,e=a.lib.kit.extra.merge,f=a.lib.kit.dom.hover,g={0:{temp_follow:['<em class="W_ficon ficon_right S_ficon">Y</em>#L{}<em class="W_ficon ficon_arrow_down_lite S_ficon">g</em>',"W_btn_d","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo S_ficon">Z</em>#L{}<em class="W_ficon ficon_arrow_down_lite S_ficon">g</em>',"W_btn_d","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_c","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right S_ficon">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{}',"W_btn_c","follow"],temp_block:["#L{}","W_btn_d","unBlock"],temp_loading:['<i class="W_loading"></i>#L{}',"W_btn_c","noop"],temp_loading2:['<i class="W_loading"></i>#L{}',"W_btn_d","noop"],temp_layer:['<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li action-type="ok" class="item"><a href="javascript:void(0);" class="tlink S_txt1">#L{}</a></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" class="tlink S_txt1">#L{}</a></li></ul></div></div>'],temp_layerOffset:{x:1,y:2,width:0}},1:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo">Z</em>#L{}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_block:["#L{}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{}',"W_btn_b","noop"],temp_layer:['<div class="layer_menu_list" style="position:absolute;z-index:3000;"><ul><li action-type="ok"><a href="javascript:void(0);">#L{}</a></li><li action-type="setGroup"><a href="javascript:void(0);">#L{}</a></li></ul></div>']},2:{temp_follow:["#L{}",["W_btn_b","W_btn_b W_btn_b_disable"],"noop"],temp_followBoth:["#L{}",["W_btn_b","W_btn_b W_btn_b_disable"],"noop"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_block:["#L{}","W_btn_b","unBlock"],temp_loading:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","noop"],temp_loading2:["#L{}","W_btn_b",""],temp_layer:[""]},3:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{}',"W_btn_b W_btn_b_disable","noop"],temp_followBoth:['<em class="W_ficon ficon_right">Y</em>#L{}',"W_btn_b W_btn_b_disable","noop"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_block:["#L{}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{}',"W_btn_b","noop"],temp_layer:[""]},4:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo">Z</em>#L{}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{}',"W_btn_c","follow"],temp_block:["#L{}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{}',"W_btn_b","noop"],temp_layer:['<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li action-type="ok" class="item"><a href="javascript:void(0);" class="tlink S_txt1">#L{}</a></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" class="tlink S_txt1">#L{}</a></li></ul></div></div>'],temp_layerOffset:{x:1,y:2,width:0}}},h=["W_btn_a","W_btn_b","W_btn_c","W_btn_d","W_btn_a_disable","W_btn_b_disable","W_btn_c_disable","W_btn_d_disable"],j=function(a,b){if(a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b};return function(c){function q(a){return c.extraPostData?e(a,typeof c.extraPostData=="function"?c.extraPostData():c.extraPostData):a}var h={},c=a.parseParam({outer:null,outNodeExpr:'[node-type="followBtnBox"]',refer_sort:"",refer_flag:"",extraPostData:{},needSync:!1,followOpts:null},c),k,l=null,m=a.lib.follow.utils.follow(c.followOpts),n=a.lib.dialog.setGroup,o=a.ui.confirm,p=a.delegatedEvent(c.outer),r=function(b){return a.core.dom.dir.parent(b,{expr:c.outNodeExpr})[0]},s={"click:follow":function(b){a.preventDefault();var d=r(b.el);if(!!d){var e=b.el,f=a.queryToJson(d.getAttribute("action-data")||""),j=d.innerHTML,o,p=f.template||"0";f.onSuccessCb=function(b){var c=b.relation,d=c&&c.follow_me==1;i(l=e,g[p][d?"temp_followBoth":"temp_follow"]);a.custEvent.fire(h,"change",{state:"follow",spec:b});b.groupList=b.group;b.fromFollow=!0;if(!b.nogroup){k||(k=n());setTimeout(function(){k.show(b);a.custEvent.fire(h,"showDialog")},700)}};f.onFailCb=function(b){o&&(d.innerHTML=o);a.custEvent.fire(h,"showDialog")};f.onRelease=function(){d.innerHTML=j};setTimeout(function(){o=d.innerHTML;i(e,g[p].temp_loading,!1);f.refer_sort=f.refer_sort||c.refer_sort;f.refer_flag=f.refer_flag||c.refer_flag;f=q(f);m.follow(f)},0)}},"mouseout:unFollow":function(b){a.preventDefault();if(!!j(b.evt,b.el)){var c=r(b.el);if(c){clearTimeout(c.t);c.t=null}}},"mouseover:unFollow":function(b){a.preventDefault();if(!!j(b.evt,b.el)){var c=r(b.el);if(!c)return;c.confirm||(c.t=setTimeout(function(){var d=b.el,e=a.queryToJson(c.getAttribute("action-data")||""),j=c.innerHTML,o=e.template||"0",p,r;if(!!g[o].temp_layer[0]){e.onSuccessCb=function(b){var c=b.relation,e=c&&c.follow_me==1;i(l=d,g[o][e?"temp_unfollowFan":"temp_unfollow"]);a.custEvent.fire(h,"change",{state:"unfollow",spec:b})};e.onFailCb=function(a){p&&(c.innerHTML=p)};var s=function(){p=c.innerHTML;i(d,g[o].temp_loading2,!1);e.refer_sort="";e=q(e);m.unFollow(e);c.hover.destroy();c.confirm.hide();setTimeout(function(){c.confirm.hide();c.confirm.destroy();c.confirm=null},100)},t=function(b){var c=a.core.util.browser.IE6?"width":"maxWidth",e=g[o].temp_layerOffset?g[o].temp_layerOffset.width|0:0;b.style[c]=d.offsetWidth-(parseInt(a.getStyle(b,"padding-left"))||0)-(parseInt(a.getStyle(b,"padding-right"))||0)-(parseInt(a.getStyle(b,"border-left"))||0)-(parseInt(a.getStyle(b,"border-right"))||0)+e+"px"};c.confirm=a.ui.mlayer(g[o].temp_layer[0],{stopClickPropagation:!0}).on("ok","click",s).on("setGroup","click",function(){k||(k=n());k.show(e);c.confirm.hide();a.custEvent.fire(h,"showDialog")});c.hover=f({act:d,extra:[c.confirm.getBox()],delay:200,isover:!0,onmouseover:function(){c.confirm.getState()||t(c.confirm.show().beside(d,{pos:"bottom-left",offsetX:u,offsetY:v}).getBox())},onmouseout:function(){c.confirm.hide();clearTimeout(r)}});var u=g[o].temp_layerOffset?g[o].temp_layerOffset.x|0:0,v=g[o].temp_layerOffset?g[o].temp_layerOffset.y|0:0;t(c.confirm.show().beside(d,{pos:"bottom-left",offsetX:u,offsetY:v}).getBox())}},200))}},"click:unBlock":function(c){var d=r(c.el);if(!!d){var e=c.el,f=a.queryToJson(d.getAttribute("action-data")||""),g=d.innerHTML,i=f.template||"0";f.onSuccessCb=function(){window.location.reload()};var j=function(){f=q(f);m.unBlock(f)};o(b("#L{}"),{OK:j});a.custEvent.fire(h,"showDialog")}}},t=function(b){var d=b.uid,e=b.objectid,f=b.action.toLowerCase(),h=b.both,j=b.fan,k=a.sizzle(c.outNodeExpr,c.outer);for(var m=0,n=k.length;m<n;m++){var o=k[m],p=a.sizzle("[action-type=noop],[action-type=follow],[action-type=unFollow],[action-type=unBlock]",o)[0],q=a.queryToJson(o.getAttribute("action-data")),r=q.template||"0";l!=p&&(q.uid&&q.uid==d||q.objectid&&q.objectid==e)&&(f=="unfollow"?i(p,g[r][j?"temp_unfollowFan":"temp_unfollow"],!1):f=="unblock"?i(p,g[r].temp_unfollow,!1):f=="follow"&&i(p,g[r][h?"temp_followBoth":"temp_follow"],!1))}l=null},u=function(){a.custEvent.define(h,["change","showDialog"]);a.foreach(s,function(a,b){b=b.split(":");p.add(b[1],b[0],a)});c.needSync&&d.register("changeStatus",t)},v=function(){if(c.outer){a.foreach(s,function(a,b){p.remove(b,"click",a)});p.destroy()}c.needSync&&d.remove("changeStatus",t)},w=function(){c.outer&&u()};w();h.destroy=v;return h}});
STK.register("conf.trans.setRemark",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.relationUrl;c("setRemark",{url:d+"?fajtype=remarkname",method:"post"});return b});
STK.register("lib.dialog.setRemark",function(a){$merge=a.lib.kit.extra.merge;var b='<div class="W_layer WB_outReset" style="top:50px;left:550px;"><div class="content"><div class="W_layer_title" node-type="title">#L{}</div><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_prompt" ><dl class="clearfix"><dt node-type="label">#L{}:</dt><dd><input type="text" class="W_input W_input_default" node-type="input"></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" action-type="ok" class="W_btn_a btn_34px">#L{}</a><a href="javascript:void(0)" action-type="close" class="W_btn_b btn_34px">#L{}</a></div></div></div>';return function(c){function n(a){return c.extraPostData?$merge(a,typeof c.extraPostData=="function"?c.extraPostData():c.extraPostData):a}var d=a.lib.kit.extra.language,e,f,g,h,i,j,k,l="",m={},o={init:function(){o.pars();o.build()},pars:function(){c=c||{};i=c.trans||a.conf.trans.setRemark;j=c.transName||"setRemark";e=c.uid;if(c.uid!=null){f=a.trim(c.remark||"");g=c.callback}},build:function(){h=a.ui.dialog(d(b)).show().on("ok","click",function(){l=a.trim(c.getValue());if(l===f){g&&g(f);h.hide()}else i.request(j,{onSuccess:function(a,b){g&&g(l);h.hide()}||a.funcEmpty,onError:function(b,c){a.lib.dialog.ioError(b.code,b,{beside:h.getDomList().input})},onFail:function(b,c){a.lib.dialog.ioError(b.code,b,{beside:h.getDomList().input})}},n({touid:e,remark:encodeURIComponent(l)}))});h.on("close","click",function(){h.hide()});var c=a.lib.kit.dom.smartInput(h.getDomList().input);c.setNotice(d("#L{}"));c.setValue(f||"");c.setMaxLength(30);c.restart();a.addEvent(c,"keydown",function(){c.value=a.leftB(c.value,30)});setTimeout(function(){c.setCursor({start:c.getValue().length,len:0})},0)},destroy:function(){h.destroy()}};o.init();m.destroy=o.destroy;return m}});
STK.register("lib.card.usercard.getExtra",function(a){function c(a,b,d){d=d||[];b=b||function(){return!0};a&&a.tagName&&"getAttribute"in a&&b(a)===!0&&d.push(a);return a==document.body||!a||!a.parentNode?d:c(a.parentNode,b,d)}function b(b,c){c=typeof c=="string"?a.queryToJson(c||""):c;for(var d in c)c.hasOwnProperty(d)&&!(d in b)&&(b[d]=c[d]);return b}return function(a,d){var e={};c(a,function(a){var c=a.getAttribute(d);if(c){b(e,c);return!0}});return e}});
STK.register("lib.card.usercard.widgets",function(a){function f(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)}var b=a.lib.dialog.setRemark,c=a.conf.channel.follow,d=a.lib.follow.followButton,e=a.lib.card.usercard.getExtra;return function(g){function r(){i.hide();f("V6newcard","addgroup")}var h=g.devt,i=g.usercard.card,j=i.getBox(),k,l=function(){setTimeout(function(){i.hide()},10);a.preventDefault()},m={setRemark:function(c){var d=c.data,h=d.remark;b({uid:d.uid,remark:a.core.str.decodeHTML(decodeURIComponent(h)),callback:function(a){g.clearCache(d.uid);g.clearCache(d.fnick)},extraPostData:function(){return e(g.lastTarget(),"data-usercard-extra")}});l();f("V6newcard","addnote")},"webim.conversation":function(){l();f("V6newcard","privateletter")}},n=function(b,c){g.clearCache(c.spec.uid);g.clearCache(c.spec.fnick);if(c.state==="unfollow"){var d=a.sizzle(".remark",j)[0];d&&(d.style.display="none")}c.state==="follow"?f("V6newcard","addatten"):c.state==="unfollow"&&f("V6newcard","cancelrelation")},o=function(a){g.clearCache(a.uid);g.clearCache(a.fnick)},p=function(a,b){b=b||document.body;return a&&a.tagName&&a.tagName.toUpperCase()==="A"?!0:a&&a.tagName&&a.getAttribute("node-type")==="followBtnBox"?!0:a?a===b?!1:p(a.parentNode,b):!1},q=function(b){b=a.fixEvent(b);var c=b.target;if(!p(c,j)){var d=a.sizzle("a[uid]",j)[0];try{d.click()}catch(e){d.getAttribute("target")==="_blank"?window.open(d.href):setTimeout(function(){location.href=d.href},0)}setTimeout(function(){i.hide()},30)}},s=function(){k=d({outer:j,refer_sort:"card",extraPostData:function(){return e(g.lastTarget(),"data-usercard-extra")}});a.custEvent.add(k,"change",n);a.custEvent.add(k,"showDialog",r);a.foreach(m,function(a,b){h.add(b,"click",a)});a.addEvent(j,"click",q);c.register("changeStatus",o)};s();var t={};t.destroy=function(){a.custEvent.remove(k,"change",n);a.custEvent.remove(k,"showDialog",r);k.destroy();a.foreach(m,function(a,b){h.remove(b,"click",a)});a.removeEvent(j,"click",q)};return t}});
STK.register("usercard",function(a){return function(b){var c=a.lib.card.usercard.basecard,d=a.lib.card.usercard.widgets;d(c({out:b}))}});
STK.core.dom.ready(function(){$CONFIG.usercard!="false"&&STK.usercard(a);STK.feed(a)})}window.__WB_feedSDK||(window.__WB_feedSDK=a)}();
