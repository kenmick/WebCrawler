(function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty,n=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/ajax",["jquery","external/underscore","modules/clean/devtools/perf_hub_actions","modules/clean/job_progress","modules/clean/storage","modules/clean/undo","modules/constants/debug","modules/constants/env","modules/constants/request","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,r,o,i,s,a,u,l,c,_,h,d,p,f,m,g,v){var w,b,y,x,E,S,k,R,T,C,A,L,O,I,N,$,D,P,U,M,F,j,q,H,B,G,W,J,K,X,V,z,Y,Q,Z,tt,et,nt,rt,ot,it,st,at,ut;return st=m._,H="err:",q="async_task_started:",j="async_task_err:",F="done:",P="oref",B=function(t,n){var r,o,i,s,a;return null==t&&(t={}),null==n&&(n=[]),null==t.type&&(null!=t.method?(p.raiseAndReport("Use of method property within modules/clean/ajax's Request",{tags:["module:ajax"]}),s=t.method):s="POST",t.type=s),r=new E(t),o=at(r,n),a=e.ajax({url:o.url(),type:t.type,noDropboxDefaults:!0,data:o.data(),dataType:t.dataType||"text",traditional:!0,xhrFields:o.xhrFields(),success:function(t,e,n){return o.success(t,e,n)},error:function(t,e,n){return o.error(t,e,n)},complete:function(t,e){return o.complete(t,e)},async:null!=(i=t.async)?i:!0}),o.request(a)},at=function(t,e){var n,o,i,s,a,u,l,c;for(o=[t],c=r(e.slice(0)).reverse(),i=0,u=c.length;u>i;i++)n=c[i],o.push(new n);for(a=null,s=0,l=o.length;l>s;s++)n=o[s],a&&(n.next=a),a=n;return a},E=function(){function t(t){null==t&&(t={}),this.options=function(){return t},this.url=function(){return String(t.url||"")},this.data=function(){return t.data||{}},this.xhrFields=function(){return t.xhrFields||{}},this.success=t.success||this.identity,this.error=t.error||this.identity,this.complete=t.complete||this.identity,this.request=this.identity}return t.prototype.identity=function(t){return t},t}(),T=function(){function t(){}return t.prototype.options=function(){return this.next.options()},t.prototype.url=function(){return this.next.url()},t.prototype.data=function(){return this.next.data()},t.prototype.xhrFields=function(){return this.next.xhrFields()},t.prototype.success=function(t,e,n){return this.next.success(t,e,n)},t.prototype.error=function(t,e,n){return this.next.error(t,e,n)},t.prototype.complete=function(t,e){return this.next.complete(t,e)},t.prototype.request=function(t){return this.next.request(t)},t}(),k=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.SUPPORTED_TLDS=["dropbox.com"],r.prototype.data=function(){var t;return p.assert(this._is_db_domain(),"injecting CSRF token into request to non-dropbox domain"),t={is_xhr:!0},"get"!==(this.options().type||"post").toLowerCase()&&(t.t=d.read(c.JS_CSRF_COOKIE)||""),e.extend(t,this.next.data())},r.prototype._is_db_domain=function(){var t,e;return(t=v.parse(String(this.url())).authority)?(e=t.split("."),this.SUPPORTED_TLDS.reduce(function(t,n){var r,o;return o=n.split("."),r=e.slice(-1*o.length).join("."),t||n===r},!1)):!0},r}(T),z=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.data=function(){var t,e;return t=this.next.data(),e=this.options(),e.subject_user&&!t[_.UID_PARAM_NAME]&&(t[_.UID_PARAM_NAME]=String(e.subject_user)),t},n}(T),S=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.error=function(t,e,n){var r,o;return 403===t.status&&(r=s.SessionStorage.get("reload-timestamp"),o=(new Date).getTime(),(!r||o-r>3e4)&&(s.SessionStorage.set("reload-timestamp",o),window.location.reload(!0))),this.next.error(t,e,n)},n}(T),W=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.data=function(){var t;return t=this.next.data(),null!=e.ajaxSettings.restrict&&(t.restrict=e.ajaxSettings.restrict),t},r}(T),G=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.data=function(){var t,n;return t=this.next.data(),c.REQUEST_TRACING_ENABLED&&"post"===this.options().type.toLowerCase()?(n={parent_request_id:c.REQUEST_ID},e.extend(n,t)):t},r}(T),L=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.data=function(){var t,n;return t=this.next.data(),u.CPROFILE_ENABLED?(n={parent_request_id:c.REQUEST_ID,cProfile:u.CPROFILE_PARAMETER},e.extend(n,t)):t},r.prototype.success=function(t,e,n){return o.add_ajax_profile({xhr:n,url:this.url()}),this.next.success(t,e,n)},r}(T),A=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.error=function(t,e,n){return this._notify_dev(t,e,n),this.next.error(t,e,n)},r.prototype._notify_dev=function(t){var n,r,o;return!l.IS_PROD&&500===t.status&&t.getResponseHeader("X-Debug-Url")?(o=t.getResponseHeader("X-Debug-Url"),n=e("<span />"),n.text(g.DEFAULT_ERROR),r=e("<a/>",{href:o,target:"_blank"}).text(st("View debug")),n.append("&nbsp;").append(r),g.error(new f(n.html()))):void 0},r}(T),Y=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.success=function(t,e,n){var r,o,i;return n.responseText.length?0===n.responseText.indexOf(H)?(r=n.responseText.substr(H.length),i=this.next.error(n,e,r),"{"!==(o=r[0])&&"["!==o&&g.error(r),i):this.next.success(t,e,n):this.next.error(n,e,"")},n.prototype.error=function(t,e,n){return"abort"!==e&&g.error(g.DEFAULT_ERROR),this.next.error(t,e,n)},n}(T),I=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.success=function(t,e,n){var r;if(!this.options().skipErrorHandling){if(!n.responseText.length)return this.next.error(n,e,"");if(0===n.responseText.indexOf(H))return r=n.responseText.substr(H.length),this.next.error(n,e,r)}return this.next.success(t,e,n)},n}(T),Q=function(e){function r(){return this._clear_working_msg=n(this._clear_working_msg,this),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.request=function(t){return this.xhr=t,setTimeout(function(t){return function(){return t._request_finished()?void 0:t._should_show_working_msg()?(t._show_working_msg(),t.xhr.done(t._clear_working_msg)):void 0}}(this),4e3),this.next.request(this.xhr)},r.prototype._request_finished=function(){return 4===this.xhr.readyState},r.prototype._should_show_working_msg=function(){return g.isShown()&&g.current()!==a.undo_notification},r.prototype._show_working_msg=function(){return this.notification=g.success(st("Still working..."))},r.prototype._clear_working_msg=function(){return g.isShown()&&this.notification===g.current()?g.clear():void 0},r}(T),M=function(r){function o(){return this._watch=n(this._watch,this),o.__super__.constructor.apply(this,arguments)}return t(o,r),o.prototype.data=function(){var t,n;return this.job_id=o.generate_job_id(),t=this.next.data(),this.uid=t[_.UID_PARAM_NAME],n=this.options().subject_user,!this.uid&&n&&(this.uid=String(n)),e.extend({job_id:this.job_id},t)},o.prototype.request=function(t){return this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval),this.next.request(t)},o.prototype.success=function(t,e,n){return this.next.success(t,e,n)},o.prototype.error=function(t,e,n){return this.next.error(t,e,n)},o.prototype.complete=function(t,e){return this._stop(),i.Job.handled(this.job_id),this.next.complete(t,e)},o.prototype._watch=function(){return i.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},o.prototype._stop=function(){return clearInterval(this._watch_id),i.ModalProgress.hide()},o.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,i.ModalProgress.show(this.options().progress_text))},o.prototype._fetch_progress=function(){var t;return t={},this.uid&&(t[_.UID_PARAM_NAME]=this.uid),x({url:"/job_status/"+this.job_id,data:t,success:function(t,e,n){var r;return r=0===n.responseText.indexOf("done")?"1/1":n.responseText,i.ModalProgress.update(r)},error:function(t){return function(e,n,r){return t._failures++,t._failures<3?void 0:(t._stop(),t.next.error(e,n,r))}}(this)})},o.generate_job_id=function(){var t,e,n;return t=new Date,n=t.getTime().toString(),e=Math.floor(1e6*Math.random()).toString(),e=("000000"+e).substring(e.length),n+e},o}(T),b=function(e){function r(){return this._watch=n(this._watch,this),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.data=function(){var t,e;return t=this.next.data(),this.uid=t[_.UID_PARAM_NAME],e=this.options().subject_user,!this.uid&&e&&(this.uid=String(e)),t},r.prototype.success=function(t,e,n){return this._is_async_job_response(n)?(this.job_id=n.responseText.split(":")[1],this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval)):this.next.success(t,e,n)},r.prototype.complete=function(t,e){return this._is_async_job_response(t)?void 0:this.next.complete(t,e)},r.prototype._is_async_job_response=function(t){var e,n;return 0!==(null!=(n=t.responseText)?n.indexOf(q):void 0)?!1:(e=t.responseText.split(":")[1],e.match(/^[A-Za-z0-9_\-=]*$/))},r.prototype._watch=function(){return i.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},r.prototype._stop=function(){return clearInterval(this._watch_id),i.ModalProgress.hide()},r.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,i.ModalProgress.show(this.options().progress_text))},r.prototype._fetch_progress=function(){var t;return t={},this.uid&&(t[_.UID_PARAM_NAME]=this.uid),x({url:"/async_task_status/"+this.job_id,data:t,success:function(t){return function(e,n,r){var o,s,a;return a=r.responseText,0===a.indexOf(F)?(i.Job.handled(t.job_id),t._stop(),a=a.substr(F.length),r.responseText=a,t.next.success(a,n,r),t.next.complete(r,n)):0===a.indexOf(H)?(i.Job.handled(t.job_id),t._stop(),o=a.substr(H.length),g.error(o),t.next.error(r,n,o),t.next.complete(r,n)):0===a.indexOf(j)?(i.Job.handled(t.job_id),t._stop(),s=a.substr(j.length),g.error(new f(s)),t.next.complete(r,n)):i.ModalProgress.update(a)}}(this),error:function(t){return function(e,n,r){return t._failures++,t._failures<3?void 0:(t._stop(),t.next.error(e,n,r),t.next.complete(e,n))}}(this)})},r}(T),U=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.data=function(){var t,n;return t=h.get_uri().getQuery()[P],!(null!=(n=this.next.data())?n.oref:void 0)&&t?e.extend({oref:t},this.next.data()):this.next.data()},r}(T),R=function(r){function o(){this.browser_unload_handler=n(this.browser_unload_handler,this),o.__super__.constructor.apply(this,arguments),this.is_browser_unloading=!1}return t(o,r),o.prototype.browser_unload_handler=function(){this.is_browser_unloading=!0},o.prototype.request=function(){var t;return e(window).on("beforeunload",this.browser_unload_handler),(t=this.next).request.apply(t,arguments)},o.prototype.error=function(t,e,n){var r,o,i;return r=0===t.status&&0===t.readyState&&"error"===e&&!n,o=r&&this.is_browser_unloading,o?this.next.error(t,"abort","unload"):(i=this.next).error.apply(i,arguments)},o.prototype.complete=function(){var t;return e(window).off("beforeunload",this.browser_unload_handler),(t=this.next).complete.apply(t,arguments)},o}(T),it=[R],w=[z,k,S,W],y=function(t){return null==t&&(t={}),B(t,[].concat(it,w))},D=[Q],C=[A,L,G],$=[b],tt=[].concat(it,D,Y,C,w,$),rt=function(t){return null==t&&(t={}),B(t,tt)},ot=function(t){return null==t&&(t={}),B(t,[].concat(U,tt))},O=[].concat(it,D,I,C,w,$),N=function(t){return null==t&&(t={}),B(t,O)},et=[].concat(it,D,Y,C,w,M,$),nt=function(t){return null==t&&(t={}),B(t,et)},x=function(t){return null==t&&(t={}),B(t,[].concat(it,C,w))},J=[z,k,W],K=[].concat(it,C,J),X=function(t){return null==t&&(t={}),B(t,K)},V=function(t){return null==t&&(t={}),B(t,[].concat(U,K))},Z=function(t){var n,r,o;return null==t&&(t={}),n=new E(t),r=at(n,w),o=e.ajax({url:r.url(),type:"OPTIONS",noDropboxDefaults:!0,data:r.data(),success:function(t,e,n){return r.success(t,e,n)},error:function(t,e,n){return r.error(t,e,n)},complete:function(t,e){return r.complete(t,e)}}),r.request(o)},ut={Request:B,AuthenticatedRequest:y,BackgroundRequest:x,SilentBackgroundRequest:X,SilentBackgroundRequestOref:V,WebRequest:rt,WebRequestOref:ot,FormWebRequest:N,WebProgressRequest:nt,ValidationSchemaRequest:Z}})}).call(this),function(){define("modules/clean/analytics",["jquery","modules/clean/viewer","modules/clean/ajax","modules/clean/web_timing_logger"],function(t,e,n,r){var o,i,s,a,u,l,c,_,h,d,p,f,m,g,v,w,b,y,x,E,S,k,R,T;return T=function(t){var n,r,o;return o=e.get_viewer(),n=t?[t]:function(){var t,e,n,i;for(n=o.get_users(),i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(r.id);return i}()},o={log:function(t,e){var r,o,i,s,a;for(i=0,s=0,a=t.length;a>s;s++)r=t[s],r.dir&&i++;return o=t.length-i,n.AuthenticatedRequest({url:"/browse_actions_context_menu_logger",data:{file_count:o,folder_count:i,action:e}})}},b={log:function(t,e){var o;return!this.hasLoggedTimeToFirstAction&&r.start_time()?(this.hasLoggedTimeToFirstAction=!0,o=Date.now()-r.start_time(),n.AuthenticatedRequest({url:"/log/time_to_first_action",subject_user:t,data:{latency:o,action_type:e}})):void 0}},y={log:function(t,e){return n.AuthenticatedRequest({url:"/log/ux_analytics",data:{event_type:t,extra_params:JSON.stringify(e)}})}},_={log:function(t,e){return n.AuthenticatedRequest({url:"/log/pro_events",data:{event:t,extra:JSON.stringify(e)}})}},s={start_time:0,start:function(t){return null==t&&(t=null),this.start_time=t||Date.now()},stop:function(t){return this.start_time?(t.extra.time_taken=Date.now()-this.start_time,this.log(t),this.start_time=0):void 0},log:function(t){return n.AuthenticatedRequest({url:"/log/file_view",data:{viewing_user_ids:JSON.stringify(T(t.user_id)),target:t.target,platform:t.platform,origin:t.origin||null,action:t.action||null,ns_id:t.ns_id,sjid:t.sjid,ns_path:t.ns_path,shared_link_url:t.shared_link_url||null,extra:JSON.stringify(t.extra)}})}},a={log:function(t,e,r,o,i,s){return null==s&&(s={}),n.AuthenticatedRequest({url:"/linkfile_activity_log",data:{event_name:t,file_ext:e,link_domain:r,success:o,source:i,extra:JSON.stringify(s)}})}},l={start_times:{},start:function(t,e){return null==e&&(e=null),this.start_times[t]=e||Date.now()},stop:function(t,e){return null!=this.start_times[t]?(e.total_time=Date.now()-this.start_times[t],this.log(t,e),delete this.start_times[t]):void 0},log:function(t,e){return null==e&&(e={}),n.AuthenticatedRequest({url:"/preview_activity_log",data:{event_name:t,input_method:e.input_method,file_ext:e.file_ext,extra:e.extra}})}},c={log:function(t,e,r,o,i,s,a){return n.AuthenticatedRequest({url:"/preview_quality_popup_logger",subject_user:e,data:{event_name:t,file_nsid:r,file_sjid:o,extension:i,doc_preview_status:s,feedback_text:a}})}},h={create_completion_log_dict:function(t,e,n,r,o,i,s,a){return null==t&&(t=null),null==e&&(e=null),null==n&&(n=null),null==r&&(r=null),null==o&&(o=null),null==i&&(i=null),null==s&&(s=null),null==a&&(a=null),null!=t?(null!=e&&(t.request_id=e),null!=n&&(t.latency=(new Date).getTime()-n),null!=r&&(t.query_string=r),null!=o&&(t.displayed=o),null!=i&&(t.result_count=i),null!=s&&200!==s&&(t.failure_type=s),null!=a&&(t.file_nsid=a.ns_id,t.file_sjid=a.sjid),t):void 0},log:function(t,e,r){return null==r&&(r={}),n.AuthenticatedRequest({url:"/searchclientlogger",subject_user:e,data:{event_name:t,action_type:r.action_type,displayed:r.displayed,failure_type:r.failure_type,file_nsid:r.file_nsid,file_sjid:r.file_sjid,firefly:r.firefly,infinite_scroll:r.infinite_scroll,latency:r.latency,match_type:r.match_type,path_scoped:r.path_scoped,position:r.position,query_string:r.query_string,request_id:r.request_id,result_count:r.result_count,search_type:r.search_type,viewport:r.viewport}})}},p={flow_id:null,log:function(t,e,r,o,i){var s;return null==r&&(r=null),null==o&&(o={}),null==i&&(i=!1),(i||null===this.flow_id)&&(s=new Date,this.flow_id=s.getTime().toString()+Math.random().toString(),this.flow_id=this.flow_id.replace(".","")),n.AuthenticatedRequest({url:"/sflogger",data:{platform:t,event_name:e,extra:JSON.stringify(o),active_uid:null!=r?r.id:null,flow_id:this.flow_id}})}},d={log:function(t,e,r,o){return null==o&&(o={}),n.AuthenticatedRequest({url:"/share_tib_log",data:{_subject_uid:t,event:e,origin:r,extra:JSON.stringify(o)}})}},f={TARGET_ITEMS:{FOLDER_IS_SF:"folder-is-sf",FOLDER_CAN_SF:"folder-can-sf",FOLDER_NO_SF:"folder-no-sf",FILE:"file"},log:function(t,e,r){return new n.AuthenticatedRequest({url:"/shmuilog",data:{evt:t,origin:e,target_item:r}})},log_with_target_file:function(t,e,n){return this.log(t,e,this.get_target_item(n))},get_target_item:function(t){var e;return e=f.TARGET_ITEMS,t.dir?t.is_shared_folder()?e.FOLDER_IS_SF:t.could_be_shared_folder()?e.FOLDER_CAN_SF:e.FOLDER_NO_SF:e.FILE}},g={log:function(t,e,r){return n.AuthenticatedRequest({url:"/studentpromologger",data:{event_name:t,extra:JSON.stringify(e)},success:r?r:void 0,error:r?r:void 0})}},w={LOG_CATEGORY:{PROMO_TEAMS:"promo_teams",TEAM_INFO:"team_info",UPGRADE:"upgrade_to_dfb",USAGE_INFO:"usage_info"},log:function(t,e,r,o,i,s){var a;return null==o&&(o=null),null==i&&(i=!1),a=T(o),n.AuthenticatedRequest({url:"/teamswalogger",data:{event_name:t,extra:JSON.stringify(e),for_uids:JSON.stringify(a),log_category:s,restricted:i?"1":void 0},success:r?r:void 0,error:r?r:void 0})},registerToLogClickEvent:function(e,n,r){return t(e).click(function(t){return function(){return t.log(n,null,null,null,!1,r)}}(this))}},u={log:function(t,e,r){return n.AuthenticatedRequest({url:"/notes_wa_logger",data:{event_name:t,extra:JSON.stringify(e)},success:r?r:void 0,error:r?r:void 0})}},x={start_times:{},start:function(t,e,n){return null==n&&(n=null),this.start_times[e]=n||Date.now()},stop:function(t,e,n,r){return null==r&&(r=null),null!=this.start_times[e]?(n.total_time=Date.now()-this.start_times[e],this.log(t,e,n,r),delete this.start_times[e]):void 0},log:function(t,e,r,o){var i;return null==o&&(o=null),r=r||{},i=T(o),n.AuthenticatedRequest({url:"/ualogger",data:{platform:t,event_name:e,extra:JSON.stringify(r),for_uids:JSON.stringify(i)}})}},E={log:function(t,e,r,o){return n.AuthenticatedRequest({url:"/virallogger",data:{user_ids:JSON.stringify(t),viral_type:e,action:r,extra:JSON.stringify(o||{})}})}},m={log:function(t,e,r,o){var i;return null==r&&(r=null),null==o&&(o=null),i={active_uid:t,simple_sharing_action:e},null!==r&&(i.editable=r),null!==o&&(i.user_type=o),n.AuthenticatedRequest({url:"/simplesharinglogger",data:i})}},k={log:function(t,e,r){var o;return null==r&&(r=null),o=T(r),n.AuthenticatedRequest({url:"/misclogger",data:{event_name:t,extra:JSON.stringify(e),for_uids:JSON.stringify(o)}})}},v={_log:function(t,e){return null==e&&(e={}),n.AuthenticatedRequest({url:"/support_experiments_log",data:{event_name:t,extra:JSON.stringify(e)}})},log_file_restore:function(t){return this._log("file_restore",{ref:t})}},i=i=function(){function t(){this.buffer=[]}return t.prototype.add_record=function(t){return t.deleted=!1,this.buffer.push(t)},t.prototype.flag_record_as_removed=function(t){var e,n,r,o;for(o=this.buffer,n=0,r=o.length;r>n;n++)if(e=o[n],e.contact_id===t&&!e.deleted)return void(e.deleted=!0)},t.prototype.log_records=function(t,e){return n.AuthenticatedRequest({url:"/contact_search_log",subject_user:t,data:{events:JSON.stringify(this.buffer),canceled:e}}),this.buffer=[]},t}(),S={VIEW:"view",SOCIAL_SHARE_VIEW:"social_share_view",SOCIAL_SHARE_FACEBOOK:"social_share_facebook",SOCIAL_SHARE_TWITTER:"social_share_twitter",SOCIAL_SHARE_GET_LINK:"social_share_get_link",SOCIAL_SHARE_SELECT_INLINE_LINK:"social_share_select_inline_link",LIKES_EXPERIMENT_VIEW:"likes_experiment_view",LIKES_EXPERIMENT_LOADED:"likes_experiment_loaded",LIKES_EXPERIMENT_MOUSED_OVER_LIKE:"likes_experiment_moused_over_like",LIKES_EXPERIMENT_CLICKED_LIKE:"likes_experiment_clicked_like",LIKES_EXPERIMENT_COMPLETED_LIKE:"likes_experiment_completed_like",LIKES_EXPERIMENT_CLICKED_UNLIKE:"likes_experiment_clicked_unlike",LIKES_EXPERIMENT_MOUSED_OVER_OTHERS:"likes_experiment_moused_over_others",log:function(t,e,r){var o;return null==r&&(r=null),o=T(r),n.AuthenticatedRequest({url:"/web_lightbox_log",data:{event_name:t,extra:JSON.stringify(e),for_uids:JSON.stringify(o)}})}},R={BrowseActionsContextMenuLogger:o,ContactSearchLogger:i,UXAnalyticsLogger:y,ProEventsLogger:_,FileViewLogger:s,LinkfileActivityLogger:a,PreviewQualityPopupLogger:c,PreviewActivityLogger:l,SearchClientActivityLogger:h,SharedFolderActivityLogger:p,ShareTibEventLogger:d,ShmodelUILogger:f,SupportExperimentsWebLogger:v,StudentPromoWebActionsLogger:g,TeamsWebActionsLogger:w,NotesWebActionsLogger:u,UserActivityLogger:x,ViralLogger:E,SimpleSharingLogger:m,WebLightboxLogger:S,WebMiscActivityLogger:k,TimeToFirstActionLogger:b},INLINE_JS.ShmodelUILogger=f,R})}.call(this),function(){define("modules/clean/base64",[],function(){var t,e,n,r;return r=function(t){var e,n,r,o,i,s;for(s=[],i=0,e=0,n=0,r=0,o=0,t+="";i<t.length;)n=t.charCodeAt(i),128>n?(s[e++]=String.fromCharCode(n),i++):n>191&&224>n?(r=t.charCodeAt(i+1),s[e++]=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),o=t.charCodeAt(i+2),s[e++]=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o),i+=3);return s.join("")},e=function(t){var e,n,r,o,i,s,a,u,l,c,_,h,d,p;if(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=void 0,_=void 0,h=void 0,i=void 0,s=void 0,a=void 0,u=void 0,r=void 0,l=0,e=0,o="",p=[],!t)return t;for(;c=t.charCodeAt(l++),_=t.charCodeAt(l++),h=t.charCodeAt(l++),r=c<<16|_<<8|h,i=r>>18&63,s=r>>12&63,a=r>>6&63,u=63&r,p[e++]=n.charAt(i)+n.charAt(s)+n.charAt(a)+n.charAt(u),l<t.length;);return o=p.join(""),d=t.length%3,(d?o.slice(0,d-3):o)+"===".slice(d||3)},t=function(t,e){var n,o,i,s,a,u,l,c,_,h,d,p,f,m,g;if(d=function(t){return t},a=e?d:r,"function"==typeof window.atob)return a(window.atob(t));if(o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,n=0,g=[],!t)return t;for(t+="";u=o.indexOf(t.charAt(h++)),l=o.indexOf(t.charAt(h++)),c=o.indexOf(t.charAt(h++)),_=o.indexOf(t.charAt(h++)),i=u<<18|l<<12|c<<6|_,p=i>>16&255,f=i>>8&255,m=255&i,g[n++]=64===c?String.fromCharCode(p):64===_?String.fromCharCode(p,f):String.fromCharCode(p,f,m),h<t.length;);return s=g.join(""),s=a(s)},n={encode:e,decode:t}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/captcha",["jquery","external/react","modules/clean/ajax","modules/clean/react/recaptcha_challenge","modules/core/notify"],function(e,n,r,o,i){var s;return s=function(){function s(e,n,r,o,i,s){var a;this.parent_form=e,this.captcha_div=n,this.other_recaptcha_div=r,this.endpoint=o,this.email_name=i,this.variant=s,this.captcha_display_handler=t(this.captcha_display_handler,this),this._hide_other_captcha=t(this._hide_other_captcha,this),this._hide_captcha=t(this._hide_captcha,this),this._show_captcha=t(this._show_captcha,this),this.$recaptcha_container=null!=(a=this.parent_form.find(this.captcha_div))?a[0]:void 0,this.$recaptcha_react_component=null}return s.prototype._show_captcha=function(t,e){var r,i;return null==(null!=(i=this.$recaptcha_container)?i.children:void 0)&&(this.$recaptcha_react_component=null),null==this.$recaptcha_react_component?(r=o({public_key:t,variant:this.variant,error:e}),this.$recaptcha_react_component=n.render(r,this.$recaptcha_container)):this.$recaptcha_react_component.reload(e)},s.prototype._hide_captcha=function(){var t;return null==(null!=(t=this.$recaptcha_container)?t.children:void 0)&&(this.$recaptcha_react_component=null),null!=this.$recaptcha_react_component?(n.unmountComponentAtNode(this.$recaptcha_container),this.$recaptcha_react_component=null):void 0},s.prototype._hide_other_captcha=function(){var t;return t=e(this.other_recaptcha_div)[0],null!=(null!=t?t.children:void 0)?n.unmountComponentAtNode(t):void 0},s.prototype.captcha_display_handler=function(t){return r.WebRequest({url:this.endpoint,data:{email:this.parent_form.find("input[name='"+this.email_name+"']").val()},success:function(e){return function(n){var r,o,s;try{return s=JSON.parse(n),s.needs_captcha?(e._hide_other_captcha(),e._show_captcha(s.recaptcha_public_key,t)):e._hide_captcha()}catch(t){return r=t,i.error(i.DEFAULT_ERROR)}}}(this)})},s}()})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/ajax_form",["jquery","modules/core/controller_helpers","modules/core/exception","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/validators/validators"],function(e,n,r,o,i,s,a){var u,l;return l=r.assert,u=function(){function r(e,r,o){this.$container=e,this.do_before_submitting=r,this._clear_pending=t(this._clear_pending,this),this._clear_errors=t(this._clear_errors,this),this._handle_errors=t(this._handle_errors,this),this._on_error=t(this._on_error,this),this._on_success=t(this._on_success,this),this._submit_form=t(this._submit_form,this),this._install_schema=t(this._install_schema,this),o=o||{},this.$form="FORM"===this.$container.prop("tagName")?this.$container:this.$container.find("form"),this.$form.submit(this._submit_form),this.$submit_button=this.$form.find("[type='submit']"),n.deprecated_set_controller(this.$form,this),this.schema={},this.should_validate=o.client_side_validation,this.should_submit_once=o.should_submit_once,this.error_handler="function"==typeof o.error_handler?o.error_handler:!1,this.should_validate&&this._fetch_schema()}return r.SUCCESS_EVENT="db:ajaxform:success",r.ERROR_EVENT="db:ajaxform:error",r.extract_errors=function(t){var e,n,r;if(0!==t.indexOf("err:"))return!1;t=t.substr(4);try{return r=JSON.parse(t)}catch(n){return e=n,"string"==typeof t?t:i.DEFAULT_ERROR}},r.clear_errors=function(t){return t.find(".input-error").removeClass("input-error"),t.find(".error-message").remove()},r.fill_errors=function(t,n){var r,o,i,s;t.find(".c-card").addClass("u-l-dn"),i=[];for(o in n)s=n[o],r=e("<span>",{class:"error-message"}),s.message_html?r.html(s.message_html):r.text(s.message_text),r.insertBefore(t.find("[data-error-field-name='"+o+"']")),t.find("input[name='"+o+"'], input[data-encrypted-name='"+o+"']").addClass("input-error"),i.push("failed-login-invalid-email-password"===o?t.find(".c-card").removeClass("u-l-dn"):void 0);return i},r.prototype._install_schema=function(t){var n,r,o;try{o=JSON.parse(t)}catch(t){n=t}return e.each(o,function(t){return function(e,n){return n?t.schema[e]=a.create(n):void 0}}(this))},r.prototype._fetch_schema=function(){return s.ValidationSchemaRequest({url:this.$form.attr("action"),success:function(t){return function(e){return t._install_schema(e)}}(this)})},r.prototype.reset=function(){var t,n,r,o,i;for(o=this.$form.find("input"),i=[],t=0,r=o.length;r>t;t++)n=o[t],i.push(e(n).closest(".text-input").val(n.defaultValue));return i},r.prototype.set_input_value=function(t,e){return this.$form.find("input[name='"+t+"']").closest(".text-input").val(e)},r.prototype._get_form_data=function(){var t,n,r,o,i,s,a,u,c,_,h;for(t={},c=this.$form.find("input, select, textarea").not(":disabled").not(":radio"),n=0,s=c.length;s>n;n++)r=c[n],u=e(r).attr("name"),u&&(o=e(r).attr("type"),h="checkbox"===o?e(r).prop("checked")?"True":"":e(r).val(),"radio"!==o&&l(!(u in t),"found multiple inputs with the same name"),t[u]=h);for(_=this.$form.find("input:radio:checked:not(disabled)"),i=0,a=_.length;a>i;i++)r=_[i],u=e(r).attr("name"),t[u]=e(r).val();return t},r.prototype._validate=function(t){var n,r;return this.should_validate?(n={},r=!0,e.each(t,function(e){return function(o,i){var s,a;if(e.schema[o])try{return e.schema[o].validate(i,{field:o,data:t,errors:n})}catch(t){return s=t,r=!1,n[o]={message_text:s.message}}}}(this)),r?null:n):null},r.prototype._submit_form=function(t){var e;return t.preventDefault(),"function"==typeof this.do_before_submitting&&this.do_before_submitting(),this._clear_errors(),this.$form.prop("disabled",!0),this.$form.addClass("ajax-loading"),this.$submit_button.prop("disabled",!0),e=this._validate(this._get_form_data()),e?this._handle_errors(e):this.send_request()},r.prototype.send_request=function(){return s.FormWebRequest({url:this.$form.attr("action"),data:this._get_form_data(),success:this._on_success,error:this._on_error,complete:this._on_complete,skipErrorHandling:!0})},r.prototype._on_success=function(t,e,n){var o,i,s,a,u;if(u=n.responseText,s=r.extract_errors(u),s!==!1)return void this._handle_errors(s);try{a=JSON.parse(u)}catch(t){return o=t,void this._on_error()}return this.$form.trigger(r.SUCCESS_EVENT,a),this._clear_pending(!this.should_submit_once)},r.prototype._on_error=function(){return this.$form.trigger(r.ERROR_EVENT),i.error(),this._clear_pending(!0)},r.prototype._handle_errors=function(t){if(this.error_handler)this.error_handler(t);else{if("string"==typeof t)return i.error(new o(t)),void this._clear_pending(!0);r.fill_errors(this.$form,t)}return this._clear_pending(!0),this.$form.trigger(r.ERROR_EVENT,t)},r.prototype._clear_errors=function(){return this.$form.find(".error-message").remove(),this.$form.find("input").removeClass("input-error")},r.prototype._clear_pending=function(t){return this.$form.removeClass("ajax-loading"),t?(this.$form.prop("disabled",!1),this.$submit_button.prop("disabled",!1)):void 0},r}()})}.call(this),function(){define("modules/clean/components/animation",["jquery"],function(t){var e;return e=function(){function e(e){this.id=e.id,this.animationQueue=e.animationQueue,this.$el=t("#"+this.id),this.$strip=this.$el.find(".animator-strip"),this.implementationWidth=null,this.imageLoadCount=0,this.animationQueue=function(){return t.grep(arguments[0],function(t){return""!==t&&null!==t})}(this.animationQueue),this.imagesInit(),this.$strip.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd OAnimationEnd animationend",this.onAnimationEnd)}var n;return e.prototype.onAnimationEnd=function(){return n(),t(this).removeClass("intro-animation").addClass("loop-animation"),!0},n=function(){var e,n,r;return e=t(".animator-poster").width(),n=t(".animator-frame--intro").width(),r=n-e,t(".animator-frame--intro").css("transform","translateX(-"+r+"px)")},e.prototype.setAnimationLoadClass=function(){var t;return this.imageLoadCount++,t="loop-animation",2===this.animationQueue.length&&(t="intro-animation"),this.imageLoadCount===this.animationQueue.length?this.$strip.addClass("loaded "+t):void 0},e.prototype.rescale=function(){var t,e;return this.implementationWidth||(this.implementationWidth=parseInt(this.$el.data("implementation-width"))),t=this.$el.parent().innerWidth(),t<this.implementationWidth?(e=t/this.implementationWidth,this.$el.css({transform:"scale("+e+") translateY(-"+10*e+"%)","-webkit-transform":"scale("+e+") translateY(-"+10*e+"%)","transform-origin":"bottom left"})):void 0},e.prototype.imagesInit=function(){var e,n;return n=this,e=this.$strip,this.$el.data("scale-down")===!0&&(t(window).resize(function(){return n.rescale()}),n.rescale()),e.find("img").each(function(e,r){return t(r).data("src")&&(t(r).on("load",function(){return n.setAnimationLoadClass()}),t(r).attr("src",t(r).data("src")),t(r).prop("complete"))?n.setAnimationLoadClass():void 0})},e}()})}.call(this),function(){var t=function(t,e){return function(){
return t.apply(e,arguments)}};define("modules/clean/components/bubble_dropdown",["jquery","external/jquery_ui","external/underscore","modules/clean/keycode"],function(e,n,r,o){var i;return i=function(){function n(o,i,s,a,u,l,c){var _,h;this.$root=o,this.arrow_direction=i,this.show_on_hover=s,this.show_close_button=a,this.shown_by_default=u,this.top_adjustment=null!=l?l:0,this.tabindex=c,this._hide_bubble=t(this._hide_bubble,this),this._show_bubble=t(this._show_bubble,this),this._toggle_bubble=t(this._toggle_bubble,this),this._on_global_hover=t(this._on_global_hover,this),this._on_mouseout=t(this._on_mouseout,this),this._on_mouseover=t(this._on_mouseover,this),this._onDropdownKeydown=t(this._onDropdownKeydown,this),this._onTargetKeydown=t(this._onTargetKeydown,this),this._activateNonButton=t(this._activateNonButton,this),this.repositionDropdown=t(this.repositionDropdown,this),this.openDropdown=t(this.openDropdown,this),this.closeDropdown=t(this.closeDropdown,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$dropdown=this.$root.find(".bubble-dropdown"),this.$arrow_anchor=this.$root.find(".bubble-dropdown-arrow-anchor"),this.$arrow=this.$dropdown.find(".bubble-arrow"),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[this.arrow_direction],this.$target.on("keydown",this._onTargetKeydown),this.$dropdown.on("keydown",this._onDropdownKeydown),this.$target.attr("aria-expanded",!1),this.show_close_button?this.$root.find(".bubble-dropdown-x").on("click",this.closeDropdown):this.show_on_hover?(this.$target.on("mouseover",this._on_mouseover),this.$dropdown.on("mouseover",this._on_mouseover),this.$target.on("mouseout",this._on_mouseout),this.$dropdown.on("mouseout",this._on_mouseout),this.$target.attr("tabindex",0).on("focus",this._show_bubble),0===this.$dropdown.find(this._focus_selectors).length&&(_=r.uniqueId("bubble-dropdown-tooltip-"),this.$dropdown.attr({id:_,role:"tooltip"}),this.$target.attr("aria-describedby",_)),e(document).on(n.HOVER_SHOWN,this._on_global_hover)):(this.$target.click(this._toggle_bubble),h=0,this.tabindex&&(h=this.tabindex),"BUTTON"!==this.$target.get(0).tagName&&this.$target.attr({role:"button",tabindex:h}).on("keyup",this._activateNonButton),e("body").on("click",function(t){return function(n){var r;return e(n.target).is("select")?!0:(r=e(n.target).closest(t.$target).length||e(n.target).closest(t.$dropdown).length,r||t._hide_bubble(),!0)}}(this))),this.shown_by_default&&this.openDropdown()}return n.HOVER_SHOWN="bubble:hover:shown",n.prototype._dropdown_shown=!1,n.prototype._focus_selectors="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",n.prototype.closeDropdown=function(){return this._dropdown_shown?this._hide_bubble():void 0},n.prototype.openDropdown=function(){return this._dropdown_shown?void 0:this._show_bubble()},n.prototype.repositionDropdown=function(){return this._dropdown_shown?this._show_bubble():void 0},n.prototype._activateNonButton=function(t){var e;return(e=t.keyCode)===o.ENTER||e===o.SPACE?(this._toggle_bubble(),!1):void 0},n.prototype._onTargetKeydown=function(t){return(t.keyCode===o.ESC&&!this.show_on_hover||t.keyCode===o.TAB&&t.shiftKey||t.keyCode===o.TAB&&1===this.$root.find(this._focus_selectors).length)&&this._hide_bubble(),!0},n.prototype._onDropdownKeydown=function(t){var e;return this.show_on_hover||t.keyCode!==o.ESC?t.keyCode!==o.TAB||t.shiftKey||(e=this.$root.find(this._focus_selectors),t.target===e[e.length-1]&&this._hide_bubble(!this.show_on_hover)):this._hide_bubble(!0),!0},n.prototype._on_mouseover=function(){return e(document).trigger(n.HOVER_SHOWN,this.$target),this._show_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))},n.prototype._on_mouseout=function(){var t;return t=setTimeout(this._hide_bubble,200),this.$dropdown.data("timeout_id",t)},n.prototype._on_global_hover=function(t,e){return this._dropdown_shown&&e!==this.$target?(this._hide_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))):void 0},n.prototype._toggle_bubble=function(){return this._dropdown_shown?this._hide_bubble():this._show_bubble(),!0},n.prototype._show_bubble=function(){var t,e,n,r,o,i;if(!this.$target.hasClass("disabled")){switch("right"===this.arrow_direction?this.$dropdown.css("display","block"):this.$dropdown.css("display","inline-block"),i=this.$arrow.outerWidth(),e=this.$arrow.outerHeight()-this.top_adjustment,o=this.$arrow.position().top,n=this.$arrow.position().left,this.arrow_direction){case"left":t="left+"+i+"px top-"+o+"px";break;case"right":t="right-"+i+"px top-"+o+"px";break;case"top":t="left-"+n+"px top+"+e+"px";break;case"bottom":t="left-"+n+"px bottom-"+e+"px"}return r={my:t,at:this.target_position,of:this.$arrow_anchor.length?this.$arrow_anchor:this.$target,collision:"none"},this.$dropdown.position(r),this.$dropdown.position(r),this._dropdown_shown=!0,this.$target.addClass("bubble-dropdown-target--active").attr("aria-expanded",!0)}},n.prototype._hide_bubble=function(t){return this.$dropdown.hide(),this._dropdown_shown=!1,this.$target.removeClass("bubble-dropdown-target--active").attr("aria-expanded",!1),t?this.$target.focus():void 0},n}()})}.call(this),function(){define("modules/clean/components/expanding_section",["jquery","modules/clean/analytics"],function(t,e){var n;return n=function(){function n(e,n,r,o,i){this.$parent=t("#"+e),n&&(this.$scrollElement=t(""+n)),this.scrollElementOffset=r||0,this.expandingSectionAnalyticsId=o,this.defaultOffset=95,this.toggledState=!1,this.$toggleButton=i?t(i):this.$parent.find(".expanding-section__button"),this.closeButton=this.$parent.find(".expanding-section__button-close"),this._setupClickHandlers()}return n.prototype._setupClickHandlers=function(){var t,e;return t=function(t){return function(e){return e.preventDefault(),t._scrollToSection(),t._expandSection(),t.expandingSectionAnalyticsId&&t._logAnalyticsTracking(),!0}}(this),e=function(t){return function(e){return e.preventDefault(),t._expandSection(),!0}}(this),this.$toggleButton.on("click",t),this.closeButton.length>0&&this.closeButton.on("click",e),!0},n.prototype._scrollToSection=function(){var e;return e=this.$parent.offset().top-this.scrollElementOffset-this.defaultOffset,this.$scrollElement&&(e=this.$parent.find(this.$scrollElement).offset().top-this.scrollElementOffset+"px"),this.toggledState||t("html, body").animate({scrollTop:e}),e},n.prototype._expandSection=function(){var t;return t=0,this.toggledState?(t=0,this.toggledState=!1):(t=this.$parent.find(".expanding-section__content-container").outerHeight(!0),this.toggledState=!0),this.$parent.find(".expanding-section__content").css("max-height",t),this.$toggleButton.blur().toggleClass("button-toggled"),this},n.prototype._logAnalyticsTracking=function(){e.TeamsWebActionsLogger.log(this.expandingSectionAnalyticsId)},n}()})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;define("modules/clean/components/input",["jquery","modules/clean/components/tabbable","modules/core/i18n","modules/core/exception"],function(n,r,o,i){var s,a,u,l,c,_,h;return c=o._,h=i.assert,_=function(t){var e;return e=n.data(t,"input-element"),h(e.length,"TextInput element has no related input element please ensure it was setup correctly"),e},n.valHooks.textinput={get:function(t){return _(t).val()},set:function(t,e){return _(t).val(e).trigger("input")}},l=function(r){function o(e){var r,i;this.$text_input=e,this._on_change=t(this._on_change,this),this.persistent_label=this.$text_input.is(".label-above"),this.$input=this.$text_input.find(".text-input-input"),this.$text_input.data("input-element",this.$input),this.$label=this.$text_input.find("label"),this.$text_input.find(".error-message").length&&this.$input.addClass("input-error"),this.$text_input.each(function(t,e){return e.type="textinput"}),this.$text_input.focus(function(t){return function(){return setTimeout(function(){return t.$input.focus()},0)}}(this)),i="BODY"===(null!=(r=document.activeElement)?r.tagName:void 0),i&&n(".autofocus:visible").first().focus(),this._listen(),this._on_change(),o.__super__.constructor.call(this)}return e(o,r),o.prototype._listen=function(){return this.$input.on("keydown keyup paste input blur",function(t){return function(){return t._on_change()}}(this)),this.$input.on("blur",function(t){return function(e){return t.$text_input.trigger(e)}}(this)),this.$input.on("focus",function(t){return function(){return t.$input.removeClass("input-error")}}(this))},o.prototype._on_change=function(){return this.persistent_label?void 0:this.$label.toggle(!this.$input.val())},o}(r),a=function(t){function n(t){this.$text_input=t,this.$caps=this.$text_input.find(".password-caps-indicator"),this.$caps_lock=!1,this.$text_input.on("keypress",function(t){return function(e){var n,r,o,i,s;return i=/Mac/.test(navigator.platform),r=null!=(s=e.charCode)?s:e.keyCode,n=String.fromCharCode(r),n.toLowerCase()===n.toUpperCase()?o=void 0:n===n.toLowerCase()?o=e.shiftKey:n!==n.toUpperCase()||e.shiftKey&&i||(o=!e.shiftKey),null!=o&&(t.$caps_lock=o),t.$caps_lock?t.$caps.addClass("password-caps-indicator-activated"):t.$caps.removeClass("password-caps-indicator-activated")}}(this)),n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(l),u=function(r){function o(e){this.$text_input=e,this._on_change=t(this._on_change,this),this.$bubble_title=this.$text_input.find(".password-bubble-title"),this.$bubble_desc=this.$text_input.find(".password-bubble-desc"),this.$meter=this.$text_input.find(".password-input-meter"),this.$default_bubble_text=this.$bubble_desc.text(),this.$last_pwd="",require(["external/zxcvbn"]),o.__super__.constructor.call(this,this.$text_input)}return e(o,r),o.prototype._on_change=function(){var t,e,n,r,i;return e=this.$input.val(),this.$last_pwd!==e?(this.$last_pwd=e,"correcthorsebatterystaple"===e||"Tr0ub4dour&3"===e||"Tr0ub4dor&3"===e?(n=0,r=c("lol",{comment:"'lol'='laugh out loud'"}),this.$bubble_title.text(r),"correcthorsebatterystaple"===e?(t=c("Whoa there, don't take advice from a webcomic too literally ;)",{comment:"This text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(t)):(t=c("Guess again",{comment:"this text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(t))):(i=["",c("Weak"),c("So-so"),c("Good"),c("Great!")],n=this._score(e),r=i[n],this.$bubble_title.text(r),this.$bubble_desc.text(this.$default_bubble_text)),this.$meter.find(".password-input-dot").removeClass("password-input-dot-selected"),this.$meter.find(".password-input-dot").slice(4-n,4).addClass("password-input-dot-selected"),o.__super__._on_change.apply(this,arguments)):void 0},o.prototype._get_user_inputs=function(){var t,e,r,o,i;for(r=["dropbox"],i=this.$text_input.closest("form").find("input[type=text], input[type=email]"),e=0,o=i.length;o>e;e++)t=i[e],r.push(n(t).val());return r},o.prototype._score=function(t){return window.zxcvbn&&t?Math.max(1,zxcvbn(t,this._get_user_inputs()).score):0},o}(a),s=function(n){function r(e){this.$text_input=e,this.crement=t(this.crement,this),r.__super__.constructor.call(this,this.$text_input),this.$text_input.find(".number-input-btn--up").on("click",function(t){return function(e){return t.crement(e,1)}}(this)),this.$text_input.find(".number-input-btn--down").on("click",function(t){return function(e){return t.crement(e,-1)}}(this)),this.min=this.$input.attr("min"),null!=this.min&&(this.min=parseInt(this.min)),this.max=this.$input.attr("max"),null!=this.max&&(this.max=parseInt(this.max))}return e(r,n),r.prototype.crement=function(t,e){var n;return n=parseInt(this.$text_input.val())+e,isNaN(n)||this.$text_input.val(null!=this.min&&n<this.min?this.min:null!=this.max&&n>this.max?this.max:n),this.$text_input.trigger("change")},r}(l),{TextInput:l,PasswordInput:a,PasswordWatchInput:u,NumberInput:s}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/locale_selector",["jquery","modules/constants/request","modules/core/cookies","modules/core/dom"],function(e,n,r,o){var i;return i=function(){function i(n,r,o,i){var s;null==o&&(o=!1),null==i&&(i=!1),this._localeSelected=t(this._localeSelected,this),this._keydownHandler=t(this._keydownHandler,this),this._hideModal=t(this._hideModal,this),this._showModal=t(this._showModal,this),this._showInline=t(this._showInline,this),this.$document=e(document),this.$container=e(n),s=e(r),this.is_inline=o,this.action=i?"/team/admin/set_locale":"/set_locale",this.is_inline?(this.$locale_table=this.$container.find(".locale-selector__table"),s.on("click",this._showInline),this.$locale_links=this.$locale_table.find(".locale-option"),this.$locale_links.one("click",this._localeSelected)):(this.$modal_holder=this.$container.find("#db-modal-locale-selector-modal"),this.$db_modal_x=this.$modal_holder.find(".db-modal-x"),this.$db_modal_overlay=this.$modal_holder.find(".db-modal-overlay"),this.$modal=this.$modal_holder.find(".db-modal"),s.on("click",this._showModal),this.$locale_links=this.$modal.find(".locale-option"))}return i.prototype._showInline=function(t){return t.preventDefault(),this.$locale_table.show(),this.$container.find(".locale-link__link").addClass("active")},i.prototype._showModal=function(t){return t.preventDefault(),this.$db_modal_x.one("click",this._hideModal),this.$db_modal_overlay.one("click",this._hideModal),this.$document.one("keydown",this._keydownHandler),this.$modal_holder.show(),this.$locale_links.one("click",this._localeSelected),o.scroll_lock_document()},i.prototype._hideModal=function(t){return t.preventDefault(),this.$modal_holder.hide(),o.scroll_unlock_document()},i.prototype._keydownHandler=function(t){return 27===t.keyCode?this._hideModal(t):void 0},i.prototype._localeSelected=function(t){return this.is_inline||this._hideModal(t),e("<form/>",{action:this.action,method:"POST"}).append(this._hiddenField("locale",e(t.target).data("locale"))).append(this._hiddenField("locale_cont",window.location.pathname)).append(this._hiddenField("t",r.read(n.JS_CSRF_COOKIE))).appendTo("body").submit(),!1},i.prototype._hiddenField=function(t,n){return e("<input/>",{type:"hidden",name:t,value:n})},i}()})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/components/login_form",["jquery","external/cyfd","external/u2f-api","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/captcha","modules/clean/components/ajax_form","modules/clean/gandalf_util","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/sso_login_checks"],function(e,n,r,o,i,s,a,u,l,c,_,h,d,p,f){var m,g,v;return v=s._,g=p.ProfileServicesLinkingHandler,m=function(){function s(n,r,i,s){var a,l,h,d,p,m;this.multi_login=r,this.variant=i,null==s&&(s=!1),this._finish_login=t(this._finish_login,this),this._fill_two_factor_error=t(this._fill_two_factor_error,this),this._fill_login_error=t(this._fill_login_error,this),this._login_via_email_start=t(this._login_via_email_start,this),this._sign_u2f_challenge=t(this._sign_u2f_challenge,this),this._retry_u2f_challenge=t(this._retry_u2f_challenge,this),this._use_phone_instead=t(this._use_phone_instead,this),this._resend_code=t(this._resend_code,this),this._resend_code_success=t(this._resend_code_success,this),this._switch_from_twofactor_to_login_error=t(this._switch_from_twofactor_to_login_error,this),this._two_factor_success=t(this._two_factor_success,this),this._login_success=t(this._login_success,this),this._show_two_factor=t(this._show_two_factor,this),this._setup_two_factor=t(this._setup_two_factor,this),this._show_login_via_email=t(this._show_login_via_email,this),this._show_login=t(this._show_login,this),this._hide_sso=t(this._hide_sso,this),this._show_sso=t(this._show_sso,this),this._google_login=t(this._google_login,this),this._set_focus_to_twofactor=t(this._set_focus_to_twofactor,this),this._set_focus_to_password=t(this._set_focus_to_password,this),this.$login_form=n.find(".login-form"),this.$all_two_factor_forms=n.find(".two-factor-form"),this.$two_factor_phone_form=n.find(".two-factor-form.2fa-phone-form"),this.$two_factor_seckey_form=n.find(".two-factor-form.2fa-seckey-form"),this.$login_via_email_link=n.find(".login-via-email-link"),this.$two_factor_form=this.$two_factor_phone_form,null!=(l=this.$login_form.find(".login-button, .auth-google"))&&l.prop("disabled",!1),s||require(["modules/clean/unity/features/web_destiny_ui"],function(t){return function(e){return t.web_destiny_interface=new e(n),t.web_destiny_interface.maybe_show_web_destiny()}}(this)),this.login_controller=new _(this.$login_form,this._cyberfend_submit,{should_submit_once:!0}),this.$captcha_component=new c(this.$login_form,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant),this.$login_form.on(_.SUCCESS_EVENT,this._login_success),this.$login_form.on(_.ERROR_EVENT,function(t){return function(e,n){var r;return r=null!=n?n.recaptcha_response:void 0,t.$captcha_component.captcha_display_handler(r),t.$login_form.find(".login-via-email-blade-link").click(t._login_via_email_start)}}(this)),this.$login_form.is(":visible")&&this.$captcha_component.captcha_display_handler(),a=u.parse(this.$login_form.find("input[name='cont']").val()),a.fragment=window.location.hash.substr(1),this.cont=a.toString(),this.two_factor_phone_controller=new _(this.$two_factor_phone_form,function(){return null},{should_submit_once:!0}),this.two_factor_seckey_controller=new _(this.$two_factor_seckey_form,function(){return null},{should_submit_once:!0}),this.two_factor_controller=this.two_factor_phone_controller,this.$two_factor_phone_form.on(_.SUCCESS_EVENT,this._two_factor_success),this.$two_factor_seckey_form.on(_.SUCCESS_EVENT,this._two_factor_success),this.$two_factor_seckey_form.on(_.ERROR_EVENT,function(t){return function(e,n){return t.$two_factor_seckey_form.find(".two-factor-seckey-instructions .error-msg").text(n.u2f.message_text),t.$two_factor_seckey_form.find(".two-factor-seckey-instructions").toggle()}}(this)),this.$two_factor_phone_form.find(".resend-two-factor-code").click(this._resend_code),this.$two_factor_seckey_form.find(".two-factor-use-phone-instead").click(this._use_phone_instead),this.$two_factor_seckey_form.find(".two-factor-seckey-retry").click(this._retry_u2f_challenge),null!=(h=this.$login_via_email_link)&&h.click(this._login_via_email_start),null!=(d=this.$login_form.find(".auth-google"))&&d.click(this._google_login),m=this.$two_factor_seckey_form.find("input[name='u2f_challenge']").val(),m&&this._sign_u2f_challenge(m),this.$login_form.find(".sso-optout a").click(function(t){return function(){return t._hide_sso(!0)}}(this)),this.$login_form.find(".login-button").attr("disabled",!1),null!=(p=this.$login_via_email_button)&&p.attr("disabled",!1),this.$login_form.find(".login-button.disabled-button").prop("disabled",!0),this.$forgot_link=n.find(".login-need-help a").click(function(t){return function(n){var r,i;return n.preventDefault(),i=e(n.target).attr("href"),r=encodeURIComponent(t.$login_form.find("input[name='login_email']").val()),o.redirect(i+"?email_from_login="+r)}}(this)),this._set_focus_to_password(),new f(this.$login_form.find("input[name='login_email']"),this._show_sso,this._hide_sso)}return s.LOGIN_SUCCESS="db:login:success",s.MULTI_LOGIN_SUCCESS="db:multilogin:success",s.prototype._set_focus_to_password=function(){if(this.$login_form.find("input[name='login_email']")[0].value)try{return this.$login_form.find("input[name='login_password']")[0].focus()}catch(t){}},s.prototype._set_focus_to_twofactor=function(){try{return this.$two_factor_form.find("input[name='code']").val("").focus()}catch(t){}},s.prototype._google_login=function(){var t,e,n;return t=function(t){return function(e){return e.success?o.redirect(t.cont?t.cont:"/home"):a.error(v("access_denied"===e.err_msg?"You need to accept Googles request in order to log in.":"email_does_not_exist"===e.err_msg?"We couldnt find a Dropbox account linked to that email.":"too_many_users_for_email"===e.err_msg?"We found multiple Dropbox accounts linked to that email.":"We couldnt log you in to Google.  Try again?"))}}(this),n="on"===this.$login_form.find("input[name='remember_me']").val(),e=new g,e.auth_service_login_user(d.GOOGLE,t,"login_form",n)},s.prototype._cyberfend_submit=function(){return n.cfsubmit()},s.prototype._show_sso=function(t){return this.$login_form.find("input[name='login_password']").val(""),this.$login_form.addClass("sso-required"),t?this.$login_form.addClass("sso-optional"):void 0},s.prototype._hide_sso=function(t){if(null==t&&(t=!1),this.$login_form.removeClass("sso-required sso-optional"),t)try{return this.$login_form.find("input[name='login_password']").focus()}catch(t){}},s.prototype._browser_supports_u2f=function(){return"undefined"!=typeof MessageChannel},s.prototype._show_login=function(){return this.$two_factor_form.hide(),e(".login-register-header, .login-register-switch").show(),this.$login_form.show(),this.$login_form.find("input[name='login_password']").val("")},s.prototype._show_login_via_email=function(){var t;return null!=(t=this.$login_via_email_container)?t.show():void 0},s.prototype._setup_two_factor=function(t){return t.u2f_challenge&&this._browser_supports_u2f()&&(this.$two_factor_form=this.$two_factor_seckey_form,this.two_factor_controller=this.two_factor_seckey_controller,this._sign_u2f_challenge(t.u2f_challenge)),t.last_four_digits?(this.$all_two_factor_forms.addClass("hide-authenticator"),this.$two_factor_phone_form.find(".last-four-digits").text(t.last_four_digits)):this.$all_two_factor_forms.addClass("hide-sms"),this.$two_factor_form.find("input[name='remember_me']").val(t.remember_me),this._show_two_factor()},s.prototype._show_two_factor=function(){return e(".login-register-header, .login-register-switch").hide(),this.$login_form.hide(),this.$two_factor_form.show(),this._set_focus_to_twofactor()},s.prototype._login_success=function(t,e){var n,r,s;switch(e.status){case"OK":return this._finish_login(e);case"TWOFACTOR":return this._setup_two_factor(e);case"TWOFACTOR_REQUIRED":return o.redirect(e.cont);case"LOGIN_VIA_EMAIL_REQUIRED":return n=e.email,s=u({path:e.cont}).updateQuery({email:n}),o.redirect(s);case"SSO":return o.unsafeRedirect(e.sso_url);case"RATELIMIT":return this._fill_login_error(v("You've tried to log in too many times. Please try again in a few minutes."));case"ERROR":return r=e.html_response?new i(e.message):e.message,a.error(r),this.login_controller._clear_pending(!0);case"EXPIRED":return o.redirect(e.cont);default:return a.error()}},s.prototype._two_factor_success=function(t,e){switch(e.status){case"OK":return this.$two_factor_seckey_form.find(".seckey-loading-status").toggle(),this._finish_login(e);case"EXPIRED":return this._switch_from_twofactor_to_login_error(e.message);case"REQUIRES_ROLE":return this._switch_from_twofactor_to_login_error(e.message);case"ERROR":return a.error(e.message);default:return a.error()}},s.prototype._switch_from_twofactor_to_login_error=function(t){return this.two_factor_controller._clear_pending(!0),this.login_controller._clear_pending(!0),this._show_login(),this._fill_login_error(t),this._set_focus_to_password()},s.prototype._resend_code_success=function(t){switch(t){case"OK":return a.success(v("We sent you a code. It may take a few minutes to arrive."));case"RATELIMIT":return this._fill_two_factor_error(v("You've tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this._fill_two_factor_error(v("We couldn't reach your phone number. Are you sure it's correct?"));case"EXPIRED":return this._fill_two_factor_error(v("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this._fill_two_factor_error(v("Unfortunately, your carrier isnt supported at this time."));case"INVALIDNUMBER":return this._fill_two_factor_error(v("That isnt a valid phone number."));case"NOTAMOBILE":return this._fill_two_factor_error(v("That phone number doesnt appear to be a valid mobile number."));default:return a.error()}},s.prototype._resend_code=function(){var t;return l.WebRequest({url:"/twofactor_resend",data:{backup:(null!=(t=this.$two_factor_form.find("input[name='backup']"))?t.val():void 0)||!1},success:this._resend_code_success,error:function(){return a.error()}}),!1},s.prototype._use_phone_instead=function(){return this.$two_factor_seckey_form.hide(),this.$two_factor_phone_form.show(),this.$two_factor_form=this.$two_factor_phone_form,this.$two_factor_phone_form.hasClass("hide-authenticator")&&this._resend_code(),this._set_focus_to_twofactor(),!1},s.prototype._retry_u2f_challenge=function(){return l.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(t){return function(e){return t.$two_factor_seckey_form.find(".two-factor-seckey-instructions").toggle(),t._sign_u2f_challenge(e)}}(this),error:function(){return a.error()}}),!1},s.prototype._sign_u2f_challenge=function(t){var e;return this._browser_supports_u2f()?(e=JSON.parse(t),r.sign(e.authenticateRequests,function(t){return function(e){return t.$two_factor_seckey_form.find(".text-input-input").val(JSON.stringify(e)),t.$two_factor_seckey_form.submit()}}(this))):void 0},s.prototype._login_via_email_start=function(){return _.clear_errors(this.$login_form),l.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$login_form.find("input[name='login_email']").val(),remember_me:"on"===this.$login_form.find("input[name='remember_me']").val()},success:function(){return a.success(v("We emailed you a sign in link. Please check your inbox."))},error:function(t){return function(e,n,r){return _.fill_errors(t.$login_form,JSON.parse(r))}}(this)}),!1},s.prototype._fill_login_error=function(t){return _.fill_errors(this.$login_form,{login_email:{message_text:t}})},s.prototype._fill_two_factor_error=function(t){return _.fill_errors(this.$two_factor_form,{code:{message_text:t}})},s.prototype._finish_login=function(t){var e,n,r;return r=this.$login_form.find("input[type='hidden'][name=refresh_token]").val(),e=this.$login_form.find("input[type='hidden'][name=email_sig]").val(),r&&e&&l.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:t.id,data:{service:d.GOOGLE,refresh_token:r,email_sig:e}}),n=this.multi_login?s.MULTI_LOGIN_SUCCESS:s.LOGIN_SUCCESS,this.$login_form.trigger(n,t),this.cont?o.redirect(this.cont):void 0},s}(),__CONDITIONAL_JS__.LoginForm=m,m})}.call(this),function(){define("modules/clean/components/login_or_register",["jquery","modules/clean/register_form"],function(t,e){var n;return n=function(){function n(n){this.$login_form=n.find(".login-register-login-part"),this.$register_form=n.find(".login-register-register-part"),n.click(function(e){return function(n){return t(n.target).hasClass("login-register-switch-link")?(n.preventDefault(),e._toggle_forms(),e.$login_form.find(".text-input input:visible").first().focus(),e.$register_form.find(".text-input input:visible").first().focus()):void 0}}(this)),this.$register_form.on(e.USER_EXISTS,function(t){return function(e){var n,r,o;t._toggle_forms(),r=e.prefill;for(n in r)o=r[n],t.$login_form.find(n).val(o);return t.$login_form.find(e.focus).focus()}}(this))}return n.prototype._toggle_forms=function(){return this.$login_form.toggle(),this.$register_form.toggle()},n}()})}.call(this),function(){define("modules/clean/components/tabbable",["jquery"],function(t){var e;return e=function(){function e(){e.initialized||this.listen()}return e.initialized=!1,e.prototype.listen=function(){return e.initialized=!0,t(document).on("keydown",function(){return function(e){return 9===e.keyCode?t(document.body).addClass("tabbing"):void 0}}(this)),t(document).on("mousedown",function(){return function(){return t(document.body).removeClass("tabbing")}}(this))},e}()})}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;define("modules/clean/components/tooltip",["jquery","modules/core/controller_helpers"],function(e,n){var r,o,i;return i=[],r=function(){function t(t,e,r){var o;this.$wrapper=t,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=e,this.tooltip_location=r,this.listen(),o=n.clone_element(this.tooltip).appendTo("body"),o.css({position:"static",display:"inline-block"}),this.tooltip.css({width:o.width()+1,position:"absolute",display:"none"}),o.remove(),this.position_global&&this.tooltip.remove().appendTo("body")}return t.prototype.tooltip_shown=!1,t.prototype.position_global=!1,t.prototype.listen=function(){var t,e,n,r,o;for(r=[this.hover_target,this.tooltip],o=[],e=0,n=r.length;n>e;e++)t=r[e],t.mouseenter(function(t){return function(){return clearTimeout(t.tooltip.data("timeout_id")),t.show_tooltip()}}(this)),o.push(t.mouseleave(function(t){return function(){var e;return e=setTimeout(function(){return t.hide_tooltip()},200),t.tooltip.data("timeout_id",e)}}(this)));return o},t.prototype.find_hover_target=function(){return this.prompt},t.prototype.show_tooltip=function(){var t,e,n,r,o,s,a;if(!this.tooltip_shown){for(o=this.position_global?this.hover_target.offset():this.hover_target.position(),e=0,r=i.length;r>e;e++)a=i[e],a.hide_tooltip();return i.push(this),"top"===this.tooltip_location?(s=o.top-this.tooltip.outerHeight()-this.hover_target.height()/2,n=o.left-this.tooltip.outerWidth()/2,t={top:"-=7"}):(s=o.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,n=o.left+this.hover_target.width()+2,t={left:"+=7"}),this.tooltip.css({top:s,left:n}).show().animate(t,50),this.tooltip_shown=!0}},t.prototype.hide_tooltip=function(){var t;return this.tooltip_shown?(clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,t=i.indexOf(this),-1!==t?i.splice(t,1):void 0):void 0},t}(),o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},n}(r),{DBTooltip:r,InfoTooltip:o}})}.call(this),function(){define("modules/clean/css",["jquery","external/rsvp","modules/clean/static_urls","modules/constants/env","modules/core/exception","modules/core/uri"],function(t,e,n,r,o,i){var s,a,u,l,c,_,h,d,p,f;for(s=e.Promise,f=n.static_url,l=o.assert,u={},a={},p=t('link[rel="stylesheet"]'),c=0,_=p.length;_>c;c++)h=p[c],d=i.parse(t(h).attr("href")).path,r.IS_PROD||(d=d.replace(/-vfl[\w-]*/,"")),u[d]=s.resolve(),a[d]=!0;return{css_url:function(t){return'url("'+String(t).replace("\\","\\\\").replace('"','\\"')+'")'},require_css:function(t,e,n){var r;return l(0===t.indexOf("/static/css/"),"invalid static css path: "+t),r=u[t],r||(r=u[t]=new s(function(e,n){var r;return r=document.createElement("link"),r.href=f(t),r.rel="stylesheet",r.type="text/css",r.crossorigin="anonymous",r.onload=function(){return a[t]=!0,e()},r.onerror=n,document.head.appendChild(r)})),r.then(e,n)},require_css_multi:function(t,e,n){var r;return r=t.map(function(t){return function(e){return t.require_css(e)}}(this)),s.all(r).then(e,n)},is_loaded:function(t){return t.every(function(t){return l(0===t.indexOf("/static/css/"),"invalid static css path: "+t),t in a})}}})}.call(this),function(){define("modules/clean/datetime",["modules/core/exception","modules/core/i18n"],function(t,e){
var n,r,o,i,s,a,u,l,c,_,h,d,p,f,m,g,v,w,b,y,x,E;return _=t.assert,u=e._,E=e.ungettext,i=1e3,o=60*i,r=60*o,n=24*r,s=7*n,a=365*n,b=[u("January"),u("February"),u("March"),u("April"),u("May"),u("June"),u("July"),u("August"),u("September"),u("October"),u("November"),u("December")],l=[u("Jan"),u("Feb"),u("Mar"),u("Apr"),u("May"),u("Jun"),u("Jul"),u("Aug"),u("Sep"),u("Oct"),u("Nov"),u("Dec")],w=function(t,e){return e?l[t]:b[t]},p=function(t,e){var n;return n=[u("AM"),u("PM")],e.replace(/'[^']*'|y+|M+|d+|h+|k+|K+|H+|m+|s+|S+|a+/g,function(e){var r;switch(e[0]){case"'":return 2===e.length?"'":e.slice(1,-1);case"y":if("yy"===e)return t.getYear()%100;r=t.getFullYear();break;case"M":if(e.length>=3)return w(t.getMonth(),3===e.length);r=t.getMonth()+1;break;case"d":r=t.getDate();break;case"h":r=t.getHours()%12||12;break;case"k":r=t.getHours()%12+1;break;case"K":r=t.getHours()%12;break;case"H":r=t.getHours();break;case"m":r=t.getMinutes();break;case"s":r=t.getSeconds();break;case"S":r=t.getMilliseconds();break;case"a":return n[1*(t.getHours()>=12)]}return r=""+r,r.length<e.length&&(r=("00000000"+r).slice(-1*e.length)),r})},f=function(t){var e,n,r,o,i,s,a;for(s=[86400,3600,60,1],t=isNaN(t)?0:t,e=n=0,r=s.length;r>n;e=++n)if(i=s[e],t>=i){a=parseInt(t/i,10)||0;break}return 1>t&&(a=0),e>=3?o=E("%d sec","%d secs",a).format(a):2===e?o=E("%d min","%d mins",a).format(a):1===e?o=E("%d hour","%d hours",a).format(a):0===e?o=E("%d day","%d days",a).format(a):_(!1,"Invalid time"),o},d=function(t){var e,n,r;return n=Math.floor(t),0>n&&(n=0),e=function(t){return 10>t?"0"+t:t.toString()},r=":"+e(n%60),n=Math.floor(n/60),r=e(n%60)+r,n=Math.floor(n/60),n>0&&(r=""+n.toString()+":"+r),r},v=function(t,e){return u("%(month)s %(year)s",{comment:"Like Jun 2012"}).format({month:w(t,!0),year:e})},y=function(t,e,n,r){var o,i,s,a;return null==n&&(n=!1),null==r&&(r=!1),n?(o=t.getUTCDate(),i=t.getUTCMonth(),a=t.getUTCFullYear()):(o=t.getDate(),i=t.getMonth(),a=t.getFullYear()),s=w(i,!r),e?u("%(month)s %(date)s, %(year)s",{comment:"Like Jan 15, 2014"}).format({month:s,date:o,year:a}):u("%(month)s %(date)s",{comment:"Like Jan 15"}).format({month:s,date:o})},c=function(t){var e,i,l,c,_,h,d;return i=Date.now()-Number(t),o>i?u("Just now"):r>i?(c=Math.floor(i/o),E("%d min ago","%d mins ago",c).format(c)):n>i?(l=Math.floor(i/r),E("%d hour ago","%d hours ago",l).format(l)):30*n>i?(e=Math.floor(i/n),E("%d day ago","%d days ago",e).format(e)):56*n>i?(h=Math.floor(i/s),E("%d week ago","%d weeks ago",h).format(h)):a>i?(_=Math.floor(i/(30*n)),_=Math.max(2,_),_=Math.min(11,_),E("%d month ago","%d months ago",_).format(_)):(d=Math.floor(i/a),E("%d year ago","%d years ago",d).format(d))},m=function(t){var e,n,r,i,s,a;return r=Date.now(),n=r-Number(t),e=new Date(t),r=new Date(r),s=new Date(r.getFullYear(),r.getMonth(),r.getDate()),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()-1),i=p(e,"h:mm a"),o>n?u("just now",{comment:"Like 'You edited just now'"}):t>Number(s)?u("today at %(time)s",{comment:"Like 'You edited today at 3:00 PM'"}).format({time:i}):t>Number(a)?u("yesterday at %(time)s",{comment:"Like 'You edited yesterday at 3:00 PM'"}).format({time:i}):(e=e.getFullYear()===r.getFullYear()?y(e,!1,!1,!0):y(e,!0,!1,!0),u("on %(date)s",{comment:"Like 'You edited on August 20, 2015"}).format({date:e}))},g=function(t,e,n,r,o,i){return null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),null==o&&(o=0),null==i&&(i=0),t.setFullYear(t.getFullYear()+e),t.setMonth(t.getMonth()+n),t.setDate(t.getDate()+r),t.setHours(t.getHours()+o),t.setMinutes(t.getMinutes()+i),t},x=function(){return(new Date).getTime()},h={abbr_month_names:l,ago:c,format_date:p,format_time:f,formatAudioTime:d,getActingTime:m,increment_date:g,month_abbr_with_year:v,month_name:w,month_names:b,nice_date_with_month_name:y,time:x}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};define("modules/clean/dbmodal",["jquery","external/jquery_ui","external/keymaster","modules/core/browser","modules/core/controller_helpers","modules/core/dom","modules/core/exception","modules/clean/viewer","modules/constants/viewer"],function(r,o,i,s,a,u,l,c,_){var h,d,p,f;return f=l.assert,d=function(){function t(){}return t.__stack=[],t.CLEAR="dbmodal:clear",t.pop=function(e){var n;return null==e&&(e=null),null!=e?t.remove(e):e=t.__stack.pop(),null!=e&&e._hide(),n=t.top(),null!=n?n._show():r(document).trigger(t.CLEAR)},t.push=function(e){var n;return f(e instanceof h,"must pass in valid DBModal"),t.remove(e),n=t.top(),(null!=n?n.visible:void 0)&&n._hide(),t.__stack.push(e),e._show()},t.top=function(){var e;return e=t.__stack.length,e?t.__stack[e-1]:null},t.remove=function(e){var n,r,o,i,s;for(i=[],s=t.__stack,n=0,r=s.length;r>n;n++)o=s[n],o!==e&&i.push(o);t.__stack=i},t.clear=function(){var e,n,o,i;for(e=n=i=t.__stack.length-1;n>=0;e=n+=-1)o=t.__stack[e],o.visible&&o._hide();return r(document).trigger(t.CLEAR),t.__stack=[]},t.register=function(e,n){return r(document).on(e,n),r(document).on(t.CLEAR,function(){return r(document).off(e,n)})},t.unregister=function(t,e){return r(document).off(t,e)},t.trigger=function(t,e){return r(document).trigger(t,e)},t}(),h=function(){function n(e){var r;this.options=e,this.set_title=t(this.set_title,this),this._hide=t(this._hide,this),this._show=t(this._show,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.__prefill=t(this.__prefill,this),this.__focus=t(this.__focus,this),this.__unlisten=t(this.__unlisten,this),this.__listen_buttons=t(this.__listen_buttons,this),this.__listen=t(this.__listen,this),this.__overlay_click_handler=t(this.__overlay_click_handler,this),this.__keydown_handler=t(this.__keydown_handler,this),this.__tabbable_elements=t(this.__tabbable_elements,this),this.__x_click_handler=t(this.__x_click_handler,this),this.__show_modal=t(this.__show_modal,this),this.__clone_modal=t(this.__clone_modal,this),this.format=t(this.format,this),this.on_cancel_button_click=t(this.on_cancel_button_click,this),this.on_confirm_button_click=t(this.on_confirm_button_click,this),this.before_show=t(this.before_show,this),this.element_id=n.add_role_to_id(this.options.element_id,this.options.role),this.$template=n.get_template(this.options.element_id),r=this.$template.find(".db-modal"),0===this.$template.length&&(window.DB_FRAME_BUST?f(!1,"Missing DBModal element '"+this.element_id+"', probably because this page is being framed by "+window.top.location.host+" and our frame protection has kicked in."):f(!1,"Missing DBModal pyxl element for '"+this.element_id+"'")),this.options.focus&&("confirm"===this.options.focus?f(r.find(".confirm-button").length,"DBModal pyxl element is missing a confirm button to focus"):"cancel"===this.options.focus?f(r.find(".cancel-button").length,"DBModal pyxl element is missing a cancel button to focus"):f(r.find(this.options.focus).length,"DBModal pyxl element is missing focus element with selector '"+this.options.focus+"'")),null!=this.on_show&&f("function"==typeof this.on_show,"'on_show' must be a function"),null!=this.before_show&&f("function"==typeof this.before_show,"'before_show' must be a function"),null!=this.on_hide&&f("function"==typeof this.on_hide,"'on_hide' must be a function"),null!=this.on_confirm_button_click&&f("function"==typeof this.on_confirm_button_click,"'on_confirm_button_click' must be a function"),null!=this.on_cancel_button_click&&f("function"==typeof this.on_cancel_button_click,"'on_cancel_button_click' must be a function"),this.options.vars&&(this.vars=this.options.vars),this.click_out_to_close=!0,this.options.click_out_to_close===!1&&(this.click_out_to_close=!1),this.prev_key_scope=null}return n.KEY_SCOPE="dbmodal",n.__stack=[],n.get_containing_modal=function(t){var e,r;return r=t.closest(".db-modal-wrapper"),e=a.get_controller(r),e&&f(e instanceof n,"controller of .db-modal-wrapper must be a DBModal object"),e},n.prototype.before_show=function(){return null!=this.options.title?this.set_title(this.options.title):void 0},n.prototype.on_confirm_button_click=function(t){return t.preventDefault(),d.pop()},n.prototype.on_cancel_button_click=function(t){return t.preventDefault(),d.pop()},n.prototype.on_show=null,n.prototype.on_hide=null,n.prototype.format=function(t){var n,r;for(n in t)e.call(t,n)&&(r=t[n],this.$modal_window.find(n).text(r));return this},n.prototype.__clone_modal=function(){return this.$modal_window||(this.options.preloaded?(this.$modal_window=r("#"+this.element_id),this.$modal_window.removeClass("db-modal-wrapper--preloaded")):this.$modal_window=a.clone_element(this.$template).attr("id",this.element_id),this.$overlay=this.$modal_window.find(".db-modal-overlay")),a.deprecated_set_controller(this.$modal_window,this),a.bind_controllers(this.$modal_window),this.options.preloaded?void 0:r("body").prepend(this.$modal_window)},n.prototype.__show_modal=function(){return this.$modal_window.show()},n.prototype.__x_click_handler=function(t){return t.preventDefault(),d.clear()},n.prototype.__tabbable_elements=function(){var t,e,n,o,i,s,a,u,l,c;if(l=this.$modal_window.find(".db-modal").find(":tabbable"),f(l.length,'"dbmodal-x" should be in tabbable_elms'),c=function(){var t,e,o;for(o=[],t=0,e=l.length;e>t;t++)n=l[t],parseInt(r(n).attr("tabindex"))>-1&&o.push(n);return o}(),c.length){for(u=function(t,e){var n,o;return n=parseInt(r(t).attr("tabindex"),10),o=parseInt(r(e).attr("tabindex"),10),o>n?-1:n>o?1:0},c.sort(u),o=-1,s=0,a=c.length;a>s;s++)n=c[s],i=l.index(n),-1===o&&(o=i),l.splice(i,1);f(o>-1,"First index should be set"),e=l.slice(0,o),t=l.slice(o),l=r.merge(e,c),l=r.merge(l,t)}return l},n.prototype.__keydown_handler=function(t){var e,n,o,i;if((27===t.keyCode||8===t.keyCode&&!u.focus_in_input())&&(t.preventDefault(),"function"==typeof this.logger_keydown_close_handler&&this.logger_keydown_close_handler(),d.clear()),9===t.keyCode){if(t.preventDefault(),e=this.__tabbable_elements(),n=e.index(r(t.target)),0>n)return this.focus_element?r(this.focus_element).focus():(i=t.shiftKey?e.last():e.first(),i.focus());if(n>-1)return o=t.shiftKey?-1:1,i=(n+o)%e.length,e.get(i).focus()}},n.prototype.__overlay_click_handler=function(t){return t.preventDefault(),d.clear()},n.prototype.__listen=function(){return this.click_out_to_close!==!1&&this.$overlay.on("click",this.__overlay_click_handler),this.$db_modal_x=this.$modal_window.find(".db-modal-x"),this.$db_modal_x.on("click",this.__x_click_handler),r(document).on("keydown",this.__keydown_handler),this.__listen_buttons()},n.prototype.__listen_buttons=function(){return null!=this.on_confirm_button_click&&(this.$confirm_button=this.$modal_window.find(".confirm-button"),this.$confirm_button.on("click",this.on_confirm_button_click)),null!=this.on_cancel_button_click?(this.$cancel_button=this.$modal_window.find(".cancel-button"),this.$cancel_button.on("click",this.on_cancel_button_click)):void 0},n.prototype.__unlisten=function(){return this.click_out_to_close!==!1&&this.$overlay.off("click"),this.$db_modal_x.off("click"),r(document).off("keydown",this.__keydown_handler),null!=this.on_confirm_button_click&&this.$confirm_button.off("click"),null!=this.on_cancel_button_click?this.$cancel_button.off("click"):void 0},n.prototype.__focus=function(){var t,e,n,r;return e=this.$modal_window.find(".db-modal"),"confirm"===this.options.focus?this.focus_element=e.find(".confirm-button").first():"cancel"===this.options.focus?this.focus_element=e.find(".cancel-button").first():this.options.focus?this.focus_element=e.find(this.options.focus).first():(this.focus_element=e,t=e.find("input[type=text], input[type=email]").first(),t.length?this.focus_element=t:s.msie||(n=e.find("input[type=button]").first(),n.length&&(this.focus_element=n),r=e.find("input[type=submit]").first(),r.length&&(this.focus_element=r))),this.focus_element.focus()},n.prototype.__prefill=function(){var t,e,n,r,o;if(null!=this.options.prefill){e=this.$modal_window.find(".db-modal"),r=this.options.prefill;for(n in r)o=r[n],t=e.find(n).val(o),f(t,"Element with name '"+n+"' not found")}},n.add_role_to_id=function(t,e){return e?t+"-"+e:t},n.get_template=function(t,e){var o;return o=n.add_role_to_id(t,e),r("#db-modal-"+o)},n.prototype.show=function(t,e){return null==t&&(t=null),null==e&&(e=null),null!=t&&(this.options.focus=t),null!=e&&(this.options.prefill=e),d.push(this)},n.prototype.hide=function(){return this!==d.top()?(d.remove(this),this._hide()):d.pop()},n.prototype._show=function(){return this.visible?void 0:(this.__clone_modal(),"function"==typeof this.before_show&&this.before_show(this.$modal_window),this.__show_modal(),this.__listen(),this.visible=!0,window.key.getScope()!==this.constructor.KEY_SCOPE&&(this.prev_key_scope=window.key.getScope()),window.key.setScope(this.constructor.KEY_SCOPE),r(document).trigger("modalOpened",[1]),u.scroll_lock_document(),"function"==typeof this.on_show&&this.on_show(),this.__prefill(),this.__focus(),this)},n.prototype._hide=function(){return this.visible?(this.__unlisten(),window.key.setScope(this.prev_key_scope),this.$modal_window.remove(),this.visible=!1,this.prev_key_scope=null,r(document).trigger("modalClosed",[1]),u.scroll_unlock_document(),"function"==typeof this.on_hide&&this.on_hide(),this):void 0},n.prototype.set_title=function(t){return this.$modal_window.find(".db-modal-title-text").text(t),this},n}(),p=function(e){function o(e,n){this.user=e,this.__inject_basic_user_properties=t(this.__inject_basic_user_properties,this),this.before_show=t(this.before_show,this),o.__super__.constructor.call(this,n)}return n(o,e),o.prototype.before_show=function(t){return o.__super__.before_show.call(this,t),this.__inject_basic_user_properties(t)},o.prototype.__inject_basic_user_properties=function(t){var e,n;return e=t.find("form"),e.find("input[name='"+_.UID_PARAM_NAME+"']").remove(),n=r('<input type="hidden">').attr({name:_.UID_PARAM_NAME,value:this.user.id}),e.append(n),t.find(".dbmodal-email-placeholder").text(this.user.email)},o}(h),__CONDITIONAL_JS__.DBModalStack=INLINE_JS.DBModalStack=d,{DBModalStack:d,DBModal:h,DBUserModal:p}})}.call(this),function(){define("modules/clean/devtools/perf_hub_action_types",[],function(){var t;return t={},t.ActionTypes={PROFILED_AJAX_LOAD_FINISHED:"PROFILED_AJAX_LOAD_FINISHED",WEB_TIMING_FETCHED:"WEB_TIMING_FETCHED"},t})}.call(this),function(){define("modules/clean/devtools/perf_hub_actions",["modules/clean/flux/dispatcher","modules/clean/devtools/perf_hub_action_types"],function(t,e){var n,r;return n=e.ActionTypes,new(r=function(){function e(){}return e.prototype.add_ajax_profile=function(e){var r,o;return o=e.xhr,r=e.url,t.dispatch({type:n.PROFILED_AJAX_LOAD_FINISHED,data:{xhr:o,url:r}})},e.prototype.add_web_timing_details=function(e){var r;return r=e.details,t.dispatch({type:n.WEB_TIMING_FETCHED,data:{details:r}})},e}())})}.call(this),function(){define("modules/clean/em_string",[],function(){var t;return t=function(){function t(e){return this instanceof t?(this.s=e,this.info=this.widthInfo(),void(this.length=e.length?this.info[this.s.length-1]:0)):new t(e)}return t.em_snippet=function(e,n,r){return null==n&&(n=50),null==r&&(r=.75),new t(e.toString()).snippet(n,r).toString()},t.prototype.widthInfo=function(){var t,e,n,r;for(n={},n[-1]=0,t=e=0,r=this.s.length;r>=0?r>e:e>r;t=r>=0?++e:--e)n[t]=n[t-1]+this.ems(this.s.charAt(t));return n},t.prototype.findSpot=function(t){var e,n,r,o;if(!t)return 0;for(o=0,n=this.s.length;n>=o;)if(r=Math.floor(o/2+n/2),e=this.info[r-1],e>t)n=r-1;else{if(!(t>e))return r;o=r+1}return o>r?o:r},t.prototype.ems=function(e){var n,r,o,i,s;return r=.65,n=1.08,o=.58,i=e.charCodeAt(0),s=t.CODEPOINT_TO_WIDTH[i],s?s/Math.pow(10,t.ACCURACY):i>=768&&879>=i?0:i>=65377&&65500>=i?o:i>=11904&&40911>=i||i>=44032&&55215>=i||i>=4352&&4607>=i||i>=63744&&64255>=i||i>=65280&&65535>=i||i>=131072&&196607>=i?n:r},t.prototype.substr=function(e,n){var r,o;return o=this.findSpot(e),null!=n?(r=this.findSpot(e+n),new t(this.s.substr(o,r-o))):new t(this.s.substr(o))},t.prototype.toString=function(){return this.s},t.prototype.snippet=function(e,n){var r,o,i,s,a;return null==e&&(e=50),null==n&&(n=.75),this.length<=e?this:(e-=t._ELLIPSIS_LENGTH,r=e*n,s=e-r,a=this.length-s,i=this.substr(0,r),o=this.substr(a),new t(i.toString()+""+o.toString()))},t.ACCURACY=2,t.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1e3:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,2026:67,19977:108,65403:58},t._ELLIPSIS_LENGTH=new t("").length,t}()})}.call(this),function(){define("modules/clean/event_load",[],function(){var t,e,n;return t=function(t){return window.setTimeout(function(){return t.apply(t)},0)},n=function(e){return"complete"===document.readyState?t(e):null!=window.attachEvent?window.attachEvent("onload",e):null!=window.addEventListener?window.addEventListener("load",e,!1):void 0},e={window_load:n}})}.call(this),function(){define("modules/clean/filepath",["modules/core/i18n"],function(t){var e,n,r,o,i,s,a,u,l,c,_,h;return n=t._,c=function(t){return t?("/"!==t.charAt(0)&&(t="/"+t),"/"===t.charAt(t.length-1)?t.substr(0,t.length-1):t):""},h=function(t,e){return c(t).toLowerCase()===c(e).toLowerCase()},u=function(t,e){return t=c(t),t=t.split("/"),u=t.pop(),""===u?e||n("Dropbox"):u},l=function(t){return-1===t.indexOf(".")?t:t.split(".").slice(0,-1).join(".")},i=function(t,e){var n;return null==e&&(e=!1),n=t.split(".").pop(),e&&n===t?"":n},s=function(t){return-1===t.indexOf(".")?"":i(t).toLowerCase()},e={_other:"page_white",log:"page_white",msg:"page_white",sln:"page_white",vcproj:"page_white",txt:"page_white_text",wps:"page_white_text",doc:"page_white_word",docx:"page_white_word",docm:"page_white_word",rtf:"page_white_word",pages:"page_white_word",wpd:"page_white_word",odt:"page_white_word",pdf:"page_white_acrobat",xls:"page_white_excel",xlsm:"page_white_excel",xlsx:"page_white_excel",xlsb:"page_white_excel",ods:"page_white_excel",csv:"page_white_excel",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",pptm:"page_white_powerpoint",pps:"page_white_powerpoint",ppsx:"page_white_powerpoint",ppsm:"page_white_powerpoint",odp:"page_white_powerpoint",key:"page_white_keynote",css:"page_white_code",html:"page_white_code",htm:"page_white_code",xml:"page_white_code",php:"page_white_code",c:"page_white_code",h:"page_white_code",rb:"page_white_code",cpp:"page_white_code",java:"page_white_code",js:"page_white_code",json:"page_white_code",cs:"page_white_code",py:"page_white_code",exe:"page_white_gear",dll:"page_white_gear",app:"page_white_gear",mp3:"page_white_sound",m3u:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aif:"page_white_sound",iff:"page_white_sound",mid:"page_white_sound",mpa:"page_white_sound",ra:"page_white_sound",aiff:"page_white_sound",amr:"page_white_sound",ogg:"page_white_sound",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture",ari:"page_white_picture",arw:"page_white_picture",srf:"page_white_picture",sr2:"page_white_picture",bay:"page_white_picture",crw:"page_white_picture",cr2:"page_white_picture",cap:"page_white_picture",eip:"page_white_picture",dcs:"page_white_picture",dcr:"page_white_picture",drf:"page_white_picture",k25:"page_white_picture",kdc:"page_white_picture",dng:"page_white_picture",erf:"page_white_picture",fff:"page_white_picture",iiq:"page_white_picture",mef:"page_white_picture",mos:"page_white_picture",mrw:"page_white_picture",nef:"page_white_picture",nrw:"page_white_picture",orf:"page_white_picture",pef:"page_white_picture",ptx:"page_white_picture",pxn:"page_white_picture",r3d:"page_white_picture",raf:"page_white_picture",rw2:"page_white_picture",raw:"page_white_picture",rwl:"page_white_picture",rwz:"page_white_picture",obm:"page_white_picture",srw:"page_white_picture",x3f:"page_white_picture",avi:"page_white_film",mov:"page_white_film",mp4:"page_white_film",mkv:"page_white_film",wmv:"page_white_film",mpg:"page_white_film",m4v:"page_white_film",vob:"page_white_film",ogv:"page_white_film",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",tgz:"page_white_compressed",bz2:"page_white_compressed",iso:"page_white_dvd",dmg:"page_white_dvd",ai:"page_white_vector",psd:"page_white_paint",au:"page_white_sound",fla:"fla",swf:"fla",url:"page_white_linkfile",webloc:"page_white_linkfile",website:"page_white_linkfile"},o=function(t){return e[t]||"page_white"},a=function(t){var e;return e=i(t).toLowerCase(),o(e)},_=function(t){var e;return e=t.split("/").slice(0,-1).join("/"),e||"/"},r={paths_are_equal:h,filename:u,file_extension:i,filename_without_extension:l,file_extension_for_logging:s,file_icon:a,extension_icon:o,normalize:c,parent_dir:_}})}.call(this),function(){"use strict";var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;define("modules/clean/flux/dispatcher",["external/flux","modules/core/exception"],function(e,n){var r,o;return o=!1,new(r=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.dispatch=function(t){n.assert(!o,"Invariant error: cannot dispatch during dispatch."),n.assert(null!=t.type,"Invariant error: cannot dispatch action without 'type' properrty."),o=!0;try{"function"==typeof this.dispatch_begin&&this.dispatch_begin();try{return r.__super__.dispatch.call(this,{action:t})}finally{"function"==typeof this.dispatch_end&&this.dispatch_end()}}finally{o=!1}},r}(e.Dispatcher))})}.call(this),function(){define("modules/clean/gandalf_util",["modules/constants/gandalf"],function(t){var e;return new(e=function(){function e(){}return e.prototype.getGandalfRule=function(e){return t.gandalf[e]},e.prototype.isGandalfInVariant=function(t,e){return null==e&&(e="CONTROL"),this.getGandalfRule(t)===e},e}())})}.call(this),function(){define("modules/clean/growth/experiments/logger",["modules/clean/ajax"],function(t){var e;return e=function(){function e(){}var n,r;return e.start_times={},e.DEFAULT_TIMER_NAME="view_time",e.get_timer_name=function(t){return null==t||"boolean"==typeof t?e.DEFAULT_TIMER_NAME:t},e.set_start_time=function(t){var n;return n=e.get_timer_name(t),e.start_times[n]=Date.now()},e.do_log_view_time=function(t,n){var r;return r=e.get_timer_name(n),t[r]=Math.round((Date.now()-e.start_times[r])/1e3)},r={},n=[5,15,60,120,300],e.start_counter=function(t,e){var o,i,s,a;for(s=[],o=0,i=n.length;i>o;o++)a=n[o],s.push(function(n){return r[t+n]=setTimeout(function(){return e(t,{time_since_first_view:n})},1e3*n)}(a));return s},e.stop_counter=function(t){var e,o,i,s;for(i=[],e=0,o=n.length;o>e;e++)s=n[e],i.push(clearTimeout(r[t+s]));return i},e.log=function(n,r,o,i){switch(null==i&&(i=!1),o=o||{},n){case"onboarding":return i&&e.do_log_view_time(o,i),t.SilentBackgroundRequest({url:"/growth_onboarding_log",data:{evt:r,extra:JSON.stringify(o)}});case"sharing":return e.do_log_view_time(o),t.SilentBackgroundRequest({url:"/growth_sharing_log",data:{evt:r,extra:JSON.stringify(o)}});case"post_client_install_tab":return i&&e.do_log_view_time(o,i),t.SilentBackgroundRequest({url:"/growth_post_client_install_tab_log",data:{evt:r,extra:JSON.stringify(o)}});default:throw new Error("Invalid series name")}},e}()})}.call(this),function(){define("modules/clean/hi_res",["jquery"],function(t){var e;return e=function(){function e(t){var e;this.constructor._show_hi_res()&&(e=t.attr("data-hi-res-no-resize"),this.constructor.set_src(t,t.attr("data-hi-res"),e),this.constructor.set_bg(t,t.attr("data-hi-res-background"),e))}return e.set_src=function(t,e,n){return this._show_hi_res()&&e&&e!==t.attr("src")?this._replace(t,e,!n,this._replace_img):void 0},e.set_bg=function(t,e,n){return this._show_hi_res()?this._replace(t,e,!n,this._replace_background):void 0},e._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},e._replace=function(e,n,r,o){var i;return n?(i=new Image,i.src=n,t(i).on("load",function(){return o(e,n,r,i.width,i.height)})):void 0},e._replace_img=function(t,e,n,r,o){return t.attr("src",e),n?(t.width(r/2),t.height(o/2)):void 0},e._replace_background=function(t,e,n,r,o){var i;return i="url('%(src)s')".format({src:e}),t.css("backgroundImage",i),n?t.css("backgroundSize",r/2+"px "+o/2+"px"):void 0},e}()})}.call(this),function(){define("modules/clean/image_size",[],function(){var t;return t=function(t,e){var n,r,o,i,s,a,u;for(i=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]],r=0,s=i.length;s>r;r++)if(a=i[r],o=a[0],u=a[1],n=a[2],u>=t||n>=e)return o;return i[i.length-1][0]},{image_best_fit_size:t}})}.call(this),function(){define("modules/clean/index_2015",["jquery","external/underscore","modules/clean/dbmodal","modules/clean/analytics","modules/clean/register_form"],function(t,e,n,r,o){var i,s;return s=r.UserActivityLogger,i=function(){function r(){var r,i,a;this._onScrollHandler(),t(window).scroll(e.throttle(this._onScrollHandler,33,{leading:!0,trailing:!0
})),a=new n.DBModal({element_id:"sign-up-modal"}),t("#sign-up, .sign-up").on("click",function(t){return t.preventDefault(),s.log("","web_register"),a.show()}),i=new n.DBModal({element_id:"index-sign-in-modal"}),t("#sign-in").on("click",function(t){return t.preventDefault(),i.show(),s.log("","web_login")}),t(document).on(o.USER_EXISTS,function(t){return i.show(t.focus,t.prefill)}),t(".get-dropbox-cta-v2__show-modal").length>0&&(r=new n.DBModal({element_id:"pro-plan-modal"}),t(".get-dropbox-cta-v2__show-modal").on("click",function(){return r.show()}))}return r.prototype._onScrollHandler=function(){return t(window).scrollTop()>350?(t("#dropbox-logo").addClass("fade-out"),t(".button-toggler").addClass("show-sign-up")):(t("#dropbox-logo").removeClass("fade-out"),t(".button-toggler").removeClass("show-sign-up"))},r}()})}.call(this),function(){define("modules/clean/job_progress",["jquery","modules/core/dom"],function(t,e){var n,r,o;return o={make:function(e,n){var r,o,i,s,a,u,l;return null==n&&(n=300),l=n.toString()+"px",i=t("<div />",{class:"outer-progress-bar"}).css({width:l}),r=t("<div />",{class:"inner-progress-bar",id:"pb_"+e}).css({width:l}),a=t("<div />",{class:"under-pb progress-bar"}).css({width:l}),s=t("<div />",{class:"over-pb progress-bar",id:"pb_"+e+"_over"}).css({display:"none"}),u=t("<div />",{class:"pb-percentage",id:"pb_"+e+"_upct"}).css({width:l}),o=t("<div />",{class:"pb-percentage",id:"pb_"+e+"_opct"}).css({width:l}),a.append(u),s.append(o),r.append(a),r.append(s),i.append(r),s.data("progress-width",n),i},set:function(e,n){var r,o,i;return(r=t("#pb_"+e+"_over"))?(n=Math.min(n,1),o=r.data("progress-width"),i=String(o*n)+"px",r.show(),r.css({backgroundColor:"#348DD3",overflow:"hidden",width:i})):void 0}},n={complete:{},handled:function(t){var e;return t?(e=!!n.complete[t],n.complete[t]=!0,e):!1},peek:function(t){return t?!!n.complete[t]:!1}},r={show:function(n){var r,i,s,a,u,l,c,_;return n&&(null!=(c=__CONDITIONAL_JS__.DBModalStack)&&null!=(_=c.top())&&_.hide(),r=t("body"),i=t("<div />",{id:"modal-progress-overlay"}),i.hide(),i.appendTo(r),t("#browse-box").length?e.clone_position(i,t("#browse-box")):t("#gallery-view-media").length?e.clone_position(i,t("#gallery-view-media")):i.css({position:"fixed",width:"100%",height:"100%"}),i.width())?(u=t("<div />",{id:"modal-progress-content"}),a=t("<div />",{id:"modal-progress-container"}),s=t("<div />",{id:"modal-progress-bar",opacity:1,html:o.make("modal-progress",150,"")}),l=t("<div />",{id:"modal-progress-text",text:n}),u.hide(),a.append(s,l),u.append(a),r.append(u),i.fadeTo(250,.7),u.fadeIn(250)):void 0},update:function(t){var e;return t.indexOf("/")>0&&(e=t.split("/"),t=Number(e[0])/Number(e[1]),isNaN(t))?void 0:o.set("modal-progress",t)},hide:function(){return t("#modal-progress-overlay").fadeOut(250,function(){return t("#modal-progress-overlay").remove()}),t("#modal-progress-content").fadeOut(250,function(){return t("#modal-progress-content").remove()})}},{ModalProgress:r,Job:n}})}.call(this),function(){define("modules/clean/keycode",[],function(){var t;return t=function(){function t(){}return t.A=65,t.BACKSPACE=8,t.TAB=9,t.ENTER=13,t.SHIFT=16,t.CONTROL=17,t.ALT=18,t.ESC=27,t.SPACE=32,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.INSERT=45,t.DELETE=46,t.TWO_KEY=50,t.EQUALS=61,t.COMMAND=91,t.PLUS_EQUALS_FF=107,t.MINUS_FF=109,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.PLUS_EQUALS_FF_GERMAN=171,t.MINUS_FF_MAC=173,t.PLUS_CHROME=187,t.MINUS_CHROME=189,t.FORWARD_SLASH=191,t.AT_SIGN=64,t.PROCESSING=229,t}()})}.call(this),function(){define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(t,e,n){var r,o;return o=n._,r=function(){function t(t,e,n){var r;this.$input=t,this.$suggestion_container=e,null==n&&(n={}),this.checkInput(),r=n.livecheck===!0?"keyup blur":"blur",this.$input.on(r,this.checkInput.bind(this))}return t.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],t.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],t.THRESHOLD=2,t.prototype.checkInput=function(){var t;t=this.suggest(this.$input.val()),t?this.populate(t):this.clear()},t.prototype.populate=function(t){var n,r,i;return i=e.escape(t.local).toHTML(),n=e.escape(t.domain).toHTML(),r=i+"@<span class='email_warning_area'>"+n+"</span>",this.$suggestion_container.html(new e(o("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:r})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",function(e){return function(){return e.$input.val(t.full),e.clear()}}(this))},t.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},t.prototype.suggest=function(t){var e,n,r,o;return null==t&&(t=""),t.length?(t=t.toLowerCase(),(o=this.splitEmail(t))?(r=o.local,n=o.domain,this.whitelistedDomain(n)?!1:(e=this.findClosestDomain(n),e?{local:r,domain:e,full:r+"@"+e}:!1)):!1):void 0},t.prototype.whitelistedDomain=function(e){var n,r,o,i;for(i=t.WHITELIST_REGEXS,n=0,r=i.length;r>n;n++)if(o=i[n],o.test(e))return!0;return!1},t.prototype.splitEmail=function(t){var e;return e=t.split("@"),2!==e.length?!1:{local:e[0],domain:e[1]}},t.prototype.findClosestDomain=function(e){var n,r,o,i,s,a,u;for(a=99,r=null,u=t.DOMAINS,i=0,s=u.length;s>i;i++)n=u[i],o=this.stringDistance(e,n),a>o&&(a=o,r=n);return r&&r!==e&&a<=t.THRESHOLD?r:!1},t.prototype.stringDistance=function(t,e){var n,r,o,i,s,a;if(null==t||0===t.length)return null==e||0===e.length?0:e.length;if(null==e||0===e.length)return t.length;for(n=0,s=0,a=0,o=0,i=5;n+s<t.length&&n+a<e.length;){if(t.charAt(n+s)===e.charAt(n+a))o++;else for(s=0,a=0,r=0;i>r;){if(n+r<t.length&&t.charAt(n+r)===e.charAt(n)){s=r;break}if(n+r<e.length&&t.charAt(n)===e.charAt(n+r)){a=r;break}r++}n++}return(t.length+e.length)/2-o},t}()})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/marketing_tracker",["modules/core/exception"],function(e){var n,r;return n="https://marketing.dropbox.com",new(r=function(){function r(){this._load=t(this._load,this),this.push=t(this.push,this)}return r.prototype.el=!1,r.prototype.ready=!1,r.prototype.push=function(t){var r;return this.src=t.src,r=t.dataLayer,e.assert(this.src,"MarketingTracker.push requires src"),this.el||(this.el=this._load(this.src)),this.ready?this.el.contentWindow.postMessage(r,n):this.el.addEventListener("load",function(t){return function(){return t.ready=!0,t.el.contentWindow.postMessage(r,n)}}(this)),this},r.prototype._load=function(t){var e;return e=document.createElement("iframe"),e.style.display="none",e.hidden=!0,e.src=t,e.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(e),e},r}())})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},e=[].slice;define("modules/clean/notserver",["jquery","external/underscore","modules/constants/env","modules/core/exception","modules/core/uri","modules/clean/viewer"],function(n,r,o,i,s,a){var u,l,c,_,h,d,p,f,m;h=i.assert,u={},l=!1,_="/subscribe",c=function(){function o(){}return o.prototype.add_notclient=function(t,e,n){return this.new_notclient(t),setTimeout(function(){return u[t].init(e,n)},2e3)},o.prototype.new_notclient=function(o){var i,a,c,d,p,f,m,g,v,w,b,y,x,E,S,k,R,T,C,A,L,O,I,N,$,D,P,U,M,F,j,q,H,B,G,W,J,K,X;return h(t.call(u,o)<0,"cannot create more than one notclient per user"),A=function(t){return r.isNumber(t)&&t%1===0&&t>0},C=function(t){return r.isNumber(t)&&t%1===0&&t>=0},h(A(o),"user_id must be a positive integer"),L=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],l?console.log.apply(console,t):void 0},i=9e4,d=8096,f="user",p="list",k=!1,a=1e3,c=3e5,P=0,G=function(){var t;return t=0===x?0:Math.min(a*Math.pow(2,x-1),c),Math.max(t,P)},$=null,U={},S={},N=1,R=!1,T=!1,X=null,v=!1,J=[],B=null,y=null,O=null,I={},M=!1,x=0,W=0,K=function(t,e){var n,r,o;r=[];for(n in e)o=e[n],n=parseInt(n,10),h(A(n),"ns_ids must be positive integers: "+n),h(C(o),"sjids must be nonnegative integers: "+o),r.push(t[n]=null!=t[n]?Math.min(t[n],o):o);return r},w=function(){var e,n,i,a;return h(null!=$&&!r.isEmpty(U),"expected nid and ns_map"),i={host_int:0,trace:window.location.pathname},e=r.pluck(r.values(S),"type"),t.call(e,f)>=0&&(i.user_id=o,i.nid=null!=$?$.replace(/^0+(.)/,"$1"):void 0),t.call(e,p)>=0&&(i.ns_map=function(){var t;t=[];for(n in U)a=U[n],t.push(n+"_"+a);return t}().join(",")),s.parse(_).updateQuery(i).toString().length>d&&delete i.ns_map,i},b=function(){var t;return k?(t=G(),t>0?y=window.setTimeout(m,t):m()):void 0},m=function(){var t;return h(!R&&!T,"connect: invalid state"),h($>=0||!r.isEmpty(U),"notclient: called connect with nothing to subscribe to"),L("###########################"),t=w(),null!=t.nid||t.ns_map?(L("connecting to notserver..."),R=!0,W+=1,X=n.ajax(_,{data:t,dataType:"json",noDropboxDefaults:!0,error:function(){return v?void(v=!1):(x+=1,L("error connecting to notserver. bad rounds="+x+"."),R=!1,b())},success:function(t){return L("notserver connection closed. response:",t),R=!1,null!=t.chillout?(P=1e3*parseInt(t.chillout,10),L("notserver told us to chill for "+P+"ms")):P>0&&(L("setting notserver chillout back to 0ms"),P=0),"punt"===t.ret?b():(h("new"===t.ret,"unknown notserver ret: "+t.ret),h("refresh"in t,"expected notserver ret:new to have refresh keyword"),H(t.refresh))}})):void L("nothing to subscribe to. skipping notserver connection.")},g=function(){return null!=X?(v=!0,X.abort(),X=null):void 0},F=function(){return P=0,R=!1,T=!1,g(),J=[],window.clearTimeout(B),window.clearTimeout(y),B=null,y=null,O=null,I={},M=!1,x=0,b()},q=function(){var t;return k=!1,P=0,$=null,U={},S={},t=0,N=1,R=!1,T=!1,X=null,v=!1,J=[],window.clearTimeout(B),window.clearTimeout(y),B=null,y=null,O=null,I={},M=!1,x=0,W=0},H=function(e){var n,o,s,a,u,l,c,_;for(h(!T&&!R,"run_handlers: invalid state"),h(null===O,"run_handlers: new_nid must start at null"),h(r.isEqual(I,{}),"run_handlers: new_ns_map must start at {}"),h(!M,"expected one_or_more_handler_failures=false"),T=!0,L("running handlers..."),c=r.filter(r.values(S),function(n){var r;return r=n.type,t.call(e,r)>=0}),h(!r.isEmpty(c),"notserver sent a ping for unsubscribed activity"),J=r.pluck(c,"handler_id"),s=0,a=c.length;a>s;s++)l=c[s],n=l.handler,o=l.handler_id,u=l.name,_=l.type,L("running id="+o+", name="+u+", type="+_),n();return r.isEmpty(J)?L("all handlers already finished running. no need for a slacker timeout."):(L("all handlers running. slacker timeout set."),B=window.setTimeout(j,i))},j=function(){var t,e,n,o;for(h(T&&!R,"called report_slackers in an invalid state."),h(!r.isEmpty(J,"report_slackers called w/ nothing slackin'")),L("found some slackers"),M=!0,o=[],e=0,n=J.length;n>e;e++)t=J[e],o.push(E(t));return o},E=function(e){return t.call(J,e)<0?void 0:(L("done handling: "+e),J=r.without(J,e),r.isEmpty(J)?(L("all handlers are done running."),T=!1,window.clearTimeout(B),null!=O&&(L("new nid: "+O),$=O),r.isEmpty(I)||(L("new ns_map:",I),U=I),M?(x+=1,L("one or more handler errors. bad_rounds="+x)):x=0,O=null,I={},M=!1,b()):void 0)},D={get_user_id:function(){return o},get_nid:function(){return $},get_ns_map:function(){return r.clone(U)},get_consecutive_bad_rounds:function(){return x},get_total_rounds:function(){return W},get_notserver_chillout_ms:function(){return P},get_sleep_ms:G,subscribe_user:function(e){var n,o,i,s,a,u,l;for(h(!T,"adding new handlers from inside handlers is not currently supported"),l=["name","handler"],i=0,s=l.length;s>i;i++)u=l[i],h(e[u],"subscribe_user requires this param be non-falsey: "+u);return h(r.isFunction(e.handler),"handler must be a function"),L("adding user handler "+e.name),o=r.pluck(r.values(S),"type"),a=t.call(o,f)<0,n=N++,S[n]={handler_id:n,handler:e.handler,name:e.name,type:f},a&&(L("first user handler added, reconnecting"),F()),n},subscribe_sfj:function(e){var n,o,i,s,a,u,l;for(h(!T,"adding new handlers from inside handlers is not currently supported"),l=["name","handler"],i=0,s=l.length;s>i;i++)u=l[i],h(e[u],"subscribe_sfj requires this param be non-falsey: "+u);return h(r.isFunction(e.handler),"handler must be a function"),L("adding sfj handler "+e.name),o=r.pluck(r.values(S),"type"),a=t.call(o,p)<0,n=N++,S[n]={handler_id:n,handler:e.handler,name:e.name,type:p},a&&(L("first sfj handler added, reconnecting"),F()),n},unsubscribe:function(t){return h(!T,"removing handlers from inside handlers is not supported"),h(t in S,"no subscribed handler with the given id"),delete S[t],r.isEmpty(S)?g():void 0},handler_success:function(e,n){var r;return t.call(J,e)<0?void 0:(r=S[e].type,r===p?(h("ns_map"in n,"ns_map required param is missing"),h(!("nid"in n),"nid is disallowed from SFJ handlers"),K(I,n.ns_map)):(h(r===f,"unknown handler type: "+r),h("nid"in n,"nid required param is missing"),h(!("ns_map"in n),"ns_map is disallowed from user handlers"),(null==O||n.nid<O)&&(O=n.nid)),E(e))},handler_failure:function(e){return L("handler failed. handler_id="+e),t.call(J,e)<0?void 0:(M=!0,E(e))},handle_visibility_change:function(){return window.document.hidden?g():F()},init:function(t,e){return h(!k,"error: init() has been called twice."),$=t,K(U,e),k=!0,null==window.document.visibilityState?b():(document.addEventListener("visibilitychange",this.handle_visibility_change),window.document.hidden?void 0:b())},reset:q,abort:g,reconnect:F},u[o]=D,D},o}(),c=new c,f=a.get_viewer().get_users();for(d=0,p=f.length;p>d;d++)m=f[d],c.add_notclient(m.id,m.nid,m.ns_map);return{NotServer:c,NotClients:u}})}.call(this),function(){define("modules/clean/open_in_mobile_app",["jquery","modules/core/i18n","modules/core/uri"],function(t,e){var n,r;return r=e._,n=function(){function e(){}return e.vischange_listener=null,e.open_app_mode=!0,e.try_open_ios_9=function(t,n,o){var i;return e.vischange_listener||(i=o.text(),e.vischange_listener=function(){return e.open_app_mode=!0,o.text(i)},document.addEventListener("visibilitychange",e.vischange_listener)),e.open_app_mode?(e.open_app_mode=!1,o.text(r("Install app?")),window.location=t):window.location=n},e.fallback_will_launch=!1,e.try_open=function(n,r){var o,i,s,a,u,l,c;return e.fallback_will_launch?void 0:(o=t("body"),c=function(){var e;return e=t("<iframe />",{src:n,style:"display: none;"}),o.append(e)},u=!1,l=function(){return u=!0},document.addEventListener("visibilitychange",l),s=!1,a=function(){return s=!0},window.addEventListener("pagehide",a),c(),i=function(){return e.fallback_will_launch=!1,document.removeEventListener("visibilitychange",l),window.removeEventListener("pagehide",a),s||u?void 0:window.location.replace(r)},setTimeout(i,3200),e.fallback_will_launch=!0)},e.open_on_click=function(e,n,r,o,i){var s;return s=function(r){return function(s){return s.preventDefault(),i?(o||(o=t("<div/>")),r.try_open_ios_9(e,n,o)):r.try_open(e,n)}}(this),t(r).on("click",s)},e.redirect_on_load=function(t,e){return this.try_open(t,e)},e}()})}.call(this),function(){define("modules/clean/photos/batch_thumb_loader",["jquery","modules/clean/ajax","modules/core/uri","modules/constants/env"],function(t,e,n,r){var o;return o=function(){function o(t){var e,n;e=t.batch_size,n=t.max_parallel_requests,this.on_batch=t.on_batch,this.batch_logger=t.batch_logger,this.on_batch_success=t.on_batch_success,this.batch_size=e||this.DEFAULT_BATCH_SIZE,this.max_parallel_requests=n||this.DEFAULT_MAX_PARALLEL_REQUESTS,this.thumb_url_queue=[],this.batch_queue=[],this.callback_by_id={},this.request_ids_by_url={},this.num_requests_in_flight=0,this.flushing=!1,this.next_thumb_request_id=0,this.next_batch_id=0,this.cancelled_urls={},this.outstanding_batches={},this._request_callback_by_request_id={}}return o.prototype.DEFAULT_BATCH_SIZE=16,o.prototype.DEFAULT_MAX_PARALLEL_REQUESTS=6,o.prototype.MAX_URL_LENGTH=6e3,o.prototype.vend_request_id=function(){var t;return t=this.next_thumb_request_id,this.next_thumb_request_id++,t},o.prototype.queue_thumb=function(e,n,o){var i,s,a,u,l,c,_,h,d,p;if(null==o&&(o={}),d=o.request_id,c=o.onrequest,!e)return null;if(t.support.cors&&r.BATCH_THUMB_ENDPOINTS.length){if(null==d&&(d=this.vend_request_id()),(null!=(_=this.request_ids_by_url[e])?_.length:void 0)>0){a=!1;for(i in this.outstanding_batches)for(h=this.outstanding_batches[i].urls,u=0,l=h.length;l>u;u++)p=h[u],p===e&&(a=!0);a&&"function"==typeof c&&c()}else this.thumb_url_queue.push(e),this.request_ids_by_url[e]=[];return this.request_ids_by_url[e].push(d),this.callback_by_id[d]={url:e,callback:n},this._request_callback_by_request_id[d]=c,this.thumb_url_queue.length>=this.batch_size&&(this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size)),this._send_batch_requests()),d}return"function"==typeof c&&c(),s=!0,"function"==typeof n&&n(e,s),null},o.prototype.cancel_thumb=function(t){var e,n,r,o,i,s,a,u,l,c,_,h,d,p,f,m,g,v,w,b,y,x,E,S,k;if(null!=this.callback_by_id[t]){for(S=this.callback_by_id[t].url,delete this.callback_by_id[t],delete this._request_callback_by_request_id[t],g=this.request_ids_by_url[S],o=a=0,l=g.length;l>a;o=++a)if(i=g[o],i===t){this.request_ids_by_url[S].splice(o,1);break}if(0===this.request_ids_by_url[S].length){for(delete this.request_ids_by_url[S],v=this.thumb_url_queue,o=u=0,c=v.length;c>u;o=++u)if(E=v[o],E===S)return void this.thumb_url_queue.splice(o,1);for(w=this.batch_queue,o=p=0,_=w.length;_>p;o=++p)for(n=w[o],s=f=0,h=n.length;h>f;s=++f)if(E=n[s],E===S)return n.splice(s,1),void(0===n.length&&this.batch_queue.splice(o,1));this.cancelled_urls[S]=1,x=[];for(r in this.outstanding_batches){for(b=this.outstanding_batches[r],k=b.urls,y=b.request,e=!0,m=0,d=k.length;d>m;m++)S=k[m],e=null!=this.cancelled_urls[S]&&e;if(e){y.abort();break}x.push(void 0)}return x}}},o.prototype.flush=function(){for(;this.thumb_url_queue.length;)this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size));return this._send_batch_requests()},o.prototype.reset=function(t){var e;return e=t.batch_size,this.batch_logger=t.batch_logger,this.batch_size=e||this.DEFAULT_BATCH_SIZE},o.prototype.clear=function(){return this.thumb_url_queue=[]},o.prototype.pause=function(){return this.flushing=!1},o.prototype._send_batch_requests=function(){var t,n,r,o,i,s,a,u,l,c,_,h,d,p,f;if(!(0===this.batch_queue.length||this.num_requests_in_flight>=this.max_parallel_requests)){for(this.flushing=!0,p=this.batch_queue.shift(),c=this._generate_request_params(p),o=c[0],l=c[1],r=c[2],"function"==typeof this.on_batch&&this.on_batch(p),i=0,a=p.length;a>i;i++)for(f=p[i],_=this.request_ids_by_url[f],s=0,u=_.length;u>s;s++)d=_[s],"function"==typeof(t=this._request_callback_by_request_id)[d]&&t[d](),delete this._request_callback_by_request_id[d];return n=this.next_batch_id,this.next_batch_id++,this.num_requests_in_flight++,h=e.AuthenticatedRequest({xhrFields:{withCredentials:!0},url:o,type:l,data:r,success:this._success.bind(this,p),error:this._error.bind(this,p),complete:this._complete.bind(this,n)}),this.outstanding_batches[n]={urls:p,request:h},this._send_batch_requests()}},o.prototype._success=function(t,e){var n,r,o,i,s,a,u,l,c,_,h,d,p,f,m,g,v;for(_=e.split("\n"),h={},o=0,s=t.length;s>o;o++)v=t[o],h[v]=!1;for(c=i=0,a=_.length;a>i;c=++i)l=_[c],p=l.indexOf(":"),-1!==p&&(f=l.substring(0,p).split("-"),r=parseInt(f[0],10),n=l.substring(p+1),v=t[r],h[v]=!0,this._call_callback(v,n),"function"==typeof this.batch_logger&&this.batch_logger(c,t.length));for("function"==typeof this.on_batch_success&&this.on_batch_success(t),m=t.filter(function(t){return!h[t]}),g=[],d=0,u=m.length;u>d;d++)v=m[d],g.push(null==this.cancelled_urls[v]?this._call_callback(v,v):void 0);return g},o.prototype._error=function(t){var e,n,r,o;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],r.push(this._call_callback(o,o));return r},o.prototype._complete=function(t){var e,n,r,o,i,s;for(this.num_requests_in_flight--,r=this.outstanding_batches[t],s=r.urls,o=r.request,e=0,n=s.length;n>e;e++)i=s[e],delete this.cancelled_urls[i];return delete this.outstanding_batches[t],this.flushing?this._send_batch_requests():void 0},o.prototype._call_callback=function(t,e){var n,r,o,i,s;if(n=0===e.indexOf("data:image")?e:t,null!=this.request_ids_by_url[t])for(i=this.request_ids_by_url[t],r=0,o=i.length;o>r;r++)s=i[r],this.callback_by_id[s].callback(n,!1),delete this.callback_by_id[s];return delete this.request_ids_by_url[t]},o.prototype._generate_request_params=function(e){var o,i,s,a,u,l,c,_;return c=t.map(e,function(t){return n.parse(t).setScheme().setAuthority().toString()}),_=JSON.stringify(c),a=Math.abs(this._hash_string_to_int(_)),i=a%r.BATCH_THUMB_ENDPOINTS.length,o=r.BATCH_THUMB_ENDPOINTS[i],l={image_urls:_,parallel:!0},s=n.parse(o).setQuery(l).toString(),u=s.length>this.MAX_URL_LENGTH?"POST":"GET",[o,u,l]},o.prototype._hash_string_to_int=function(t){var e,n,r,o,i;if(n=0,0===t.length)return n;for(r=o=0,i=t.length;i>=0?i>o:o>i;r=i>=0?++o:--o)e=t.charCodeAt(r),n=(n<<5)-n+e;return n},o}()})}.call(this),function(){define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(t,e,n){var r;return r={MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(r,o,i,s){var a,u,l,c,_,h,d,p,f,m,g;for(g=t.grep(r,function(e){return t(e).data("src")}),this.img_map={},_=0,d=g.length;d>_;_++)l=g[_],f=String(t(l).data("src")),null==(u=this.img_map)[f]&&(u[f]=[]),this.img_map[f].push(l);for(this.instance?this.instance.reset({batch_size:o,batch_logger:s}):this.instance=new e({batch_size:o,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:function(e){return function(n){var r,o,i,s,a;for(s=[],o=0,i=n.length;i>o;o++)a=n[o],r=t(e.img_map[a]),r.data("src",null),s.push(r.data("loading-src",a));return s}}(this),batch_logger:s}),c=[],h=0,p=g.length;p>h;h++)l=g[h],a=t(l),m=a.data("src"),this.instance.queue_thumb(m,function(t,e,r,o){return o||e.data("loading-src")?(e.data("loading-src",null),0===r.indexOf("data:image")?(e.attr("src",r),"function"==typeof i?i(e[0]):void 0):(e.error(function(){return e.attr("src",e.data("fail-src")||n.SPACER)}),e.load(function(){return"function"==typeof i?i(e[0]):void 0}),e.attr("src",r))):void 0}.bind(this,m,a));return this.instance.flush(),g.length},clear_all_pending_batches:function(){var t;return null!=(t=this.instance)?t.clear():void 0}}})}.call(this),function(){define("modules/clean/profile_services/profile_services_constants",["modules/core/exception","modules/core/i18n"],function(t,e){var n,r,o;return o=t.assert,r=e._,n={GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",NEVER_CONNECTED:0,WAS_CONNECTED:1,IS_CONNECTED:2,VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER,this.YAHOO_LEGACY]},contact_services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK]},to_img:function(t){switch(t){case this.GOOGLE:return["/static/images/contacts/import_icon_gmail-vflFQwVYO.png","/static/images/contacts/import_icon_gmail@2x-vflO2fTFE.png"];case this.YAHOO:case this.YAHOO_LEGACY:return["/static/images/contacts/import_icon_yahoo-vfl5E728M.png","/static/images/contacts/import_icon_yahoo@2x-vflnVdi5R.png"];case this.FACEBOOK:return["/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];default:return o(!1,"Should never get ProfileServicesConstants.to_img with service: "+t)}},to_name:function(t){switch(t){case this.GOOGLE:return r("Gmail");case this.YAHOO:return r("Yahoo! Mail");case this.FACEBOOK:return r("Facebook");case this.VARIOUS:return r("Email");case this.YAHOO_LEGACY:return r("Yahoo! Mail");default:return o(!1,"Should never get ProfileServicesConstants.to_name with service: "+t)}},logging_identifiers:function(t){switch(t){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";case this.YAHOO_LEGACY:return"yahoo_legacy";default:return o(!1,"Should never get ProfileServicesConstants.logging_identifiers with service: "+t)}}}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/clean/profile_services/profile_services_link",["jquery","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/profile_services/profile_services_constants","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(n,r,o,i,s,a,u,l,c){var _,h,d,p;return p=r.assert,d=o._,_=function(){function r(e,r){return this.user_id=e,null==r&&(r=null),this.service_was_connected=t(this.service_was_connected,this),this.service_is_connected=t(this.service_is_connected,this),this.has_unconnected_services=t(this.has_unconnected_services,this),this.has_connected_services=t(this.has_connected_services,this),this.connected_accounts_for_service=t(this.connected_accounts_for_service,this),this.get_or_update_connected_state=t(this.get_or_update_connected_state,this),this._update_on_auth_event=t(this._update_on_auth_event,this),p(this.user_id,"No user id provided"),this._connected_services={},this.is_updated=!1,this.get_or_update_connected_state(!0,r),this._service_change_callbacks={},n(document).on("db:profile_service:auth_complete",this._update_on_auth_event),n(document).on("db:profile_service:deauth_complete",this._update_on_auth_event),this}return r._LINKED_PROFILE_SERVICES={},r.get_linked_profile_services_for_user=function(t,e){var n;return null==e&&(e=null),p(t,"No user_id: LinkedProfileServices.get_linked_profile_services_for_user()"),n=this._LINKED_PROFILE_SERVICES[t],null!=n?n.get_or_update_connected_state(!1,e):(n=new r(t,e),this._LINKED_PROFILE_SERVICES[t]=n),n},r.prototype._update_on_auth_event=function(t){var e,n,r,o;if(t.user_id===this.user_id){this.is_updated=!1,this.get_or_update_connected_state(!0),r=this._service_change_callbacks,o=[];for(n in r)e=r[n],o.push(e(this));return o}},r.prototype.get_or_update_connected_state=function(t,e){return null==t&&(t=!1),null==e&&(e=null),this.is_updated&&!t?"function"==typeof e?e(this):void 0:a.WebRequest({url:"/profile_services/connected_services",subject_user:this.user_id,dataType:"json",success:function(t){return function(n){return t._connected_services=n,t.is_updated=!0,"function"==typeof e?e(t):void 0}}(this)})},r.prototype.connected_accounts_for_service=function(t){return this._connected_services[t]?n.map(this._connected_services[t],function(t){return t.source_id}):[]},r.prototype.has_connected_services=function(){var t,e,n,r;for(n=u.services(),t=0,e=n.length;e>t;t++)if(r=n[t],this.service_is_connected(r))return!0;return!1},r.prototype.has_unconnected_services=function(t){var e,n,r,o;for(null==t&&(t=!1),o=u.services(),t&&(o=u.contact_services()),e=0,n=o.length;n>e;e++)if(r=o[e],r!==u.YAHOO_LEGACY&&!this.service_is_connected(r))return!0;return!1},r.prototype.service_is_connected=function(t){var n,r,o,i;if(p(e.call(u.services(),t)>=0,"Not a valid profile service"),null==this._connected_services[t])return!1;for(i=this._connected_services[t],r=0,o=i.length;o>r;r++)if(n=i[r],n.connection_state===u.IS_CONNECTED)return!0;return!1},r.prototype.service_was_connected=function(t){var n,r,o,i;if(p(e.call(u.services(),t)>=0,"Not a valid profile service"),null==this._connected_services[t])return!1;for(i=this._connected_services[t],r=0,o=i.length;o>r;r++)if(n=i[r],n.connection_state===u.WAS_CONNECTED)return!0;return!1},r.prototype.register_for_service_changes=function(t,e){return this._service_change_callbacks[t]=e},r.prototype.unregister_for_service_changes=function(t){return e.call(Object.keys(this._service_change_callbacks),t)>=0?delete this._service_change_callbacks[t]:void 0},r}(),h=function(){function r(){return this.deauth_login_state_for_service=t(this.deauth_login_state_for_service,this),this.deauth_service=t(this.deauth_service,this),this._redirect_to_identity_provider=t(this._redirect_to_identity_provider,this),this._popup_window=null,this}return r.show_import_notifications=function(t){if(!t.success)return i.error(null!=t.err_msg?t.err_msg:d("There was a problem completing this request."));switch(t.provider){case u.GOOGLE:return i.success(d("Imported Gmail Contacts."));case u.YAHOO:return i.success(d("Imported Yahoo! Mail contacts."));case u.FACEBOOK:return i.success(d("Successfully connected to Facebook."))}},r.prototype._redirect_to_identity_provider=function(t,e,r,o,i,s){var l;return null==r&&(r=null),null==o&&(o=null),null==i&&(i=null),null==s&&(s=!1),l=function(t){return function(e){var r;return t._popup_window===e.popup_window?(n(document).off("db:profile_service:auth_complete",l),null!=(r=t._popup_window)&&r.close(),t._popup_window=null,"function"==typeof o?o(e):void 0):void 0}}(this),n(document).on("db:profile_service:auth_complete",l),a.WebRequest({url:"/profile_services/generate_identity_provider_uri",data:{user_id:r,service:t,is_popup:!0,referrer:i,action:e,remember_me:s},success:function(e){return function(n){var r;return n=JSON.parse(n),r=n.uri,e._popup_window=window.open(String(r),u.to_name(t),"width=600,height=600,resizable=1,scrollbars=1")}}(this),error:function(){return function(){return"do nothing"}}(this)})},r.prototype.auth_service_with_user=function(t,e,n,r){var o;return null==n&&(n=null),null==r&&(r=null),p(t,"No service provided"),p(e,"No user_id provided"),o=c.get_viewer().get_user_by_id(e),p(o,"No user for user_id "+e),this._redirect_to_identity_provider(t,"link_contacts",e,n,r)},r.prototype.auth_service_with_user_for_login=function(t,e,n,r){var o;return null==n&&(n=null),null==r&&(r=null),p(t,"No service provided"),p(e,"No user_id provided"),o=c.get_viewer().get_user_by_id(e),p(o,"No user for user_id "+e),this._redirect_to_identity_provider(t,"link_for_login",e,n,r)},r.prototype.auth_service_create_user_if_needed=function(t,e,n){return null==e&&(e=null),null==n&&(n=null),p(t,"No service provided"),this._redirect_to_identity_provider(t,"create_user",null,e,n)},r.prototype.auth_service_login_user=function(t,e,n,r){return null==e&&(e=null),null==n&&(n=null),null==r&&(r=!1),p(t,"No service provided"),this._redirect_to_identity_provider(t,"login_user",null,e,n,r)},r.prototype.deauth_service=function(t,r,o,i){var s,l;return null==o&&(o=null),null==i&&(i=null),l=function(){return function(s){return s.service_is_connected(t)?(null!=o&&p(e.call(s.connected_accounts_for_service(t),o)>=0,"Service is not currently connected"),a.WebRequest({url:"/profile_services/unlink",subject_user:r,data:{service:t,source_id:o},success:function(){return n(document).trigger(n.Event("db:profile_service:deauth_complete",{user_id:r})),"function"==typeof i?i(!0):void 0},error:function(){return"function"==typeof i?i(!1):void 0}})):void("function"==typeof i&&i(!0))}}(this),p(e.call(u.services(),t)>=0,"Not a valid profile service"),p(r,"No user_id provided"),r=parseInt(r),s=_.get_linked_profile_services_for_user(r,l)},r.prototype.deauth_login_state_for_service=function(t,r,o,i){var s,l;return null==o&&(o=null),null==i&&(i=null),l=function(){return function(s){return s.service_is_connected(t)?(null!=o&&p(e.call(s.connected_accounts_for_service(t),o)>=0,"Service is not currently connected"),a.WebRequest({url:"/profile_services/disable_login_state",subject_user:r,data:{service:t,source_id:o},success:function(){return n(document).trigger(n.Event("db:profile_service:deauth_complete",{user_id:r})),"function"==typeof i?i(!0):void 0},error:function(){return"function"==typeof i?i(!1):void 0}})):void("function"==typeof i&&i(!0))}}(this),p(e.call(u.services(),t)>=0,"Not a valid profile service"),p(r,"No user_id provided"),r=parseInt(r),s=_.get_linked_profile_services_for_user(r,l)},r}(),{LinkedProfileServices:_,
ProfileServicesLinkingHandler:h}})}.call(this),function(){define("modules/clean/profile_services/third_party_signup",["jquery","modules/clean/ajax","modules/clean/base64","modules/constants/env","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/uri"],function(t,e,n,r,o,i,s,a){var u;return u=function(){function e(){}return e.init=function(t,e,n){return this.handle_picture_url(t,e,n,!0)},e.handle_picture_url=function(e,n,r,o){var s,u;if(s=null,e)try{u=new XMLHttpRequest,u.open("GET",e,!0),u.responseType="blob",u.onload=function(){var e;return 200===u.status?(e=u.getResponseHeader("content-type")||"",s=new Blob([u.response],{type:e}),t("#profile-picture img").attr("src",URL.createObjectURL(s)),t("#profile-picture").show()):void 0},u.send()}catch(t){}return t(document).on("db:register:success",function(t){return function(e,u){var l;return l=function(){var t,e;return o?(e=a.parse(u.redirect_url||"/"),n&&(e=a.parse(n)),t={success:!0},r&&(t.extra_data=r),e.setQuery(t),i.unsafeRedirect(e)):void 0},null!=s?t.upload_account_photo(u.id,s,l):l()}}(this))},e.upload_account_photo=function(t,e,n){var i,u,l;return u=a({authority:r.BLOCK_CLUSTER,path:"/upload_account_photo",query:{t:s.read(o.JS_CSRF_COOKIE),_subject_uid:t}}),i=new FormData,i.append("file",e),l=new XMLHttpRequest,l.open("POST",u,!0),l.withCredentials=!0,l.onload=function(){return n()},l.onerror=function(){return n()},l.send(i)},e}()})}.call(this),function(){define("modules/clean/promise",["external/rsvp","modules/core/exception"],function(t,e){return t.on("error",function(t){var n;return"undefined"!=typeof console&&null!==console&&"function"==typeof console.error&&console.error(null!=(n=null!=t?t.stack:void 0)?n:t),t instanceof Error||(t=new Error(t)),e.reportException({err:t})}),t})}.call(this),function(){define("modules/clean/react/bubble_dropdown",["jquery","external/classnames","external/jquery_ui","external/keymaster","external/react","external/underscore","modules/clean/keycode","modules/core/dom"],function(t,e,n,r,o,i,s,a){var u,l,c,_,h,d;return d=a.getFocusableElementsIn,h=o.DOM,c="react-bubble-dropdown-root",_=function(){var e;return e=t("#"+c),e.length||(e=t('<div tabindex="-1"/>').attr({id:c}).prependTo("body")),e[0]},l=o.createClass({displayName:"BubbleDropdownContents",propTypes:{target_node:o.PropTypes.instanceOf(HTMLElement).isRequired,targetFixed:o.PropTypes.bool.isRequired,label_id:o.PropTypes.string,arrow_position:o.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:o.PropTypes.number,horizontal_displacement:o.PropTypes.number,anchor_bottom:o.PropTypes.bool,show_arrow:o.PropTypes.bool,className:o.PropTypes.string,extra_css_class:o.PropTypes.string},componentDidMount:function(){var e,n,r,o,i,s,a,u,l,_,h,d,p,f,m,g;if(null!=this.refs.dropdown){switch(o=this._arrow_direction(),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[o],r=t(this.props.target_node),n=t(this.refs.dropdown.getDOMNode()),e=t(this.refs.arrow.getDOMNode()),h=t("#"+c).position().top,g=e.outerWidth(),a=e.outerHeight(),d=e.position().top,u=this.props.horizontal_displacement||0,l=e.position().left+u,m=this.props.vertical_displacement||0,p=a+h,this._arrow_direction()){case"left":i=0>p?"left+"+g+"px top+"+-p+"px":"left+"+g+"px top-"+p+"px";break;case"right":i=0>p?"right-"+g+"px top+"+-p+"px":"right-"+g+"px top-"+p+"px";break;case"top":p=a-h-m,i=0>p?"left-"+l+"px top-"+-p+"px":"left-"+l+"px top+"+p+"px";break;case"bottom":s=a+h-m,i=0>s?"left-"+l+"px bottom+"+-s+"px":"left-"+l+"px bottom-"+s+"px"}return f=function(t){return function(e){var n,o,i;return i=e.top,o=e.left,t.props.anchor_bottom?(n=t.props.targetFixed?document.documentElement.clientHeight-r[0].getBoundingClientRect().top-m:document.documentElement.clientHeight-r.offset().top-m,t.setState({dropdown_style:{bottom:n,left:o}})):t.setState({dropdown_style:{top:i,left:o}})}}(this),_={my:i,at:this.target_position,of:r,collision:"none",using:f},n.position(_),n.position(_),t("#"+c).attr("aria-labelledby",this.props.label_id),this.props.show_arrow?void 0:(e.css("visibility","hidden"),t(".bubble-arrow-border").css("visibility","hidden"))}},render:function(){return this.state.dropdown_style.display="right"===this._arrow_direction()?"block":"inline-block",h.div({className:e("bubble-dropdown",this.props.extra_css_class,this.props.className,this.props.arrow_position),style:this.state.dropdown_style,ref:"dropdown"},this.props.children,h.div({className:"bubble-arrow-border"}),h.div({className:"bubble-arrow",ref:"arrow"}))},_arrow_direction:function(){var t;return"top"===this.props.arrow_position.substring(0,3)?t="top":"bottom"===this.props.arrow_position.substring(0,6)?t="bottom":"left"===this.props.arrow_position.substring(0,4)?t="left":"right"===this.props.arrow_position.substring(0,5)&&(t="right"),t},getInitialState:function(){return{dropdown_style:{}}}}),u=o.createClass({displayName:"BubbleDropdown",propTypes:{targetButton:function(t){return null==t.targetButton||"button"!==t.targetButton.type?new Error("BubbleDropdown's targetButton must be a `<button>`"):void 0},targetFixed:o.PropTypes.bool,arrow_position:o.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:o.PropTypes.number,horizontal_displacement:o.PropTypes.number,show_arrow:o.PropTypes.bool,anchor_bottom:o.PropTypes.bool,className:o.PropTypes.string,extra_css_class:o.PropTypes.string,bubbleDropdownShown:o.PropTypes.func,bubbleDropdownHidden:o.PropTypes.func,autofocus:o.PropTypes.bool,position:o.PropTypes.oneOf(["static","relative","fixed","absolute"]),bubbleDropdownScrollable:o.PropTypes.bool,shouldDisableBubbleDropdownHideOnResize:o.PropTypes.bool},getDefaultProps:function(){return{vertical_displacement:0,horizontal_displacement:0,anchor_bottom:!1,show_arrow:!0,className:null,extra_css_class:"",position:"fixed",autofocus:!1,targetFixed:!1,bubbleDropdownScrollable:!1}},render:function(){return h.span({className:"bubble-dropdown-container",onMouseDown:this.preventSelection,onMouseUp:this.toggle,onKeyDown:this.targetKeyDown,ref:"target",id:this.containerId},this.props.targetButton)},render_tooltip:function(){var e,n;return n=_(),this.shown?(t("#"+c).css("position",this.props.position),this.props.anchor_bottom?(t("#"+c).css("bottom","0"),t("#"+c).css("top","auto")):(t("#"+c).css("top","0"),t("#"+c).css("bottom","auto")),e=o.createElement(l,{target_node:this.getTargetButton(),targetFixed:this.props.targetFixed,label_id:this.containerId,arrow_position:this.props.arrow_position,vertical_displacement:this.props.vertical_displacement,horizontal_displacement:this.props.horizontal_displacement,anchor_bottom:this.props.anchor_bottom,show_arrow:this.props.show_arrow,extra_css_class:this.props.extra_css_class,className:this.props.className},this.props.children),o.render(e,n)):o.unmountComponentAtNode(n)},preventSelection:function(t){return t.preventDefault()},targetKeyUp:function(t){return t.preventDefault()},componentWillMount:function(){return this.eventId=i.uniqueId(),this.containerId="bubbleDropdownTarget"+this.eventId},componentDidMount:function(){return this.shown=!1,this.$target=t(this.refs.target.getDOMNode()),t(this.getTargetButton()).addClass("bubble-dropdown-target").attr("aria-expanded",this.shown),this.bodyClickHandler=function(e){return function(n){var r,o;return e.shown?(r=t(n.target),r.is("select")?!0:(o=r.closest(e.$target).length||r.closest(t("#"+c)).length,o||e.hide(),!0)):void 0}}(this),t("body").on("mouseup."+this.eventId,this.bodyClickHandler)},componentDidUpdate:function(){return t(this.getTargetButton()).addClass("bubble-dropdown-target").attr("aria-expanded",this.shown),this.shown?this.render_tooltip():void 0},bindDocHandlers:function(){return this.hasBindedDocHandlers?void 0:(key("esc",this.hideIfShown),this.props.bubbleDropdownScrollable?t("*").not("#"+c+" *").on("scroll."+this.eventId,this.hideIfShown):t("*").on("scroll."+this.eventId,this.hideIfShown),t(window).on("scroll."+this.eventId,this.hideIfShown),this.props.shouldDisableBubbleDropdownHideOnResize||t(window).on("resize."+this.eventId,this.hideIfShown),t("#"+c).on("keydown",this.dropdownKeyDown),this.hasBindedDocHandlers=!0)},unbindDocHandlers:function(){return this.hasBindedDocHandlers?(t("body").off("mouseup."+this.eventId),t("*").off("scroll."+this.eventId),t(window).off("scroll."+this.eventId),this.props.shouldDisableBubbleDropdownHideOnResize||t(window).off("resize."+this.eventId),t("#"+c).off("keydown",this.dropdownKeyDown),this.hideIfShown()):void 0},targetKeyDown:function(t){var e;((e=t.keyCode)===s.ENTER||e===s.SPACE)&&(this.toggle(),t.preventDefault()),t.keyCode===s.TAB&&(t.shiftKey?this.hide():this.shown&&(this.focusInDropdown(),t.preventDefault()))},dropdownKeyDown:function(e){var n,r,o;if(e.keyCode===s.TAB){if(n=t("#"+c)[0],r=this.getFocusableDropdownElements(),e.shiftKey){if((o=e.target)===n||o===r[0])return this.getTargetButton().focus(),e.preventDefault()}else if(e.target===r[r.length-1]||e.target===n&&0===r.length)return this.hide(),this.getTargetButton().focus()}else if(e.keyCode===s.ESC)return this.hide(),this.getTargetButton().focus(),e.stopPropagation()},focusInDropdown:function(){var e;return this.props.autofocus&&(e=this.getFocusableDropdownElements()[0]),e||(e=t("#"+c)[0]),e.focus()},getTargetButton:function(){return this.refs.target.getDOMNode().firstChild},getFocusableDropdownElements:function(){return d("#"+c+" .bubble-dropdown")},hideIfShown:function(){return this.shown?this.hide():void 0},componentWillUnmount:function(){return this.unbindDocHandlers(),t("body").off("mouseup."+this.eventId,this.bodyClickHandler)},toggle:function(){this.shown?this.hide():this.show()},show:function(){var e;return this.shown=!0,t(this.getTargetButton()).addClass("bubble-dropdown-target--active").attr("aria-expanded",!0),this.render_tooltip(),this.focusInDropdown(),"function"==typeof(e=this.props).bubbleDropdownShown&&e.bubbleDropdownShown(),this.bindDocHandlers()},hide:function(){var e;return this.shown=!1,t(this.getTargetButton()).removeClass("bubble-dropdown-target--active").attr("aria-expanded",!1),this.render_tooltip(),"function"==typeof(e=this.props).bubbleDropdownHidden?e.bubbleDropdownHidden():void 0},isShown:function(){return this.shown}})})}.call(this),function(){define("modules/clean/react/form_error_mixin",["external/react"],function(t){var e,n;return n=t.DOM,e={propTypes:{errorWrapperClassName:t.PropTypes.string,"disable-errors":t.PropTypes.bool,"error-after":t.PropTypes.bool,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},renderErrorIfEnabled:function(){return this.props["disable-errors"]?void 0:this.renderError()},renderError:function(){var t,e;return null!=(null!=(t=this.props.error)?t.message_html:void 0)?n.div({className:this.props.errorWrapperClassName,dangerouslySetInnerHTML:{__html:this.props.error.message_html}}):n.div({className:this.props.errorWrapperClassName},null!=(e=this.props.error)?e.message_text:void 0)}}})}.call(this),function(){define("modules/clean/react/input",["external/react","external/underscore","jquery","modules/clean/keycode","modules/clean/react/bubble_dropdown","modules/clean/react/form_error_mixin","modules/clean/react/sprite","modules/core/browser"],function(t,e,n,r,o,i,s,a){var u,l,c;return u=t.addons.classSet,l=t.DOM,c=function(o,c){return t.createClass({displayName:o+"."+c,propTypes:{expandable:t.PropTypes.bool,expandedWidthOffset:t.PropTypes.number,animationCurve:t.PropTypes.string,animationDuration:t.PropTypes.number,onCloseClick:t.PropTypes.func,defaultValue:t.PropTypes.string,value:t.PropTypes.string,autofocus:t.PropTypes.bool,autoresize:t.PropTypes.bool,inline:t.PropTypes.bool,className:t.PropTypes.string,valueLink:t.PropTypes.object,variant:t.PropTypes.string,id:t.PropTypes.string,label:t.PropTypes.string,afterRender:t.PropTypes.func,onClick:t.PropTypes.func,onFocus:t.PropTypes.func,onKeyDown:t.PropTypes.func,onChange:t.PropTypes.func,compatiblePlaceholder:t.PropTypes.bool,placeholder:t.PropTypes.string,measureStrength:t.PropTypes.bool},mixins:[i],getDefaultProps:function(){return{errorWrapperClassName:"text-input-error-wrapper",expandedWidthOffset:90,expandable:!1,animationCurve:"easeOutSine",animationDuration:300,compatiblePlaceholder:!1}},getInitialState:function(){return{inputWidth:0,expanded:!1,value:this.props.defaultValue,compatiblePlaceholderVisible:this.supportsCompatiblePlaceholder()}},supportsCompatiblePlaceholder:function(){return this.props.compatiblePlaceholder&&this.props.placeholder&&a.msie_version_at_most(9)},render:function(){var t,n,r,i,a,_,h,d,p,f,m,g;if(this.props.measureStrength&&require(["external/zxcvbn"]),r={"text-input-input":!0,autofocus:this.props.autofocus,"password-input":"password"===c},i={"text-input":!0,"text-input-expandable":this.props.expandable,"text-input-inline":this.props.inline,"textarea-input":"textarea"===o},i[this.props.variant||"standard"]=!0,null!=this.props.className)for(f=this.props.className.split(/\s/),_=0,d=f.length;d>_;_++)n=f[_],i[n]=!0;return t=e.omit(this.props,"className","onChange","onFocus","onKeyDown","value","valueLink","ref","defaultValue"),h=l[o](e.extend({className:u(r),type:c,value:this.props.value||(null!=(m=this.props.valueLink)?m.value:void 0)||this.state.value,onChange:this.onChangeInternal,onFocus:this.onFocusInternal,onKeyDown:this.onKeyDownInternal,ref:"inputComponent",placeholder:this.props.placeholder||""},t)),p=l.div({className:"password-input-meter",ref:"meter"},l.div({className:"password-input-dot"}),l.div({className:"password-input-dot"}),l.div({className:"password-input-dot"}),l.div({className:"password-input-dot"})),a=this.renderErrorIfEnabled(),l.div({className:u(i)},this.props["error-after"]?void 0:a,l.div({className:"text-input-wrapper"},this.props.measureStrength?p:void 0,h,this.supportsCompatiblePlaceholder()?l.span({ref:"textInputPlaceholder",className:"text-input-placeholder",style:{display:this.state.compatiblePlaceholderVisible?"block":"none"}},this.props.placeholder):void 0,this.props.expandable?l.a({href:"#",onClick:this.onCloseClick,ref:"closeButton",className:"close-button u-mar-left-xs"},s({group:"web",name:"xclose"})):void 0,this.props.value||(null!=(g=this.props.valueLink)?g.value:void 0)||this.state.value?void 0:l.label({htmlFor:this.props.id},this.props.label)),this.props["error-after"]?a:void 0)},getValue:function(){return this.refs.inputComponent.getDOMNode().value},setValue:function(t){return this.refs.inputComponent.getDOMNode().value=t,this.setState({value:t})},resizeComponent:function(){var t,e;return e=this.refs.inputComponent.getDOMNode(),t=n(e),t.css("height","1px"),t.css("height",e.scrollHeight+"px")},_renderFinished:function(){var t,e,r;return this.props.autoresize&&this.resizeComponent(),"function"==typeof(t=this.props).afterRender&&t.afterRender(),this.state.compatiblePlaceholderVisible?(r=n(this.refs.textInputPlaceholder.getDOMNode()),e=n(this.refs.inputComponent.getDOMNode()),r.css({position:"absolute","font-size":e.css("font-size"),color:"#aaa",left:e.css("padding-left"),top:parseInt(e.css("margin-top"))+e.outerHeight()/2-r.outerHeight()/2}),r.click(function(){return e.focus()})):void 0},componentDidMount:function(){var t;return this._renderFinished(),t=this.refs.inputComponent.getDOMNode().offsetWidth,this.setState({inputWidth:t})},componentDidUpdate:function(){return this._renderFinished()},onCloseClick:function(t){var e,r,o;return null!=t&&t.preventDefault(),r=n(this.refs.closeButton.getDOMNode()),o=n(this.refs.inputComponent.getDOMNode()),r.stop().animate({opacity:0},this.props.animationDuration),o.stop().animate({width:this.state.inputWidth},this.props.animationDuration,this.props.animationCurve),"function"==typeof(e=this.props).onCloseClick&&e.onCloseClick(t),this.setState({expanded:!1}),this.supportsCompatiblePlaceholder()?this.setState({compatiblePlaceholderVisible:!0}):void 0},onChangeInternal:function(t){var e,r;return"function"==typeof(e=this.props).onChange&&e.onChange(t),this.props.value||(this.props.valueLink?this.props.valueLink.requestChange(t.target.value):this.setState({value:t.target.value})),this.supportsCompatiblePlaceholder()&&this.setState({compatiblePlaceholderVisible:0===t.target.value.length}),this.props.measureStrength?(r=n(this.refs.meter.getDOMNode()),r.find(".password-input-dot").removeClass("password-input-dot-selected"),r.find(".password-input-dot").slice(4-this._score(t.target.value),4).addClass("password-input-dot-selected")):void 0},_score:function(t){return window.zxcvbn&&t?Math.max(1,zxcvbn(t).score):0},onFocusInternal:function(t){var e,r,o,i,s,a;return"function"==typeof(e=this.props).onFocus&&e.onFocus(t),this.props.expandable!==!1?(s=n(t.target),r=n(this.refs.closeButton.getDOMNode()),i=this.state.inputWidth+this.props.expandedWidthOffset,a=parseInt(s.css("padding-right")),o=i-a+r.width()/2,r.css({left:o}),s.stop().animate({width:i},this.props.animationDuration,this.props.animationCurve,function(t){return function(){return r.stop().animate({opacity:1},t.props.animationDuration)}}(this)),this.setState({expanded:!0})):void 0},onKeyDownInternal:function(t){if(null!=this.state.expanded!=0)switch(t.keyCode){case r.ESC:return t.target.blur(),this.onCloseClick()}}})},{password:c("input","password"),text:c("input","text"),textarea:c("textarea","text")}})}.call(this),function(){var t={}.hasOwnProperty,e=[].slice;define("modules/clean/react/react_i18n",["external/purify","external/react","external/underscore","modules/core/i18n","modules/clean/react/util"],function(n,r,o,i,s){var a,u,l,c,_;return l=r.DOM,c=function(e,n){var r,i,s;if(!o.isEmpty(n)){r={};for(i in n)t.call(n,i)&&(s=n[i],r[i]=o.escape(s));e=e.format(r)}return e},u=r.createClass({displayName:"R_",propTypes:function(){return{project:r.PropTypes.string,comment:r.PropTypes.string}},render:function(){var t,e,r,s,a;if(r=this.props.children,"string"!=typeof r)throw new Error("R_ can only take a single string child");return e=this.props.project||self.project,a=i._(r,{project:e,comment:this.props.comment}),s=o.omit(this.props,"children","project","comment"),t=c(a,s),l.span({dangerouslySetInnerHTML:{__html:n.sanitize(t)}})}}),a=r.createClass({displayName:"RP_",propTypes:function(){return{n:r.PropTypes.number,project:r.PropTypes.string,comment:r.PropTypes.string}},render:function(){var t,a,u,_;if(a=[],"number"!=typeof this.props.n)throw new Error("RP_ requires a number prop for @props.n, got "+this.props.n);return r.Children.forEach(this.props.children,function(t){return a.push(s.getText(t))}),_=i.ungettext.apply(i,e.call(a).concat([this.props.n],[{project:this.props.project,comment:this.props.comment}])),u=o.omit(this.props,"children","n","project","comment"),t=c(_,u),l.span({dangerouslySetInnerHTML:{__html:n.sanitize(t)}})}}),_=function(t){var n,o;return o=r.createFactory(u),n=r.createFactory(a),{R_:function(){var n,r;return r=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],r.project||(r.project=t),o(r,1===n.length?n[0]:n)},RP_:function(){var r,o;return o=arguments[0],r=2<=arguments.length?e.call(arguments,1):[],o.project||(o.project=t),n(o,1===r.length?r[0]:r)}}},{R_:r.createFactory(u),RP_:r.createFactory(a),setReactI18nDefaultProject:_}})}.call(this),function(){define("modules/clean/react/recaptcha_challenge",["jquery","external/react","modules/clean/react/form_error_mixin","modules/clean/react/input","modules/clean/react/react_i18n","modules/clean/static_urls"],function(t,e,n,r,o,i){var s,a,u,l;return l=i.static_url,u=e.DOM,s=o.R_,a=e.createClass({mixins:[n],getDefaultProps:function(){return{public_key:"",errorWrapperClassName:"text-input-error-wrapper",variant:"standard"}},componentDidMount:function(){var e;return e=this.props.public_key,t.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(e,"recaptcha_widget",{theme:"custom"})})},handleReloadLinkClick:function(){return Recaptcha.reload()},handleSwitchTypeToAudioLinkClick:function(){return Recaptcha.switch_type("audio")},handleSwitchTypeToImageLinkClick:function(){return Recaptcha.switch_type("image")},handleHelpLinkClick:function(){return Recaptcha.showhelp()},_renderButtons:function(){return u.div({className:this.props.variant+" recaptcha-buttons"},u.a({className:"recaptcha-button recaptcha-reload",onClick:this.handleReloadLinkClick},u.img({src:l("/static/images/icons/captcha-reload-vflqH90Ce.png")})),u.a({className:"recaptcha-button recaptcha_only_if_image",onClick:this.handleSwitchTypeToAudioLinkClick},u.img({src:l("/static/images/icons/captcha-audio-vfl_VBPgQ.png")})),u.a({className:"recaptcha-button recaptcha_only_if_audio",onClick:this.handleSwitchTypeToImageLinkClick},u.img({src:l("/static/images/icons/captcha-words-vfl-bt9Xw.png")})),u.a({className:"recaptcha-button recaptcha-show-help",onClick:this.handleHelpLinkClick},u.img({src:l("/static/images/icons/captcha-help-vfleUYtSD.png")})))},_renderRecaptchaResponseInput:function(){return r.text({id:"recaptcha_response",name:"recaptcha_response",className:"login-text-input","disable-errors":!0,label:s({},"Type the text")})},_renderDummyInput:function(){return u.input({type:"hidden",id:"recaptcha_response_field"})},_renderStandard:function(){var t;return t=this.renderErrorIfEnabled(),u.div({id:"recaptcha_widget",className:"standard recaptcha-container"},t,u.div({id:"recaptcha_image",className:"standard login-recaptcha-challenge-container"}),this._renderRecaptchaResponseInput(),this._renderButtons(),this._renderDummyInput())},_renderSmall:function(){var t;return t=this.renderErrorIfEnabled(),u.div({id:"recaptcha_widget",className:"small recaptcha-container"},t,u.div({id:"recaptcha_image",className:"small login-recaptcha-challenge-container"}),this._renderButtons(),this._renderRecaptchaResponseInput(),this._renderDummyInput())},render:function(){return"standard"===this.props.variant?this._renderStandard():"small"===this.props.variant?this._renderSmall():void 0},reload:function(t){return this.setProps({error:t}),Recaptcha.reload()}})})}.call(this),function(){define("modules/clean/react/sprite",["external/classnames","external/react","modules/clean/static_urls"],function(t,e,n){var r,o,i,s;return s=n.static_url,i=e.DOM,r=e.PropTypes,o=e.createClass({displayName:"Sprite",propTypes:{group:r.string.isRequired,name:r.string.isRequired,alt:r.string.isRequired,className:r.string,onClick:r.func,onDragStart:r.func,title:r.string,"data-src":r.string},getDefaultProps:function(){return{onClick:function(){},onDragStart:function(){}}},render:function(){var e;return e=this.props.alt||"",i.img({className:t(["sprite","sprite_"+this.props.group,"s_"+this.props.group+"_"+this.props.name,this.props.className]),src:s("/static/images/icons/icon_spacer-vflN3BYt2.gif"),"data-src":this.props["data-src"],onClick:this.props.onClick,onDragStart:this.props.onDragStart,alt:e,title:this.props.title})}})})}.call(this),function(){var t=[].slice,e={}.hasOwnProperty;define("modules/clean/react/util",["external/react","external/underscore","modules/clean/promise"],function(n,r,o){var i,s,a,u,l;return i=o.Promise,s=function(t){var e;return"string"==typeof t?t:"string"==typeof t.props?t.props:t.props.text?t.props.text:(e=[],n.Children.forEach(t.props.children,function(t){return e.push(s(t))}),e.join(""))},u=function(t,e,r){var o,i;return e(t)?r(t):(o=!1,i=[],n.Children.forEach(t.props.children,function(){return function(t){var n;return n=u(t,e,r),i.push(n),n!==t?o=!0:void 0}}(this)),o?n.addons.cloneWithProps(t,{children:i}):t)},a=function(){var n,r,o,i,s,a,u,l;for(n=1<=arguments.length?t.call(arguments,0):[],a={},r=[],o=0,s=n.length;s>o;o++){u=n[o];for(i in u)e.call(u,i)&&(l=u[i],"className"===i?r.push(l):a[i]=l)}return null!=r.length&&(a.className=r.join(" ")),a},l=function(t,e){return new i(function(n){return t.setState(e,n)})},{getText:s,mergeProps:a,replaceSubtree:u,setStatePromise:l}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/register_form",["jquery","external/cyfd","external/underscore","modules/clean/ajax","modules/clean/captcha","modules/clean/components/ajax_form","modules/clean/em_string","modules/clean/mailcheck","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,n,r,o,i,s,a,u,l,c,_,h,d,p){var f,m,g,v;return f=c.ProfileServicesLinkingHandler,v=h._,g=function(){function t(t,r,o){var s;this.$form=e(r),this.$captcha_component=new i(this.$form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_business_signup_captcha","email",t),o&&(s={message_text:o}),this.$captcha_component.captcha_display_handler(s),this.$form.on("submit",function(){return function(){return n.cfsubmit()}}(this))}return t}(),m=function(){function o(n,r,c,h,m,g,w,b){var y,x,E,S,k,R;this.$register_form_container=n,this.can_redirect=c,this.show_form=h,this.client_side_validation=m,this.custom_error_handler=g,this.combined_name=w,this.last_name_goes_first=b,this._combined_name_handler=t(this._combined_name_handler,this),this._index_error_handler=t(this._index_error_handler,this),this._animate_form=t(this._animate_form,this),this._on_register_error=t(this._on_register_error,this),this._on_register_success=t(this._on_register_success,this),this.$register_form=this.$register_form_container.find(".register-form"),S={client_side_validation:this.client_side_validation,error_handler:!1},"index"===this.custom_error_handler&&(S.error_handler=this._index_error_handler,this.$register_form.on("click change","input",this._index_clear_error_handler)),this.combined_name===!0&&this._combined_name_handler(),this.register_controller=new s(this.$register_form,this._cyberfend_submit,S),this.cont=this.$register_form.find("input[name='cont']").val(),this.$register_form.find(".login-button, .auth-google").prop("disabled",!1),this.$register_form.find(".login-button.disabled-button").prop("disabled",!0),this.$captcha_component=new i(this.$register_form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_signup_captcha","email",r),y=this.$register_form.find("label[for='tos_agree']"),E=parseInt(y.css("font-size")),R=200,new a(y.text()).length*E>R&&this.$register_form.find(".checkbox").removeClass("checkbox-inline"),this.$register_form.on(s.SUCCESS_EVENT,this._on_register_success),this.$register_form.on(s.ERROR_EVENT,this._on_register_error),this.show_form?(x=this.$register_form.find("input[type='hidden'][name='is_third_party_auth']").val(),x&&(k=function(t,n){return!e(n).val()},this.$register_form_container.find("input").filter(":visible").filter(k).first().focus()),this.$register_form.is(":visible")&&this.$captcha_component.captcha_display_handler()):this.$register_form.find(".login-button").on("click",function(t){return function(e){return t.$register_form_container.hasClass("form_shown")?void 0:(e.preventDefault(),t._animate_form())}}(this)),this.$register_form.find(".auth-google").click(function(t){return function(){var n,r;return n=function(n){var r;return n.success?(r={fname:n.profile.given_name,lname:n.profile.family_name,email:n.profile.email,picture_url:n.profile.picture_url,email_sig:n.email_sig,refresh_token:n.refresh_token,extra_data:n.extra_data,signup_tag:t.$register_form.find("input[type='hidden'][name='signup_tag']").val(),cont:t.$register_form.find("input[type='hidden'][name='cont']").val(),k:t.$register_form.find("input[type='hidden'][name='k']").val(),eh:t.$register_form.find("input[type='hidden'][name='eh']").val()},t.$register_form.trigger(o.NEW_ACCOUNT_FROM_3RD_PARTY,r),t.can_redirect?_.redirect(p({path:"/third_party_signup",query:r})):void 0):"user_exists"===n.err_msg?(d.error(v("This email address is already taken. Please sign in.")),n=e.Event(o.USER_EXISTS,{focus:"input[name=login_password]",prefill:{".login-email":n.profile.email,"input[type='hidden'][name=refresh_token]":n.refresh_token,"input[type='hidden'][name=email_sig]":n.email_sig}}),e(t.$register_form).trigger(n)):d.error(v("Sorry, we couldnt link to Google. Please refresh the page to try again."))},r=new f,r.auth_service_create_user_if_needed(l.GOOGLE,n,"register_form")}}(this)),"small"===r?(this.$register_form.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$register_form.find(".password-input-meter").css({cursor:"default"})):new u(this.$register_form.find(".input-email"),this.$register_form.find(".email-suggestion"),{livecheck:!1})}return o.REGISTER_SUCCESS="db:register:success",o.NEW_ACCOUNT_FROM_3RD_PARTY="db:register:new_account_from_3rd_party",o.USER_EXISTS="db:register:user_exists",o.prototype._cyberfend_submit=function(){return n.cfsubmit()},o.prototype._on_register_success=function(t,e){if(this.$register_form.trigger(o.REGISTER_SUCCESS,e),this.can_redirect){if(this.cont)return _.redirect(this.cont);if(e.redirect_url)return _.redirect(e.redirect_url)}},o.prototype._on_register_error=function(t,e){return this.$captcha_component.captcha_display_handler(null!=e?e.recaptcha_response:void 0)},o.prototype._animate_form=function(){return this.$register_form_container.hasClass("form_shown")?void 0:e.when(this.$register_form_container.animate({height:this.$register_form.height()},{easing:"easeInOutCubic",duration:500})).done(function(t){return function(){return t.$register_form_container.addClass("form_shown"),t.$register_form_container.filter(":input").filter(":visible").first().focus(),t.$captcha_component.captcha_display_handler()}}(this))},o.prototype.fill=function(t){return r.each(t,function(t){return function(e,n){return t.$register_form.find("[name="+n+"]").val(e)}}(this))},o.prototype._index_error_handler=function(t){var n,r,o,i;this.$register_form_container.find(".register-form__errors").remove(),n=e("<ul />").addClass("register-form__errors");for(o in t)r=t[o],i=r.message_text||r.message_html,e("<li />").addClass("register-form__error").html(i).appendTo(n),this.$register_form.find(".input-"+o).addClass("text-input--error"),"tos_agree"===o&&this.$register_form.find(".checkbox-inline.agree").addClass("checkbox-inline--error"),this.combined_name&&"fname"===o&&(this.$register_form.find(".input-fullname").addClass("text-input--error"),this.$register_form.find("input[name='fullname']").addClass("input-error")),this.$register_form.find("input[name='"+o+"']").addClass("input-error");return this.$register_form_container.append(n)},o.prototype._index_clear_error_handler=function(t){var n;return n=e(t.target),n.removeClass("input-error"),"checkbox"===n.attr("type")?n.parents(".checkbox-inline--error").removeClass("checkbox-inline--error"):n.parents(".text-input--error").removeClass("text-input--error")},o.prototype._combined_name_handler=function(){var t,e,n,r;return t=this.$register_form_container.find('input[name="fullname"]'),e=this.$register_form_container.find('input[name="fname"]'),n=this.$register_form_container.find('input[name="lname"]'),r=this.last_name_goes_first,t.on("change",function(){var t;if(t=this.value.split(" "),r!==!0){if(e.val(t[0]),void 0!==t[t.length-1]&&t[t.length-1]!==t[0])return n.val(t[t.length-1])}else if(n.val(t[0]),void 0!==t[t.length-1]&&t[t.length-1]!==t[0])return e.val(t[t.length-1])})},o}(),{RegisterNamesAndCredentialsWithCaptcha:g,RegisterForm:m}})}.call(this),function(){define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(t,e){var n;return n=function(){function n(){t("#broken-share-article").on("click",function(){return e.WebRequest({url:"/shared_link_error_log",data:{evt:r}})})}var r;return r="click-sharing-article",n}()})}.call(this),function(){define("modules/clean/sprite",["jquery","modules/core/html"],function(t,e){var n;return n={SPACER:"/static/images/icons/icon_spacer-vflN3BYt2.gif",
CLASS_PREFIX:"s_",_make_class:function(t,e){return this.CLASS_PREFIX+t+"_"+e},src:function(e,n,r){return this.clear(e),t(e).addClass(this._make_class(n,r))},replace:function(e,n,r,o){return t(e).removeClass(this._make_class(n,r)).addClass(this._make_class(n,o))},clear:function(e){var n;return n=e.className.split(" "),n=t.grep(n,function(t){return function(e){return e&&0!==e.indexOf(t.CLASS_PREFIX)}}(this)),e.className=n.join(" ")},make:function(e,n,r){var o;return r=this._prep_attrs(e,n,r),o=t("<img />",r),o[0]},html:function(t,n,r){var o,i;r=this._prep_attrs(t,n,r),o=["<img "];for(i in r)o.push(i,'="',e._raw_escape(r[i]),'" ');return o.push("/>"),new e(o.join(""))},_prep_attrs:function(t,e,n){var r;return null==n&&(n={}),n.src=n.src||this.SPACER,r=["sprite","sprite_"+t,this._make_class(t,e)],n.class&&r.push(n.class),n.class=r.join(" "),n},_get:function(t){return t.className},_set:function(t,e){return t.className=e,t.src=this.SPACER}}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(e){var n;return n=function(){function n(e,n,r){this.$email_input=e,this.show_sso_fn=n,this.hide_sso_fn=r,this._check_sso_state=t(this._check_sso_state,this),this._check_sso_state(),this.$email_input.on("input keyup change",this._check_sso_state)}return n._sso_check_in_flight={},n._sso_check_cache={},n.prototype._check_sso_state=function(){var t,r,o;return o=this.$email_input.val(),r=o.trim(),r.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(t=r.toLowerCase(),t in n._sso_check_cache?this._handle_sso_state(n._sso_check_cache[t]):n._sso_check_in_flight[t]?void 0:(n._sso_check_in_flight[t]=!0,e.WebRequest({url:"/sso_state",data:{email:r},success:function(e){return function(r){return r=JSON.parse(r),delete n._sso_check_in_flight[t],n._sso_check_cache[t]=r.user_sso_state,e.$email_input.val()!==o?e._check_sso_state():e._handle_sso_state(r.user_sso_state)}}(this),error:function(e){return function(){return delete n._sso_check_in_flight[t],e.hide_sso_fn()}}(this)}))):this.hide_sso_fn()},n.prototype._handle_sso_state=function(t){return"required"===t?this.show_sso_fn(!1):"optional"===t?this.show_sso_fn(!0):this.hide_sso_fn()},n}()})}.call(this),function(){define("modules/clean/static_urls",["modules/clean/filepath","modules/constants/env","modules/core/exception","modules/core/uri"],function(t,e,n,r){var o,i,s,a;return s=t.filename_without_extension,i=t.file_extension,o=n.assert,a=function(t){var n,a;return o(0===t.indexOf("/static/"),t+" is not a /static url"),e.IS_PROD||-1!==t.indexOf("-vfl")||(n=s(t),a=i(t,!0),t=a?n+"-vflDEVHASH."+a:n+"-vflDEVHASH"),r({scheme:"https",authority:e.CDN_HOST,path:t}).toString()},{static_url:a,UrlConstants:{MOXIE_SWF_URL:a("/static/swf/Moxie-vflz978zN.swf")}}})}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;define("modules/clean/storage",[],function(){var e,n,r;return e=function(){function t(){}return t.storage=void 0,t.get=function(t){return this.storage&&window.JSON?JSON.parse(this.storage.getItem(t)):void 0},t.set=function(t,e){var n,r;if(this.storage&&window.JSON)try{return this.storage.setItem(t,JSON.stringify(e))}catch(t){if(n=t,!(n instanceof DOMException&&22===n.code))throw n}},t}(),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.storage=function(){try{return window.sessionStorage}catch(t){}}(),n}(e),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.storage=function(){try{return window.localStorage}catch(t){}}(),n}(e),{SessionStorage:r,LocalStorage:n}})}.call(this),function(){define("modules/clean/string",[],function(){var t,e,n;return e=function(t){return t.slice(0,1).toUpperCase().concat(t.slice(1).toLowerCase())},n=function(t,n){return null==n&&(n=" "),t.split(n).map(e).join(n)},t=function(t){return t=t.replace(/(\-\w)/g,function(t){return t[1].toUpperCase()}),t.slice(0,1).toUpperCase()+t.slice(1)},{toTitleCase:e,toWordTitleCase:n,lispToPascalCase:t}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/uirequest",["jquery","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/css","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(e,n,r,o,i,s,a){var u,l;return u=a.DBModal,l=function(){function a(e,n,r){return this.$node=e,this.url=n,this.options=null!=r?r:{},this.complete=t(this.complete,this),this.handle_errors=t(this.handle_errors,this),this.error=t(this.error,this),this.perform_actions=t(this.perform_actions,this),this.success=t(this.success,this),this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading")?!1:(this.$node.addClass("ajax-loading"),void new o.FormWebRequest({url:this.url,type:null!=this.options.type?this.options.type:void 0,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user}))}return a.prototype.success=function(t,e,n){var r,o,a;return(a=s.extract_errors(n.responseText))?(this.handle_errors(a),void("function"==typeof(r=this.options).error&&r.error(n,e))):(t=JSON.parse(n.responseText),t.redirect?void(window.location.href=t.redirect):t.reload?void window.location.reload():(this.shouldDelayComplete=t.js||t.css,this.shouldDelayComplete?i.require_css_multi(t.css,function(r){return function(){var o,i;return r.perform_actions(t.actions||[]),"function"==typeof(o=r.options).success&&o.success(t,e,n),r.$node.removeClass("ajax-loading"),"function"==typeof(i=r.options).complete?i.complete(n,e):void 0}}(this)):(this.perform_actions(t.actions||[]),void("function"==typeof(o=this.options).success&&o.success(t,e,n)))))},a.prototype.perform_actions=function(t){var o,i,s,a,l,c,_,h,d,p,f,m;for(p=[],l=0,c=t.length;c>l;l++)switch(i=t[l],a=i[0],s=i[1],m=i[2],o=this.$node,m&&"modal"!==a&&("^"===m.charAt(0)&&(h=m.split(" "),o=o.closest(h[0].substr(1)),m=h.slice(1).join(" ")),m&&(o=o.find(m).filter(":first"))),a){case"modal":d="db-modal-response-modal-placeholder",e("#"+d).remove(),f=e(s),f.attr("id",d),e("body").append(f),_=new u({element_id:"response-modal-placeholder"}),p.push(_.show());break;case"html":p.push(o.html(s));break;case"replaceWith":p.push(o.replaceWith(s));break;case"after":p.push(s?o.after(s):void 0);break;case"before":p.push(s?o.before(s):void 0);break;case"toggleClass":p.push(o.toggleClass(s));break;case"addClass":p.push(o.addClass(s));break;case"removeClass":p.push(o.removeClass(s));break;case"notify":p.push(r.success(s));break;case"notifyError":p.push(r.error(new n(s),this.options.errorDuration||null));break;default:p.push(void 0)}return p},a.prototype.error=function(t,e,n){var r,o;return o=s.extract_errors(t.responseText),"abort"!==e&&this.handle_errors(o),"function"==typeof(r=this.options).error?r.error(t,e,n):void 0},a.prototype.handle_errors=function(t){var e;return t===!1?r.error():"string"==typeof t?(e=this.options.html_in_error_msg?new n(t):t,r.error(e)):s.fill_errors(this.$node,t)},a.prototype.complete=function(t,e){var n;return this.shouldDelayComplete?void 0:(this.$node.removeClass("ajax-loading"),"function"==typeof(n=this.options).complete?n.complete(t,e):void 0)},a}()})}.call(this),function(){define("modules/clean/undo",["jquery","modules/core/html","modules/core/i18n","modules/core/notify"],function(t,e,n,r){var o,i;return i=n._,o=function(){function e(){}return e.perform_undo=function(){return null!=this.undo_handler?(this.undo_handler(this.undo_info),this.undo_handler=this.undo_info=null):void 0},e.notifyWithUndo=function(n,o,s,a){var u,l;return a=a||30,o?(this.undo_info=o,this.undo_handler=s,u=t("<span />"),null!=n.toHTML?u.html(n.toHTML()):u.text(n),l=t('<button class="button-as-link"/>').text(i("Undo")),l.on("click",function(t){return t.preventDefault(),e.perform_undo(),r.clear()}),u.append("&nbsp;").append(l),this.undo_notification=r.success(u,a)):r.success(n)},e}()})}.call(this),function(){define("modules/clean/upsell/ha",["modules/clean/upsell/upsell_controller"],function(t){var e;return e=function(){function e(e,n){var r;this.$ha=e,this.options=n,this.$ha.find(".dismiss-button").on("click",function(t){return function(){return t.$ha.hide()}}(this)),r=new t(this.$ha.find(".confirm-button"),this.$ha.find(".dismiss-button"),this.options),r.log_impression()}return e}()})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/upsell/upsell_controller",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/core/dom","modules/core/exception","modules/core/uri"],function(e,n,r,o,i,s){var a,u,l,c,_;return a=n.AuthenticatedRequest,u=r.DBModal,l=r.DBModalStack,_=i.assert,c=function(){function n(r,o,i){this.options=i,this.post_confirm=t(this.post_confirm,this),this.post_dismiss=t(this.post_dismiss,this),this.confirm=t(this.confirm,this),this.dismiss=t(this.dismiss,this),this._dismissUrl=t(this._dismissUrl,this),this._confirmUrl=t(this._confirmUrl,this),this._keydown=t(this._keydown,this),r.length>0&&r.one("click",this.confirm),o.length>0&&o.one("click",this.dismiss),this.options.dismissWithKeys&&e(document).on("keydown",this._keydown),n.add_tk_params(r,{addTkParams:this.options.addTkParams,campaignName:this.options.campaignName,campaignLocationId:this.options.campaignLocationId})}return n.ON_SHOW_EVENT_NAME="db:prompt:show",n.ON_CONFIRM_EVENT_NAME="db:prompt:confirm",n.ON_DISMISS_EVENT_NAME="db:prompt:dismiss",n.PRE_CONFIRM_EVENT_NAME="db:prompt:pre-confirm",n.PRE_DISMISS_EVENT_NAME="db:prompt:pre-dismiss",n.prototype._keydown=function(t){return 27===t.keyCode||8===t.keyCode&&!o.focus_in_input()?(t.preventDefault(),e(document).off("keydown",this._keydown),this.dismiss(t)):void 0},n.prototype._campaignUrl=function(t){var e;return this.options&&this.options.campaignId?(e=s({path:t}).updateQuery({campaign_id:this.options.campaignId}),e.toString()):void 0},n.prototype._confirmUrl=function(){return this._campaignUrl("/upsell/confirm")},n.prototype._dismissUrl=function(){return this._campaignUrl("/upsell/dismiss")},n.prototype._confirmOrDismiss=function(t,n,r,o){return"keydown"===t.type||r||(t.stopImmediatePropagation(),t.preventDefault()),a({type:"POST",url:n,success:function(n){return function(){return"keydown"===t.type||r||t.target.click(),e(document).trigger(o,{campaignName:n.options.campaignName})}}(this)})},n.prototype.dismiss=function(t){var r;return r=this._dismissUrl(),r&&this._confirmOrDismiss(t,r,!1,n.ON_DISMISS_EVENT_NAME),e(document).trigger(n.PRE_DISMISS_EVENT_NAME,{campaignName:this.options.campaignName})},n.prototype.confirm=function(t){var r;return r=this._confirmUrl(),r&&this._confirmOrDismiss(t,r,this.options.confirmInNewTab,n.ON_CONFIRM_EVENT_NAME),e(document).trigger(n.PRE_CONFIRM_EVENT_NAME,{campaignName:this.options.campaignName})},n.prototype.log_impression=function(){var t;return t=this._campaignUrl("/upsell/log_impression"),t?a({type:"POST",url:t}):void 0},n.prototype.log_event=function(t){var e;return this.options&&this.options.campaignId?(e=s({path:"/upsell/log_event"}).updateQuery({event_name:t,campaign_id:this.options.campaignId}),a({type:"POST",url:e.toString()})):void 0},n.prototype.post_dismiss=function(){var t;return t=this._dismissUrl(),t?a({type:"POST",url:t}):void 0},n.prototype.post_confirm=function(){var t;return t=this._confirmUrl(),t?a({type:"POST",url:t}):void 0},n.add_tk_params=function(t,n){return n.addTkParams?(_(n.campaignName),_(n.campaignLocationId),t.each(function(t,r){var o,i,a;return o=e(r),o.is("a")?a="href":(o=o.closest("form"),a="action"),o.length>0?(i=s.parse(o.attr(a)),i.updateQuery({_tk:n.campaignLocationId,_camp:n.campaignName}),o.attr(a,i.toString())):void 0})):void 0},n.register_custom_controller=function(t,r,o,i,s){return e(document).on(n.ON_SHOW_EVENT_NAME,t),e(document).on(n.ON_CONFIRM_EVENT_NAME,r),e(document).on(n.ON_DISMISS_EVENT_NAME,o),e(document).on(n.PRE_CONFIRM_EVENT_NAME,i),e(document).on(n.PRE_DISMISS_EVENT_NAME,s)},n}()})}.call(this),function(){var t={}.hasOwnProperty;define("modules/clean/user",[],function(){var e;return e=function(){function e(e){var n;for(n in e)t.call(e,n)&&"string"==typeof n&&"_"!==n[0]&&(this[n]=e[n])}return e.prototype.toString=function(){return String(this.id)},e}()})}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty,n=[].slice;define("modules/clean/validators/validators",["jquery","external/underscore","modules/core/i18n"],function(e,r,o){var i,s,a,u,l,c,_,h,d,p,f,m,g;return h=o._,d={},m=function(t,e){return d[t]=e},f=function(t){var e,n,r;if(r=t[0],n=t.slice(1),!d[r])throw new Error("Cannot find validator of type "+r);return e=d[r],function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(e,n,function(){})},_=function(){function t(t){this.messages=r.extend({},this.constructor.messages,null!=t?t.messages:void 0)}return t}(),s=function(e){function o(){var t,e,i;i=1<=arguments.length?n.call(arguments,0):[],e=null,r.isArray(r.last(i))||(e=r.last(i),i=r.initial(i)),this.validators=function(){var e,n,r;for(r=[],e=0,n=i.length;n>e;e++)t=i[e],null!==t&&r.push(f(t));return r}(),o.__super__.constructor.call(this,e)}return t(o,e),o.prototype.validate=function(t,e){var n,r,o,i,s;for(o=this.validators,i=[],n=0,r=o.length;r>n;n++)s=o[n],i.push(s.validate(t,e));return i},o}(_),m("AllValidator",s),i=/^[\x00-\x7f]*$/,a=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.messages={asciiOnly:h("Only basic ASCII characters allowed")},n.prototype.validate=function(t){if(!i.test(t))throw new Error(this.messages.asciiOnly)},n}(_),m("AsciiOnlyValidator",a),c=function(n){function r(t){r.__super__.constructor.call(this,t),this.not_empty=t.not_empty,this.strip=t.strip}return t(r,n),r.messages={empty:h("Please enter a value for %(field)s")},r.prototype.validate=function(t,n){if(this.strip&&(t=e.trim(t)),this.not_empty&&!t)throw new Error(this.messages.empty.format({field:null!=n?n.field:void 0}))},r}(_),m("StringValidator",c),l=function(e){function n(t){n.__super__.constructor.call(this,t),this.lastname_goes_first=null!=t?t.lastname_goes_first:void 0}return t(n,e),n.messages={empty:h("Please enter your name")},n.prototype.validate=function(t,e){var n;if(!e.data.lname&&!e.data.fname)if(this.lastname_goes_first){if("lname"===e.field)throw new Error(this.messages.empty)}else if("fname"===e.field)throw new Error(this.messages.empty);return"fname"===e.field?(n=f(["StringValidator",{not_empty:!0,strip:!0,messages:{empty:h("Please enter your first name")}}]),n.validate(t,e)):void 0},n}(_),m("NameValidator",l),u=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.messages={empty:h("Please enter an email address"),noAt:h("An email address must contain a single @"),badUsername:h("The username portion of the email address is invalid (the portion before the @: %(username)s)"),badDomain:h("The domain portion of the email address is invalid (the portion after the @: %(domain)s)")},r.username_re=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,r.domain_re=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i"),r.prototype.validate=function(t){var n,o,s;if(t=e.trim(t),!t)throw new Error(this.messages.empty);if(o=t.split("@"),2!==o.length)throw new Error(this.messages.noAt);if(s=o[0],n=o[1],!r.username_re.test(s))throw new Error(this.messages.badUsername.format({username:s}));if(i.test(n)&&!r.domain_re.test(n))throw new Error(this.messages.badDomain.format({domain:n}))},r}(_),m("EmailValidator",u),p=function(t){return function(e,n){var r;r=!0;try{t.validate(e,n)}catch(t){r=!1}return r}},g={create:f,register:m,check:p}})}.call(this),function(){var t={}.hasOwnProperty;define("modules/clean/viewer",["modules/constants/viewer","modules/core/exception","modules/core/i18n","modules/clean/user"],function(e,n,r,o){var i,s,a;return a=n.assert,s=r._,i=function(){function n(e){var n,r,i,s,a,u;for(null==e&&(e={}),this._authed_users={},this._all_users={},a=e._user_data||[],n=0,i=a.length;i>n;n++)u=a[n],s=new o(u),this._all_users[s.id]=s,u._authed&&(this._authed_users[s.id]=s);for(r in e)t.call(e,r)&&"string"==typeof r&&"_"!==r[0]&&(this[r]=e[r]);this.is_signed_in=a.length>0,this.is_paired=a.length>1,this.deprecated_first_user_in_the_cookie_id&&(this.deprecated_first_user_in_the_cookie=this.get_user_by_id(this.deprecated_first_user_in_the_cookie_id),delete this.deprecated_first_user_in_the_cookie_id),this._load_cached_users()}return n._cached_viewer=null,n.get_viewer=function(){var t;return this._cached_viewer||(t=e._viewer_properties,this._cached_viewer=new n(t)),this._cached_viewer},n.get_role_title=function(t){var e;return e=this.get_viewer(),e.get_title_by_role(t.role)},n.get_root_name=function(t){var e;return e=this.get_viewer(),e.get_root_name_by_role(t.role)},n.prototype.get_user_by_role=function(t,e){var n;return n=this.get_uid_by_role(t),void 0===n?void 0:this.get_user_by_id(n,e)},n.prototype.role_exists=function(t){return void 0!==this.get_uid_by_role(t)},n.prototype.get_user_by_id=function(t,e){var n,r;return a(this.is_uid_associated(t),"User "+t+" is not associated with this viewer"),r=e?this._all_users:this._authed_users,n=r[t],a(n,"User "+t+" is not signed in"),n},n.prototype.is_role_signed_in=function(t){return this.get_uid_by_role(t)in this._authed_users},n.prototype.is_uid_signed_in=function(t){return t in this._authed_users},n.prototype.is_user_signed_in=function(t){return!(!t||!this.is_uid_signed_in(t.id))},n.prototype.is_uid_associated=function(t){return t in this._all_users},n.prototype.get_users=function(t){var n,r,o,i;return o=t?this._all_users:this._authed_users,i=function(){var t;t=[];for(n in o)r=o[n],t.push(r);return t}(),i.sort(function(t){return t.role===e.ROLE_PERSONAL?-1:1}),i},n.prototype.get_user_ids=function(t){var e;return function(){var n,r,o,i;for(o=this.get_users(t),i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(e.id);return i}.call(this)},n.prototype.get_email_by_role=function(t){var e;return e=this.get_user_by_role(t,!0),e&&e.email},n.prototype.get_uid_by_role=function(t){var n,r,o;t===e.ROLE_PHOTOS&&(t=this._get_photos_role()),n=this._all_users;for(r in n)if(o=n[r],o.role===t)return r;return void 0},n.prototype.get_title_by_role=function(t){return this.is_paired?t===e.ROLE_PERSONAL?s("Personal"):this.team_name:""},n.prototype.get_root_name_by_role=function(t){return this.get_title_by_role(t)||s("Dropbox")},n.prototype._get_photos_role=function(){return this.is_paired||!this.is_signed_in?e.ROLE_PERSONAL:this._values(this._all_users)[0].role},n.prototype._sign_in_all_users=function(){return this._authed_users=this._shallow_clone(this._all_users),this._load_cached_users()},n.prototype._sign_out_user_by_id=function(t){return delete this._authed_users[t],this._load_cached_users()},n.prototype.sign_in_user_by_id=function(t){return a(this.is_uid_associated(t),"User "+t+" is not associated with this viewer"),this._authed_users[t]=this._all_users[t],this._load_cached_users()},n.prototype._values=function(t){var e,n;n=[];for(e in t)n.push(t[e]);return n},n.prototype._shallow_clone=function(t){var e,n;n={};for(e in t)n[e]=t[e];return n},n.prototype._load_cached_users=function(){return this.personal_user=this._authed_users[this.get_uid_by_role(e.ROLE_PERSONAL)],this.photos_user=this._authed_users[this.get_uid_by_role(e.ROLE_PHOTOS)],this.work_user=this._authed_users[this.get_uid_by_role(e.ROLE_WORK)],this.personal_email=this.get_email_by_role(e.ROLE_PERSONAL),this.work_email=this.get_email_by_role(e.ROLE_WORK),this.is_personal_user_signed_in=this.is_role_signed_in(e.ROLE_PERSONAL),this.is_photos_user_signed_in=this.is_role_signed_in(e.ROLE_PHOTOS),this.is_work_user_signed_in=this.is_role_signed_in(e.ROLE_WORK)},n}()})}.call(this),function(){define("modules/clean/web_timing_logger",["jquery","external/react","modules/clean/ajax","modules/clean/devtools/perf_hub_actions","modules/clean/event_load","modules/constants/env","modules/constants/request","modules/constants/webtiming","modules/core/browser","modules/core/exception"],function(t,e,n,r,o,i,s,a,u){var l;return l={init:function(t){var e,n,r,i,s,a;return e=null!=t?t:{},this.log_time_to_view=null!=(n=e.log_time_to_view)?n:!1,this.log_time_to_interactive=null!=(r=e.log_time_to_interactive)?r:!1,this.ttv_at_dom_interactive=null!=(i=e.ttv_at_dom_interactive)?i:!1,this.tti_at_dom_interactive=null!=(s=e.tti_at_dom_interactive)?s:!1,this.source_type=null!=(a=e.source_type)?a:"web",u.performance()?(this.initialized=!0,this.have_logged_web_timing=!1,o.window_load(function(){return setTimeout(l._log_navigation,0)})):void 0},reset:function(){return this.log_time_to_view=!1,this.log_time_to_interactive=!1,this.ttv_at_dom_interactive=!1,this.tti_at_dom_interactive=!1,this.source_type="web",this.initialized=!1,this.have_logged_web_timing=!1,this.time_to_view=null,this.time_to_interactive=null},start_time:function(){var t,e;return(e=null!=(t=u.performance())?t.timing:void 0)?e.navigationStart||e.fetchStart:void 0},_log_navigation:function(){var t,e,n,r,o,i,c,_,h;if(l.initialized&&!l.have_logged_web_timing&&(c=null!=(o=u.performance())?o.timing:void 0)&&(i=l.start_time(),t=c.loadEventEnd,i&&t)){if(l.log_time_to_view&&null==l.time_to_view){if(!l.ttv_at_dom_interactive)return;l.time_to_view=c.domInteractive}if(l.log_time_to_interactive&&null==l.time_to_interactive){if(!l.tti_at_dom_interactive)return;l.time_to_interactive=c.domInteractive}return n=!l.have_logged_web_timing,l.have_logged_web_timing=!0,e={},s.IS_SPDY&&(e.is_spdy=!0),h=l.log_time_to_view?l.time_to_view-i:null,_=l.log_time_to_interactive?l.time_to_interactive-i:null,r={navigation_type:l._get_navigation_type(),server_request_start_time:s.REQUEST_START_TIME,browser_time:(c.redirectStart||c.fetchStart)-i,redirect_time:c.fetchStart-i,dns_time:c.domainLookupEnd-i,tcp_connect_time:(c.secureConnectionStart||c.requestStart)-i,ssl_connect_time:c.requestStart-i,time_to_first_byte:c.responseStart-i,time_to_last_byte:c.responseEnd-i,dom_load_time:c.domContentLoadedEventEnd-i,page_load_time:t-i,extra_columns:JSON.stringify(e)},a.LOG_RESOURCE_TIMING&&"getEntriesByType"in u.performance()&&l._add_resources_to_params(r),l.log_time_to_view&&(r.time_to_view=h),l.log_time_to_interactive&&(r.time_to_interactive=_),l._log(r,null,n)}},mark_time_to_view:function(){return this.time_to_view||this.ttv_at_dom_interactive?void 0:(this.time_to_view=(new Date).getTime(),null!=console.timeStamp&&console.timeStamp("TTV"),this._log_navigation())},mark_time_to_interactive:function(){return this.time_to_interactive||this.tti_at_dom_interactive?void 0:(this.time_to_interactive=(new Date).getTime(),null!=console.timeStamp&&console.timeStamp("TTI"),this._log_navigation())},log_ajax_transition:function(t,e,n,r,o,i){var s;return s={navigation_type:"ajax",page_load_time:t,url:i},null!=o&&(s.server_response_time=o),null!=n&&(s.extra_columns=JSON.stringify(n)),null!=r&&(s.stopwatch_suffix=r),l._log(s,e)},_log:function(e,o,a){return null==a&&(a=!1),e.url=e.url||u.get_href(),e.request_id=s.REQUEST_ID,e.source_type=this.source_type,e.request_tracing_enabled=s.REQUEST_TRACING_ENABLED,o&&(e.url_info=o),n.AuthenticatedRequest({url:i.WEB_TIMING_LOG_ENDPOINT,type:"POST",data:e,success:function(e){var n,o;return n=t(".perf-hub-link-container"),a&&n.length&&(o=JSON.parse(e),"status"in o)?r.add_web_timing_details({details:o}):void 0}})},_add_resources_to_params:function(t){var e,n,r,o,i,s,a,c,_;if(i=[],s={},a=u.performance().getEntriesByType("resource"),a instanceof Array)for(n=0,r=a.length;r>n;n++)o=a[n],_=l._get_resource_type(o),_ in s||(s[_]={count:0,total_time:0}),s[_].count++,s[_].total_time+=o.duration,i.push({type:_,name:o.name.substr(0,2e3),start:o.startTime,end:o.responseEnd,connectStart:o.connectStart,connectEnd:o.connectEnd,domainLookupStart:o.domainLookupStart,domainLookupEnd:o.domainLookupEnd});c=[];for(e in s)t["resource_"+e+"_count"]=s[e].count,t["resource_"+e+"_avg_time"]=s[e].total_time/s[e].count,c.push(t.resource_details=JSON.stringify(i));return c},_get_resource_type:function(t){var e,n,r,o;if(o=t.name,r=o.lastIndexOf("."),r>0){if(e=o.substring(r),".png"===e||".gif"===e||".jpg"===e||".svg"===e)return"img";if(".js"===e)return"script";if(".css"===e)return"css"}return n=t.initiatorType,"css"!==n&&"img"!==n&&"script"!==n&&"link"!==n?"xmlhttprequest"===n?"ajax":"other":n},_get_navigation_type:function(){var t;switch(t=u.performance().navigation,t.type){case t.TYPE_NAVIGATE:return"navigate";case t.TYPE_RELOAD:return"reload";case t.TYPE_BACK_FORWARD:return"back_forward"}}}})}.call(this),function(){define("modules/constants/debug",[],function(){return DebugConstants||{}})}.call(this),function(){define("modules/constants/env",[],function(){return EnvConstants||{}})}.call(this),function(){define("modules/constants/gandalf",[],function(){return window.GandalfConstants})}.call(this),function(){define("modules/constants/legacy",[],function(){return DropboxConstants||{}})}.call(this),function(){define("modules/constants/mobile",[],function(){return window.MobileConstants||{}})}.call(this),function(){define("modules/constants/page_load",[],function(){return window.PageLoadConstants})}.call(this),function(){define("modules/constants/request",[],function(){return RequestConstants||{}})}.call(this),function(){define("modules/constants/viewer",[],function(){return ViewerConstants||{}})}.call(this),function(){define("modules/constants/webtiming",[],function(){return window.WebTimingConstants})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/core/browser",["modules/constants/env","modules/core/exception","modules/core/uri"],function(e,n,r){var o,i,s,a,u;return i=n.assert,u=function(t){var e,n,r;return t=t.toLowerCase(),e=/(ipad)/.exec(t)||/(edge)[ \/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||/(trident).*? rv:([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],r=null!=(n=t.match(/version\/([\d.]+)/i))?n[1]:void 0,{browser:e[1]||"",version:r||e[2]||"0"}},s=u(navigator.userAgent),"trident"===s.browser&&(s.browser="msie"),a=e.REDIRECT_SAFE_ORIGINS,o={version:s.version,msie_version_at_most:function(t){return o.msie&&parseInt(o.version,10)<=t},safari_version_at_most:function(t){return o.safari&&parseInt(o.version,10)<=t},get_uri:function(t){return null==t&&(t=window),r.parse(this.get_href(t))},get_href:function(t){return null==t&&(t=window),t.location.href},get_hash:function(){return window.location.hash.split("#")[1]},set_hash:function(t){return window.location.hash=t},_parse_target:function(e,n){var o,s,u,l,c,_;return null==n&&(n=window),u=n.document.createElement("a"),u.href=e,c=":"===u.protocol?n.location.protocol:u.protocol||n.location.protocol,o=u.hostname||n.location.hostname,l=0===u.pathname.indexOf("/")?u.pathname:"/"+u.pathname,e=c+"//"+o+l+u.search+u.hash,s=r.parse(String(e)),i((_=s.authority,t.call(a,_)>=0&&"https"===s.scheme),"Target URI must be secure and in domain whitelist"),s},open_tab:function(t){var e;return e=this._parse_target(t),window.open(e.toString(),"_blank")},unsafe_open_tab:function(t){var e,n,o;return e=r.parse(String(t)),i("data"!==(null!=(n=e.scheme)?n.toLowerCase():void 0)&&"javascript"!==(null!=(o=e.scheme)?o.toLowerCase():void 0),"Target URI can't be a Javascript/data URI"),window.open(e.toString(),"_blank")},redirect:function(t,e){var n;return null==e&&(e=window),n=this._parse_target(t,e),e.location.href=n.toString()},replace_location:function(t){var e;return e=this._parse_target(t),window.location.replace(e.toString())},reload:function(){return window.location.reload()},performance:function(){return window.performance||null},unsafeRedirect:function(t){var e,n,o;return e=r.parse(String(t)),i("data"!==(null!=(n=e.scheme)?n.toLowerCase():void 0)&&"javascript"!==(null!=(o=e.scheme)?o.toLowerCase():void 0),"Target URI can't be a Javascript/data URI"),window.location.href=e.toString()},is_high_density_display:function(){var t;return window.matchMedia?(t="(-webkit-min-device-pixel-ratio: 1.1), (min-resolution: 192dpx), (min-resolution: 1.1dppx)",!!window.matchMedia(t).matches):window.devicePixelRatio?window.devicePixelRatio>1.1:!1},isOnline:function(){return window.navigator.onLine},subscribeConnectivityStatusChange:function(t){return window.addEventListener("online",t),window.addEventListener("offline",t)},unsubscribeConnectivityStatusChange:function(t){return window.removeEventListener("online",t),window.removeEventListener("offline",t)}},o[s.browser]=!0,o.browser_name=s.browser,o.mac=!!/(macintosh)/.exec(window.navigator.userAgent.toLowerCase()),o.iphone=!!/(iphone)/.exec(window.navigator.userAgent.toLowerCase()),o.ipod=!!/(ipod)/.exec(window.navigator.userAgent.toLowerCase()),o.iOS=o.ipad||o.ipod||o.iphone,o.ipad?(o.webkit=!0,o.safari=!0):o.chrome?o.webkit=!0:o.webkit&&(o.safari=!0),o})}.call(this),function(){define("modules/core/controller_helpers",["jquery","modules/core/controller_registry","modules/core/exception"],function(t,e,n){var r,o,i,s,a;return r=n.assert,s=function(t,e){return t.data("jscontroller",e)},a=function(t){return t.data("jscontroller")},o=function(n){var r,i,s,u;for(u=n.children(),i=0,s=u.length;s>i;i++)r=u[i],o(t(r));return!a(n)&&n.data("js-component-id")?e.bind_controller(n):void 0},i=function(t){var e;return r(t,"Trying to clone nonexistent element"),e=t.clone(),o(e),e},{deprecated_set_controller:s,get_controller:a,clone_element:i,bind_controllers:o}})}.call(this),function(){define("modules/core/controller_registry",["jquery","modules/core/exception"],function(t,e){var n,r,o;return o=e.raiseAndReport,r=function(e,n,r){var o,i,s,a;for(o=[e].concat(r),s=0,a=e.length;a>s;s++)i=e[s],t(i).data("jscontroller",function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(n,o,function(){}));return e},n=function(){function e(){}return e.controllers={},e.register_controller=function(t,e,n){return this.controllers[t]={constructor:e,args:n},this.find_and_bind_controller(t)},e.bind_controller=function(t){var e,n;return e=t.data("js-component-id"),this.controllers[e]?(n=this.controllers[e],r(t,n.constructor,n.args)):void o("No controller for "+e)},e.find_and_bind_controller=function(e){var n,i;return this.controllers[e]?(i=this.controllers[e],n=t("[data-js-component-id='"+e+"']"),r(n,i.constructor,i.args)):void o("No controller for "+e)},e}()})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define("modules/core/cookies",["modules/core/exception"],function(e){var n,r,o,i,s,a,u,l,c,_,h,d,p;return o=/^([0-9]{1,3}\.){3}[0-9]{1,3}$/,i=function(t){var e,n,r,i,s;if(t.match(o))return[t];for(e=t.split("."),s=[],n=r=0,i=e.length;i>=0?i>r:r>i;n=i>=0?++r:--r)s.push(e.slice(n).join("."));return s},s=function(t){var e,n,r,o,i,s;for(e=t.split("/"),s=[],n=r=0,o=e.length;o>=0?o>r:r>o;n=o>=0?++r:--r)i=e.slice(0,e.length-n).join("/"),""!==i&&s.push(i),s.push(i+"/");return s},a=function(e){var n,r,o,i;if(null==e)return!1;for(i=["=",";"],r=0,o=i.length;o>r;r++)if(n=i[r],t.call(e,n)>=0)return!0;return!1},p=function(t,n,r){null==r&&(r=!1),e.assert("string"==typeof t,n+" must be a string, but was "+typeof t),e.assert(r||(null!=t?t.length:void 0)>0,n+" must not be empty"),e.assert(!a(t),n+" contains illegal characters")},_=function(t){return p(t,"Cookie name",!1)},d=function(t){return p(t,"Cookie value",!0)},c=function(t){return p(t,"Cookie expiration date",!1)},l=function(t){return p(t,"Cookie domain",!1);

},h=function(t){return p(t,"Cookie path",!1)},u=function(t,e,n){null==n&&(n={}),_(t),d(e),null!=n.expires&&c(n.expires),null!=n.domain&&l(n.domain),null!=n.path&&h(n.path),document.cookie=[t+"="+e,null!=n.expires?"expires="+n.expires:void 0,null!=n.domain?"domain="+n.domain:void 0,null!=n.path?"path="+n.path:void 0].join("; ")},r=new Date(1).toUTCString(),n={create:function(t,n,r){var o,i;null!=r&&(e.assert("number"==typeof r,"Cookie expiration must be a number"),o=new Date,o.setTime(o.getTime()+24*r*60*60*1e3),i=o.toUTCString()),u(t,n,{expires:i,path:"/"})},read:function(t){var e,n,r,o,i,s,a,u,l,c,h,d;for(_(t),d=[],c=document.cookie.split(";"),o=0,a=c.length;a>o;o++)e=c[o],s=e.split("=",1)[0],s.trim()===t&&d.push(e.substring(s.length+1,e.length).trim());for(n=!1,l=[],r=i=0,u=d.length;u>i;r=++i)h=d[r],""===h?n=!0:l.push(h);return 1===l.length?l[0]:l.length>1?(this.delete(t),null):n?"":null},delete:function(t){var e,n,o,a,l,c,_,h;for(n=[null].concat(i(window.location.hostname)),h=[null].concat(s(window.location.pathname)),o=0,l=n.length;l>o;o++)for(e=n[o],a=0,c=h.length;c>a;a++)_=h[a],u(t,"",{expires:r,domain:e,path:_})},are_enabled:function(){return null!=navigator.cookieEnabled?navigator.cookieEnabled:(document.cookie="this_is_a_test_cookie",-1!==document.cookie.indexOf("this_is_a_test_cookie"))}}})}.call(this),function(){define("modules/core/dom",["jquery"],function(t){var e,n,r,o,i,s,a,u,l,c,_,h,d,p,f,m,g,v,w,b,y,x,E,S;return e="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",p=function(t){return t?1===t.nodeType?!0:t.length>=1&&1===t[0].nodeType?!0:!1:!1},c=function(){return f(document.activeElement)},f=function(t){var e,n;return("INPUT"===(e=null!=t?t.tagName:void 0)||"TEXTAREA"===e||"SELECT"===e)&&"submit"!==(n=null!=t?t.type:void 0)&&"button"!==n||d(t)},d=function(t){return(null!=t?t.hasAttribute:void 0)&&(null!=t?t.hasAttribute("contenteditable"):void 0)&&"false"!==(null!=t?t.getAttribute("contenteditable").toLowerCase():void 0)},S=function(e){var n,r,o;return n=t(e),o=n.offset(),r=t(window),{left:o.left-r.scrollLeft(),top:o.top-r.scrollTop()}},r=null,o=null,E=function(){return r||(r={height:t(window).height(),width:t(window).width()}),o||(o=t(window).on("resize",function(){return r=null})),r},u=function(){return Math.max(t(document).height(),t(window).height(),document.documentElement.clientHeight)},i=null,n=null,b=function(){var e,r,o;return i||(i=t(window).scroll(function(){return n=null})),m()?n||(o=t(window).scrollTop(),r=t(window).scrollLeft(),n={0:r,1:o,left:r,top:o}):(e=t("body"),o=s.top,r=s.left,n={0:r,1:o,left:r,top:o}),n},g=function(){return n=null},m=function(){return!t("body").hasClass("no-scroll")},w=0,s=null,v=function(){var e,n,r;return w++,e=t("body"),e.hasClass("no-scroll")?void 0:(s=b(),r=-1*s.top+"px",n=-1*s.left+"px",e.css({top:r,left:n}),e.addClass("no-scroll"))},x=function(){var e,n,r;return w>0&&w--,e=t("body"),0===w&&e.hasClass("no-scroll")?(r=s.top,n=s.left,e.css({top:"",left:""}),e.removeClass("no-scroll"),y(n,r+1),y(n,r-1),y(n,r)):void 0},y=function(e,r){var o,i,a;return e=Math.max(e,0),r=Math.max(r,0),r>b().top&&(r=Math.min(r,u()-l.viewport_dimensions().height)),m()?(window.scrollTo(e,r),n={0:e,1:r,left:e,top:r}):(s={0:e,1:r,left:e,top:r},a=-1*r+"px",i=-1*e+"px",o=t("body"),o.css({top:a,left:i}))},a=function(e,n,r){var o,i,s,a,u,l,c,_;return i=t(n),s=t(e),l={setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},r=t.extend({},l,r),_=S(i),c={top:0,left:0},o=null,"absolute"===s.css("position")&&(o=s.offsetParent(),c=S(o)),o&&o[0]===document.body&&(c.left-=document.body.offsetLeft,c.top-=document.body.offsetTop),r.setLeft&&(a=_.left-c.left+r.offsetLeft+"px",s.css("left",a)),r.setTop&&(u=_.top-c.top+r.offsetTop+"px",s.css("top",u)),r.setWidth&&s.width(i[0].offsetWidth),r.setHeight&&s.height(i[0].offsetHeight),s},S=function(e){var n,r,o;return n=t(e),o=n.offset(),r=t(window),{left:o.left-r.scrollLeft(),top:o.top-r.scrollTop()}},_=function(n,r){var o;return o=t(n).find(e),r?o.not('*[tabindex="-1"]'):o},h=function(t){var e,n,r,o;return o=_(t,!0),e=o.filter('*:not([tabindex]), *[tabindex="0"]'),r=o.not(e).toArray(),r.length?(n=function(t,e){var n,r;return n=parseInt(t.getAttribute("tabindex"),10),r=parseInt(e.getAttribute("tabindex"),10),n-r},r.sort(n),r.concat(e.toArray())):e.toArray()},l={clone_position:a,document_height:u,focus_in_input:c,is_input:f,is_content_editable:d,is_page_scrollable:m,scroll_clear_cache:g,scroll_lock_document:v,scroll_offsets:b,scroll_to:y,scroll_unlock_document:x,is_element:p,viewport_offset:S,viewport_dimensions:E,getFocusableElementsIn:_,getTabbableElementsIn:h}})}.call(this),function(){var t=[].slice;define("modules/core/exception",["external/underscore","modules/constants/env","modules/constants/legacy","modules/core/exception_tag_registry","external/tracekit"],function(e,n,r,o,i){var s,a;return a=o.get_registered_tags,s=function(){function o(){}return o.SEVERITY={CRITICAL:"critical",NONCRITICAL:"non-critical"},o.strip_comments=function(t){return t.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")},o.fn_body=function(t){var e;return e=o.strip_comments(t.toString()),e=e.replace(/[\s]+/g," "),"("===e[0]&&(e=e.substr(1)),")"===e[e.length-1]&&(e=e.substr(0,e.length-1)),e=e.replace("function (","function(")},o.stackTrace=function(){var t,e,n,r,i,s;for(i=[],s={},t=arguments.callee.caller;t;){if(t.__tb_ajax_info__){i.unshift("Ajax.DBRequest: "+t.__tb_ajax_info__);break}if(t.__tb__){i=t.__tb__.concat(i);break}if(r=o.fn_body(t),r in s)break;s[r]=!0,i.unshift(r);try{t=t.caller}catch(n){e=n,t=null;break}}return i},o.__callbacks=[],o.registerOnFailedAssert=function(t){return this.__callbacks.push(t)},o.reportException=function(t){var e,n,r,s,a,u,l,c;return e=t.err,r=t.force,c=t.tags,a=t.severity,n=t.exc_extra,l=i.computeStackTrace(e),u=null!=(s=null!=l?l.stack:void 0)?s:[],o._reportException({msg:e.message,stack:u,force:r,tags:c,severity:a,exc_extra:n})},o._reportException=function(t){var e,i,s,u,l,c,_,h,d,p,f,m;if(c=t.msg,d=t.stack,u=t.force,p=t.tags,h=t.severity,s=t.exc_extra,__CIRCULAR_DEPENDENCY__.active_user_loaded?__CIRCULAR_DEPENDENCY__.an_error_happened_after_loading=!0:__CIRCULAR_DEPENDENCY__.an_error_happened_before_loading=!0,!o.reported_exception||u){p||(p=[]),p=p.concat(a()),e={e:c,loc:window.location.href,ref:r.referrer,stack:JSON.stringify(d.reverse()),trace:null!=(_=__CONDITIONAL_JS__.Trace)?_.get():void 0,tags:JSON.stringify(p),sev:h||"",exc_extra:null!=s?JSON.stringify(s):void 0},m=new XMLHttpRequest,m.open("POST","/jse"),i=[];for(l in e)f=e[l],null!=f&&""!==f&&i.push(encodeURIComponent(l)+"="+encodeURIComponent(f));if(i=i.join("&"),m.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),m.send(i),o.reported_exception=c,!n.IS_PROD&&window.sessionStorage)return e.source="exception.coffee",window.sessionStorage.setItem("reported_exception",JSON.stringify(e))}},o.assert=function(e,r,s){var a,u,l,c,_,h,d,p,f,m,g,v,w,b,y,x,E,S,k;if(null==r&&(r="An assertion failed but no message was provided"),null==s&&(s={}),h=arguments.length>3||"boolean"==typeof s,h&&!n.IS_PROD&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn(new Error("Call to JSException.assert() with deprecated positional arguments. Please update this method call to pass an object in the third parameter. See exception.coffee for more information.")),!e){for(h?(p=t.call(arguments).slice(2),c=null!=(f=p[0])?f:!0,k=null!=(m=p[1])?m:[],x=null!=(g=p[2])?g:!0,E=null!=(v=p[3])?v:!0,l=null):(k=s.tags||[],l=s.exc_extra||null),r="Assertion Error: "+r,n.IS_PROD||alert(r),u=new Error(r),S=i.computeStackTrace(u),o._reportException({msg:r,stack:null!=(w=null!=S&&null!=(b=S.stack)?b.slice(1):void 0)?w:[],force:c!==!1,tags:k.concat("module:exception","assert"),exc_extra:l}),y=o.__callbacks,_=0,d=y.length;d>_;_++)(a=y[_])(S);if(x!==!1)throw u}},o.raiseAndReport=function(t,r){var i;return null==t&&(t="Raise and report was called without a message"),null==r&&(r={}),r=e.defaults({},r,{severity:o.SEVERITY.NONCRITICAL,tags:[],exc_extra:{}}),i=new Error(t),o.reportException({err:i,force:!0,tags:r.tags.concat("module:exception","raiseAndReport"),severity:r.severity,exc_extra:r.exc_extra}),n.IS_PROD?void 0:r.severity===o.SEVERITY.CRITICAL?(alert(t),"undefined"!=typeof console&&null!==console&&"function"==typeof console.error?console.error(i):void 0):"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn?console.warn(i):void 0},o}(),__CONDITIONAL_JS__.JSException=s,s})}.call(this),function(){var t={}.hasOwnProperty;define("modules/core/exception_tag_registry",[],function(){var e,n;return n={},e={},e.get_registered_tags=function(){var e,r;return function(){var o;o=[];for(r in n)t.call(n,r)&&(e=n[r],o.push(r));return o}()},e.register_tag=function(t){return n[t]=!0},e.unregister_tag=function(t){return delete n[t]},e})}.call(this),function(){define("modules/core/html",["jquery","external/underscore","modules/constants/page_load"],function(t,e,n){var r;return r=function(){function t(t){this._str_DONT_TOUCH=t}return t.prototype.toHTML=function(){return this._str_DONT_TOUCH},t.prototype.toString=function(){return"[object HTML]"},t}(),function(){var o,i,s,a;return r.tmpl=function(o,i){var s,a,u,l;return/[^\w:.-]/.test(o)||(a=document.getElementById(o),o=a.innerHTML,null!=n.CSP_SCRIPT_NONCE&&n.CSP_SCRIPT_NONCE!==a.getAttribute("nonce")&&(o="")),l=o.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.*?)%>/g,"',__no_conflict_HTML__._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('"),s=new Function("__no_conflict_HTML__","__no_conflict_jQuery__","TEMPLATE_DATA","var p=[],print=function(){p.push.apply(p,arguments);}; p.push('"+l+"'); return new __no_conflict_HTML__(__no_conflict_jQuery__.trim(p.join('')));"),u=e.partial(s,r,t),i?u(i):u},i=/[^\w@\.\ \-\(\)\,\$~%#\[\]\{\}\!\^]/g,a=function(t){return"&#"+t.charCodeAt(0)+";"},s=function(t){return(""+t).replace(i,a)},r.escape=function(t){return t instanceof r?t:new r(s(t))},r._raw_escape=o=function(t){return t instanceof r?t.toHTML():"number"==typeof t?t:s(t)}}(),r})}.call(this),function(){define("modules/core/i18n",["external/underscore","langpack","modules/core/exception","modules/constants/viewer","external/sha1"],function(t,e,n,r,o){var i,s,a,u,l,c,_,h,d,p,f,m,g;for(f=n.assert,u="abcdefghijklmnopqrstuvwxyz",l="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZ",p="",i={},m=g=0;26>g;m=++g)i[u.charAt(m)]=l.charAt(m),i[d.charAt(m)]=p.charAt(m);return s=function(){function n(){}return n.messages={},n.emessages={},n.RAND=0,n.NUM_MISSED=0,n.add_i18n_message=function(t,e,n,r){return e=e.strip_tags().friendly_format(),n=n.strip_tags(),this.messages[e]=t,this.emessages[e]=n,r?(delete this.messages[r],delete this.emessages[r]):void 0},n.PLURAL_RULES={SINGULAR_1:function(t){return 1===t?0:1},SINGULAR_01:function(t){return 1>=t?0:1},SINGULAR_ALL:function(){return 0},RUSSIA_UKRAINE:function(t){return t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2},POLAND:function(t){return 1===t?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2}},n.PLURAL_RULES_BY_LOCALE={en:n.PLURAL_RULES.SINGULAR_1,en_GB:n.PLURAL_RULES.SINGULAR_1,da_DK:n.PLURAL_RULES.SINGULAR_1,de:n.PLURAL_RULES.SINGULAR_1,es_ES:n.PLURAL_RULES.SINGULAR_1,es:n.PLURAL_RULES.SINGULAR_1,fr:n.PLURAL_RULES.SINGULAR_01,id:n.PLURAL_RULES.SINGULAR_ALL,it:n.PLURAL_RULES.SINGULAR_1,ja:n.PLURAL_RULES.SINGULAR_ALL,ko:n.PLURAL_RULES.SINGULAR_ALL,ms:n.PLURAL_RULES.SINGULAR_ALL,nb_NO:n.PLURAL_RULES.SINGULAR_1,nl_NL:n.PLURAL_RULES.SINGULAR_1,pl:n.PLURAL_RULES.POLAND,pt_BR:n.PLURAL_RULES.SINGULAR_01,ru:n.PLURAL_RULES.RUSSIA_UKRAINE,sv_SE:n.PLURAL_RULES.SINGULAR_1,th_TH:n.PLURAL_RULES.SINGULAR_ALL,tr:n.PLURAL_RULES.SINGULAR_ALL,uk_UA:n.PLURAL_RULES.RUSSIA_UKRAINE,xx_AC:n.PLURAL_RULES.SINGULAR_1,xx_LS:n.PLURAL_RULES.SINGULAR_1,xx_HA:n.PLURAL_RULES.SINGULAR_1,xx_RL:n.PLURAL_RULES.SINGULAR_1,xx_AE:n.PLURAL_RULES.SINGULAR_1,xx_SL:n.PLURAL_RULES.SINGULAR_1,zh_CN:n.PLURAL_RULES.SINGULAR_ALL,zh_TW:n.PLURAL_RULES.SINGULAR_ALL},n.PERCENT_FORMAT={SUFFIX:function(t){return"%(percent)s%".format({percent:t})},PREFIX:function(t){return"%"+"%(percent)s".format({percent:t})},SUFFIX_SPACE:function(t){return"%(percent)s%".format({percent:t})}},n.PERCENT_FORMAT_BY_LOCALE={en:n.PERCENT_FORMAT.SUFFIX,en_GB:n.PERCENT_FORMAT.SUFFIX,da_DK:n.PERCENT_FORMAT.SUFFIX_SPACE,de:n.PERCENT_FORMAT.SUFFIX_SPACE,es_ES:n.PERCENT_FORMAT.SUFFIX,es:n.PERCENT_FORMAT.SUFFIX,fr:n.PERCENT_FORMAT.SUFFIX_SPACE,id:n.PERCENT_FORMAT.SUFFIX,it:n.PERCENT_FORMAT.SUFFIX,ja:n.PERCENT_FORMAT.SUFFIX,ko:n.PERCENT_FORMAT.SUFFIX,ms:n.PERCENT_FORMAT.SUFFIX,nb_NO:n.PERCENT_FORMAT.SUFFIX_SPACE,nl_NL:n.PERCENT_FORMAT.SUFFIX,pl:n.PERCENT_FORMAT.SUFFIX,pt_BR:n.PERCENT_FORMAT.SUFFIX,ru:n.PERCENT_FORMAT.SUFFIX_SPACE,sv_SE:n.PERCENT_FORMAT.SUFFIX_SPACE,th_TH:n.PERCENT_FORMAT.SUFFIX,tr:n.PERCENT_FORMAT.PREFIX,uk_UA:n.PERCENT_FORMAT.SUFFIX,xx_AC:n.PERCENT_FORMAT.SUFFIX,xx_LS:n.PERCENT_FORMAT.SUFFIX,xx_HA:n.PERCENT_FORMAT.SUFFIX,xx_RL:n.PERCENT_FORMAT.SUFFIX,xx_AE:n.PERCENT_FORMAT.SUFFIX,zh_CN:n.PERCENT_FORMAT.SUFFIX,zh_TW:n.PERCENT_FORMAT.SUFFIX},n.get_langpack=function(){return e},n._convert_project_comment=function(e,n,r){return null==r&&(r="web"),t.isObject(e)||(e={project:e}),t.isObject(n)||(n={comment:n}),t.defaults({},e,n,{project:r,comment:null})},n._=function(t,e,o){var i,s,u,l,c;return l=n._convert_project_comment(e,o),e=l.project,o=l.comment,n.locale_is_fake(r.USER_LOCALE)?u=n.fake_translate(t,r.USER_LOCALE):(c=a.get_string_key(t,e,o),i=n.get_langpack(),s=i[c]||i[t],s?u=s instanceof String||"string"==typeof s?s:s[0]||t:(0===n.RAND&&"en"!==r.USER_LOCALE&&(n.RAND=Math.floor(20*Math.random()+1)),1===n.RAND&&n.NUM_MISSED<4&&(n.NUM_MISSED+=1,require(["jquery"],function(n){return n.ajax({url:"/missed_translation_log",type:"POST",noDropboxDefaults:!0,data:{message:t,comment:o,project:e}})})),u=t)),n.add_i18n_message(t,u,t),u},n.fake_translate=function(t,e){var n,r,o,s,a,u,l;if("xx_LS"===e&&(t+="SSSSSSSSSSSSSSSSSSSSSSSSS"),"xx_AC"!==e||/</.test(t)||(t=t.toUpperCase()),"xx_HA"===e&&(t="[javascript]"+t),"xx_RL"===e&&!/</.test(t)&&!/%/.test(t)){for(a=97,o=1488,u="",t=t.toLowerCase(),m=s=0,l=t.length;l>=0?l>s:s>l;m=l>=0?++s:--s)n=t.charCodeAt(m)-a,u+=n>=0&&26>n?String.fromCharCode(o+n):t[m];t=u}return"xx_AE"!==e||/</.test(t)||/%/.test(t)||(t=function(){var e,n,o,s;for(s=[],m=e=0,n=t.length;n>=0?n>e:e>n;m=n>=0?++e:--e)r=t.charAt(m),s.push(null!=(o=i[r])?o:r);return s}().join("")),t},n.locale_is_fake=function(t){return-1!==t.indexOf("xx_")},n.ungettext=function(t,e,o,i,s){var u,l,c,_,h,d,p,m;if(d=n._convert_project_comment(i,s),i=d.project,s=d.comment,f(null!=o,"missing number parameter for ungettext"),c=r.USER_LOCALE)if(n.locale_is_fake(c))t=n.fake_translate(t,c),e=n.fake_translate(e,c);else if(m=a.get_string_key(t,i,s),l=n.get_langpack(),_=l[m]||l[t]){if(_ instanceof String||"string"==typeof _)return _;h=n.PLURAL_RULES_BY_LOCALE[c](o),h in _&&(p=_[h])}return u=1===o?t:e,null==p&&(p=u),n.add_i18n_message(t,p,u),p},n.N_=function(t,e,r){var o;return o=n._convert_project_comment(e,r),e=o.project,r=o.comment,new c(t,e,r)},n.E_=function(t){return n._(t.msg,t.project,t.comment)},n.render_sentences=function(t){var e,r,o,i,s,a;if(o=t.length,1===o)return t[0];if(2===o)return n._("%s %s",{comment:"Two sentences"}).format(t);if(3===o)return n._("%s %s %s",{comment:"Three sentences"}).format(t);if(4===o)return n._("%s %s %s %s",{comment:"Four sentences"}).format(t);for(i="",a=0,e=0,r=t.length;r>e;e++)s=t[e],i+=s,a!==o-1&&(i+=n._(" ",{comment:"Sentence separator character"})),a+=1;return i},n.format_percent=function(t){var e;return e=r.USER_LOCALE,e?n.PERCENT_FORMAT_BY_LOCALE[e](t):n.PERCENT_FORMAT.SUFFIX(t)},n.i18n_default_project=function(t){return{_:function(e,r,o){var i;return i=n._convert_project_comment(r,o,t),r=i.project,o=i.comment,n._(e,r,o)},ungettext:function(e,r,o,i,s){var a;return a=n._convert_project_comment(i,s,t),i=a.project,s=a.comment,n.ungettext(e,r,o,i,s)},N_:function(e,r,o){var i;return i=n._convert_project_comment(r,o,t),r=i.project,o=i.comment,n.N_(e,r,o)},E_:n.E_}},n.case_insensitive_comparator=function(){var t,e;return null!=(null!=(e=window.Intl)?e.Collator:void 0)?(t=r.USER_LOCALE.replace("_","-")||"en",new window.Intl.Collator(t).compare):function(t,e){var n,r;return n=t.toLowerCase(),r=e.toLowerCase(),r>n?-1:n>r?1:e>t?-1:t>e?1:0}},n}(),c=function(){function t(t,e,n){this.msg=t,this.project=e,this.comment=n}return t}(),a=function(){function t(){}return t.get_message_context=function(t,e){var n,r,i;return r="","web"!==t&&(r="project:"+t),null!=e&&(i=new o(e,"TEXT"),n=i.getHash("SHA-1","HEX"),r?r+=" "+n:r=n),r},t.CONTEXT_DELIMITER="",t.get_string_key=function(e,n,r){var o;return o=t.get_message_context(n,r),null!=o?o+t.CONTEXT_DELIMITER+e:e},t}(),h=function(t){return"undefined"==typeof Array.isArray?"[object Array]"===Object.prototype.toString.call(t):Array.isArray(t)},_=function(){var t,e,n;return t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift(),function(){return e.apply(n,t.concat(Array.prototype.slice.call(arguments)))}},String.prototype.format_sub=function(t){return this.replace(/%(\([a-zA-Z0-9_\-]+\))?(.\d+)?(.)/g,_(t,this))},String.prototype.format=function(){var t,e,n,o,i,a;return 0===arguments.length?this.toString():(e=void 0,t=0,e=1===arguments.length&&arguments[0]instanceof Object?arguments[0]:Array.prototype.slice.call(arguments,0),i=function(n,o,i,s){var a,u,l,c;if(o?(o=o.slice(1,-1),f(0>=t,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),t=-1,a="xx_AC"===r.USER_LOCALE,f(o in e||a&&o.toLowerCase()in e,"Key '"+o+"' not present during string substitution for string '"+this+"'"),c=e[o],a&&(c=e[o.toLowerCase()])):(h(e)||(e=[e]),f(t>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),f(t<e.length,"Insufficient number of items in format for string '"+this+"'"),c=e[t],t++),f("undefined"!=typeof c,"value for key '"+(o||"")+"' is undefined"),l=void 0,"s"===s||"S"===s)l=c.toString();else if("d"===s||"D"===s)l=parseInt(c,10).toString();else if("f"===s||"F"===s)l=Number(c).toString();else{if("%"===s)return"%";f(!1,"Unexpected format character '"+s+"' for string '"+this+"'.")}return i?(i=parseInt(i.slice(1),10),"f"===s||"F"===s?(l.indexOf(!1)&&(l+=".0"),u=l.split("."),u[0]+"."+u[1].slice(0,i)):l.slice(0,i)):l},a=this.format_sub(i),s.messages&&this in s.messages&&(t=0,o=s.emessages[this],n=String.prototype.format_sub.call(o,i),s.add_i18n_message(o,a,n,this)),a)},String.prototype.friendly_format=function(){var t,e,n;return e=function(e,r,o,i){return r?"["+r.slice(1,1).replace("-","_")+"]":"s"===i||"S"===i?"[word"+n++ +"]":"[number"+t++ +"]"},t=1,n=1,this.format_sub(e)},String.prototype.blank_format=function(){var t;return t=function(){return""},this.format_sub(t)},String.prototype.strip_tags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},s})}.call(this),function(){define("modules/core/notify",["jquery","external/purify","modules/core/accessible_announce","modules/core/html","modules/core/i18n","modules/clean/gandalf_util"],function(t,e,n,r,o,i){var s,a,u,l;return l=e.sanitize,a=o._,u=i.getGandalfRule,s=function(){function e(){}return e.DEFAULT_ERROR=a("There was a problem completing this request."),e.DEFAULT_SUCCESS=a("Your request completed successfully."),e.success=function(t,e){return null==e&&(e=10),t=t||this.DEFAULT_SUCCESS,n.polite(t,e+1),this._show(t,e,"server-success"),this.current()},e.error=function(t,e){return null==e&&(e=10),t=t||this.DEFAULT_ERROR,u("db_readonly_maintenance")&&t===this.DEFAULT_ERROR&&(t+=a(" Dropbox might be undergoing maintenance.<br>Check <a href='http://status.dropbox.com'>status.dropbox.com</a>."),t=new r(l(t)),e=60),n.assertive(t,e+1),this._show(t,e,"server-error"),this.current()},e.warning=function(t,e){return null==e&&(e=10),n.polite(t,e+1),this._show(t,e,"server-warning"),this.current()},e.info=function(t,e){return null==e&&(e=10),n.polite(t,e+1),this._show(t,e,"server-info"),this.current()},e.clear=function(){return this._last_timeout&&clearTimeout(this._last_timeout),this._last_animation&&this._last_animation.stop(),this._last_timeout=null,this._last_animation=null,t("#notify").removeClass("server-error server-info server-success server-warning").hide()},e.isShown=function(){return t("#notify").is(":visible")},e.current=function(){return this._last_timeout},e._show=function(t,e,n){return this._buildElement(),this.clear(),this._setMessage(t),this._showElement(n),this._scheduleHide(e),this.current()},e._buildElement=function(){var e;return t("#notify").length?void 0:(e='<div id="notify-wrapper"> <span id="notify"> <span id="notify-msg" /> </span> </div>',t("body").append(e))},e._setMessage=function(e){var n;return n=t("#notify-msg"),null!=e.toHTML?n.html(e.toHTML()):e instanceof t?n.html(e):n.text(e)},e._showElement=function(e){var n;return n=t("#notify"),n.addClass(e),this._last_animation=n.fadeIn(500)},e._scheduleHide=function(t){return this._last_timeout=setTimeout(this._hide,1e3*t)},e._hide=function(){var n;return n=t("#notify"),e._last_animation=n.fadeOut(1e3),e._last_timeout=null},e}(),INLINE_JS.Notify=s,s})}.call(this),function(){define("modules/core/ordered_dictionary",[],function(){var t;return t=function(){function t(t,e){this.list=t,this.dict=e}return t.list=[],t.dict={},t.prototype.push=function(t,e){this.list.push(t),this.dict[t]=e},t.prototype.remove=function(t){this.list.removeItem(t),delete this.dict[t]},t.prototype.indexOfKey=function(t){return this.list.indexOf(t)},t.prototype.keyAtIndex=function(t){return this.list[t]},t.prototype.valueFromKey=function(t){return this.dict[t]},t.prototype.valueAtIndex=function(t){return this.dict[this.list[t]]},t.prototype.getValues=function(){var t;return function(){var e,n,r,o;for(r=this.list,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.dict[t]);return o}.call(this)},t.prototype.length=function(){return this.list.length},t.prototype.insertAtIndex=function(t,e,n){return this.list.splice(t,0,e),this.dict[e]=n},t}()})}.call(this),function(){define("modules/core/uri",["modules/constants/env","modules/core/exception"],function(t,e){var n,r,o;return o=e.assert,r=function(){function e(r,o){var i,s,a,u;if(!(this instanceof e))return new e(r,o);if(this._query=new n,a={},"string"==typeof r||r instanceof e){if(!t.IS_PROD)throw new Error("URI/uri string passed into URI constructor.  Use URI.parse instead.");a=e.parse(r).toObject()}else"object"==typeof r&&(a=r);if(o&&!t.IS_PROD)throw new Error("Multiple arguments passed into URI constructor.");s=o||{};for(i in s)u=s[i],a[i]=u;this.initFromObject(a)}return e.prototype.initFromObject=function(t){var e,n,r;return n=null!=t?t:{},r=n.scheme,this.authority=n.authority,this.path=n.path,e=n.query,this.fragment=n.fragment,this.setScheme(r),this.setQuery(e)},e.parse=function(t){var r,i,s,a,u,l,c,_;return o(null!=t,"must pass in a valid url-encoded string",{exc_extra:{uri_string_param:t}}),c=String(t).match(e.REGEXP)||[],l=c[0],u=c[1],r=c[2],s=c[3],a=c[4],i=c[5],_=new e,_.setScheme(u),_.setAuthority(e.decode(r)),_.setPath(e.decode(s)),_.setQuery(n.parse_string(a)),_.setFragment(e.decode(i)),_},e.prototype.getScheme=function(){return this.scheme||""},e.prototype.setScheme=function(t){return o(!t||t.match(e.SCHEME_REGEXP),"Invalid scheme",{exc_extra:{scheme_param:t}}),this.scheme=t,this},e.prototype.getAuthority=function(){return this.authority||""},e.prototype.setAuthority=function(t){return this.authority=t,this},e.prototype.getPath=function(){return this.path||""},e.prototype.setPath=function(t){return this.path=t,this},e.prototype.getFragment=function(){return this.fragment||""},e.prototype.setFragment=function(t){return this.fragment=t,this},e.prototype.getQuery=function(){return this._query.dict},e.prototype.setQuery=function(t){return null==t&&(t={}),this._query=new n(t),this},e.prototype.updateQuery=function(t,e){return null==e&&(e=null),this._query.add(t,e),this},e.prototype.removeQuery=function(t){return this._query.remove(t),this},e.prototype.clone=function(){return e(this.toObject())},e.prototype.toObject=function(){return{scheme:this.getScheme(),authority:this.getAuthority(),path:this.getPath(),query:this.getQuery(),fragment:this.getFragment()}},e.prototype.toString=function(){var t,n;return n="",this.scheme&&(n+=this.scheme+":"),this.authority&&(n+="//"+e.encode(this.authority,":@[]")),this.path&&(o(!this.authority||!this.path.length||"/"===this.path[0],'Path must start with a "/" if URI is not relative'),n+=e.encode(this.path,"/")),t=this._query.toString(),t&&(n+="?"+t),this.fragment&&(n+="#"+e.encode(this.fragment,":@[]/&=+?#!")),n},e.REGEXP=/^(?:([^:\/\\?#]+):)?(?:[\/\\]{2}([^\/\\?#]*))?([^?#]*)(?:\?([^#]*))?(?:[#](.*))?$/,e.SCHEME_REGEXP=/^[a-zA-Z][a-zA-Z0-9+.\-]*$/,e.decode=function(t){return t?decodeURIComponent(t):""},e.encode=function(t,e){var n,r,o,i;if(null==e&&(e=""),!t)return"";for(t=encodeURIComponent(t),e+="~",r=0,o=e.length;o>r;r++)i=e[r],n=encodeURIComponent(i),t=t.replace(new RegExp(n,"g"),i);return t},e.encode_parts=function(t,n){var r;return null==n&&(n="/"),function(){var o,i,s,a;for(s=t.split(n),a=[],o=0,i=s.length;i>o;o++)r=s[o],a.push(e.encode(r));return a}().join(n)},e}(),n=function(){function t(t){this.dict={},this.add(t)}return t.parse_string=function(e){var n,r,o,i,s,a,u,l;if(!e)return null;for(s={},a=e.split("&"),n=0,o=a.length;o>n;n++)i=a[n],""!==i&&(u=i.split("="),r=t.decode(u[0]),l=t.decode(u.slice(1).join("=")),r in s?(Array.isArray(s[r])||(s[r]=[s[r]]),s[r].push(l)):s[r]=l);return s},t.prototype.add=function(t,e){var n,r,o,i;if(null==e&&(e=null),"string"==typeof t)null!=e&&(this.dict[t]=Array.isArray(e)?function(){var t,r,o;for(o=[],t=0,r=e.length;r>t;t++)n=e[t],o.push(String(n));return o}():String(e));else{o=t||{};for(r in o)i=o[r],null!=i&&(this.dict[r]=Array.isArray(i)?function(){var t,e,r;for(r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(String(n));return r}():String(i))}return this},t.prototype.remove=function(t){return delete this.dict[t]},t.prototype.replace=function(t){return this.dict=t||{},this},t.prototype.toString=function(){var e,n,r,o;r=[],n=this.dict;for(e in n)o=n[e],Array.isArray(o)?o.forEach(function(n){return r.push(t.encode(e)+"="+t.encode(n))}):r.push(t.encode(e)+"="+t.encode(o));return r.length?r.join("&"):""},t.decode=function(t){return null===t?"":r.decode(t.replace(/\+/g,"%20"))},t.encode=function(t){return null===t?"":r.encode(t).replace(/%20/g,"+")},t}(),INLINE_JS.URI=r,r})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/dirty/growth/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/components/login_form","modules/clean/dbmodal","modules/clean/growth/experiments/logger","modules/clean/profile_services/third_party_signup","modules/clean/register_form"],function(e,n,r,o,i,s,a,u,l,c,_,h,d){var p,f,m,g,v;return m=e.SharingModel,v=i._,g=u.WebMiscActivityLogger,p=c.DBModal,f=function(){function e(e){this.kind=e,this.save_to_dropbox=t(this.save_to_dropbox,this),this.show_create_password_modal=t(this.show_create_password_modal,this),this.show_welcome_modal=t(this.show_welcome_modal,this),this.before_create_password_modal=t(this.before_create_password_modal,this),this.before_download_signup_modal=t(this.before_download_signup_modal,this),this.before_default_signup_modal=t(this.before_default_signup_modal,this),this.before_signup_modal=t(this.before_signup_modal,this),this.init_modals=t(this.init_modals,this),this.init_modals(),"immediate"===this.kind&&(g.log("signup_modal-show-upfront",{auth_google:null!=n.find(".auth-google")}),this.default_signup_modal.show()),n("#download_button_link, #default_content_download_button").click("download"!==this.kind?function(t){return function(){return t.direct_download()}}(this):function(t){return function(){return t.has_seen_modal?t.direct_download():(t.has_seen_modal=!0,g.log("signup_modal-show-download",{auth_google:null!=n.find(".auth-google")}),t.download_type="direct_download",t.download_signup_modal.show())}}(this)),n(".add_to_my_dropbox_link, #default_content_a2md").click(function(t){return function(){return t.download_type="add_to_dropbox",t.download_signup_modal.show()}}(this))}return e.prototype.init_modals=function(){return this.default_signup_modal=new p({element_id:"shared-link-immediate-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.download_signup_modal=new p({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.welcome_modal=new p({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal,this.create_password_modal=new p({element_id:"shared-link-create-password-modal"}),this.create_password_modal.before_show=this.before_create_password_modal},e.prototype.before_signup_modal=function(t){var e,n;return t.find(".toggle-form-link").click(function(e){return function(){return e.toggle_form(t)}}(this)),n=t.find(".register-form"),n.length&&(n.on(d.NEW_ACCOUNT_FROM_3RD_PARTY,function(e){return function(n,r){return e.profile_info=r,e.show_create_password_modal(t,e.profile_info)}}(this)),n.on(d.USER_EXISTS,function(e){return function(n){return e.show_login_form(t,n)}}(this)),n.on(d.REGISTER_SUCCESS,function(t){return function(e,n){return t.user_info=n,t.register_success(t.user_info)}}(this))),e=t.find(".login-form"),e.length?e.on(l.LOGIN_SUCCESS,function(t){return function(e,n){return t.user_info=n,s.success(v("Successfully signed in to Dropbox")),t.download_type?"direct_download"===t.download_type?t.reload_and_direct_download():"add_to_dropbox"===t.download_type?t.save_to_dropbox(!1):void 0:t.reload()}}(this)):void 0},e.prototype.before_default_signup_modal=function(t){return this.before_signup_modal(t),t.find(".close-link").click(function(t){return function(){return t.default_signup_modal.hide()}}(this))},e.prototype.before_download_signup_modal=function(t){return this.before_signup_modal(t),"add_to_dropbox"===this.download_type&&(t.find(".login-form-component").is(":visible")||this.toggle_form(t)),t.find(".close-link").click(function(t){return function(){return t.download_signup_modal.hide()}}(this))},e.prototype.before_create_password_modal=function(t){var e,n,r,o;return t.find(".close-link").click(function(t){return function(){return t.create_password_modal.hide()}}(this)),e=t.find(".create-password-form-component"),r=e.find(".register-form"),r.on(d.REGISTER_SUCCESS,function(t){return function(e,n){return t.user_info=n,t.register_success(t.user_info)}}(this)),this.picture_handler=h.handle_picture_url(n=this.profile_info.picture_url,o=!1)},e.prototype.before_welcome_modal=function(t){return _.log("sharing","shared_link_welcome_modal_view"),t.find(".go-to-dropbox-button").click(function(){return _.log("sharing","shared_link_welcome_modal_button_click")}),t.find(".welcome-modal-no-thanks a").click(function(){return o.reload()})},e.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},e.prototype.show_create_password_modal=function(){var t,e,n;return this.default_signup_modal.hide(),this.download_signup_modal.hide(),n={".input-fname":this.profile_info.fname,".input-lname":this.profile_info.lname,".input-email":this.profile_info.email,"input[name=email_sig]":this.profile_info.email_sig,"input[name=refresh_token]":this.profile_info.refresh_token},this.create_password_modal.show(t="input[name=password]",e=n)},e.prototype.direct_download=function(){var t;return t=o.get_uri().updateQuery({
dl:1}),o.redirect(t)},e.prototype.reload=function(){return o.reload()},e.prototype.reload_and_direct_download=function(){var t;return t=o.get_uri().updateQuery({force_dl:1}),o.redirect(t)},e.prototype.save_to_dropbox=function(t){var e;return t||s.success(v("Saving to your Dropbox ...")),e=m.c2d_vars,e.job=m.is_folder,r.WebRequest({url:m.c2d_url,data:e,subject_user:this.user_info.id,success:function(e){return t?void 0:(s.success(v("Successfully saved to your Dropbox.")),o.redirect(e))}})},e.prototype.show_login_form=function(t,e){var n,r,o,i,s;r=t.find(".login-form-component"),o=r.find(".login-form"),i=e.prefill;for(n in i)s=i[n],o.find(n).val(s);return o.find(e.focus).focus(),r.is(":visible")?void 0:this.toggle_form(t,!0)},e.prototype.toggle_form=function(t,e){var r,o;return o=t.find(".register-form-component"),r=t.find(".login-form-component"),o.is(":visible")?o.fadeOut({complete:function(){return r.show(),null!=e?setTimeout(function(){return n(r.find(".login-form .login-password input[name='login_password']")[0]).focus()},0):void 0}}):r.fadeOut({complete:function(){return o.show()}})},e.prototype.register_success=function(){return s.success(v("Successfully signed up for Dropbox.")),this.download_type?"direct_download"===this.download_type?(this.show_welcome_modal(),this.direct_download()):"add_to_dropbox"===this.download_type?this.save_to_dropbox(!1):void 0:this.show_welcome_modal()},e}()})}.call(this);