KISSY.add("mui/mallbar/plugin-promotion",function(a,e,i,t,r,n,o,s){var l=['<img class="mui-mbarp-promotion-logo mui-mbarp-promotion-logo-anim" src="{0}" />'].join("");var m=function(a){var e=this;m.superclass.constructor.call(e,a);e.init()};a.extend(m,e,{init:function(){var e=this;var i=e.get(n.K.CONTAINER);var t=e.mallbarItem=e.get(n.K.MALLBAR_ITEM);var r=t.get(n.K.MALLBAR);var l=t.get(n.K.TAB);function m(){i.one(".mui-mbarp-promotion-bd").height(i.height())}var c,u;var b=a.unparam(window.location.search.replace("?",""));function d(e){if(c&&u){e&&e({navUrl:c,navLogo:u})}else{window.__content_results=window.__content_results||[];new a.IO({url:"//delta.taobao.com/home/delivery/AllContentByPage.do",type:"GET",dataType:"script",scriptCharset:"utf-8",data:{resourceIds:20140703,wfType:b["wfType"],wfCode:b["wfCode"],_mock_:b["_mock_"]},success:function(){if(a.unparam(window.location.search.replace("?",""))["promotion-mock"]==1){__content_results=[{content:"//img.alicdn.com/tps/i1/TB1Ne73FFXXXXXEapXXXOXwIpXX-70-70.gif",link:"//www.tmall.com/go/rgn/promotion-act/public-block-toolbar.php",contentPicUrl:"//img.alicdn.com/tps/i3/TB1KrUZFFXXXXcoapXXF6kF2pXX-190-480.jpg",title:"\u590f\u65e5\u9017\u6bd45\u6298",rightDesc:"T100\u4e13\u4eab",actDesc:"\u5173\u6ce8\u54c1\u724c\u5373\u53ef\u4eab",noticeDesc:"\u5751\u7239\u7684\u6743\u76ca\u63cf\u8ff0\u4ecb\u7ecd\uff0c\u8fd9\u662f\u4f60\u7684\u4e13\u4eab\uff0c\u5c3d\u60c5\u4efb\u6027\u5427\uff01"}]}o.log("::content result::",__content_results);var i={};if(__content_results&&__content_results[0]&&__content_results[0].content&&__content_results[0].link){o.sendLog(n.ARR.PROMOTION_SHOW);o.sendLog(__content_results[0].exposureParam);i=__content_results[0];c=i.navUrl=__content_results[0].link;u=i.navLogo=__content_results[0].content;e&&e(i)}}})}}var p='<div class="mui-mbarp-promotion-bubble-cont">                    <div class="mui-mbarp-promotion-bubble-notice">                        <p>\u4eb2\u7231\u7684{nick}:</p>                        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{noticeDesc}</p>                    </div>                    <div class="mui-mbarp-promotion-bubble-brand">                        <img class="mui-mbarp-promotion-bubble-img" src="{navLogo}" width="90" height="45"/>                        <span class="mui-mbarp-promotion-bubble-get">\u7acb\u5373\u9886\u53d6</span>                    </div>                </div>';var f='<div class="mui-mbarp-promotion-content">                    <a class="mui-mbarp-promotion-content-link" href="{link}" target="_blank">                        <div class="mui-mbarp-promotion-content-img">                            <img src="{contentPicUrl}" width="200" height="360"/>                        </div>                        <div class="mui-mbarp-promotion-content-box">                        <h1 class="mui-mbarp-promotion-content-title" title="{title}">{title}</h1>                        <p class="mui-mbarp-promotion-content-desc">{actDesc}</p>                <p class="mui-mbarp-promotion-content-right"><span class="mui-mbarp-promotion-right"><i class="mui-mbar-iconfont">&#xe600;</i>{rightDesc}</span></p>                        <p class="mui-mbarp-promotion-content-brand-icon">                            <img src="{navLogo}" width="90" height="45"/>                        </p>                        <span class="mui-mbarp-promotion-content-button">\u7acb\u5373\u83b7\u53d6</span>                        </div>                    </a>                </div>';var v=a.one(".mui-mbar-tab-bubble-promotion");function g(t){d(function(m){if(m.navLogo){m.nick=t.nick;p=a.substitute(p,m);l.slideDown(.5);var c="mui/mbarp/promotion/"+m.acm;s.get({k:c,success:function(a){if(!a){r.bubble({show:true,content:p,customContentType:2,bubbleType:1,height:90,tab:"PROMOTION",showed:function(){o.sendLog(n.ARR.PROMOTION_BUBBLE_SHOW);s.set({k:c,v:1})},clicked:function(){l.fire("click");o.sendLog(n.ARR.PROMOTION_BUBBLE_CLICK)}})}}});e.on(n.E.VISIBILITY_CHANGE,function(e){if(m.navUrl){if(e.visible&&e.first){var t=a.substitute(f,m);i.html(t)}}})}})}o.getStaticConf({cb:function(){TB.Global.loginStatusReady(function(a){if(a.isLogin){g(a)}else{t.on(n.E.LOGIN_SUCCESS,function(e){g(a)})}})}})}});return m},{requires:["base","node","dom","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-promotion.css"]});